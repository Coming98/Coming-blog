<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>05-React-Class Component Attrs</title>
      <link href="/Coming-blog/2023/01/01/05-react-class-component-attrs/"/>
      <url>/Coming-blog/2023/01/01/05-react-class-component-attrs/</url>
      
        <content type="html"><![CDATA[<h1 id="ref"><a class="markdownIt-Anchor" href="#ref"></a> Ref</h1><p>Motivation: é€šè¿‡åŸç”Ÿçš„ event æˆ‘ä»¬åªèƒ½è·å–åˆ°è§¦å‘äº‹ä»¶çš„æŒ‰é’®ç­‰, ä½†æˆ‘ä»¬æƒ³è¦çš„æ˜¯ input ä¸­çš„å†…å®¹, å› æ­¤è¿˜éœ€è¦å¼•å…¥é¢å¤–çš„å±æ€§æ¥å®ç°</p><h2 id="reactcreateref"><a class="markdownIt-Anchor" href="#reactcreateref"></a> React.createRef()</h2><ol><li>ä½¿ç”¨ React.createRef() ç»´æŠ¤å¼•ç”¨å˜é‡: <code>mytext = React.createRef()</code></li><li>å°†å¼•ç”¨å˜é‡èµ‹å€¼ç»™ç»„ä»¶çš„ ref å±æ€§: <code>ref=&#123;this.mytext&#125;</code></li></ol><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">&#123;</span>    mytext <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">createRef</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token punctuation">(</span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">                </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">                    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">ref</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token keyword">this</span><span class="token punctuation">.</span>mytext<span class="token punctuation">&#125;</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>input</span><span class="token punctuation">></span></span><span class="token plain-text">                    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>handleClick <span class="token punctuation">&#125;</span></span><span class="token punctuation">></span></span><span class="token plain-text"> ADD </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text">                </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>        <span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>    <span class="token function-variable function">handleClick</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"`this.mytext.current` è·å–ç›®æ ‡æ ‡ç­¾å¯¹è±¡"</span><span class="token punctuation">)</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>mytext<span class="token punctuation">.</span>current<span class="token punctuation">)</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"`this.mytext.current.value` è·å–ç›®æ ‡å†…å®¹"</span><span class="token punctuation">)</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>mytext<span class="token punctuation">.</span>current<span class="token punctuation">.</span>value<span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/202301012048910.png" alt="" /></p><h2 id="thisrefsxxx"><a class="markdownIt-Anchor" href="#thisrefsxxx"></a> <a target="_blank" rel="noopener" href="http://this.refs.xxx">this.refs.xxx</a></h2><p>ä¸åœ¨æ¨èä½¿ç”¨äº†, å­—ç¬¦ä¸²ç”±äººä¸ºå®šä¹‰, ç¼–è¯‘å™¨æ— æ³•æ£€æŸ¥, å› æ­¤å­˜åœ¨æ½œåœ¨çš„é£é™©</p><ol><li>åœ¨ç›®æ ‡ç»„ä»¶ä¸Šé‡å†™ ref å±æ€§, ä¼ å…¥ç»„ä»¶åç§° <code>refName</code></li><li>åœ¨äº‹ä»¶å¤„ç†å‡½æ•°ä¸­å¯ä»¥é€šè¿‡ <code>this.refs.refName</code> è·å–ç›®æ ‡ç»„ä»¶å¯¹è±¡</li></ol><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">&#123;</span>    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token punctuation">(</span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">                </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>mytext<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>input</span><span class="token punctuation">></span></span><span class="token plain-text">                </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>handleClick <span class="token punctuation">&#125;</span></span><span class="token punctuation">></span></span><span class="token plain-text"> ADD </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text">            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>        <span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>    <span class="token function-variable function">handleClick</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"`this.refs.mytext` è·å–ç›®æ ‡æ ‡ç­¾å¯¹è±¡"</span><span class="token punctuation">)</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>refs<span class="token punctuation">.</span>mytext<span class="token punctuation">)</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"`this.refs.mytext.value` è·å–ç›®æ ‡å†…å®¹"</span><span class="token punctuation">)</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>refs<span class="token punctuation">.</span>mytext<span class="token punctuation">.</span>value<span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/202301012044177.png" alt="" /></p><h1 id="state"><a class="markdownIt-Anchor" href="#state"></a> State</h1><h2 id="state-åˆå§‹åŒ–"><a class="markdownIt-Anchor" href="#state-åˆå§‹åŒ–"></a> state åˆå§‹åŒ–</h2><h3 id="ç±»ä¸­ç›´æ¥åˆå§‹åŒ–"><a class="markdownIt-Anchor" href="#ç±»ä¸­ç›´æ¥åˆå§‹åŒ–"></a> ç±»ä¸­ç›´æ¥åˆå§‹åŒ–</h3><ul><li>ç±»ç»„ä»¶ä¸­ç›´æ¥å®šä¹‰: <code>state = &#123;...props&#125;</code>, state åç§°æ˜¯å›ºå®šçš„, ä¸èƒ½äººä¸ºä¿®æ”¹</li><li>äº‹ä»¶å¤„ç†ä¸­æ›´æ–°: <code>this.setState(&#123;...props&#125;)</code>, state ä¸èƒ½åƒä¿®æ”¹æ™®é€šå˜é‡ä¸€æ ·ç›´æ¥ä¿®æ”¹å…¶å€¼</li><li>æ›´æ–°åçš„äº‹ä»¶å¤„ç†: <code>this.setState(&#123;&#125;, () =&gt; &#123;&#125;)</code> è¿”å›å‡½æ•°æ˜¯åœ¨çŠ¶æ€æ›´æ–°åçš„å›è°ƒå¤„ç†å‡½æ•°, æ¯”å¦‚æ›´æ–° betterscroll</li></ul><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">&#123;</span>        state <span class="token operator">=</span> <span class="token punctuation">&#123;</span>        collectionState<span class="token operator">:</span> <span class="token boolean">true</span>    <span class="token punctuation">&#125;</span>    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">const</span> <span class="token punctuation">&#123;</span>collectionState<span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state        <span class="token keyword">return</span> <span class="token punctuation">(</span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">                </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span><span class="token plain-text">æ”¶è—çŠ¶æ€çš„æ”¹å˜</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span><span class="token plain-text">                </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>                    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>                        collectionState <span class="token operator">:</span> <span class="token operator">!</span>collectionState                    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>                <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></span><span class="token punctuation">></span></span><span class="token plain-text"> </span><span class="token punctuation">&#123;</span>collectionState <span class="token operator">?</span> <span class="token string">"ğŸ–¤ æ”¶è—"</span> <span class="token operator">:</span> <span class="token string">"â¤ï¸ å–æ¶ˆ"</span><span class="token punctuation">&#125;</span><span class="token plain-text"> </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text">            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>        <span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="æ„é€ å™¨ä¸­åˆå§‹åŒ–"><a class="markdownIt-Anchor" href="#æ„é€ å™¨ä¸­åˆå§‹åŒ–"></a> æ„é€ å™¨ä¸­åˆå§‹åŒ–</h3><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">&#123;</span>    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// ç»§æ‰¿çˆ¶ç±»çš„å†…å®¹</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token punctuation">&#123;</span>            collectionState<span class="token operator">:</span> <span class="token boolean">true</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token operator">...</span>    <span class="token comment">// åç»­å†…å®¹åŒä¸Š </span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="state-æ¸²æŸ“"><a class="markdownIt-Anchor" href="#state-æ¸²æŸ“"></a> state æ¸²æŸ“</h2><h3 id="åˆ—è¡¨çš„å¾ªç¯æ¸²æŸ“"><a class="markdownIt-Anchor" href="#åˆ—è¡¨çš„å¾ªç¯æ¸²æŸ“"></a> åˆ—è¡¨çš„å¾ªç¯æ¸²æŸ“</h3><p>ä½¿ç”¨åŸç”Ÿ js çš„ map æ–¹æ³•: React è®¤ä¸ºå¦‚æ— å¿…è¦, å‹¿å¢å®ä½“</p><ul><li>åˆ—è¡¨æ¸²æŸ“åˆ° template ä¸­è¦æŒ‡å®š key å€¼, é€šè¿‡ key å€¼èƒ½å¤Ÿå¿«é€Ÿ diff js å¯¹è±¡çš„å˜åŒ–, å› æ­¤ key å€¼è¦ç‹¬ä¸€æ— äºŒçš„è¡¨ç¤ºç›®æ ‡å¯¹è±¡, ä¸èƒ½æ˜¯ç´¢å¼• (å¦‚æœå­˜åœ¨ä¸­é—´æ’å…¥æˆ–åˆ é™¤çš„æ“ä½œ)</li><li>template ä¸­ä¸è¦æ¶‰åŠåˆ°å¤æ‚é€»è¾‘, å¤æ‚é€»è¾‘åœ¨åå°ä»£ç /å¤–éƒ¨é€»è¾‘ä»£ç ä¸­å¤„ç†å®Œæ¯•</li></ul><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">&#123;</span>    state <span class="token operator">=</span> <span class="token punctuation">&#123;</span>        items <span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"A"</span><span class="token punctuation">,</span> <span class="token string">"B"</span><span class="token punctuation">,</span> <span class="token string">"C"</span><span class="token punctuation">,</span> <span class="token string">"D"</span><span class="token punctuation">,</span> <span class="token string">"E"</span><span class="token punctuation">]</span>    <span class="token punctuation">&#125;</span>    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">// key å€¼ç”¨äº React çš„ diff ç®—æ³•, éœ€è¦ç‹¬ä¸€æ— äºŒçš„è¡¨ç¤ºç›®æ ‡, è¿™é‡Œæš‚æ—¶çš„ä½¿ç”¨å†…å®¹æœ¬èº«</span>        <span class="token keyword">const</span> items_info <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>items<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">key</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span>item<span class="token punctuation">&#125;</span></span><span class="token punctuation">></span></span><span class="token punctuation">&#123;</span>item<span class="token punctuation">&#125;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span><span class="token punctuation">)</span>        <span class="token keyword">return</span> <span class="token punctuation">(</span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">                </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span><span class="token plain-text">08-å¾ªç¯æ¸²æŸ“.js</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span><span class="token plain-text">                </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">></span></span><span class="token plain-text">                    </span><span class="token punctuation">&#123;</span>                        <span class="token comment">// é€šå¸¸åœ¨å¤–éƒ¨å¤„ç†å®Œæ¯•å, è®©è¿”å›çš„å†…å®¹ä¸­å°½é‡ä¸åŒ…å«å¤„ç†é€»è¾‘</span>                        <span class="token comment">// Django è§†é¢‘ä¸­çš„åˆ†é¡µå¤„ç†ä¹Ÿæ˜¯ç±»ä¼¼çš„æ€æƒ³, template ä¸­å°½é‡é¿å…å¤æ‚é€»è¾‘, åœ¨åå°ä»£ç ä¸­å¤„ç†å®Œæ¯•</span>                        <span class="token comment">// this.state.items.map(item => &lt;li>&#123;item&#125;&lt;/li>)</span>                        items_info                    <span class="token punctuation">&#125;</span><span class="token plain-text">                </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">></span></span><span class="token plain-text">            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>        <span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/202301012055860.png" alt="" /></p><h3 id="åˆå¹¶æ¸²æŸ“é—®é¢˜"><a class="markdownIt-Anchor" href="#åˆå¹¶æ¸²æŸ“é—®é¢˜"></a> åˆå¹¶æ¸²æŸ“é—®é¢˜</h3><p>React 18 ä¹‹å‰åŒæ­¥æ—¶ï¼ŒsetState ä¼šè¿›è¡Œåˆå¹¶çš„å¼‚æ­¥çš„æ¸²æŸ“, å¼‚æ­¥æ—¶ä¸ä¼šåˆå¹¶å¹¶ä¸”åŒæ­¥é¡ºåºæ¸²æŸ“</p><p>React 18 ä¹‹åä¸è®ºåŒæ­¥å¼‚æ­¥ setState éƒ½ä¼šåˆå¹¶æ¸²æŸ“ï¼ŒåŒæ­¥å¼‚æ­¥å¹¶ä¸ä¿è¯</p><h1 id="props"><a class="markdownIt-Anchor" href="#props"></a> props</h1><ul><li><code>&lt;Component props=&#123;value&#125;&gt;</code>: ç»„ä»¶å®šä¹‰å±æ€§æ¥æ”¶çš„æ¥å£</li><li>è‡ªèº«çš„å±æ€§è‡ªèº«ä¸èƒ½æ›´æ”¹ï¼Œåªèƒ½é€šè¿‡çˆ¶ç»„ä»¶æ›´æ”¹</li></ul><h2 id="å±æ€§ç±»å‹éªŒè¯"><a class="markdownIt-Anchor" href="#å±æ€§ç±»å‹éªŒè¯"></a> å±æ€§ç±»å‹éªŒè¯</h2><p>ä¸ºäº†é˜²æ­¢å°è£…çš„ç»„ä»¶è¢«é”™è¯¯ä¼ å…¥å±æ€§, å› æ­¤åšå¥½å±æ€§ç±»å‹éªŒè¯ååˆ†æœ‰å¿…è¦</p><ul><li>é’ˆå¯¹ç±»ç»„ä»¶, é€šè¿‡ç±»å±æ€§å®šä¹‰ <code>propTypes</code> å³å¯</li></ul><p>Tips: <code>import prop from 'prop-types'</code> ä¸ºæˆ‘ä»¬å°è£…å¥½äº†å¸¸è§çš„å±æ€§éªŒè¯æ–¹æ³•</p><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx"><span class="token comment">// ç±»å†…: ç±»å±æ€§</span><span class="token keyword">static</span> propTypes <span class="token operator">=</span> <span class="token punctuation">&#123;</span>    title<span class="token operator">:</span> prop<span class="token punctuation">.</span>string<span class="token punctuation">,</span>    leftshow<span class="token operator">:</span> prop<span class="token punctuation">.</span>bool<span class="token punctuation">&#125;</span><span class="token comment">// ç±»å¤–: ç±»å±æ€§</span>Navbar<span class="token punctuation">.</span>propTypes <span class="token operator">=</span> <span class="token punctuation">&#123;</span>    title<span class="token operator">:</span> prop<span class="token punctuation">.</span>string<span class="token punctuation">,</span>    leftshow<span class="token operator">:</span> prop<span class="token punctuation">.</span>bool<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="å±æ€§é»˜è®¤å€¼"><a class="markdownIt-Anchor" href="#å±æ€§é»˜è®¤å€¼"></a> å±æ€§é»˜è®¤å€¼</h2><p>é’ˆå¯¹ç±»ç»„ä»¶, å®šä¹‰å…¶ç±»å±æ€§ <code>defaultProps</code></p><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx">Navbar<span class="token punctuation">.</span>defaultProps <span class="token operator">=</span> <span class="token punctuation">&#123;</span>    title<span class="token operator">:</span> <span class="token string">"Title"</span><span class="token punctuation">,</span>     leftshow<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> React </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>04-React-CrossDomain</title>
      <link href="/Coming-blog/2022/12/31/04-react-crossdomain/"/>
      <url>/Coming-blog/2022/12/31/04-react-crossdomain/</url>
      
        <content type="html"><![CDATA[<h1 id="è·¨åŸŸé—®é¢˜"><a class="markdownIt-Anchor" href="#è·¨åŸŸé—®é¢˜"></a> è·¨åŸŸé—®é¢˜</h1><p>ç®€å•è®²å°±æ˜¯å½“å‰æ‰€å¤„ä½ç½®ä¸ç›®æ ‡ä½ç½®ä¸åŒæºï¼ˆåŸŸï¼‰, ç”±åè®®, ä¸»æœºåå’Œç«¯å£å·å†³å®š</p><h1 id="é…ç½®ä»£ç†è§£å†³"><a class="markdownIt-Anchor" href="#é…ç½®ä»£ç†è§£å†³"></a> é…ç½®ä»£ç†è§£å†³</h1><p>åœ¨ package.json ä¸­è¿½åŠ å¦‚ä¸‹é…ç½®, ä½†æ˜¯ä¸èƒ½é…ç½®å¤šä¸ªä»£ç†, å½“ç”¨ ajax è¯·æ±‚äº†æœ¬åœ°ä¸å­˜åœ¨çš„èµ„æº, å°†ä¼šè½¬å‘ç»™ç›®æ ‡ä»£ç†</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">&quot;proxy&quot;:&quot;http:&#x2F;&#x2F;localhost:5000&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h1 id="å¤šä»£ç†é…ç½®"><a class="markdownIt-Anchor" href="#å¤šä»£ç†é…ç½®"></a> å¤šä»£ç†é…ç½®</h1><p>å€ŸåŠ©ä¸­é—´ä»¶ <code>http-proxy-middleware</code> è¿›è¡Œé…ç½®, é…ç½®å®Œæ¯•åéœ€è¦é‡å¯æœåŠ¡å™¨ï¼Œå› ä¸ºå¯ç”¨äº†åå‘ä»£ç†ï¼Œæ‰€ä»¥åœ¨è¯·æ±‚ <code>url</code> æ—¶ä¸è¦å¸¦æœ‰åŸŸåï¼Œåå‘ä»£ç†ä¼šè‡ªåŠ¨æ·»åŠ ä»£ç†çš„åŸŸå</p><ol><li>åœ¨ src ä¸‹åˆ›å»ºé…ç½®æ–‡ä»¶ï¼š<code>src/setupProxy.js</code></li><li>å•ä¸ªä»£ç†é…ç½®</li></ol><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> createProxyMiddleware <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'http-proxy-middleware'</span><span class="token punctuation">)</span>module<span class="token punctuation">.</span><span class="token function-variable function">export</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">app</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>    <span class="token string">'/help'</span><span class="token punctuation">,</span> <span class="token comment">// è¡¨ç¤ºåªæœ‰ /help å¼€å¤´çš„è¯·æ±‚æ‰è½¬å‘ç»™ä»£ç†æœåŠ¡å™¨ 5000</span>        <span class="token function">createProxyMiddleware</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>            target<span class="token operator">:</span> <span class="token string">'http://localhost:5000'</span><span class="token punctuation">,</span>            changeOrigin<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// å°†è‡ªå·±çš„æºæ”¹ä¸ºä»£ç†æœåŠ¡å™¨çš„æº, ä¸»è¦æ˜¯æ”¹ host</span>            pathRewrite<span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token string">'^/help'</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">&#125;</span> <span class="token comment">// ä»¥æ­£åˆ™è¡¨è¾¾å¼çš„æ–¹å¼æ›¿æ¢å‰ç¼€ä¸ºç©º</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>    <span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="3"><li>å¤šä¸ªä»£ç†é…ç½®</li></ol><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> createProxyMiddleware <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'http-proxy-middleware'</span><span class="token punctuation">)</span>module<span class="token punctuation">.</span><span class="token function-variable function">export</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">app</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>    <span class="token function">proxy</span><span class="token punctuation">(</span><span class="token string">'/help'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>            target<span class="token operator">:</span> <span class="token string">'http://localhost:5000'</span><span class="token punctuation">,</span>            changeOrigin<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>            pathRewrite<span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token string">'^/help'</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token function">proxy</span><span class="token punctuation">(</span><span class="token string">'/help2'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>            target<span class="token operator">:</span> <span class="token string">'http://localhost:6000'</span><span class="token punctuation">,</span>            changeOrigin<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>            pathRewrite<span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token string">'^/help2'</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> React </category>
          
      </categories>
      
      
        <tags>
            
            <tag> method </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>03-React-Component Basic</title>
      <link href="/Coming-blog/2022/12/31/03-react-component-basic/"/>
      <url>/Coming-blog/2022/12/31/03-react-component-basic/</url>
      
        <content type="html"><![CDATA[<h1 id="ç±»ç»„ä»¶"><a class="markdownIt-Anchor" href="#ç±»ç»„ä»¶"></a> ç±»ç»„ä»¶</h1><h2 id="æœ€åŸºæœ¬çš„ç±»ç»„ä»¶"><a class="markdownIt-Anchor" href="#æœ€åŸºæœ¬çš„ç±»ç»„ä»¶"></a> æœ€åŸºæœ¬çš„ç±»ç»„ä»¶</h2><p>å¯ä»¥ä½¿ç”¨ rcc ( in vscode ) å¿«é€Ÿæ„å»º</p><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">&#123;</span>    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span><span class="token plain-text">Hello App from React.Component </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">export</span> <span class="token keyword">default</span> App<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¼•å…¥åˆ›å»ºçš„ç±»ç»„ä»¶å, é€šè¿‡ ReactDom è¿›è¡Œæ¸²æŸ“</p><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx"><span class="token comment">// è¿™é‡Œçš„ App æ˜¯åˆ«å, ä¸ä¸€å®šä¸ç›®æ ‡æ–‡ä»¶å¯¼å‡ºå¯¹è±¡çš„åç§°ä¸€è‡´</span><span class="token keyword">import</span> <span class="token constant">APP</span> <span class="token keyword">from</span> <span class="token string">'./01-base/01-1-classç»„ä»¶åˆè¯†.js'</span>ReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">Test</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token punctuation">,</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'root'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>Tips: React 18 ç‰ˆæœ¬ä¸åœ¨æ¨èä½¿ç”¨ ReactDOM.render() çš„æ¸²æŸ“æ–¹å¼</p><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx"><span class="token keyword">const</span> container <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'root'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> root <span class="token operator">=</span> <span class="token function">createRoot</span><span class="token punctuation">(</span>container<span class="token punctuation">)</span><span class="token punctuation">;</span>root<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">APP</span></span> <span class="token punctuation">/></span></span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h2 id="æ ¹æ®å±æ€§æ„é€ ç®€å•çš„åŠ¨æ€ç±»ç»„ä»¶"><a class="markdownIt-Anchor" href="#æ ¹æ®å±æ€§æ„é€ ç®€å•çš„åŠ¨æ€ç±»ç»„ä»¶"></a> æ ¹æ®å±æ€§æ„é€ ç®€å•çš„åŠ¨æ€ç±»ç»„ä»¶</h2><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx"><span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">&#123;</span>    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span><span class="token plain-text">Hello App from React.Component @ </span><span class="token punctuation">&#123;</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>name<span class="token punctuation">&#125;</span><span class="token plain-text"> </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token comment">// .render ç›´æ¥å®ä¾‹åŒ–, æ¸²æŸ“æ—¶ç›´æ¥ä¼ é€’è¯¥å¯¹è±¡å³å¯</span><span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">App</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>    name<span class="token operator">:</span> <span class="token string">'ComingPro'</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">export</span> <span class="token keyword">default</span> app<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ­¤æ—¶å·²ç»å®ä¾‹åŒ–å•¦, å› æ­¤ç›´æ¥æ¸²æŸ“ç›®æ ‡å¯¹è±¡å³å¯</p><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx"><span class="token keyword">const</span> container <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'root'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> root <span class="token operator">=</span> <span class="token function">createRoot</span><span class="token punctuation">(</span>container<span class="token punctuation">)</span><span class="token punctuation">;</span>root<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>App<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h1 id="å‡½æ•°å¼ç»„ä»¶"><a class="markdownIt-Anchor" href="#å‡½æ•°å¼ç»„ä»¶"></a> å‡½æ•°å¼ç»„ä»¶</h1><p>æ— çŠ¶æ€ç»„ä»¶, ååˆ†ç®€å•, ä½†è‡ªèº«èƒ½æ‰¿æ‹…çš„åŠŸèƒ½ä¹Ÿæœ‰é™</p><ul><li>ç»„ä»¶ä¸­  <code>this</code> ä¸º <code>undefined</code>ï¼Œæ˜¯å› ä¸ºç»è¿‡ <code>babel</code> ç¿»è¯‘å¼€èµ·ä¸¥æ ¼æ¨¡å¼ï¼Œä»è€Œç¦æ­¢äº†è‡ªå®šä¹‰ <code>this</code> æŒ‡å‘ <code>window</code></li></ul><h2 id="åŸºæœ¬çš„å‡½æ•°å¼ç»„å»º"><a class="markdownIt-Anchor" href="#åŸºæœ¬çš„å‡½æ•°å¼ç»„å»º"></a> åŸºæœ¬çš„å‡½æ•°å¼ç»„å»º</h2><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token punctuation">(</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span><span class="token plain-text"> 02-å‡½æ•°å¼ç»„ä»¶.js </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span><span class="token plain-text">            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">></span></span><span class="token plain-text"> Hello ComingPro </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">></span></span><span class="token plain-text">            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">></span></span><span class="token plain-text"> You are the Best </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">></span></span><span class="token plain-text">        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>    <span class="token punctuation">)</span><span class="token punctuation">&#125;</span>ReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">App</span></span><span class="token punctuation">/></span></span><span class="token punctuation">,</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'test'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="ç»„ä»¶çš„åµŒå¥—"><a class="markdownIt-Anchor" href="#ç»„ä»¶çš„åµŒå¥—"></a> ç»„ä»¶çš„åµŒå¥—</h1><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx"><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>Component<span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token keyword">class</span> <span class="token class-name">Navbar</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">&#123;</span>    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span><span class="token punctuation">(</span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">></span></span><span class="token plain-text">Navbar</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">></span></span>        <span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function">Swiper</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token punctuation">(</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">></span></span><span class="token plain-text">Swiper</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">></span></span>    <span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token keyword">const</span> <span class="token function-variable function">Tabbar</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">></span></span><span class="token plain-text">Tabbar</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">></span></span><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">&#123;</span>    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token punctuation">(</span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">                </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span><span class="token plain-text">03-ç»„ä»¶çš„åµŒå¥—.js</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span><span class="token plain-text">                </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Navbar</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Navbar</span></span><span class="token punctuation">></span></span><span class="token plain-text">                </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Swiper</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Swiper</span></span><span class="token punctuation">></span></span><span class="token plain-text">                </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Tabbar</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Tabbar</span></span><span class="token punctuation">></span></span><span class="token plain-text">            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>        <span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/202212311851361.png" alt="" /></p><h1 id="ç»„ä»¶çš„æ ·å¼"><a class="markdownIt-Anchor" href="#ç»„ä»¶çš„æ ·å¼"></a> ç»„ä»¶çš„æ ·å¼</h1><p>æ¨èä½¿ç”¨è¡Œå†…æ ·å¼, æ–¹ä¾¿ç»„ä»¶å¤ç”¨</p><ul><li>å¦‚æœå¯¼å…¥å¤–éƒ¨ CSS æ–‡ä»¶, æ•´åˆçš„ webpack ä¼šå°†å…¶è½¬ä¸ºå†…éƒ¨ <code>style</code> ä»è€Œå°†æ ·å¼åº”ç”¨</li><li>æ¨èæ¯ä¸€ä¸ªç»„ä»¶å»ºç«‹ä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œæ–‡ä»¶å¤¹ä¸­ <code>index.js</code> å†™ç»„ä»¶è®¾è®¡ä»£ç ï¼›<code>index.css</code> å†™ç»„ä»¶æ ·å¼ä»£ç </li></ul><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx"><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>Component<span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token keyword">import</span> <span class="token string">'./css/01-index.css'</span> <span class="token comment">// webpack çš„æ”¯æŒ</span><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">&#123;</span>    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">var</span> username <span class="token operator">=</span> <span class="token string">"ComingPro"</span>        <span class="token keyword">var</span> style1 <span class="token operator">=</span> <span class="token punctuation">&#123;</span>            background<span class="token operator">:</span> <span class="token string">"yellow"</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">return</span> <span class="token punctuation">(</span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">                </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">></span></span><span class="token plain-text">                    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">></span></span><span class="token plain-text">10 + 20 = </span><span class="token punctuation">&#123;</span><span class="token number">10</span> <span class="token operator">+</span> <span class="token number">20</span><span class="token punctuation">&#125;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span><span class="token plain-text">                    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">></span></span><span class="token plain-text"> Username: </span><span class="token punctuation">&#123;</span>username<span class="token punctuation">&#125;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span><span class="token plain-text">                    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">></span></span><span class="token plain-text"> 10 &amp;gt; 20 : </span><span class="token punctuation">&#123;</span><span class="token number">10</span> <span class="token operator">></span> <span class="token number">20</span> <span class="token operator">?</span> <span class="token string">"Yes"</span> <span class="token operator">:</span> <span class="token string">"No"</span><span class="token punctuation">&#125;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span><span class="token plain-text">                    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">></span></span><span class="token plain-text"> 10 &amp;lt; 20 : </span><span class="token punctuation">&#123;</span><span class="token number">10</span> <span class="token operator">&lt;</span> <span class="token number">20</span> <span class="token operator">?</span> <span class="token string">"Yes"</span> <span class="token operator">:</span> <span class="token string">"No"</span><span class="token punctuation">&#125;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span><span class="token plain-text">                </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">></span></span><span class="token plain-text">                </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">style</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span>style1<span class="token punctuation">&#125;</span></span><span class="token punctuation">></span></span><span class="token plain-text"> æ¨èä½¿ç”¨è¿™ä¸¤ç§è¡Œå†…æ ·å¼, æ–¹ä¾¿ç»„ä»¶çš„ç®¡ç† </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">                </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">style</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span>backgroundColor<span class="token operator">:</span> <span class="token string">"blue"</span><span class="token punctuation">,</span> color<span class="token operator">:</span> <span class="token string">"white"</span><span class="token punctuation">,</span> fontSize<span class="token operator">:</span> <span class="token string">"22px"</span><span class="token punctuation">,</span> padding<span class="token operator">:</span> <span class="token string">"8px"</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></span><span class="token punctuation">></span></span><span class="token plain-text"> å‘½åå˜ä¸ºé©¼å³° </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">                </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>active<span class="token punctuation">'</span></span><span class="token punctuation">></span></span><span class="token plain-text"> å¼•å…¥çš„å¤–éƒ¨ CSS </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">                </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">                    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">htmlFor</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>username<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token plain-text">Username: </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">></span></span><span class="token plain-text">                    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>username<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>for should be htmlFor<span class="token punctuation">'</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>input</span><span class="token punctuation">></span></span><span class="token plain-text">                </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>        <span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/202212311853206.png" alt="" /></p><h1 id="ç»„ä»¶çš„äº‹ä»¶ç»‘å®š"><a class="markdownIt-Anchor" href="#ç»„ä»¶çš„äº‹ä»¶ç»‘å®š"></a> ç»„ä»¶çš„äº‹ä»¶ç»‘å®š</h1><p>æ‰€æœ‰äº‹ä»¶å‘½åéƒ½æ˜¯ <code>on</code> + <code>äº‹ä»¶çš„é©¼å³°å‘½å</code> å¦‚ <code>onClick, onMouseOver</code></p><ul><li>React äº‹ä»¶ç»‘å®šåŸç†: React å¹¶æ²¡æœ‰çœŸæ­£çš„ç»‘å®šäº‹ä»¶åˆ°æ¯ä¸€ä¸ªå…·ä½“çš„æ ‡ç­¾ä¸Šï¼Œè€Œæ˜¯é‡‡ç”¨äº‹ä»¶ä»£ç†çš„æ¨¡å¼ï¼Œåœ¨æ ¹æ ‡ç­¾ä¸Šè¿›è¡Œäº‹ä»¶çš„ç›‘å¬ï¼ˆå†’æ³¡ï¼‰</li></ul><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/202212312238050.png" alt="" /></p><h2 id="é˜»æ­¢å†’æ³¡"><a class="markdownIt-Anchor" href="#é˜»æ­¢å†’æ³¡"></a> é˜»æ­¢å†’æ³¡</h2><p>é€šè¿‡ event å¯¹è±¡é˜»æ­¢å†’æ³¡, å¤„ç†å‡½æ•°ä¸­çš„ event å‚æ•°ä¹Ÿæ˜¯ react æ¨¡æ‹Ÿçš„, ä½†æ˜¯ä»ç„¶å­˜åœ¨é˜»æ­¢å†’æ³¡çš„ç›¸å…³æ¥å£: <code>event.stopPropagatoin</code>, <code>event.preventDefault</code></p><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">&#123;</span>    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token punctuation">(</span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">                </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>input</span><span class="token punctuation">></span></span><span class="token plain-text">                </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>handleClick <span class="token punctuation">&#125;</span></span><span class="token punctuation">></span></span><span class="token plain-text"> ADD </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text">            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>        <span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>    <span class="token function-variable function">handleClick</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"`event.target` è·å–äº‹ä»¶æº"</span><span class="token punctuation">)</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>target<span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="å››ç§äº‹ä»¶ç»‘å®šæ–¹å¼"><a class="markdownIt-Anchor" href="#å››ç§äº‹ä»¶ç»‘å®šæ–¹å¼"></a> å››ç§äº‹ä»¶ç»‘å®šæ–¹å¼</h2><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">&#123;</span>    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token punctuation">(</span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">                </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>input</span><span class="token punctuation">></span></span><span class="token plain-text">                </span><span class="token punctuation">&#123;</span><span class="token comment">/* 1. è¡Œå†…å½¢å¼ */</span><span class="token punctuation">&#125;</span><span class="token plain-text">                </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>                    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"click1"</span><span class="token punctuation">)</span>                <span class="token punctuation">&#125;</span> <span class="token punctuation">&#125;</span></span><span class="token punctuation">></span></span><span class="token plain-text"> ADD </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text">                </span><span class="token punctuation">&#123;</span><span class="token comment">/* 2. åŸç”Ÿçš„ js å‡½æ•°å½¢å¼: å­˜åœ¨ this æŒ‡å‘é—®é¢˜ */</span><span class="token punctuation">&#125;</span><span class="token plain-text">                </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>handleClick2 <span class="token punctuation">&#125;</span></span><span class="token punctuation">></span></span><span class="token plain-text"> ADD2 </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text">                 </span><span class="token punctuation">&#123;</span><span class="token comment">/* 2. åŸç”Ÿçš„ js å‡½æ•°å½¢å¼: ä½¿ç”¨ bind è§£å†³ this æŒ‡å‘é—®é¢˜ */</span><span class="token punctuation">&#125;</span><span class="token plain-text">                </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">handleClick2</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token punctuation">&#125;</span></span><span class="token punctuation">></span></span><span class="token plain-text"> ADD2-bind </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text">                </span><span class="token punctuation">&#123;</span><span class="token comment">/* 3. éšå¼åŒ¿åå‡½æ•°è°ƒç”¨ */</span><span class="token punctuation">&#125;</span><span class="token plain-text">                </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>handleClick3 <span class="token punctuation">&#125;</span></span><span class="token punctuation">></span></span><span class="token plain-text"> ADD3 </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text">                </span><span class="token punctuation">&#123;</span><span class="token comment">/* 4. æ˜¾å¼åŒ¿åå‡½æ•°è°ƒç”¨ */</span><span class="token punctuation">&#125;</span><span class="token plain-text">                </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">handleClick4</span><span class="token punctuation">(</span><span class="token string">"ComingPro"</span><span class="token punctuation">)</span> <span class="token punctuation">&#125;</span> <span class="token punctuation">&#125;</span></span><span class="token punctuation">></span></span><span class="token plain-text"> ADD4 </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text">            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>        <span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol><li>è¡Œå†…å½¢å¼: æ²¡æœ‰ this æŒ‡å‘é—®é¢˜, é€»è¾‘ç®€å•çš„æ—¶å€™æ¨èä½¿ç”¨</li><li>åŸç”Ÿçš„ js å‡½æ•°å½¢å¼: å­˜åœ¨ this æŒ‡å‘é—®é¢˜<ul><li>React é€šè¿‡äº‹ä»¶ä»£ç†å®ç°äº‹ä»¶çš„å“åº”, å› æ­¤å¹¶éå®ä¾‹æœ¬èº«è°ƒç”¨çš„è¿™ä¸ªå‡½æ•°, æ‰€ä»¥ä¸¢å¤±äº† this;</li><li>èƒ½å¤Ÿé€šè¿‡ bind è§£å†³, ä½†æ˜¯ä»æ—§ä¸æ¨èä½¿ç”¨</li></ul><blockquote><p><code>.call(this)</code> ä¼šæ”¹å˜ this æŒ‡å‘ä½†æ˜¯ä¼šè‡ªåŠ¨æ‰§è¡Œå‡½æ•°<code>.apply(this)</code> å’Œ call ç±»ä¼¼æ”¹å˜ this æŒ‡å‘çš„åŒæ—¶ä¼šæ‰§è¡Œå‡½æ•°<code>.bind(this)</code> ä»…ä»…æ”¹å˜ this</p></blockquote></li><li>éšå¼åŒ¿åå‡½æ•°è°ƒç”¨ï¼šä¸å­˜åœ¨ this æŒ‡å‘é—®é¢˜, ç®­å¤´å‡½æ•°ä¸å…³å¿ƒè°è°ƒç”¨çš„, æ°¸è¿œä¿æŒä¸å¤–éƒ¨ä½œç”¨åŸŸä¸€è‡´; ä¸éœ€è¦ä¼ é€’å‚æ•°æ—¶æ¨èä½¿ç”¨</li><li>æ˜¾å¼åŒ¿åå‡½æ•°è°ƒç”¨ï¼šä¸å­˜åœ¨ this æŒ‡å‘é—®é¢˜, æ–¹ä¾¿äº†å‚æ•°çš„ä¼ é€’, å› æ­¤æœ€ä¸ºæ¨èä½¿ç”¨</li></ol><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/202212312246099.png" alt="" /></p><h1 id="ç»„ä»¶äºŒæ¬¡å°è£…"><a class="markdownIt-Anchor" href="#ç»„ä»¶äºŒæ¬¡å°è£…"></a> ç»„ä»¶äºŒæ¬¡å°è£…</h1><p>é’ˆå¯¹ç»„ä»¶ä¸­æœ‰å›ºæœ‰å±æ€§æ—¶ä¸”è¾ƒå¤šæ—¶ï¼Œæˆ‘ä»¬å¯ä»¥è‡ªå®šä¹‰ä¸€ä¸ªä¸€èˆ¬ç»„ä»¶å®ç°å°è£…</p><p>å¦‚ NavLink ä¸­ className å±æ€§å›ºå®šï¼Œå› æ­¤å¯ä»¥è¿›è¡ŒäºŒæ¬¡å°è£…</p><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">NavLink</span></span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>list-group-item<span class="token punctuation">"</span></span> <span class="token attr-name">to</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/about<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token plain-text">About</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">NavLink</span></span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>äºŒæ¬¡å°è£…æˆ‘ä»¬å‘ä¸Šè¦ç¬¦åˆç”¨æˆ·çš„ç¼–ç¨‹ä¹ æƒ¯ï¼Œå³ä½¿ç”¨æ ‡ç­¾ä½“ä¼ é€’è¡¨æ˜åç§°ï¼Œå±æ€§ä¾æ—§é€šè¿‡ props ä¼ é€’ï¼›å‘ä¸‹è¦å¯¹æ¥å¥½åˆå§‹ç»„ä»¶</p><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">MyNavLink</span></span> <span class="token attr-name">to</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/about<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token plain-text">About</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">MyNavLink</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">MyNavLink</span></span> <span class="token attr-name">to</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/home<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token plain-text">Home</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">MyNavLink</span></span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>æ–¹ä¾¿å‘ä¸‹å¯¹æ¥çš„æ˜¯ï¼Œæ ‡ç­¾ä½“ä¸­çš„å†…å®¹å°†ä½¿ç”¨ this.props.children æ¥æ”¶ï¼Œå› æ­¤å¯ä»¥ç›´æ¥ä¼ é€’ç»™ NavLink çš„childå±æ€§ï¼Œå®ŒæˆäºŒæ¬¡å°è£…çš„ä¼˜ç§€å¯¹æ¥</p><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx"><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token punctuation">(</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">NavLink</span></span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>list-group-item<span class="token punctuation">"</span></span> <span class="token spread"><span class="token punctuation">&#123;</span><span class="token operator">...</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">&#125;</span></span> <span class="token punctuation">/></span></span>    <span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> React </category>
          
      </categories>
      
      
        <tags>
            
            <tag> react </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>02-React-jsx</title>
      <link href="/Coming-blog/2022/12/31/02-react-jsx/"/>
      <url>/Coming-blog/2022/12/31/02-react-jsx/</url>
      
        <content type="html"><![CDATA[<h1 id="jsx"><a class="markdownIt-Anchor" href="#jsx"></a> jsx</h1><p>JavaScript XML, ç”¨æ¥ç®€åŒ–åˆ›å»ºè™šæ‹Ÿ DOMï¼Œé€šè¿‡ Babel ç¼–è¯‘å™¨å°† jsx ç›¸å…³ä»£ç è½¬ä¸º React å¯è¯†åˆ«çš„ç»„ä»¶ä»£ç å½¢å¼</p><ul><li>è¡¨è¾¾å¼ï¼šjsx ä¸­åªæ”¯æŒè¡¨è¾¾å¼; ä¸€ä¸ªè¡¨è¾¾å¼ä¼šäº§ç”Ÿä¸€ä¸ªå€¼ï¼Œå¯ä»¥æ”¾åœ¨ä»»ä½•ä¸€ä¸ªéœ€è¦å€¼çš„åœ°æ–¹ï¼Œ</li></ul><h2 id="demo"><a class="markdownIt-Anchor" href="#demo"></a> Demo</h2><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx">React<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span>    type<span class="token punctuation">,</span>    <span class="token punctuation">[</span>props<span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token punctuation">[</span><span class="token operator">...</span>children<span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token keyword">import</span> ReactDOM <span class="token keyword">from</span> <span class="token string">'react-dom'</span><span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">&#123;</span>    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token punctuation">(</span>            React<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span>                <span class="token string">"div"</span><span class="token punctuation">,</span>                <span class="token punctuation">&#123;</span>                    className<span class="token operator">:</span> <span class="token string">'app'</span><span class="token punctuation">,</span>                    id<span class="token operator">:</span> <span class="token string">'appRoot'</span>                <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> React<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span>                    <span class="token string">"h1"</span><span class="token punctuation">,</span>                    <span class="token punctuation">&#123;</span> className<span class="token operator">:</span> <span class="token string">'title'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>                    <span class="token string">"æ¬¢è¿è¿›å…¥ React çš„ä¸–ç•Œ"</span>                <span class="token punctuation">)</span><span class="token punctuation">,</span>                React<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span>                    <span class="token string">"p"</span><span class="token punctuation">,</span>                    <span class="token keyword">null</span><span class="token punctuation">,</span>                    <span class="token string">"React.js æ˜¯ä¸€ä¸ªæ„å»ºé¡µé¢ UI çš„åº“"</span>                <span class="token punctuation">)</span>            <span class="token punctuation">)</span>        <span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>ReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>    <span class="token comment">// &lt;App/>,</span>    React<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span>App<span class="token punctuation">)</span><span class="token punctuation">,</span>    document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'root'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="è¯­æ³•è§„åˆ™"><a class="markdownIt-Anchor" href="#è¯­æ³•è§„åˆ™"></a> è¯­æ³•è§„åˆ™</h1><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx"><span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token string">'Hello React'</span><span class="token keyword">const</span> <span class="token constant">VDOM</span> <span class="token operator">=</span> <span class="token punctuation">(</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>title<span class="token punctuation">"</span></span> <span class="token attr-name">style</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span> <span class="token punctuation">&#123;</span>color<span class="token operator">:</span> <span class="token string">'white'</span><span class="token punctuation">,</span> backgroundColor<span class="token operator">:</span> <span class="token string">'black'</span><span class="token punctuation">,</span> fontSize<span class="token operator">:</span> <span class="token string">'60px'</span><span class="token punctuation">&#125;</span> <span class="token punctuation">&#125;</span></span><span class="token punctuation">></span></span><span class="token punctuation">&#123;</span>data<span class="token punctuation">&#125;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span><span class="token plain-text">        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">></span></span><span class="token plain-text">Hello Peiqi</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">></span></span><span class="token plain-text">        </span><span class="token punctuation">&#123;</span><span class="token comment">/*&lt;Peiqi>peiqi is a pig&lt;/Peiqi>*/</span><span class="token punctuation">&#125;</span><span class="token plain-text">    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>Tipsï¼šReact ç»„ä»¶çš„æ ·å¼å®˜æ–¹æ¨èä½¿ç”¨è¡Œå†…æ ·å¼ï¼Œæ—¨åœ¨å°†ç»„ä»¶çœ‹ä½œä¸€ä¸ªæ•´ä½“ï¼Œå¤ç”¨æ—¶åªéœ€è¦è¿ç§»ä¸€ä¸ªç»„ä»¶ä»£ç å³å¯</p><p>1ã€åˆ›å»ºè™šæ‹Ÿ DOM æ—¶ä¸è¦å†™ å¼•å·</p><p>2ã€æ ‡ç­¾ä¸­æ··å…¥ js è¡¨è¾¾å¼ä½¿ç”¨ èŠ±æ‹¬å·</p><p>3ã€æ ‡ç­¾ä¸­æ ·å¼çš„ç±»åè¦ç”¨ <code>className</code> æŒ‡å®š; <code>for</code> å…³é”®å­—è¦ç”¨ <code>htmlFor</code></p><p>4ã€æ ‡ç­¾ä¸­çš„å†…è”æ ·å¼è¦ä½¿ç”¨ js å¯¹è±¡ä¼ å…¥ - åŒå±‚èŠ±æ‹¬å·ï¼Œä½¿ç”¨å°é©¼å³°æ”¹å†™ css å˜é‡å</p><p>5ã€åªèƒ½æœ‰ä¸€ä¸ªæ ¹æ ‡ç­¾</p><p>6ã€å•æ ‡ç­¾éœ€è¦é—­åˆ <code>&lt;input type='text' /&gt;</code></p><p>7ã€æ ‡ç­¾é¦–å­—æ¯å°å†™ï¼Œé‚£ä¹ˆ React å°±ä¼šå» HTML ä¸­å¯»æ‰¾ä¸ä¹‹åŒåçš„ HTML æ ‡ç­¾ï¼›è‹¥é¦–å­—æ¯å¤§å†™ï¼Œåˆ™å¯»æ‰¾åŒåç»„ä»¶</p><p>8ã€æ³¨é‡Šéœ€è¦ä½¿ç”¨ èŠ±æ‹¬å· + js å—æ³¨é‡Š</p>]]></content>
      
      
      <categories>
          
          <category> React </category>
          
      </categories>
      
      
        <tags>
            
            <tag> jsx </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>01-React-Create React App</title>
      <link href="/Coming-blog/2022/12/31/01-react-create-react-app/"/>
      <url>/Coming-blog/2022/12/31/01-react-create-react-app/</url>
      
        <content type="html"><![CDATA[<h1 id="scaffold"><a class="markdownIt-Anchor" href="#scaffold"></a> scaffold</h1><p>è„šæ‰‹æ¶, åŸºäº WebPack, ç”¨äºå¿«é€Ÿåˆ›å»ºä¸€ä¸ªæ¨¡æ¿é¡¹ç›®, åŒ…å«äº†éœ€è¦çš„é…ç½®ï¼ˆè¯­æ³•æ£€æŸ¥, jsxç¼–è¯‘ç­‰ï¼‰, ä¸‹è½½å¥½äº†ç›¸å…³ä¾èµ–, å¯ä»¥ç›´æ¥è¿è¡Œ</p><p>æ¶æ„ï¼š<code>react webpack es6 eslint</code></p><p>ç‰¹ç‚¹ï¼šæ¨¡å—åŒ–, ç»„ä»¶åŒ–, å·¥ç¨‹åŒ–</p><h2 id="quick-start"><a class="markdownIt-Anchor" href="#quick-start"></a> Quick Start</h2><p>0ã€é…ç½®æ·˜å® npm é•œåƒ</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">npm config set registry https:&#x2F;&#x2F;registry.npm.taobao.org<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>1ã€å…¨å±€å®‰è£… <code>create-react-app</code></p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">npm i -g create-react-app<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>2ã€åˆ‡æ¢åˆ°é¡¹ç›®ç›®å½•, åˆ›å»ºé¡¹ç›®: ä¸èƒ½å«æœ‰å¤§å†™å­—æ¯</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">create-react-app 01hello-react<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ä¸»è¦å®‰è£…äº†ä¸‰æ ·ä¸œè¥¿:</p><ul><li>react: react é¡¶çº§åº“</li><li>react-dom: web ä¸Šçš„ react ä¸º react-dom</li><li>react-scripts: åŒ…å«è¿è¡Œå’Œæ‰“åŒ… react åº”ç”¨ç¨‹åºçš„æ‰€æœ‰è„šæœ¬å’Œé…ç½®</li></ul><p>3ã€å¯åŠ¨é¡¹ç›®</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">cd 01hello-reactnpm start<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/202212311830537.png" alt="" /></p><ol start="4"><li>Demo é¡µé¢</li></ol><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token keyword">import</span> ReactDOM <span class="token keyword">from</span> <span class="token string">'react-dom'</span> <span class="token comment">// å°† React ç»„å»ºæ¸²æŸ“åˆ°é¡µé¢ä¸­</span><span class="token comment">// render æ–¹æ³•å°†ç»„ä»¶æ¸²æŸ“å¹¶æ„é€  DOM æ ‘å¹¶æ’å…¥åˆ°é¡µé¢ä¸ŠæŸä¸ªç‰¹å®šçš„å…ƒç´ ä¸Š</span>ReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span><span class="token plain-text">Hello World</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span><span class="token punctuation">,</span> <span class="token comment">// ç»„ä»¶å†…å®¹, jsx è¯­æ³•ç›´æ¥æ”¯æŒ HTML çš„ç¼–å†™</span>    document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'root'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/202212311832715.png" alt="" /></p><h1 id="åŸºæœ¬æ¶æ„"><a class="markdownIt-Anchor" href="#åŸºæœ¬æ¶æ„"></a> åŸºæœ¬æ¶æ„</h1><ul><li>node_modules: æ‰€æœ‰çš„ä¾èµ–å®‰è£…çš„ç›®å½•</li><li>public: é™æ€å…¬å…±ç›®å½•<ul><li><code>public\index.html</code>: ä¸»é¡µé¢</li><li><code>public\robots.txt</code>: çˆ¬è™«åè®®æ–‡ä»¶</li></ul></li><li>src: å¼€å‘ç”¨çš„æºä»£ç ç›®å½•<ul><li><code>src\index.js</code>: å…¥å£æ–‡ä»¶</li><li><code>src\App.js</code>: æ ¹ç»„ä»¶, åç»­ç»„ä»¶éƒ½ä¸ºå…¶å­ç»„ä»¶</li><li><code>src\App.test.js</code> - æµ‹è¯• App æ¥å£ - äº†è§£å³å¯</li></ul></li><li>hooks: å®šä¹‰è‡ªå®šä¹‰çš„å‡½æ•°å¼ç»„ä»¶çš„ Hook, å®ç°å°è£…ä¸å¤ç”¨</li></ul><h2 id="package-lockjson"><a class="markdownIt-Anchor" href="#package-lockjson"></a> package-lock.json</h2><p>package.json åˆ™åªæä¾›äº†æ‰€ç”¨ä¾èµ–åŒ…çš„å¤§è‡´ç‰ˆæœ¬ä¿¡æ¯, package-lock.json åˆ™æä¾›æœ¬é¡¹ç›®æ‰€ç”¨åˆ°ä¾èµ–åŒ…çš„å…·ä½“ç‰ˆæœ¬ä¿¡æ¯ä»¥åŠä¾èµ–åŒ…çš„ä¸‹è½½åœ°å€</p><p>Applicationï¼šå› ä¸ºä¸€ä¸ªé¡¹ç›®å¤§å°±å¤§åœ¨ä¾èµ–åŒ…ï¼ˆé™æ€èµ„æºå¯ä»¥äº‘å­˜å‚¨ï¼‰, å› æ­¤é¡¹ç›®è½¬ç§»æ—¶å¯ä»¥æ”¾å¼ƒä¾èµ–åŒ…çš„è½¬ç§», åªè½¬ç§»ä»£ç ç­‰æ•°æ®æ–‡ä»¶, ç„¶åä½¿ç”¨ <code>npm i</code> è¿™ä¸ªå‘½ä»¤, é€šè¿‡è¯»å– package-lock.json å®ç°ä¾èµ–åŒ…çš„è·å–</p><h2 id="indexhtml"><a class="markdownIt-Anchor" href="#indexhtml"></a> index.html</h2><p><code>public/index.html</code>, ä¸»é¡µé¢,</p><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>X-UA-Compatible<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>IE=edge<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>viewport<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>width=device-width, initial-scale=1.0<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>stylesheet<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>./css/bootstrap.css<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>Document<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>root<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="é™æ€èµ„æº"><a class="markdownIt-Anchor" href="#é™æ€èµ„æº"></a> é™æ€èµ„æº</h2><p>public ä¸­è¿˜ä¼šæœ‰ css æ–‡ä»¶å¤¹å­˜å‚¨ä¸€äº›é™æ€çš„ css, é€šè¿‡ link æ ‡ç­¾å¯¼å…¥å³å¯ï¼ˆå› ä¸ºæˆ‘ä»¬åšçš„æ˜¯ SPA, å•é¡µé¢åº”ç”¨ï¼‰</p><p>å¯¼å…¥æ—¶è¦æ³¨æ„é™æ€æ ·å¼ä¸¢å¤±é—®é¢˜ï¼ˆå¸¸è§äºè·¯ç”±ä¸­ï¼‰å› æ­¤å¯¼å…¥æ—¶ä¸æ¨èä½¿ç”¨ç›¸å¯¹è·¯å¾„, è€Œæ˜¯ä½¿ç”¨ç›¸å¯¹äºé¡¹ç›®çš„ç»å¯¹è·¯å¾„</p><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>stylesheet<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>%PUBLIC_URL%/css/bootstrap.css<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="appjsx"><a class="markdownIt-Anchor" href="#appjsx"></a> App.jsx</h2><p><code>src/App.jsx</code>, æ ¹ç»„ä»¶, åç»­ç»„ä»¶éƒ½ä¸ºå…¶å­ç»„ä»¶</p><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx"><span class="token comment">// å¹¶éç»“æ„èµ‹å€¼, è¿™æ˜¯åœ¨æš´éœ²æ—¶é€‰æ‹©äº† åˆ†åˆ«æš´éœ²çš„å½¢å¼</span><span class="token comment">/*export default React = ....export const Component = ...*/</span><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> Component <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">&#123;</span>    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token punctuation">(</span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">                            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>        <span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="indexjs"><a class="markdownIt-Anchor" href="#indexjs"></a> index.js</h2><p><code>src/index.js</code>, å…¥å£æ–‡ä»¶, å°†æ ¹ç»„ä»¶æ¸²æŸ“åˆ°é¡µé¢</p><p>Tips: ä¸ºäº†ä¿æŒé€‚ç”¨æ€§, æ¨èä½¿ç”¨ä¸¥æ ¼æ¨¡å¼</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token keyword">import</span> ReactDOM <span class="token keyword">from</span> <span class="token string">'react-dom'</span><span class="token keyword">import</span> App <span class="token keyword">from</span> <span class="token string">'./App'</span>ReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>React<span class="token punctuation">.</span>StrictMode<span class="token operator">></span><span class="token operator">&lt;</span>App<span class="token operator">/</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>React<span class="token punctuation">.</span>StrictMode<span class="token operator">></span><span class="token punctuation">,</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'root'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="components"><a class="markdownIt-Anchor" href="#components"></a> components</h2><p><code>src/components/</code>, å„ç±»å°ç»„ä»¶, ç”± <code>index.jsx</code> ä¸ <code>index.css</code> ç»„æˆ</p><p>å¯¼å…¥æ—¶ï¼š<code>import componentsName from '.../src/components/componentName'</code></p>]]></content>
      
      
      <categories>
          
          <category> React </category>
          
      </categories>
      
      
        <tags>
            
            <tag> react </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>09-django-ModelForm</title>
      <link href="/Coming-blog/2022/12/30/09-django-modelform/"/>
      <url>/Coming-blog/2022/12/30/09-django-modelform/</url>
      
        <content type="html"><![CDATA[<h1 id="modelform"><a class="markdownIt-Anchor" href="#modelform"></a> ModelForm</h1><p>å€ŸåŠ© Model çš„å®šä¹‰å¿«é€Ÿå®ç° CRUD çš„é€»è¾‘ä»»åŠ¡</p><h2 id="quick-start"><a class="markdownIt-Anchor" href="#quick-start"></a> Quick Start</h2><ol><li>åˆ›å»ºç›®æ ‡ Model çš„ ModelForm ç±»</li></ol><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">UserModelForm</span><span class="token punctuation">(</span>forms<span class="token punctuation">.</span>ModelForm<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">class</span> <span class="token class-name">Meta</span><span class="token punctuation">:</span>        model <span class="token operator">=</span> UserInfo        fields <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">,</span> <span class="token string">'password'</span><span class="token punctuation">,</span> <span class="token string">'age'</span><span class="token punctuation">,</span> <span class="token string">'account'</span><span class="token punctuation">,</span> <span class="token string">'create_time'</span><span class="token punctuation">,</span> <span class="token string">'department'</span><span class="token punctuation">,</span> <span class="token string">'gender'</span><span class="token punctuation">]</span>        <span class="token comment"># fields = "__all__" # è¡¨ç¤ºé€‰æ‹©æ‰€æœ‰å­—æ®µ</span>        <span class="token comment"># exclude = ['create_time', ] # é»‘åå•</span>        <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span>        <span class="token keyword">for</span> name<span class="token punctuation">,</span> field <span class="token keyword">in</span> self<span class="token punctuation">.</span>fields<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            field<span class="token punctuation">.</span>widget<span class="token punctuation">.</span>attrs <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">"class"</span><span class="token punctuation">:</span> <span class="token string">"form-control"</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="2"><li>å°†å…¶ç¤ºä¾‹å¯¹è±¡ä¼ åˆ° Template ä¸­, å¹¶å¿«é€Ÿå®ç° Form çš„ç”Ÿæˆ</li></ol><pre class="line-numbers language-python" data-language="python"><code class="language-python">form <span class="token operator">=</span> UserModelForm<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">return</span> render<span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token string">'OA/user_add.html'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token string">'form'</span><span class="token punctuation">:</span> form<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ul><li>é€šè¿‡ label è·å– model ä¸­ verbose_name å±æ€§</li><li>ç›´æ¥æ¸²æŸ“å°†ä¼šæ¸²æŸ“å‡ºç­‰ä»·çš„ Form</li><li>é€šè¿‡ errors å¯ä»¥è·å–é”™è¯¯ä¿¡æ¯</li></ul><pre class="line-numbers language-html" data-language="html"><code class="language-html">&#123;% for field in form %&#125;    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>form-group<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>depart_title<span class="token punctuation">"</span></span><span class="token punctuation">></span></span> &#123;&#123; field.label &#125;&#125; <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">></span></span>        &#123;&#123; field &#125;&#125;        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value css language-css"><span class="token property">color</span><span class="token punctuation">:</span> red<span class="token punctuation">;</span></span><span class="token punctuation">"</span></span></span><span class="token punctuation">></span></span> &#123;&#123; field.errors.0 &#125;&#125; <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>&#123;% endfor %&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="3"><li>POST ä¼ é€’åå¯ä»¥ç›´æ¥é€šè¿‡ ModelForm ç±»è¿›è¡Œå®ä¾‹åŒ–, å¹¶è¿›è‡ªåŠ¨è¡Œæœ‰æ•ˆæ€§æ£€æŸ¥, æ ¹æ®æ£€æŸ¥ç»“æœè¿›è¡Œå¤„ç†</li></ol><pre class="line-numbers language-python" data-language="python"><code class="language-python">form <span class="token operator">=</span> UserModelForm<span class="token punctuation">(</span>data<span class="token operator">=</span>request<span class="token punctuation">.</span>POST<span class="token punctuation">)</span><span class="token keyword">if</span> form<span class="token punctuation">.</span>is_valid<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    form<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> redirect<span class="token punctuation">(</span><span class="token string">"OA:user_list"</span><span class="token punctuation">)</span><span class="token keyword">else</span><span class="token punctuation">:</span>    <span class="token comment"># è‡ªå¸¦é”™è¯¯ä¿¡æ¯</span>    <span class="token keyword">return</span> render<span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token string">'OA/user_add.html'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token string">'form'</span><span class="token punctuation">:</span> form<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="é™æ€æ•°æ®"><a class="markdownIt-Anchor" href="#é™æ€æ•°æ®"></a> é™æ€æ•°æ®</h2><p>æ·»åŠ æ–°æ•°æ®æ—¶æœ‰äº›æ•°æ®å¹¶éç”¨æˆ·äº¤äº’çš„, ä¾‹å¦‚åˆ›å»ºæ—¶é—´, åˆå§‹å·¥é¾„ç­‰, è¿™äº›éƒ½å¯ä»¥åœ¨åå°è®¾ç½®é»˜è®¤å€¼æ¥è¿›è¡Œå¡«å……</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">form <span class="token operator">=</span> UserModelForm<span class="token punctuation">(</span>data<span class="token operator">=</span>request<span class="token punctuation">.</span>POST<span class="token punctuation">)</span><span class="token keyword">if</span> form<span class="token punctuation">.</span>is_valid<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    form<span class="token punctuation">.</span>instance<span class="token punctuation">.</span>create_time <span class="token operator">=</span> datetime<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span>    form<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> redirect<span class="token punctuation">(</span><span class="token string">"OA:user_list"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åœ¨å‰å°å¯ä»¥é€šè¿‡ ModelForm é‡æ–°å®šä¹‰, æŒ‡å®š disabled å±æ€§ä¸º True ä½¿å¾—å…¶ä¸å¯æ›´æ”¹, æˆ–ç›´æ¥åœ¨ fields åŸŸä¸­æ’é™¤</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">mobile <span class="token operator">=</span> forms<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>disalbed<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">"æ‰‹æœºå·"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="æ•°æ®æ ¡éªŒ"><a class="markdownIt-Anchor" href="#æ•°æ®æ ¡éªŒ"></a> æ•°æ®æ ¡éªŒ</h2><p>å¦‚æœéœ€è¦è¯¦ç»†çš„æ•°æ®æ ¡éªŒæ§åˆ¶, å¯ä»¥åœ¨ ModelForm ä¸­é‡æ–°å®šä¹‰å­—æ®µçš„å®ä¾‹</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> django<span class="token punctuation">.</span>core<span class="token punctuation">.</span>validators <span class="token keyword">import</span> RegexValidatormobile <span class="token operator">=</span> forms<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>    label<span class="token operator">=</span><span class="token string">"æ‰‹æœºå·"</span><span class="token punctuation">,</span>    validators<span class="token operator">=</span><span class="token punctuation">[</span>        RegexValidator<span class="token punctuation">(</span><span class="token string">r'^1[3-9]\d&#123;9&#125;$'</span><span class="token punctuation">,</span> <span class="token string">'æ‰‹æœºå·æ ¼å¼é”™è¯¯...'</span><span class="token punctuation">)</span>    <span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æˆ–è€…é€šè¿‡ Hook æ–¹æ³•, é‡å†™ ModelForm çš„å†…éƒ¨æ ¡éªŒè¿‡ç¨‹: <code>mobile</code> ä¸ºåŸŸå</p><ul><li>å¸¸ç”¨äºå¤æ‚éªŒè¯, å¦‚æ•°æ®ä¸é‡å¤ç­‰</li><li>éªŒè¯ä¸é€šè¿‡è¿”å›é”™è¯¯æç¤º</li><li>éªŒè¯é€šè¿‡, è¿”å›ç”¨æˆ·è¾“å…¥ä¿¡æ¯</li></ul><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">clean_mobile</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>    mobile <span class="token operator">=</span> self<span class="token punctuation">.</span>cleaned_data<span class="token punctuation">[</span><span class="token string">'mobile'</span><span class="token punctuation">]</span>    <span class="token comment"># ç¼–è¾‘æ—¶è¦æ’é™¤è‡ªèº«</span>    exists_flag <span class="token operator">=</span> PrettyNum<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>mobile<span class="token operator">=</span>mobile<span class="token punctuation">)</span><span class="token punctuation">.</span>exclude<span class="token punctuation">(</span><span class="token builtin">id</span><span class="token operator">=</span>self<span class="token punctuation">.</span>instance<span class="token punctuation">.</span>pk<span class="token punctuation">)</span><span class="token punctuation">.</span>exists<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> exists_flag<span class="token punctuation">:</span>        <span class="token keyword">raise</span> ValidationError<span class="token punctuation">(</span><span class="token string">"æ‰‹æœºå·å·²å­˜åœ¨"</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> mobile<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="æ•°æ®ç¼–è¾‘"><a class="markdownIt-Anchor" href="#æ•°æ®ç¼–è¾‘"></a> æ•°æ®ç¼–è¾‘</h2><ol><li>æ ¹æ®æ•°æ®åº“å¯¹è±¡è¿›è¡Œå®ä¾‹åŒ–</li></ol><pre class="line-numbers language-python" data-language="python"><code class="language-python">form <span class="token operator">=</span> UserModelForm<span class="token punctuation">(</span>instance<span class="token operator">=</span>UserInfo<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span><span class="token builtin">id</span><span class="token operator">=</span>user_id<span class="token punctuation">)</span><span class="token punctuation">.</span>first<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">return</span> render<span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token string">'OA/user_edit.html'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token string">'form'</span><span class="token punctuation">:</span> form<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ol start="2"><li>æ¥æ”¶ form æ•°æ®æ—¶éœ€è¦æŒ‡å®šè¦æ›´æ–°çš„æ•°æ®åº“å®ä¾‹, æ‰èƒ½ä½¿ç”¨ <code>save</code> æ–¹æ³•è¿›è¡Œ<strong>æ›´æ–°æ“ä½œ</strong>è€Œéæ·»åŠ æ“ä½œ</li></ol><pre class="line-numbers language-python" data-language="python"><code class="language-python">form <span class="token operator">=</span> UserModelForm<span class="token punctuation">(</span>data<span class="token operator">=</span>request<span class="token punctuation">.</span>POST<span class="token punctuation">,</span> instance<span class="token operator">=</span>UserInfo<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span><span class="token builtin">id</span><span class="token operator">=</span>user_id<span class="token punctuation">)</span><span class="token punctuation">.</span>first<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">if</span><span class="token punctuation">(</span>form<span class="token punctuation">.</span>is_valid<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    form<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> redirect<span class="token punctuation">(</span><span class="token string">"OA:user_list"</span><span class="token punctuation">)</span><span class="token keyword">else</span><span class="token punctuation">:</span>    <span class="token keyword">return</span> render<span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token string">'OA/user_edit.html'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token string">'form'</span><span class="token punctuation">:</span> form<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> Django </category>
          
      </categories>
      
      
        <tags>
            
            <tag> python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>08-django-templates</title>
      <link href="/Coming-blog/2022/12/30/08-django-templates/"/>
      <url>/Coming-blog/2022/12/30/08-django-templates/</url>
      
        <content type="html"><![CDATA[<h1 id="templates"><a class="markdownIt-Anchor" href="#templates"></a> templates</h1><p>åœ¨æ‰€æœ‰ app ç›®å½•ä¸‹çš„ templates æ–‡ä»¶å¤¹ä¸­å¯»æ‰¾</p><ul><li><a target="_blank" rel="noopener" href="https://docs.djangoproject.com/en/4.1/topics/templates/">For more details</a></li><li>é¡¹ç›®ç›®å½•ä¸‹çš„ <code>settings.py</code> ä¸­ <code>TEMPLATES</code> åˆ—è¡¨ä¸­çš„ <code>DIRS</code> å±æ€§ä¸­å¯ä»¥é…ç½®æœç´¢æ ¹ç›®å½•: <code>os.path.join(BASE_DIR, &quot;templates&quot;)</code></li><li>å¦‚æœæ ¹ç›®å½•ä¸­æ²¡æœ‰æ‰¾åˆ°, åˆ™å†å»å„ä¸ª APP ä¸­å¯»æ‰¾</li><li>å¯»æ‰¾é¡ºåºæŒ‰ç…§ APP æ³¨å†Œçš„å…ˆå, APP å†…æ¨èç›®å½•ç»“æ„ä¸º: <code>app_name/templates/app_name/template.html</code> å³å¤šå»ºä¸€å±‚ä»¥ APP å‘½åçš„ç›®å½•, ä»¥å£°æ˜ template æ–‡ä»¶çš„å‘½åç©ºé—´</li></ul><h2 id="ä¼ ç»Ÿæ¸²æŸ“æ–¹å¼"><a class="markdownIt-Anchor" href="#ä¼ ç»Ÿæ¸²æŸ“æ–¹å¼"></a> ä¼ ç»Ÿæ¸²æŸ“æ–¹å¼</h2><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> django<span class="token punctuation">.</span>template <span class="token keyword">import</span> loader<span class="token keyword">from</span> <span class="token punctuation">.</span>models <span class="token keyword">import</span> Question<span class="token keyword">def</span> <span class="token function">index</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>    latest_question_list <span class="token operator">=</span> Question<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>order_by<span class="token punctuation">(</span><span class="token string">'-pub_date'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">]</span>    template <span class="token operator">=</span> loader<span class="token punctuation">.</span>get_template<span class="token punctuation">(</span><span class="token string">"polls/index.html"</span><span class="token punctuation">)</span>    context <span class="token operator">=</span> <span class="token punctuation">&#123;</span>        <span class="token string">"latest_question_list"</span><span class="token punctuation">:</span> latest_question_list<span class="token punctuation">,</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">return</span> HttpResponse<span class="token punctuation">(</span>template<span class="token punctuation">.</span>render<span class="token punctuation">(</span>context<span class="token punctuation">,</span> request<span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="å¿«é€Ÿæ¸²æŸ“æ–¹å¼"><a class="markdownIt-Anchor" href="#å¿«é€Ÿæ¸²æŸ“æ–¹å¼"></a> å¿«é€Ÿæ¸²æŸ“æ–¹å¼</h2><p>ä½¿ç”¨ <code>django.shortcuts</code> çš„ <code>render</code> å®ç°æ¨¡æ¿çš„å¿«é€Ÿæ¸²æŸ“å‘½ä»¤</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> django<span class="token punctuation">.</span>shortcuts <span class="token keyword">import</span> render<span class="token keyword">def</span> <span class="token function">index</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>    latest_question_list <span class="token operator">=</span> Question<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>order_by<span class="token punctuation">(</span><span class="token string">'-pub_date'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">]</span>    context <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token string">"latest_question_list"</span><span class="token punctuation">:</span> latest_question_list<span class="token punctuation">&#125;</span>    <span class="token keyword">return</span> render<span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token string">"polls/index.html"</span><span class="token punctuation">,</span> context<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="æ¨¡æ¿è¯­æ³•"><a class="markdownIt-Anchor" href="#æ¨¡æ¿è¯­æ³•"></a> æ¨¡æ¿è¯­æ³•</h1><ul><li>å˜é‡å€¼: <code>&#123;&#123; var &#125;&#125;</code></li><li>æ•°ç»„ç´¢å¼•: <code>&#123;&#123; arr.index &#125;&#125;</code></li><li>å­—å…¸å±æ€§: <code>&#123;&#123; dict.key &#125;&#125;</code></li><li>æ—¥æœŸ: <code>&#123;&#123; user.create_time | date:"Y-m-d H:i:s" &#125;&#125;</code></li></ul><h2 id="å¾ªç¯"><a class="markdownIt-Anchor" href="#å¾ªç¯"></a> å¾ªç¯</h2><ul><li>æ•°ç»„å¾ªç¯:</li></ul><pre class="line-numbers language-html" data-language="html"><code class="language-html">&#123;% for item in arr %&#125;    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">></span></span>&#123;&#123; item &#125;&#125;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span>&#123;% endfor %&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><ul><li>å­—å…¸å¾ªç¯: åŒ python, <code>dict.keys, dict.values, dict.items</code>, å°±æ˜¯ä¸ç”¨åŠ æ‹¬å·äº†</li></ul><pre class="line-numbers language-html" data-language="html"><code class="language-html">&#123;% for key, value in dict.items %&#125;    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">></span></span>&#123;&#123; item &#125;&#125;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span>&#123;% endfor %&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h2 id="æ¡ä»¶"><a class="markdownIt-Anchor" href="#æ¡ä»¶"></a> æ¡ä»¶</h2><ul><li>if [elif] else</li></ul><pre class="line-numbers language-html" data-language="html"><code class="language-html">&#123;% if name == "admin" %&#125;    pass&#123;% elif name == "user" %&#125;    pass&#123;% else %&#125;    pass&#123;% endif %&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="æ¨¡æ¿ç»§æ‰¿"><a class="markdownIt-Anchor" href="#æ¨¡æ¿ç»§æ‰¿"></a> æ¨¡æ¿ç»§æ‰¿</h2><ul><li>æ ¹æ¨¡æ¿ä¸­: é…ç½®å¥½å ä½ç¬¦</li></ul><pre class="line-numbers language-html" data-language="html"><code class="language-html">&#123;% block content %&#125;&#123;% endblock %&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>å­æ¨¡æ¿ä¸­: ç»§æ‰¿æ ¹æ¨¡æ¿+ å¡«å……å ä½ç¬¦</li></ul><pre class="line-numbers language-html" data-language="html"><code class="language-html">&#123;% extends 'OA/layout.html' %&#125;...&#123;% block content %&#125;...&#123;% endblock %&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="é™æ€æ–‡ä»¶å¼•å…¥"><a class="markdownIt-Anchor" href="#é™æ€æ–‡ä»¶å¼•å…¥"></a> é™æ€æ–‡ä»¶å¼•å…¥</h2><p>django å°†é™æ€æ–‡ä»¶æ”¾ç½®å† <code>app</code> ä¸‹çš„ <code>static</code> ç›®å½•ä¸‹ç»Ÿä¸€ç®¡ç†(é…ç½®æ–‡ä»¶ä¸­ç®¡ç†), å†…éƒ¨ç”¨æˆ·å†è‡ªè¡Œåˆ›å»ºæ–‡ä»¶å¤¹è¿›è¡Œè§„æ•´</p><pre class="line-numbers language-html" data-language="html"><code class="language-html">&#123;% load static %&#125;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>stylesheet<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>&#123;% static <span class="token punctuation">'</span>plugins/bootstrap-4.3.1-dist/css/bootstrap.css<span class="token punctuation">'</span> %&#125;<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://cdn.staticfile.org/jquery/2.1.1/jquery.min.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>&#123;% static <span class="token punctuation">'</span>plugins/bootstrap-4.3.1-dist/js/bootstrap.js<span class="token punctuation">'</span> %&#125;<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/202212052248658.png" alt="" /></p><h2 id="éç¡¬ç¼–ç -url"><a class="markdownIt-Anchor" href="#éç¡¬ç¼–ç -url"></a> éç¡¬ç¼–ç  URL</h2><p>åœ¨ urlpattern ä¸­é…ç½®çš„ name å±æ€§, å°±å¯ä»¥ç”¨åœ¨æ¨¡æ¿è¯­æ³•ä¸­ç”¨äºç´¢å¼•æƒ³è¦è·³è½¬çš„ url, è€Œä¸å¿…å†ç”¨æ‹¼æ¥çš„å½¢å¼, å¦‚ <code>&lt;a href=&quot;/polls/&#123;&#123; question.id &#125;&#125;/&quot;&gt;</code></p><p>æ¨¡æ¿æ ‡ç­¾ä¸º <code>&#123;% url %&#125;</code> ä»¥ç©ºæ ¼ä¸ºåˆ†éš”ç¬¦, ç¬¬ä¸€ä¸ªå‚æ•°è¡¨ç¤ºç›®æ ‡ url çš„ name, åç»­å‚æ•°ä¸ºå‚æ•°åˆ—è¡¨</p><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>&#123;% url <span class="token punctuation">'</span>detail<span class="token punctuation">'</span> question.id %&#125;<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>&#123;&#123; question.question_text &#125;&#125;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å¦‚æœè¦ä¼ é€’ GET å‚æ•°åˆ™åœ¨æ¨¡æ¿åé¢æ‹¼æ¥å³å¯</p><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>&#123;% url <span class="token punctuation">'</span>OA:depart_delete<span class="token punctuation">'</span> %&#125;?depart_id=&#123;&#123;depart.id&#125;&#125;<span class="token punctuation">"</span></span> <span class="token punctuation">></span></span>åˆ é™¤<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> Django </category>
          
      </categories>
      
      
        <tags>
            
            <tag> python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>07-django-orm</title>
      <link href="/Coming-blog/2022/12/30/07-django-orm/"/>
      <url>/Coming-blog/2022/12/30/07-django-orm/</url>
      
        <content type="html"><![CDATA[<h1 id="orm"><a class="markdownIt-Anchor" href="#orm"></a> ORM</h1><p>å°†æ•°æ®æ¨¡å‹çš„ç›¸å…³æ“ä½œç¿»è¯‘ä¸ºç›®æ ‡æ•°æ®åº“è¯­å¥çš„æ¡†æ¶</p><ul><li>åˆ›å»ºã€ä¿®æ”¹ã€åˆ é™¤æ•°æ®åº“ä¸­çš„è¡¨</li><li>æ“ä½œè¡¨ä¸­çš„æ•°æ®: å¢åˆ æ”¹æŸ¥</li></ul><h2 id="åˆ›å»ºè¡¨"><a class="markdownIt-Anchor" href="#åˆ›å»ºè¡¨"></a> åˆ›å»ºè¡¨</h2><p>éå†æ³¨å†Œçš„ APP é’ˆå¯¹ APP çš„ <a target="_blank" rel="noopener" href="http://models.py">models.py</a> è¿›è¡Œç¿»è¯‘ä¸æ‰§è¡Œ</p><ol><li>å®ç° APP çš„æ³¨å†Œ</li><li><code>python manage.py makemigrations</code></li><li><code>python manage.py migrate</code></li></ol><h1 id="models"><a class="markdownIt-Anchor" href="#models"></a> Models</h1><p>ç»§æ‰¿ <code>django.db.models.Model</code> å³å¯åˆ›å»ºæ•°æ®æ¨¡å‹</p><h2 id="types"><a class="markdownIt-Anchor" href="#types"></a> Types</h2><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> django<span class="token punctuation">.</span>db <span class="token keyword">import</span> modelsname <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">32</span><span class="token punctuation">)</span>age <span class="token operator">=</span> models<span class="token punctuation">.</span>IntegerField<span class="token punctuation">(</span>default<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>content <span class="token operator">=</span> models<span class="token punctuation">.</span>IntegerField<span class="token punctuation">(</span>null<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> blank<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span> <span class="token comment"># è¡¨ç¤ºè¯¥å€¼å¯ä»¥ä¸ºç©º</span>department <span class="token operator">=</span> models<span class="token punctuation">.</span>ForeignKey<span class="token punctuation">(</span>to<span class="token operator">=</span><span class="token string">"Department"</span><span class="token punctuation">,</span> to_field<span class="token operator">=</span><span class="token string">"id"</span><span class="token punctuation">,</span> on_delete<span class="token operator">=</span>models<span class="token punctuation">.</span>CASCADE<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>å¤–é”®åœ¨ä½¿ç”¨æ—¶å¯ä»¥å¼•ç”¨å…¶æ‰€å¼•ç”¨çš„ä¸€è¡Œæ•°æ®, å› æ­¤åœ¨åšå±•ç¤ºæ—¶å¯ä»¥ä½¿ç”¨ <code>user.department.title</code> è·å–å…¶å†…éƒ¨å±æ€§</li></ul><h2 id="crud"><a class="markdownIt-Anchor" href="#crud"></a> CRUD</h2><ul><li>Model.objects.create(**value_dict)</li><li>Model.objects.filter(id=1).first().name</li><li>Model.objects.all().update(password=666)</li><li>Model.objects.all().delete()</li><li>Model.objects.all().order_by('-field_name')</li><li>Model.objects.filter(id__gt=12) # å¤§äº</li><li>Model.objects.filter(id__gte=12) # å¤§äºç­‰äº</li><li>Model.objects.filter(id__lt=12) # å°äº</li><li>Model.objects.filter(id__lte=12) # å°äºç­‰äº</li><li>Model.objects.filter(content__startswith=&quot;abc&quot;) # ä»¥ abc å¼€å¤´</li><li>Model.objects.filter(content__endswith=&quot;abc&quot;) # ä»¥ abc ç»“å°¾</li><li>Model.objects.filter(content__contains=&quot;abc&quot;) # åŒ…å« abc</li><li></li></ul><h1 id="databases"><a class="markdownIt-Anchor" href="#databases"></a> Databases</h1><p>By default, the configuration uses SQLite which is included in Python.</p><ul><li>Want <a target="_blank" rel="noopener" href="https://docs.djangoproject.com/en/4.1/topics/install/#database-installation">other database</a></li></ul><p>å…¶é…ç½®ä¿¡æ¯åœ¨ <a target="_blank" rel="noopener" href="http://settings.py">settings.py</a> ä¸­è¿›è¡Œé…ç½®</p><h2 id="sqlite"><a class="markdownIt-Anchor" href="#sqlite"></a> sqlite</h2><ul><li>ENGINE: é€‰æ‹©æ•°æ®åº“å¼•æ“</li><li>NAME: è®¾å®šæ•°æ®åº“åç§°(åœ°å€)</li></ul><pre class="line-numbers language-python" data-language="python"><code class="language-python">DATABASES <span class="token operator">=</span> <span class="token punctuation">&#123;</span>    <span class="token string">"default"</span><span class="token punctuation">:</span> <span class="token punctuation">&#123;</span>        <span class="token string">"ENGINE"</span><span class="token punctuation">:</span> <span class="token string">"django.db.backends.sqlite3"</span><span class="token punctuation">,</span>        <span class="token string">"NAME"</span><span class="token punctuation">:</span> BASE_DIR <span class="token operator">/</span> <span class="token string">"db.sqlite3"</span><span class="token punctuation">,</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="mysql"><a class="markdownIt-Anchor" href="#mysql"></a> Mysql</h2><ol><li>å®‰è£… mysqlclient: <code>pip install mysqlclient</code></li><li><a target="_blank" rel="noopener" href="http://settings.py">settings.py</a> ä¸­é…ç½® mysql æ•°æ®åº“çš„è¿æ¥</li></ol><pre class="line-numbers language-python" data-language="python"><code class="language-python">DATABASES <span class="token operator">=</span> <span class="token punctuation">&#123;</span>    <span class="token string">'default'</span><span class="token punctuation">:</span> <span class="token punctuation">&#123;</span>        <span class="token string">'ENGINE'</span><span class="token punctuation">:</span> <span class="token string">'django.db.backends.mysql'</span><span class="token punctuation">,</span>        <span class="token string">'NAME'</span><span class="token punctuation">:</span> <span class="token string">'dbname'</span><span class="token punctuation">,</span>        <span class="token string">'USER'</span><span class="token punctuation">:</span> <span class="token string">'root'</span><span class="token punctuation">,</span>        <span class="token string">'PASSWORD'</span><span class="token punctuation">:</span> <span class="token string">'pwd'</span><span class="token punctuation">,</span>        <span class="token string">'HOST'</span><span class="token punctuation">:</span> <span class="token string">'127.0.0.1'</span><span class="token punctuation">,</span>        <span class="token string">'PORT'</span><span class="token punctuation">:</span> <span class="token number">3306</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> Django </category>
          
      </categories>
      
      
        <tags>
            
            <tag> python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>06-django-request</title>
      <link href="/Coming-blog/2022/12/30/06-django-request/"/>
      <url>/Coming-blog/2022/12/30/06-django-request/</url>
      
        <content type="html"><![CDATA[<h1 id="request"><a class="markdownIt-Anchor" href="#request"></a> Request</h1><ul><li>request.method: è·å–è¯·æ±‚æ–¹å¼</li><li>request.GET: è·å– GET è¯·æ±‚çš„å‚æ•°</li><li>request.POST: è·å– POST è¯·æ±‚çš„å‚æ•°</li></ul><h1 id="get-post"><a class="markdownIt-Anchor" href="#get-post"></a> GET &amp; POST</h1><p>POST è¯·æ±‚é€šå¸¸ç”¨äºå®ç°å¯¹åå°æ•°æ®åº“æ•°æ®çš„æ›´æ”¹, ä¸€æ—¦æ›´æ”¹å®Œæ¯•, ä¾¿é€šå¸¸ä»¥ä¸€ä¸ª redirect çš„å½¢å¼è¿”å›åˆ°ç›®æ ‡é¡µé¢</p><blockquote><p>Whenever you create a form that alters data server-side, use method=&quot;post&quot;.As the Python comment above points out, you should always return an HttpResponseRedirect after successfully dealing with POST data.</p></blockquote><h2 id="post-request"><a class="markdownIt-Anchor" href="#post-request"></a> Post Request</h2><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>&#123;% url <span class="token punctuation">'</span>polls:vote<span class="token punctuation">'</span> question.id %&#125;<span class="token punctuation">"</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>post<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    &#123;% comment %&#125; In short, all POST forms that are targeted at internal URLs should use the &#123;% csrf_token %&#125; template tag. &#123;% endcomment %&#125;    &#123;% csrf_token %&#125;    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fieldset</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>legend</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span>&#123;&#123; question.question_text &#125;&#125;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>legend</span><span class="token punctuation">></span></span>        &#123;% if error_message %&#125;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>strong</span><span class="token punctuation">></span></span>&#123;&#123; error_message &#125;&#125;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>strong</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>&#123;% endif %&#125;        &#123;% for choice in question.choice_set.all %&#125;            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>radio<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>choice<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>choice&#123;&#123; forloop.counter &#125;&#125;<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>&#123;&#123; choice.id &#125;&#125;<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>choice&#123;&#123; forloop.counter &#125;&#125;<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>&#123;&#123; choice.choice_text &#125;&#125;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">></span></span>        &#123;% endfor %&#125;    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>fieldset</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>submit<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Vote<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>é€šè¿‡ Form å®ç° Post è¯·æ±‚:</p><ul><li>action æ”¯æŒéç¡¬ç¼–ç  url; action é»˜è®¤å°†è¯·æ±‚ä¼ ç»™å½“å‰ url;</li><li>input æ ‡ç­¾ä¸­çš„ name å±æ€§ä¸º POST çš„é”®å, value å±æ€§ä¸º POST çš„é”®å€¼</li><li>label æ ‡ç­¾çš„æŒ‡å‘, æ›´äººæ€§åŒ–çš„é€‰å–</li><li>csrf é˜²æ­¢è·¨ç«™è¯·æ±‚ä¼ªé€ </li></ul><h3 id="csrf-é˜²æ­¢è·¨ç«™è¯·æ±‚ä¼ªé€ "><a class="markdownIt-Anchor" href="#csrf-é˜²æ­¢è·¨ç«™è¯·æ±‚ä¼ªé€ "></a> csrf é˜²æ­¢è·¨ç«™è¯·æ±‚ä¼ªé€ </h3><p>POST è¯·æ±‚æ—¶ä¼šè‡ªåŠ¨ä¼ é€’ <code>csrfmiddlewaretoken</code> è¿™ä¸ªå‚æ•°, ç”Ÿå­˜æœŸä»…ä¸€æ¬¡</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/202212121308095.png" alt="" /></p><p>å¦‚æœä½¿ç”¨å…¶å®ƒå·¥å…·ç›´æ¥é‡ç°è¯·æ±‚: å¦‚ Postman, ç›´æ¥å¤±è´¥</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/202212121310718.png" alt="" /></p><h2 id="post-redirect"><a class="markdownIt-Anchor" href="#post-redirect"></a> Post Redirect</h2><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">vote</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> pk<span class="token punctuation">)</span><span class="token punctuation">:</span>    question <span class="token operator">=</span> get_object_or_404<span class="token punctuation">(</span>Question<span class="token punctuation">,</span> pk<span class="token operator">=</span>pk<span class="token punctuation">)</span>    <span class="token keyword">try</span><span class="token punctuation">:</span>        selected_choice <span class="token operator">=</span> question<span class="token punctuation">.</span>choice_set<span class="token punctuation">.</span>get<span class="token punctuation">(</span>pk<span class="token operator">=</span>request<span class="token punctuation">.</span>POST<span class="token punctuation">[</span><span class="token string">'choice'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token keyword">except</span> <span class="token punctuation">(</span>KeyError<span class="token punctuation">,</span> Choice<span class="token punctuation">.</span>DoesNotExist<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> render<span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token string">'polls/detail.html'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>            <span class="token string">'question'</span><span class="token punctuation">:</span> question<span class="token punctuation">,</span>            <span class="token string">'error_message'</span><span class="token punctuation">:</span> <span class="token string">"You didn't select a choice."</span><span class="token punctuation">,</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>    <span class="token keyword">else</span><span class="token punctuation">:</span>        selected_choice<span class="token punctuation">.</span>votes <span class="token operator">+=</span> <span class="token number">1</span>        selected_choice<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token comment"># reverse function helps avoid having to hardcode a URL in the view function.</span>        <span class="token keyword">return</span> HttpResponseRedirect<span class="token punctuation">(</span>reverse<span class="token punctuation">(</span><span class="token string">'polls:results'</span><span class="token punctuation">,</span> args<span class="token operator">=</span><span class="token punctuation">(</span>question<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>æ³¨æ„åå°å¤„ç†ä¸­æ•°æ®åº“æ•°æ®çš„ selected_choice å¹¶æ²¡æœ‰æ·»åŠ äº’æ–¥æ‰€, å¤šä¸ªç”¨æˆ·åŒæ—¶è¯·æ±‚æ›´æ–°è¿™ä¸ªæ•°æ®æ—¶å¯èƒ½ä¼šå‡ºç°é”™è¯¯, <a target="_blank" rel="noopener" href="https://docs.djangoproject.com/en/4.1/ref/models/expressions/#avoiding-race-conditions-using-f">è§£å†³æ–¹æ¡ˆ</a>åç»­æ›´æ–°...</li><li>reverse å‡½æ•°è§£å†³äº†ç›®æ ‡ url çš„ç¡¬ç¼–ç é—®é¢˜; å½“ç„¶å¯ä»¥ç›´æ¥ä½¿ç”¨ <code>django.shortcuts.redirect</code></li></ul>]]></content>
      
      
      <categories>
          
          <category> Django </category>
          
      </categories>
      
      
        <tags>
            
            <tag> python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>05-django-admin</title>
      <link href="/Coming-blog/2022/12/12/05-django-admin/"/>
      <url>/Coming-blog/2022/12/12/05-django-admin/</url>
      
        <content type="html"><![CDATA[<h1 id="admin"><a class="markdownIt-Anchor" href="#admin"></a> Admin</h1><p>Django è‡ªåŠ¨ç”Ÿæˆåå°çš„åŠŸèƒ½ååˆ†æ–¹ä¾¿</p><ol><li>åˆ›å»ºå¯ä»¥è®¿é—®ç®¡ç†ç½‘é¡µçš„ç”¨æˆ·: <code>python manage.py createsuperuser</code></li><li>å¯åŠ¨æœåŠ¡, è¿›å…¥ admin ç•Œé¢</li></ol><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/202212071825556.png" alt="" /></p><ol start="3"><li>é»˜è®¤åªå­˜åœ¨å¯¹ç”¨æˆ·ç»„å’Œç”¨æˆ·çš„ç®¡ç†, å› æ­¤éœ€è¦å¼•å…¥æˆ‘ä»¬åˆ›å»ºçš„æ•°æ®æ¨¡å‹çš„ç®¡ç†: åœ¨ app çš„ <a target="_blank" rel="noopener" href="http://admin.py">admin.py</a> ä¸­å®ç°å¼•å…¥</li></ol><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> <span class="token punctuation">.</span>models <span class="token keyword">import</span> Questionadmin<span class="token punctuation">.</span>site<span class="token punctuation">.</span>register<span class="token punctuation">(</span>Question<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/202212071829788.png" alt="" /></p><h1 id="è‡ªå®šä¹‰åå°è¡¨å•"><a class="markdownIt-Anchor" href="#è‡ªå®šä¹‰åå°è¡¨å•"></a> è‡ªå®šä¹‰åå°è¡¨å•</h1><p>åˆå§‹çš„åå°å¯æ§æ•°æ®ååˆ†å°‘, å¯ä»¥é€šè¿‡ä¿®æ”¹ APP ç›®å½•ä¸‹çš„ <a target="_blank" rel="noopener" href="http://admin.py">admin.py</a> è¿›è¡Œç²¾ç»†åŒ–æ§åˆ¶</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> django<span class="token punctuation">.</span>contrib <span class="token keyword">import</span> admin<span class="token keyword">from</span> <span class="token punctuation">.</span>models <span class="token keyword">import</span> Question<span class="token punctuation">,</span> Choice<span class="token keyword">class</span> <span class="token class-name">QuestionAdmin</span><span class="token punctuation">(</span>admin<span class="token punctuation">.</span>ModelAdmin<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token comment"># fields = ['pub_date', 'question_text']</span>    fields <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'question_text'</span><span class="token punctuation">,</span> <span class="token punctuation">]</span>admin<span class="token punctuation">.</span>site<span class="token punctuation">.</span>register<span class="token punctuation">(</span>Question<span class="token punctuation">,</span> QuestionAdmin<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>é»˜è®¤ä½¿ç”¨ <code>admin.site.register</code> æ³¨å†Œ Question æ—¶ä¼šå±•ç¤ºæ‰€æœ‰çš„åŸŸ</li><li>å¯ä»¥é€šè¿‡ç»§æ‰¿ <code>admin.ModelAdmin</code> ç”¨ <code>fields</code> å±æ€§å¯¹å±•ç¤ºçš„æ•°æ®åŸŸè¿›è¡Œç²¾ç»†åŒ–æ§åˆ¶</li></ul><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/202212121758371.png" alt="" /></p><h2 id="å…¶å®ƒå±•ç¤ºæ§åˆ¶"><a class="markdownIt-Anchor" href="#å…¶å®ƒå±•ç¤ºæ§åˆ¶"></a> å…¶å®ƒå±•ç¤ºæ§åˆ¶</h2><h3 id="list_display"><a class="markdownIt-Anchor" href="#list_display"></a> list_display</h3><p>æ§åˆ¶å¯¹è±¡åœ¨ä»¥åˆ—è¡¨çŠ¶æ€å±•ç¤ºæ—¶å±•ç¤ºçš„æ•°æ®åŸŸ</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">QuestionAdmin</span><span class="token punctuation">(</span>admin<span class="token punctuation">.</span>ModelAdmin<span class="token punctuation">)</span><span class="token punctuation">:</span>    list_display <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">'question_text'</span><span class="token punctuation">,</span> <span class="token string">'pub_date'</span><span class="token punctuation">,</span> <span class="token string">'was_published_recently'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/202212121814795.png" alt="" /></p><h3 id="æ•°æ®åŸŸæ§åˆ¶"><a class="markdownIt-Anchor" href="#æ•°æ®åŸŸæ§åˆ¶"></a> æ•°æ®åŸŸæ§åˆ¶</h3><p>æƒ³è¦å¯¹æŸä¸ª<a target="_blank" rel="noopener" href="https://docs.djangoproject.com/zh-hans/4.1/ref/contrib/admin/#django.contrib.admin.ModelAdmin.list_display">æ•°æ®ä¸è¿›è¡Œç²¾ç»†çš„æ§åˆ¶</a>, å¯ä»¥åœ¨å®šä¹‰æ•°æ®æ¨¡å‹æ—¶å¯¹ç›®æ ‡åŸŸæ·»åŠ ä¿®é¥°å™¨</p><ul><li>boolean è¡¨ç¤ºè¯¥æ•°æ®åŸŸä¸ºå¸ƒå°”ç±»å‹, ä»¥åº”ç”¨å¸ƒå°”æ•°æ®çš„å±•ç¤ºæ–¹å¼</li><li>ordering è¡¨ç¤ºè¯¥æ•°æ®åŸŸçš„æ’åºä¾èµ–äº pub_date æ•°æ®åŸŸ</li><li>description è¡¨ç¤ºè¯¥æ•°æ®åŸŸçš„åˆ—å</li></ul><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token decorator annotation punctuation">@admin<span class="token punctuation">.</span>display</span><span class="token punctuation">(</span>    boolean<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>    ordering<span class="token operator">=</span><span class="token string">'pub_date'</span><span class="token punctuation">,</span>    description<span class="token operator">=</span><span class="token string">'Published recently?'</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">was_published_recently</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>    now <span class="token operator">=</span> timezone<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> now <span class="token operator">-</span> datetime<span class="token punctuation">.</span>timedelta<span class="token punctuation">(</span>days<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> self<span class="token punctuation">.</span>pub_date <span class="token operator">&lt;=</span> now<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/202212121821518.png" alt="" /></p><h3 id="list_filter"><a class="markdownIt-Anchor" href="#list_filter"></a> list_filter</h3><p>list_filter åˆ—è¡¨ä¸­çš„å±æ€§å°†æ”¯æŒæ›´åŠ ä¸°å¯Œçš„è¿‡æ»¤è§„åˆ™æ”¯æŒ</p><ul><li>Tips: åªæ”¯æŒæ•°æ®åº“ä¸­å­˜åœ¨çš„åŸŸå“¦, ä¸æ”¯æŒ was_published_recently è¿™ç§â€œå‡½æ•°åŸŸâ€</li></ul><pre class="line-numbers language-python" data-language="python"><code class="language-python">list_filter <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'pub_date'</span><span class="token punctuation">,</span> <span class="token string">'question_text'</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/202212121828986.png" alt="" /></p><h3 id="search_fields"><a class="markdownIt-Anchor" href="#search_fields"></a> search_fields</h3><p>search_fields æ”¯æŒæœç´¢æ¡†çš„ç´¢å¼•: <code>search_fields = ['question_text']</code></p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/202212121830263.png" alt="" /></p><h2 id="åˆ’åˆ†å­—æ®µé›†"><a class="markdownIt-Anchor" href="#åˆ’åˆ†å­—æ®µé›†"></a> åˆ’åˆ†å­—æ®µé›†</h2><p>å½“ Model æ‹¥æœ‰è¾ƒå¤šå­—æ®µæ—¶, å¯ä»¥é€šè¿‡ ModelAdmin ä¸­çš„ filedsets è¿›è¡Œå­—æ®µé›†çš„åˆ’åˆ†</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">QuestionAdmin</span><span class="token punctuation">(</span>admin<span class="token punctuation">.</span>ModelAdmin<span class="token punctuation">)</span><span class="token punctuation">:</span>    fieldsets <span class="token operator">=</span> <span class="token punctuation">[</span>        <span class="token punctuation">(</span><span class="token boolean">None</span><span class="token punctuation">,</span>               <span class="token punctuation">&#123;</span><span class="token string">'fields'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'question_text'</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token punctuation">(</span><span class="token string">'Date information'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token string">'fields'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'pub_date'</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token punctuation">]</span>admin<span class="token punctuation">.</span>site<span class="token punctuation">.</span>register<span class="token punctuation">(</span>Question<span class="token punctuation">,</span> QuestionAdmin<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/202212121758119.png" alt="" /></p><h2 id="æ·»åŠ å…³è”å¯¹è±¡"><a class="markdownIt-Anchor" href="#æ·»åŠ å…³è”å¯¹è±¡"></a> æ·»åŠ å…³è”å¯¹è±¡</h2><p>å¸¸è§çš„å°±æ˜¯ä½œä¸ºå¤–é”®, å¯ä»¥æ·»åŠ å…¶å¯¹å¦ä¸€ Model çš„å¼•ç”¨</p><ol><li>é…ç½®å…³è”çš„ç›®æ ‡å¯¹è±¡: æŒ‡å®šå…¶æ•°æ®æ¨¡å‹, <code>extra</code> å±æ€§è¡¨ç¤ºç©ºæ•°æ®ç•™ç™½, ä¾›åˆ›å»ºæ–°çš„å…³è”å¯¹è±¡</li></ol><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># admin.StackedInline: æ ˆç±»ä¼¼çš„æ’åˆ—å±•ç°, è¾ƒå ç©ºé—´</span><span class="token comment"># admin.TabularInline: è¡¨æ ¼å¼çš„å•è¡Œæ˜¾ç¤º</span><span class="token keyword">class</span> <span class="token class-name">ChoiceInline</span><span class="token punctuation">(</span>admin<span class="token punctuation">.</span>StackedInline<span class="token punctuation">)</span><span class="token punctuation">:</span>    model <span class="token operator">=</span> Choice    extra <span class="token operator">=</span> <span class="token number">1</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="2"><li>å°†ç›®æ ‡å¯¹è±¡åœ¨ä¸»å¯¹è±¡ä¸­ä½¿ç”¨ inlines å±æ€§å…³è”</li></ol><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">QuestionAdmin</span><span class="token punctuation">(</span>admin<span class="token punctuation">.</span>ModelAdmin<span class="token punctuation">)</span><span class="token punctuation">:</span>    fieldsets <span class="token operator">=</span> <span class="token punctuation">[</span>        <span class="token punctuation">(</span><span class="token boolean">None</span><span class="token punctuation">,</span>               <span class="token punctuation">&#123;</span><span class="token string">'fields'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'question_text'</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token punctuation">(</span><span class="token string">'Date information'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token string">'fields'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'pub_date'</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token punctuation">]</span>    inlines <span class="token operator">=</span> <span class="token punctuation">[</span>ChoiceInline<span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/202212121806254.png" alt="" /></p><ul><li>admin.TabularInline: è¡¨æ ¼å¼çš„å•è¡Œæ˜¾ç¤º</li></ul><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/202212121809641.png" alt="" /></p><h1 id="ä¿®æ”¹-admin-æ¨¡æ¿"><a class="markdownIt-Anchor" href="#ä¿®æ”¹-admin-æ¨¡æ¿"></a> ä¿®æ”¹ Admin æ¨¡æ¿</h1><h2 id="quick-start"><a class="markdownIt-Anchor" href="#quick-start"></a> Quick Start</h2><ol><li>ä¿®æ”¹æ ¹ç›®å½• <code>settings.py</code> ä¸º <code>TEMPLATES</code> çš„ <code>DIRS</code> å±æ€§æ·»åŠ æœ¬åœ°æœç´¢è·¯å¾„ <code>&quot;DIRS&quot;: [BASE_DIR / 'templates'],</code></li><li>åœ¨æ ¹ç›®å½•åˆ›å»º <code>templatex/admin/</code> ç›®å½•</li><li>å°†ä½äº <code>django/contrib/admin/templates</code> å†…çš„åŸå§‹æ¨¡æ¿æ–‡ä»¶ <code>base_site.html</code> å¤åˆ¶åˆ°è¿™ä¸ªç›®å½•</li><li>ä¿®æ”¹æœ¬åœ°çš„ <code>base_site.html</code> å³å¯</li></ol><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/202212121840630.png" alt="" /></p><h1 id="refs"><a class="markdownIt-Anchor" href="#refs"></a> Refs</h1><ul><li><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1S44y1K7Hd/?vd_source=b982c5b9804c7552564e69b7b5d8a2e0">Bilibili</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Django </category>
          
      </categories>
      
      
        <tags>
            
            <tag> python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>04-django-static</title>
      <link href="/Coming-blog/2022/12/12/04-django-static/"/>
      <url>/Coming-blog/2022/12/12/04-django-static/</url>
      
        <content type="html"><![CDATA[<h1 id="static-files"><a class="markdownIt-Anchor" href="#static-files"></a> Static Files</h1><h2 id="quick-start"><a class="markdownIt-Anchor" href="#quick-start"></a> Quick Start</h2><ol><li>åœ¨ APP ç›®å½•ä¸‹åˆ›å»º static ç›®å½•</li><li>ä¸ºäº†åœ¨å¼•ç”¨æ—¶åŒºåˆ† APP åœ¨ static ç›®å½•ä¸‹å†åˆ›å»ºåä¸º APP çš„ç›®å½•</li></ol><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/202212121744138.png" alt="" /></p><ol start="3"><li>åœ¨ APP ç›®å½•ä¸­ç®¡ç†è¯¥ APP çš„é™æ€æ–‡ä»¶</li><li>åœ¨æ¨¡æ¿æ–‡ä»¶ä¸­å¼•å…¥é™æ€æ–‡ä»¶</li></ol><pre class="line-numbers language-html" data-language="html"><code class="language-html">&#123;% load static %&#125;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>stylesheet<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>&#123;% static <span class="token punctuation">'</span>polls/style.css<span class="token punctuation">'</span> %&#125;<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/202212121746667.png" alt="" /></p><h1 id="refs"><a class="markdownIt-Anchor" href="#refs"></a> Refs</h1><ul><li><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1S44y1K7Hd/?vd_source=b982c5b9804c7552564e69b7b5d8a2e0">Bilibili</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Django </category>
          
      </categories>
      
      
        <tags>
            
            <tag> python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>03-django-testing</title>
      <link href="/Coming-blog/2022/12/12/03-django-testing/"/>
      <url>/Coming-blog/2022/12/12/03-django-testing/</url>
      
        <content type="html"><![CDATA[<h1 id="automated-test"><a class="markdownIt-Anchor" href="#automated-test"></a> Automated Test</h1><p>Why I new tests:</p><ul><li>Without tests, the purpose or intended behavior of an application might be rather opaque.</li><li>Code without tests is broken by design.</li><li><a target="_blank" rel="noopener" href="https://docs.djangoproject.com/en/4.1/intro/tutorial05/">For more reasons</a></li></ul><p>Django çš„æµ‹è¯•æµç¨‹:</p><ol><li>æ ¹æ®å‘½ä»¤ä¼šå¯»æ‰¾ç›®æ ‡ APP ä¸­çš„ <a target="_blank" rel="noopener" href="http://test.py">test.py</a> æµ‹è¯•ä»£ç </li><li>å¯»æ‰¾ <code>django.test.TestCase</code> çš„å­ç±»</li><li>åˆå§‹åŒ–ä¸€ä¸ªç‰¹æ®Šçš„æ•°æ®åº“ä¾›æµ‹è¯•ä½¿ç”¨</li><li>å¯»æ‰¾ç±»ä¸­ä»¥ <code>test</code> å¼€å¤´çš„æ–¹æ³•</li><li>æ‰§è¡Œå¹¶æµ‹è¯•è¯¥æ–¹æ³•</li></ol><p>æµ‹è¯•å‡†åˆ™:</p><ul><li>å¯¹äºæ¯ä¸ªæ¨¡å‹å’Œè§†å›¾éƒ½å»ºç«‹å•ç‹¬çš„ TestClass</li><li>æ¯ä¸ªæµ‹è¯•æ–¹æ³•åªæµ‹è¯•ä¸€ä¸ªåŠŸèƒ½</li><li>ç»™æ¯ä¸ªæµ‹è¯•æ–¹æ³•èµ·ä¸ªèƒ½æè¿°å…¶åŠŸèƒ½çš„åå­—</li></ul><h2 id="quick-start"><a class="markdownIt-Anchor" href="#quick-start"></a> Quick Start</h2><ol><li>åœ¨ APP çš„ <a target="_blank" rel="noopener" href="http://tests.py">tests.py</a> ä¸­ç¼–å†™æµ‹è¯•ç±»</li></ol><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> datetime<span class="token keyword">from</span> django<span class="token punctuation">.</span>test <span class="token keyword">import</span> TestCase<span class="token keyword">from</span> django<span class="token punctuation">.</span>utils <span class="token keyword">import</span> timezone<span class="token keyword">class</span> <span class="token class-name">QuestionModelTests</span><span class="token punctuation">(</span>TestCase<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">pass</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="2"><li>æµ‹è¯•ç±»ä¸­ç¼–å†™ç›¸å…³çš„æµ‹è¯•æ–¹æ³•éªŒè¯ç¨‹åºæ‰§è¡Œçš„æ­£ç¡®æ€§</li></ol><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># was_published_recently() returns False for questions whose pub_date is in the future.</span><span class="token keyword">def</span> <span class="token function">test_was_published_recently_with_future_question</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>    time <span class="token operator">=</span> timezone<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> datetime<span class="token punctuation">.</span>timedelta<span class="token punctuation">(</span>days<span class="token operator">=</span><span class="token number">30</span><span class="token punctuation">)</span>    future_question <span class="token operator">=</span> Question<span class="token punctuation">(</span>pub_date<span class="token operator">=</span>time<span class="token punctuation">)</span>    self<span class="token punctuation">.</span>assertIs<span class="token punctuation">(</span>future_question<span class="token punctuation">.</span>was_published_recently<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="3"><li>æ‰§è¡Œæµ‹è¯•, æŸ¥çœ‹æµ‹è¯•ç»“æœ: <code>python manage.py test app_name</code></li></ol><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/202212121716700.png" alt="" /></p><h1 id="refs"><a class="markdownIt-Anchor" href="#refs"></a> Refs</h1><ul><li><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1S44y1K7Hd/?vd_source=b982c5b9804c7552564e69b7b5d8a2e0">Bilibili</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Django </category>
          
      </categories>
      
      
        <tags>
            
            <tag> python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>02-django-views</title>
      <link href="/Coming-blog/2022/12/12/02-django-views/"/>
      <url>/Coming-blog/2022/12/12/02-django-views/</url>
      
        <content type="html"><![CDATA[<h1 id="views"><a class="markdownIt-Anchor" href="#views"></a> views</h1><ul><li><a target="_blank" rel="noopener" href="https://docs.djangoproject.com/en/4.1/topics/http/urls/">For mor detail</a></li></ul><p>åœ¨ APP çš„ <a target="_blank" rel="noopener" href="http://views.py">views.py</a> ä¸­ä¹¦å†™ç›¸å…³çš„ view é€»è¾‘, éœ€è¦å®ç°ï¼š</p><ul><li>url ä¸ view çš„åŒ¹é…</li><li>view çš„æ¸²æŸ“è¿”å›</li></ul><blockquote><p>Your view can read records from a database, or not.It can use a template system such as Djangoâ€™s â€“ or a third-party Python template system â€“ or not.It can generate a PDF file, output XML, create a ZIP file on the fly, anything you want, using whatever Python libraries you want.</p></blockquote><h1 id="urlpatterns"><a class="markdownIt-Anchor" href="#urlpatterns"></a> urlpatterns</h1><p>ä½äº <a target="_blank" rel="noopener" href="http://urls.py">urls.py</a> ä¸­, å®ç° url ä¸ view çš„åŒ¹é…</p><h2 id="çˆ¶åŸŸ"><a class="markdownIt-Anchor" href="#çˆ¶åŸŸ"></a> çˆ¶åŸŸ</h2><ul><li>æ”¯æŒ APP å†…çš„ç»´æŠ¤: ä½¿ç”¨ include åœ¨æ ¹ <a target="_blank" rel="noopener" href="http://urls.py">urls.py</a> ä¸­å¯¼å…¥å³å¯</li></ul><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> django<span class="token punctuation">.</span>urls <span class="token keyword">import</span> path<span class="token punctuation">,</span> includeurlpatterns <span class="token operator">=</span> <span class="token punctuation">[</span>    path<span class="token punctuation">(</span><span class="token string">"admin/"</span><span class="token punctuation">,</span> admin<span class="token punctuation">.</span>site<span class="token punctuation">.</span>urls<span class="token punctuation">)</span><span class="token punctuation">,</span>    path<span class="token punctuation">(</span><span class="token string">"oa/"</span><span class="token punctuation">,</span> include<span class="token punctuation">(</span><span class="token string">"OA.urls"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="å­åŸŸ"><a class="markdownIt-Anchor" href="#å­åŸŸ"></a> å­åŸŸ</h2><ul><li>app å†…éƒ¨ <a target="_blank" rel="noopener" href="http://urls.py">urls.py</a> éœ€è¦å®Œå–„: app_name, urlpatterns å±æ€§</li><li>app_name å±æ€§çš„è®¾ç½®ç”¨äºå¤–éƒ¨å¼•ç”¨éç¡¬ç¼–ç  url æ—¶æŒ‡æ˜å‘½åç©ºé—´</li><li>name å±æ€§æ–¹ä¾¿å¤–éƒ¨å¼•ç”¨ç›®æ ‡ url</li><li>æ”¯æŒå ä½ç¬¦åŒ¹é…:</li></ul><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> django<span class="token punctuation">.</span>urls <span class="token keyword">import</span> path<span class="token keyword">from</span> <span class="token punctuation">.</span> <span class="token keyword">import</span> viewsapp_name <span class="token operator">=</span> <span class="token string">"OA"</span>urlpatterns <span class="token operator">=</span> <span class="token punctuation">[</span>    path<span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">,</span> views<span class="token punctuation">.</span>welcome<span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">"index"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    path<span class="token punctuation">(</span><span class="token string">"depart_list"</span><span class="token punctuation">,</span> views<span class="token punctuation">.</span>depart_list<span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">"depart_list"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    path<span class="token punctuation">(</span><span class="token string">"depart_list/add/"</span><span class="token punctuation">,</span> views<span class="token punctuation">.</span>depart_add<span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">"depart_add"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    path<span class="token punctuation">(</span><span class="token string">"depart_list/&lt;int:depart_id>/edit/"</span><span class="token punctuation">,</span> views<span class="token punctuation">.</span>depart_edit<span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">"depart_edit"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    path<span class="token punctuation">(</span><span class="token string">"depart_list/delete/"</span><span class="token punctuation">,</span> views<span class="token punctuation">.</span>depart_delete<span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">"depart_delete"</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åœ¨ template ä¸­å¼•ç”¨æ—¶, æŒ‡å®šå‘½åç©ºé—´ <code>app_name</code></p><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>&#123;% url <span class="token punctuation">'</span>OA:depart_edit<span class="token punctuation">'</span> depart.id %&#125;<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h1 id="exception"><a class="markdownIt-Anchor" href="#exception"></a> Exception</h1><p>view å¤„ç†æ—¶å¯ä»¥æ˜¾ç¤ºçš„ raise an exception, æœ€å¸¸è§çš„å°±æ˜¯ 404...</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> django<span class="token punctuation">.</span>http <span class="token keyword">import</span> Http404<span class="token keyword">def</span> <span class="token function">detail</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> question_id<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">try</span><span class="token punctuation">:</span>        question <span class="token operator">=</span> Question<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>get<span class="token punctuation">(</span>pk<span class="token operator">=</span>question_id<span class="token punctuation">)</span>    <span class="token keyword">except</span> Question<span class="token punctuation">.</span>DoesNotExist<span class="token punctuation">:</span>        <span class="token keyword">raise</span> Http404<span class="token punctuation">(</span><span class="token string">"Question does not exist"</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> render<span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token string">'polls/detail.html'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token string">'question'</span><span class="token punctuation">:</span> question<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/202212112306273.png" alt="" /></p><h2 id="404-shortcuts"><a class="markdownIt-Anchor" href="#404-shortcuts"></a> 404 shortcuts</h2><p>Itâ€™s a very common idiom to use <code>get()</code> and raise <code>Http404</code> if the object doesnâ€™t exist. å› æ­¤ django ä¹Ÿä¸ºæ­¤æä¾›äº†æ›´åŠ ç®€ä¾¿çš„å°è£…</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> django<span class="token punctuation">.</span>shortcuts <span class="token keyword">import</span> render<span class="token punctuation">,</span> get_object_or_404<span class="token keyword">def</span> <span class="token function">detail</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> question_id<span class="token punctuation">)</span><span class="token punctuation">:</span>    question <span class="token operator">=</span> get_object_or_404<span class="token punctuation">(</span>Question<span class="token punctuation">,</span> pk<span class="token operator">=</span>question_id<span class="token punctuation">)</span>    <span class="token keyword">return</span> render<span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token string">'polls/detail.html'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token string">'question'</span><span class="token punctuation">:</span> question<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/202212112309367.png" alt="" /></p><h1 id="generic-views"><a class="markdownIt-Anchor" href="#generic-views"></a> Generic Views</h1><p>Q: æœ‰äº› View çš„åŠŸèƒ½ååˆ†æ™®é, ä¾‹å¦‚å±•ç¤ºä¸€ä¸ªåˆ—è¡¨çš„æ•°æ®, æˆ–è€…å±•ç¤ºä¸€ä¸ª Object çš„è¯¦ç»†ä¿¡æ¯, é’ˆå¯¹è¿™ç±» View å…¶åå°æ“ä½œåŸºæœ¬ä¸€è‡´: è·å– object ç„¶åæ¸²æŸ“æ¨¡æ¿é¡µé¢, å› æ­¤å¯ä»¥è¿›ä¸€æ­¥è¿›è¡Œå°è£…</p><p>A: Generic views abstract common patterns to the point where you donâ€™t even need to write Python code to write an app. <a target="_blank" rel="noopener" href="https://docs.djangoproject.com/en/4.1/topics/class-based-views/">For more details...</a></p><p>æœ¬è´¨ä¸Šå°±æ˜¯ç¼©å‡äº†åå°ä¸æ•°æ®åº“äº¤äº’çš„ä»£ç , å±•ç¤ºçš„æ¨¡æ¿ä»£ç åŸºæœ¬ä¸Šè¿˜æ˜¯éœ€è¦é è‡ªå·±çš„..., æˆ‘åŸä»¥ä¸ºä¹Ÿèƒ½æœ‰ä¸€å¥—é»˜è®¤çš„æ¨¡æ¿è¿›è¡Œ generic çš„å±•ç¤º</p><h2 id="quick-start"><a class="markdownIt-Anchor" href="#quick-start"></a> Quick Start</h2><ol><li>å°†èƒ½å¤Ÿä¼˜åŒ–çš„ View å°è£…ä¸º generic çš„å­ç±»</li></ol><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># ListView: display a list of objects</span><span class="token comment"># é€šè¿‡ get_queryset è·å–è¦å±•ç¤ºçš„åˆ—è¡¨</span><span class="token comment"># é€šè¿‡ context_object_name é…ç½®æ¨¡æ¿ä¸­å¯¹åº”çš„åˆ—è¡¨å±æ€§åç§°</span><span class="token keyword">class</span> <span class="token class-name">IndexView</span><span class="token punctuation">(</span>generic<span class="token punctuation">.</span>ListView<span class="token punctuation">)</span><span class="token punctuation">:</span>    template_name <span class="token operator">=</span> <span class="token string">'polls/index.html'</span>    context_object_name <span class="token operator">=</span> <span class="token string">'latest_question_list'</span>    <span class="token keyword">def</span> <span class="token function">get_queryset</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token triple-quoted-string string">"""Return the last five published questions."""</span>        <span class="token keyword">return</span> Question<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>order_by<span class="token punctuation">(</span><span class="token string">'-pub_date'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token comment"># DetailView: display a detail page for a particular type of object</span><span class="token comment"># é€šè¿‡ model å±æ€§ç¡®å®šè¦å±•ç¤ºçš„ object</span><span class="token comment"># é»˜è®¤çš„å¯»æ‰¾ç›®æ ‡å¯¹è±¡çš„æ¡ä»¶ä¸ºä¸»é”® pk, å› æ­¤éœ€è¦é€šè¿‡ GET ä¼ å…¥</span><span class="token keyword">class</span> <span class="token class-name">DetailView</span><span class="token punctuation">(</span>generic<span class="token punctuation">.</span>DetailView<span class="token punctuation">)</span><span class="token punctuation">:</span>    model <span class="token operator">=</span> Question    template_name <span class="token operator">=</span> <span class="token string">'polls/detail.html'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="2"><li>æ›´æ”¹ urlpattern, æ³¨æ„ pattern ä¸­çš„å‚æ•°è¦å»åŒ¹é… generic ä¸­çš„å‚æ•°é…ç½®</li></ol><pre class="line-numbers language-python" data-language="python"><code class="language-python">urlpatterns <span class="token operator">=</span> <span class="token punctuation">[</span>    path<span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">,</span> views<span class="token punctuation">.</span>IndexView<span class="token punctuation">.</span>as_view<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">"index"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    path<span class="token punctuation">(</span><span class="token string">'&lt;int:pk>/'</span><span class="token punctuation">,</span> views<span class="token punctuation">.</span>DetailView<span class="token punctuation">.</span>as_view<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">'detail'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    path<span class="token punctuation">(</span><span class="token string">'&lt;int:pk>/results/'</span><span class="token punctuation">,</span> views<span class="token punctuation">.</span>ResultsView<span class="token punctuation">.</span>as_view<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">'results'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    path<span class="token punctuation">(</span><span class="token string">'&lt;int:pk>/vote/'</span><span class="token punctuation">,</span> views<span class="token punctuation">.</span>vote<span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">'vote'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="listview"><a class="markdownIt-Anchor" href="#listview"></a> ListView</h2><p>Display a list of objects</p><ul><li>é€šè¿‡ get_queryset è·å–è¦å±•ç¤ºçš„åˆ—è¡¨</li><li>é€šè¿‡ context_object_name é…ç½®æ¨¡æ¿ä¸­å¯¹åº”çš„åˆ—è¡¨å±æ€§åç§°</li></ul><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">IndexView</span><span class="token punctuation">(</span>generic<span class="token punctuation">.</span>ListView<span class="token punctuation">)</span><span class="token punctuation">:</span>    template_name <span class="token operator">=</span> <span class="token string">'polls/index.html'</span>    context_object_name <span class="token operator">=</span> <span class="token string">'latest_question_list'</span>    <span class="token keyword">def</span> <span class="token function">get_queryset</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token triple-quoted-string string">"""Return the last five published questions."""</span>        <span class="token keyword">return</span> Question<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>order_by<span class="token punctuation">(</span><span class="token string">'-pub_date'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="detailview"><a class="markdownIt-Anchor" href="#detailview"></a> DetailView</h2><p>Display a detail page for a particular type of object</p><ul><li>é€šè¿‡ model å±æ€§ç¡®å®šè¦å±•ç¤ºçš„ object</li><li>é»˜è®¤çš„å¯»æ‰¾ç›®æ ‡å¯¹è±¡çš„æ¡ä»¶ä¸ºä¸»é”® pk, å› æ­¤éœ€è¦é€šè¿‡ GET ä¼ å…¥</li></ul><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">DetailView</span><span class="token punctuation">(</span>generic<span class="token punctuation">.</span>DetailView<span class="token punctuation">)</span><span class="token punctuation">:</span>    model <span class="token operator">=</span> Question    template_name <span class="token operator">=</span> <span class="token string">'polls/detail.html'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> Django </category>
          
      </categories>
      
      
        <tags>
            
            <tag> python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>02-Basic Knowledge of Compilation Principles</title>
      <link href="/Coming-blog/2022/12/04/02-basic-knowledge-of-compilation-principles/"/>
      <url>/Coming-blog/2022/12/04/02-basic-knowledge-of-compilation-principles/</url>
      
        <content type="html"><![CDATA[<h1 id="é«˜çº§è¯­è¨€"><a class="markdownIt-Anchor" href="#é«˜çº§è¯­è¨€"></a> é«˜çº§è¯­è¨€</h1><p>ç¨‹åºè¯­è¨€æ˜¯ä¸€ä¸ªè®°å·ç³»ç»Ÿ, è¯­æ³• + è¯­ä¹‰è¿›è¡Œæè¿°</p><h2 id="è¯­æ³•"><a class="markdownIt-Anchor" href="#è¯­æ³•"></a> è¯­æ³•</h2><p>è¯­æ³•ï¼šä»»ä½•è¯­è¨€ç¨‹åºéƒ½å¯ä»¥çœ‹æˆæ˜¯ä¸€å®šå­—ç¬¦é›†ï¼ˆå­—æ¯è¡¨ï¼‰ä¸Šçš„å­—ç¬¦ä¸²ï¼Œè¯­æ³•ä½¿å¾—è¿™ä¸²å­—ç¬¦å½¢æˆä¸€ä¸ªå½¢å¼ä¸Šæ­£ç¡®çš„ç¨‹åºã€‚è¯­æ³• = è¯æ³•è§„åˆ™ + è¯­æ³•è§„åˆ™</p><ul><li>è¯æ³•è§„åˆ™å’Œè¯­æ³•è§„åˆ™å®šä¹‰äº†ç¨‹åºçš„å½¢å¼ç»“æ„ï¼Œæ˜¯åˆ¤æ–­è¾“å…¥å­—ç¬¦ä¸²æ˜¯å¦æ„æˆä¸€ä¸ªå½¢å¼ä¸Šæ­£ç¡®çš„ç¨‹åºçš„ä¾æ®</li><li>å•è¯ç¬¦å·ï¼šè¯­è¨€ä¸­å…·æœ‰ç‹¬ç«‹æ„ä¹‰çš„æœ€åŸºæœ¬ç»“æ„ï¼›ä¸€èˆ¬åŒ…æ‹¬ï¼Œå¸¸æ•°ã€æ ‡è¯†ç¬¦ã€åŸºæœ¬å­—ã€ç®—ç¬¦ã€ç•Œé™ç¬¦ç­‰</li><li>è¯æ³•è§„åˆ™ï¼šè§„å®šäº†å­—æ¯è¡¨ä¸­é‚£äº›å­—ç¬¦ä¸²æ˜¯å•è¯ç¬¦å·ï¼›ç”¨æ­£è§„å¼å’Œæœ‰é™è‡ªåŠ¨æœºç†è®ºæ¥æè¿°è¯æ³•ç»“æ„å’Œè¿›è¡Œè¯æ³•åˆ†æ</li><li>è¯­æ³•å•ä½ï¼šè¡¨è¾¾å¼ã€å­å¥ã€è¯­å¥ã€å‡½æ•°ã€è¿‡ç¨‹ã€ç¨‹åº</li><li>è¯­æ³•è§„åˆ™ï¼šè§„å®šäº†å¦‚ä½•ä»å•è¯ç¬¦å·æ¥å½¢æˆè¯­æ³•å•ä½ï¼›ç°åœ¨å¤šæ•°ç¨‹åºè¯­è¨€ä½¿ç”¨ä¸Šä¸‹æ–‡æ— å…³æ–‡æ³•æ¥æè¿°è¯­æ³•è§„åˆ™</li></ul><h2 id="è¯­ä¹‰"><a class="markdownIt-Anchor" href="#è¯­ä¹‰"></a> è¯­ä¹‰</h2><p>è¯­ä¹‰ï¼šå®šä¹‰å•è¯ç¬¦å·å’Œè¯­æ³•å•ä½çš„æ„ä¹‰</p><ul><li>ç›®å‰ï¼Œå¤§å¤šæ•°ç¼–è¯‘ç¨‹åºä½¿ç”¨åŸºäºå±æ€§æ–‡æ³•çš„è¯­æ³•åˆ¶å¯¼ç¿»è¯‘æ–¹æ³•æ¥åˆ†æè¯­ä¹‰</li></ul><h1 id="å­—æ¯è¡¨ä¸ç¬¦å·è¡¨"><a class="markdownIt-Anchor" href="#å­—æ¯è¡¨ä¸ç¬¦å·è¡¨"></a> å­—æ¯è¡¨ä¸ç¬¦å·è¡¨</h1><p>å­—æ¯è¡¨-&gt;ç¬¦å·-&gt;ç¬¦å·ä¸²-&gt;å¥å­-&gt;è¯­è¨€</p><p>å­—æ¯è¡¨ï¼šç¬¦å·çš„éç©ºæœ‰ç©·é›†åˆï¼›ä¾‹å¦‚ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>V</mi><mn>1</mn></msub><mo>=</mo><mo stretchy="false">{</mo><mi>a</mi><mo separator="true">,</mo><mi>b</mi><mo separator="true">,</mo><mi>c</mi><mo stretchy="false">}</mo><mo separator="true">,</mo><msub><mi>V</mi><mn>2</mn></msub><mo>=</mo><mo stretchy="false">{</mo><mo>+</mo><mo separator="true">,</mo><mo>âˆ’</mo><mo stretchy="false">}</mo><mo separator="true">,</mo><mo>âˆ‘</mo><mo>=</mo><mo stretchy="false">{</mo><mi>x</mi><mi mathvariant="normal">âˆ£</mi><mi>x</mi><mo>âˆˆ</mo><mi>A</mi><mi>S</mi><mi>C</mi><mi>I</mi><mi>I</mi><mo stretchy="false">}</mo></mrow><annotation encoding="application/x-tex">V_1=\{a, b, c\}, V_2=\{+, -\}, \sum = \{x| x \in ASCII \}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.22222em;">V</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.22222em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">{</span><span class="mord mathdefault">a</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">b</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">c</span><span class="mclose">}</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.22222em;">V</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.22222em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.00001em;vertical-align:-0.25001em;"></span><span class="mopen">{</span><span class="mord">+</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">âˆ’</span><span class="mclose">}</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop op-symbol small-op" style="position:relative;top:-0.0000050000000000050004em;">âˆ‘</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">{</span><span class="mord mathdefault">x</span><span class="mord">âˆ£</span><span class="mord mathdefault">x</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">âˆˆ</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault">A</span><span class="mord mathdefault" style="margin-right:0.05764em;">S</span><span class="mord mathdefault" style="margin-right:0.07153em;">C</span><span class="mord mathdefault" style="margin-right:0.07847em;">I</span><span class="mord mathdefault" style="margin-right:0.07847em;">I</span><span class="mclose">}</span></span></span></span></p><p>ç¬¦å·ï¼šè¯­è¨€ä¸­æœ€åŸºæœ¬çš„ä¸å¯å†åˆ†çš„å•ä½ï¼›ä¾‹å¦‚ <code>&#123;a, b, c, +, -, ...&#125;</code></p><p>ç¬¦å·ä¸²ï¼šå­—æ¯è¡¨ä¸­ç¬¦å·ç»„æˆçš„æœ‰ç©·åºåˆ—; ä¾‹å¦‚ <code>&#123;a, abc, -ab, ...&#125;</code></p><p>ç©ºä¸²ï¼šä¸å«æœ‰ä»»ä½•ç¬¦å·çš„ä¸²</p><p>å¥å­ï¼šå­—æ¯è¡¨ä¸Šç¬¦åˆæŸç§è§„åˆ™ï¼ˆè¯æ³•è§„åˆ™/è¯­æ³•è§„åˆ™ï¼‰æ„æˆçš„ä¸²</p><p>è¯­è¨€ï¼šå­—æ¯è¡¨ä¸Šç¬¦åˆæŸç§è§„åˆ™çš„è¯­å¥ç»„æˆï¼›å­—æ¯è¡¨ä¸Šçš„è¯­è¨€å°±æ˜¯å­—æ¯è¡¨ä¸Šæ­£é—­åŒ…çš„å­é›†</p><p>Tipsï¼šçº¦å®šç”¨ $a, b, c, \dots $ è¡¨ç¤ºç¬¦å·ï¼›ç”¨ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>Î±</mi><mo separator="true">,</mo><mi>Î²</mi><mo separator="true">,</mo><mi>Î³</mi><mo separator="true">,</mo><mo>â€¦</mo></mrow><annotation encoding="application/x-tex">\alpha, \beta, \gamma, \dots</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.0037em;">Î±</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.05278em;">Î²</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.05556em;">Î³</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner">â€¦</span></span></span></span> è¡¨ç¤ºç¬¦å·ä¸²ï¼›ç”¨$A, B, C, \dots $ è¡¨ç¤ºç¬¦å·ä¸²çš„é›†åˆ</p><h2 id="ç¬¦å·ä¸²é›†åˆçš„è¿ç®—"><a class="markdownIt-Anchor" href="#ç¬¦å·ä¸²é›†åˆçš„è¿ç®—"></a> ç¬¦å·ä¸²é›†åˆçš„è¿ç®—</h2><ol><li>è¿æ¥/ä¹˜ç§¯è¿ç®—: ç¬¦åˆè¯­æ³•è¦æ±‚, éœ€è¦è¯­ä¹‰æ£€æŸ¥</li></ol><ul><li>è‡ªèº«çš„è¿æ¥æˆä¸ºæ–¹å¹‚</li></ul><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/202212031637800.png" alt="" /></p><ol start="2"><li>é—­åŒ…è¿ç®—ï¼šå­—æ¯è¡¨ A ä¸Šç¬¦å·ç»„æˆçš„æ‰€æœ‰ä¸²çš„é›†åˆï¼ˆåŒ…æ‹¬ç©ºä¸²ï¼‰</li></ol><ul><li>æ­£é—­åŒ… <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mi>A</mi><mo>+</mo></msup></mrow><annotation encoding="application/x-tex">A^+</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.771331em;vertical-align:0em;"></span><span class="mord"><span class="mord mathdefault">A</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.771331em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mbin mtight">+</span></span></span></span></span></span></span></span></span></span></span> ä¸åŒ…æ‹¬ç©ºä¸²çš„(æ˜Ÿ)é—­åŒ…</li></ul><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mi>A</mi><mo>âˆ—</mo></msup><mo>=</mo><msup><mi>A</mi><mn>0</mn></msup><mo>âˆª</mo><msup><mi>A</mi><mn>1</mn></msup><mo>âˆª</mo><msup><mi>A</mi><mn>2</mn></msup><mo>âˆª</mo><mo>â€¦</mo><mspace linebreak="newline"></mspace><msup><mi>A</mi><mo>+</mo></msup><mo>=</mo><msup><mi>A</mi><mn>1</mn></msup><mo>âˆª</mo><msup><mi>A</mi><mn>2</mn></msup><mo>âˆª</mo><msup><mi>A</mi><mn>3</mn></msup><mo>âˆª</mo><mo>â€¦</mo></mrow><annotation encoding="application/x-tex">A^* = A^0 \cup A^1 \cup A^2 \cup \dots \\A^+ = A^1 \cup A^2 \cup A^3 \cup \dots </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.738696em;vertical-align:0em;"></span><span class="mord"><span class="mord mathdefault">A</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.738696em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mbin mtight">âˆ—</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.8641079999999999em;vertical-align:0em;"></span><span class="mord"><span class="mord mathdefault">A</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆª</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.8641079999999999em;vertical-align:0em;"></span><span class="mord"><span class="mord mathdefault">A</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆª</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.8641079999999999em;vertical-align:0em;"></span><span class="mord"><span class="mord mathdefault">A</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆª</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.12em;vertical-align:0em;"></span><span class="minner">â€¦</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:0.821331em;vertical-align:0em;"></span><span class="mord"><span class="mord mathdefault">A</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.821331em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mbin mtight">+</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.8641079999999999em;vertical-align:0em;"></span><span class="mord"><span class="mord mathdefault">A</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆª</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.8641079999999999em;vertical-align:0em;"></span><span class="mord"><span class="mord mathdefault">A</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆª</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.8641079999999999em;vertical-align:0em;"></span><span class="mord"><span class="mord mathdefault">A</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆª</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.12em;vertical-align:0em;"></span><span class="minner">â€¦</span></span></span></span></span></p><h1 id="æ–‡æ³•"><a class="markdownIt-Anchor" href="#æ–‡æ³•"></a> æ–‡æ³•</h1><p>æ–‡æ³•æ˜¯æè¿°è¯­è¨€çš„è¯­æ³•ç»“æ„çš„å½¢å¼è§„åˆ™</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/202212031856175.png" alt="" /></p><p>éç»ˆç»“ç¬¦ï¼šV_N, å‡ºç°åœ¨è§„åˆ™çš„å·¦éƒ¨ã€ç”¨ &lt;&gt; æ‹¬èµ·æ¥ã€è¡¨ç¤ºä¸€å®šè¯­æ³•æ¦‚å¿µçš„è¯</p><p>ç»ˆç»“ç¬¦ï¼šV_T, è¯­è¨€ä¸­ä¸å¯å†åˆ†å‰²çš„å­—ç¬¦ä¸²ï¼ˆåŒ…æ‹¬å•ä¸ªå­—ç¬¦ç»„æˆçš„ä¸²)ï¼Œæ˜¯ç»„æˆå¥å­çš„åŸºæœ¬å•ä½</p><p>å¼€å§‹ç¬¦å·ï¼šåˆç§°ä¸ºè¯†åˆ«ç¬¦å·ï¼Œè¡¨ç¤ºæ‰€å®šä¹‰çš„è¯­æ³•èŒƒç•´çš„éç»ˆç»“ç¬¦</p><p>äº§ç”Ÿå¼ï¼šç”¨æ¥å®šä¹‰ç¬¦å·ä¸²ä¹‹é—´å…³ç³»çš„ä¸€ç»„ï¼ˆè¯­æ³•ï¼‰è§„åˆ™</p><p>æ¨å¯¼ï¼šä»å¼€å§‹ç¬¦å·å¼€å§‹ï¼Œé€šè¿‡ä½¿ç”¨äº§ç”Ÿå¼çš„å³éƒ¨å–ä»£å·¦éƒ¨ï¼Œæœ€ç»ˆèƒ½äº§ç”Ÿè¯­è¨€çš„ä¸€ä¸ªå¥å­çš„è¿‡ç¨‹</p><p>è§„çº¦ï¼šæ¨å¯¼çš„é€†è¿‡ç¨‹ï¼Œä»ç»™å®šçš„æºè¯­è¨€çš„å¥å­å¼€å§‹ï¼Œé€šè¿‡è§„åˆ™çš„å·¦éƒ¨å–ä»£å³éƒ¨ï¼Œæœ€ç»ˆè¾¾åˆ°å¼€å§‹ç¬¦å·çš„è¿‡ç¨‹</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/202212031858580.png" alt="" /></p><p>å¥å‹ï¼šä»æ–‡æ³•çš„å¼€å§‹ç¬¦å· S å¼€å§‹ï¼Œæ¯æ­¥æ¨å¯¼ï¼ˆåŒ…æ‹¬ 0 æ­¥æ¨å¯¼)æ‰€å¾—åˆ°çš„å­—ç¬¦ä¸²</p><p>å¥å­ï¼šä»…å«ç»ˆç»“ç¬¦çš„å¥å‹</p><p>è¯­è¨€ï¼šç”± S å¼€å§‹é€šè¿‡ 1 æ­¥æˆ– 1 æ­¥ä»¥ä¸Šæ¨å¯¼æ‰€å¾—çš„å¥å­çš„é›†åˆ</p><h2 id="æ‰©å……çš„-bnf-è¡¨ç¤º"><a class="markdownIt-Anchor" href="#æ‰©å……çš„-bnf-è¡¨ç¤º"></a> æ‰©å……çš„ BNF è¡¨ç¤º</h2><ul><li>å°æ‹¬å·æå–å› å­: <code>U -&gt; ax|ay|az</code> ---&gt; <code>U -&gt; a(x|y|z)</code></li><li>ä¸­æ‹¬å·è¡¨ç¤ºä»»é€‰ç¬¦å·: <code>&lt;Int&gt;-&gt;[+|-]&lt;number&gt;&#123;&lt;number&#125;</code></li><li>å¤§æ‹¬å·é‡å¤æ¬¡æ•°æŒ‡å®š: <code>&lt;Identifier&gt;-&gt;&lt;alpha&gt;&#123;&lt;alpha&gt;|&lt;number&gt;&#125;^5_0</code></li></ul><h2 id="æ–‡æ³•ä¸è¯­è¨€çš„å½¢å¼å®šä¹‰"><a class="markdownIt-Anchor" href="#æ–‡æ³•ä¸è¯­è¨€çš„å½¢å¼å®šä¹‰"></a> æ–‡æ³•ä¸è¯­è¨€çš„å½¢å¼å®šä¹‰</h2><p>Chomsky å°†æ–‡æ³• G å®šä¹‰ä¸ºå››å…ƒç»„ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>G</mi><mo>=</mo><mo stretchy="false">(</mo><msub><mi>V</mi><mi>N</mi></msub><mo separator="true">,</mo><msub><mi>V</mi><mi>T</mi></msub><mo separator="true">,</mo><mi>P</mi><mo separator="true">,</mo><mi>S</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">G=(V_N,V_T,P,S)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault">G</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.22222em;">V</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.22222em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.10903em;">N</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.22222em;">V</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.22222em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.13889em;">T</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.05764em;">S</span><span class="mclose">)</span></span></span></span>, (éç»ˆç»“ç¬¦å·é›†åˆ, ç»ˆç»“ç¬¦å·é›†åˆ, äº§ç”Ÿå¼çš„æœ‰ç©·é›†åˆ, æ–‡æ³•å¼€å§‹ç¬¦å·)</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/202212031958946.png" alt="" /></p><p>0 å‹æ–‡æ³•: çŸ­è¯­æ–‡æ³•æˆ–æ— é™åˆ¶æ–‡æ³•; é™åˆ¶äº§ç”Ÿå¼å·¦ä¾§è‡³å°‘æœ‰ä¸€ä¸ªéç»ˆç»“ç¬¦; å›¾çµæœº, TM, å³å¯è¯†åˆ« 0 å‹è¯­è¨€</p><ul><li>ä»»ä½•çš„ 0 å‹æ–‡æ³•éƒ½æ˜¯é€’å½’å¯æšä¸¾çš„</li></ul><p>1 å‹æ–‡æ³•ï¼š<strong>é•¿åº¦å¢åŠ </strong>æ–‡æ³•, å› ä¸ºæ˜¯ç´¯ç§¯é€’å¢çš„, æ‰€ä»¥åˆç§°ä¸Šä¸‹æ–‡æœ‰å…³æ–‡æ³•(CSG, Context-Sensitive Grammar); çº¿æ€§ç•Œé™è‡ªåŠ¨æœº, LBA, ç”¨äºè¯†åˆ« 1 å‹è¯­è¨€</p><ul><li>å¼€å§‹ç¬¦å·è‹¥äº§ç”Ÿç©ºé›†é‚£å¼€å§‹ç¬¦å·å¿…é¡»åœ¨å·¦ä¾§</li><li>å…¶ä½™çš„æ¨å¯¼å¿…é¡»æ˜¯é€’å¢å¼æ¨å¯¼, å³ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>Î±</mi><mo>â†’</mo><mi>Î²</mi></mrow><annotation encoding="application/x-tex">\alpha \rightarrow \beta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.0037em;">Î±</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">â†’</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.05278em;">Î²</span></span></span></span> å¿…é¡»æœ‰ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="normal">âˆ£</mi><mi>Î²</mi><mi mathvariant="normal">âˆ£</mi><mo>&gt;</mo><mi mathvariant="normal">âˆ£</mi><mi>Î±</mi><mi mathvariant="normal">âˆ£</mi></mrow><annotation encoding="application/x-tex">|\beta| &gt; |\alpha|</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">âˆ£</span><span class="mord mathdefault" style="margin-right:0.05278em;">Î²</span><span class="mord">âˆ£</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">âˆ£</span><span class="mord mathdefault" style="margin-right:0.0037em;">Î±</span><span class="mord">âˆ£</span></span></span></span></li></ul><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/202212031919347.png" alt="" /></p><p>2 å‹æ–‡æ³•: ä¸Šä¸‹æ–‡æ— å…³æ–‡æ³•(CFG, Context-Free Grammer, éç»ˆç»“ç¬¦çš„æ›¿æ¢ä¸å¿…è€ƒè™‘ä¸Šä¸‹æ–‡); ä¸‹æ¨è‡ªåŠ¨æœº, PDA, å¯ç”¨äºè¯†åˆ« 2 å‹è¯­è¨€</p><ul><li>äº§ç”Ÿå¼å·¦ä¾§ä¸€å®šæ˜¯éç»ˆç»“ç¬¦</li></ul><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/202212031922518.png" alt="" /></p><p>3 å‹æ–‡æ³•ï¼šæ­£è§„æ–‡æ³•ã€å³çº¿æ€§æ–‡æ³•æˆ–å·¦çº¿æ€§æ–‡æ³•ï¼›æœ‰é™çŠ¶æ€è‡ªåŠ¨æœºå³å¯è¯†åˆ« 3 å‹è¯­è¨€</p><ul><li>äº§ç”Ÿå¼å·¦ä¾§ä¸€å®šä¸ºéç»ˆç»“ç¬¦</li><li>äº§ç”Ÿå¼å³ä¾§ä¸€å®šæœ‰ç»ˆç»“ç¬¦</li><li>äº§ç”Ÿå¼å³ä¾§å¯ä»¥æœ‰éç»ˆç»“ç¬¦ï¼Œå¦‚æœéç»ˆç»“ç¬¦å‡åœ¨å·¦ï¼Œåˆ™ç§°å·¦çº¿æ€§æ–‡æ³•ï¼›åä¹‹å³çº¿æ€§æ–‡æ³•</li></ul><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/202212031926964.png" alt="" /></p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/202212031926474.png" alt="" /></p><p>è¯æ³•åˆ†æä¸è¯­æ³•åˆ†æä¸­çš„é™åˆ¶ï¼š</p><ul><li>ä¸å­˜åœ¨ P -&gt; P çš„é™åˆ¶</li><li>äº§ç”Ÿå¼ä¸­å‡ºç°çš„ä»»ä½•éç»ˆç»“ç¬¦ P å¿…é¡»æœ‰ç”¨ï¼ˆP å¿…é¡»èƒ½æ¨åˆ°ç»ˆç»“ç¬¦ï¼‰</li></ul><h2 id="æ–‡æ³•çš„ç®€åŒ–"><a class="markdownIt-Anchor" href="#æ–‡æ³•çš„ç®€åŒ–"></a> æ–‡æ³•çš„ç®€åŒ–</h2><p>åœ¨æ–‡æ³•ä¸­ï¼Œæœ‰äº›äº§ç”Ÿå¼å¯¹æ¨å¯¼ä¸èµ·ä½œç”¨ï¼Œè¦åˆ é™¤æ‰</p><ul><li>æŸä¸ªäº§ç”Ÿå¼åœ¨æ¨å¯¼è¿‡ç¨‹ä¸­æ°¸è¿œä¸ä¼šè¢«ç”¨åˆ°ï¼Œå³ç”±å¼€å§‹ç¬¦å·æ¨å¯¼ï¼Œæ°¸è¿œæ¨ä¸åˆ°çš„å·¦éƒ¨çš„éç»ˆç»“ç¬¦</li><li>å¦‚æ°¸è¿œå¯¼ä¸å‡ºç»ˆç»“ç¬¦ä¸²çš„äº§ç”Ÿå¼</li><li>å¦‚å½¢å¦‚ Pâ†’P çš„äº§ç”Ÿå¼</li></ul><p>ç®€åŒ–æ­¥éª¤ï¼š</p><ol><li>æŸ¥æ‰¾æœ‰æ— å½¢å¦‚ Pâ†’P çš„äº§ç”Ÿå¼ï¼Œè‹¥æœ‰åˆ™åˆ é™¤</li><li>è‹¥æŸä¸ªäº§ç”Ÿå¼åœ¨æ¨å¯¼è¿‡ç¨‹ä¸­æ°¸è¿œä¸ä¼šè¢«ç”¨åˆ°ï¼Œåˆ é™¤å®ƒ</li><li>è‹¥æŸä¸ªäº§ç”Ÿå¼åœ¨æ¨å¯¼è¿‡ç¨‹ä¸­ä¸èƒ½ä»ä¸­å¯¼å‡ºç»ˆç»“ç¬¦ï¼Œåˆ é™¤å®ƒ</li><li>æœ€åï¼Œæ•´ç†æ‰€æœ‰å‰©ä½™äº§ç”Ÿå¼ï¼Œå°±å¾—åˆ°ç®€åŒ–çš„æ–‡æ³•</li></ol><h2 id="æ— ç©ºä¸²äº§ç”Ÿå¼çš„-cfg"><a class="markdownIt-Anchor" href="#æ— ç©ºä¸²äº§ç”Ÿå¼çš„-cfg"></a> æ— ç©ºä¸²äº§ç”Ÿå¼çš„ CFG</h2><p>æ»¡è¶³æ¡ä»¶ï¼š</p><ul><li>P ä¸­è¦ä¹ˆä¸å«ç©ºä¸²äº§ç”Ÿå¼ï¼Œè¦ä¹ˆåªæœ‰ Sâ†’ç©ºä¸²</li><li>è‹¥ Sâ†’ç©ºä¸²ï¼Œåˆ™ S ä¸å‡ºç°åœ¨ä»»ä½•äº§ç”Ÿå¼å³éƒ¨</li></ul><p>æ„é€ ç®—æ³•ï¼š</p><ol><li>ç”±æ–‡æ³• G æ‰¾å‡ºæ‰€æœ‰ç»è¿‡è‹¥å¹²æ­¥æ¨å¯¼èƒ½æ¨å‡º ç©ºä¸² çš„éç»ˆç»“ç¬¦, æ”¾åœ¨ V0 é›†åˆä¸­</li><li>æŒ‰ç…§ä¸‹åˆ—æ­¥éª¤æ„é€  G' çš„äº§ç”Ÿå¼é›†åˆ P'<ol><li>è‹¥ V0 é›†åˆä¸­çš„æŸå…ƒç´ å‡ºç°åœ¨æŸäº§ç”Ÿå¼çš„å³ç«¯ï¼Œåˆ™å°†å®ƒå˜æˆä¸¤ä¸ªäº§ç”Ÿå¼ï¼šåˆ†åˆ«ä»¥ ç©ºä¸² å’Œå…¶åŸå‹å¸¦å…¥, åŠ å…¥ P'</li><li>å…¶ä»–äº§ç”Ÿå¼å‡ºå» ç©ºä¸² äº§ç”Ÿå¼åä¹ŸåŠ å…¥ P'</li><li>å¦‚æœ P ä¸­æœ‰äº§ç”Ÿå¼ S -&gt; ç©ºä¸²ï¼Œå°†å®ƒåœ¨ P' ä¸­æ”¹ä¸º S' -&gt; ç©ºä¸² | S çš„å½¢å¼</li></ol></li></ol><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/202212032032289.png" alt="" /></p><h1 id="è¯­æ³•æ ‘"><a class="markdownIt-Anchor" href="#è¯­æ³•æ ‘"></a> è¯­æ³•æ ‘</h1><p>ç”¨æ¥è¡¨ç¤ºè¯­è¨€å¥å­ç»“æ„çš„æ ‘, ä½¿ç”¨è¯­æ³•æ ‘å¯ä»¥ä½¿è¯­æ³•åˆ†æè¿‡ç¨‹ç›´è§‚ã€å½¢è±¡ï¼Œæ˜“äºåˆ¤æ–­<strong>æ–‡æ³•äºŒä¹‰æ€§</strong></p><p>å­æ ‘ï¼šé™¤å¶å­ç»“ç‚¹ä¹‹å¤–çš„ä»»æ„ç»“ç‚¹è¿åŒå®ƒçš„æ‰€æœ‰å­å­™ç»“ç‚¹æ„æˆå­æ ‘ï¼ˆåŒ…æ‹¬è¿™ä¸ªæ ‘æœ¬èº«ï¼‰</p><p>ä¿®å‰ªå­æ ‘ï¼šå‰ªå»å­æ ‘æ ‘æ ¹çš„æ‰€æœ‰å­©å­èŠ‚ç‚¹</p><p>å¥å‹ï¼šåœ¨ä¸€æ£µè¯­æ³•æ ‘ç”Ÿé•¿è¿‡ç¨‹ä¸­çš„ä»»ä½•æ—¶åˆ»ï¼Œæ‰€æœ‰é‚£äº›å¶å­ç»“ç‚¹æ’åˆ—èµ·æ¥å°±æ˜¯ä¸€ä¸ªå¥å‹</p><p>çŸ­è¯­ï¼šå­æ ‘çš„æœ«ç«¯ç¬¦è‡ªå·¦è‡³å³è¿æˆçš„ä¸²ï¼ˆå¯ä»¥åŒ…å«éç»ˆç»“ç¬¦ï¼‰ï¼Œç›¸å¯¹äºå­æ ‘æ ‘æ ¹è€Œè¨€ç§°ä¹‹ä¸ºçŸ­è¯­</p><ul><li>ç®€å•çŸ­è¯­ï¼šä¸€æ­¥æ¨å¯¼å¾—åˆ°çš„çŸ­è¯­</li><li>å¥å‹çš„çŸ­è¯­ï¼šè¯¥å¥å‹ä¸­å“ªäº›ç¬¦å·ä¸²å¯æ„æˆæŸå­æ ‘æ ¹çš„çŸ­è¯­ï¼ˆæ‰€æœ‰å­©å­èŠ‚ç‚¹ï¼‰</li></ul><p>å¥æŸ„ï¼šå¥å‹ä¸­æœ€å·¦ç®€å•çŸ­è¯­ï¼›å¥æŸ„æ˜¯æœ€å·¦å½’çº¦æ—¶è¦å¯»æ‰¾çš„ç®€å•çŸ­è¯­</p><h2 id="æ–‡æ³•äºŒä¹‰æ€§"><a class="markdownIt-Anchor" href="#æ–‡æ³•äºŒä¹‰æ€§"></a> æ–‡æ³•äºŒä¹‰æ€§</h2><p>å¥å­äºŒä¹‰æ€§ï¼šå¦‚æœæ–‡æ³•çš„ä¸€ä¸ªå¥å­å­˜åœ¨å¯¹åº”çš„ä¸¤æ£µæˆ–ä¸¤æ£µä»¥ä¸Šçš„è¯­æ³•æ ‘ï¼Œåˆ™è¯¥å¥å­æ˜¯äºŒä¹‰çš„</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/202212032103216.png" alt="" /></p><h1 id="refs"><a class="markdownIt-Anchor" href="#refs"></a> Refs</h1><ul><li><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1cW411B7DW/">å»–è€å¸ˆ-ä¸œå—å¤§å­¦ç¼–è¯‘åŸç†</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Compiler </category>
          
      </categories>
      
      
        <tags>
            
            <tag> compilation principle </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>01-django-init</title>
      <link href="/Coming-blog/2022/12/03/01-django-init/"/>
      <url>/Coming-blog/2022/12/03/01-django-init/</url>
      
        <content type="html"><![CDATA[<h1 id="å®‰è£…"><a class="markdownIt-Anchor" href="#å®‰è£…"></a> å®‰è£…</h1><p>å®‰è£… django: <code>pip install django</code></p><p>éªŒè¯ django ç‰ˆæœ¬: <code>python -m django --version</code></p><p>ä¸»è¦å…³æ³¨ä¸¤ä¸ªæ–‡ä»¶å¤¹ï¼š</p><ul><li><code>Scripts/django-admin.exe</code>: è„šæ‰‹æ¶, è‡ªåŠ¨åŒ–åˆ›å»º django é¡¹ç›®</li><li><code>site-packages/django</code>: æºç æ–‡ä»¶, å¼•ç”¨ä½¿ç”¨</li></ul><h1 id="app"><a class="markdownIt-Anchor" href="#app"></a> APP</h1><p>TODO: åç»­å¯ä»¥ç ”ç©¶å¤š APP é¡¹ç›®</p><p>ä½¿ç”¨ APP è¿›è¡Œåå°å„åŠŸèƒ½çš„åˆ’åˆ†, æ¯ä¸ª APP ä¸­å¯ä»¥æ‹¥æœ‰ç‹¬ç«‹çš„è¡¨ç»“æ„ã€å‡½æ•°ã€HTML æ¨¡æ¿ã€CSS ç­‰</p><ul><li>åˆ›å»º APP: <code>python manage.py startapp appName</code></li></ul><p>The difference between a project and an app:</p><ul><li>An app is a web application that does something â€“ e.g., a blog system, a database of public records or a small poll app</li><li>A project is a collection of configuration and apps for a particular website.</li><li>A project can contain multiple apps. An app can be in multiple projects.</li></ul><h1 id="quick-start"><a class="markdownIt-Anchor" href="#quick-start"></a> Quick Start</h1><ol><li>åˆ›å»ºé¡¹ç›®: <code>django-admin startproject projectName</code>; é¡¹ç›®åç§°åç»­å¯ä»¥ä»»æ„æ›´æ”¹(you can rename it to anything you like)</li></ol><pre class="line-numbers language-html" data-language="html"><code class="language-html">mysite/    manage.py    mysite/        __init__.py        settings.py        urls.py        asgi.py        wsgi.py<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><a target="_blank" rel="noopener" href="https://docs.djangoproject.com/en/4.1/ref/django-admin/">manage.py</a>: é¡¹ç›®çš„ç®¡ç†ï¼Œå¯åŠ¨é¡¹ç›®ã€åˆ›å»º APPã€æ•°æ®ç®¡ç†</li><li><a target="_blank" rel="noopener" href="https://docs.djangoproject.com/en/4.1/topics/settings/">settings.py</a>: é¡¹ç›®çš„é…ç½®æ–‡ä»¶, æ•°æ®åº“ç®¡ç†ã€æ³¨å†Œ APP</li><li><a target="_blank" rel="noopener" href="https://docs.djangoproject.com/en/4.1/topics/http/urls/">urls.py</a>: ç®¡ç† url ä¸ func çš„å¯¹åº”å…³ç³»</li><li><a target="_blank" rel="noopener" href="https://docs.djangoproject.com/en/4.1/howto/deployment/asgi/">asgi.py</a> ä¸ <a target="_blank" rel="noopener" href="https://docs.djangoproject.com/en/4.1/howto/deployment/wsgi/">wsgi.py</a>: æ¥æ”¶ç½‘ç»œè¯·æ±‚, ä¸ç”¨æ›´æ”¹</li></ul><ol start="2"><li>åˆ›å»º APP: <code>python manage.py startapp appName</code></li></ol><pre class="line-numbers language-html" data-language="html"><code class="language-html">polls/    __init__.py    admin.py    apps.py    migrations/        __init__.py    models.py    tests.py    views.py<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><code>models.py</code>: å¯¹æ•°æ®åº“çš„æ“ä½œ</li><li><code>view.py</code>: func ç›¸å…³çš„å®šä¹‰</li></ul><ol start="3"><li>æ³¨å†Œ APP: åœ¨ä¸»é¡¹ç›®ä¸­ <code>settings.py</code> ä¸­çš„ <code>INSTALLED_APPS</code> åˆ—è¡¨ä¸­æ³¨å†Œ; <code>appName.apps.AppConfigName</code></li></ol><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/202212071742844.png" alt="" /></p><ol start="4"><li>ç¼–å†™ URL ä¸ è§†å›¾å‡½æ•°çš„å¯¹åº”å…³ç³»ï¼šåœ¨ app ä¸­ <code>urls.py</code>ï¼ˆè‡ªè¡Œæ–°å»ºï¼‰ ä¸­çš„ <a target="_blank" rel="noopener" href="https://docs.djangoproject.com/en/4.1/topics/http/urls/">urlpatterns</a> åˆ—è¡¨ä¸­ç¼–å†™</li></ol><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> django<span class="token punctuation">.</span>urls <span class="token keyword">import</span> path<span class="token keyword">from</span> <span class="token punctuation">.</span> <span class="token keyword">import</span> viewsurlpatterns <span class="token operator">=</span> <span class="token punctuation">[</span>    path<span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">,</span> views<span class="token punctuation">.</span>index<span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">"index"</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="5"><li><p>ç¼–å†™å‡½æ•°ä½“ï¼šåœ¨ç›¸å…³ <code>app</code> ä¸‹çš„ <code>views.py</code> ä¸­</p></li><li><p>åœ¨ä¸»é¡¹ç›®ä¸­å¼•å…¥ app çš„è·¯ç”±ä¿¡æ¯</p></li></ol><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> django<span class="token punctuation">.</span>contrib <span class="token keyword">import</span> admin<span class="token keyword">from</span> django<span class="token punctuation">.</span>urls <span class="token keyword">import</span> path<span class="token punctuation">,</span> includeurlpatterns <span class="token operator">=</span> <span class="token punctuation">[</span>    path<span class="token punctuation">(</span><span class="token string">"admin/"</span><span class="token punctuation">,</span> admin<span class="token punctuation">.</span>site<span class="token punctuation">.</span>urls<span class="token punctuation">)</span><span class="token punctuation">,</span>    path<span class="token punctuation">(</span><span class="token string">"polls/"</span><span class="token punctuation">,</span> include<span class="token punctuation">(</span><span class="token string">"polls.urls"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>the path() function is passed four arguments, two required: route and view, and two optional: kwargs, and name<ul><li>route: å¾…åŒ¹é…çš„ URL pattern, æŒ‰ç…§æ³¨å†Œé¡ºåºä»ä¸Šåˆ°ä¸‹åŒ¹é…</li><li>view: åŒ¹é…æˆåŠŸåè°ƒç”¨çš„å‡½æ•°</li><li>kwargs: å…¶å®ƒå‚æ•°, åç»­ä»‹ç»...</li><li>name: TODO, è¿˜ä¸å¤§æ¸…æ¥šå…¶ä½œç”¨, Naming your URL lets you refer to it unambiguously from elsewhere in Django, especially from within templates. This powerful feature allows you to make global changes to the URL patterns of your project while only touching a single file.</li></ul></li><li>The include() function allows referencing other URLconfs. Whenever Django encounters include(), it chops off whatever part of the URL matched up to that point and sends the remaining string to the included URLconf for further processing.</li></ul><ol start="7"><li>å¯åŠ¨ APP: <code>python manage.py runserver [port]</code></li></ol><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/202212032323367.png" alt="" /></p><blockquote><p>donâ€™t use this server in anything resembling a production environment. Itâ€™s intended only for use while developing.Weâ€™re in the business of making web frameworks, not web servers.</p></blockquote><h1 id="django-shell"><a class="markdownIt-Anchor" href="#django-shell"></a> Django Shell</h1><p>ä½¿ç”¨ <code>python manage.py shell</code> æ‰“å¼€ä¸å½“å‰é¡¹ç›®çš„äº¤äº’, å¯ä»¥é€šè¿‡ django å†…ç½®çš„ API è¿›è¡ŒåŠŸèƒ½æµ‹è¯•</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/202212071757229.png" alt="" /></p><h2 id="database-api"><a class="markdownIt-Anchor" href="#database-api"></a> Database API</h2><ol><li>å¼•å…¥æ•°æ®æ¨¡å‹: <code>from polls.models import Choice, Question</code></li><li>åˆ›å»ºæ•°æ®æ¡ç›®: <code>q = Question(question_text=&quot;What's new?&quot;, pub_date=timezone.now())</code></li><li>å°†æ¡ç›®ä¿å­˜åˆ°æ•°æ®åº“ä¸­: <code>q.save()</code></li><li>å°†æ¡ç›®åˆ é™¤: <code>q.delete()</code></li><li>æ ¹æ®æ•°æ®æ¨¡å‹æŸ¥çœ‹/æ›´æ”¹å±æ€§å€¼(æ›´æ”¹åè¦ save)</li></ol><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/202212071800325.png" alt="" /></p><ol start="5"><li>æŸ¥çœ‹è¡¨ä¸­çš„æ‰€æœ‰ä¿¡æ¯: <code>Question.objects.all()</code>; å¦‚æœè¦ä¿®æ”¹å±•ç¤ºæ•ˆæœ, å¯ä»¥é‡å†™æ•°æ®æ¨¡å‹ä¸­çš„ <strong>str</strong> æ–¹æ³•</li></ol><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">__str__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token builtin">str</span><span class="token punctuation">:</span>    <span class="token keyword">return</span> self<span class="token punctuation">.</span>question_text<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>é‡å¯ä¸€ä¸‹ shell å³å¯çœ‹åˆ°æ•ˆæœ</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/202212071809453.png" alt="" /></p><ol start="6"><li>è¡¨æ”¯æŒè¿‡æ»¤ä¸ç­›é€‰:</li></ol><ul><li><code>Question.objects.filter(id=1)</code></li><li><code>Question.objects.filter(question_text__startswith='What')</code></li><li><code>Question.objects.get(pub_date__year=timezone.now().year)</code></li><li>é€šè¿‡ä¸»é”®ç­›é€‰æ˜¯è¾ƒä¸ºå¸¸ç”¨çš„, å› æ­¤ç®€åŒ–äº†æ”¹å‘½ä»¤: <code>Question.objects.get(pk=1)</code></li></ul><ol start="7"><li>åœ¨ Django ä¸­ä¼šè‡ªåŠ¨ä¸ºå¤–é”®çš„å¯¹è±¡åˆ›å»ºä¸€ä¸ªé›†åˆ, ç”¨äºå­˜æ”¾ç›®æ ‡æ•°æ®æ¡ç›®, ä¾‹å¦‚ Question_id æ˜¯ Choice çš„å¤–é”®, å› æ­¤æ¯ä¸€ä¸ª question å¯¹è±¡éƒ½ä¼šæœ‰ä¸€ä¸ª choice_set å±æ€§</li></ol><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/202212071818369.png" alt="" /></p><ol start="8"><li>ä¸ºè¿™ä¸ªé›†åˆæ·»åŠ æ•°æ®å°±èƒ½è‡ªåŠ¨ä½œç”¨åˆ° Choice è¡¨ä¸­</li></ol><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/202212071821430.png" alt="" /></p><h1 id="refs"><a class="markdownIt-Anchor" href="#refs"></a> Refs</h1><ul><li><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1S44y1K7Hd/?vd_source=b982c5b9804c7552564e69b7b5d8a2e0">Bilibili</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Django </category>
          
      </categories>
      
      
        <tags>
            
            <tag> python </tag>
            
            <tag> INIT </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>01-Overview-of-Compilation-Principles</title>
      <link href="/Coming-blog/2022/12/03/01-overview-of-compilation-principles/"/>
      <url>/Coming-blog/2022/12/03/01-overview-of-compilation-principles/</url>
      
        <content type="html"><![CDATA[<h1 id="ç¨‹åºè®¾è®¡è¯­è¨€"><a class="markdownIt-Anchor" href="#ç¨‹åºè®¾è®¡è¯­è¨€"></a> ç¨‹åºè®¾è®¡è¯­è¨€</h1><ol><li>æœºå™¨è¯­è¨€</li><li>æ±‡ç¼–è¯­è¨€ï¼šå¤šç§æ±‡ç¼–æŒ‡ä»¤é›†ä¸è¯­æ³•...</li></ol><ul><li>æœ‰å¤šç§ CPU æ¶æ„, å¦‚ x86, arm, mips ...</li><li>ä¸åŒçš„æ¶æ„å¯¹åº”çš„ä¸åŒçš„æ±‡ç¼–æŒ‡ä»¤é›†, x86 æ±‡ç¼–, arm æ±‡ç¼–, mips æ±‡ç¼–</li><li>ä¸åŒçš„æ±‡ç¼–æŒ‡ä»¤é›†æœ‰ä¸åŒçš„æ±‡ç¼–è¯­æ³•, x86 æ±‡ç¼–æœ‰ Intel é£æ ¼çš„ ä¸ ATT é£æ ¼çš„, arm æ±‡ç¼–æœ‰è‡ªå·±è¯­æ³•, mips ä¹Ÿæœ‰è‡ªå·±çš„è¯­æ³•</li><li>ä¸åŒè¯­æ³•çš„æ±‡ç¼–éœ€è¦ç”±ä¸åŒçš„æ±‡ç¼–å™¨è½¬æ¢ä¸ºæœºå™¨èƒ½è¯†åˆ«çš„æœºå™¨æŒ‡ä»¤</li><li>ä¸­é—´è¯­è¨€çš„æŠ½è±¡ç¨‹åº¦ä¸å¤æ‚ç¨‹åº¦ä»‹äºé«˜çº§è¯­è¨€å’Œæœºå™¨è¯­è¨€ä¹‹é—´, é«˜çº§è¯­è¨€ç›´æ¥ç¿»è¯‘ä¸ºæœºå™¨è¯­è¨€éš¾åº¦è¾ƒå¤§...</li></ul><ol start="3"><li>é«˜çº§è¯­è¨€</li></ol><h2 id="ç¿»è¯‘"><a class="markdownIt-Anchor" href="#ç¿»è¯‘"></a> ç¿»è¯‘</h2><p>æ˜¯æŒ‡èƒ½æŠŠæŸç§è¯­è¨€çš„æºç¨‹åºï¼Œåœ¨ä¸æ”¹å˜è¯­ä¹‰çš„æ¡ä»¶ä¸‹ï¼Œè½¬æ¢æˆå¦ä¸€ç§è¯­è¨€ç¨‹åºä¸€ç›®æ ‡è¯­è¨€ç¨‹åºã€‚ç¼–è¯‘ç¨‹åºå°±æ˜¯ä¸€ç§ç¿»è¯‘ç¨‹åºã€‚</p><p>å®ç°è¿‡ç¨‹ï¼šç¼–è¯‘/è§£é‡Š</p><ul><li>ç¼–è¯‘ï¼šç”±é«˜çº§è¯­è¨€è½¬ä¸ºä½çº§è¯­è¨€</li><li>è§£é‡Šï¼šæ¥å—æŸé«˜çº§è¯­è¨€çš„ä¸€ä¸ªè¯­å¥è¾“å…¥ï¼Œè¿›è¡Œè§£é‡Šå¹¶æ§åˆ¶è®¡ç®—æœºæ‰§è¡Œï¼Œé©¬ä¸Šå¾—åˆ°è¿™å¥çš„æ‰§è¡Œç»“æœï¼ˆä¸äº§ç”Ÿç›®æ ‡ç¨‹åºï¼‰ï¼Œç„¶åå†æ¥å—ä¸‹ä¸€å¥<ul><li>Strength: ç›´è§‚æ˜“æ‡‚ï¼Œç»“æ„ç®€å•ï¼Œæ˜“äºå®ç°äººæœºå¯¹è¯</li><li>Weakness: æ•ˆç‡ä½</li></ul></li></ul><h2 id="ç¼–è¯‘"><a class="markdownIt-Anchor" href="#ç¼–è¯‘"></a> ç¼–è¯‘</h2><p>ä¸¤é˜¶æ®µè¿‡ç¨‹ï¼šç¼–è¯‘ + è¿è¡Œ, source -&gt; exeä¸‰é˜¶æ®µè¿‡ç¨‹ï¼šç¼–è¯‘ + æ±‡ç¼– + è¿è¡Œ, source -&gt; asm -&gt; exe</p><p>ä¸åŒçš„é«˜çº§è¯­è¨€ç»è¿‡ç¼–è¯‘åæœ€ç»ˆå¾—åˆ°çš„ç›®æ ‡ä»£ç å¯èƒ½ä¸º exe ä¹Ÿå¯èƒ½ä¸º obj æ–‡ä»¶(ä¹Ÿæ˜¯ 01 ä»£ç ç»„æˆçš„æ–‡ä»¶), å¦‚æœæ˜¯ obj æ–‡ä»¶è¿˜éœ€è¦è¿›è¡Œé“¾æ¥(link), æ‰èƒ½æ­£å¸¸ä½¿ç”¨</p><h2 id="ç¼–è¯‘ç¨‹åºåˆ†ç±»"><a class="markdownIt-Anchor" href="#ç¼–è¯‘ç¨‹åºåˆ†ç±»"></a> ç¼–è¯‘ç¨‹åºåˆ†ç±»</h2><p>è¿è¡Œç¼–è¯‘ç¨‹åºçš„æœºå™¨ç§°ä¸ºå®¿ä¸»æœº, è¿è¡Œç›®æ ‡è¯­è¨€ç¨‹åºçš„æœºå™¨ç§°ä¸ºç›®æ ‡æœº</p><ul><li>è¯Šæ–­ç¼–è¯‘ç¨‹åº, Diagnostic Compiler, è¾…åŠ©å¼€å‘å’Œè°ƒè¯•, å‘ç°é”™è¯¯</li><li>ä¼˜åŒ–ç¼–è¯‘ç¨‹åº, Optimizing Compiler, ä¾§é‡äºæé«˜ç›®æ ‡ä»£ç çš„æ•ˆç‡</li><li>äº¤å‰ç¼–è¯‘ç¨‹åº, Cross Compiler, ç¼–è¯‘ç¨‹åºäº§ç”Ÿä¸åŒäºå…¶å®¿ä¸»æœºçš„æœºå™¨ä»£ç ç§°ä¸ºäº¤å‰ç¼–è¯‘ç¨‹åº</li><li>å¯å˜ç›®æ ‡ç¼–è¯‘ç¨‹åº, Retargetable Compiler, é’ˆå¯¹ç›®æ ‡æœºå™¨å¹³å°ç”Ÿæˆç›®æ ‡ä»£ç </li></ul><h1 id="ç¼–è¯‘ç¨‹åºæµç¨‹"><a class="markdownIt-Anchor" href="#ç¼–è¯‘ç¨‹åºæµç¨‹"></a> ç¼–è¯‘ç¨‹åºæµç¨‹</h1><ol><li>è¯æ³•åˆ†æï¼šè¯†åˆ«å‡ºä¸€ä¸ªä¸ªå•è¯(token, é«˜çº§è¯­è¨€ä¸­æœ‰å®åœ¨æ„ä¹‰çš„æœ€å°è¯­æ³•å•ä½), å„ä¸ªå•è¯æŒ‰ç…§ç±»åˆ«åˆ†ç±»è®¨è®º, è½¬æ¢æˆç»Ÿä¸€çš„è§„æ ¼, ä¾›è¯­æ³•åˆ†æä½¿ç”¨</li><li>è¯­æ³•åˆ†æï¼šæ ¹æ®è¯­è¨€çš„è¯­æ³•è§„åˆ™(æ–‡æ³•), å°†å•è¯ç¬¦å·ç»„æˆå„ç±»çš„è¯­æ³•å•ä½ï¼ˆçŸ­è¯­ã€å­å¥ã€è¿‡ç¨‹ã€ç¨‹åºï¼‰</li><li>ä¸­é—´ä»£ç ç”Ÿæˆ</li><li>ä¼˜åŒ–ï¼š</li><li>ç›®æ ‡ä»£ç ç”Ÿæˆï¼š</li></ol><h2 id="è¯æ³•åˆ†æ"><a class="markdownIt-Anchor" href="#è¯æ³•åˆ†æ"></a> è¯æ³•åˆ†æ</h2><p>Target: è¾“å…¥æºç¨‹åºï¼Œå¯¹æ„æˆæºç¨‹åºçš„å­—ç¬¦ä¸²è¿›è¡Œæ‰«æå’Œåˆ†è§£ï¼Œè¯†åˆ«å‡ºå•è¯ç¬¦å·</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/202212031105775.png" alt="" /></p><h2 id="è¯­æ³•åˆ†æ"><a class="markdownIt-Anchor" href="#è¯­æ³•åˆ†æ"></a> è¯­æ³•åˆ†æ</h2><p>Target: åœ¨è¯æ³•åˆ†æçš„åŸºç¡€ä¸Šï¼Œæ ¹æ®è¯­æ³•è§„åˆ™æŠŠå•è¯ç¬¦å·ä¸²åˆ†è§£æˆå„ç±»è¯­æ³•å•ä½ï¼ˆè¯­æ³•èŒƒç•´ï¼‰</p><p>æ¨å¯¼ä¸è§„çº¦ï¼šderive å°†è§„åˆ™å±•å¼€ ä¸ reduce å°†çŸ­è¯­è§„çº¦ä¸ºè§„åˆ™</p><p>æœ€å³æ¨å¯¼, æœ€å·¦è§„çº¦ï¼šåªæ¨å¯¼æœ€å³ä¾§çš„ç¬¦å· + é€†å‘è§„çº¦è¿‡ç¨‹</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/202212031106655.png" alt="" /></p><p>æœ€å·¦æ¨å¯¼, æœ€å³è§„çº¦ï¼šåªæ¨å¯¼æœ€å·¦ä¾§çš„ç¬¦å· + é€†å‘è§„çº¦è¿‡ç¨‹</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/202212031113825.png" alt="" /></p><p>è¯­æ³•æ ‘ï¼š</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/202212031117357.png" alt="" /></p><h2 id="è¯­ä¹‰åˆ†æå’Œä¸­é—´ä»£ç ç”Ÿæˆ"><a class="markdownIt-Anchor" href="#è¯­ä¹‰åˆ†æå’Œä¸­é—´ä»£ç ç”Ÿæˆ"></a> è¯­ä¹‰åˆ†æå’Œä¸­é—´ä»£ç ç”Ÿæˆ</h2><p>Target: è¯­ä¹‰æ£€æŸ¥ + ä¸­é—´ä»£ç ç¿»è¯‘, å¯¹å„ç±»è¯­æ³•å•ä½æŒ‰è¯­è¨€çš„è¯­ä¹‰è¿›è¡Œåˆæ­¥ç¿»è¯‘</p><h3 id="å››å…ƒå¼ä¸­é—´ä»£ç "><a class="markdownIt-Anchor" href="#å››å…ƒå¼ä¸­é—´ä»£ç "></a> å››å…ƒå¼ä¸­é—´ä»£ç </h3><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/202212031445486.png" alt="" /></p><h2 id="ä¼˜åŒ–"><a class="markdownIt-Anchor" href="#ä¼˜åŒ–"></a> ä¼˜åŒ–</h2><p>Target: å¯¹å‰é¢äº§ç”Ÿçš„ä¸­é—´ä»£ç è¿›è¡ŒåŠ å·¥å˜æ¢ï¼Œä»¥æœŸåœ¨æœ€åé˜¶æ®µèƒ½äº§ç”Ÿæ›´ä¸ºé«˜æ•ˆçš„ç›®æ ‡ä»£ç </p><p>å¸¸è§çš„ä¼˜åŒ–æœ‰ï¼š</p><ol><li>å…¬å…±å­è¡¨è¾¾å¼çš„æå–</li><li>åˆå¹¶å·²çŸ¥é‡</li><li>åˆ é™¤æ— ç”¨è¯­å¥</li><li>å¾ªç¯ä¼˜åŒ–</li></ol><h2 id="ç›®æ ‡ä»£ç ç”Ÿæˆ"><a class="markdownIt-Anchor" href="#ç›®æ ‡ä»£ç ç”Ÿæˆ"></a> ç›®æ ‡ä»£ç ç”Ÿæˆ</h2><p>Target: æŠŠç»è¿‡ä¼˜åŒ–çš„ä¸­é—´ä»£ç è½¬åŒ–æˆç‰¹å®šæœºå™¨ä¸Šçš„ä½çº§è¯­è¨€ä»£ç </p><p>ç›®æ ‡ä»£ç æœ‰å¤šç§å½¢å¼ï¼š</p><ul><li>ç»å¯¹æŒ‡ä»¤ä»£ç ï¼šå¯<strong>ç«‹å³æ‰§è¡Œ</strong>çš„ç›®æ ‡ä»£ç </li><li>æ±‡ç¼–æŒ‡ä»¤ä»£ç ï¼šæ±‡ç¼–è¯­è¨€ç¨‹åºï¼Œéœ€è¦é€šè¿‡<strong>æ±‡ç¼–</strong>ç¨‹åºæ±‡ç¼–åæ‰èƒ½è¿è¡Œ</li><li>å¯é‡å®šä½æŒ‡ä»¤ä»£ç ï¼šå…ˆå°†å„ç›®æ ‡æ¨¡å—<strong>é“¾æ¥</strong>èµ·æ¥ï¼Œç¡®å®šå˜é‡ã€å¸¸æ•°åœ¨ä¸»å­˜ä¸­çš„ä½ç½®ï¼Œè£…å…¥ä¸»å­˜åæ‰èƒ½æˆä¸ºå¯ä»¥è¿è¡Œçš„ç»å¯¹æŒ‡ä»¤ä»£ç ; æ”¯æŒæ¨¡å—åŒ–çš„ç½‘ç»œå¼€å‘</li></ul><p>Tips: ä¸åŒæœºå™¨çš„ç»å¯¹æŒ‡ä»¤ä»£ç æ˜¯ä¸åŒçš„, å¦‚æœè¦é€‚é…ä¸åŒçš„æœºå™¨ç”Ÿæˆç»å¯¹æŒ‡ä»¤ä»£ç å°±éœ€è¦å¤šç§ç¼–è¯‘ç¨‹åº, æ•ˆç‡è¾ƒä½; å› æ­¤é€‰æ‹©å°†ç¼–è¯‘ç¨‹åºç”Ÿæˆä¸€ç§ä¸­é—´ä»£ç çš„å½¢å¼ï¼ˆæ±‡ç¼–æŒ‡ä»¤ä»£ç ï¼Œä¸ç¡¬ä»¶æ— å…³ï¼‰åç»­é€‚é…çš„ä»»åŠ¡äº¤ç»™æ±‡ç¼–æˆ–é“¾æ¥å®Œæˆ</p><h1 id="è¡¨æ ¼ä¸è¡¨æ ¼ç®¡ç†"><a class="markdownIt-Anchor" href="#è¡¨æ ¼ä¸è¡¨æ ¼ç®¡ç†"></a> è¡¨æ ¼ä¸è¡¨æ ¼ç®¡ç†</h1><p>è¡¨æ ¼, ç”¨æ¥è®°å½•æºç¨‹åºçš„å„ç§ä¿¡æ¯ä»¥åŠç¼–è¯‘è¿‡ç¨‹ä¸­çš„å„ç§çŠ¶å†µ, ä¸»è¦ç”¨äºè¯æ³•åˆ†æã€è¯­æ³•åˆ†æã€ä¸­é—´ä»£ç ç”Ÿæˆ</p><p>å¸¸è§çš„è¡¨æ ¼æœ‰ï¼š</p><ul><li>ç¬¦å·è¡¨</li><li>å¸¸æ•°è¡¨ï¼šç™»è®°å„ç±»å¸¸é‡å€¼ï¼Œä¸åŒç±»å‹çš„å¸¸é‡ç”±ä¸åŒç±»å‹çš„å¸¸é‡è¡¨è¿›è¡Œç»´æŠ¤</li><li>æ ‡å·è¡¨ï¼šç™»è®°æ ‡å·çš„å®šä¹‰ä¸å¼•ç”¨ï¼ˆå°‘ç”¨äº†ï¼‰</li><li>åˆ†ç¨‹åºå…¥å£è¡¨</li><li>ä¸­é—´ä»£ç è¡¨ï¼šå››å…ƒå¼ï¼Œä¸‰å…ƒç»„ç­‰</li></ul><h2 id="ç¬¦å·è¡¨"><a class="markdownIt-Anchor" href="#ç¬¦å·è¡¨"></a> ç¬¦å·è¡¨</h2><p>ç”¨æ¥ç™»è®°åŸç¨‹åºä¸­çš„å¸¸é‡åã€å˜é‡åã€æ•°ç»„åã€è¿‡ç¨‹åç­‰ï¼Œè®°å½•å®ƒä»¬çš„æ€§è´¨ã€å®šä¹‰å’Œå¼•ç”¨æƒ…å†µ</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/202212031513142.png" alt="" /></p><h1 id="å‡ºé”™å¤„ç†"><a class="markdownIt-Anchor" href="#å‡ºé”™å¤„ç†"></a> å‡ºé”™å¤„ç†</h1><p>å¦‚æœæºç¨‹åºæœ‰é”™è¯¯ï¼Œç¼–è¯‘ç¨‹åºåº”è®¾æ³•å‘ç°é”™è¯¯ï¼Œå¹¶æŠ¥å‘Šç»™ç”¨æˆ·</p><p>é”™è¯¯ç±»å‹ï¼š</p><ul><li>è¯­æ³•é”™è¯¯ï¼šåœ¨è¯æ³•åˆ†æå’Œè¯­æ³•åˆ†æé˜¶æ®µæ£€æµ‹å‡ºæ¥</li><li>è¯­ä¹‰é”™è¯¯ï¼šä¸€èˆ¬åœ¨è¯­ä¹‰åˆ†æé˜¶æ®µæ£€æµ‹</li></ul><h1 id="ç¼–è¯‘ç¨‹åºç”Ÿæˆ"><a class="markdownIt-Anchor" href="#ç¼–è¯‘ç¨‹åºç”Ÿæˆ"></a> ç¼–è¯‘ç¨‹åºç”Ÿæˆ</h1><p>æ™®é€šä½¿ç”¨é«˜çº§è¯­è¨€ç¼–å†™ç¼–è¯‘ç¨‹åºï¼Œä¹Ÿå¯èƒ½ç¼–è¯‘ç¨‹åºæ ¸å¿ƒéƒ¨åˆ†å¸¸ç”¨æ±‡ç¼–è¯­è¨€ç¼–å†™å…¶å®ƒéƒ¨åˆ†ç”¨é«˜çº§è¯­è¨€ç¼–å†™</p><p>ç¼–è¯‘å·¥å…·ï¼š</p><ul><li>LEX, è¯æ³•åˆ†æå·¥å…·</li><li>YACC, è‡ªåŠ¨äº§ç”Ÿ LALR åˆ†æè¡¨</li></ul><h1 id="refs"><a class="markdownIt-Anchor" href="#refs"></a> Refs</h1><ul><li><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1cW411B7DW/">å»–è€å¸ˆ-ä¸œå—å¤§å­¦ç¼–è¯‘åŸç†</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Compiler </category>
          
      </categories>
      
      
        <tags>
            
            <tag> compilation principle </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>01-llvm-basic</title>
      <link href="/Coming-blog/2022/11/11/01-llvm-basic/"/>
      <url>/Coming-blog/2022/11/11/01-llvm-basic/</url>
      
        <content type="html"><![CDATA[<h1 id="llvm"><a class="markdownIt-Anchor" href="#llvm"></a> LLVM</h1><p>ç¼–è¯‘å™¨: æŠŠäººç±»å¯è¯»çš„é«˜çº§è¯­è¨€æ˜ å°„åˆ°æœºå™¨æ‰§è¡Œç </p><p>LLVM è®¾è®¡ç†å¿µ: æ¨¡å—åŒ–, ä½¿å¾—æ¯ä¸€ä¸ªç¼–è¯‘é˜¶æ®µéƒ½è¢«ç‹¬ç«‹å‡ºæ¥</p><ul><li>LLVM ä½¿ç”¨ C++ å®Œæˆ, å¹¶ä¸ºç¼–è¯‘å™¨å¼€å‘äººå‘˜æä¾›äº†æ˜“ç”¨è€Œä¸°å¯Œçš„ç¼–ç¨‹æ¥å£å’Œ API, æ‰€ä»¥ LLVM æ˜¯ç›¸å¯¹å®¹æ˜“å­¦ä¹ çš„ç¼–è¯‘å™¨æ¡†æ¶</li><li>ä¸å…¶ä»–ç¼–è¯‘å™¨ï¼ˆå¦‚ GNU Compiler Collection, GCCï¼‰ä¸åŒ, LLVM çš„è®¾è®¡ç›®æ ‡æ˜¯æˆä¸ºä¸€ç³»åˆ—çš„åº“</li></ul><h2 id="llvm-æ±‡ç¼–ç "><a class="markdownIt-Anchor" href="#llvm-æ±‡ç¼–ç "></a> LLVM æ±‡ç¼–ç </h2><p>ä¸‰ç§å½¢å¼: å†…å­˜ç¼–è¯‘å™¨ä¸­çš„ IR, å­˜äºç£ç›˜çš„ bitcode, ç”¨æˆ·å¯è¯»çš„æ±‡ç¼–ç </p><p>LLVM IR åŸºäº SSA (Static Single Assignmentâ€”â€”SSA) å¹¶ä¸”æä¾›äº†ç±»å‹å®‰å…¨æ€§ã€åº•å±‚æ“ä½œæ€§ã€çµæ´»æ€§, å› æ­¤èƒ½å¤Ÿæ¸…æ¥šè¡¨è¾¾ç»å¤§å¤šæ•°é«˜çº§è¯­è¨€, è‡´åŠ›äºæˆä¸ºä¸€ç§è¶³å¤Ÿåº•å±‚çš„é€šç”¨ IR</p><h1 id="opt"><a class="markdownIt-Anchor" href="#opt"></a> OPT</h1><p>LLVM ä¼˜åŒ–å™¨ï¼ˆoptimizerï¼‰, å…¶åŸºäºåº“çš„è®¾è®¡, å…è®¸ä½ é€‰æ‹©å„ä¸ª Pass çš„æ‰§è¡Œé¡ºåº, ä¹Ÿèƒ½å¤Ÿé€‰æ‹©æ‰§è¡Œå“ªäº›ä¼˜åŒ–Pass</p><ul><li>è¡¨æ˜æœ‰ä¸€äº›ä¼˜åŒ–å¯¹ä½ è®¾è®¡çš„ç³»ç»Ÿæ˜¯æ²¡æœ‰å¸®åŠ©çš„, åªæœ‰å°‘æ•°ä¼˜åŒ–ä¼šé’ˆå¯¹ä½ çš„ç³»ç»Ÿ</li><li>åœ¨ LLVM ä¸­, å¦‚æœä½ æƒ³äº†è§£ç‰¹å®šçš„ä¼˜åŒ–å™¨, æ˜¯ä¸éœ€è¦çŸ¥é“æ•´ä¸ªç³»ç»Ÿæ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚ä½ åªéœ€é€‰æ‹©ä¸€ä¸ªä¼˜åŒ–å™¨å¹¶ä½¿ç”¨å®ƒ, æ— é¡»æ‹…å¿ƒå…¶ä»–ä¾èµ–å®ƒçš„ç»„ä»¶</li></ul><h2 id="1-quick-start"><a class="markdownIt-Anchor" href="#1-quick-start"></a> 1 Quick Start</h2><ol><li>åŸå§‹æ–‡ä»¶ <code>01testfile.ll</code></li></ol><pre class="line-numbers language-llvm" data-language="llvm"><code class="language-llvm"><span class="token keyword">define</span> <span class="token type class-name">i32</span> <span class="token variable">@test1</span><span class="token punctuation">(</span><span class="token type class-name">i32</span> <span class="token variable">%A</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token variable">%B</span> <span class="token punctuation">=</span> <span class="token keyword">add</span> <span class="token type class-name">i32</span> <span class="token variable">%A</span><span class="token punctuation">,</span> <span class="token number">0</span>    <span class="token keyword">ret</span> <span class="token type class-name">i32</span> <span class="token variable">%B</span><span class="token punctuation">&#125;</span><span class="token keyword">define</span> <span class="token keyword">internal</span> <span class="token type class-name">i32</span> <span class="token variable">@test</span><span class="token punctuation">(</span><span class="token type class-name">i32</span> <span class="token variable">%X</span><span class="token punctuation">,</span> <span class="token type class-name">i32</span> <span class="token variable">%dead</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">ret</span> <span class="token type class-name">i32</span> <span class="token variable">%X</span><span class="token punctuation">&#125;</span><span class="token keyword">define</span> <span class="token type class-name">i32</span> <span class="token variable">@caller</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token variable">%A</span> <span class="token punctuation">=</span> <span class="token keyword">call</span> <span class="token type class-name">i32</span> <span class="token variable">@test</span><span class="token punctuation">(</span><span class="token type class-name">i32</span> <span class="token number">123</span><span class="token punctuation">,</span> <span class="token type class-name">i32</span> <span class="token number">456</span><span class="token punctuation">)</span>    <span class="token keyword">ret</span> <span class="token type class-name">i32</span> <span class="token variable">%A</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="2"><li>ä½¿ç”¨ <code>-instcombine</code> è¿›è¡Œä¼˜åŒ–, å®ç° <code>Combine redundant instructions</code></li></ol><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">opt-8 -S -instcombine 01testfile.ll -o 01testfile.-instcombine.ll<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å¯ä»¥çœ‹åˆ° <code>@test1</code> å‡½æ•°ä¸­çš„å†—ä½™åŠ æ³•æŒ‡ä»¤ <code>add i32 %A, 0</code> è¢«ä¼˜åŒ–äº†</p><pre class="line-numbers language-llvm" data-language="llvm"><code class="language-llvm"><span class="token comment">; ModuleID = '01testfile.ll'</span><span class="token keyword">source_filename</span> <span class="token punctuation">=</span> <span class="token string">"01testfile.ll"</span><span class="token keyword">define</span> <span class="token type class-name">i32</span> <span class="token variable">@test1</span><span class="token punctuation">(</span><span class="token type class-name">i32</span> <span class="token variable">%A</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">ret</span> <span class="token type class-name">i32</span> <span class="token variable">%A</span><span class="token punctuation">&#125;</span><span class="token comment">; ...</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol><li>ä½¿ç”¨ <code>-deadargelim</code> è¿›è¡Œä¼˜åŒ–, å®ç° <code>Dead Argument Elimination</code></li></ol><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">opt-8 -S -deadargelim 01testfile.ll -o 01testfile.-deadargelim.ll<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å¯ä»¥çœ‹åˆ° <code>@test</code> å‡½æ•°ä¸­çš„æ— ç”¨å‚æ•° <code>i32 %dead</code> è¢«ä¼˜åŒ–æ‰äº†</p><pre class="line-numbers language-llvm" data-language="llvm"><code class="language-llvm"><span class="token comment">; ...</span><span class="token keyword">define</span> <span class="token keyword">internal</span> <span class="token type class-name">i32</span> <span class="token variable">@test</span><span class="token punctuation">(</span><span class="token type class-name">i32</span> <span class="token variable">%X</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">ret</span> <span class="token type class-name">i32</span> <span class="token variable">%X</span><span class="token punctuation">&#125;</span><span class="token keyword">define</span> <span class="token type class-name">i32</span> <span class="token variable">@caller</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token variable">%A</span> <span class="token punctuation">=</span> <span class="token keyword">call</span> <span class="token type class-name">i32</span> <span class="token variable">@test</span><span class="token punctuation">(</span><span class="token type class-name">i32</span> <span class="token number">123</span><span class="token punctuation">)</span>  <span class="token keyword">ret</span> <span class="token type class-name">i32</span> <span class="token variable">%A</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="opt-pass"><a class="markdownIt-Anchor" href="#opt-pass"></a> OPT Pass</h2><p>LLVM ä¼˜åŒ–å™¨ä¸ºç”¨æˆ·æä¾›äº†ä¸åŒçš„ä¼˜åŒ– Pass, ä½†æ•´ä½“çš„ç¼–å†™é£æ ¼ä¸€è‡´:</p><ul><li>å¯¹æ¯ä¸ª Pass çš„æºç ç¼–è¯‘, å¾—åˆ°ä¸€ä¸ª Object æ–‡ä»¶, ä¹‹åè¿™äº›ä¸åŒçš„æ–‡ä»¶å†é“¾æ¥å¾—åˆ°ä¸€ä¸ªåº“</li><li>Pass ä¹‹é—´è€¦åˆå¾ˆå°, Pass ä¹‹é—´çš„ä¾èµ–ä¿¡æ¯ç”± LLVM Pass ç®¡ç†å™¨ï¼ˆPassManagerï¼‰æ¥ç»Ÿä¸€ç®¡ç†, åœ¨ Pass è¿è¡Œçš„æ—¶å€™ä¼šè¿›è¡Œè§£æ</li></ul><p>ä¸‹é¢çš„å›¾ç‰‡å±•ç¤ºäº†æ¯ä¸ª Pass å¦‚ä½•å…³è”åˆ°æŒ‡å®šåº“ä¸­çš„ç‰¹å®šçš„ Object æ–‡ä»¶:</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/202211111142920.png" alt="" /></p><p>å¯ä»¥ç†è§£ä¸º PassA ä¸­ PassA.o å¼•ç”¨äº† LLVMPasses.a, è€Œè‡ªå®šä¹‰çš„ Pass ä¸­ MyPass.o å¼•ç”¨äº†ä¸åŒçš„åº“, å³ MyPasses.a</p><h1 id="code-generator"><a class="markdownIt-Anchor" href="#code-generator"></a> Code Generator</h1><p>LLVM ä»£ç ç”Ÿæˆå™¨ï¼ˆcode generatorï¼‰ä¹Ÿé‡‡ç”¨äº†æ¨¡å—çš„è®¾è®¡ç†å¿µ:</p><ul><li>å°†ä»£ç ç”Ÿæˆé—®é¢˜åˆ†è§£ä¸ºå¤šä¸ªç‹¬ç«‹ Passï¼šæŒ‡ä»¤é€‰æ‹©ã€å¯„å­˜å™¨åˆ†é…ã€æŒ‡ä»¤è°ƒåº¦ã€ä»£ç å¸ƒå±€ä¼˜åŒ–ã€ä»£ç å‘å°„</li><li>åŒæ ·, ä¹Ÿæœ‰è®¸å¤šå†…å»ºçš„ Pass, å®ƒä»¬é»˜è®¤æ‰§è¡Œ, ä½†ç”¨æˆ·å¯ä»¥é€‰æ‹©åªæ‰§è¡Œå…¶ä¸­ä¸€éƒ¨åˆ†</li></ul><h1 id="äº¤å‰ç¼–è¯‘"><a class="markdownIt-Anchor" href="#äº¤å‰ç¼–è¯‘"></a> äº¤å‰ç¼–è¯‘</h1><p>äº¤å‰ç¼–è¯‘, æŒ‡çš„æ˜¯æˆ‘ä»¬èƒ½å¤Ÿåœ¨ä¸€ä¸ªå¹³å°ï¼ˆä¾‹å¦‚x86ï¼‰ç¼–è¯‘å¹¶æ„å»ºäºŒè¿›åˆ¶æ–‡ä»¶, è€Œåœ¨å¦ä¸€ä¸ªå¹³å°ï¼ˆä¾‹å¦‚ARMï¼‰è¿è¡Œ</p><ul><li>ç¼–è¯‘äºŒè¿›åˆ¶æ–‡ä»¶çš„æœºå™¨ç§°ä¸ºä¸»æœºï¼ˆhostï¼‰, è€Œè¿è¡Œç”Ÿæˆçš„äºŒè¿›åˆ¶æ–‡ä»¶çš„å¹³å°æˆ‘ä»¬ç§°ä¸ºç›®æ ‡å¹³å°ï¼ˆtargetï¼‰</li><li>ä¸ºç›¸åŒå¹³å°ï¼ˆä¸»æœºä¸ç›®æ ‡æœºå™¨ç›¸åŒï¼‰ç¼–è¯‘ä»£ç æˆ‘ä»¬ç§°ä¸ºæœ¬æœºç¼–è¯‘, native assembler</li><li>ä¸ºä¸åŒå¹³å°ï¼ˆä¸»æœºä¸ç›®æ ‡æœºå™¨ä¸åŒï¼‰ç¼–è¯‘ä»£ç åˆ™ç§°ä¸ºäº¤å‰ç¼–è¯‘, cross-compiler</li></ul><h1 id="cmd-quick-start"><a class="markdownIt-Anchor" href="#cmd-quick-start"></a> CMD Quick Start</h1><h2 id="2-c-to-llvm-ir"><a class="markdownIt-Anchor" href="#2-c-to-llvm-ir"></a> 2 C to LLVM IR</h2><p>ç®€è¦æµç¨‹: ä½¿ç”¨ clang å‰ç«¯å°† C è½¬ä¸º IR</p><ul><li>è¯æ³•åˆ†æ: å°† C è¯­è¨€æºç åˆ†è§£æˆ token æµ, æ¯ä¸ª token å¯è¡¨ç¤ºæ ‡è¯†ç¬¦ã€å­—é¢é‡ã€è¿ç®—ç¬¦ç­‰</li><li>è¯­æ³•åˆ†æ: token æµä¼šä¼ é€’ç»™è¯­æ³•åˆ†æå™¨, è¯­æ³•åˆ†æå™¨ä¼šåœ¨è¯­è¨€çš„CFGï¼ˆContext Free Grammar, ä¸Šä¸‹æ–‡æ— å…³æ–‡æ³•ï¼‰çš„æŒ‡å¯¼ä¸‹å°† token æµç»„ç»‡æˆASTï¼ˆæŠ½è±¡è¯­æ³•æ ‘ï¼‰</li><li>è¯­ä¹‰åˆ†æ: æ£€æŸ¥è¯­ä¹‰æ­£ç¡®æ€§, ç„¶åç”Ÿæˆ IR</li></ul><ol><li>ç¤ºä¾‹ C ä»£ç </li></ol><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> <span class="token function">mult</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">int</span> a <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>    <span class="token keyword">int</span> b <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>    <span class="token keyword">int</span> c <span class="token operator">=</span> a <span class="token operator">*</span> b<span class="token punctuation">;</span>    <span class="token keyword">return</span> c<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="2"><li>ä½¿ç”¨ <code>clang</code> å°† C è½¬ä¸º LLVM IR</li></ol><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">clang-8 -emit-llvm -S 02multiply.c -o 02multiply.ll<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-llvm" data-language="llvm"><code class="language-llvm"><span class="token comment">; ModuleID = '02multiply.c'</span><span class="token keyword">source_filename</span> <span class="token punctuation">=</span> <span class="token string">"02multiply.c"</span><span class="token keyword">target</span> <span class="token keyword">datalayout</span> <span class="token punctuation">=</span> <span class="token string">"e-m:e-i64:64-f80:128-n8:16:32:64-S128"</span><span class="token keyword">target</span> <span class="token keyword">triple</span> <span class="token punctuation">=</span> <span class="token string">"x86_64-pc-linux-gnu"</span><span class="token comment">; Function Attrs: noinline nounwind optnone uwtable</span><span class="token keyword">define</span> <span class="token keyword">dso_local</span> <span class="token type class-name">i32</span> <span class="token variable">@mult</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token variable">#0</span> <span class="token punctuation">&#123;</span>  <span class="token variable">%1</span> <span class="token punctuation">=</span> <span class="token keyword">alloca</span> <span class="token type class-name">i32</span><span class="token punctuation">,</span> <span class="token keyword">align</span> <span class="token number">4</span>  <span class="token variable">%2</span> <span class="token punctuation">=</span> <span class="token keyword">alloca</span> <span class="token type class-name">i32</span><span class="token punctuation">,</span> <span class="token keyword">align</span> <span class="token number">4</span>  <span class="token variable">%3</span> <span class="token punctuation">=</span> <span class="token keyword">alloca</span> <span class="token type class-name">i32</span><span class="token punctuation">,</span> <span class="token keyword">align</span> <span class="token number">4</span>  <span class="token keyword">store</span> <span class="token type class-name">i32</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token type class-name">i32</span><span class="token punctuation">*</span> <span class="token variable">%1</span><span class="token punctuation">,</span> <span class="token keyword">align</span> <span class="token number">4</span>  <span class="token keyword">store</span> <span class="token type class-name">i32</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token type class-name">i32</span><span class="token punctuation">*</span> <span class="token variable">%2</span><span class="token punctuation">,</span> <span class="token keyword">align</span> <span class="token number">4</span>  <span class="token variable">%4</span> <span class="token punctuation">=</span> <span class="token keyword">load</span> <span class="token type class-name">i32</span><span class="token punctuation">,</span> <span class="token type class-name">i32</span><span class="token punctuation">*</span> <span class="token variable">%1</span><span class="token punctuation">,</span> <span class="token keyword">align</span> <span class="token number">4</span>  <span class="token variable">%5</span> <span class="token punctuation">=</span> <span class="token keyword">load</span> <span class="token type class-name">i32</span><span class="token punctuation">,</span> <span class="token type class-name">i32</span><span class="token punctuation">*</span> <span class="token variable">%2</span><span class="token punctuation">,</span> <span class="token keyword">align</span> <span class="token number">4</span>  <span class="token variable">%6</span> <span class="token punctuation">=</span> <span class="token keyword">mul</span> <span class="token keyword">nsw</span> <span class="token type class-name">i32</span> <span class="token variable">%4</span><span class="token punctuation">,</span> <span class="token variable">%5</span>  <span class="token keyword">store</span> <span class="token type class-name">i32</span> <span class="token variable">%6</span><span class="token punctuation">,</span> <span class="token type class-name">i32</span><span class="token punctuation">*</span> <span class="token variable">%3</span><span class="token punctuation">,</span> <span class="token keyword">align</span> <span class="token number">4</span>  <span class="token variable">%7</span> <span class="token punctuation">=</span> <span class="token keyword">load</span> <span class="token type class-name">i32</span><span class="token punctuation">,</span> <span class="token type class-name">i32</span><span class="token punctuation">*</span> <span class="token variable">%3</span><span class="token punctuation">,</span> <span class="token keyword">align</span> <span class="token number">4</span>  <span class="token keyword">ret</span> <span class="token type class-name">i32</span> <span class="token variable">%7</span><span class="token punctuation">&#125;</span><span class="token keyword">attributes</span> <span class="token variable">#0</span> <span class="token punctuation">=</span> <span class="token punctuation">&#123;</span> <span class="token keyword">noinline</span> <span class="token keyword">nounwind</span> <span class="token keyword">optnone</span> <span class="token keyword">uwtable</span> <span class="token string">"correctly-rounded-divide-sqrt-fp-math"</span><span class="token punctuation">=</span><span class="token string">"false"</span> <span class="token string">"disable-tail-calls"</span><span class="token punctuation">=</span><span class="token string">"false"</span> <span class="token string">"less-precise-fpmad"</span><span class="token punctuation">=</span><span class="token string">"false"</span> <span class="token string">"min-legal-vector-width"</span><span class="token punctuation">=</span><span class="token string">"0"</span> <span class="token string">"no-frame-pointer-elim"</span><span class="token punctuation">=</span><span class="token string">"true"</span> <span class="token string">"no-frame-pointer-elim-non-leaf"</span> <span class="token string">"no-infs-fp-math"</span><span class="token punctuation">=</span><span class="token string">"false"</span> <span class="token string">"no-jump-tables"</span><span class="token punctuation">=</span><span class="token string">"false"</span> <span class="token string">"no-nans-fp-math"</span><span class="token punctuation">=</span><span class="token string">"false"</span> <span class="token string">"no-signed-zeros-fp-math"</span><span class="token punctuation">=</span><span class="token string">"false"</span> <span class="token string">"no-trapping-math"</span><span class="token punctuation">=</span><span class="token string">"false"</span> <span class="token string">"stack-protector-buffer-size"</span><span class="token punctuation">=</span><span class="token string">"8"</span> <span class="token string">"target-cpu"</span><span class="token punctuation">=</span><span class="token string">"x86-64"</span> <span class="token string">"target-features"</span><span class="token punctuation">=</span><span class="token string">"+fxsr,+mmx,+sse,+sse2,+x87"</span> <span class="token string">"unsafe-fp-math"</span><span class="token punctuation">=</span><span class="token string">"false"</span> <span class="token string">"use-soft-float"</span><span class="token punctuation">=</span><span class="token string">"false"</span> <span class="token punctuation">&#125;</span><span class="token variable">!llvm.module.flags</span> <span class="token punctuation">=</span> <span class="token punctuation">!</span><span class="token punctuation">&#123;</span><span class="token variable">!0</span><span class="token punctuation">&#125;</span><span class="token variable">!llvm.ident</span> <span class="token punctuation">=</span> <span class="token punctuation">!</span><span class="token punctuation">&#123;</span><span class="token variable">!1</span><span class="token punctuation">&#125;</span><span class="token variable">!0</span> <span class="token punctuation">=</span> <span class="token punctuation">!</span><span class="token punctuation">&#123;</span><span class="token type class-name">i32</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token punctuation">!</span><span class="token string">"wchar_size"</span><span class="token punctuation">,</span> <span class="token type class-name">i32</span> <span class="token number">4</span><span class="token punctuation">&#125;</span><span class="token variable">!1</span> <span class="token punctuation">=</span> <span class="token punctuation">!</span><span class="token punctuation">&#123;</span><span class="token punctuation">!</span><span class="token string">"clang version 8.0.1-svn363027-1~exp1~20190611211629.77 (branches/release_80)"</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="3"><li>æˆ–è€…ä½¿ç”¨ <code>cc1</code> å®ç° C å‘ LLVM IR çš„è½¬æ¢</li></ol><p>Tips: æ˜¯ cc1, æ•°å­— 1, ä¸æ˜¯å­—æ¯ L</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">clang-8 -cc1 -emit-llvm 02multiply.c -o 02multiply-ccl.ll<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>é€šè¿‡ä¸‹é¢çš„ IR å¯ä»¥çœ‹å‡º, IR çš„ä»£ç é£æ ¼æœ‰æ‰€ä¸ä¸€è‡´</p><pre class="line-numbers language-llvm" data-language="llvm"><code class="language-llvm"><span class="token comment">; ModuleID = '02multiply.c'</span><span class="token keyword">source_filename</span> <span class="token punctuation">=</span> <span class="token string">"02multiply.c"</span><span class="token keyword">target</span> <span class="token keyword">datalayout</span> <span class="token punctuation">=</span> <span class="token string">"e-m:e-i64:64-f80:128-n8:16:32:64-S128"</span><span class="token keyword">target</span> <span class="token keyword">triple</span> <span class="token punctuation">=</span> <span class="token string">"x86_64-pc-linux-gnu"</span><span class="token comment">; Function Attrs: noinline nounwind optnone</span><span class="token keyword">define</span> <span class="token type class-name">i32</span> <span class="token variable">@mult</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token variable">#0</span> <span class="token punctuation">&#123;</span><span class="token label">entry:</span>  <span class="token variable">%a</span> <span class="token punctuation">=</span> <span class="token keyword">alloca</span> <span class="token type class-name">i32</span><span class="token punctuation">,</span> <span class="token keyword">align</span> <span class="token number">4</span>  <span class="token variable">%b</span> <span class="token punctuation">=</span> <span class="token keyword">alloca</span> <span class="token type class-name">i32</span><span class="token punctuation">,</span> <span class="token keyword">align</span> <span class="token number">4</span>  <span class="token variable">%c</span> <span class="token punctuation">=</span> <span class="token keyword">alloca</span> <span class="token type class-name">i32</span><span class="token punctuation">,</span> <span class="token keyword">align</span> <span class="token number">4</span>  <span class="token keyword">store</span> <span class="token type class-name">i32</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token type class-name">i32</span><span class="token punctuation">*</span> <span class="token variable">%a</span><span class="token punctuation">,</span> <span class="token keyword">align</span> <span class="token number">4</span>  <span class="token keyword">store</span> <span class="token type class-name">i32</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token type class-name">i32</span><span class="token punctuation">*</span> <span class="token variable">%b</span><span class="token punctuation">,</span> <span class="token keyword">align</span> <span class="token number">4</span>  <span class="token variable">%0</span> <span class="token punctuation">=</span> <span class="token keyword">load</span> <span class="token type class-name">i32</span><span class="token punctuation">,</span> <span class="token type class-name">i32</span><span class="token punctuation">*</span> <span class="token variable">%a</span><span class="token punctuation">,</span> <span class="token keyword">align</span> <span class="token number">4</span>  <span class="token variable">%1</span> <span class="token punctuation">=</span> <span class="token keyword">load</span> <span class="token type class-name">i32</span><span class="token punctuation">,</span> <span class="token type class-name">i32</span><span class="token punctuation">*</span> <span class="token variable">%b</span><span class="token punctuation">,</span> <span class="token keyword">align</span> <span class="token number">4</span>  <span class="token variable">%mul</span> <span class="token punctuation">=</span> <span class="token keyword">mul</span> <span class="token keyword">nsw</span> <span class="token type class-name">i32</span> <span class="token variable">%0</span><span class="token punctuation">,</span> <span class="token variable">%1</span>  <span class="token keyword">store</span> <span class="token type class-name">i32</span> <span class="token variable">%mul</span><span class="token punctuation">,</span> <span class="token type class-name">i32</span><span class="token punctuation">*</span> <span class="token variable">%c</span><span class="token punctuation">,</span> <span class="token keyword">align</span> <span class="token number">4</span>  <span class="token variable">%2</span> <span class="token punctuation">=</span> <span class="token keyword">load</span> <span class="token type class-name">i32</span><span class="token punctuation">,</span> <span class="token type class-name">i32</span><span class="token punctuation">*</span> <span class="token variable">%c</span><span class="token punctuation">,</span> <span class="token keyword">align</span> <span class="token number">4</span>  <span class="token keyword">ret</span> <span class="token type class-name">i32</span> <span class="token variable">%2</span><span class="token punctuation">&#125;</span><span class="token keyword">attributes</span> <span class="token variable">#0</span> <span class="token punctuation">=</span> <span class="token punctuation">&#123;</span> <span class="token keyword">noinline</span> <span class="token keyword">nounwind</span> <span class="token keyword">optnone</span> <span class="token string">"correctly-rounded-divide-sqrt-fp-math"</span><span class="token punctuation">=</span><span class="token string">"false"</span> <span class="token string">"disable-tail-calls"</span><span class="token punctuation">=</span><span class="token string">"false"</span> <span class="token string">"less-precise-fpmad"</span><span class="token punctuation">=</span><span class="token string">"false"</span> <span class="token string">"min-legal-vector-width"</span><span class="token punctuation">=</span><span class="token string">"0"</span> <span class="token string">"no-frame-pointer-elim"</span><span class="token punctuation">=</span><span class="token string">"false"</span> <span class="token string">"no-infs-fp-math"</span><span class="token punctuation">=</span><span class="token string">"false"</span> <span class="token string">"no-jump-tables"</span><span class="token punctuation">=</span><span class="token string">"false"</span> <span class="token string">"no-nans-fp-math"</span><span class="token punctuation">=</span><span class="token string">"false"</span> <span class="token string">"no-signed-zeros-fp-math"</span><span class="token punctuation">=</span><span class="token string">"false"</span> <span class="token string">"no-trapping-math"</span><span class="token punctuation">=</span><span class="token string">"false"</span> <span class="token string">"stack-protector-buffer-size"</span><span class="token punctuation">=</span><span class="token string">"8"</span> <span class="token string">"target-features"</span><span class="token punctuation">=</span><span class="token string">"+mmx,+sse,+sse2,+x87"</span> <span class="token string">"unsafe-fp-math"</span><span class="token punctuation">=</span><span class="token string">"false"</span> <span class="token string">"use-soft-float"</span><span class="token punctuation">=</span><span class="token string">"false"</span> <span class="token punctuation">&#125;</span><span class="token variable">!llvm.module.flags</span> <span class="token punctuation">=</span> <span class="token punctuation">!</span><span class="token punctuation">&#123;</span><span class="token variable">!0</span><span class="token punctuation">&#125;</span><span class="token variable">!llvm.ident</span> <span class="token punctuation">=</span> <span class="token punctuation">!</span><span class="token punctuation">&#123;</span><span class="token variable">!1</span><span class="token punctuation">&#125;</span><span class="token variable">!0</span> <span class="token punctuation">=</span> <span class="token punctuation">!</span><span class="token punctuation">&#123;</span><span class="token type class-name">i32</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token punctuation">!</span><span class="token string">"wchar_size"</span><span class="token punctuation">,</span> <span class="token type class-name">i32</span> <span class="token number">4</span><span class="token punctuation">&#125;</span><span class="token variable">!1</span> <span class="token punctuation">=</span> <span class="token punctuation">!</span><span class="token punctuation">&#123;</span><span class="token punctuation">!</span><span class="token string">"clang version 8.0.1-svn363027-1~exp1~20190611211629.77 (branches/release_80)"</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="3-llvm-ir-to-bitcode"><a class="markdownIt-Anchor" href="#3-llvm-ir-to-bitcode"></a> 3 LLVM IR to bitcode</h2><p>LLVM Bitecode, ä¹Ÿç§°ä¸ºå­—èŠ‚ç  (bytecode), ç”±ä¸¤éƒ¨åˆ†ç»„æˆ:</p><ul><li>ä½æµ, bitstream, å¯ç±»æ¯”å­—èŠ‚æµ</li><li>ç¼–ç æ ¼å¼: å°† LLVM IR ç¼–ç æˆä½æµçš„ç¼–ç æ ¼å¼</li></ul><p><code>llvm-as</code> æ˜¯ LLVM çš„æ±‡ç¼–å™¨, å°† LLVM IR è½¬ä¸º bitcode (å¯ä»¥ç†è§£ä¸ºå°†æ™®é€šçš„æ±‡ç¼–ç è½¬ä¸ºå¯æ‰§è¡Œæ–‡ä»¶)</p><p>åœ¨å°† LLVM IR è½¬ä¸º bitcode è¿‡ç¨‹ä¸­, å¼•å…¥äº†åŒºå—ï¼ˆblockï¼‰å’Œè®°å½•ï¼ˆrecordï¼‰çš„æ¦‚å¿µ:</p><ul><li>åŒºå—: è¡¨ç¤ºä½æµçš„åŒºåŸŸ, ä¾‹å¦‚ä¸€ä¸ªå‡½æ•°ä½“ã€ç¬¦å·è¡¨ç­‰; æ¯ä¸ªåŒºå—çš„å†…å®¹éƒ½å¯¹åº”ä¸€ä¸ªç‰¹å®šçš„ ID, ä¾‹å¦‚ LLVM IR ä¸­å‡½æ•°ä½“çš„ ID æ˜¯ 12</li><li>è®°å½•: ç”±ä¸€ä¸ªè®°å½•ç å’Œä¸€ä¸ªæ•´æ•°å€¼ç»„æˆ, æè¿°äº†åœ¨æŒ‡ä»¤ã€å…¨å±€å˜é‡æè¿°ç¬¦ã€ç±»å‹æè¿°ä¸­çš„å®ä½“</li></ul><p>LLVM IR çš„ bitcode æ–‡ä»¶ç”±ä¸€ä¸ªç®€å•çš„å°è£…ç»“æ„å°è£…, ç»“æ„åŒ…æ‹¬ä¸€ä¸ªæè¿°æ–‡ä»¶æ®µè½åç§»é‡çš„ç®€å•æè¿°å¤´, ä»¥åŠå†…åµŒ BC æ–‡ä»¶çš„å¤§å°</p><ol><li>å‡†å¤‡ç¤ºä¾‹çš„ LLVM IR</li></ol><pre class="line-numbers language-llvm" data-language="llvm"><code class="language-llvm"><span class="token keyword">define</span> <span class="token type class-name">i32</span> <span class="token variable">@mult</span><span class="token punctuation">(</span><span class="token type class-name">i32</span> <span class="token variable">%a</span><span class="token punctuation">,</span> <span class="token type class-name">i32</span> <span class="token variable">%b</span><span class="token punctuation">)</span> <span class="token variable">#0</span> <span class="token punctuation">&#123;</span>    <span class="token variable">%1</span> <span class="token punctuation">=</span> <span class="token keyword">mul</span> <span class="token keyword">nsw</span> <span class="token type class-name">i32</span> <span class="token variable">%a</span><span class="token punctuation">,</span> <span class="token variable">%b</span>    <span class="token keyword">ret</span> <span class="token type class-name">i32</span> <span class="token variable">%1</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><ol start="2"><li>ä½¿ç”¨ <code>llvm-as</code> å°† LLVM IR è½¬ä¸º bitcode æ ¼å¼</li></ol><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">llvm-as-8 03test.ll -o 03test.bc<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ol start="3"><li>ä½¿ç”¨ <code>hexdump</code> å·¥å…·æŸ¥çœ‹ bitcode äºŒè¿›åˆ¶æ–‡ä»¶</li></ol><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/202211111208934.png" alt="" /></p><h2 id="4-llvm-bitcode-to-asm"><a class="markdownIt-Anchor" href="#4-llvm-bitcode-to-asm"></a> 4 LLVM bitcode to ASM</h2><p>å°† LLVM bitcode æ–‡ä»¶è½¬æ¢ä¸ºç›®æ ‡å¹³å°çš„æ±‡ç¼–ä»£ç </p><ol><li><p>ä½¿ç”¨ <a href="#llvm-ir-to-bitcode">ä¸Šä¸€ä¸ªå®éªŒçš„è¾“å‡º 03test.bc</a> ä½œä¸ºæœ¬å®éªŒçš„è¾“å…¥</p></li><li><p>ä½¿ç”¨ <code>llc</code> å®ç° bitcode2asm</p></li></ol><ul><li>è¾“å…¥æ ¼å¼æ”¯æŒ <code>.bc</code> ä¸ <code>.ll</code></li></ul><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"># é»˜è®¤çš„é€‚é…æ¶æ„ç”±æœ¬æœºå†³å®šllc-8 03test.bc -o 04test.s<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/202211121219558.png" alt="" /></p><ol><li>æŸ¥çœ‹æ±‡ç¼–æ–‡ä»¶, æ±‡ç¼–çš„æ ¼å¼ä¸º AT&amp;T æ ¼å¼</li></ol><pre class="line-numbers language-asm" data-language="asm"><code class="language-asm">        .text        .file   &quot;03test.ll&quot;        .globl  mult                    # -- Begin function mult        .p2align        4, 0x90        .type   mult,@functionmult:                                   # @mult        .cfi_startproc# %bb.0:        movl    %edi, %eax        imull   %esi, %eax        retq.Lfunc_end0:        .size   mult, .Lfunc_end0-mult        .cfi_endproc                                        # -- End function        .section        &quot;.note.GNU-stack&quot;,&quot;&quot;,@progbits<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="4"><li>æˆ–è€…ä½¿ç”¨ <code>clang</code> å®ç° bitcode2asm</li></ol><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">clang-8 -S 03test.bc -o 04test_clang.s -fomit-frame-pointer# fomit-fram-pointer å¼€å¯æ¶ˆé™¤å‡½æ•°æ ˆå¸§é¡¶æŒ‡é’ˆåŠŸèƒ½, clang é»˜è®¤æ˜¯å…³é—­æ­¤é€‰é¡¹çš„, llc é»˜è®¤æ˜¯å¼€å¯çš„<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/202211121228155.png" alt="" /></p><h3 id="æŒ‡å®šæ¶æ„"><a class="markdownIt-Anchor" href="#æŒ‡å®šæ¶æ„"></a> æŒ‡å®šæ¶æ„</h3><p>å¯ä»¥ä½¿ç”¨ -march æ‰§è¡Œå…·ä½“çš„ CPU æ¶æ„</p><p>ç‰¹åˆ«çš„, x86 æ¶æ„æœ‰ä¸¤ç§æ±‡ç¼–é£æ ¼, <code>AT&amp;T</code> ä¸ <code>intel</code>, è¿™ä¸ªéœ€è¦é€šè¿‡ <code>-x86-asm-syntax=[att|intel]</code> æ¥æŒ‡å®š</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">llc-8 -march&#x3D;x86-64 -x86-asm-syntax&#x3D;intel 03test.bc -o 04test_intel.s<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/202211121509150.png" alt="" /></p><p>é€šè¿‡ <code>llc --version</code> å¯ä»¥æŸ¥çœ‹ <code>-march</code> å‚æ•°å¯é€‰çš„å€¼</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">LLVM (http:&#x2F;&#x2F;llvm.org&#x2F;):  LLVM version 8.0.1  Optimized build.  Default target: x86_64-pc-linux-gnu  Host CPU: (unknown)  Registered Targets:    aarch64    - AArch64 (little endian)    aarch64_be - AArch64 (big endian)    amdgcn     - AMD GCN GPUs    arm        - ARM    arm64      - ARM64 (little endian)    armeb      - ARM (big endian)    avr        - Atmel AVR Microcontroller    bpf        - BPF (host endian)    bpfeb      - BPF (big endian)    bpfel      - BPF (little endian)    hexagon    - Hexagon    lanai      - Lanai    mips       - MIPS (32-bit big endian)    mips64     - MIPS (64-bit big endian)    mips64el   - MIPS (64-bit little endian)    mipsel     - MIPS (32-bit little endian)    msp430     - MSP430 [experimental]    nvptx      - NVIDIA PTX 32-bit    nvptx64    - NVIDIA PTX 64-bit    ppc32      - PowerPC 32    ppc64      - PowerPC 64    ppc64le    - PowerPC 64 LE    r600       - AMD GPUs HD2XXX-HD6XXX    sparc      - Sparc    sparcel    - Sparc LE    sparcv9    - Sparc V9    systemz    - SystemZ    thumb      - Thumb    thumbeb    - Thumb (big endian)    wasm32     - WebAssembly 32-bit    wasm64     - WebAssembly 64-bit    x86        - 32-bit X86: Pentium-Pro and above    x86-64     - 64-bit X86: EM64T and AMD64    xcore      - XCore<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="5-llvm-bitcode-to-llvm-æ±‡ç¼–ç "><a class="markdownIt-Anchor" href="#5-llvm-bitcode-to-llvm-æ±‡ç¼–ç "></a> 5 LLVM bitcode to LLVM æ±‡ç¼–ç </h2><p>ä½¿ç”¨ <code>llvm-dis</code> (LLVM åæ±‡ç¼–å™¨) å®ç° LLVM bitcode (.bc) è½¬å› LLVM IR (.ll)</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">llvm-dis-8 03test.bc -o 05test.ll<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/202211121514660.png" alt="" /></p><h2 id="6-ir-transform"><a class="markdownIt-Anchor" href="#6-ir-transform"></a> 6 IR Transform</h2><p>ä¸»è¦åˆ©ç”¨ <code>opt</code> å·¥å…·å®ç° IR å½¢å¼çš„è½¬åŒ–ä¸ä»£ç çš„ä¼˜åŒ–</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">opt-8 -mem2reg -S 02multiply.ll -o 06multiply.-mem2reg.ll<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li><code>-mem2reg</code>: ä¸»è¦ä¼˜åŒ–å†…å­˜è®¿é—®, å°†å±€éƒ¨å˜é‡ä»å†…å­˜æå‡åˆ°å¯„å­˜å™¨</li></ul><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/202211121535088.png" alt="" /></p><p>å¦‚ä¸Šå›¾æ‰€ç¤º, è¿™é‡ŒæŒ‰ç…§ä¹¦ä¸­çš„æ­¥éª¤æ‰§è¡Œä¼šå‘ç° <code>-mem2reg</code> å¹¶æ²¡æœ‰ä»»ä½•æ•ˆæœ, è¿™æ˜¯<a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/46513801/llvm-opt-mem2reg-has-no-effect">å› ä¸º</a> clang å°† c è½¬ä¸º ll æ—¶é»˜è®¤çš„ä¼˜åŒ–çº§åˆ«æ—¶ O0, è¿™ä¸ªçº§åˆ«ä¼šä¸ºç”Ÿæˆæ±‡ç¼–ç ä¸­çš„æ¯ä¸ªå‡½æ•°æ·»åŠ ä¸€ä¸ªå±æ€§ <code>optnone</code> æ˜¾ç¤ºçš„é˜»æ–­åç»­çš„ä¼˜åŒ– pass</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/202211121538419.png" alt="" /></p><p>ä¸ºäº†é¿å…è¿™ä¸ªé—®é¢˜, éœ€è¦åœ¨ clang è½¬æ¢æ—¶æ·»åŠ å±æ€§ <code>-Xclang -disable-O0-optnone</code> å°† &quot;å°å°è§£é™¤&quot; å°±å¯ä»¥å•ç‹¬è¿›è¡Œ <code>-mem2reg</code> çš„ä¼˜åŒ–å¹¶çœ‹åˆ°æ•ˆæœäº†</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">clang-8 -emit-llvm -S 06multiply.c -Xclang -disable-O0-optnone -o 06multiply.llopt-8 -mem2reg -S 06multiply.ll -o 06multiply.-mem2reg.llcat 06multiply.-mem2reg.ll<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/202211121543787.png" alt="" /></p><h2 id="7-é“¾æ¥-llvm-bitcode"><a class="markdownIt-Anchor" href="#7-é“¾æ¥-llvm-bitcode"></a> 7 é“¾æ¥ LLVM bitcode</h2><p>llvm-link çš„åŠŸèƒ½å’Œä¼ ç»Ÿçš„é“¾æ¥å™¨ä¸€è‡´: å¦‚æœä¸€ä¸ªå‡½æ•°æˆ–è€…å˜é‡åœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­è¢«å¼•ç”¨, å´åœ¨å¦ä¸€ä¸ªæ–‡ä»¶ä¸­å®šä¹‰, é‚£ä¹ˆé“¾æ¥å™¨å°±ä¼šè§£æè¿™ä¸ªæ–‡ä»¶ä¸­å¼•ç”¨çš„ç¬¦å·, åªä¸è¿‡å…¶é’ˆå¯¹çš„æ˜¯ llvm bitcode æ–‡ä»¶è€Œé object</p><ol><li>å‡†å¤‡å¦‚ä¸‹ä¸¤ä¸ªæ–‡ä»¶, å‡†å¤‡è¿›è¡Œè¿æ¥</li></ol><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token comment">// 07test1.c</span><span class="token keyword">int</span> <span class="token function">func</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    a <span class="token operator">=</span> a <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> a<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">// 07test2.c</span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;stdio.h></span></span><span class="token keyword">extern</span> <span class="token keyword">int</span> <span class="token function">func</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">int</span> num <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>    num <span class="token operator">=</span> <span class="token function">func</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"number is %d\n"</span><span class="token punctuation">,</span> num<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> num<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="2"><li>å°† C è½¬ä¸º LLVM bitcode (ä½æµæ–‡ä»¶æ ¼å¼): c -&gt; ll -&gt; bc</li></ol><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">clang-8 -emit-llvm -S 07test1.c -o 07test1.llclang-8 -emit-llvm -S 07test2.c -o 07test2.llllvm-as-8 07test1.ll -o 07test1.bcllvm-as-8 07test2.ll -o 07test2.bc<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>æ­¤æ—¶ test2.bc å¼•ç”¨äº† test1.bc æ–‡ä»¶ä¸­çš„ func å‡½æ•°</p><ol start="3"><li>ä½¿ç”¨ <code>llvm-link</code> å‘½ä»¤é“¾æ¥ä¸¤ä¸ª LLVM bitcode æ–‡ä»¶</li></ol><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">llvm-link-8 07test1.bc 07test2.bc -o 07test_linked.bc<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ol start="4"><li>å¯ä»¥ä½¿ç”¨ <code>â€”S</code> å‚æ•°, è®© <code>llvm-link</code> ç›´æ¥è¾“å‡º LLVM IR æ–‡ä»¶</li></ol><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">llvm-link-8 -S 07test1.bc 07test2.bc -o 07test_linked.ll<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/202211140951540.png" alt="" /></p><h2 id="8-æ‰§è¡Œ-llvm-bitcode"><a class="markdownIt-Anchor" href="#8-æ‰§è¡Œ-llvm-bitcode"></a> 8 æ‰§è¡Œ LLVM bitcode</h2><p>ä½¿ç”¨ <code>lli</code> å·¥å…·ä»¥ LLVM bitcode ä¸ºè¾“å…¥, ä½¿ç”¨å³æ—¶ç¼–è¯‘å™¨ (JIT) å®ç° LLVM bitcode çš„æ‰§è¡Œ</p><ul><li>å¦‚æœå½“å‰çš„æ¶æ„ä¸å­˜åœ¨ JIT ç¼–è¯‘å™¨ï¼Œä¼šç”¨è§£é‡Šå™¨æ‰§è¡Œ</li></ul><ol><li><code>lli 07test_linked.bc</code> å³å¯æ‰§è¡Œ</li></ol><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/202211140953616.png" alt="" /></p><h2 id="9-c-ä¸-clang"><a class="markdownIt-Anchor" href="#9-c-ä¸-clang"></a> 9 C ä¸ Clang</h2><p>Clang èƒ½å¤Ÿä½œä¸ºé¢„å¤„ç†å™¨ã€ç¼–è¯‘å™¨é©±åŠ¨ã€å‰ç«¯ä»¥åŠä»£ç ç”Ÿæˆå™¨ä½¿ç”¨ï¼Œå®ƒçš„è¾“å‡ºå–å†³äºä½ æŒ‡å®šçš„å‚æ•°</p><ol><li>ä½¿ç”¨ <code>clang</code> å°† C è½¬ä¸ºå¯æ‰§è¡Œæ–‡ä»¶</li></ol><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">clang-8 09test.c -o 09test.out<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/202211141005188.png" alt="" /></p><ol start="2"><li>æ·»åŠ  <code>-S -emit-llvm</code> é€‰é¡¹, å°† C è½¬ä¸º LLVM æ±‡ç¼–ç </li></ol><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">clang-8 09test.c -S -emit-llvm -o 09test.ll<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><code>-S</code>: è¡¨ç¤º Only run preprocess and compilation steps<code>-emit-llvm</code>: è¡¨ç¤º Use the LLVM representation for assembler and object files</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/202211141008765.png" alt="" /></p><ol start="3"><li>ä»…æ·»åŠ  <code>-S</code> é€‰é¡¹, å°±èƒ½å®ç° C è½¬ä¸ºæ±‡ç¼–ç </li></ol><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">clang-8 09test.c -S -o -<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><code>-o -</code>: å°†ç»“æœå†æ ‡å‡†è¾“å‡ºä¸­è¾“å‡º</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/202211141013679.png" alt="" /></p><h1 id="refs"><a class="markdownIt-Anchor" href="#refs"></a> Refs</h1><ul><li>[llvm-cookbook]</li></ul>]]></content>
      
      
      <categories>
          
          <category> Compiler </category>
          
      </categories>
      
      
        <tags>
            
            <tag> LLVM </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>13-Jetpack</title>
      <link href="/Coming-blog/2022/09/11/13-jetpack/"/>
      <url>/Coming-blog/2022/09/11/13-jetpack/</url>
      
        <content type="html"><![CDATA[<h1 id="jetpack"><a class="markdownIt-Anchor" href="#jetpack"></a> Jetpack</h1><p>Jetpack æ˜¯ä¸€ä¸ªå¼€å‘ç»„ä»¶å·¥å…·é›†ï¼Œå®ƒçš„ä¸»è¦ç›®çš„æ˜¯å¸®åŠ©æˆ‘ä»¬ç¼–å†™å‡ºæ›´åŠ ç®€æ´çš„ä»£ç ï¼Œå¹¶ç®€åŒ–æˆ‘ä»¬çš„å¼€å‘è¿‡ç¨‹</p><p>å…¨å®¶æ¡¶: åŸºç¡€, æ¶æ„, è¡Œä¸º, ç•Œé¢; è¿™é‡Œæˆ‘ä»¬ä¸»è¦ä»‹ç» Jetpack æ¶æ„</p><h1 id="mmvm"><a class="markdownIt-Anchor" href="#mmvm"></a> MMVM</h1><p>MMVM, Model-View-ViewModel, Model æ˜¯æ•°æ®æ¨¡å‹éƒ¨åˆ†ï¼›View æ˜¯ç•Œé¢å±•ç¤ºéƒ¨åˆ†ï¼›ViewModel å¯ä»¥ç†è§£æˆä¸€ä¸ªè¿æ¥æ•°æ®æ¨¡å‹å’Œç•Œé¢å±•ç¤ºçš„æ¡¥æ¢ï¼Œä»è€Œå®ç°è®©ä¸šåŠ¡é€»è¾‘å’Œç•Œé¢å±•ç¤ºåˆ†ç¦»çš„ç¨‹åºç»“æ„è®¾è®¡</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/202209121229074.png" alt="" /></p><ul><li>UI æ§åˆ¶å±‚: Activity, Fragment, å¸ƒå±€æ–‡ä»¶ç­‰ä¸ç•Œé¢ç›¸å…³çš„ä¸œè¥¿</li><li>ViewModel: å±‚ç”¨äºæŒæœ‰å’Œ UI å…ƒç´ ç›¸å…³çš„æ•°æ®ï¼Œä»¥ä¿è¯è¿™äº›æ•°æ®åœ¨å±å¹•æ—‹è½¬æ—¶ä¸ä¼šä¸¢å¤±; æä¾›æ¥å£ç»™ UI æ§åˆ¶å±‚è°ƒç”¨ä»¥åŠå’Œä»“åº“å±‚è¿›è¡Œé€šä¿¡</li><li>ä»“åº“: åˆ¤æ–­è°ƒç”¨æ–¹è¯·æ±‚çš„æ•°æ®åº”è¯¥æ˜¯ä»æœ¬åœ°æ•°æ®æºä¸­è·å–è¿˜æ˜¯ä»ç½‘ç»œæ•°æ®æºä¸­è·å–ï¼Œå¹¶å°†è·å–åˆ°çš„æ•°æ®è¿”å›ç»™è°ƒç”¨æ–¹<ul><li>æœ¬åœ°æ•°æ®æº: æ•°æ®åº“ã€SharedPreferences ç­‰æŒä¹…åŒ–æŠ€æœ¯</li><li>ç½‘ç»œæ•°æ®æº: ä½¿ç”¨ Retrofit è®¿é—®æœåŠ¡å™¨æä¾›çš„ Webservice æ¥å£æ¥å®ç°</li></ul></li></ul><h1 id="viewmodel"><a class="markdownIt-Anchor" href="#viewmodel"></a> ViewModel</h1><p>Motivation: ä¼ ç»Ÿ Activity æ—¢è¦è´Ÿè´£é€»è¾‘å¤„ç†åˆè¦è´Ÿè´£ UI å±•ç¤º, ç”šè‡³è¿˜å¾—å¤„ç†ç½‘ç»œå›è°ƒ</p><p>ViewModel æ˜¯ä¸“é—¨ç”¨äºå­˜æ”¾ä¸ç•Œé¢ç›¸å…³çš„æ•°æ®çš„</p><ul><li>æ‰‹æœºå‘ç”Ÿæ¨ªç«–å±æ—‹è½¬æ—¶, Activity ä¼šè¢«é‡å»º, ä½† ViewModel å£°æ˜å‘¨æœŸä¸ Activity ä¸åŒ, å› æ­¤æ•°æ®ä¹Ÿä¸ä¼šä¸¢å¤±</li><li>åªæœ‰è°ƒç”¨ <code>onCleared()</code> æ–¹æ³• ViewModel æ‰ä¼šè¢«é”€æ¯</li></ul><h2 id="quick-start"><a class="markdownIt-Anchor" href="#quick-start"></a> Quick Start</h2><ol><li>æ¨èç»™æ¯ä¸€ä¸ª Activity å’Œ Fragment éƒ½åˆ›å»ºä¸€ä¸ªå¯¹åº”çš„ ViewModel, é‡Œé¢å­˜å‚¨ç”¨äºå±•ç¤ºçš„ä¿¡æ¯</li></ol><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">class</span> MainViewModel<span class="token operator">:</span> <span class="token function">ViewModel</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">var</span> counter <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><ol start="2"><li>åœ¨å¯¹åº”çš„ Activity æˆ– Fragment ä¸­åˆ›å»ºå¯¹åº”çš„ viewModel å®ä¾‹</li></ol><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">val</span> viewModel <span class="token keyword">by</span> lazy <span class="token punctuation">&#123;</span> <span class="token function">ViewModelProvider</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>MainViewModel<span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">.</span>java<span class="token punctuation">)</span> <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ol start="3"><li>é€»è¾‘æ“ä½œ</li></ol><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">val</span> buttonPlus<span class="token operator">:</span> Button <span class="token operator">=</span> <span class="token function">findViewById</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>plusOneBtn<span class="token punctuation">)</span>buttonPlus<span class="token punctuation">.</span><span class="token function">setOnClickListener</span> <span class="token punctuation">&#123;</span>    viewModel<span class="token punctuation">.</span>counter<span class="token operator">++</span>    <span class="token function">refreshCounter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="å‘-viewmodel-ä¼ é€’å‚æ•°"><a class="markdownIt-Anchor" href="#å‘-viewmodel-ä¼ é€’å‚æ•°"></a> å‘ ViewModel ä¼ é€’å‚æ•°</h2><p>æ¯”å¦‚è®© ViewModel åŠ è½½çš„æ—¶å€™, å¯ä»¥å…ˆåœ¨ Activity ä¸­å°è¯•è¯»å–æœ¬åœ°ç¼“å­˜çš„æ•°æ®ä¿¡æ¯, ç„¶åå°†è¯»å–çš„å†…å®¹ä¼ é€’ç»™ ViewModel è¿›è¡Œæ•°æ®ç»´æŠ¤</p><ol><li>éœ€è¦åˆ›å»ºä¸€ä¸ª ViewModel çš„å·¥å‚ç±», é‡å†™å…¶ create æ–¹æ³•, ä½¿å…¶é€‚é…å‚æ•°ä¼ é€’</li></ol><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">class</span> <span class="token function">MainViewModelFactory</span><span class="token punctuation">(</span><span class="token keyword">private</span> <span class="token keyword">val</span> countReserved<span class="token operator">:</span> Int<span class="token punctuation">)</span><span class="token operator">:</span> ViewModelProvider<span class="token punctuation">.</span><span class="token function">Factory</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token operator">&lt;</span>T <span class="token operator">:</span> ViewModel<span class="token operator">?</span><span class="token operator">></span> <span class="token function">create</span><span class="token punctuation">(</span>modelClass<span class="token operator">:</span> Class<span class="token operator">&lt;</span>T<span class="token operator">></span><span class="token punctuation">)</span><span class="token operator">:</span> T <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token function">MainViewModel</span><span class="token punctuation">(</span>countReserved<span class="token punctuation">)</span> <span class="token keyword">as</span> T    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="2"><li>ä½¿ç”¨å·¥å‚ç±»å®ç° ViewModel çš„å®ä¾‹åŒ–</li></ol><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin">viewModel <span class="token operator">=</span> <span class="token function">ViewModelProvider</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token function">MainViewModelFactory</span><span class="token punctuation">(</span>countReserved<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>MainViewModel<span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">.</span>java<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h1 id="lifecycles"><a class="markdownIt-Anchor" href="#lifecycles"></a> Lifecycles</h1><p>Motivation: å¯¹ Activity ç”Ÿå‘½å‘¨æœŸæƒ…å†µè¿›è¡Œæ„ŸçŸ¥, æŸä¸ªç•Œé¢ä¸­å‘èµ·äº†ä¸€æ¡ç½‘ç»œè¯·æ±‚ï¼Œä½†æ˜¯å½“è¯·æ±‚å¾—åˆ°å“åº”çš„æ—¶å€™ï¼Œç•Œé¢æˆ–è®¸å·²ç»å…³é—­äº†ï¼Œè¿™ä¸ªæ—¶å€™å°±ä¸åº”è¯¥ç»§ç»­å¯¹å“åº”çš„ç»“æœè¿›è¡Œå¤„ç†ã€‚å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦èƒ½å¤Ÿæ—¶åˆ»æ„ŸçŸ¥åˆ°Activityçš„ç”Ÿå‘½å‘¨æœŸï¼Œä»¥ä¾¿åœ¨é€‚å½“çš„æ—¶å€™è¿›è¡Œç›¸åº”çš„é€»è¾‘æ§åˆ¶ã€‚</p><p>Lifecycles å¯ä»¥è®©ä»»ä½•ä¸€ä¸ªç±»éƒ½èƒ½è½»æ¾æ„ŸçŸ¥åˆ° Activity çš„ç”Ÿå‘½å‘¨æœŸï¼ŒåŒæ—¶åˆä¸éœ€è¦åœ¨ Activity ä¸­ç¼–å†™å¤§é‡çš„é€»è¾‘å¤„ç†</p><h2 id="quick-start-2"><a class="markdownIt-Anchor" href="#quick-start-2"></a> Quick Start</h2><ol><li>æ–°å»ºä¸€ä¸ªè‡ªå·±çš„ MyObserver ç±»ï¼Œå¹¶è®©å®ƒå®ç° LifecycleObserver æ¥å£ï¼ˆä¸»è¦å°±æ˜¯å£°æ˜ä¸€ä¸‹ï¼‰</li></ol><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">class</span> MyObserver<span class="token operator">:</span> LifecycleObserver <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ol start="2"><li>æ¥å£ä¸­æ ¹æ®ç›¸å…³æ³¨è§£å®šä¹‰æ„ŸçŸ¥ Activity ç”Ÿå‘½å‘¨æœŸçš„é€»è¾‘å¤„ç†æ–¹æ³•</li></ol><p>å£°æ˜å‘¨æœŸäº‹ä»¶ç±»å‹: <code>ON_CREATE</code>, <code>ON_START</code>, <code>ON_RESUME</code>, <code>ON_PAUSE</code>, <code>ON_STOP</code>, <code>ON_DESTROY</code>; ç‰¹æ®Šçš„æœ‰ä¸€ç§ <code>ON_ANY</code> è¡¨ç¤ºå¯ä»¥åŒ¹é… Activity çš„ä»»ä½•ç”Ÿå‘½å‘¨æœŸå›è°ƒ</p><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">class</span> MyObserver <span class="token operator">:</span> LifecycleObserver <span class="token punctuation">&#123;</span>    <span class="token annotation builtin">@OnLifecycleEvent</span><span class="token punctuation">(</span>Lifecycle<span class="token punctuation">.</span>Event<span class="token punctuation">.</span>ON_START<span class="token punctuation">)</span>    <span class="token keyword">fun</span> <span class="token function">activityStart</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        Log<span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span><span class="token string">"MyObserver"</span><span class="token punctuation">,</span> <span class="token string">"activityStart"</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation builtin">@OnLifecycleEvent</span><span class="token punctuation">(</span>Lifecycle<span class="token punctuation">.</span>Event<span class="token punctuation">.</span>ON_STOP<span class="token punctuation">)</span>    <span class="token keyword">fun</span> <span class="token function">activityStop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        Log<span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span><span class="token string">"MyObserver"</span><span class="token punctuation">,</span> <span class="token string">"activityStop"</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="3"><li>è·å– Activity æˆ– Fragment æœ¬èº«çš„ LifecycleOwner å®ä¾‹, å®ç°å¯¹ MyObserver çš„é€šçŸ¥</li></ol><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin">lifecycle<span class="token punctuation">.</span><span class="token function">addObserver</span><span class="token punctuation">(</span><span class="token function">MyObserver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="ä¸»åŠ¨çŠ¶æ€æ„ŸçŸ¥"><a class="markdownIt-Anchor" href="#ä¸»åŠ¨çŠ¶æ€æ„ŸçŸ¥"></a> ä¸»åŠ¨çŠ¶æ€æ„ŸçŸ¥</h2><p>åœ¨ Observer ä¸­ä¸»åŠ¨è·çŸ¥å½“å‰çš„ç”Ÿå‘½å‘¨æœŸçŠ¶æ€</p><ol><li>æ„é€  Observer æ—¶éœ€è¦å°† Lifecycle å¯¹è±¡ä¼ é€’è¿›æ¥</li></ol><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">class</span> <span class="token function">MyObserver</span><span class="token punctuation">(</span><span class="token keyword">val</span> lifecycle<span class="token operator">:</span> Lifecycle<span class="token punctuation">)</span> <span class="token operator">:</span> LifecycleObserver <span class="token punctuation">&#123;</span>    <span class="token operator">..</span><span class="token punctuation">.</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><ol start="2"><li>é€šè¿‡ lifecycler å¯¹è±¡è·å–å½“å‰ Activity çš„çŠ¶æ€</li></ol><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin">lifecycle<span class="token punctuation">.</span>currentState<span class="token comment">// è¿”å›çš„ç”Ÿå‘½å‘¨æœŸçŠ¶æ€æ˜¯ä¸€ä¸ªæšä¸¾ç±»å‹: INITIALIZED, DESTROYED, CREATED, STARTED, RESUMED</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/202209051928800.png" alt="" /></p><h1 id="livedata"><a class="markdownIt-Anchor" href="#livedata"></a> LiveData</h1><p>Motivation: å¯¹ ViewModel è¿›è¡Œå†™åè¯»æ—¶, åœ¨å•çº¿ç¨‹æ¨¡å¼æ²¡é—®é¢˜, ä½†æ˜¯å¦‚æœå¤æ‚å†™, éœ€è¦å¼€å¯é¢å¤–çº¿ç¨‹æ‰§è¡Œ, é‚£ä¹ˆå†™åè¯», è¯»åˆ°çš„å¤§æ¦‚ç‡è¿˜æ˜¯æ—§æ•°æ®</p><p>LiveData æ˜¯ Jetpack æä¾›çš„ä¸€ç§å“åº”å¼ç¼–ç¨‹ç»„ä»¶ï¼Œå®ƒå¯ä»¥åŒ…å«ä»»ä½•ç±»å‹çš„æ•°æ®ï¼Œå¹¶åœ¨æ•°æ®å‘ç”Ÿå˜åŒ–çš„æ—¶å€™é€šçŸ¥ç»™è§‚å¯Ÿè€…</p><ul><li>å¸¸ä¸ ViewModel ç»“åˆä½¿ç”¨</li><li>åœ¨å­çº¿ç¨‹ä¸­ç»™ LiveData è®¾ç½®æ•°æ®ï¼Œè¦è°ƒç”¨ postValue() æ–¹æ³•ï¼Œè€Œä¸èƒ½å†ä½¿ç”¨ setValue() æ–¹æ³•</li></ul><h2 id="quick-start-3"><a class="markdownIt-Anchor" href="#quick-start-3"></a> Quick Start</h2><ol><li>ä½¿ç”¨ç›¸å…³çš„ LiveData å»ç»´æŠ¤ç›¸å…³å˜é‡</li></ol><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">var</span> counter <span class="token operator">=</span> MutableLiveData<span class="token operator">&lt;</span>Int<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ol start="2"><li>åˆå§‹åŒ–å˜é‡, å¹¶ä¹¦å†™å˜é‡ç›¸å…³çš„å¤„ç†æ¥å£</li></ol><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">init</span> <span class="token punctuation">&#123;</span>    counter<span class="token punctuation">.</span>value <span class="token operator">=</span> countReserved<span class="token punctuation">&#125;</span><span class="token keyword">fun</span> <span class="token function">plusOne</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">val</span> count <span class="token operator">=</span> counter<span class="token punctuation">.</span>value <span class="token operator">?:</span> <span class="token number">0</span>    counter<span class="token punctuation">.</span>value <span class="token operator">=</span> count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">&#125;</span><span class="token keyword">fun</span> <span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    counter<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="3"><li>åœ¨ Activity ä¸­ä¹¦å†™ç›¸å…³é€»è¾‘å¤„ç†, å¹¶ç›‘å¬å›è°ƒ</li></ol><p>observe æ–¹æ³•æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼šç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ LifecycleOwner å¯¹è±¡(Activity OR Fragment)ï¼›ç¬¬äºŒä¸ªå‚æ•°æ˜¯ä¸€ä¸ª Observer æ¥å£ï¼Œè¡¨ç¤ºå½“ counter ä¸­åŒ…å«çš„æ•°æ®å‘ç”Ÿå˜åŒ–æ—¶ï¼Œå°±ä¼šå›è°ƒåˆ°è¿™é‡Œ</p><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">val</span> buttonPlus<span class="token operator">:</span> Button <span class="token operator">=</span> <span class="token function">findViewById</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>plusOneBtn<span class="token punctuation">)</span>buttonPlus<span class="token punctuation">.</span><span class="token function">setOnClickListener</span> <span class="token punctuation">&#123;</span>    viewModel<span class="token punctuation">.</span><span class="token function">plusOne</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token keyword">val</span> buttonClean<span class="token operator">:</span> Button <span class="token operator">=</span> <span class="token function">findViewById</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>clearBtn<span class="token punctuation">)</span>buttonClean<span class="token punctuation">.</span><span class="token function">setOnClickListener</span> <span class="token punctuation">&#123;</span>    viewModel<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span>viewModel<span class="token punctuation">.</span>counter<span class="token punctuation">.</span><span class="token function">observe</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    count <span class="token operator">-></span> textInfo<span class="token punctuation">.</span>text <span class="token operator">=</span> count<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="æ›´å¥½çš„å°è£…æ€§"><a class="markdownIt-Anchor" href="#æ›´å¥½çš„å°è£…æ€§"></a> æ›´å¥½çš„å°è£…æ€§</h2><p>Quick Start ä¸­å°† counter è¿™ä¸ªå¯å˜çš„ LiveData æš´éœ²ç»™äº†å¤–éƒ¨ï¼Œè¿™æ ·å³ä½¿æ˜¯åœ¨ ViewModel çš„å¤–é¢ä¹Ÿæ˜¯å¯ä»¥ç»™ counter è®¾ç½®æ•°æ®çš„ï¼Œä»è€Œç ´åäº† ViewModel æ•°æ®çš„å°è£…æ€§ï¼ŒåŒæ—¶ä¹Ÿå¯èƒ½å¸¦æ¥ä¸€å®šçš„é£é™©</p><p>å› æ­¤æ°¸è¿œåªæš´éœ²ä¸å¯å˜çš„ LiveData ç»™å¤–éƒ¨ï¼Œè¿™æ ·åœ¨é ViewModel ä¸­å°±åªèƒ½è§‚å¯Ÿ LiveData çš„æ•°æ®å˜åŒ–ï¼Œè€Œä¸èƒ½ç»™ LiveData è®¾ç½®æ•°æ®</p><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">class</span> <span class="token function">MainViewModel</span><span class="token punctuation">(</span>countReserved<span class="token operator">:</span> Int<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token function">ViewModel</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token comment">//    var counter = MutableLiveData&lt;Int>()</span>    <span class="token comment">// counter å˜é‡, ç±»å‹ä¸ºä¸å¯å˜çš„ LiveData, é‡å†™ get æ–¹æ³•è¿”å› _counter å˜é‡</span>    <span class="token comment">// å½“å¤–éƒ¨è°ƒç”¨ counter å˜é‡æ—¶ï¼Œå®é™…ä¸Šè·å¾—çš„å°±æ˜¯ _counter çš„å®ä¾‹ï¼ˆè½¬å‹ä¸º LiveData ç±»å‹ï¼‰ï¼Œä½†æ˜¯æ— æ³•ç»™ counter è®¾ç½®æ•°æ®ï¼Œä»è€Œä¿è¯äº† ViewModel çš„æ•°æ®å°è£…æ€§</span>    <span class="token keyword">val</span> counter<span class="token operator">:</span> LiveData<span class="token operator">&lt;</span>Int<span class="token operator">></span>        <span class="token keyword">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> _counter    <span class="token comment">// private ä¿®é¥°, å¯¹å¤–éƒ¨ä¸å¯è§</span>    <span class="token keyword">private</span> <span class="token keyword">val</span> _counter <span class="token operator">=</span> MutableLiveData<span class="token operator">&lt;</span>Int<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">init</span> <span class="token punctuation">&#123;</span>        _counter<span class="token punctuation">.</span>value <span class="token operator">=</span> countReserved    <span class="token punctuation">&#125;</span>    <span class="token keyword">fun</span> <span class="token function">plusOne</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">val</span> count <span class="token operator">=</span> _counter<span class="token punctuation">.</span>value <span class="token operator">?:</span> <span class="token number">0</span>        _counter<span class="token punctuation">.</span>value <span class="token operator">=</span> count <span class="token operator">+</span> <span class="token number">1</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">fun</span> <span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        _counter<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token number">0</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="map"><a class="markdownIt-Anchor" href="#map"></a> map</h2><p>å°†å®é™…åŒ…å«æ•°æ®çš„ LiveData å’Œä»…ç”¨äºè§‚å¯Ÿæ•°æ®çš„ LiveData è¿›è¡Œè½¬æ¢</p><p>Application: ViewModel ä¿å­˜äº†ä¸€ä¸ªç”¨æˆ·æ•°æ®ç±»çš„å®ä¾‹, ä½†æ˜¯ç•Œé¢å±•ç¤ºæ—¶åªä¼šæ¶‰åŠåˆ°ç”¨æˆ·çš„åå­—, ä¸ä¼šæ¶‰åŠåˆ°å…¶å¹´é¾„, èº«é«˜, å› æ­¤å°†æ•´ä¸ªç”¨æˆ·æ•°æ®å®ä¾‹æš´éœ²ç»™å¤–éƒ¨è¯»å–ä¹Ÿååˆ†å±é™©, éœ€è¦è¿›ä¸€æ­¥å°è£…è½¬æ¢, ä½¿å…¶åªæš´éœ²å§“å</p><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">private</span> <span class="token keyword">val</span> userLiveData <span class="token operator">=</span> MutableLiveData<span class="token operator">&lt;</span>User<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">val</span> username<span class="token operator">:</span> LiveData<span class="token operator">&lt;</span>String<span class="token operator">></span> <span class="token operator">=</span> Transformations<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>userLiveData<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    user <span class="token operator">-></span> <span class="token string">"<span class="token interpolation"><span class="token delimiter variable">$&#123;</span>user<span class="token punctuation">.</span>firstName<span class="token delimiter variable">&#125;</span></span> <span class="token interpolation"><span class="token delimiter variable">$&#123;</span>user<span class="token punctuation">.</span>lastName<span class="token delimiter variable">&#125;</span></span>"</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h2 id="switchmap"><a class="markdownIt-Anchor" href="#switchmap"></a> switchMap</h2><p>å‰é¢æˆ‘ä»¬æ‰€å­¦çš„æ‰€æœ‰å†…å®¹éƒ½æœ‰ä¸€ä¸ªå‰æï¼šLiveData å¯¹è±¡çš„å®ä¾‹éƒ½æ˜¯åœ¨ ViewModel ä¸­åˆ›å»ºçš„</p><p>ç„¶è€Œåœ¨å®é™…çš„é¡¹ç›®ä¸­ï¼Œä¸å¯èƒ½ä¸€ç›´æ˜¯è¿™ç§ç†æƒ³æƒ…å†µï¼Œå¾ˆæœ‰å¯èƒ½ ViewModel ä¸­çš„æŸä¸ª LiveData å¯¹è±¡æ˜¯è°ƒç”¨å¦å¤–çš„æ–¹æ³•è·å–çš„</p><h2 id="quick-start-4"><a class="markdownIt-Anchor" href="#quick-start-4"></a> Quick Start</h2><ol><li>é€šè¿‡æ•°æ®åº“è·å–æ‰€æœ‰çš„ TodoItem</li></ol><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">fun</span> <span class="token function">refreshTodoItemByCategory</span><span class="token punctuation">(</span>todoCategoryId<span class="token operator">:</span> Long<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token function">fire</span><span class="token punctuation">(</span>Dispatchers<span class="token punctuation">.</span>IO<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span>todoCategoryId <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1L</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">val</span> todoItemList <span class="token operator">=</span> todoDatabase<span class="token punctuation">.</span><span class="token function">todoItemDao</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getAllTodoItem</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        Result<span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span><span class="token function">Pair</span><span class="token punctuation">(</span><span class="token string">"æ˜Ÿæµ·"</span><span class="token punctuation">,</span> todoItemList<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>        <span class="token comment">// è·å–ç±»åˆ«åè¯ - ç”¨äºæ ‡é¢˜æ å±•ç¤º</span>        coroutineScope <span class="token punctuation">&#123;</span>            <span class="token keyword">val</span> todoCategory_ <span class="token operator">=</span> async <span class="token punctuation">&#123;</span>                todoDatabase<span class="token punctuation">.</span><span class="token function">todoCategoryDao</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTodoCategoryById</span><span class="token punctuation">(</span>todoCategoryId<span class="token punctuation">)</span>            <span class="token punctuation">&#125;</span>            <span class="token keyword">val</span> todoItemList_ <span class="token operator">=</span> async <span class="token punctuation">&#123;</span>                todoDatabase<span class="token punctuation">.</span><span class="token function">todoItemDao</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTodoItemsByCategoryId</span><span class="token punctuation">(</span>todoCategoryId<span class="token punctuation">)</span>            <span class="token punctuation">&#125;</span>            <span class="token keyword">val</span> todoCategoryName<span class="token operator">:</span> String <span class="token operator">=</span> todoCategory_<span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>name            <span class="token keyword">val</span> todoItemList <span class="token operator">=</span> todoItemList_<span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token punctuation">)</span>            Result<span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span><span class="token function">Pair</span><span class="token punctuation">(</span>todoCategoryName<span class="token punctuation">,</span> todoItemList<span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token comment">// fire: ç»Ÿä¸€çš„å…¥å£å‡½æ•°ä¸­è¿›è¡Œå°è£…, ä½¿å¾—åªè¦è¿›è¡Œä¸€æ¬¡ try catch å¤„ç†å°±è¡Œäº†</span><span class="token comment">// è‡ªåŠ¨å¼€å¯çº¿ç¨‹å¤„ç†, æ ¹æ®æˆåŠŸæˆ–å¤±è´¥è¿”å›ç›¸åº”çš„ Result å¯¹è±¡</span><span class="token keyword">private</span> <span class="token keyword">fun</span> <span class="token operator">&lt;</span>T<span class="token operator">></span> <span class="token function">fire</span><span class="token punctuation">(</span>    context<span class="token operator">:</span> CoroutineContext<span class="token punctuation">,</span>    block<span class="token operator">:</span> <span class="token keyword">suspend</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span> Result<span class="token operator">&lt;</span>T<span class="token operator">></span><span class="token punctuation">)</span> <span class="token operator">=</span> liveData<span class="token operator">&lt;</span>Result<span class="token operator">&lt;</span>T<span class="token operator">></span><span class="token operator">></span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">val</span> result <span class="token operator">=</span> <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>        <span class="token function">block</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token operator">:</span> Exception<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        Result<span class="token punctuation">.</span>failure<span class="token operator">&lt;</span>T<span class="token operator">></span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>    <span class="token function">emit</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="2"><li>ç»´æŠ¤å†…éƒ¨è§‚å¯Ÿè€…, è§¦å‘æ•°æ®åº“æ“ä½œ, å¹¶è¿”å› LiveData å¯¹è±¡</li></ol><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token comment">// ç»´æŠ¤ TodoCategoryId, å¦‚æœå…¶å˜åŒ–åˆ™è§¦å‘æ•°æ®åº“ refreshTodoItemByCategory æ“ä½œ</span><span class="token keyword">private</span> <span class="token keyword">val</span> refreshTodoItemByCategoryObs <span class="token operator">=</span> MutableLiveData<span class="token operator">&lt;</span>Long<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">val</span> refreshTodoItemByCategoryResult <span class="token operator">=</span> Transformations<span class="token punctuation">.</span><span class="token function">switchMap</span><span class="token punctuation">(</span>refreshTodoItemByCategoryObs<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> todoCategoryId <span class="token operator">-></span>    <span class="token comment">// è¿”å› Result å¯¹è±¡, äº¤ç”±å¤–éƒ¨ refreshTodoItemByCategoryResult çš„ Observer è¿›è¡Œå¤„ç†</span>    Repository<span class="token punctuation">.</span><span class="token function">refreshTodoItemByCategory</span><span class="token punctuation">(</span>todoCategoryId<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token comment">// æä¾›ç»™å¤–éƒ¨çš„äº‹ä»¶è°ƒç”¨æ¥å£, ä½¿å¾—ç›‘å¬æ•°æ®äº§ç”Ÿå˜åŒ–, è¿›è€Œè§¦å‘æ•°æ®åº“æ“ä½œ</span><span class="token keyword">fun</span> <span class="token function">refreshTodoItemByCategory</span><span class="token punctuation">(</span>todoCategoryId<span class="token operator">:</span> Long<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    refreshTodoItemByCategoryObs<span class="token punctuation">.</span>value <span class="token operator">=</span> todoCategoryId<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="3"><li>ç»´æŠ¤å¤–éƒ¨è§‚å¯Ÿè€…, å¯¹æ•°æ®åº“è¿”å›çš„æ•°æ®åŠ å·¥å¤„ç†</li></ol><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin">viewModel<span class="token punctuation">.</span>refreshTodoItemByCategoryResult<span class="token punctuation">.</span><span class="token function">observe</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> Observer <span class="token punctuation">&#123;</span> result <span class="token operator">-></span>    <span class="token keyword">val</span> pairResult <span class="token operator">=</span> result<span class="token punctuation">.</span><span class="token function">getOrNull</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">if</span><span class="token punctuation">(</span>pairResult <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">val</span> todoCategoryName <span class="token operator">=</span> pairResult<span class="token punctuation">.</span>first        <span class="token keyword">val</span> todoItemList <span class="token operator">=</span> pairResult<span class="token punctuation">.</span>second        viewModel<span class="token punctuation">.</span>todoItemList<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        viewModel<span class="token punctuation">.</span>todoItemList<span class="token punctuation">.</span><span class="token function">addAll</span><span class="token punctuation">(</span>todoItemList<span class="token punctuation">)</span>        adapter_todoitem<span class="token punctuation">.</span><span class="token function">notifyDataSetChanged</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        toolbarFragment<span class="token punctuation">.</span><span class="token function">refreshToolbarName</span><span class="token punctuation">(</span>todoCategoryName<span class="token punctuation">,</span> viewModel<span class="token punctuation">.</span>todoCategoryId <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1L</span><span class="token punctuation">)</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>todoItemSwipeRefresh<span class="token punctuation">.</span>isRefreshing<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            todoItemSwipeRefresh<span class="token punctuation">.</span>isRefreshing <span class="token operator">=</span> <span class="token boolean">false</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>drawerLayout<span class="token punctuation">.</span><span class="token function">isDrawerOpen</span><span class="token punctuation">(</span>GravityCompat<span class="token punctuation">.</span>START<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            drawerLayout<span class="token punctuation">.</span><span class="token function">closeDrawer</span><span class="token punctuation">(</span>GravityCompat<span class="token punctuation">.</span>START<span class="token punctuation">)</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>Tips: å¦‚æœå¤–éƒ¨ç”Ÿæˆçš„ LiveData å®ä¾‹æ²¡æœ‰ç›¸å…³å±æ€§å¯ä¾›ç›‘å¬, é‚£ä¹ˆåªéœ€è¦ç›‘å¬ä¸€ä¸ªç©ºå±æ€§å³å¯</p><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">private</span> <span class="token keyword">val</span> refreshLiveData <span class="token operator">=</span> MutableLiveData<span class="token operator">&lt;</span>Any<span class="token operator">?</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">val</span> refreshResult <span class="token operator">=</span> Transformations<span class="token punctuation">.</span><span class="token function">switchMap</span><span class="token punctuation">(</span>refreshLiveData<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    Repository<span class="token punctuation">.</span><span class="token function">refresh</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// å‡è®¾Repositoryä¸­å·²ç»å®šä¹‰äº†refresh()æ–¹æ³•</span><span class="token punctuation">&#125;</span><span class="token comment">// LiveData å†…éƒ¨ä¸ä¼šåˆ¤æ–­å³å°†è®¾ç½®çš„æ•°æ®å’ŒåŸæœ‰æ•°æ®æ˜¯å¦ç›¸åŒï¼Œåªè¦è°ƒç”¨äº† setValue() æˆ– postValue() æ–¹æ³•ï¼Œå°±ä¸€å®šä¼šè§¦å‘æ•°æ®å˜åŒ–äº‹ä»¶</span><span class="token keyword">fun</span> <span class="token function">refresh</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    refreshLiveData<span class="token punctuation">.</span>value <span class="token operator">=</span> refreshLiveData<span class="token punctuation">.</span>value<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="room"><a class="markdownIt-Anchor" href="#room"></a> ROOM</h1><p>ROOM æ˜¯ä¸º Android æ•°æ®åº“è®¾è®¡çš„ ORM æ¡†æ¶, æ˜¯å¯¹ SQLite çš„å°è£…; Room provides an abstraction layer over SQLite to allow fluent database access while harnessing the full power of SQLite</p><ul><li>Object Relational Mapping, å°†é¢å‘å¯¹è±¡çš„è¯­è¨€å’Œé¢å‘å…³ç³»çš„æ•°æ®åº“ä¹‹é—´å»ºç«‹ä¸€ç§æ˜ å°„å…³ç³»</li></ul><p>Overall Structure: Entity, Dao, Database</p><ul><li>Entity: å®šä¹‰å°è£…å®é™…æ•°æ®çš„å®ä½“ç±»; æ¯ä¸ªå®ä½“ç±»åœ¨æ•°æ®åº“ä¸­å¯¹åº”ä¸€å¼ è¡¨ï¼Œå¹¶ä¸”è¡¨ä¸­çš„åˆ—æ˜¯æ ¹æ®å®ä½“ç±»ä¸­çš„å­—æ®µ<strong>è‡ªåŠ¨ç”Ÿæˆ</strong>çš„</li><li>Dao: Dao æ˜¯æ•°æ®è®¿é—®å¯¹è±¡çš„æ„æ€ï¼Œåœ¨è¿™é‡Œå¯¹æ•°æ®åº“çš„å„é¡¹æ“ä½œè¿›è¡Œå°è£…; å®é™…ç¼–ç¨‹æ—¶ï¼Œé€»è¾‘å±‚ä¸éœ€è¦å’Œåº•å±‚æ•°æ®åº“æ‰“äº¤é“ï¼Œç›´æ¥å’Œ Dao å±‚è¿›è¡Œäº¤äº’</li><li>Database: ç”¨äºå®šä¹‰æ•°æ®åº“ä¸­çš„å…³é”®ä¿¡æ¯ï¼ŒåŒ…æ‹¬æ•°æ®åº“çš„ç‰ˆæœ¬å·ã€åŒ…å«å“ªäº›å®ä½“ç±»ä»¥åŠæä¾› Dao å±‚çš„è®¿é—®å®ä¾‹</li></ul><h2 id="strength"><a class="markdownIt-Anchor" href="#strength"></a> Strength</h2><ul><li>ç”¨é¢å‘å¯¹è±¡çš„æ€ç»´æ¥å’Œæ•°æ®åº“è¿›è¡Œäº¤äº’</li><li>Room æ”¯æŒåœ¨ç¼–è¯‘æ—¶åŠ¨æ€æ£€æŸ¥ SQL è¯­å¥è¯­æ³•</li><li>Compile-time verification of SQL queries. each @Query and @Entity is checked at the compile time</li><li></li></ul><h2 id="quick-crud"><a class="markdownIt-Anchor" href="#quick-crud"></a> Quick CRUD</h2><p>å¸¸ç”¨æ“ä½œ: Create, Read, Update, Deleteå¸¸ç”¨æ³¨è§£:</p><ul><li>@Entity(foreignKeys, indices, primaryKeys, tableName)</li><li>@PrimaryKey(autoGenerate = true)</li><li>@ColumnInfo(name=&quot;column_name&quot;): allows specifying custom information about column</li><li>@Ignore: field will not be persisted by Room</li><li>@Embeded: nested fields can be referenced directly in the SQL queries</li></ul><ol><li>å¼•å…¥ç›¸å…³ä¾èµ–</li></ol><ul><li>kotlin-kapt æ’ä»¶: å¼•å…¥ Room ç¼–è¯‘æ—¶çš„æ³¨è§£åº“</li></ul><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin">apply plugin<span class="token operator">:</span> <span class="token string">'com.android.application'</span>apply plugin<span class="token operator">:</span> <span class="token string">'kotlin-android'</span>apply plugin<span class="token operator">:</span> <span class="token string">'kotlin-android-extensions'</span>apply plugin<span class="token operator">:</span> <span class="token string">'kotlin-kapt'</span>dependencies <span class="token punctuation">&#123;</span>    implementation <span class="token string">"androidx.room:room-runtime:2.1.0"</span>    kapt <span class="token string">"androidx.room:room-compiler:2.1.0"</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="2"><li>ç¼–å†™ç›¸å…³å®ä½“ç±», ä½¿ç”¨ ROOM çš„æ³¨è§£å®Œæˆé¢å‘å¯¹è±¡</li></ol><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token comment">// å®šä¹‰å®ä½“ç±»çš„æ³¨è§£</span><span class="token annotation builtin">@Entity</span><span class="token keyword">data</span> <span class="token keyword">class</span> <span class="token function">User</span><span class="token punctuation">(</span><span class="token keyword">var</span> firstName<span class="token operator">:</span> String<span class="token punctuation">,</span> <span class="token keyword">var</span> lastName<span class="token operator">:</span> String<span class="token punctuation">,</span> <span class="token keyword">var</span> age<span class="token operator">:</span> Int<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token annotation builtin">@PrimaryKey</span><span class="token punctuation">(</span>autoGenerate <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>    <span class="token keyword">var</span> id<span class="token operator">:</span> Long <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="3"><li>ç¼–å†™ç›¸å…³çš„æ•°æ®åº“æ“ä½œæ¥å£, DAO</li></ol><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token annotation builtin">@Dao</span><span class="token keyword">interface</span> UserDao <span class="token punctuation">&#123;</span>    <span class="token comment">// è¡¨ç¤ºä¼šå°†å‚æ•°ä¸­ä¼ å…¥çš„ User å¯¹è±¡æ’å…¥æ•°æ®åº“ä¸­ï¼Œæ’å…¥å®Œæˆåè¿˜ä¼šå°†è‡ªåŠ¨ç”Ÿæˆçš„ä¸»é”® id å€¼è¿”å›</span>    <span class="token annotation builtin">@Insert</span>    <span class="token keyword">fun</span> <span class="token function">insertUser</span><span class="token punctuation">(</span>user<span class="token operator">:</span> User<span class="token punctuation">)</span><span class="token operator">:</span> Long    <span class="token comment">// ä¼šå°†å‚æ•°ä¸­ä¼ å…¥çš„ User å¯¹è±¡æ›´æ–°åˆ°æ•°æ®åº“å½“ä¸­</span>    <span class="token annotation builtin">@Update</span>    <span class="token keyword">fun</span> <span class="token function">updateUser</span><span class="token punctuation">(</span>newUser<span class="token operator">:</span> User<span class="token punctuation">)</span>    <span class="token comment">// ä¼šå°†å‚æ•°ä¼ å…¥çš„ User å¯¹è±¡ä»æ•°æ®åº“ä¸­åˆ é™¤</span>    <span class="token annotation builtin">@Delete</span>    <span class="token keyword">fun</span> <span class="token function">deleteUser</span><span class="token punctuation">(</span>user<span class="token operator">:</span> User<span class="token punctuation">)</span>    <span class="token comment">// æŸ¥è¯¢æˆ–ç²¾ç»†åŒ–çš„åˆ é™¤æ“ä½œ, éœ€è¦ä¼ å…¥ç›¸å…³çš„ SQL è¯­è¨€</span>    <span class="token annotation builtin">@Query</span><span class="token punctuation">(</span><span class="token string">"select * from User"</span><span class="token punctuation">)</span>    <span class="token keyword">fun</span> <span class="token function">findAllUsers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> List<span class="token operator">&lt;</span>User<span class="token operator">></span>    <span class="token annotation builtin">@Query</span><span class="token punctuation">(</span><span class="token string">"select * from User where age > :age"</span><span class="token punctuation">)</span>    <span class="token keyword">fun</span> <span class="token function">findUsersOlderThan</span><span class="token punctuation">(</span>age<span class="token operator">:</span> Int<span class="token punctuation">)</span><span class="token operator">:</span> List<span class="token operator">&lt;</span>User<span class="token operator">></span>    <span class="token annotation builtin">@Query</span><span class="token punctuation">(</span><span class="token string">"delete from User where lastName = :lastName"</span><span class="token punctuation">)</span>    <span class="token keyword">fun</span> <span class="token function">deleteUserByLastName</span><span class="token punctuation">(</span>lastName<span class="token operator">:</span> String<span class="token punctuation">)</span><span class="token operator">:</span> Int<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="4"><li>å®šä¹‰ Database: æ•°æ®åº“çš„ç‰ˆæœ¬å·ã€åŒ…å«å“ªäº›å®ä½“ç±»ã€æä¾› Dao å±‚çš„è®¿é—®å®ä¾‹</li></ol><h1 id="workmanager"><a class="markdownIt-Anchor" href="#workmanager"></a> WorkManager</h1><p>WorkManager æ˜¯ä¸€ä¸ªå¤„ç†å®šæ—¶ä»»åŠ¡çš„å·¥å…·ï¼Œå¯ä»¥ä¿è¯å³ä½¿åœ¨åº”ç”¨é€€å‡ºç”šè‡³æ‰‹æœºé‡å¯çš„æƒ…å†µä¸‹ï¼Œä¹‹å‰æ³¨å†Œçš„ä»»åŠ¡ä»ç„¶å°†ä¼šå¾—åˆ°æ‰§è¡Œ</p><ul><li>ä½†æ˜¯ä¸ºäº†å‡å°‘ç”µé‡æ¶ˆè€—ï¼Œè¿›è¡Œäº†ä¸€äº›ä¼˜åŒ–ï¼Œå› æ­¤ä¸èƒ½ä¿è¯å‡†æ—¶æ‰§è¡Œï¼›æ¯”å¦‚å°†è§¦å‘æ—¶é—´ä¸´è¿‘çš„å‡ ä¸ªä»»åŠ¡æ”¾åœ¨ä¸€èµ·æ‰§è¡Œï¼Œè¿™æ ·å¯ä»¥å¤§å¹…åº¦åœ°å‡å°‘ CPU è¢«å”¤é†’çš„æ¬¡æ•°ï¼Œä»è€Œæœ‰æ•ˆå»¶é•¿ç”µæ± çš„ä½¿ç”¨æ—¶é—´</li></ul><h2 id="quick-start-5"><a class="markdownIt-Anchor" href="#quick-start-5"></a> Quick Start</h2><ol><li>æ·»åŠ ç›¸å…³ä¾èµ–: <code>implementation &quot;androidx.work:work-runtime:2.7.1&quot;</code></li><li>å®šä¹‰ä¸€ä¸ªåå°ä»»åŠ¡ï¼Œå¹¶å®ç°å…·ä½“çš„ä»»åŠ¡é€»è¾‘</li></ol><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token comment">// ä¸ä¼šè¿è¡Œåœ¨ä¸»çº¿ç¨‹</span><span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">doWork</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> Result <span class="token punctuation">&#123;</span>    Log<span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span><span class="token string">"SimpleWorker"</span><span class="token punctuation">,</span> <span class="token string">"do work in jcworker"</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> Result<span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// Result.failure() OR Result.retry()</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="3"><li>é…ç½®è¯¥åå°ä»»åŠ¡çš„è¿è¡Œæ¡ä»¶å’Œçº¦æŸä¿¡æ¯ï¼Œå¹¶æ„å»ºåå°ä»»åŠ¡è¯·æ±‚</li></ol><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token comment">// Example ////////////////////</span><span class="token keyword">val</span> request <span class="token operator">=</span> OneTimeWorkRequest<span class="token punctuation">.</span><span class="token function">Builder</span><span class="token punctuation">(</span>SimpleWorker<span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">.</span>java<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// basic</span><span class="token keyword">val</span> request <span class="token operator">=</span> PeriodicWorkRequest<span class="token punctuation">.</span><span class="token function">Builder</span><span class="token punctuation">(</span>SimpleWorker<span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">.</span>java<span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span> TimeUnit<span class="token punctuation">.</span>MINUTES<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// Periodic</span><span class="token comment">// Basic /////////////////////</span><span class="token comment">//// åå°ä»»åŠ¡çš„å…·ä½“è¿è¡Œæ—¶é—´æ˜¯ç”±æˆ‘ä»¬æ‰€æŒ‡å®šçš„çº¦æŸä»¥åŠç³»ç»Ÿè‡ªèº«çš„ä¸€äº›ä¼˜åŒ–æ‰€å†³å®š</span><span class="token comment">//// ç”±äºè¿™é‡Œæ²¡æœ‰æŒ‡å®šä»»ä½•çº¦æŸï¼Œå› æ­¤åå°ä»»åŠ¡åŸºæœ¬ä¸Šä¼šåœ¨ç‚¹å‡»æŒ‰é’®ä¹‹åç«‹åˆ»è¿è¡Œ</span><span class="token keyword">val</span> request <span class="token operator">=</span> OneTimeWorkRequest<span class="token punctuation">.</span><span class="token function">Builder</span><span class="token punctuation">(</span>JCWorker<span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">.</span>java<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span>WorkManager<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">enqueue</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="4"><li>å°†è¯¥åå°ä»»åŠ¡è¯·æ±‚ä¼ å…¥ WorkManager çš„ enqueue() æ–¹æ³•ä¸­ï¼Œç³»ç»Ÿä¼šåœ¨åˆé€‚çš„æ—¶é—´è¿è¡Œ</li></ol><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin">WorkManager<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">enqueue</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span> <span class="token comment">// basic</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="å»¶æ—¶ä»»åŠ¡"><a class="markdownIt-Anchor" href="#å»¶æ—¶ä»»åŠ¡"></a> å»¶æ—¶ä»»åŠ¡</h2><p>æ„å»ºåå°ä»»åŠ¡è¯·æ±‚æ—¶å€ŸåŠ© <code>setInitialalDelay()</code> æ–¹æ³•è®©åå°ä»»åŠ¡å»¶æ—¶æ‰§è¡Œ</p><ul><li>å•ä½: TimeUnit.SECONDS, MINUTES, HOURS, DAYS, MICROSECONDS, MILLISECONDS, NANOSECONDS</li></ul><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token comment">// æ¨è¿Ÿ 5s æ‰§è¡Œ</span><span class="token keyword">val</span> request <span class="token operator">=</span> OneTimeWorkRequest<span class="token punctuation">.</span><span class="token function">Builder</span><span class="token punctuation">(</span>JCWorker<span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">.</span>java<span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">setInitialDelay</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> TimeUnit<span class="token punctuation">.</span>SECONDS<span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h2 id="å–æ¶ˆåå°ä»»åŠ¡"><a class="markdownIt-Anchor" href="#å–æ¶ˆåå°ä»»åŠ¡"></a> å–æ¶ˆåå°ä»»åŠ¡</h2><ol><li>å¯ä»¥åœ¨åå°ä»»åŠ¡æ„å»ºæ—¶æŒ‡å®šè¯¥ä»»åŠ¡çš„æ ‡ç­¾, å¤šä¸ªä»»åŠ¡å¯ä»¥ç»‘å®šç›¸åŒæ ‡ç­¾, ä»è€Œè¿›è¡Œç»Ÿä¸€æ§åˆ¶</li></ol><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">val</span> request <span class="token operator">=</span> OneTimeWorkRequest<span class="token punctuation">.</span><span class="token function">Builder</span><span class="token punctuation">(</span>JCWorker<span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">.</span>java<span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">setInitialDelay</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> TimeUnit<span class="token punctuation">.</span>SECONDS<span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">addTag</span><span class="token punctuation">(</span><span class="token string">"JCWork"</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><ol start="2"><li>ä½¿ç”¨ WorkManager çš„å®ä¾‹æ–¹æ³•è¿›è¡Œå–æ¶ˆ</li></ol><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin">WorkManager<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">cancelAllWorkByTag</span><span class="token punctuation">(</span><span class="token string">"JCWork"</span><span class="token punctuation">)</span><span class="token comment">// æˆ–è€…ä½¿ç”¨ id å–æ¶ˆ</span>WorkManager<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">cancelWorkById</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h2 id="ä»»åŠ¡æ‰§è¡ŒçŠ¶æ€çš„ç›‘å¬"><a class="markdownIt-Anchor" href="#ä»»åŠ¡æ‰§è¡ŒçŠ¶æ€çš„ç›‘å¬"></a> ä»»åŠ¡æ‰§è¡ŒçŠ¶æ€çš„ç›‘å¬</h2><h3 id="resultretry"><a class="markdownIt-Anchor" href="#resultretry"></a> Result.retry()</h3><p>å¦‚æœåœ¨å¤ç°çš„ <code>doWork()</code> æ–¹æ³•ä¸­è¿”å›äº† <code>Result.retry()</code> é‚£ä¹ˆå¯ä»¥æå‰é€šè¿‡ <code>setBackoffCriteria()</code> æ–¹æ³•é…ç½®å¥½ä»»åŠ¡çš„é‡å¯é…ç½®</p><p>Tips: å¦‚æœä»»åŠ¡ä¸€ç›´æ‰§è¡Œå¤±è´¥, é‚£ä¹ˆä¸€ç›´é‡è¯•æ²¡æœ‰æ„ä¹‰, å› æ­¤åº”è®©é‡è¯•é—´éš”éšç€é‡è¯•æ¬¡æ•°çš„å¢åŠ è€Œå¢åŠ </p><ul><li>BackoffPolicy.LINEAR: ä»£è¡¨ä¸‹æ¬¡é‡è¯•æ—¶é—´ä»¥çº¿æ€§çš„æ–¹å¼å»¶è¿Ÿ</li><li>BackoffPolicy.EXPONENTIAL ä»£è¡¨ä¸‹æ¬¡é‡è¯•æ—¶é—´ä»¥æŒ‡æ•°çš„æ–¹å¼å»¶è¿Ÿ</li></ul><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token comment">// ç¬¬ä¸€ä¸ªå‚æ•°åˆ™ç”¨äºæŒ‡å®šå¦‚æœä»»åŠ¡å†æ¬¡æ‰§è¡Œå¤±è´¥ï¼Œä¸‹æ¬¡é‡è¯•çš„æ—¶é—´åº”è¯¥ä»¥ä»€ä¹ˆæ ·çš„å½¢å¼å»¶è¿Ÿ</span><span class="token comment">// ç¬¬äºŒ, ä¸‰ä¸ªå‚æ•°ç”¨äºæŒ‡å®šåœ¨å¤šä¹…ä¹‹åé‡æ–°æ‰§è¡Œä»»åŠ¡ï¼Œæ—¶é—´æœ€çŸ­ä¸èƒ½å°‘äº 10 ç§’é’Ÿ</span><span class="token keyword">val</span> request <span class="token operator">=</span> OneTimeWorkRequest<span class="token punctuation">.</span><span class="token function">Builder</span><span class="token punctuation">(</span>JCWorker<span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">.</span>java<span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">setInitialDelay</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> TimeUnit<span class="token punctuation">.</span>SECONDS<span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">addTag</span><span class="token punctuation">(</span><span class="token string">"JCWork"</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">setBackoffCriteria</span><span class="token punctuation">(</span>BackoffPolicy<span class="token punctuation">.</span>LINEAR<span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> TimeUnit<span class="token punctuation">.</span>SECONDS<span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="succeeded-or-failed"><a class="markdownIt-Anchor" href="#succeeded-or-failed"></a> SUCCEEDED OR FAILED</h3><p>æˆåŠŸæˆ–å¤±è´¥çš„æ‰§è¡ŒçŠ¶æ€éœ€è¦é€šè¿‡å¯¹ WorkManager çš„é…ç½®è¿›è¡Œå“åº”</p><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token comment">// è¿”å›ä¸€ä¸ª LiveData å¯¹è±¡, ç”¨è¿™ä¸ªç»´æŠ¤ä»»åŠ¡çš„çŠ¶æ€</span>WorkManager<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getWorkInfoByIdLiveData</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>id<span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">observe</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> workInfo <span class="token operator">-></span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>workInfo<span class="token punctuation">.</span>state <span class="token operator">==</span> WorkInfo<span class="token punctuation">.</span>State<span class="token punctuation">.</span>SUCCEEDED<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        Log<span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span><span class="token string">"SimpleWorker"</span><span class="token punctuation">,</span> <span class="token string">"Succeeded"</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>workInfo<span class="token punctuation">.</span>state <span class="token operator">==</span> WorkInfo<span class="token punctuation">.</span>State<span class="token punctuation">.</span>FAILED<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        Log<span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span><span class="token string">"SimpleWorker"</span><span class="token punctuation">,</span> <span class="token string">"FAILED"</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="é“¾å¼ä»»åŠ¡"><a class="markdownIt-Anchor" href="#é“¾å¼ä»»åŠ¡"></a> é“¾å¼ä»»åŠ¡</h2><p>å®šä¹‰äº†å¤šä¸ªç‹¬ç«‹çš„ä»»åŠ¡ä¸”å…·æœ‰å…ˆåé¡ºåºçš„æƒ…å†µ, ä½¿ç”¨é“¾å¼ä»»åŠ¡è¿›è¡Œå…ˆåæ‰§è¡Œ</p><p>Tips: å¿…é¡»åœ¨å‰ä¸€ä¸ªåå°ä»»åŠ¡è¿è¡ŒæˆåŠŸä¹‹åï¼Œä¸‹ä¸€ä¸ªåå°ä»»åŠ¡æ‰ä¼šè¿è¡Œã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœæŸä¸ªåå°ä»»åŠ¡è¿è¡Œå¤±è´¥ï¼Œæˆ–è€…è¢«å–æ¶ˆäº†ï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥çš„åå°ä»»åŠ¡å°±éƒ½å¾—ä¸åˆ°è¿è¡Œäº†</p><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">val</span> sync <span class="token operator">=</span> <span class="token operator">..</span><span class="token punctuation">.</span> <span class="token comment">// åŒæ­¥æ•°æ®ä»»åŠ¡</span><span class="token keyword">val</span> compress <span class="token operator">=</span> <span class="token operator">..</span><span class="token punctuation">.</span> <span class="token comment">// å‹ç¼©æ•°æ®ä»»åŠ¡</span><span class="token keyword">val</span> upload <span class="token operator">=</span> <span class="token operator">..</span><span class="token punctuation">.</span> <span class="token comment">// ä¸Šä¼ æ•°æ®ä»»åŠ¡</span>WorkManager<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">beginWith</span><span class="token punctuation">(</span>sync<span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>compress<span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>upload<span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">enqueue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="é¢å¤–æ³¨æ„"><a class="markdownIt-Anchor" href="#é¢å¤–æ³¨æ„"></a> é¢å¤–æ³¨æ„</h2><p>å‰é¢æ‰€ä»‹ç»çš„ WorkManager çš„æ‰€æœ‰åŠŸèƒ½ï¼Œåœ¨å›½äº§æ‰‹æœºä¸Šéƒ½æœ‰å¯èƒ½å¾—ä¸åˆ°æ­£ç¡®çš„è¿è¡Œ</p><p>ç»å¤§å¤šæ•°çš„å›½äº§æ‰‹æœºå‚å•†åœ¨è¿›è¡Œ Android ç³»ç»Ÿå®šåˆ¶çš„æ—¶å€™ä¼šå¢åŠ ä¸€ä¸ªä¸€é”®å…³é—­çš„åŠŸèƒ½ï¼Œå…è®¸ç”¨æˆ·ä¸€é”®æ€æ­»æ‰€æœ‰éç™½åå•çš„åº”ç”¨ç¨‹åºã€‚è€Œè¢«æ€æ­»çš„åº”ç”¨ç¨‹åºæ—¢æ— æ³•æ¥æ”¶å¹¿æ’­ï¼Œä¹Ÿæ— æ³•è¿è¡Œ WorkManager çš„åå°ä»»åŠ¡</p><p>å› æ­¤ WorkManager å¯ä»¥ç”¨ï¼Œä½†æ˜¯åƒä¸‡åˆ«ä¾èµ–å®ƒå»å®ç°ä»€ä¹ˆæ ¸å¿ƒåŠŸèƒ½ï¼Œå› ä¸ºå®ƒåœ¨å›½äº§æ‰‹æœºä¸Šå¯èƒ½ä¼šéå¸¸ä¸ç¨³å®š</p>]]></content>
      
      
      <categories>
          
          <category> Android Dev. </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Android </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>12-Material Design</title>
      <link href="/Coming-blog/2022/09/05/12-material-design/"/>
      <url>/Coming-blog/2022/09/05/12-material-design/</url>
      
        <content type="html"><![CDATA[<h1 id="material-design"><a class="markdownIt-Anchor" href="#material-design"></a> Material Design</h1><p>ä¸€å¥—å…¨æ–°çš„ç•Œé¢è®¾è®¡è¯­è¨€ï¼ŒåŒ…å«äº†è§†è§‰ã€è¿åŠ¨ã€äº’åŠ¨æ•ˆæœç­‰ç‰¹æ€§, å…¶è®¾è®¡ç†å¿µå’Œå·¥å…·éƒ½å°è£…åˆ°äº† Material åº“ä¸­</p><h1 id="toolbar"><a class="markdownIt-Anchor" href="#toolbar"></a> Toolbar</h1><p>Toolbar ä¸ä»…ç»§æ‰¿äº† ActionBar çš„æ‰€æœ‰åŠŸèƒ½, è€Œä¸”æ‹¥æœ‰æ›´å¼ºçš„çµæ´»æ€§</p><h2 id="actionbar"><a class="markdownIt-Anchor" href="#actionbar"></a> ActionBar</h2><p>ActionBar çš„é…ç½®æ¥æºäºä¸»é¢˜æ–‡ä»¶: <code>res/values/themes.xml</code></p><ul><li>åœ¨è¿™é‡Œå®ç°çˆ¶ä¸»é¢˜çš„é€‰å–ä»¥åŠå„ä¸ªä¸»é¢˜è‰²çš„é…ç½®, ä½¿ç”¨ <code>.NoActionBar</code> å³ä¸ºæ²¡æœ‰ ActionBar çš„ä¸»é¢˜</li></ul><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Theme.23MaterialTest<span class="token punctuation">"</span></span> <span class="token attr-name">parent</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Theme.MaterialComponents.Light.NoActionBar<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token comment">&lt;!-- Primary brand color. --></span><span class="token comment">&lt;!--        &lt;item name="colorPrimary">@color/purple_500&lt;/item>--></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>item</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>colorPrimaryVariant<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>@color/purple_700<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>item</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>item</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>colorOnPrimary<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>@color/white<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>item</span><span class="token punctuation">></span></span>    <span class="token comment">&lt;!-- Secondary brand color. --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>item</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>colorSecondary<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>@color/teal_200<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>item</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>item</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>colorSecondaryVariant<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>@color/teal_700<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>item</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>item</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>colorOnSecondary<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>@color/black<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>item</span><span class="token punctuation">></span></span>    <span class="token comment">&lt;!-- Status bar color. --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>item</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>android:statusBarColor<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">tools:</span>targetApi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>l<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>?attr/colorPrimaryVariant<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>item</span><span class="token punctuation">></span></span>    <span class="token comment">&lt;!-- Customize your theme here. --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>item</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>colorPrimary<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>@color/colorPrimary<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>item</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>item</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>colorPrimaryDark<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>@color/colorPrimaryDark<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>item</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>item</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>colorAccent<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>@color/colorAccent<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>item</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="ä¸»é¢˜è‰²çš„åˆ†å¸ƒ"><a class="markdownIt-Anchor" href="#ä¸»é¢˜è‰²çš„åˆ†å¸ƒ"></a> ä¸»é¢˜è‰²çš„åˆ†å¸ƒ</h2><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/202209011220381.png" alt="" /></p><ul><li>colorAccent: ä¸åªæ˜¯ç”¨æ¥æŒ‡å®šä¸€ä¸ªæŒ‰é’®çš„é¢œè‰²ï¼Œè€Œæ›´å¤šè¡¨è¾¾äº†ä¸€ç§å¼ºè°ƒçš„æ„æ€ï¼Œæ¯”å¦‚ä¸€äº›æ§ä»¶çš„é€‰ä¸­çŠ¶æ€ä¹Ÿä¼šä½¿ç”¨è¯¥é¢œè‰²</li><li>colorPrimary: æ ‡é¢˜æ é¢œè‰²</li><li>colorPrimaryVariant: çŠ¶æ€æ é¢œè‰²</li><li>windowBackgroud:</li><li>navigationBarColor:</li></ul><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token comment">&lt;!--        æ ‡é¢˜æ–‡å­—--></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>item</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>android:textColorPrimary<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>@color/colorAccent<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>item</span><span class="token punctuation">></span></span><span class="token comment">&lt;!--        èƒŒæ™¯è‰²--></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>item</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>android:windowBackground<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>@color/teal_700<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>item</span><span class="token punctuation">></span></span><span class="token comment">&lt;!--        åº•éƒ¨å¯¼èˆªæ --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>item</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>android:navigationBarColor<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>@color/purple_200<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>item</span><span class="token punctuation">></span></span><span class="token comment">&lt;!--        æ ‡é¢˜æ --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>item</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>colorPrimary<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>@color/colorPrimary<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>item</span><span class="token punctuation">></span></span><span class="token comment">&lt;!--        çŠ¶æ€æ --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>item</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>colorPrimaryVariant<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>@color/colorPrimaryDark<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>item</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="quick-start"><a class="markdownIt-Anchor" href="#quick-start"></a> Quick Start</h2><ol><li>ç¼–å†™å¸ƒå±€æ–‡ä»¶: æ–°å¢ app å‘½åç©ºé—´, ä½¿å¾— Material èƒ½å¤Ÿå…¼å®¹è€ç³»ç»Ÿ</li></ol><p>Tips: ä¸»ç¨‹åºä¸»é¢˜ä¸ºæµ…è‰², ä¸ºäº†å’Œä¸»ä½“é¢œè‰²åŒºåˆ†, å› æ­¤ Toolbar ä½¿ç”¨æ·±è‰² (Dark) ä¸»é¢˜; ä¸ºäº†é¿å… Toolbar ä¸­çš„èœå•æŒ‰é’®ä¹Ÿç»§æ‰¿æ·±è‰²ä¸»é¢˜å¯¼è‡´æ— æ³•åŒºåˆ†, å› æ­¤æ‰‹åŠ¨æŒ‡å®š Toolbar ä¸­çš„èœå•æŒ‰é’®ä¸ºæµ…è‰² (Light) ä¸»é¢˜</p><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token comment">&lt;!--ä½¿ç”¨ xmlns: app æŒ‡å®šæ–°çš„å‘½åç©ºé—´, å¢åŠ å…¼å®¹æ€§--></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>FrameLayout</span> <span class="token attr-name"><span class="token namespace">xmlns:</span>android</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://schemas.android.com/apk/res/android<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">xmlns:</span>app</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://schemas.android.com/apk/res-auto<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>androidx.appcompat.widget.Toolbar</span>        <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@+id/toolbar<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>?attr/actionBarSize<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>background</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@color/colorPrimary<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>theme</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@style/ThemeOverlay.AppCompat.Dark.ActionBar<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">app:</span>popupTheme</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@style/ThemeOverlay.AppCompat.Light<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>FrameLayout</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="2"><li>MainActivity ä¸­é…ç½® toolbar å®ä¾‹</li></ol><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin">toolbar <span class="token operator">=</span> <span class="token function">findViewById</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>toolbar<span class="token punctuation">)</span><span class="token function">setSupportActionBar</span><span class="token punctuation">(</span>toolbar<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="å±æ€§ä¿®æ”¹"><a class="markdownIt-Anchor" href="#å±æ€§ä¿®æ”¹"></a> å±æ€§ä¿®æ”¹</h2><ul><li>æ ‡é¢˜æ æ–‡å­—: AndroidManifest ä¸­ activity ä¸­çš„ label å±æ€§æŒ‡å®š; é»˜è®¤ä½¿ç”¨ AndroidManifest ä¸­ Application ä¸­çš„ label</li></ul><h1 id="æ»‘åŠ¨èœå•"><a class="markdownIt-Anchor" href="#æ»‘åŠ¨èœå•"></a> æ»‘åŠ¨èœå•</h1><p>æ»‘åŠ¨èœå•: å°†ä¸€äº›èœå•é€‰é¡¹éšè—èµ·æ¥ï¼Œè€Œä¸æ˜¯æ”¾ç½®åœ¨ä¸»å±å¹•ä¸Šï¼Œç„¶åå¯ä»¥é€šè¿‡æ»‘åŠ¨çš„æ–¹å¼å°†èœå•æ˜¾ç¤ºå‡ºæ¥</p><h2 id="drawerlayout"><a class="markdownIt-Anchor" href="#drawerlayout"></a> DrawerLayout</h2><p>DrawerLayout å¸ƒå±€ä¸­å…è®¸æ”¾å…¥ä¸¤ä¸ªç›´æ¥å­æ§ä»¶ï¼š</p><ol><li>ä¸»å±å¹•ä¸­æ˜¾ç¤ºçš„å†…å®¹</li><li>æ»‘åŠ¨èœå•ä¸­æ˜¾ç¤ºçš„å†…å®¹<ul><li>æ»‘åŠ¨èœå•å†…å®¹å¿…é¡»æŒ‡å®š layout_gravity å±æ€§, ç”¨äºæŒ‡æ˜æ»‘å‡ºçš„æ–¹å‘</li></ul></li></ol><ul><li>drawerLayout.isDrawerOpen(GravityCompat.START): æ ¹æ®æŒ‡å®šçš„æ»‘å‡ºåŠ¨ä½œåˆ¤æ–­æ˜¯å¦å·²ç»æ»‘å‡º</li><li>drawerLayout.openDrawer(GravityCompat.START): ä½¿å…¶æ»‘å‡º</li><li>drawerLayout.closeDrawer(GravityCompat.START): ä½¿å…¶å…³é—­</li></ul><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>androidx.drawerlayout.widget.DrawerLayout</span>    <span class="token attr-name"><span class="token namespace">xmlns:</span>android</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://schemas.android.com/apk/res/android<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">xmlns:</span>app</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://schemas.android.com/apk/res-auto<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@+id/drawerLayout<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span>    <span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>FrameLayout</span>        <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>androidx.appcompat.widget.Toolbar</span>            <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@+id/toolbar<span class="token punctuation">"</span></span>            <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span>            <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>?attr/actionBarSize<span class="token punctuation">"</span></span>            <span class="token attr-name"><span class="token namespace">android:</span>background</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@color/colorPrimary<span class="token punctuation">"</span></span>            <span class="token attr-name"><span class="token namespace">android:</span>theme</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@style/ThemeOverlay.AppCompat.Dark.ActionBar<span class="token punctuation">"</span></span>            <span class="token attr-name"><span class="token namespace">app:</span>popupTheme</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@style/ThemeOverlay.AppCompat.Light<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>FrameLayout</span><span class="token punctuation">></span></span><span class="token comment">&lt;!--        æ»‘åŠ¨èœå•å†…å®¹å¿…é¡»æŒ‡å®š layout_gravity, æŒ‡å®šæ˜¯ä»å·¦ä¾§æ»‘å‡ºèœå•è¿˜æ˜¯å³ä¾§--></span><span class="token comment">&lt;!--    start å±æ€§è¡¨ç¤ºä¼šæ ¹æ®ç³»ç»Ÿè¯­è¨€è¿›è¡Œåˆ¤æ–­ï¼Œå¦‚æœç³»ç»Ÿè¯­è¨€æ˜¯ä»å·¦å¾€å³çš„ï¼Œæ¯”å¦‚è‹±è¯­ã€æ±‰è¯­ï¼Œæ»‘åŠ¨èœå•å°±åœ¨å·¦è¾¹        å¦‚æœç³»ç»Ÿè¯­è¨€æ˜¯ä»å³å¾€å·¦çš„ï¼Œæ¯”å¦‚é˜¿æ‹‰ä¼¯è¯­ï¼Œæ»‘åŠ¨èœå•å°±åœ¨å³è¾¹ --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>TextView</span>        <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>layout_gravity</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>start<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>background</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#FFF<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>text</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>This is menu<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>textSize</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>30sp<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>androidx.drawerlayout.widget.DrawerLayout</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä¸ºäº†æ›´å¥½çš„è§¦å‘æ»‘åŠ¨èœå•, å¯ä»¥åœ¨æ ‡é¢˜æ ä¸­æ·»åŠ å¯¼èˆªæŒ‰é’®</p><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin">supportActionBar<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">let</span> <span class="token punctuation">&#123;</span>    it<span class="token punctuation">.</span><span class="token function">setDisplayHomeAsUpEnabled</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token comment">// æœ¬æ„æ˜¯ç”¨ä½œ Home é”®, ä¹Ÿå¯ä»¥ç”¨ä½œèœå•å¯¼èˆªé”®</span>    it<span class="token punctuation">.</span><span class="token function">setHomeAsUpIndicator</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>drawable<span class="token punctuation">.</span>ic_menu<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token comment">// æ·»åŠ ç‚¹å‡»äº‹ä»¶</span><span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">onOptionsItemSelected</span><span class="token punctuation">(</span>item<span class="token operator">:</span> MenuItem<span class="token punctuation">)</span><span class="token operator">:</span> Boolean <span class="token punctuation">&#123;</span>    <span class="token keyword">when</span> <span class="token punctuation">(</span>item<span class="token punctuation">.</span>itemId<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            android<span class="token punctuation">.</span>R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>home <span class="token operator">-></span> drawerLayout<span class="token punctuation">.</span><span class="token function">openDrawer</span><span class="token punctuation">(</span>GravityCompat<span class="token punctuation">.</span>START<span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="navigationview-ç¾åŒ–æ»‘åŠ¨èœå•"><a class="markdownIt-Anchor" href="#navigationview-ç¾åŒ–æ»‘åŠ¨èœå•"></a> NavigationView ç¾åŒ–æ»‘åŠ¨èœå•</h2><ol><li>app/build.gradle ä¸­å¼•å…¥ç›¸å…³ä¾èµ–</li></ol><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin">implementation <span class="token string">'com.google.android.material:material:1.1.0'</span>implementation <span class="token string">'de.hdodenhof:circleimageview:3.0.1'</span> <span class="token comment">// å›¾ç‰‡åœ†åŒ–</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ol start="2"><li>ä½¿ç”¨ Material åº“éœ€è¦æ›¿æ¢é»˜è®¤çš„ ActionBar å³ä½¿ç”¨ NoActionBar ä¸»é¢˜</li><li>menu: ret/menu/nav_menu, åœ¨ NavigationView ä¸­æ˜¾ç¤ºå…·ä½“çš„èœå•é¡¹: group è¡¨ç¤ºä¸€ä¸ªç»„ï¼ŒcheckableBehavior æŒ‡å®šä¸º single è¡¨ç¤ºç»„ä¸­çš„æ‰€æœ‰èœå•é¡¹åªèƒ½å•é€‰</li></ol><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>menu</span> <span class="token attr-name"><span class="token namespace">xmlns:</span>android</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://schemas.android.com/apk/res/android<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>group</span> <span class="token attr-name"><span class="token namespace">android:</span>checkableBehavior</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>single<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>item</span>            <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@+id/navCall<span class="token punctuation">"</span></span>            <span class="token attr-name"><span class="token namespace">android:</span>icon</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@drawable/nav_call<span class="token punctuation">"</span></span>            <span class="token attr-name"><span class="token namespace">android:</span>title</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Call<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>item</span>            <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@+id/navFriends<span class="token punctuation">"</span></span>            <span class="token attr-name"><span class="token namespace">android:</span>icon</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@drawable/nav_friends<span class="token punctuation">"</span></span>            <span class="token attr-name"><span class="token namespace">android:</span>title</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Friends<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>item</span>            <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@+id/navLocation<span class="token punctuation">"</span></span>            <span class="token attr-name"><span class="token namespace">android:</span>icon</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@drawable/nav_location<span class="token punctuation">"</span></span>            <span class="token attr-name"><span class="token namespace">android:</span>title</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Location<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>item</span>            <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@+id/navMail<span class="token punctuation">"</span></span>            <span class="token attr-name"><span class="token namespace">android:</span>icon</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@drawable/nav_mail<span class="token punctuation">"</span></span>            <span class="token attr-name"><span class="token namespace">android:</span>title</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Mail<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>item</span>            <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@+id/navTask<span class="token punctuation">"</span></span>            <span class="token attr-name"><span class="token namespace">android:</span>icon</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@drawable/nav_task<span class="token punctuation">"</span></span>            <span class="token attr-name"><span class="token namespace">android:</span>title</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Tasks<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>group</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>menu</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="4"><li>headerLayout: res/layout/nav_header, åœ¨ NavigationView ä¸­æ˜¾ç¤ºå¤´éƒ¨å¸ƒå±€: æ˜¾ç¤ºç”¨æˆ·çš„å¤´åƒï¼Œç”¨æˆ·åï¼Œé‚®ç®±</li></ol><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>RelativeLayout</span> <span class="token attr-name"><span class="token namespace">xmlns:</span>android</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://schemas.android.com/apk/res/android<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>180dp<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">android:</span>padding</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>10dp<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">android:</span>background</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@color/teal_200<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>de.hdodenhof.circleimageview.CircleImageView</span>        <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@+id/iconImage<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>70dp<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>70dp<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@drawable/nav_icon<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>layout_centerInParent</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>TextView</span>        <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@+id/mailText<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>layout_alignParentBottom</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>text</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>tonygreendev@gmail.com<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>textColor</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#FFF<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>textSize</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>14sp<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>TextView</span>        <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@+id/userText<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>layout_above</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@id/mailText<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>text</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Tony Green<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>textColor</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#FFF<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>textSize</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>14sp<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>RelativeLayout</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="5"><li>å®Œå–„åŸºæœ¬çš„äº¤äº’</li></ol><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin">navView<span class="token punctuation">.</span><span class="token function">setCheckedItem</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>navCall<span class="token punctuation">)</span>navView<span class="token punctuation">.</span><span class="token function">setNavigationItemSelectedListener</span> <span class="token punctuation">&#123;</span>    drawerLayout<span class="token punctuation">.</span><span class="token function">closeDrawers</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token boolean">true</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="æ‚¬æµ®ç»´åº¦"><a class="markdownIt-Anchor" href="#æ‚¬æµ®ç»´åº¦"></a> æ‚¬æµ®ç»´åº¦</h1><p>ä»¿ç«‹ä½“é¢çš„æ“ä½œ</p><h2 id="floatingactionbutton-æ‚¬æµ®æŒ‰é’®"><a class="markdownIt-Anchor" href="#floatingactionbutton-æ‚¬æµ®æŒ‰é’®"></a> FloatingActionButton æ‚¬æµ®æŒ‰é’®</h2><ol><li>åŠ å…¥åˆ°å¸ƒå±€ä¸­</li></ol><p>Tips:</p><ul><li>layout_gravity å±æ€§ä¸æ»‘åŠ¨èœå•ä¸€è‡´, æŒ‰ç…§äººä»¬çš„ä¹ æƒ¯, å¦‚æœè¯­è¨€ä»å·¦å¾€å³, åˆ™ start è¡¨ç¤ºå·¦, end è¡¨ç¤ºå³</li><li>elevation: è¡¨ç¤ºæ‚¬æµ®é«˜åº¦, é«˜åº¦è¶Šé«˜æŠ•å½±æ•ˆæœè¶Šæ˜æ˜¾</li></ul><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>com.google.android.material.floatingactionbutton.FloatingActionButton</span>    <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@+id/fab<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">android:</span>layout_gravity</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>bottom|end<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">android:</span>layout_margin</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>16dp<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">android:</span>src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@drawable/ic_done<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">android:</span>elevation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>8dp<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="2"><li>æ·»åŠ ç‚¹å‡»äº‹ä»¶</li></ol><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin">floatingActionButton<span class="token punctuation">.</span><span class="token function">setOnClickListener</span><span class="token punctuation">&#123;</span>    Toast<span class="token punctuation">.</span><span class="token function">makeText</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token string">"FAB clicked"</span><span class="token punctuation">,</span> Toast<span class="token punctuation">.</span>LENGTH_SHORT<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h2 id="snackbar-äº¤äº’æ€§æç¤º"><a class="markdownIt-Anchor" href="#snackbar-äº¤äº’æ€§æç¤º"></a> Snackbar äº¤äº’æ€§æç¤º</h2><p>åœ¨æç¤ºä¸­åŠ å…¥äº†å¯äº¤äº’å¼çš„æŒ‰é’®, ç”¨æˆ·èƒ½ä¸æç¤ºè¿›è¡Œäº¤äº’</p><ul><li>å‚æ•°éœ€è¦ä¼ å…¥ä¸€ä¸ª view å¯¹è±¡, åªè¦æ˜¯å½“å‰ç•Œé¢å¸ƒå±€çš„ä»»æ„ä¸€ä¸ª View éƒ½å¯ä»¥ï¼Œå› ä¸º Snackbar ä¼šä½¿ç”¨è¿™ä¸ª View è‡ªåŠ¨æŸ¥æ‰¾æœ€å¤–å±‚çš„å¸ƒå±€ï¼Œç”¨äºå±•ç¤ºæç¤ºä¿¡æ¯</li><li>setAction è®¾ç½®åŠ¨ä½œ, è¿›è¡Œäº¤äº’</li></ul><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin">floatingActionButton<span class="token punctuation">.</span><span class="token function">setOnClickListener</span><span class="token punctuation">&#123;</span> view <span class="token operator">-></span>    Snackbar<span class="token punctuation">.</span><span class="token function">make</span><span class="token punctuation">(</span>view<span class="token punctuation">,</span> <span class="token string">"Data Updated"</span><span class="token punctuation">,</span> Snackbar<span class="token punctuation">.</span>LENGTH_SHORT<span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">setAction</span><span class="token punctuation">(</span><span class="token string">"Undo"</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            Toast<span class="token punctuation">.</span><span class="token function">makeText</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token string">"Data backed"</span><span class="token punctuation">,</span> Toast<span class="token punctuation">.</span>LENGTH_LONG<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token punctuation">&#125;</span>        <span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>é€šè¿‡å¯¹ View è¿›è¡Œæ‰©å±•, ç®€åŒ– Snackbar çš„ä½¿ç”¨</p><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="coordinatorlayout-æ‚¬æµ®ç»´åº¦çš„å¸ƒå±€"><a class="markdownIt-Anchor" href="#coordinatorlayout-æ‚¬æµ®ç»´åº¦çš„å¸ƒå±€"></a> CoordinatorLayout æ‚¬æµ®ç»´åº¦çš„å¸ƒå±€</h2><p>åŠ å¼ºç‰ˆçš„ FrameLayout, å¯ä»¥ç›‘å¬å…¶æ‰€æœ‰å­æ§ä»¶çš„å„ç§äº‹ä»¶ï¼Œå¹¶è‡ªåŠ¨å¸®åŠ©æˆ‘ä»¬åšå‡ºæœ€ä¸ºåˆç†çš„å“åº”</p><ul><li>ä¾‹å¦‚ Snackbar æç¤ºä¿¡æ¯å°†æ‚¬æµ®æŒ‰é’®é®æŒ¡ä½äº†ï¼Œé‚£ä¹ˆ CoordinatorLayout èƒ½ç›‘å¬åˆ° Snackbarçš„å¼¹å‡ºäº‹ä»¶ï¼Œä¼šè‡ªåŠ¨å°†å†…éƒ¨çš„ FloatingActionButton å‘ä¸Šåç§»ï¼Œä»è€Œç¡®ä¿ä¸ä¼šè¢« Snackbar é®æŒ¡</li><li>ä½†æ˜¯ Snackbar æ‰€ä¼ å…¥çš„è§¦å‘ View å¿…é¡»è¦æ˜¯ CoordinatorLayout çš„å­ç»„ä»¶å¥¥</li></ul><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>androidx.coordinatorlayout.widget.CoordinatorLayout</span>    <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>androidx.appcompat.widget.Toolbar</span>        <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@+id/toolbar<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>?attr/actionBarSize<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>background</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@color/colorPrimary<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>theme</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@style/ThemeOverlay.AppCompat.Dark.ActionBar<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">app:</span>popupTheme</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@style/ThemeOverlay.AppCompat.Light<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>com.google.android.material.floatingactionbutton.FloatingActionButton</span>        <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@+id/fab<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>layout_gravity</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>bottom|end<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>layout_margin</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>16dp<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@drawable/ic_done<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>elevation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>8dp<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>androidx.coordinatorlayout.widget.CoordinatorLayout</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="å¡ç‰‡å¼å¸ƒå±€"><a class="markdownIt-Anchor" href="#å¡ç‰‡å¼å¸ƒå±€"></a> å¡ç‰‡å¼å¸ƒå±€</h1><h2 id="materialcardview"><a class="markdownIt-Anchor" href="#materialcardview"></a> MaterialCardView</h2><p>åŸºäº FrameLayout, å¸¸ç”¨äº RecyclerView çš„æ•°æ®é¡¹å¸ƒå±€</p><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>com.google.android.material.card.MaterialCardView</span> <span class="token attr-name"><span class="token namespace">xmlns:</span>android</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://schemas.android.com/apk/res/android<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">xmlns:</span>app</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://schemas.android.com/apk/res-auto<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">android:</span>layout_margin</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>5dp<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">app:</span>cardCornerRadius</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>4dp<span class="token punctuation">"</span></span>    <span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>LinearLayout</span>        <span class="token attr-name"><span class="token namespace">android:</span>orientation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>vertical<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ImageView</span>            <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@+id/fruitImage<span class="token punctuation">"</span></span>            <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span>            <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>100dp<span class="token punctuation">"</span></span>            <span class="token attr-name"><span class="token namespace">android:</span>scaleType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>centerCrop<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>TextView</span>            <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@+id/fruitName<span class="token punctuation">"</span></span>            <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span>            <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span>            <span class="token attr-name"><span class="token namespace">android:</span>layout_gravity</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>center_horizontal<span class="token punctuation">"</span></span>            <span class="token attr-name"><span class="token namespace">android:</span>layout_margin</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>5dp<span class="token punctuation">"</span></span>            <span class="token attr-name"><span class="token namespace">android:</span>textSize</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>16sp<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>LinearLayout</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>com.google.android.material.card.MaterialCardView</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä½¿ç”¨åˆé€‚çš„å¸ƒå±€å»å¸ƒå±€å¤šä¸ªå¡ç‰‡</p><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">val</span> layoutManager <span class="token operator">=</span> <span class="token function">GridLayoutManager</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token keyword">val</span> recyclerView<span class="token operator">:</span> RecyclerView <span class="token operator">=</span> <span class="token function">findViewById</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>recyclerView<span class="token punctuation">)</span>recyclerView<span class="token punctuation">.</span>layoutManager <span class="token operator">=</span> layoutManager<span class="token keyword">val</span> adapter <span class="token operator">=</span> <span class="token function">FruitAdapter</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> fruitList<span class="token punctuation">)</span>recyclerView<span class="token punctuation">.</span>adapter <span class="token operator">=</span> adapter<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="appbarlayout"><a class="markdownIt-Anchor" href="#appbarlayout"></a> AppBarLayout</h2><p>è§£å†³çˆ¶å¸ƒå±€é®æŒ¡ Toolbar é—®é¢˜</p><ol><li>å°† Toolbar åµŒå…¥åˆ° AppBarLayout ä¸­</li><li>ç»™ RecyclerView æŒ‡å®šä¸€ä¸ªå¸ƒå±€è¡Œä¸º (å¦‚æœå­˜åœ¨çˆ¶ç»„ä»¶, åˆ™å¸ƒå±€è¡Œä¸ºè¦ä¸Šç§»)</li></ol><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>androidx.recyclerview.widget.RecyclerView</span>    <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@+id/recyclerView<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">app:</span>layout_behavior</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@string/appbar_scrolling_view_behavior<span class="token punctuation">"</span></span>    <span class="token punctuation">/></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿™ä¸ªå¸ƒå±€å±æ€§èƒ½å¤Ÿå®ç°ä¸ AppBar çš„äº¤äº’, å¦‚ RecyclerLayout æ»šåŠ¨æ—¶, AppBarLayout èƒ½æ¥æ”¶åˆ°æ»šåŠ¨äº‹ä»¶å¹¶è¿›è¡Œå“åº”, è¿™æ—¶å€™å¯ä»¥é€šè¿‡å¯¹ Toolbar æ·»åŠ  layout_scrollFlags å±æ€§å®ç°æ§åˆ¶, å¯ä»¥æ··åˆä½¿ç”¨, å¦‚ <code>scroll|enterAlways</code></p><ul><li>scroll: å½“ RecyclerView å‘ä¸Šæ»šåŠ¨çš„æ—¶å€™ï¼ŒToolbar ä¼šè·Ÿç€ä¸€èµ·å‘ä¸Šæ»šåŠ¨å¹¶å®ç°éšè—</li><li>enterAlways: è¡¨ç¤ºå½“ RecyclerView å‘ä¸‹æ»šåŠ¨çš„æ—¶å€™ï¼ŒToolbarä¼šè·Ÿç€ä¸€èµ·å‘ä¸‹æ»šåŠ¨å¹¶é‡æ–°æ˜¾ç¤º</li><li>snap: ï¼›è¡¨ç¤ºå½“ Toolbar è¿˜æ²¡æœ‰å®Œå…¨éšè—æˆ–æ˜¾ç¤ºçš„æ—¶å€™ï¼Œä¼šæ ¹æ®å½“å‰æ»šåŠ¨çš„è·ç¦»ï¼Œè‡ªåŠ¨é€‰æ‹©æ˜¯éšè—è¿˜æ˜¯æ˜¾ç¤º</li></ul><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>androidx.appcompat.widget.Toolbar</span>    <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@+id/toolbar<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>?attr/actionBarSize<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">android:</span>background</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@color/colorPrimary<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">android:</span>theme</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@style/ThemeOverlay.AppCompat.Dark.ActionBar<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">app:</span>popupTheme</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@style/ThemeOverlay.AppCompat.Light<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">app:</span>layout_scrollFlags</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>scroll|enterAlways|snap<span class="token punctuation">"</span></span>    <span class="token punctuation">/></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="ä¸‹æ‹‰åˆ·æ–°-swiperefreshlayou"><a class="markdownIt-Anchor" href="#ä¸‹æ‹‰åˆ·æ–°-swiperefreshlayou"></a> ä¸‹æ‹‰åˆ·æ–° SwipeRefreshLayou</h1><ol><li>æŠŠæƒ³è¦å®ç°ä¸‹æ‹‰åˆ·æ–°åŠŸèƒ½çš„æ§ä»¶æ”¾ç½®åˆ° SwipeRefreshLayout ä¸­ï¼Œå°±å¯ä»¥è¿…é€Ÿè®©è¿™ä¸ªæ§ä»¶æ”¯æŒä¸‹æ‹‰åˆ·æ–°</li></ol><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>androidx.swiperefreshlayout.widget.SwipeRefreshLayout</span>    <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@+id/swipeRefresh<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">app:</span>layout_behavior</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@string/appbar_scrolling_view_behavior<span class="token punctuation">"</span></span>    <span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>androidx.recyclerview.widget.RecyclerView</span>        <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@+id/recyclerView<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span>        <span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>androidx.swiperefreshlayout.widget.SwipeRefreshLayout</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="2"><li>åˆå§‹åŒ–</li></ol><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">val</span> swipeRefresh<span class="token operator">:</span> SwipeRefreshLayout <span class="token keyword">by</span> lazy <span class="token punctuation">&#123;</span>    <span class="token keyword">val</span> sr<span class="token operator">:</span> SwipeRefreshLayout <span class="token operator">=</span> <span class="token function">findViewById</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>swipeRefresh<span class="token punctuation">)</span>    sr<span class="token punctuation">.</span><span class="token function">setColorSchemeResources</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>color<span class="token punctuation">.</span>blue<span class="token punctuation">)</span>    sr<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="3"><li>åˆ·æ–°äº‹ä»¶å¤„ç†</li></ol><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin">swipeRefresh<span class="token punctuation">.</span><span class="token function">setOnRefreshListener</span> <span class="token punctuation">&#123;</span>    <span class="token function">refreshFruits</span><span class="token punctuation">(</span>adapter<span class="token punctuation">)</span> <span class="token comment">// äº‹ä»¶å¤„ç†</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/202210282033235.png" alt="" /></p><ol start="4"><li>åˆ·æ–°åŠ¨ç”»å…³é—­</li></ol><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token comment">// äº‹ä»¶å¤„ç†çš„å›è°ƒä¸­å…³é—­åˆ·æ–°åŠ¨ç”»</span><span class="token keyword">if</span><span class="token punctuation">(</span>todoItemSwipeRefresh<span class="token punctuation">.</span>isRefreshing<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    todoItemSwipeRefresh<span class="token punctuation">.</span>isRefreshing <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h1 id="å¯æŠ˜å å¼æ ‡é¢˜æ "><a class="markdownIt-Anchor" href="#å¯æŠ˜å å¼æ ‡é¢˜æ "></a> å¯æŠ˜å å¼æ ‡é¢˜æ </h1><p>CollapsingToolbarLayout æ˜¯åŸºäº Toolbar çš„å¸ƒå±€, èƒ½å¤Ÿè®© Toolbar çš„æ•ˆæœå˜å¾—æ›´åŠ ä¸°å¯Œ, ä½†æ˜¯ä½¿ç”¨å…¶çš„åŸºç¡€å¾ˆé«˜, éœ€è¦ä½œä¸º AppBarLayout çš„å­å¸ƒå±€(è§£å†³æ ‡é¢˜æ é®æŒ¡é—®é¢˜), è€Œ AppBarLayout åˆæ˜¯ CoordinateLayout çš„å­å¸ƒå±€(ç›‘å¬å­ç»„ä»¶å®ç°å¤„ç†)</p><h2 id="quickstart"><a class="markdownIt-Anchor" href="#quickstart"></a> QuickStart</h2><ol><li>å¸ƒå±€: CoordinateLayout + AppBarLayout + CollapsingToolbarLayout + Toolbar å®ç°æ ‡é¢˜æ å¸ƒå±€</li></ol><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>androidx.coordinatorlayout.widget.CoordinatorLayout</span>     <span class="token attr-name"><span class="token namespace">xmlns:</span>android</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://schemas.android.com/apk/res/android<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">xmlns:</span>app</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://schemas.android.com/apk/res-auto<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>com.google.android.material.appbar.AppBarLayout</span>        <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@+id/appBar<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>250dp<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token comment">&lt;!-- app:contentScrim å±æ€§ç”¨äºæŒ‡å®š CollapsingToolbarLayout åœ¨è¶‹äºæŠ˜å çŠ¶æ€ä»¥åŠæŠ˜å ä¹‹åçš„èƒŒæ™¯è‰²ï¼Œå…¶æŠ˜å åå°±æ˜¯ä¸€ä¸ªæ™®é€šçš„ Toolbar--></span><span class="token comment">&lt;!-- scroll è¡¨ç¤º CollapsingToolbarLayout ä¼šéšç€æ°´æœå†…å®¹è¯¦æƒ…çš„æ»šåŠ¨ä¸€èµ·æ»šåŠ¨    exitUntilCollapsed è¡¨ç¤ºå½“å…¶æ»šåŠ¨å®ŒæˆæŠ˜å ä¹‹åå°±ä¿ç•™åœ¨ç•Œé¢ä¸Šï¼Œä¸å†ç§»å‡ºå±å¹•--></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>com.google.android.material.appbar.CollapsingToolbarLayout</span>            <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@+id/collapsingToolbar<span class="token punctuation">"</span></span>            <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span>            <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span>            <span class="token attr-name"><span class="token namespace">android:</span>theme</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@style/ThemeOverlay.AppCompat.Dark.ActionBar<span class="token punctuation">"</span></span>            <span class="token attr-name"><span class="token namespace">app:</span>contentScrim</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@color/colorPrimary<span class="token punctuation">"</span></span>            <span class="token attr-name"><span class="token namespace">android:</span>fitsSystemWindows</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span>            <span class="token attr-name"><span class="token namespace">app:</span>layout_scrollFlags</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>scroll|exitUntilCollapsed<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token comment">&lt;!-- ç”±æ™®é€šçš„æ ‡é¢˜æ åŠ ä¸Šå›¾ç‰‡ç»„åˆè€Œæˆçš„ --></span><span class="token comment">&lt;!-- app:layout_collapseMode ç”¨äºæŒ‡å®šå½“å‰æ§ä»¶åœ¨ CollapsingToolbarLayout æŠ˜å è¿‡ç¨‹ä¸­çš„æŠ˜å æ¨¡å¼ï¼Œå…¶ä¸­ Toolbar æŒ‡å®šæˆ pinï¼Œè¡¨ç¤ºåœ¨æŠ˜å çš„è¿‡ç¨‹ä¸­ä½ç½®å§‹ç»ˆä¿æŒä¸å˜ï¼ŒImageView æŒ‡å®šæˆ parallaxï¼Œè¡¨ç¤ºä¼šåœ¨æŠ˜å çš„è¿‡ç¨‹ä¸­äº§ç”Ÿä¸€å®šçš„é”™ä½åç§»ï¼Œè¿™ç§æ¨¡å¼çš„è§†è§‰æ•ˆæœä¼šéå¸¸å¥½--></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ImageView</span>                <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@+id/fruitImageView<span class="token punctuation">"</span></span>                <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span>                <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span>                <span class="token attr-name"><span class="token namespace">android:</span>scaleType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>centerCrop<span class="token punctuation">"</span></span>                <span class="token attr-name"><span class="token namespace">app:</span>layout_collapseMode</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>parallax<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>androidx.appcompat.widget.Toolbar</span>                <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@+id/toolbar<span class="token punctuation">"</span></span>                <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span>                <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>?attr/actionBarSize<span class="token punctuation">"</span></span>                <span class="token attr-name"><span class="token namespace">app:</span>layout_collapseMode</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>pin<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>com.google.android.material.appbar.CollapsingToolbarLayout</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>com.google.android.material.appbar.AppBarLayout</span><span class="token punctuation">></span></span>    ...<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>androidx.coordinatorlayout.widget.CoordinatorLayout</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="é…ç½®æµ®åŠ¨æŒ‰é’®"><a class="markdownIt-Anchor" href="#é…ç½®æµ®åŠ¨æŒ‰é’®"></a> é…ç½®æµ®åŠ¨æŒ‰é’®</h2><p>å¯åœ¨åˆé€‚çš„ä½ç½®è¿›è¡Œé…ç½®ï¼Œå¹¶ä¸”ä¼šéšç€æŠ˜å æ¶ˆå¤±</p><ul><li>å…¶ç›¸å¯¹ä½ç½®é€šè¿‡ layout_anchor å†³å®š</li></ul><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>com.google.android.material.floatingactionbutton.FloatingActionButton</span>    <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">android:</span>layout_margin</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>16dp<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">android:</span>src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@drawable/ic_comment<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">app:</span>layout_anchor</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@id/appBar<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">app:</span>layout_anchorGravity</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>bottom|end<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> Android Dev. </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Android </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>11-Web</title>
      <link href="/Coming-blog/2022/08/30/11-web/"/>
      <url>/Coming-blog/2022/08/30/11-web/</url>
      
        <content type="html"><![CDATA[<h1 id="webview"><a class="markdownIt-Anchor" href="#webview"></a> WebView</h1><p>WebView ç©ºé—´å¯ä»¥å®ç°åº”ç”¨ç¨‹åºå†…æµè§ˆå™¨çš„åµŒå…¥ä»¥åŠç½‘é¡µçš„å±•ç¤º</p><h2 id="quick-start"><a class="markdownIt-Anchor" href="#quick-start"></a> Quick Start</h2><ol><li>Layout</li></ol><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>WebView</span>    <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@+id/webView<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><ol start="2"><li>loadUrl: å…¶ä¸­ WebViewClient() çš„è®¾ç½®æ˜¯å¸Œæœ›å½“ä»ä¸€ä¸ªç½‘é¡µè·³è½¬åˆ°å¦ä¸€ä¸ªç½‘é¡µæ—¶ï¼Œå¸Œæœ›ç›®æ ‡ç½‘é¡µä»ç„¶åœ¨å½“å‰ WebView ä¸­æ˜¾ç¤ºï¼Œè€Œä¸æ˜¯æ‰“å¼€ç³»ç»Ÿæµè§ˆå™¨</li></ol><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin">R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>buttonLoadBaidu <span class="token operator">-></span> <span class="token punctuation">&#123;</span>    webView<span class="token punctuation">.</span>settings<span class="token punctuation">.</span>javaScriptEnabled <span class="token operator">=</span> <span class="token boolean">true</span>    webView<span class="token punctuation">.</span>webViewClient <span class="token operator">=</span> <span class="token function">WebViewClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    webView<span class="token punctuation">.</span><span class="token function">loadUrl</span><span class="token punctuation">(</span><span class="token string">"https://www.baidu.com"</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="3"><li>Permission</li></ol><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>uses-permission</span> <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>android.permission.INTERNET<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h1 id="http-in-android"><a class="markdownIt-Anchor" href="#http-in-android"></a> HTTP in Android</h1><h2 id="quick-start-2"><a class="markdownIt-Anchor" href="#quick-start-2"></a> Quick Start</h2><ol><li>å‘é€ HTTP è¯·æ±‚: åˆ›å»ºä¸€ä¸ªå­çº¿ç¨‹å®Œæˆè¯·æ±‚çš„å‘é€ä¸å“åº”çš„è·å–</li></ol><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">private</span> <span class="token keyword">fun</span> <span class="token function">sendRequestWithHttpURLConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    thread <span class="token punctuation">&#123;</span>        <span class="token keyword">var</span> connection<span class="token operator">:</span> HttpURLConnection<span class="token operator">?</span> <span class="token operator">=</span> <span class="token keyword">null</span>        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">val</span> response <span class="token operator">=</span> <span class="token function">StringBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token keyword">val</span> url <span class="token operator">=</span> <span class="token function">URL</span><span class="token punctuation">(</span><span class="token string">"https://www.baidu.com"</span><span class="token punctuation">)</span>            connection <span class="token operator">=</span> url<span class="token punctuation">.</span><span class="token function">openConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> HttpURLConnection            connection<span class="token punctuation">.</span>requestMethod <span class="token operator">=</span> <span class="token string">"GET"</span>            connection<span class="token punctuation">.</span>connectTimeout <span class="token operator">=</span> <span class="token number">8000</span> <span class="token comment">//ms</span>            connection<span class="token punctuation">.</span>readTimeout <span class="token operator">=</span> <span class="token number">8000</span>            <span class="token comment">// å“åº”è·å–</span>            <span class="token keyword">val</span> input <span class="token operator">=</span> connection<span class="token punctuation">.</span>inputStream            <span class="token keyword">val</span> reader <span class="token operator">=</span> <span class="token function">BufferedReader</span><span class="token punctuation">(</span><span class="token function">InputStreamReader</span><span class="token punctuation">(</span>input<span class="token punctuation">)</span><span class="token punctuation">)</span>            reader<span class="token punctuation">.</span><span class="token function">use</span> <span class="token punctuation">&#123;</span>                reader<span class="token punctuation">.</span><span class="token function">forEachLine</span> <span class="token punctuation">&#123;</span>                    response<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>it<span class="token punctuation">)</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span>            <span class="token function">showResponse</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token operator">:</span> Exception<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">finally</span> <span class="token punctuation">&#123;</span>            connection<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">disconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">// å­çº¿ç¨‹ä¸ UI äº¤äº’çš„å°è£…</span>    <span class="token keyword">private</span> <span class="token keyword">fun</span> <span class="token function">showResponse</span><span class="token punctuation">(</span>response<span class="token operator">:</span> String<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        runOnUiThread <span class="token punctuation">&#123;</span>            <span class="token comment">// UI æ“ä½œçº¿ç¨‹</span>            responseText<span class="token punctuation">.</span><span class="token function">setText</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="post-data"><a class="markdownIt-Anchor" href="#post-data"></a> Post Data</h2><p>å°† connection å¯¹è±¡çš„è¯·æ±‚æ–¹æ³•è®¾ç½®ä¸º POST åå³å¯é€šè¿‡ outputStream è¿›è¡Œæ•°æ®çš„å‘é€</p><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin">connection<span class="token punctuation">.</span>requestMethod <span class="token operator">=</span> <span class="token string">"POST"</span> <span class="token comment">// å¯ä»¥æäº¤æ•°æ®</span><span class="token keyword">val</span> output <span class="token operator">=</span> <span class="token function">DataOutputStream</span><span class="token punctuation">(</span>connection<span class="token punctuation">.</span>outputStream<span class="token punctuation">)</span>output<span class="token punctuation">.</span><span class="token function">writeBytes</span><span class="token punctuation">(</span><span class="token string">"username=admin&amp;password=123456"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h2 id="okhttp"><a class="markdownIt-Anchor" href="#okhttp"></a> OkHTTP</h2><p>è¶…è¶ŠåŸç”Ÿ HttpURLConnection çš„å¤–éƒ¨å¼€æºåº“</p><h3 id="quick-start-3"><a class="markdownIt-Anchor" href="#quick-start-3"></a> Quick Start</h3><ol><li><code>app/build.gradle</code> ä¸­æ·»åŠ ä¾èµ–</li></ol><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin">implementation <span class="token string">'com.squareup.okhttp3:okhttp:4.1.0'</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ol start="2"><li>client + request + response + responseData</li></ol><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">val</span> client <span class="token operator">=</span> <span class="token function">OkHttpClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">val</span> request <span class="token operator">=</span> Request<span class="token punctuation">.</span><span class="token function">Builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">url</span><span class="token punctuation">(</span><span class="token string">"https://www.baidu.com"</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">val</span> response <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">newCall</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">val</span> responseData <span class="token operator">=</span> response<span class="token punctuation">.</span>body<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">if</span> <span class="token punctuation">(</span>responseData <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token function">showResponse</span><span class="token punctuation">(</span>responseData<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="post-data-2"><a class="markdownIt-Anchor" href="#post-data-2"></a> Post data</h3><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">val</span> requestBody <span class="token operator">=</span> FormBody<span class="token punctuation">.</span><span class="token function">Builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"username"</span><span class="token punctuation">,</span> <span class="token string">"admin"</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"password"</span><span class="token punctuation">,</span> <span class="token string">"123456"</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">val</span> requestPost <span class="token operator">=</span> Request<span class="token punctuation">.</span><span class="token function">Builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">url</span><span class="token punctuation">(</span><span class="token string">"https://www.baidu.com"</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span>requestBody<span class="token punctuation">)</span>kotlin    <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="http"><a class="markdownIt-Anchor" href="#http"></a> HTTP</h3><p>HTTP æ˜æ–‡ä¼ è¾“é»˜è®¤ä¸æ”¯æŒ, éœ€è¦åœ¨ <code>res/xml</code> ä¸­æ‰‹åŠ¨å†™ä¸€ä¸ªé…ç½®æ–‡ä»¶ <code>network_config.xml</code> å¹¶åº”ç”¨</p><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>network-security-config</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>base-config</span> <span class="token attr-name">cleartextTrafficPermitted</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>trust-anchors</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>certificates</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>system<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>trust-anchors</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>base-config</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>network-security-config</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åœ¨ AndroidManifest ä¸­åº”ç”¨</p><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>application</span>    <span class="token attr-name">...</span>    <span class="token attr-name"><span class="token namespace">android:</span>networkSecurityConfig</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@xml/network_config<span class="token punctuation">"</span></span>    <span class="token punctuation">/></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h1 id="xml-parser"><a class="markdownIt-Anchor" href="#xml-parser"></a> XML Parser</h1><p>åœ¨ç½‘ç»œä¸Šä¼ è¾“æ•°æ®æ—¶æœ€å¸¸ç”¨çš„æ ¼å¼æœ‰ä¸¤ç§ï¼šXML å’Œ JSON, å…ˆæ¥äº†è§£ä¸‹ Android å…³äº XML è§£æçš„ç›¸å…³çŸ¥è¯†</p><h2 id="pull-è§£æ"><a class="markdownIt-Anchor" href="#pull-è§£æ"></a> Pull è§£æ</h2><p>é¦–å…ˆæ—¶è¯·æ±‚è·å– XML ç›¸å…³æ•°æ®</p><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">private</span> <span class="token keyword">fun</span> <span class="token function">parseXMLTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    thread <span class="token punctuation">&#123;</span>        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">val</span> client <span class="token operator">=</span> <span class="token function">OkHttpClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token keyword">val</span> request <span class="token operator">=</span> Request<span class="token punctuation">.</span><span class="token function">Builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">url</span><span class="token punctuation">(</span><span class="token string">"http://192.168.0.107/DVWA/get_data.xml"</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token keyword">val</span> response <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">newCall</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token keyword">val</span> responseData <span class="token operator">=</span> response<span class="token punctuation">.</span>body<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>responseData <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">val</span> xmlData <span class="token operator">=</span> <span class="token function">parseXMLWithPull</span><span class="token punctuation">(</span>responseData<span class="token punctuation">)</span>                <span class="token function">showResponse</span><span class="token punctuation">(</span>xmlData<span class="token punctuation">)</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token operator">:</span> Exception<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç„¶åå¯¹ XML æ•°æ®è¿›è¡Œè§£æ</p><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">private</span> <span class="token keyword">fun</span> <span class="token function">parseXMLWithPull</span><span class="token punctuation">(</span>xmlData<span class="token operator">:</span> String<span class="token punctuation">)</span><span class="token operator">:</span> String <span class="token punctuation">&#123;</span>    <span class="token keyword">val</span> retXmlData <span class="token operator">=</span> <span class="token function">StringBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>        <span class="token comment">// åˆ›å»ºå·¥å‚ç±»å®ä¾‹, è·å–è§£æå¯¹è±¡: xmlPullParse</span>        <span class="token keyword">val</span> factory <span class="token operator">=</span> XmlPullParserFactory<span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">val</span> xmlPullParser <span class="token operator">=</span> factory<span class="token punctuation">.</span><span class="token function">newPullParser</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token comment">// è®¾ç½®è§£æå†…å®¹:</span>        xmlPullParser<span class="token punctuation">.</span><span class="token function">setInput</span><span class="token punctuation">(</span><span class="token function">StringReader</span><span class="token punctuation">(</span>xmlData<span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token comment">// è·å¾—åˆå§‹çš„è§£æçŠ¶æ€</span>        <span class="token keyword">var</span> eventType <span class="token operator">=</span> xmlPullParser<span class="token punctuation">.</span>eventType        <span class="token keyword">var</span> id <span class="token operator">=</span> <span class="token string">""</span>        <span class="token keyword">var</span> name <span class="token operator">=</span> <span class="token string">""</span>        <span class="token keyword">var</span> version <span class="token operator">=</span> <span class="token string">""</span>        <span class="token comment">// è§£æå¾ªç¯åˆ¤åœæ¡ä»¶</span>        <span class="token keyword">while</span> <span class="token punctuation">(</span>eventType <span class="token operator">!=</span> XmlPullParser<span class="token punctuation">.</span>END_DOCUMENT<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token comment">// getName è·å–å½“å‰è§£æèŠ‚ç‚¹çš„åç§°</span>            <span class="token keyword">val</span> nodeName <span class="token operator">=</span> xmlPullParser<span class="token punctuation">.</span>name            <span class="token keyword">when</span> <span class="token punctuation">(</span>eventType<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token comment">// æ ¹æ®å¼€å§‹èŠ‚ç‚¹çš„åç§°è¿›è¡Œå¤„ç†</span>                XmlPullParser<span class="token punctuation">.</span>START_TAG <span class="token operator">-></span> <span class="token punctuation">&#123;</span>                    <span class="token comment">// ç®€å•çš„æ ¹æ®å¼€å§‹èŠ‚ç‚¹åç§°è·å–èŠ‚ç‚¹ä¸­çš„å€¼</span>                    <span class="token keyword">when</span> <span class="token punctuation">(</span>nodeName<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                        <span class="token string">"id"</span> <span class="token operator">-></span> id <span class="token operator">=</span> xmlPullParser<span class="token punctuation">.</span><span class="token function">nextText</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                        <span class="token string">"name"</span> <span class="token operator">-></span> name <span class="token operator">=</span> xmlPullParser<span class="token punctuation">.</span><span class="token function">nextText</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                        <span class="token string">"version"</span> <span class="token operator">-></span> version <span class="token operator">=</span> xmlPullParser<span class="token punctuation">.</span><span class="token function">nextText</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                    <span class="token punctuation">&#125;</span>                <span class="token punctuation">&#125;</span>                <span class="token comment">// æ ¹æ®ç»“æŸèŠ‚ç‚¹çš„åç§°è¿›è¡Œå¤„ç†</span>                XmlPullParser<span class="token punctuation">.</span>END_TAG <span class="token operator">-></span> <span class="token punctuation">&#123;</span>                    <span class="token comment">// ç»“æŸèŠ‚ç‚¹ä¸º app æ—¶è¡¨ç¤ºä¸€ä¸ª app çš„å€¼è·å–å®Œæ¯•, è¿›è¡Œè¾“å‡ºå°è£…</span>                    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">"app"</span> <span class="token operator">==</span> nodeName<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                        retXmlData<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"id is <span class="token interpolation variable">$id</span> + name is <span class="token interpolation variable">$name</span> + version is <span class="token interpolation variable">$version</span>\n"</span><span class="token punctuation">)</span>                    <span class="token punctuation">&#125;</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span>            <span class="token comment">// è·å–ä¸‹ä¸€ä¸ªè§£æäº‹ä»¶ç±»å‹</span>            eventType <span class="token operator">=</span> xmlPullParser<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token operator">:</span> Exception<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">return</span> retXmlData<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="sax-è§£ææ–¹å¼"><a class="markdownIt-Anchor" href="#sax-è§£ææ–¹å¼"></a> SAX è§£ææ–¹å¼</h2><p>ç”¨æ³•æ¯” Pull æ›´å¤æ‚, ä½†æ˜¯è¯­ä¹‰æ›´æ¸…æ¥š</p><ol><li>éœ€è¦ç»§æ‰¿ DefaultHandler ç±»å¹¶å®ç°ç›¸å…³å¤„ç†æ–¹æ³•</li></ol><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">class</span> XMLContentHandler<span class="token operator">:</span> <span class="token function">DefaultHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token keyword">var</span> nodeName <span class="token operator">=</span> <span class="token string">""</span>    <span class="token keyword">private</span> <span class="token keyword">var</span> retXMLData <span class="token operator">=</span> <span class="token function">StringBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> <span class="token keyword">lateinit</span> <span class="token keyword">var</span> id<span class="token operator">:</span> StringBuilder    <span class="token keyword">private</span> <span class="token keyword">lateinit</span> <span class="token keyword">var</span> name<span class="token operator">:</span> StringBuilder    <span class="token keyword">private</span> <span class="token keyword">lateinit</span> <span class="token keyword">var</span> version<span class="token operator">:</span> StringBuilder    <span class="token comment">// å¼€å§‹è§£æ XML å‰è°ƒç”¨</span>    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">startDocument</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        id <span class="token operator">=</span> <span class="token function">StringBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        name <span class="token operator">=</span> <span class="token function">StringBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        version <span class="token operator">=</span> <span class="token function">StringBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">// é’ˆå¯¹ä¸€ä¸ªèŠ‚ç‚¹çš„è§£æ</span>    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">startElement</span><span class="token punctuation">(</span>        uri<span class="token operator">:</span> String<span class="token operator">?</span><span class="token punctuation">,</span>        localName<span class="token operator">:</span> String<span class="token operator">?</span><span class="token punctuation">,</span> <span class="token comment">// èŠ‚ç‚¹åç§°</span>        qName<span class="token operator">:</span> String<span class="token operator">?</span><span class="token punctuation">,</span>        attributes<span class="token operator">:</span> Attributes<span class="token operator">?</span>    <span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>localName <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token keyword">return</span>        nodeName <span class="token operator">=</span> localName        retXMLData<span class="token punctuation">.</span><span class="token function">apply</span> <span class="token punctuation">&#123;</span>            <span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"uri is <span class="token interpolation variable">$uri</span>\n"</span><span class="token punctuation">)</span>            <span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"localname is <span class="token interpolation variable">$localName</span>\n"</span><span class="token punctuation">)</span>            <span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"qName is <span class="token interpolation variable">$qName</span>\n"</span><span class="token punctuation">)</span>            <span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"attributes is <span class="token interpolation variable">$attributes</span>\n"</span><span class="token punctuation">)</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">// é’ˆå¯¹èŠ‚ç‚¹ä¸­å†…å®¹çš„è§£æ</span>    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">characters</span><span class="token punctuation">(</span>ch<span class="token operator">:</span> CharArray<span class="token operator">?</span><span class="token punctuation">,</span> start<span class="token operator">:</span> Int<span class="token punctuation">,</span> length<span class="token operator">:</span> Int<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">// é€šè¿‡ startElement ä¸­è®°å½•çš„èŠ‚ç‚¹åç§°, å°†å†…å®¹æ·»åŠ åˆ°ç›¸åº”å®¹å™¨ä¸­</span>        <span class="token keyword">when</span> <span class="token punctuation">(</span>nodeName<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token string">"id"</span> <span class="token operator">-></span> id<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>ch<span class="token punctuation">,</span> start<span class="token punctuation">,</span> length<span class="token punctuation">)</span>            <span class="token string">"name"</span> <span class="token operator">-></span> name<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>ch<span class="token punctuation">,</span> start<span class="token punctuation">,</span> length<span class="token punctuation">)</span>            <span class="token string">"version"</span> <span class="token operator">-></span> version<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>ch<span class="token punctuation">,</span> start<span class="token punctuation">,</span> length<span class="token punctuation">)</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">// å®ŒæˆæŸä¸ªèŠ‚ç‚¹è§£ææ—¶è°ƒç”¨</span>    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">endElement</span><span class="token punctuation">(</span>uri<span class="token operator">:</span> String<span class="token operator">?</span><span class="token punctuation">,</span> localName<span class="token operator">:</span> String<span class="token operator">?</span><span class="token punctuation">,</span> qName<span class="token operator">:</span> String<span class="token operator">?</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">"app"</span> <span class="token operator">==</span> localName<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            retXMLData<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"id is <span class="token interpolation"><span class="token delimiter variable">$&#123;</span>id<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token delimiter variable">&#125;</span></span> @ name is <span class="token interpolation"><span class="token delimiter variable">$&#123;</span>name<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token delimiter variable">&#125;</span></span> @ version is <span class="token interpolation"><span class="token delimiter variable">$&#123;</span>version<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token delimiter variable">&#125;</span></span>\n"</span><span class="token punctuation">)</span>            id<span class="token punctuation">.</span><span class="token function">setLength</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>            name<span class="token punctuation">.</span><span class="token function">setLength</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>            version<span class="token punctuation">.</span><span class="token function">setLength</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">// å®Œæˆæ•´ä¸ª xml è§£ææ—¶è°ƒç”¨</span>    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">endDocument</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">endDocument</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">fun</span> <span class="token function">getRetXMLData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> String <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>retXMLData<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="2"><li>åœ¨ SAXParser ä¸­åº”ç”¨ contentHandler è¿›è¡Œ parse</li></ol><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">private</span> <span class="token keyword">fun</span> <span class="token function">parseXMLWithSAX</span><span class="token punctuation">(</span>xmlData<span class="token operator">:</span> String<span class="token punctuation">)</span><span class="token operator">:</span> String <span class="token punctuation">&#123;</span>    <span class="token keyword">var</span> retXMLData <span class="token operator">=</span> <span class="token string">""</span>    <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">val</span> factory <span class="token operator">=</span> SAXParserFactory<span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">val</span> xmlReader <span class="token operator">=</span> factory<span class="token punctuation">.</span><span class="token function">newSAXParser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>xmlReader        <span class="token keyword">val</span> handler <span class="token operator">=</span> <span class="token function">XMLContentHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        xmlReader<span class="token punctuation">.</span>contentHandler <span class="token operator">=</span> handler        xmlReader<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token function">InputSource</span><span class="token punctuation">(</span><span class="token function">StringReader</span><span class="token punctuation">(</span>xmlData<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        retXMLData <span class="token operator">=</span> handler<span class="token punctuation">.</span><span class="token function">getRetXMLData</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token operator">:</span> Exception<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">return</span> retXMLData<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="json-parser"><a class="markdownIt-Anchor" href="#json-parser"></a> JSON Parser</h1><p>JSON ä½“ç§¯æ›´å°ï¼Œåœ¨ç½‘ç»œä¸Šä¼ è¾“çš„æ—¶å€™æ›´çœæµé‡ï¼Œä½†è¯­ä¹‰æ€§è¾ƒå·®ï¼Œä¸å¦‚ XML ç›´è§‚</p><h2 id="jsonobject-è§£æ"><a class="markdownIt-Anchor" href="#jsonobject-è§£æ"></a> JSONObject è§£æ</h2><p>è§£æçš„æ–¹å¼ååˆ†ç®€å•, å°† JSON å­—ç¬¦ä¸²è½¬ä¸º JSONArray å¯¹è±¡, éå†æŒ‰ç±»å‹è§£æå³å¯</p><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">val</span> retJsonData <span class="token operator">=</span> <span class="token function">StringBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">try</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">val</span> jsonArray <span class="token operator">=</span> <span class="token function">JSONArray</span><span class="token punctuation">(</span>jsonData<span class="token punctuation">)</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token keyword">in</span> <span class="token number">0</span> until jsonArray<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">val</span> jsonObject <span class="token operator">=</span> jsonArray<span class="token punctuation">.</span><span class="token function">getJSONObject</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>        <span class="token keyword">val</span> id <span class="token operator">=</span> jsonObject<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span>        <span class="token keyword">val</span> name <span class="token operator">=</span> jsonObject<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">)</span>        <span class="token keyword">val</span> version <span class="token operator">=</span> jsonObject<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">"version"</span><span class="token punctuation">)</span>        retJsonData<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"id is <span class="token interpolation variable">$id</span> | name is <span class="token interpolation variable">$name</span> | version is <span class="token interpolation variable">$version</span>\n"</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token operator">:</span> Exception<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token keyword">return</span> retJsonData<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="gson-è§£æ"><a class="markdownIt-Anchor" href="#gson-è§£æ"></a> GSON è§£æ</h2><ol><li><code>app\build.gradle</code> ä¸­æ·»åŠ ä¾èµ–</li></ol><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin">implementation <span class="token string">'com.google.code.gson:gson:2.8.5'</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ol start="2"><li>ä¸º JSON æ•°æ®å»ºç«‹ä¸€ä¸ª Bean ç±»</li></ol><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">class</span> <span class="token function">Book</span><span class="token punctuation">(</span><span class="token keyword">var</span> id<span class="token operator">:</span> Int<span class="token punctuation">,</span> <span class="token keyword">var</span> name<span class="token operator">:</span> String<span class="token punctuation">,</span> <span class="token keyword">var</span> version<span class="token operator">:</span> String<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ol start="3"><li>ä½¿ç”¨ GSON çš„å®ä¾‹è¿›è¡Œè§£æ</li></ol><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">private</span> <span class="token keyword">fun</span> <span class="token function">parseJsonWithGSON</span><span class="token punctuation">(</span>jsonData<span class="token operator">:</span> String<span class="token punctuation">)</span><span class="token operator">:</span> String <span class="token punctuation">&#123;</span>    <span class="token keyword">val</span> retJsonData <span class="token operator">=</span> <span class="token function">StringBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">val</span> gson <span class="token operator">=</span> <span class="token function">Gson</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token comment">// è§£æå•ä¸ªæ•°æ®</span>    <span class="token comment">// val book = gson.fromJson(jsonData, Book::class.java)</span>    <span class="token comment">// è§£æå¤šä¸ª(æ•°ç»„)æ•°æ®</span>    <span class="token comment">// é˜²æ­¢ List&lt;Book> ä¸­ Book ç±»å‹è¢«æ“¦é™¤</span>    <span class="token comment">// TypeToken æ˜¯ä¸ªç±», æˆ‘ä»¬ä½¿ç”¨ object: TypeToken&lt;List&lt;Book>>() &#123;&#125; å®šä¹‰äº†å…¶åŒ¿åç±», ç„¶åè·å–äº†è¿™ä¸ªç±»çš„ type å±æ€§</span>    <span class="token comment">// ç›¸å½“äºç”¨ä¸€ä¸ªå­ç±» SubList extends List&lt;String> å°†çˆ¶ç±»ä¸­çš„æ³›å‹ç»™ä¿å­˜</span>    <span class="token keyword">val</span> typeOf <span class="token operator">=</span> <span class="token keyword">object</span><span class="token operator">:</span> TypeToken<span class="token operator">&lt;</span>List<span class="token operator">&lt;</span>Book<span class="token operator">></span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">.</span>type    <span class="token keyword">val</span> books <span class="token operator">=</span> gson<span class="token punctuation">.</span>fromJson<span class="token operator">&lt;</span>List<span class="token operator">&lt;</span>Book<span class="token operator">></span><span class="token operator">></span><span class="token punctuation">(</span>jsonData<span class="token punctuation">,</span> typeOf<span class="token punctuation">)</span>    books<span class="token punctuation">.</span><span class="token function">forEach</span> <span class="token punctuation">&#123;</span>        retJsonData<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"id is <span class="token interpolation"><span class="token delimiter variable">$&#123;</span>it<span class="token punctuation">.</span>id<span class="token delimiter variable">&#125;</span></span> @ name is <span class="token interpolation"><span class="token delimiter variable">$&#123;</span>it<span class="token punctuation">.</span>name<span class="token delimiter variable">&#125;</span></span> @ version is <span class="token interpolation"><span class="token delimiter variable">$&#123;</span>it<span class="token punctuation">.</span>version<span class="token delimiter variable">&#125;</span></span>\n"</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">return</span> retJsonData<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="gson-å¤„ç†å¤æ‚æ•°æ®"><a class="markdownIt-Anchor" href="#gson-å¤„ç†å¤æ‚æ•°æ®"></a> GSON å¤„ç†å¤æ‚æ•°æ®</h2><p>å¦‚æœæ˜¯æ—¶é—´ç­‰å¤æ‚å¯¹è±¡çš„éœ€è¦æ‰‹åŠ¨é…ç½®é’ˆå¯¹ç›®æ ‡å¯¹è±¡çš„ Serializer ä¸ Deseralizer</p><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">val</span> todoGson <span class="token operator">=</span> <span class="token function">GsonBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">registerTypeAdapter</span><span class="token punctuation">(</span>LocalDateTime<span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">.</span>java<span class="token punctuation">,</span> <span class="token comment">// å¯¹ LocalDateTime æ·»åŠ  Serializer</span>        <span class="token keyword">object</span> <span class="token operator">:</span> JsonSerializer<span class="token operator">&lt;</span>LocalDateTime<span class="token operator">></span> <span class="token punctuation">&#123;</span>            <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">serialize</span><span class="token punctuation">(</span>                src<span class="token operator">:</span> LocalDateTime<span class="token operator">?</span><span class="token punctuation">,</span>                typeOfSrc<span class="token operator">:</span> Type<span class="token operator">?</span><span class="token punctuation">,</span>                context<span class="token operator">:</span> JsonSerializationContext<span class="token operator">?</span>            <span class="token punctuation">)</span><span class="token operator">:</span> JsonElement <span class="token punctuation">&#123;</span>                <span class="token keyword">return</span> <span class="token function">JsonPrimitive</span><span class="token punctuation">(</span>src<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">toLong</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// toLong æ˜¯æˆ‘å¯¹ LocalDateTime æ·»åŠ çš„æ–¹æ³•, è½¬ä¸ºäº† millsSecond</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">registerTypeAdapter</span><span class="token punctuation">(</span>LocalDateTime<span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">.</span>java<span class="token punctuation">,</span> <span class="token comment">// å¯¹ LocalDateTime æ·»åŠ  Deserializer</span>        <span class="token keyword">object</span> <span class="token operator">:</span> JsonDeserializer<span class="token operator">&lt;</span>LocalDateTime<span class="token operator">></span> <span class="token punctuation">&#123;</span>        <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">deserialize</span><span class="token punctuation">(</span>            json<span class="token operator">:</span> JsonElement<span class="token operator">?</span><span class="token punctuation">,</span>            typeOfT<span class="token operator">:</span> Type<span class="token operator">?</span><span class="token punctuation">,</span>            context<span class="token operator">:</span> JsonDeserializationContext<span class="token operator">?</span>        <span class="token punctuation">)</span><span class="token operator">:</span> LocalDateTime <span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> json<span class="token operator">!!</span><span class="token punctuation">.</span>asJsonPrimitive<span class="token punctuation">.</span>asString<span class="token punctuation">.</span><span class="token function">toLong</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toLocalDateTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// è·å– json å­˜å‚¨çš„ long æ ¼å¼æ•°æ®ï¼Œè½¬ä¸º LocalDatetime</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">serializeNulls</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">// to Json</span><span class="token keyword">val</span> dbJson <span class="token operator">=</span> todoGson<span class="token punctuation">.</span><span class="token function">toJson</span><span class="token punctuation">(</span>dbInJson<span class="token punctuation">)</span><span class="token comment">// back to obj</span><span class="token keyword">val</span> dbInJson <span class="token operator">=</span> todoGson<span class="token punctuation">.</span><span class="token function">fromJson</span><span class="token punctuation">(</span>dbJson<span class="token punctuation">,</span> DBInJson<span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">.</span>java<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="ç½‘ç»œè¯·æ±‚çš„å°è£…"><a class="markdownIt-Anchor" href="#ç½‘ç»œè¯·æ±‚çš„å°è£…"></a> ç½‘ç»œè¯·æ±‚çš„å°è£…</h1><p>æ–°å»ºä¸€ä¸ªå·¥å…·ç±»å¯¹ç½‘ç»œè¯·æ±‚è¿›è¡Œå°è£…, ä½†æ˜¯å› ä¸ºæ˜¯å¤šçº¿ç¨‹ä»»åŠ¡, è¦å†äº‹ä»¶å®Œæˆæˆ–å¤±è´¥æ—¶è¿›è¡Œç›¸åº”çš„å›è°ƒå¤„ç†, å› æ­¤éœ€è¦å®šä¹‰ç›¸å…³çš„å›è°ƒæ¥å£, æˆ–å®ç°ç›¸å…³åº“æä¾›çš„å›è°ƒæ¥å£</p><p>ç›¸å…³çš„å›è°ƒæ¥å£</p><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">interface</span> HttpCallbackListener <span class="token punctuation">&#123;</span>    <span class="token keyword">fun</span> <span class="token function">onFinish</span><span class="token punctuation">(</span>response<span class="token operator">:</span> String<span class="token punctuation">)</span>    <span class="token keyword">fun</span> <span class="token function">onError</span><span class="token punctuation">(</span>e<span class="token operator">:</span> Exception<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>æ•´ä½“å·¥å…·ç±»çš„å®ç°</p><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">object</span> HttpUtil <span class="token punctuation">&#123;</span>    <span class="token keyword">fun</span> <span class="token function">sendHttpRequest</span><span class="token punctuation">(</span>address<span class="token operator">:</span> String<span class="token punctuation">,</span> callbackListener<span class="token operator">:</span> HttpCallbackListener<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        thread <span class="token punctuation">&#123;</span>            <span class="token keyword">var</span> connection<span class="token operator">:</span> HttpURLConnection<span class="token operator">?</span> <span class="token operator">=</span> <span class="token keyword">null</span>            <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">val</span> response <span class="token operator">=</span> <span class="token function">StringBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                <span class="token keyword">var</span> url <span class="token operator">=</span> <span class="token function">URL</span><span class="token punctuation">(</span>address<span class="token punctuation">)</span>                connection <span class="token operator">=</span> url<span class="token punctuation">.</span><span class="token function">openConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> HttpURLConnection                connection<span class="token punctuation">.</span>connectTimeout <span class="token operator">=</span> <span class="token number">8000</span>                connection<span class="token punctuation">.</span>readTimeout <span class="token operator">=</span> <span class="token number">8000</span>                <span class="token keyword">val</span> input <span class="token operator">=</span> connection<span class="token punctuation">.</span>inputStream                <span class="token keyword">val</span> reader <span class="token operator">=</span> <span class="token function">BufferedReader</span><span class="token punctuation">(</span><span class="token function">InputStreamReader</span><span class="token punctuation">(</span>input<span class="token punctuation">)</span><span class="token punctuation">)</span>                reader<span class="token punctuation">.</span><span class="token function">use</span> <span class="token punctuation">&#123;</span>                    reader<span class="token punctuation">.</span><span class="token function">forEachLine</span> <span class="token punctuation">&#123;</span>                        response<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>it<span class="token punctuation">)</span>                    <span class="token punctuation">&#125;</span>                <span class="token punctuation">&#125;</span>                callbackListener<span class="token punctuation">.</span><span class="token function">onFinish</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>            <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token operator">:</span> Exception<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                callbackListener<span class="token punctuation">.</span><span class="token function">onError</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>            <span class="token punctuation">&#125;</span> <span class="token keyword">finally</span> <span class="token punctuation">&#123;</span>                connection<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">disconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">fun</span> <span class="token function">sendOkHttpRequest</span><span class="token punctuation">(</span>address<span class="token operator">:</span> String<span class="token punctuation">,</span> callbackListener<span class="token operator">:</span> okhttp3<span class="token punctuation">.</span>Callback<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">val</span> client <span class="token operator">=</span> <span class="token function">OkHttpClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">val</span> request <span class="token operator">=</span> Request<span class="token punctuation">.</span><span class="token function">Builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">url</span><span class="token punctuation">(</span>address<span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token comment">// OkHttp åœ¨ enqueue() æ–¹æ³•çš„å†…éƒ¨å·²ç»å¸®æˆ‘ä»¬å¼€å¥½å­çº¿ç¨‹äº†ï¼Œç„¶åä¼šåœ¨å­çº¿ç¨‹ä¸­æ‰§è¡Œ HTTP è¯·æ±‚ï¼Œå¹¶å°†æœ€ç»ˆçš„è¯·æ±‚ç»“æœå›è°ƒåˆ° okhttp3.Callback å½“ä¸­</span>        client<span class="token punctuation">.</span><span class="token function">newCall</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">enqueue</span><span class="token punctuation">(</span>callbackListener<span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="ç½‘ç»œåº“-retrofit"><a class="markdownIt-Anchor" href="#ç½‘ç»œåº“-retrofit"></a> ç½‘ç»œåº“ Retrofit</h1><h2 id="quick-start-4"><a class="markdownIt-Anchor" href="#quick-start-4"></a> Quick Start</h2><ol><li><code>app/build.gradle</code> ä¸­æ·»åŠ ä¾èµ–</li></ol><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin">implementation <span class="token string">'com.squareup.retrofit2:retrofit:2.6.1'</span>implementation <span class="token string">'com.squareup.retrofit2:converter-gson:2.6.1'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ol start="2"><li>å°è£…å¥½è¦è¯·æ±‚çš„å¯¹è±¡</li></ol><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">class</span> <span class="token function">Book</span><span class="token punctuation">(</span><span class="token keyword">val</span> id<span class="token operator">:</span> String<span class="token punctuation">,</span> <span class="token keyword">val</span> name<span class="token operator">:</span> String<span class="token punctuation">,</span> <span class="token keyword">val</span> version<span class="token operator">:</span> String<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ol start="3"><li>å®šä¹‰è¯·æ±‚æ¥å£</li></ol><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">interface</span> BookService <span class="token punctuation">&#123;</span>    <span class="token annotation builtin">@GET</span><span class="token punctuation">(</span><span class="token string">"/DVWA/get_data.json"</span><span class="token punctuation">)</span>    <span class="token comment">// è¿”å›å€¼å¿…é¡»å£°æ˜æˆ Retrofit ä¸­å†…ç½®çš„ Call ç±»å‹</span>    <span class="token keyword">fun</span> <span class="token function">getBookData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> Call<span class="token operator">&lt;</span>List<span class="token operator">&lt;</span>Book<span class="token operator">></span><span class="token operator">></span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="4"><li>è§¦å‘æœåŠ¡å™¨è¯·æ±‚: ä¼ å…¥æœåŠ¡å™¨æ ¹åœ°å€è·å– Retrofit å¯¹è±¡ + åˆ›å»ºæœåŠ¡å¯¹è±¡ + è°ƒç”¨æœåŠ¡è·å–æ•°æ®</li></ol><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin">buttonGetBookData<span class="token punctuation">.</span><span class="token function">setOnClickListener</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">val</span> retrofit <span class="token operator">=</span> Retrofit<span class="token punctuation">.</span><span class="token function">Builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">baseUrl</span><span class="token punctuation">(</span><span class="token string">"http://192.168.0.107/"</span><span class="token punctuation">)</span>        <span class="token comment">// ç”¨äºæŒ‡å®š Retrofit åœ¨è§£ææ•°æ®æ—¶æ‰€ä½¿ç”¨çš„è½¬æ¢åº“ï¼Œè¿™é‡ŒæŒ‡å®šæˆ GsonConverterFactory - è·å–çš„æ˜¯ JSON æ•°æ®</span>        <span class="token punctuation">.</span><span class="token function">addConverterFactory</span><span class="token punctuation">(</span>GsonConverterFactory<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">val</span> appService <span class="token operator">=</span> retrofit<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>BookService<span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">.</span>java<span class="token punctuation">)</span>    appService<span class="token punctuation">.</span><span class="token function">getBookData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">enqueue</span><span class="token punctuation">(</span><span class="token keyword">object</span> <span class="token operator">:</span> Callback<span class="token operator">&lt;</span>List<span class="token operator">&lt;</span>Book<span class="token operator">></span><span class="token operator">></span> <span class="token punctuation">&#123;</span>        <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">onResponse</span><span class="token punctuation">(</span>call<span class="token operator">:</span> Call<span class="token operator">&lt;</span>List<span class="token operator">&lt;</span>Book<span class="token operator">></span><span class="token operator">></span><span class="token punctuation">,</span> response<span class="token operator">:</span> Response<span class="token operator">&lt;</span>List<span class="token operator">&lt;</span>Book<span class="token operator">></span><span class="token operator">></span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token comment">// è‡ªåŠ¨çš„å¤šçº¿ç¨‹æ“ä½œ</span>            <span class="token comment">// å½“å‘èµ·è¯·æ±‚çš„æ—¶å€™ï¼ŒRetrofit ä¼šè‡ªåŠ¨åœ¨å†…éƒ¨å¼€å¯å­çº¿ç¨‹ï¼Œå½“æ•°æ®å›è°ƒåˆ° Callback ä¸­ä¹‹åï¼ŒRetrofit åˆä¼šè‡ªåŠ¨åˆ‡æ¢å›ä¸»çº¿</span>            <span class="token keyword">val</span> list <span class="token operator">=</span> response<span class="token punctuation">.</span><span class="token function">body</span><span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>list <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">for</span> <span class="token punctuation">(</span>book <span class="token keyword">in</span> list<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    Log<span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span><span class="token string">"MainActivity"</span><span class="token punctuation">,</span> <span class="token string">"id is <span class="token interpolation"><span class="token delimiter variable">$&#123;</span>book<span class="token punctuation">.</span>id<span class="token delimiter variable">&#125;</span></span>"</span><span class="token punctuation">)</span>                    Log<span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span><span class="token string">"MainActivity"</span><span class="token punctuation">,</span> <span class="token string">"name is <span class="token interpolation"><span class="token delimiter variable">$&#123;</span>book<span class="token punctuation">.</span>name<span class="token delimiter variable">&#125;</span></span>"</span><span class="token punctuation">)</span>                    Log<span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span><span class="token string">"MainActivity"</span><span class="token punctuation">,</span> <span class="token string">"version is <span class="token interpolation"><span class="token delimiter variable">$&#123;</span>book<span class="token punctuation">.</span>version<span class="token delimiter variable">&#125;</span></span>"</span><span class="token punctuation">)</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">onFailure</span><span class="token punctuation">(</span>call<span class="token operator">:</span> Call<span class="token operator">&lt;</span>List<span class="token operator">&lt;</span>Book<span class="token operator">></span><span class="token operator">></span><span class="token punctuation">,</span> t<span class="token operator">:</span> Throwable<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            t<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol><li>æŒ‰ç…§ä¹‹å‰æ­¥éª¤é…ç½® HTTP æ˜æ–‡è¯·æ±‚ + AndroidManifest ä¸­é…ç½®ç½‘ç»œæƒé™</li></ol><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>uses-permission</span> <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>android.permission.INTERNET<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="å¤æ‚æ¥å£"><a class="markdownIt-Anchor" href="#å¤æ‚æ¥å£"></a> å¤æ‚æ¥å£</h2><p>é€šè¿‡å˜é‡åŒ¹é…å¤šä¸ªæ¥å£</p><ul><li>Path ä¸­åº”ç”¨å˜é‡</li></ul><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token annotation builtin">@GET</span><span class="token punctuation">(</span><span class="token string">"&#123;page&#125;/get_data.json"</span><span class="token punctuation">)</span><span class="token keyword">fun</span> <span class="token function">getData</span><span class="token punctuation">(</span><span class="token annotation builtin">@Path</span><span class="token punctuation">(</span><span class="token string">"page"</span><span class="token punctuation">)</span> page<span class="token operator">:</span> Int<span class="token punctuation">)</span><span class="token operator">:</span> Call<span class="token operator">&lt;</span>Data<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ul><li>GET è¯·æ±‚ä¸­çš„å‚æ•°: <code>http://example.com/get_data.json?u=&lt;user&gt;&amp;t=&lt;token&gt;</code></li></ul><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token annotation builtin">@GET</span><span class="token punctuation">(</span><span class="token string">"get_data.json"</span><span class="token punctuation">)</span><span class="token keyword">fun</span> <span class="token function">getData</span><span class="token punctuation">(</span><span class="token annotation builtin">@Query</span><span class="token punctuation">(</span><span class="token string">"u"</span><span class="token punctuation">)</span> user<span class="token operator">:</span> String<span class="token punctuation">,</span> <span class="token annotation builtin">@Query</span><span class="token punctuation">(</span><span class="token string">"t"</span><span class="token punctuation">)</span> token<span class="token operator">:</span> String<span class="token punctuation">)</span><span class="token operator">:</span> Call<span class="token operator">&lt;</span>Data<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ul><li>POST è¯·æ±‚ä¸­çš„å‚æ•°</li></ul><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token annotation builtin">@POST</span><span class="token punctuation">(</span><span class="token string">"data/create.json"</span><span class="token punctuation">)</span><span class="token keyword">fun</span> <span class="token function">createData</span><span class="token punctuation">(</span><span class="token annotation builtin">@Body</span> <span class="token keyword">data</span><span class="token operator">:</span> Data<span class="token punctuation">)</span><span class="token operator">:</span> Call<span class="token operator">&lt;</span>ResonseBody<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ul><li>é™æ€é…ç½®è¯·æ±‚å¤´å‚æ•°</li></ul><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token annotation builtin">@Headers</span><span class="token punctuation">(</span><span class="token string">"User-Agent: ..."</span><span class="token punctuation">,</span> <span class="token string">"Cache-Control: ..."</span><span class="token punctuation">)</span><span class="token annotation builtin">@GET</span><span class="token punctuation">(</span><span class="token string">"get_data.json"</span><span class="token punctuation">)</span><span class="token keyword">fun</span> <span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> Call<span class="token operator">&lt;</span>Data<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><ul><li>åŠ¨æ€é…ç½®è¯·æ±‚å¤´å‚æ•°</li></ul><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token annotation builtin">@GET</span><span class="token punctuation">(</span><span class="token string">"get_data.json"</span><span class="token punctuation">)</span><span class="token keyword">fun</span> <span class="token function">getData</span><span class="token punctuation">(</span><span class="token annotation builtin">@Header</span><span class="token punctuation">(</span><span class="token string">"User-Agent"</span><span class="token punctuation">)</span> userAgent<span class="token operator">:</span> String<span class="token punctuation">,</span><span class="token annotation builtin">@Header</span><span class="token punctuation">(</span><span class="token string">"Cache-Control"</span><span class="token punctuation">)</span> cacheControl<span class="token operator">:</span> String<span class="token punctuation">)</span><span class="token operator">:</span> Call<span class="token operator">&lt;</span>Data<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h2 id="å•ä¾‹ç±»å°è£…"><a class="markdownIt-Anchor" href="#å•ä¾‹ç±»å°è£…"></a> å•ä¾‹ç±»å°è£…</h2><p>Service çš„åŠ¨æ€ä»£ç†å¯¹è±¡æ˜¯èƒ½é€šç”¨çš„, å› æ­¤ä¾æ—§å¯ä»¥é€šè¿‡åˆ›å»ºä¸€ä¸ªå•ä¾‹ç±»æ¥å®ç°å…±äº«ä½¿ç”¨</p><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">object</span> ServiceCreator <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token keyword">const</span> <span class="token keyword">val</span> BASE_URL <span class="token operator">=</span> <span class="token string">"http://10.0.2.2/"</span>    <span class="token keyword">private</span> <span class="token keyword">val</span> retrofit <span class="token operator">=</span> Retrofit<span class="token punctuation">.</span><span class="token function">Builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">baseUrl</span><span class="token punctuation">(</span>BASE_URL<span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">addConverterFactory</span><span class="token punctuation">(</span>GsonConverterFactory<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">fun</span> <span class="token operator">&lt;</span>T<span class="token operator">></span> <span class="token function">create</span><span class="token punctuation">(</span>serviceClass<span class="token operator">:</span> Class<span class="token operator">&lt;</span>T<span class="token operator">></span><span class="token punctuation">)</span><span class="token operator">:</span> T <span class="token operator">=</span> retrofit<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>serviceClass<span class="token punctuation">)</span>    <span class="token keyword">inline</span> <span class="token keyword">fun</span> <span class="token operator">&lt;</span><span class="token keyword">reified</span> T<span class="token operator">></span> <span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> T <span class="token operator">=</span> <span class="token function">create</span><span class="token punctuation">(</span>T<span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">.</span>java<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> Android Dev. </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Android </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>10-Service</title>
      <link href="/Coming-blog/2022/08/23/10-service/"/>
      <url>/Coming-blog/2022/08/23/10-service/</url>
      
        <content type="html"><![CDATA[<h1 id="service"><a class="markdownIt-Anchor" href="#service"></a> Service</h1><p>åå°è¿è¡Œçš„æœåŠ¡, ä¸éœ€è¦ä¸ç”¨æˆ·äº¤äº’ä¸”éœ€è¦é•¿æœŸæ‰§è¡Œçš„ä»»åŠ¡</p><p>Service å¹¶ä¸æ˜¯è¿è¡Œåœ¨ä¸€ä¸ªç‹¬ç«‹çš„è¿›ç¨‹å½“ä¸­çš„ï¼Œè€Œæ˜¯ä¾èµ–äºåˆ›å»º Service æ—¶æ‰€åœ¨çš„åº”ç”¨ç¨‹åºè¿›ç¨‹ï¼Œå½“æŸä¸ªåº”ç”¨ç¨‹åºè¿›ç¨‹è¢«æ€æ‰æ—¶ï¼Œæ‰€æœ‰ä¾èµ–äºè¯¥è¿›ç¨‹çš„ Service ä¹Ÿä¼šåœæ­¢è¿è¡Œ</p><h2 id="definition"><a class="markdownIt-Anchor" href="#definition"></a> Definition</h2><p>ç»§æ‰¿ Service ç±», onCreate() æ–¹æ³•åœ¨ Service åˆ›å»ºæ—¶è°ƒç”¨; onStartCommand() åœ¨ Service å¯åŠ¨æ—¶è°ƒç”¨; onDestroy() ...;</p><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">class</span> MyService <span class="token operator">:</span> <span class="token function">Service</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token keyword">val</span> TAG <span class="token operator">=</span> <span class="token string">"MyService"</span>    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">onCreate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onCreate</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        Log<span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">"onCreate"</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">onStartCommand</span><span class="token punctuation">(</span>intent<span class="token operator">:</span> Intent<span class="token operator">?</span><span class="token punctuation">,</span> flags<span class="token operator">:</span> Int<span class="token punctuation">,</span> startId<span class="token operator">:</span> Int<span class="token punctuation">)</span><span class="token operator">:</span> Int <span class="token punctuation">&#123;</span>        Log<span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">"onStartCommand"</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onStartCommand</span><span class="token punctuation">(</span>intent<span class="token punctuation">,</span> flags<span class="token punctuation">,</span> startId<span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">onDestroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onDestroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        Log<span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">"onDestroy"</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="contorller"><a class="markdownIt-Anchor" href="#contorller"></a> Contorller</h2><p>ä¸»è¦é€šè¿‡ intent æ§åˆ¶ Service çš„å¯åŠ¨æˆ–å…³é—­</p><p>Tips: ä» Android 8.0 å¼€å§‹ï¼Œåº”ç”¨çš„åå°åŠŸèƒ½è¢«å¤§å¹…å‰Šå‡ï¼Œç°åœ¨åªæœ‰å½“åº”ç”¨ä¿æŒåœ¨å‰å°å¯è§çŠ¶æ€çš„æƒ…å†µä¸‹ï¼ŒService æ‰èƒ½ä¿è¯ç¨³å®šè¿è¡Œï¼Œä¸€æ—¦åº”ç”¨è¿›å…¥åå°ä¹‹åï¼ŒService éšæ—¶éƒ½æœ‰å¯èƒ½è¢«ç³»ç»Ÿå›æ”¶</p><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin">R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>startServiceBtn <span class="token operator">-></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">val</span> intent <span class="token operator">=</span> <span class="token function">Intent</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> MyService<span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">.</span>java<span class="token punctuation">)</span>    <span class="token function">startService</span><span class="token punctuation">(</span>intent<span class="token punctuation">)</span><span class="token punctuation">&#125;</span>R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>stopServiceBtn <span class="token operator">-></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">val</span> intent <span class="token operator">=</span> <span class="token function">Intent</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> MyService<span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">.</span>java<span class="token punctuation">)</span>    <span class="token function">stopService</span><span class="token punctuation">(</span>intent<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="communication"><a class="markdownIt-Anchor" href="#communication"></a> Communication</h2><p>Service è¢«åˆ›å»ºç”¨äºæ‰§è¡Œç›¸åº”çš„åŠŸèƒ½, é‚£å°±ä¼šæ¶‰åŠåˆ°æ‰§è¡Œç»“æœçš„åé¦ˆ, å› æ­¤å¼•å…¥ Binder å¯¹è±¡å®ç° Activity ä¸ Service çš„é€šä¿¡</p><ol><li>åœ¨ Service ä¸­å®šä¹‰å†…éƒ¨ Binder ç±», å®ç°å¯¹æ‰€ä¼ é€’æ¶ˆæ¯çš„å°è£…, é€šè¿‡ onBind æ–¹æ³•ä¸ Activity è¿›è¡Œäº¤äº’</li></ol><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">private</span> <span class="token keyword">val</span> mBinder <span class="token operator">=</span> <span class="token function">DownloadBinder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">inner</span> <span class="token keyword">class</span> DownloadBinder<span class="token operator">:</span> <span class="token function">Binder</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">fun</span> <span class="token function">startDownload</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        Log<span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">"startDownload"</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">fun</span> <span class="token function">getProgress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> Int <span class="token punctuation">&#123;</span>        Log<span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">"get process"</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> <span class="token number">0</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">onBind</span><span class="token punctuation">(</span>intent<span class="token operator">:</span> Intent<span class="token punctuation">)</span><span class="token operator">:</span> IBinder <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> mBinder<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="2"><li>Activity ä¸­é€šè¿‡ bindService ä¸ unbindService ä¸ç›®æ ‡ Service è¿›è¡Œäº¤äº’: ä¸»è¦é€šè¿‡ ServiceConnection åŒ¿åç±»çš„å®ç°å®šä¹‰äº¤äº’çš„åŠ¨ä½œ</li></ol><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">lateinit</span> <span class="token keyword">var</span> downloadBinder<span class="token operator">:</span> MyService<span class="token punctuation">.</span>DownloadBinder<span class="token keyword">private</span> <span class="token keyword">val</span> connection <span class="token operator">=</span> <span class="token keyword">object</span><span class="token operator">:</span> ServiceConnection <span class="token punctuation">&#123;</span>    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">onServiceConnected</span><span class="token punctuation">(</span>name<span class="token operator">:</span> ComponentName<span class="token operator">?</span><span class="token punctuation">,</span> service<span class="token operator">:</span> IBinder<span class="token operator">?</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">// è·å– Service Binder å¯¹è±¡</span>        downloadBinder <span class="token operator">=</span> service <span class="token keyword">as</span> MyService<span class="token punctuation">.</span>DownloadBinder        <span class="token comment">// å‘å¸ƒå‘½ä»¤</span>        downloadBinder<span class="token punctuation">.</span><span class="token function">startDownload</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        downloadBinder<span class="token punctuation">.</span><span class="token function">getProgress</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">onServiceDisconnected</span><span class="token punctuation">(</span>name<span class="token operator">:</span> ComponentName<span class="token operator">?</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        Log<span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span><span class="token string">"MyService"</span><span class="token punctuation">,</span> <span class="token string">"Service Disconnected"</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>bindServiceBtn <span class="token operator">-></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">val</span> intent <span class="token operator">=</span> <span class="token function">Intent</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> MyService<span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">.</span>java<span class="token punctuation">)</span>    <span class="token comment">// Intent, ServiceConnetion, æ ‡å¿—ä½: BIND_AUTO_CREATE, è¡¨ç¤ºåœ¨ Activity å’Œ Service è¿›è¡Œç»‘å®šåè‡ªåŠ¨åˆ›å»º Service</span>    <span class="token function">bindService</span><span class="token punctuation">(</span>intent<span class="token punctuation">,</span> connection<span class="token punctuation">,</span> Context<span class="token punctuation">.</span>BIND_AUTO_CREATE<span class="token punctuation">)</span><span class="token punctuation">&#125;</span>R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>unbindServiceBtn <span class="token operator">-></span> <span class="token punctuation">&#123;</span>    <span class="token function">unbindService</span><span class="token punctuation">(</span>connection<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="life-cycle"><a class="markdownIt-Anchor" href="#life-cycle"></a> Life Cycle</h2><ul><li>Context.startService() è§¦å‘ Service çš„ onStartCommand(); å¦‚æœ Service å¹¶æ²¡æœ‰è¢«åˆ›å»º, è¿˜ä¼šè§¦å‘ onCreate()</li><li>Context.stopService() æˆ– stopSelf() è§¦å‘ onDestroy()</li><li>Context.bindService() è§¦å‘ onBind(); å¦‚æœ Service å¹¶æ²¡æœ‰è¢«åˆ›å»º, è¿˜ä¼šè§¦å‘ onCreate()</li><li>Context.unbindService() è§¦å‘ onDestroy()</li><li>å¦‚æœå…ˆè°ƒç”¨äº† startService ç„¶åè°ƒç”¨äº† bindService é‚£ä¹ˆéœ€è¦è°ƒç”¨ stopService ä¸ unbindService æ‰ä¼šè§¦å‘ onDestroy</li></ul><h1 id="front-desk-service"><a class="markdownIt-Anchor" href="#front-desk-service"></a> Front Desk Service</h1><p>ä» Android 8.0 å¼€å§‹ï¼Œåº”ç”¨çš„åå°åŠŸèƒ½è¢«å¤§å¹…å‰Šå‡ï¼Œç°åœ¨åªæœ‰å½“åº”ç”¨ä¿æŒåœ¨å‰å°å¯è§çŠ¶æ€çš„æƒ…å†µä¸‹ï¼ŒService æ‰èƒ½ä¿è¯ç¨³å®šè¿è¡Œï¼Œä¸€æ—¦åº”ç”¨è¿›å…¥åå°ä¹‹åï¼ŒService éšæ—¶éƒ½æœ‰å¯èƒ½è¢«ç³»ç»Ÿå›æ”¶</p><p>å¯ä»¥ä½¿ç”¨å‰å° Service ä½¿å¾—æœåŠ¡èƒ½ä¿æŒç¨³å®šè¿è¡ŒçŠ¶æ€, ä½†ä¸€ç›´ä¼šæœ‰ä¸€ä¸ªæ­£åœ¨è¿è¡Œçš„å›¾æ ‡åœ¨ç³»ç»Ÿçš„çŠ¶æ€æ æ˜¾ç¤ºï¼Œä¸‹æ‹‰çŠ¶æ€æ åå¯ä»¥çœ‹åˆ°æ›´åŠ è¯¦ç»†çš„ä¿¡æ¯ï¼ˆç±»ä¼¼äºé€šçŸ¥çš„æ•ˆæœï¼‰</p><ol><li>åœ¨ Service çš„ onCreate å£°æ˜å‘¨æœŸä¸­è¿›è¡Œå®šä¹‰</li></ol><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">onCreate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onCreate</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    Log<span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">"onCreate"</span><span class="token punctuation">)</span>    <span class="token comment">// å®šä¹‰å‰å° Service</span>    <span class="token keyword">val</span> manager <span class="token operator">=</span> <span class="token function">getSystemService</span><span class="token punctuation">(</span>Context<span class="token punctuation">.</span>NOTIFICATION_SERVICE<span class="token punctuation">)</span> <span class="token keyword">as</span> NotificationManager    <span class="token keyword">if</span> <span class="token punctuation">(</span>Build<span class="token punctuation">.</span>VERSION<span class="token punctuation">.</span>SDK_INT <span class="token operator">>=</span> Build<span class="token punctuation">.</span>VERSION_CODES<span class="token punctuation">.</span>O<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">val</span> channel <span class="token operator">=</span> <span class="token function">NotificationChannel</span><span class="token punctuation">(</span><span class="token string">"jc Service"</span><span class="token punctuation">,</span> <span class="token string">"å‰å° Service é€šçŸ¥"</span><span class="token punctuation">,</span> NotificationManager<span class="token punctuation">.</span>IMPORTANCE_DEFAULT<span class="token punctuation">)</span>        manager<span class="token punctuation">.</span><span class="token function">createNotificationChannel</span><span class="token punctuation">(</span>channel<span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">val</span> intent <span class="token operator">=</span> <span class="token function">Intent</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> MainActivity<span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">.</span>java<span class="token punctuation">)</span>    <span class="token keyword">val</span> pi <span class="token operator">=</span> PendingIntent<span class="token punctuation">.</span><span class="token function">getActivity</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> intent<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>    <span class="token keyword">val</span> notification <span class="token operator">=</span> NotificationCompat<span class="token punctuation">.</span><span class="token function">Builder</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token string">"jc Service"</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">setContentTitle</span><span class="token punctuation">(</span><span class="token string">"JC Service"</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">setContentText</span><span class="token punctuation">(</span><span class="token string">"This is content text"</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">setSmallIcon</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>drawable<span class="token punctuation">.</span>small_icon<span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">setLargeIcon</span><span class="token punctuation">(</span>BitmapFactory<span class="token punctuation">.</span><span class="token function">decodeResource</span><span class="token punctuation">(</span>resources<span class="token punctuation">,</span> R<span class="token punctuation">.</span>drawable<span class="token punctuation">.</span>large_icon<span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">setContentIntent</span><span class="token punctuation">(</span>pi<span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token comment">// æ³¨å†Œå‰å° Service ç­‰å¾…å¯åŠ¨</span>    <span class="token function">startForeground</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> notification<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="2"><li>åœ¨ AndroidManifest ä¸­å£°æ˜å‰å° Service æƒé™</li></ol><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>uses-permission</span> <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>android.permission.FOREGROUND_SERVICE<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h1 id="multi-thread"><a class="markdownIt-Anchor" href="#multi-thread"></a> Multi Thread</h1><p>åˆ›å»ºå­çº¿ç¨‹æ‰§è¡Œç›¸å…³ä»»åŠ¡, é˜²æ­¢ä¸»çº¿ç¨‹å µå¡</p><h2 id="quick-start"><a class="markdownIt-Anchor" href="#quick-start"></a> Quick Start</h2><ol><li>å®šä¹‰ä¸€ä¸ªçº¿ç¨‹ä»»åŠ¡ç±», å®ç° Runnable æ¥å£</li></ol><blockquote><p>Tips: å­¦ä¹  Java å¤šçº¿ç¨‹æ—¶æœ‰æåˆ°, å•ç»§æ‰¿å¤šæ¥å£çš„æœºåˆ¶, å¯¼è‡´ç»§æ‰¿ Thread è€¦åˆåº¦è¾ƒé«˜, å› æ­¤æ¨èå®ç° Runnable æ¥å£</p></blockquote><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">class</span> MyThread<span class="token operator">:</span> Runnable <span class="token punctuation">&#123;</span>    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">// ç¼–å†™å…·ä½“çš„é€»è¾‘</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="2"><li>å¯åŠ¨çº¿ç¨‹</li></ol><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">val</span> myThread <span class="token operator">=</span> <span class="token function">MyThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token function">Thread</span><span class="token punctuation">(</span>myThread<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>ç†Ÿæ‚‰ Kotlin çš„è¯, å¯ä»¥ç›´æ¥ä½¿ç”¨ Lambda å®ç°å¿«é€Ÿå¯åŠ¨</p><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin">Thread <span class="token punctuation">&#123;</span>    <span class="token operator">..</span><span class="token punctuation">.</span><span class="token punctuation">&#125;</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>æ›´ç®€å•çš„ Kotlin åˆè¿›è¡Œäº†å°è£…, ä½¿ç”¨ Kotlin å†…ç½®çš„é¡¶å±‚å‡½æ•°</p><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin">thread <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h2 id="update-ui-in-thread"><a class="markdownIt-Anchor" href="#update-ui-in-thread"></a> Update UI in thread</h2><p>åŸåˆ™ä¸Š UI çš„æ›´æ–°éƒ½æ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„, å› æ­¤ç›´æ¥å†çº¿ç¨‹ä¸­æ›´æ–° UI ä¼šè§¦å‘å¼‚å¸¸: <code>Only the original thread that created a view hierarchy can touch its views</code></p><p>å¦‚æœå¿…é¡»è¦å†çº¿ç¨‹ä¸­æ›´æ–° UI é‚£ä¹ˆéœ€è¦ä½¿ç”¨å¼‚æ­¥æ¶ˆæ¯å¤„ç†æœºåˆ¶, ç±»ä¼¼äº React ä¸­çš„æ¶ˆæ¯è®¢é˜…æœºåˆ¶(Redux é‚£ä¸€å¥—)</p><ol><li>åˆ›å»ºæ¶ˆæ¯, æŒ‡å®šæ¶ˆæ¯ ID å¹¶å‘é€</li></ol><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin">ButtonChangeText<span class="token punctuation">.</span><span class="token function">setOnClickListener</span> <span class="token punctuation">&#123;</span>    thread <span class="token punctuation">&#123;</span>        <span class="token keyword">val</span> msg <span class="token operator">=</span> <span class="token function">Message</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        msg<span class="token punctuation">.</span>what <span class="token operator">=</span> UPDATE_TEXT        handler<span class="token punctuation">.</span><span class="token function">sendMessage</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="2"><li>æ¶ˆæ¯å¤„ç†</li></ol><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">val</span> handler <span class="token operator">=</span> <span class="token keyword">object</span><span class="token operator">:</span> <span class="token function">Handler</span><span class="token punctuation">(</span>Looper<span class="token punctuation">.</span><span class="token function">getMainLooper</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// ä¸»çº¿ç¨‹ä¸­æ‰§è¡Œ</span>    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">handleMessage</span><span class="token punctuation">(</span>msg<span class="token operator">:</span> Message<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">when</span> <span class="token punctuation">(</span>msg<span class="token punctuation">.</span>what<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            UPDATE_TEXT <span class="token operator">-></span> textView<span class="token punctuation">.</span>text <span class="token operator">=</span> <span class="token string">"Nice to meet you"</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="å¼‚æ­¥æ¶ˆæ¯å¤„ç†æœºåˆ¶"><a class="markdownIt-Anchor" href="#å¼‚æ­¥æ¶ˆæ¯å¤„ç†æœºåˆ¶"></a> å¼‚æ­¥æ¶ˆæ¯å¤„ç†æœºåˆ¶</h1><p>ç»„æˆ: Message, Handler, MessageQueue, Looper</p><ul><li>Message: çº¿ç¨‹ä¹‹é—´ä¼ é€’çš„æ¶ˆæ¯, å¯ä»¥åœ¨å†…éƒ¨æºå¸¦å°‘é‡çš„ä¿¡æ¯ï¼Œç”¨äºåœ¨ä¸åŒçº¿ç¨‹ä¹‹é—´ä¼ é€’æ•°æ®</li><li>Handler: ç”¨äºå‘é€å’Œå¤„ç†æ¶ˆæ¯çš„</li><li>MessageQueue: å­˜æ”¾æ‰€æœ‰é€šè¿‡ Handler å‘é€çš„æ¶ˆæ¯, ç­‰å¾…è¢«å¤„ç†, æ¯ä¸ªçº¿ç¨‹ä¸­åªä¼šæœ‰ä¸€ä¸ª MessageQueue å¯¹è±¡</li><li>Looper: æ¯ä¸ªçº¿ç¨‹ä¸­çš„ MessageQueue çš„ç®¡å®¶ï¼Œè°ƒç”¨ Looper çš„ loop() æ–¹æ³•åï¼Œå°±ä¼šè¿›å…¥ä¸€ä¸ªæ— é™å¾ªç¯å½“ä¸­ï¼Œç„¶åæ¯å½“å‘ç° MessageQueue ä¸­å­˜åœ¨ä¸€æ¡æ¶ˆæ¯æ—¶ï¼Œå°±ä¼šå°†å®ƒå–å‡ºï¼Œå¹¶ä¼ é€’åˆ° Handler çš„ handleMessage() æ–¹æ³•ä¸­ã€‚æ¯ä¸ªçº¿ç¨‹ä¸­åªä¼šæœ‰ä¸€ä¸ªLooperå¯¹è±¡</li></ul><ol><li>ä¸»çº¿ç¨‹ä¸­åˆ›å»º Handler å¯¹è±¡, é‡å†™ handleMessage() æ–¹æ³•</li><li>å­çº¿ç¨‹åˆ›å»º Message å¯¹è±¡, é€šè¿‡ Handler å°† Message å‘å‡º</li><li>å‘å‡ºçš„ Message è¢«æ·»åŠ åˆ° MessageQueue ä¸­ç­‰å¾…è¢«å¤„ç†</li><li>Looper ä¸€ç›´å°è¯•ä» MessageQueue ä¸­å–å‡º Message è¿›è¡Œç›¸åº”å¤„ç†</li></ol><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/202208222155382.png" alt="" /></p><h2 id="asynctask"><a class="markdownIt-Anchor" href="#asynctask"></a> AsyncTask</h2><p>åŸºäºå¼‚æ­¥æ¶ˆæ¯å¤„ç†æœºåˆ¶çš„å°è£…, æ˜¯ä¸€ä¸ªæŠ½è±¡ç±», å…±<strong>ä¸‰ä¸ªæ³›å‹å‚æ•°</strong></p><ul><li>Params: æ‰§è¡Œç›¸å…³ä»»åŠ¡æ‰€éœ€çš„å‚æ•°</li><li>Progress: åœ¨åå°ä»»åŠ¡æ‰§è¡Œæ—¶ï¼Œå¦‚æœéœ€è¦åœ¨ç•Œé¢ä¸Šæ˜¾ç¤ºå½“å‰çš„è¿›åº¦ï¼Œåˆ™ä½¿ç”¨è¿™é‡ŒæŒ‡å®šçš„æ³›å‹ä½œä¸ºè¿›åº¦å•ä½</li><li>Result: å½“ä»»åŠ¡æ‰§è¡Œå®Œæ¯•åï¼Œå¦‚æœéœ€è¦å¯¹ç»“æœè¿›è¡Œè¿”å›ï¼Œåˆ™ä½¿ç”¨è¿™é‡ŒæŒ‡å®šçš„æ³›å‹ä½œä¸ºè¿”å›å€¼ç±»å‹</li></ul><p>å¸¸éœ€è¦é‡å†™çš„æ–¹æ³•æœ‰å››ä¸ª:</p><ul><li>onPreExecute(): åœ¨åå°ä»»åŠ¡å¼€å§‹æ‰§è¡Œä¹‹å‰è°ƒç”¨ï¼Œç”¨äºè¿›è¡Œä¸€äº›ç•Œé¢ä¸Šçš„åˆå§‹åŒ–æ“ä½œï¼Œæ¯”å¦‚æ˜¾ç¤ºä¸€ä¸ªè¿›åº¦æ¡å¯¹è¯æ¡†ç­‰</li><li>doInBackground(Params...): åœ¨å­çº¿ç¨‹ä¸­è¿è¡Œçš„å…·ä½“ä»»åŠ¡, ä¸å¯æ˜¾ç¤ºè¿›è¡Œ UI æ“ä½œ, å¯ä»¥é€šè¿‡ä¸€äº›æ–¹æ³•å¦‚ publishProgress(Progress...) æ¥å®Œæˆ</li><li>onProgressUpdate(Progress...): åˆ©ç”¨å‚æ•°ä¸­çš„æ•°å€¼å°±å¯ä»¥å¯¹ UI è¿›è¡Œæ›´æ–°</li><li>onPostExecute(Result): ä»»åŠ¡æ‰§è¡Œå®Œæ¯•åè°ƒç”¨, å¯ä»¥åˆ©ç”¨è¿”å›çš„æ•°æ®è¿›è¡Œä¸€äº› UI æ“ä½œï¼Œæ¯”å¦‚è¯´æé†’ä»»åŠ¡æ‰§è¡Œçš„ç»“æœï¼Œä»¥åŠå…³é—­è¿›åº¦æ¡å¯¹è¯æ¡†ç­‰</li></ul><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">class</span> DownloadTask<span class="token operator">:</span> AsyncTask<span class="token operator">&lt;</span>Unit<span class="token punctuation">,</span> Int<span class="token punctuation">,</span> Boolean<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h1 id="service-multi-threaddeprecated-no-good-alternatives-were-found"><a class="markdownIt-Anchor" href="#service-multi-threaddeprecated-no-good-alternatives-were-found"></a> Service + Multi Thread[Deprecated, no good alternatives were found]</h1><p>Service ä¸­çš„ä»£ç é»˜è®¤è¿è¡Œåœ¨ä¸»çº¿ç¨‹å½“ä¸­ï¼Œå¦‚æœç›´æ¥åœ¨ Service é‡Œå¤„ç†ä¸€äº›è€—æ—¶çš„é€»è¾‘ï¼Œå°±å¾ˆå®¹æ˜“å‡ºç° ANRï¼ˆApplication Not Respondingï¼‰çš„æƒ…å†µ</p><p>å› æ­¤æ¨è Service ä½¿ç”¨å¤šçº¿ç¨‹, åœ¨ Service çš„æ¯ä¸ªå…·ä½“æ–¹æ³•é‡Œå¼€å¯ä¸€ä¸ªå­çº¿ç¨‹, å¤„ç†è€—æ—¶é€»è¾‘, è€Œ Android å°†è¿™ç§å¼‚æ­¥ä¸”æ‰§è¡Œå®Œæ¯•åè‡ªåŠ¨åœæ­¢çš„ Service å°è£…ä¸ºäº† IntentService</p>]]></content>
      
      
      <categories>
          
          <category> Android Dev. </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Android </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>09-MultiMedia</title>
      <link href="/Coming-blog/2022/08/22/09-multimedia/"/>
      <url>/Coming-blog/2022/08/22/09-multimedia/</url>
      
        <content type="html"><![CDATA[<h1 id="notification"><a class="markdownIt-Anchor" href="#notification"></a> Notification</h1><p>Application: åº”ç”¨ç¨‹åºä¸åœ¨å‰å°è¿è¡Œä¸”å¸Œæœ›å‘ç”¨æˆ·å‘å‡ºæç¤ºä¿¡æ¯æ—¶</p><p>é€šçŸ¥æ¸ é“: å¯¹é€šçŸ¥ä¿¡æ¯çš„ç»†åˆ†, å¯ä»¥æŒ‰ç…§é€šçŸ¥æ¸ é“æ§åˆ¶ä¸€ç±»é€šçŸ¥çš„é‡è¦ç¨‹åº¦(æ˜¯å¦å“é“ƒã€æ˜¯å¦æŒ¯åŠ¨æˆ–è€…æ˜¯å¦è¦å…³é—­è¿™ä¸ªæ¸ é“çš„é€šçŸ¥)</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/202208221141721.png" alt="" /></p><h2 id="quick-start"><a class="markdownIt-Anchor" href="#quick-start"></a> Quick Start</h2><ol><li>è·å–é€šçŸ¥ç®¡ç†å¯¹è±¡: <code>NotificationManager</code></li></ol><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">val</span> manager <span class="token operator">=</span> <span class="token function">getSystemService</span><span class="token punctuation">(</span>Context<span class="token punctuation">.</span>NOTIFICATION_SERVICE<span class="token punctuation">)</span> <span class="token keyword">as</span> NotificationManager<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ol start="2"><li>åˆ›å»ºé€šçŸ¥æ¸ é“: <code>NotificationChannel</code></li></ol><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">if</span> <span class="token punctuation">(</span>Build<span class="token punctuation">.</span>VERSION<span class="token punctuation">.</span>SDK_INT <span class="token operator">>=</span> Build<span class="token punctuation">.</span>VERSION_CODES<span class="token punctuation">.</span>O<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// channelId can be defined arbitrarily</span>    <span class="token comment">// channelName is for display</span>    <span class="token comment">// importance: NotificationManager.IMPORTANCE_HIGH, IMPORTANCE_DEFAULT, IMPORTANCE_LOW, IMPORTANCE_MIN, different notification importance means different notify action and user can change it at will</span>    <span class="token keyword">val</span> channel <span class="token operator">=</span> <span class="token function">NotificationChannel</span><span class="token punctuation">(</span>channelId<span class="token operator">:</span> String<span class="token punctuation">,</span> channelName<span class="token operator">:</span> String<span class="token punctuation">,</span> importance<span class="token punctuation">)</span>    manager<span class="token punctuation">.</span><span class="token function">createNotificationChannel</span><span class="token punctuation">(</span>channel<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="3"><li>è®¾å®šé€šçŸ¥è§¦å‘çš„æ„å›¾: è¿™é‡Œä»¥è§¦å‘ä¸€ä¸ª Activity ä¸ºä¾‹</li></ol><blockquote><p>PendingIntent can be understood as an intent to delay executionParams list is: context, 0, intent object, action (set 0 in basic use)</p></blockquote><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">val</span> intent <span class="token operator">=</span> <span class="token function">Intent</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> NotificationActivity<span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">.</span>java<span class="token punctuation">)</span><span class="token keyword">val</span> pendingIntent <span class="token operator">=</span> PendingIntent<span class="token punctuation">.</span><span class="token function">getActivity</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> intent<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ol start="4"><li>åˆ›å»ºé€šçŸ¥å¯¹è±¡: <code>NotificationCompat.Builder(context, channelId: String)</code></li></ol><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">val</span> notification <span class="token operator">=</span> NotificationCompat<span class="token punctuation">.</span><span class="token function">Builder</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token string">"normal"</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">setContentTitle</span><span class="token punctuation">(</span><span class="token string">"This is content title"</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">setContentText</span><span class="token punctuation">(</span><span class="token string">"This is content text"</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">setSmallIcon</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>drawable<span class="token punctuation">.</span>small_icon<span class="token punctuation">)</span> <span class="token comment">// åªèƒ½ä½¿ç”¨çº¯ alpha å›¾å±‚çš„å›¾ç‰‡è¿›è¡Œè®¾ç½®, åœ¨ç³»ç»ŸçŠ¶æ€æ æ˜¾ç¤º</span>                <span class="token punctuation">.</span><span class="token function">setLargeIcon</span><span class="token punctuation">(</span>BitmapFactory<span class="token punctuation">.</span><span class="token function">decodeResource</span><span class="token punctuation">(</span>resources<span class="token punctuation">,</span> R<span class="token punctuation">.</span>drawable<span class="token punctuation">.</span>large_icon<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// ä¸‹æ‹‰çŠ¶æ€æ åæ˜¾ç¤º</span>                <span class="token punctuation">.</span><span class="token function">setContentIntent</span><span class="token punctuation">(</span>pendingIntent<span class="token punctuation">)</span> <span class="token comment">// PendingIntent</span>                <span class="token punctuation">.</span><span class="token function">setAutoCancel</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token comment">// è¡¨ç¤ºå½“ç‚¹å‡»è¿™ä¸ªé€šçŸ¥çš„æ—¶å€™ï¼Œé€šçŸ¥ä¼šè‡ªåŠ¨å–æ¶ˆ</span>                <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="5"><li>è§¦å‘é€šçŸ¥: <code>manager.notify(id: Int, notification)</code></li></ol><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token comment">// éœ€è¦ä¿è¯æ¯ä¸ªé€šçŸ¥æŒ‡å®šçš„ id æ˜¯ä¸åŒçš„</span>manager<span class="token punctuation">.</span><span class="token function">notify</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> notification<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="é•¿æ–‡å­—é€šçŸ¥"><a class="markdownIt-Anchor" href="#é•¿æ–‡å­—é€šçŸ¥"></a> é•¿æ–‡å­—é€šçŸ¥</h2><p>é»˜è®¤æƒ…å†µä¸‹, é€šçŸ¥å†…å®¹å¤šä½™ä¸€è¡Œå°†ä¼šè¢« <code>...</code> æˆªæ–­, å¯ä»¥é€šè¿‡ setStyle ä¸­çš„ NotificationCompat.BigTextStyle() è¿›è¡Œå¯Œæ–‡æœ¬åŒ–</p><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token punctuation">.</span><span class="token function">setStyle</span><span class="token punctuation">(</span>NotificationCompat<span class="token punctuation">.</span><span class="token function">BigTextStyle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">bigText</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// replace the .setContentText</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="å›¾ç‰‡é€šçŸ¥"><a class="markdownIt-Anchor" href="#å›¾ç‰‡é€šçŸ¥"></a> å›¾ç‰‡é€šçŸ¥</h2><p>é€šè¿‡ setStyle ä¸­çš„ NotificationCompat.BigPictureStyle() è¿›è¡Œå±•ç¤º</p><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token punctuation">.</span><span class="token function">setStyle</span><span class="token punctuation">(</span>NotificationCompat<span class="token punctuation">.</span><span class="token function">BigPictureStyle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">bigPicture</span><span class="token punctuation">(</span>BitmapFactory<span class="token punctuation">.</span><span class="token function">decodeResource</span><span class="token punctuation">(</span>resources<span class="token punctuation">,</span> R<span class="token punctuation">.</span>drawable<span class="token punctuation">.</span>big_image<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h1 id="take-photo"><a class="markdownIt-Anchor" href="#take-photo"></a> Take Photo</h1><p>è°ƒç”¨æ‘„åƒå¤´åª’ä½“è¿›è¡Œæ‹ç…§å¹¶å±•ç¤ºç…§ç‰‡:</p><ul><li>å®šä¹‰ä¸€ä¸ª File å¯¹è±¡ç”¨äºå­˜å‚¨æ‹ä¸‹çš„ç…§ç‰‡, é¿å…æ¶‰åŠè¿è¡Œæ—¶æƒé™, é€‰æ‹©å­˜å‚¨åœ¨ SD å¡çš„åº”ç”¨å…³è”ç¼“å­˜ç›®å½•ä¸‹ <code>getExternalCacheDir()</code></li><li>æ„å»ºç›®æ ‡ç…§ç‰‡çš„ Uri: é€šè¿‡ <code>getUriForFile()</code> è¿›è¡Œè·å–</li></ul><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin">buttonTakePhoto<span class="token punctuation">.</span><span class="token function">setOnClickListener</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// File å¯¹è±¡, å­˜æ”¾æ‘„åƒå¤´æ‹ä¸‹çš„ç…§ç‰‡</span>    <span class="token comment">// å­˜æ”¾åœ¨æ‰‹æœº SD å¡çš„åº”ç”¨å…³è”ç¼“å­˜ç›®å½•ä¸‹ `/sdcard/Android/data/&lt;package name>/cache`</span>    outputImage <span class="token operator">=</span> <span class="token function">File</span><span class="token punctuation">(</span>externalCacheDir<span class="token punctuation">,</span> <span class="token string">"output_image.jpg"</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>outputImage<span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        outputImage<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>    outputImage<span class="token punctuation">.</span><span class="token function">createNewFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    imageUri <span class="token operator">=</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>Build<span class="token punctuation">.</span>VERSION<span class="token punctuation">.</span>SDK_INT <span class="token operator">>=</span> Build<span class="token punctuation">.</span>VERSION_CODES<span class="token punctuation">.</span>N<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">// å°† File å¯¹è±¡è½¬æ¢æˆä¸€ä¸ªå°è£…è¿‡çš„ Uri å¯¹è±¡: context, ä»»æ„å”¯ä¸€å­—ç¬¦ä¸², file</span>        <span class="token comment">// FileProvider æ˜¯ä¸€ç§ç‰¹æ®Šçš„ ContentProviderï¼Œå®ƒä½¿ç”¨äº†å’Œ ContentProvider ç±»ä¼¼çš„æœºåˆ¶æ¥å¯¹æ•°æ®è¿›è¡Œä¿æŠ¤ï¼Œå¯ä»¥é€‰æ‹©æ€§åœ°å°†å°è£…è¿‡çš„ Uri å…±äº«ç»™å¤–éƒ¨ï¼Œä»è€Œæé«˜äº†åº”ç”¨çš„å®‰å…¨æ€§</span>        FileProvider<span class="token punctuation">.</span><span class="token function">getUriForFile</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token string">"com.example.a16cameraalbumtest.fileprovider"</span><span class="token punctuation">,</span> outputImage<span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>        Uri<span class="token punctuation">.</span><span class="token function">fromFile</span><span class="token punctuation">(</span>outputImage<span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">// å¯åŠ¨ç›¸æœºç¨‹åº</span>    <span class="token keyword">val</span> intent <span class="token operator">=</span> <span class="token function">Intent</span><span class="token punctuation">(</span><span class="token string">"android.media.action.IMAGE_CAPTURE"</span><span class="token punctuation">)</span>    <span class="token comment">// å›¾ç‰‡è¾“å‡ºåœ°å€</span>    intent<span class="token punctuation">.</span><span class="token function">putExtra</span><span class="token punctuation">(</span>MediaStore<span class="token punctuation">.</span>EXTRA_OUTPUT<span class="token punctuation">,</span> imageUri<span class="token punctuation">)</span>    <span class="token comment">// è·å–ç›¸æœºæ‹æ‘„åçš„æµæ–‡ä»¶</span>    ImageCaptureActivityForResult<span class="token punctuation">.</span><span class="token function">launch</span><span class="token punctuation">(</span>intent<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ‹ç…§å®Œæˆåç›¸æœº Activity å°†æ•°æ®æµè¿”å›, é€šè¿‡ contentResolver ä¸ Uri è¿›è¡Œè·å–</p><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">private</span> <span class="token keyword">val</span> ImageCaptureActivityForResult <span class="token operator">=</span> <span class="token function">registerForActivityResult</span><span class="token punctuation">(</span>ActivityResultContracts<span class="token punctuation">.</span><span class="token function">StartActivityForResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    result <span class="token operator">-></span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">.</span>resultCode <span class="token operator">==</span> Activity<span class="token punctuation">.</span>RESULT_OK<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">val</span> bitmap <span class="token operator">=</span> BitmapFactory<span class="token punctuation">.</span><span class="token function">decodeStream</span><span class="token punctuation">(</span>contentResolver<span class="token punctuation">.</span><span class="token function">openInputStream</span><span class="token punctuation">(</span>imageUri<span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token comment">// æ‹ç…§æ—¶å¯èƒ½æ—‹è½¬äº†æ‰‹æœº</span>        imageView<span class="token punctuation">.</span><span class="token function">setImageBitmap</span><span class="token punctuation">(</span><span class="token function">rotateIfRequired</span><span class="token punctuation">(</span>bitmap<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">private</span> <span class="token keyword">fun</span> <span class="token function">rotateIfRequired</span><span class="token punctuation">(</span>bitmap<span class="token operator">:</span> Bitmap<span class="token punctuation">)</span><span class="token operator">:</span> Bitmap <span class="token punctuation">&#123;</span>    <span class="token keyword">val</span> exif <span class="token operator">=</span> <span class="token function">ExifInterface</span><span class="token punctuation">(</span>outputImage<span class="token punctuation">.</span>path<span class="token punctuation">)</span>    <span class="token keyword">val</span> orientation <span class="token operator">=</span> exif<span class="token punctuation">.</span><span class="token function">getAttributeInt</span><span class="token punctuation">(</span>ExifInterface<span class="token punctuation">.</span>TAG_ORIENTATION<span class="token punctuation">,</span> ExifInterface<span class="token punctuation">.</span>ORIENTATION_NORMAL<span class="token punctuation">)</span>    <span class="token keyword">return</span> <span class="token keyword">when</span> <span class="token punctuation">(</span>orientation<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        ExifInterface<span class="token punctuation">.</span>ORIENTATION_ROTATE_90 <span class="token operator">-></span> <span class="token function">rotateBitmap</span><span class="token punctuation">(</span>bitmap<span class="token punctuation">,</span> <span class="token number">90</span><span class="token punctuation">)</span>        ExifInterface<span class="token punctuation">.</span>ORIENTATION_ROTATE_180 <span class="token operator">-></span> <span class="token function">rotateBitmap</span><span class="token punctuation">(</span>bitmap<span class="token punctuation">,</span> <span class="token number">180</span><span class="token punctuation">)</span>        ExifInterface<span class="token punctuation">.</span>ORIENTATION_ROTATE_270 <span class="token operator">-></span> <span class="token function">rotateBitmap</span><span class="token punctuation">(</span>bitmap<span class="token punctuation">,</span> <span class="token number">270</span><span class="token punctuation">)</span>        <span class="token keyword">else</span> <span class="token operator">-></span> bitmap    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">private</span> <span class="token keyword">fun</span> <span class="token function">rotateBitmap</span><span class="token punctuation">(</span>bitmap<span class="token operator">:</span> Bitmap<span class="token punctuation">,</span> degree<span class="token operator">:</span> Int<span class="token punctuation">)</span><span class="token operator">:</span> Bitmap <span class="token punctuation">&#123;</span>    <span class="token keyword">val</span> matrix <span class="token operator">=</span> <span class="token function">Matrix</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    matrix<span class="token punctuation">.</span><span class="token function">postRotate</span><span class="token punctuation">(</span>degree<span class="token punctuation">.</span><span class="token function">toFloat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">val</span> rotatedBitmap <span class="token operator">=</span> Bitmap<span class="token punctuation">.</span><span class="token function">createBitmap</span><span class="token punctuation">(</span>bitmap<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> bitmap<span class="token punctuation">.</span>width<span class="token punctuation">,</span> bitmap<span class="token punctuation">.</span>height<span class="token punctuation">,</span> matrix<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span>    bitmap<span class="token punctuation">.</span><span class="token function">recycle</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> rotatedBitmap<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å£°æ˜æ³¨å†Œ provider: meta-data ä¸­ç”¨äºæŒ‡å®š uri çš„å…±äº«è·¯å¾„é€šè¿‡ xml èµ„æºè¿›è¡Œèµ‹å€¼</p><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>provider</span>    <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>androidx.core.content.FileProvider<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">android:</span>authorities</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.example.a16cameraalbumtest.fileprovider<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">android:</span>exported</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>false<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">android:</span>grantUriPermissions</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta-data</span>        <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>android.support.FILE_PROVIDER_PATHS<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>resource</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@xml/file_paths<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>provider</span><span class="token punctuation">></span></span><span class="token comment">&lt;!-- external-path ç”¨äºæŒ‡å®š Uri çš„å…±äº«è·¯å¾„, name å±æ€§çš„å€¼å¯ä»¥éšä¾¿å¡«å†™, path å±æ€§è¡¨ç¤ºå…±äº«çš„å…·ä½“è·¯å¾„ --></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>paths</span> <span class="token attr-name"><span class="token namespace">xmlns:</span>android</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://schemas.android.com/apk/res/android<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>external-path</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>my_images<span class="token punctuation">"</span></span> <span class="token attr-name">path</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>paths</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="select-photos"><a class="markdownIt-Anchor" href="#select-photos"></a> Select Photos</h1><p>ä»ç›¸å†Œä¸­é€‰æ‹©ç…§ç‰‡, æ‰“å¼€ç³»ç»Ÿçš„æ–‡ä»¶é€‰æ‹©å™¨ <code>Intent.ACTION_OPEN_DOCUMENT</code> æŒ‡å®šæ–‡ä»¶ç±»åˆ«ä¸º <code>Intent.CATEGORY_OPENABLE</code></p><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin">buttonSelectPhoto<span class="token punctuation">.</span><span class="token function">setOnClickListener</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">val</span> intent <span class="token operator">=</span> <span class="token function">Intent</span><span class="token punctuation">(</span>Intent<span class="token punctuation">.</span>ACTION_OPEN_DOCUMENT<span class="token punctuation">)</span>    intent<span class="token punctuation">.</span><span class="token function">addCategory</span><span class="token punctuation">(</span>Intent<span class="token punctuation">.</span>CATEGORY_OPENABLE<span class="token punctuation">)</span>    <span class="token comment">// æŒ‡å®šè¦æ˜¾ç¤ºçš„å›¾ç‰‡</span>    intent<span class="token punctuation">.</span>type <span class="token operator">=</span> <span class="token string">"image/*"</span>    SelectPhotoForResult<span class="token punctuation">.</span><span class="token function">launch</span><span class="token punctuation">(</span>intent<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>é€‰å®šç…§ç‰‡åé€šè¿‡è¿”å›çš„ Uri è·å–èµ„æºå¯¹è±¡</p><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">private</span> <span class="token keyword">val</span> SelectPhotoForResult <span class="token operator">=</span> <span class="token function">registerForActivityResult</span><span class="token punctuation">(</span>ActivityResultContracts<span class="token punctuation">.</span><span class="token function">StartActivityForResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> result <span class="token operator">-></span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">.</span>resultCode <span class="token operator">==</span> Activity<span class="token punctuation">.</span>RESULT_OK <span class="token operator">&amp;&amp;</span> result<span class="token punctuation">.</span>data <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        result<span class="token punctuation">.</span>data<span class="token operator">?</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span><span class="token function">let</span> <span class="token punctuation">&#123;</span> uri <span class="token operator">-></span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>uri <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">val</span> bitmap <span class="token operator">=</span> <span class="token function">getBitmapFromUri</span><span class="token punctuation">(</span>uri<span class="token punctuation">)</span>                imageView<span class="token punctuation">.</span><span class="token function">setImageBitmap</span><span class="token punctuation">(</span>bitmap<span class="token punctuation">)</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">private</span> <span class="token keyword">fun</span> <span class="token function">getBitmapFromUri</span><span class="token punctuation">(</span>uri<span class="token operator">:</span> Uri<span class="token punctuation">)</span> <span class="token operator">=</span> contentResolver<span class="token punctuation">.</span><span class="token function">openFileDescriptor</span><span class="token punctuation">(</span>uri<span class="token punctuation">,</span> <span class="token string">"r"</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">use</span> <span class="token punctuation">&#123;</span>    BitmapFactory<span class="token punctuation">.</span><span class="token function">decodeFileDescriptor</span><span class="token punctuation">(</span>it<span class="token punctuation">.</span>fileDescriptor<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="play-audio"><a class="markdownIt-Anchor" href="#play-audio"></a> Play Audio</h1><p>ä¸»è¦é€šè¿‡ MediaPlayer ç±»å®ç°çš„:</p><ul><li>setDataSource(): è®¾ç½®è¦æ’­æ”¾çš„éŸ³é¢‘æ–‡ä»¶çš„ä½ç½®</li><li>prepare(): å¼€å§‹æ’­æ”¾ä¹‹å‰è°ƒç”¨, å®Œæˆå‡†å¤‡å·¥ä½œ</li><li>start(): å¼€å§‹/ç»§ç»­æ’­æ”¾</li><li>pause()</li><li>reset(): å°† MediaPlayer é‡ç½®ä¸ºåˆšåˆšåˆ›å»ºçš„çŠ¶æ€</li><li>seekTo(): ä»æŒ‡å®šä½ç½®å¼€å§‹æ’­æ”¾éŸ³é¢‘</li><li>stop()</li><li>release()</li><li>isPlaying()</li><li>getDuration(): è·å–è½½å…¥çš„éŸ³é¢‘æ–‡ä»¶çš„æ—¶é•¿</li></ul><ol><li>è·å– MediaPlayer å¯¹è±¡ å¹¶è¿›è¡Œåˆå§‹åŒ–</li></ol><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">private</span> <span class="token keyword">val</span> mediaPalyer <span class="token operator">=</span> <span class="token function">MediaPlayer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">private</span> <span class="token keyword">fun</span> <span class="token function">initMediaPlayer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">val</span> assetManager <span class="token operator">=</span> assets <span class="token comment">// getAssets()</span>    <span class="token comment">// æ‰“å¼€ç›®æ ‡æ–‡ä»¶çš„å¥æŸ„</span>    <span class="token keyword">val</span> fd <span class="token operator">=</span> assetManager<span class="token punctuation">.</span><span class="token function">openFd</span><span class="token punctuation">(</span><span class="token string">"music.mp3"</span><span class="token punctuation">)</span>    <span class="token comment">// file descriptor</span>    <span class="token comment">// the offset into the file where the data to be played starts, in bytes</span>    <span class="token comment">// the length in bytes of the data to be played</span>    mediaPalyer<span class="token punctuation">.</span><span class="token function">setDataSource</span><span class="token punctuation">(</span>fd<span class="token punctuation">.</span>fileDescriptor<span class="token punctuation">,</span> fd<span class="token punctuation">.</span>startOffset<span class="token punctuation">,</span> fd<span class="token punctuation">.</span>length<span class="token punctuation">)</span>    mediaPalyer<span class="token punctuation">.</span><span class="token function">prepare</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="2"><li>æŒ‰é’®é€»è¾‘æ“ä½œ</li></ol><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">when</span><span class="token punctuation">(</span>v<span class="token operator">?</span><span class="token punctuation">.</span>id<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>play <span class="token operator">-></span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>mediaPalyer<span class="token punctuation">.</span>isPlaying<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            mediaPalyer<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>pause <span class="token operator">-></span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>mediaPalyer<span class="token punctuation">.</span>isPlaying<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            mediaPalyer<span class="token punctuation">.</span><span class="token function">pause</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>stop <span class="token operator">-></span> <span class="token punctuation">&#123;</span>        mediaPalyer<span class="token punctuation">.</span><span class="token function">reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token function">initMediaPlayer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="3"><li>Activity è¢«é”€æ¯æ—¶è®°å¾—é‡Šæ”¾ MediaPlayer</li></ol><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">onDestroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onDestroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    mediaPalyer<span class="token punctuation">.</span><span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    mediaPalyer<span class="token punctuation">.</span><span class="token function">release</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="play-video"><a class="markdownIt-Anchor" href="#play-video"></a> Play Video</h1><p>ä¸»è¦é€šè¿‡ VideoView ç±»å®ç°çš„, é€šè¿‡å‘½åå¯ä»¥çœ‹å‡º, è¿™ä¸ªç±»å°† Video çš„æ˜¾ç¤ºä¸æ§åˆ¶é›†ä¸€èº«:</p><ul><li>setVideoPath(): è®¾ç½®è¦æ’­æ”¾çš„è§†é¢‘æ–‡ä»¶</li><li>resume(): å°†è§†é¢‘ä»å¤´å¼€å§‹æ’­æ”¾</li><li>suspend(): é‡Šæ”¾ VideoView</li><li>start, pause, seekTo, isPlaying, getDuration</li></ul><p>Tips: VideoView ä¸æ”¯æŒç›´æ¥æ’­æ”¾ assets ç›®å½•ä¸‹çš„è§†é¢‘èµ„æº, ä½†æ˜¯æ”¯æŒæ’­æ”¾ <code>res/raw/*</code> ç›®å½•ä¸‹çš„è§†é¢‘èµ„æº</p><ol><li>è®¾ç½®åª’ä½“å¯¹è±¡</li></ol><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin">videoView <span class="token operator">=</span> <span class="token function">findViewById</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>videoView<span class="token punctuation">)</span><span class="token keyword">val</span> uri <span class="token operator">=</span> Uri<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token string">"android.resource://<span class="token interpolation variable">$packageName</span>/<span class="token interpolation"><span class="token delimiter variable">$&#123;</span>R<span class="token punctuation">.</span>raw<span class="token punctuation">.</span>video<span class="token delimiter variable">&#125;</span></span>"</span><span class="token punctuation">)</span>videoView<span class="token punctuation">.</span><span class="token function">setVideoURI</span><span class="token punctuation">(</span>uri<span class="token punctuation">)</span>videoView<span class="token punctuation">.</span><span class="token function">setMediaController</span><span class="token punctuation">(</span><span class="token function">MediaController</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="2"><li>é€»è¾‘æ§åˆ¶</li></ol><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">when</span><span class="token punctuation">(</span>v<span class="token operator">?</span><span class="token punctuation">.</span>id<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>play <span class="token operator">-></span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>videoView<span class="token punctuation">.</span>isPlaying<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            videoView<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>pause <span class="token operator">-></span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>videoView<span class="token punctuation">.</span>isPlaying<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            videoView<span class="token punctuation">.</span><span class="token function">pause</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>replay <span class="token operator">-></span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>videoView<span class="token punctuation">.</span>isPlaying<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            videoView<span class="token punctuation">.</span><span class="token function">resume</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="3"><li>äº‹åé‡Šæ”¾</li></ol><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">onDestroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onDestroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    videoView<span class="token punctuation">.</span><span class="token function">suspend</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> Android Dev. </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Android </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>08-Content Provider</title>
      <link href="/Coming-blog/2022/08/22/08-content-provider/"/>
      <url>/Coming-blog/2022/08/22/08-content-provider/</url>
      
        <content type="html"><![CDATA[<h1 id="contentprovider"><a class="markdownIt-Anchor" href="#contentprovider"></a> ContentProvider</h1><p>å®ç°è·¨ç¨‹åºæ•°æ®å…±äº«, å®ƒæä¾›äº†ä¸€å¥—å®Œæ•´çš„æœºåˆ¶ï¼Œå…è®¸ä¸€ä¸ªç¨‹åºè®¿é—®å¦ä¸€ä¸ªç¨‹åºä¸­çš„æ•°æ®ï¼ŒåŒæ—¶è¿˜èƒ½ä¿è¯è¢«è®¿é—®æ•°æ®çš„å®‰å…¨æ€§</p><p>ContentProvider å¯ä»¥é€‰æ‹©åªå¯¹å“ªä¸€éƒ¨åˆ†æ•°æ®è¿›è¡Œå…±äº«</p><h1 id="è¿è¡Œæ—¶æƒé™"><a class="markdownIt-Anchor" href="#è¿è¡Œæ—¶æƒé™"></a> è¿è¡Œæ—¶æƒé™</h1><p>é˜²æ­¢å®‰è£…åº”ç”¨æ—¶ä¸€æ¬¡æ€§æˆæƒå…¨éƒ¨æ‰€éœ€æƒé™å¯¼è‡´çš„é£é™©, ç”¨æˆ·å¯ä»¥åœ¨è½¯ä»¶çš„ä½¿ç”¨è¿‡ç¨‹ä¸­å¯¹æŸä¸€é¡¹æƒé™ç”³è¯·è¿›è¡Œæˆæƒ</p><p>æ™®é€šæƒé™: ä¸ä¼šç›´æ¥å¨èƒåˆ°ç”¨æˆ·çš„å®‰å…¨å’Œéšç§çš„æƒé™, å¯¹äºè¿™éƒ¨åˆ†æƒé™ç”³è¯·ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨å¸®æˆ‘ä»¬è¿›è¡Œæˆæƒï¼Œä¸éœ€è¦ç”¨æˆ·æ‰‹åŠ¨æ“ä½œå±é™©æƒé™: è¡¨ç¤ºé‚£äº›å¯èƒ½ä¼šè§¦åŠç”¨æˆ·éšç§æˆ–è€…å¯¹è®¾å¤‡å®‰å…¨æ€§é€ æˆå½±å“çš„æƒé™ï¼Œå¦‚è·å–è®¾å¤‡è”ç³»äººä¿¡æ¯ã€å®šä½è®¾å¤‡çš„åœ°ç†ä½ç½®ç­‰ï¼Œå¯¹äºè¿™éƒ¨åˆ†æƒé™ç”³è¯·ï¼Œå¿…é¡»ç”±ç”¨æˆ·æ‰‹åŠ¨æˆæƒæ‰å¯ä»¥ï¼Œå¦åˆ™ç¨‹åºå°±æ— æ³•ä½¿ç”¨ç›¸åº”çš„åŠŸèƒ½</p><p>å±é™©æƒé™å…± 11 ç»„ 30 ä¸ªæƒé™:</p><ul><li>CALENDAR, æ—¥å†: READ_CALENDAR, WRITE_CALENDAR</li><li>CALL_LOG, : READ_CALL_LOG, WRITE_CALL_LOG, PROCESS_OUTGOING_CALLS</li><li>CAMERA, ç›¸æœº: CAMERA</li><li>CONTACTS, è”ç³»äºº: READ_CONTACTS, WRITE_CONTACTS, GET_ACCOUNTS</li><li>LOCATION, ä½ç½®: ACCESS_FINE_LOCATION, ACCESS_COARSE_LOCATION</li><li>MICROPHONE, éº¦å…‹é£: RECORD_AUDIO</li><li>PHONE, æ‰‹æœº: READ_PHONE_STATE, CALL_PHONE, READ_CALL_LOG, WRITE_CALL_LOG, ADD_VOICEMAIL, USE_SIP, PROCESS_OUTGOING_CALLS</li><li>SENSORS, ä¼ æ„Ÿå™¨: BODY_SENSORS</li><li>ACTIVITY_RECOGNITION, : ACTIVITY_RECOGNITION</li><li>SMS, çŸ­ä¿¡: SEND_SMS, RECEIVE_SMS, READ_SMI, RECEIVE_WAP_PUSH, RECEIVE_MMS</li><li>STORAGE, å­˜å‚¨å¡: READ_EXTERNAL_STORAGE, WRITE_EXTERNAL_STORAGE, ACCESS_MEDIA_LOCATION</li></ul><h2 id="è¿è¡Œæ—¶ç”³è¯·"><a class="markdownIt-Anchor" href="#è¿è¡Œæ—¶ç”³è¯·"></a> è¿è¡Œæ—¶ç”³è¯·</h2><ol><li>åœ¨ AndroidManifest ä¸­å£°æ˜æƒ³è¦è·å–çš„æƒé™</li></ol><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token comment">&lt;!--    ä»…ä»…æ˜¯å£°æ˜, è¿˜éœ€è¦è¿è¡Œæ—¶ç”³è¯· --></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>uses-permission</span> <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>android.permission.CALL_PHONE<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ol start="2"><li>åœ¨è¡Œä¸ºæ‰§è¡Œå‰è¿›è¡Œæƒé™æ£€æŸ¥ <code>ContextCompat.checkSelfPermission</code>, å¦‚æœæ²¡æœ‰ç›¸å…³æƒé™åˆ™åŠ¨æ€ç”³è¯· <code>ActivityCompat.requestPermissions</code></li></ol><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin">R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>button_make_call <span class="token operator">-></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>ContextCompat<span class="token punctuation">.</span><span class="token function">checkSelfPermission</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> Manifest<span class="token punctuation">.</span>permission<span class="token punctuation">.</span>CALL_PHONE<span class="token punctuation">)</span> <span class="token operator">!=</span> PackageManager<span class="token punctuation">.</span>PERMISSION_GRANTED<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        ActivityCompat<span class="token punctuation">.</span><span class="token function">requestPermissions</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token function">arrayOf</span><span class="token punctuation">(</span>Manifest<span class="token punctuation">.</span>permission<span class="token punctuation">.</span>CALL_PHONE<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>        <span class="token function">call</span><span class="token punctuation">(</span><span class="token string">"10086"</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="3"><li>åŠ¨æ€è·å¾—æƒé™åæ‰§è¡Œç›¸å…³è¡Œä¸º</li></ol><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">onRequestPermissionsResult</span><span class="token punctuation">(</span>    requestCode<span class="token operator">:</span> Int<span class="token punctuation">,</span>    permissions<span class="token operator">:</span> Array<span class="token operator">&lt;</span><span class="token keyword">out</span> String<span class="token operator">></span><span class="token punctuation">,</span>    grantResults<span class="token operator">:</span> IntArray<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onRequestPermissionsResult</span><span class="token punctuation">(</span>requestCode<span class="token punctuation">,</span> permissions<span class="token punctuation">,</span> grantResults<span class="token punctuation">)</span>    <span class="token keyword">when</span><span class="token punctuation">(</span>requestCode<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token number">1</span> <span class="token operator">-></span> <span class="token punctuation">&#123;</span>            <span class="token keyword">if</span><span class="token punctuation">(</span>grantResults<span class="token punctuation">.</span><span class="token function">isNotEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> grantResults<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> PackageManager<span class="token punctuation">.</span>PERMISSION_GRANTED<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token function">call</span><span class="token punctuation">(</span><span class="token string">"10086"</span><span class="token punctuation">)</span>            <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>                Toast<span class="token punctuation">.</span><span class="token function">makeText</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token string">"Permission Denied"</span><span class="token punctuation">,</span> Toast<span class="token punctuation">.</span>LENGTH_SHORT<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">private</span> <span class="token keyword">fun</span> <span class="token function">call</span><span class="token punctuation">(</span>number<span class="token operator">:</span> String<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>        <span class="token comment">// Intent.ACTION_DIAL åªæ˜¯æ‰“å¼€æ‹¨å·ç•Œé¢, ä¸éœ€è¦å£°æ˜æƒé™</span>        <span class="token comment">// Intent.ACTION_CALL åˆ™æ˜¯æ‹¨æ‰“ç”µè¯</span>        <span class="token keyword">val</span> intnet <span class="token operator">=</span> <span class="token function">Intent</span><span class="token punctuation">(</span>Intent<span class="token punctuation">.</span>ACTION_CALL<span class="token punctuation">)</span>        intent<span class="token punctuation">.</span>data <span class="token operator">=</span> Uri<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token string">"tel:<span class="token interpolation variable">$number</span>"</span><span class="token punctuation">)</span>        <span class="token function">startActivity</span><span class="token punctuation">(</span>intent<span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token operator">:</span> SecurityException<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="native-contentprovider"><a class="markdownIt-Anchor" href="#native-contentprovider"></a> Native ContentProvider</h1><p>å¦‚æœæƒ³è¦è®¿é—® ContentProvider ä¸­çš„æ•°æ®éœ€è¦å€ŸåŠ© ContentResolver ç±»å®ç°å¯¹æ•°æ®çš„å¢åˆ æ”¹æŸ¥æ“ä½œ(insert, update, delete, query)</p><p>é€šè¿‡å†…å®¹ URI ä¸º ContentProvider ä¸­çš„æ•°æ®å»ºç«‹å”¯ä¸€æ ‡è¯†ç¬¦, ç”± authority å’Œ path ç»„æˆ, æœ€ç»ˆåŠ ä¸Šå†…å®¹ URI çš„åè®®å‰ç¼€å <code>content://</code> å³å¯; ä¾‹å¦‚ <code>content://com.example.app.provider/table1</code> å°±å¯ä»¥å¾ˆæ˜ç¡®çš„è¡¨è¾¾æƒ³è¦è®¿é—®å“ªä¸ªç¨‹åºä¸­å“ªå¼ è¡¨é‡Œçš„æ•°æ®</p><ul><li>authority: ç”¨äºå¯¹ä¸åŒçš„åº”ç”¨ç¨‹åºåšåŒºåˆ†, é‡‡ç”¨ <code>åŒ…å.provider</code> é˜²æ­¢å†²çª</li><li>path: ç”¨äºå¯¹åŒä¸€åº”ç”¨ç¨‹åºä¸­ä¸åŒçš„è¡¨åšåŒºåˆ† é‡‡ç”¨ <code>authority/tablename</code> çš„å½¢å¼å‘½å</li></ul><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">private</span> <span class="token keyword">fun</span> <span class="token function">readContacts</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// Uri å°è£…å¥½äº†</span>    contentResolver<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>ContactsContract<span class="token punctuation">.</span>CommonDataKinds<span class="token punctuation">.</span>Phone<span class="token punctuation">.</span>CONTENT_URI<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">apply</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token function">moveToNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">val</span> name <span class="token operator">=</span> <span class="token function">getString</span><span class="token punctuation">(</span><span class="token function">getColumnIndexOrThrow</span><span class="token punctuation">(</span>ContactsContract<span class="token punctuation">.</span>CommonDataKinds<span class="token punctuation">.</span>Phone<span class="token punctuation">.</span>DISPLAY_NAME<span class="token punctuation">)</span><span class="token punctuation">)</span>            <span class="token keyword">val</span> number <span class="token operator">=</span> <span class="token function">getString</span><span class="token punctuation">(</span><span class="token function">getColumnIndexOrThrow</span><span class="token punctuation">(</span>ContactsContract<span class="token punctuation">.</span>CommonDataKinds<span class="token punctuation">.</span>Phone<span class="token punctuation">.</span>NUMBER<span class="token punctuation">)</span><span class="token punctuation">)</span>            phoneList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token function">Phone</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> number<span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token punctuation">&#125;</span>        adapter<span class="token punctuation">.</span><span class="token function">notifyDataSetChanged</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="insert"><a class="markdownIt-Anchor" href="#insert"></a> insert</h2><p>ä¸ SQLite ç±»ä¼¼</p><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">val</span> values <span class="token operator">=</span> <span class="token function">contentValuesOf</span><span class="token punctuation">(</span><span class="token string">"column1"</span> <span class="token keyword">to</span> <span class="token string">"text"</span><span class="token punctuation">,</span> <span class="token string">"column2"</span> <span class="token keyword">to</span> <span class="token number">1</span><span class="token punctuation">)</span>contentResolver<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>uri<span class="token punctuation">,</span> values<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="update"><a class="markdownIt-Anchor" href="#update"></a> update</h2><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">val</span> values <span class="token operator">=</span> <span class="token function">contentValuesOf</span><span class="token punctuation">(</span><span class="token string">"column1"</span> <span class="token keyword">to</span> <span class="token string">""</span><span class="token punctuation">)</span>contentResolver<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>uri<span class="token punctuation">,</span> values<span class="token punctuation">,</span> <span class="token string">"column1 = ? and column2 = ?"</span><span class="token punctuation">,</span> <span class="token function">arrayOf</span><span class="token punctuation">(</span><span class="token string">"text"</span><span class="token punctuation">,</span> <span class="token string">"1"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="query"><a class="markdownIt-Anchor" href="#query"></a> query</h2><p>ç”¨æ³•ä¸ SQLite åŸºæœ¬ä¸€è‡´, å‚æ•°æœ‰æ‰€å˜åŒ–</p><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">val</span> cursor <span class="token operator">=</span> contentResolver<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>    uri<span class="token punctuation">,</span> <span class="token comment">// æŒ‡å†…å®¹ URI éœ€è¦ä½¿ç”¨ Uri.parse(URI) è¿›è¡Œè§£æ</span>    projection<span class="token punctuation">,</span> <span class="token comment">// åˆ—å</span>    selection<span class="token punctuation">,</span> <span class="token comment">// where çº¦æŸ</span>    selectionArgs<span class="token punctuation">,</span> <span class="token comment">// å ä½ç¬¦å€¼</span>    sortOrder <span class="token comment">// æ’åºæ–¹å¼</span><span class="token punctuation">)</span><span class="token keyword">while</span> <span class="token punctuation">(</span>cursor<span class="token punctuation">.</span><span class="token function">moveToNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">val</span> column1 <span class="token operator">=</span> cursor<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span>cursor<span class="token punctuation">.</span><span class="token function">getColumnIndex</span><span class="token punctuation">(</span><span class="token string">"column1"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">val</span> column2 <span class="token operator">=</span> cursor<span class="token punctuation">.</span><span class="token function">getInt</span><span class="token punctuation">(</span>cursor<span class="token punctuation">.</span><span class="token function">getColumnIndex</span><span class="token punctuation">(</span><span class="token string">"column2"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span>cursor<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="delete"><a class="markdownIt-Anchor" href="#delete"></a> delete</h2><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin">contentResolver<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>uri<span class="token punctuation">,</span> <span class="token string">"column2 = ?"</span><span class="token punctuation">,</span> <span class="token function">arrayOf</span><span class="token punctuation">(</span><span class="token string">"1"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h1 id="customized-contentprovider"><a class="markdownIt-Anchor" href="#customized-contentprovider"></a> Customized ContentProvider</h1><p>éœ€è¦ç»§æ‰¿ ContentProvider å¹¶é‡å†™å…¶å…­ä¸ªå‡½æ•°: <code>onCreate(), query(), insert(), update(), delete(), getType()</code></p><ul><li>onCreate: åˆå§‹åŒ– contentProvider, å®Œæˆå¯¹æ•°æ®åº“çš„åˆ›å»ºå’Œå‡çº§æ“ä½œ</li><li>getType: æ ¹æ®ä¼ å…¥çš„å†…å®¹ URI è¿”å›ç›¸åº”çš„ MIME ç±»å‹</li></ul><h2 id="mime-ç±»å‹"><a class="markdownIt-Anchor" href="#mime-ç±»å‹"></a> MIME ç±»å‹</h2><p>å†…å®¹ URI <code>content://com.example.app.provider/table1/1</code> çš„ MIME ç±»å‹ä¸º <code>vnd.android.cursor.item/vnd.com.example.app.provider.table1</code></p><ul><li>ä»¥ <code>vnd</code> å¼€å¤´</li><li>å¦‚æœ URI æŒ‡ç¤ºçš„æ˜¯è·¯å¾„åˆ™æ·»åŠ  <code>android.cursor.dir/</code>; å¦‚æœ URI èŠå£«çš„æ˜¯ id åˆ™æ·»åŠ  <code>android.cursor.item/</code></li><li>ä»¥ <code>vnd.&lt;authority&gt;.&lt;path&gt;</code> ç»“å°¾</li></ul><h2 id="è‡ªå®šä¹‰-contentprovider-ç±»"><a class="markdownIt-Anchor" href="#è‡ªå®šä¹‰-contentprovider-ç±»"></a> è‡ªå®šä¹‰ ContentProvider ç±»</h2><ol><li>é¦–å…ˆæ˜ç¡®å¯èƒ½è®¿é—®çš„è¡¨ä¸è¡¨çš„æ¡ç›®æœ‰å“ªäº›, ä½œä¸ºç§æœ‰å±æ€§åˆ—å‡º: <code>bookDir, bookItem</code>, å¹¶ç»‘å®š MIME ç±»å‹</li></ol><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">class</span> BookContentProvider <span class="token operator">:</span> <span class="token function">ContentProvider</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token keyword">val</span> bookDir <span class="token operator">=</span> <span class="token number">0</span>    <span class="token keyword">private</span> <span class="token keyword">val</span> bookItem <span class="token operator">=</span> <span class="token number">1</span>    <span class="token keyword">private</span> <span class="token keyword">val</span> authority <span class="token operator">=</span> <span class="token string">"com.example.a13databasetest.provider"</span>    <span class="token keyword">private</span> <span class="token keyword">var</span> dbHelper<span class="token operator">:</span> JCDatabaseHelper<span class="token operator">?</span> <span class="token operator">=</span> <span class="token keyword">null</span>    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">getType</span><span class="token punctuation">(</span>uri<span class="token operator">:</span> Uri<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token keyword">when</span><span class="token punctuation">(</span>uriMatcher<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span>uri<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        bookDir <span class="token operator">-></span> <span class="token string">"vnd.android.cursor.dir/vnd.<span class="token interpolation variable">$authority</span>.book"</span>        bookItem <span class="token operator">-></span> <span class="token string">"vnd.android.cursor.item/vnd.<span class="token interpolation variable">$authority</span>.book"</span>        <span class="token keyword">else</span> <span class="token operator">-></span> <span class="token keyword">null</span>    <span class="token punctuation">&#125;</span>    <span class="token operator">..</span><span class="token punctuation">.</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="2"><li>ç„¶åä½¿ç”¨ UriMatcher ä¸º URI åˆ¶ä½œç™½åå•</li></ol><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">private</span> <span class="token keyword">val</span> uriMatcher <span class="token keyword">by</span> lazy <span class="token punctuation">&#123;</span>    <span class="token keyword">val</span> matcher <span class="token operator">=</span> <span class="token function">UriMatcher</span><span class="token punctuation">(</span>UriMatcher<span class="token punctuation">.</span>NO_MATCH<span class="token punctuation">)</span>    matcher<span class="token punctuation">.</span><span class="token function">addURI</span><span class="token punctuation">(</span>authority<span class="token punctuation">,</span> <span class="token string">"book"</span><span class="token punctuation">,</span> bookDir<span class="token punctuation">)</span>    matcher<span class="token punctuation">.</span><span class="token function">addURI</span><span class="token punctuation">(</span>authority<span class="token punctuation">,</span> <span class="token string">"book/#"</span><span class="token punctuation">,</span> bookItem<span class="token punctuation">)</span>    matcher<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="3"><li>å£°æ˜å‘¨æœŸä¸­ onCreate æ—¶å®Œæˆ SQLite çš„ç”³è¯·</li></ol><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">onCreate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> context<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">let</span> <span class="token punctuation">&#123;</span>    dbHelper <span class="token operator">=</span> <span class="token function">JCDatabaseHelper</span><span class="token punctuation">(</span>it<span class="token punctuation">,</span> <span class="token string">"BookStore.db"</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>    <span class="token boolean">true</span><span class="token punctuation">&#125;</span> <span class="token operator">?:</span> <span class="token boolean">false</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><ol start="4"><li>å®Œæˆ query, insert, update, delete å¤„ç†é€»è¾‘</li></ol><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">query</span><span class="token punctuation">(</span>    uri<span class="token operator">:</span> Uri<span class="token punctuation">,</span> projection<span class="token operator">:</span> Array<span class="token operator">&lt;</span>String<span class="token operator">></span><span class="token operator">?</span><span class="token punctuation">,</span> selection<span class="token operator">:</span> String<span class="token operator">?</span><span class="token punctuation">,</span>    selectionArgs<span class="token operator">:</span> Array<span class="token operator">&lt;</span>String<span class="token operator">></span><span class="token operator">?</span><span class="token punctuation">,</span> sortOrder<span class="token operator">:</span> String<span class="token operator">?</span><span class="token punctuation">)</span> <span class="token operator">=</span> dbHelper<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">let</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">val</span> db <span class="token operator">=</span> it<span class="token punctuation">.</span>readableDatabase    <span class="token keyword">val</span> cursor <span class="token operator">=</span> <span class="token keyword">when</span><span class="token punctuation">(</span>uriMatcher<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span>uri<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        bookDir <span class="token operator">-></span> db<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string">"Book"</span><span class="token punctuation">,</span> projection<span class="token punctuation">,</span> selection<span class="token punctuation">,</span> selectionArgs<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> sortOrder<span class="token punctuation">)</span>        bookItem <span class="token operator">-></span> <span class="token punctuation">&#123;</span>            <span class="token keyword">val</span> book_id <span class="token operator">=</span> uri<span class="token punctuation">.</span>pathSegments<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>            db<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string">"Book"</span><span class="token punctuation">,</span> projection<span class="token punctuation">,</span> <span class="token string">"id = ?"</span><span class="token punctuation">,</span> <span class="token function">arrayOf</span><span class="token punctuation">(</span>book_id<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> sortOrder<span class="token punctuation">)</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">else</span> <span class="token operator">-></span> <span class="token keyword">null</span>    <span class="token punctuation">&#125;</span>    cursor<span class="token punctuation">&#125;</span><span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">delete</span><span class="token punctuation">(</span>uri<span class="token operator">:</span> Uri<span class="token punctuation">,</span> selection<span class="token operator">:</span> String<span class="token operator">?</span><span class="token punctuation">,</span> selectionArgs<span class="token operator">:</span> Array<span class="token operator">&lt;</span>String<span class="token operator">></span><span class="token operator">?</span><span class="token punctuation">)</span> <span class="token operator">=</span> dbHelper<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">let</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">val</span> db <span class="token operator">=</span> it<span class="token punctuation">.</span>writableDatabase    <span class="token keyword">val</span> deletedRows <span class="token operator">=</span> <span class="token keyword">when</span><span class="token punctuation">(</span>uriMatcher<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span>uri<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        bookDir <span class="token operator">-></span> db<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token string">"Book"</span><span class="token punctuation">,</span> selection<span class="token punctuation">,</span> selectionArgs<span class="token punctuation">)</span>        bookItem <span class="token operator">-></span> <span class="token punctuation">&#123;</span>            <span class="token keyword">val</span> book_id <span class="token operator">=</span> uri<span class="token punctuation">.</span>pathSegments<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>            db<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token string">"Book"</span><span class="token punctuation">,</span> <span class="token string">"id = ?"</span><span class="token punctuation">,</span> <span class="token function">arrayOf</span><span class="token punctuation">(</span>book_id<span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">else</span> <span class="token operator">-></span> <span class="token number">0</span>    <span class="token punctuation">&#125;</span>    deletedRows<span class="token punctuation">&#125;</span> <span class="token operator">?:</span> <span class="token number">0</span><span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">insert</span><span class="token punctuation">(</span>uri<span class="token operator">:</span> Uri<span class="token punctuation">,</span> values<span class="token operator">:</span> ContentValues<span class="token operator">?</span><span class="token punctuation">)</span> <span class="token operator">=</span> dbHelper<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">let</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">val</span> db <span class="token operator">=</span> it<span class="token punctuation">.</span>writableDatabase    <span class="token keyword">val</span> uriReturn <span class="token operator">=</span> <span class="token keyword">when</span> <span class="token punctuation">(</span>uriMatcher<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span>uri<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        bookDir<span class="token punctuation">,</span> bookItem <span class="token operator">-></span> <span class="token punctuation">&#123;</span>            <span class="token keyword">val</span> book_id <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token string">"Book"</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> values<span class="token punctuation">)</span>            Uri<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token string">"content://<span class="token interpolation variable">$authority</span>/book/<span class="token interpolation variable">$book_id</span>"</span><span class="token punctuation">)</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">else</span> <span class="token operator">-></span> <span class="token keyword">null</span>    <span class="token punctuation">&#125;</span>    uriReturn<span class="token punctuation">&#125;</span><span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">update</span><span class="token punctuation">(</span>    uri<span class="token operator">:</span> Uri<span class="token punctuation">,</span> values<span class="token operator">:</span> ContentValues<span class="token operator">?</span><span class="token punctuation">,</span> selection<span class="token operator">:</span> String<span class="token operator">?</span><span class="token punctuation">,</span>    selectionArgs<span class="token operator">:</span> Array<span class="token operator">&lt;</span>String<span class="token operator">></span><span class="token operator">?</span><span class="token punctuation">)</span> <span class="token operator">=</span> dbHelper<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">let</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">val</span> db <span class="token operator">=</span> it<span class="token punctuation">.</span>writableDatabase    <span class="token keyword">val</span> updatedRows <span class="token operator">=</span> <span class="token keyword">when</span><span class="token punctuation">(</span>uriMatcher<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span>uri<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        bookDir <span class="token operator">-></span> db<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token string">"Book"</span><span class="token punctuation">,</span> values<span class="token punctuation">,</span> selection<span class="token punctuation">,</span> selectionArgs<span class="token punctuation">)</span>        bookItem <span class="token operator">-></span> <span class="token punctuation">&#123;</span>            <span class="token keyword">val</span> book_id <span class="token operator">=</span> uri<span class="token punctuation">.</span>pathSegments<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>            db<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token string">"Book"</span><span class="token punctuation">,</span> values<span class="token punctuation">,</span> <span class="token string">"id = ?"</span><span class="token punctuation">,</span> <span class="token function">arrayOf</span><span class="token punctuation">(</span>book_id<span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">else</span> <span class="token operator">-></span> <span class="token number">0</span>    <span class="token punctuation">&#125;</span>    updatedRows<span class="token punctuation">&#125;</span> <span class="token operator">?:</span> <span class="token number">0</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="5"><li>è®°å¾—æ£€æŸ¥ AndroidManifest ä¸­æ˜¯å¦å£°æ˜äº† Provider</li></ol><h2 id="å¤–éƒ¨æ“ä½œå…±äº«æ•°æ®åŒºåŸŸ"><a class="markdownIt-Anchor" href="#å¤–éƒ¨æ“ä½œå…±äº«æ•°æ®åŒºåŸŸ"></a> å¤–éƒ¨æ“ä½œå…±äº«æ•°æ®åŒºåŸŸ</h2><p>æŒ‡å®šå¥½ URI é€šè¿‡ contentResolver è¿›è¡Œæ“ä½œå³å¯</p><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin">R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>addData <span class="token operator">-></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">val</span> uri <span class="token operator">=</span> Uri<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token string">"content://com.example.a13databasetest.provider/book"</span><span class="token punctuation">)</span>    <span class="token keyword">val</span> values <span class="token operator">=</span> <span class="token function">contentValuesOf</span><span class="token punctuation">(</span><span class="token string">"name"</span> <span class="token keyword">to</span> <span class="token string">"The day"</span><span class="token punctuation">,</span> <span class="token string">"author"</span> <span class="token keyword">to</span> <span class="token string">"ZH"</span><span class="token punctuation">,</span> <span class="token string">"pages"</span> <span class="token keyword">to</span> <span class="token number">999</span><span class="token punctuation">,</span> <span class="token string">"price"</span> <span class="token keyword">to</span> <span class="token string">"9.98"</span><span class="token punctuation">)</span>    <span class="token keyword">val</span> newUri <span class="token operator">=</span> contentResolver<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>uri<span class="token punctuation">,</span> values<span class="token punctuation">)</span>    book_id <span class="token operator">=</span> newUri<span class="token operator">?</span><span class="token punctuation">.</span>pathSegments<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span>R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>queryData <span class="token operator">-></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">val</span> uri <span class="token operator">=</span> Uri<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token string">"content://com.example.a13databasetest.provider/book"</span><span class="token punctuation">)</span>    contentResolver<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>uri<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">apply</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token function">moveToNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">val</span> name <span class="token operator">=</span> <span class="token function">getString</span><span class="token punctuation">(</span><span class="token function">getColumnIndexOrThrow</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>            <span class="token keyword">val</span> author <span class="token operator">=</span> <span class="token function">getString</span><span class="token punctuation">(</span><span class="token function">getColumnIndexOrThrow</span><span class="token punctuation">(</span><span class="token string">"author"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>            <span class="token keyword">val</span> pages <span class="token operator">=</span> <span class="token function">getInt</span><span class="token punctuation">(</span><span class="token function">getColumnIndexOrThrow</span><span class="token punctuation">(</span><span class="token string">"pages"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>            <span class="token keyword">val</span> price <span class="token operator">=</span> <span class="token function">getDouble</span><span class="token punctuation">(</span><span class="token function">getColumnIndexOrThrow</span><span class="token punctuation">(</span><span class="token string">"price"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token punctuation">&#125;</span>        <span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>updateData <span class="token operator">-></span> <span class="token punctuation">&#123;</span>    book_id<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">let</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">val</span> uri <span class="token operator">=</span> Uri<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token string">"content://com.example.a13databasetest.provider/book/<span class="token interpolation variable">$it</span>"</span><span class="token punctuation">)</span>        <span class="token keyword">val</span> values <span class="token operator">=</span> <span class="token function">contentValuesOf</span><span class="token punctuation">(</span><span class="token string">"name"</span> <span class="token keyword">to</span> <span class="token string">"A Storm of Swords"</span><span class="token punctuation">,</span>            <span class="token string">"pages"</span> <span class="token keyword">to</span> <span class="token number">1216</span><span class="token punctuation">,</span> <span class="token string">"price"</span> <span class="token keyword">to</span> <span class="token number">24.05</span><span class="token punctuation">)</span>        contentResolver<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>uri<span class="token punctuation">,</span> values<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>deleteData <span class="token operator">-></span> <span class="token punctuation">&#123;</span>    book_id<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">let</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">val</span> uri <span class="token operator">=</span> Uri<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token string">"content://com.example.a13databasetest.provider/book/<span class="token interpolation variable">$it</span>"</span><span class="token punctuation">)</span>        contentResolver<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>uri<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> Android Dev. </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Android </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>07-PersistentStorage</title>
      <link href="/Coming-blog/2022/08/21/07-persistentstorage/"/>
      <url>/Coming-blog/2022/08/21/07-persistentstorage/</url>
      
        <content type="html"><![CDATA[<h1 id="overview"><a class="markdownIt-Anchor" href="#overview"></a> Overview</h1><p>Types: æ–‡ä»¶å­˜å‚¨, SharedPerferences å­˜å‚¨, æ•°æ®åº“å­˜å‚¨</p><h1 id="é€šè¿‡æ–‡ä»¶å­˜å‚¨"><a class="markdownIt-Anchor" href="#é€šè¿‡æ–‡ä»¶å­˜å‚¨"></a> é€šè¿‡æ–‡ä»¶å­˜å‚¨</h1><p>ä¸å¯¹å­˜å‚¨çš„å†…å®¹è¿›è¡Œä»»ä½•æ ¼å¼åŒ–å¤„ç†ï¼Œæ‰€æœ‰æ•°æ®éƒ½æ˜¯åŸå°ä¸åŠ¨åœ°ä¿å­˜åˆ°æ–‡ä»¶å½“ä¸­çš„ï¼Œå› è€Œå®ƒæ¯”è¾ƒé€‚åˆå­˜å‚¨ä¸€äº›ç®€å•çš„æ–‡æœ¬æ•°æ®æˆ–äºŒè¿›åˆ¶æ•°æ®</p><h2 id="save"><a class="markdownIt-Anchor" href="#save"></a> Save</h2><p>ä¸»è¦é€šè¿‡ Context ç±»ä¸­çš„ openFileOutput æ–¹æ³•å®ç°, è¿”å›ä¸€ä¸ª FileOutputStream å¯¹è±¡</p><ul><li>openFileOutput ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºæŒ‡å®šçš„æ–‡ä»¶å, ä¸å¯ä»¥åŒ…å«è·¯å¾„, å› ä¸ºæ‰€æœ‰çš„æ–‡ä»¶éƒ½é»˜è®¤å­˜å‚¨åˆ° <code>/data/data/&lt;package name&gt;/files/</code> ç›®å½•ä¸‹</li><li>openFileOutput ç¬¬äºŒä¸ªå‚æ•°æ˜¯æ–‡ä»¶çš„æ“ä½œæ¨¡å¼, MODE_PRIVATE è¡¨ç¤ºè¦†ç›–å†™; MODE_APPEND è¡¨ç¤ºè¿½åŠ </li><li>FileOutputStream å¯¹è±¡å¯ä»¥ä½¿ç”¨ Java æµçš„æ–¹å¼å°†æ•°æ®å†™å…¥æ–‡ä»¶ä¸­</li></ul><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">private</span> <span class="token keyword">fun</span> <span class="token function">save</span><span class="token punctuation">(</span>inputText<span class="token operator">:</span> String<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">val</span> output <span class="token operator">=</span> <span class="token function">openFileOutput</span><span class="token punctuation">(</span><span class="token string">"jcData"</span><span class="token punctuation">,</span> Context<span class="token punctuation">.</span>MODE_PRIVATE<span class="token punctuation">)</span>        <span class="token keyword">val</span> writer <span class="token operator">=</span> <span class="token function">BufferedWriter</span><span class="token punctuation">(</span><span class="token function">OutputStreamWriter</span><span class="token punctuation">(</span>output<span class="token punctuation">)</span><span class="token punctuation">)</span>        writer<span class="token punctuation">.</span><span class="token function">use</span> <span class="token punctuation">&#123;</span>            it<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>inputText<span class="token punctuation">)</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token operator">:</span> IOException<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="load"><a class="markdownIt-Anchor" href="#load"></a> Load</h2><p>é€šè¿‡ Context ç±»ä¸­æä¾›çš„ openFileInput æ–¹æ³•, æŒ‡å®šæ–‡ä»¶åå³å¯è¯»å–, è¿”å› FileInputStream å¯¹è±¡</p><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">private</span> <span class="token keyword">fun</span> <span class="token function">load</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> String <span class="token punctuation">&#123;</span>    <span class="token keyword">val</span> content <span class="token operator">=</span> <span class="token function">StringBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">val</span> input <span class="token operator">=</span> <span class="token function">openFileInput</span><span class="token punctuation">(</span><span class="token string">"jcData"</span><span class="token punctuation">)</span>        <span class="token keyword">val</span> reader <span class="token operator">=</span> <span class="token function">BufferedReader</span><span class="token punctuation">(</span><span class="token function">InputStreamReader</span><span class="token punctuation">(</span>input<span class="token punctuation">)</span><span class="token punctuation">)</span>        reader<span class="token punctuation">.</span><span class="token function">use</span> <span class="token punctuation">&#123;</span>            reader<span class="token punctuation">.</span><span class="token function">forEachLine</span> <span class="token punctuation">&#123;</span>                content<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>it<span class="token punctuation">)</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token operator">:</span> IOException<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">return</span> content<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="sharedpreferences"><a class="markdownIt-Anchor" href="#sharedpreferences"></a> SharedPreferences</h1><p>ä½¿ç”¨é”®å€¼å¯¹çš„æ–¹å¼æ¥å­˜å‚¨æ•°æ®, æ”¯æŒå¤šç§ä¸åŒçš„æ•°æ®ç±»å‹å­˜å‚¨</p><h2 id="è·å–-sharedpreferences-å¯¹è±¡"><a class="markdownIt-Anchor" href="#è·å–-sharedpreferences-å¯¹è±¡"></a> è·å– SharedPreferences å¯¹è±¡</h2><p><code>Context.getSharedPreferences(filename, MODE)</code></p><ul><li>ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºæ–‡ä»¶åç§°, å­˜å‚¨è·¯å¾„å›ºå®šä¸º <code>/data/data/&lt;package ame&gt;/shared_prefs/</code></li><li>ç¬¬äºŒä¸ªå‚æ•°ä¸ºæ“ä½œæ¨¡å¼, ç›®å‰ä»…æ”¯æŒ MODE_PRIVATE, è¡¨ç¤ºåªæœ‰å½“å‰çš„åº”ç”¨ç¨‹åºæ‰å¯ä»¥å¯¹è¿™ä¸ª SharedPreferences æ–‡ä»¶è¿›è¡Œè¯»å†™</li></ul><p><code>Activity.getPreferences(MODE)</code></p><ul><li>è‡ªåŠ¨å°†å½“å‰ Activity çš„ç±»åä½œä¸ºæ–‡ä»¶å</li></ul><h2 id="save-2"><a class="markdownIt-Anchor" href="#save-2"></a> Save</h2><ol><li>è·å– Editor å¯¹è±¡: <code>SharedPreferences.edit()</code></li><li>å‘ Editor å¯¹è±¡ä¸­æ·»åŠ æ•°æ®: <code>putBoolean(), putString(), ...</code></li><li>è°ƒç”¨ apply() æ–¹æ³•å®ç°æ“ä½œæäº¤</li></ol><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">val</span> editor <span class="token operator">=</span> <span class="token function">getSharedPreferences</span><span class="token punctuation">(</span><span class="token string">"jcData"</span><span class="token punctuation">,</span> Context<span class="token punctuation">.</span>MODE_PRIVATE<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">edit</span><span class="token punctuation">(</span><span class="token punctuation">)</span>editor<span class="token punctuation">.</span><span class="token function">putString</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">,</span> <span class="token string">"Coming"</span><span class="token punctuation">)</span>editor<span class="token punctuation">.</span><span class="token function">putBoolean</span><span class="token punctuation">(</span><span class="token string">"married"</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span>editor<span class="token punctuation">.</span><span class="token function">putInt</span><span class="token punctuation">(</span><span class="token string">"age"</span><span class="token punctuation">,</span> <span class="token number">24</span><span class="token punctuation">)</span>editor<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä½¿ç”¨é«˜çº§å‡½æ•°è¿›è¡Œ API ä¼˜åŒ–</p><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token comment">// æ‰©å±•å‡½æ•°æ·»åŠ  open æ–¹æ³• æ¥æ”¶å‡½æ•°ç±»å‹ä¸º SharedPreferences.Editor</span><span class="token keyword">fun</span> SharedPreferences<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span>block<span class="token operator">:</span> SharedPreferences<span class="token punctuation">.</span>Editor<span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span> Unit<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// open å‡½æ•°æ‹¥æœ‰ SharedPreferences æ–¹æ³•çš„ä¸Šä¸‹æ–‡, å¯ä»¥ç›´æ¥è°ƒç”¨ edit æ–¹æ³•</span>    <span class="token keyword">val</span> editor <span class="token operator">=</span> <span class="token function">edit</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    editor<span class="token punctuation">.</span><span class="token function">block</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    editor<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token function">getSharedPreferences</span><span class="token punctuation">(</span><span class="token string">"jcData"</span><span class="token punctuation">,</span> Context<span class="token punctuation">.</span>MODE_PRIVATE<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">open</span> <span class="token punctuation">&#123;</span>    <span class="token function">putString</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">,</span> <span class="token string">"CJC"</span><span class="token punctuation">)</span>    <span class="token function">putBoolean</span><span class="token punctuation">(</span><span class="token string">"married"</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span>    <span class="token function">putInt</span><span class="token punctuation">(</span><span class="token string">"age"</span><span class="token punctuation">,</span> <span class="token number">24</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="load-2"><a class="markdownIt-Anchor" href="#load-2"></a> Load</h2><p>é€šè¿‡ SharedPreferences å¯¹è±¡çš„ getXX æ–¹æ³•è·å–ç›®æ ‡å€¼</p><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">val</span> prefs <span class="token operator">=</span> <span class="token function">getSharedPreferences</span><span class="token punctuation">(</span><span class="token string">"jcData"</span><span class="token punctuation">,</span> Context<span class="token punctuation">.</span>MODE_PRIVATE<span class="token punctuation">)</span><span class="token keyword">val</span> name <span class="token operator">=</span> prefs<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token keyword">val</span> married <span class="token operator">=</span> prefs<span class="token punctuation">.</span><span class="token function">getBoolean</span><span class="token punctuation">(</span><span class="token string">"married"</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token keyword">val</span> age <span class="token operator">=</span> prefs<span class="token punctuation">.</span><span class="token function">getInt</span><span class="token punctuation">(</span><span class="token string">"age"</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h1 id="sqlite"><a class="markdownIt-Anchor" href="#sqlite"></a> SQLite</h1><p>Android ç³»ç»Ÿå†…ç½®çš„æ•°æ®åº“, è½»é‡çº§çš„å…³ç³»å‹æ•°æ®åº“ï¼Œè¿ç®—é€Ÿåº¦å¿«ï¼Œå ç”¨èµ„æºå°‘ï¼Œé€šå¸¸åªéœ€è¦å‡ ç™¾KBçš„å†…å­˜å°±è¶³å¤Ÿäº†</p><p>æ•°æ®ç±»å‹: integer æ•´å‹ï¼Œreal æµ®ç‚¹å‹ï¼Œtext æ–‡æœ¬ç±»å‹ï¼Œblob äºŒè¿›åˆ¶ç±»å‹</p><p>å…³é”®å­—: primary key, autoincrement</p><h2 id="sqliteopenhelper"><a class="markdownIt-Anchor" href="#sqliteopenhelper"></a> SQLiteOpenHelper</h2><p>æ˜¯ä¸€ä¸ªæŠ½è±¡ç±», æ‹¥æœ‰ä¸¤ä¸ªæŠ½è±¡æ–¹æ³• <code>onCreate()</code> ä¸ <code>onUpgrade()</code> ç”¨äºå®ç°åˆ›å»ºå’Œå‡çº§æ•°æ®åº“çš„é€»è¾‘; æ‹¥æœ‰ä¸¤ä¸ªå®ä¾‹æ–¹æ³• <code>getReadableDatabase()</code> å’Œ <code>getWritableDatabase()</code></p><ul><li>å½“æ•°æ®åº“ä¸å¯å†™å…¥çš„æ—¶å€™ï¼ˆå¦‚ç£ç›˜ç©ºé—´å·²æ»¡ï¼‰ï¼ŒgetReadableDatabase() æ–¹æ³•è¿”å›çš„å¯¹è±¡å°†ä»¥åªè¯»çš„æ–¹å¼æ‰“å¼€æ•°æ®åº“ï¼Œè€Œ getWritableDatabase() æ–¹æ³•åˆ™å°†å‡ºç°å¼‚å¸¸</li><li>æ„é€ æ–¹æ³•å‚æ•°åˆ—è¡¨<ul><li>Context, æ•°æ®åº“å, null(å…è®¸æˆ‘ä»¬åœ¨æŸ¥è¯¢æ•°æ®çš„æ—¶å€™è¿”å›ä¸€ä¸ªè‡ªå®šä¹‰çš„ Cursor), å½“å‰æ•°æ®åº“çš„ç‰ˆæœ¬å·(Int)</li></ul></li><li>æ•°æ®åº“çš„æ–‡ä»¶ç»Ÿä¸€å­˜æ”¾åœ¨ <code>/data/data/&lt;package name&gt;/databases/</code></li></ul><h2 id="åˆ›å»ºå’Œå‡çº§æ•°æ®åº“"><a class="markdownIt-Anchor" href="#åˆ›å»ºå’Œå‡çº§æ•°æ®åº“"></a> åˆ›å»ºå’Œå‡çº§æ•°æ®åº“</h2><p>ä¸»è¦å®Œæˆæ•°æ®åº“ä¸­è¡¨çš„åˆ›å»º, åç»­å¯èƒ½æ ¹æ®ä¸šåŠ¡æƒ…å†µé¢å¤–å¢åŠ è¡¨, è¿™æ—¶å€™éœ€è¦åˆ©ç”¨å‡çº§åŠŸèƒ½å®ç°å¢åŠ </p><ol><li>å»ºç«‹å¹¶ç»´æŠ¤é¡¹ç›®è‡ªèº«çš„ DatabaseHelper ç±»ï¼šç‰ˆæœ¬å˜åŒ–æ—¶ä¼šæ‰§è¡Œ onUpgrade ä»è€Œå®ç°çƒ­æ›´æ–°, ç”¨ if åˆ¤æ–­æ¯ä¸€æ¬¡å‡çº§æ”¹åŠ¨, ä½¿å¾—ä½ç‰ˆæœ¬ç”¨æˆ·æ”¯æŒè·¨ç‰ˆæœ¬å‡çº§</li></ol><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">class</span> <span class="token function">JCDatabaseHelper</span><span class="token punctuation">(</span><span class="token keyword">val</span> context<span class="token operator">:</span> Context<span class="token punctuation">,</span> name<span class="token operator">:</span> String<span class="token punctuation">,</span> version<span class="token operator">:</span> Int<span class="token punctuation">)</span><span class="token operator">:</span>         <span class="token function">SQLiteOpenHelper</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> name<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> version<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token keyword">val</span> createBook <span class="token operator">=</span> <span class="token string">"create table Book ("</span> <span class="token operator">+</span>            <span class="token string">" id integer primary key autoincrement,"</span> <span class="token operator">+</span>            <span class="token string">"author text,"</span> <span class="token operator">+</span>            <span class="token string">"price real,"</span> <span class="token operator">+</span>            <span class="token string">"pages integer,"</span> <span class="token operator">+</span>            <span class="token string">"name text)"</span>    <span class="token keyword">private</span> <span class="token keyword">val</span> createCategory <span class="token operator">=</span> <span class="token string">"create table Category (\n"</span> <span class="token operator">+</span>            <span class="token string">"    id integer primary key autoincrement,\n"</span> <span class="token operator">+</span>            <span class="token string">"    category_name text,\n"</span> <span class="token operator">+</span>            <span class="token string">"    category_code integer\n"</span> <span class="token operator">+</span>            <span class="token string">")"</span>    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">onCreate</span><span class="token punctuation">(</span>db<span class="token operator">:</span> SQLiteDatabase<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        db<span class="token punctuation">.</span><span class="token function">execSQL</span><span class="token punctuation">(</span>createBook<span class="token punctuation">)</span>        db<span class="token punctuation">.</span><span class="token function">execSQL</span><span class="token punctuation">(</span>createCategory<span class="token punctuation">)</span>        Toast<span class="token punctuation">.</span><span class="token function">makeText</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> <span class="token string">"Create succeeded"</span><span class="token punctuation">,</span> Toast<span class="token punctuation">.</span>LENGTH_SHORT<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">onUpgrade</span><span class="token punctuation">(</span>db<span class="token operator">:</span> SQLiteDatabase<span class="token punctuation">,</span> oldVersion<span class="token operator">:</span> Int<span class="token punctuation">,</span> newVersion<span class="token operator">:</span> Int<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        Toast<span class="token punctuation">.</span><span class="token function">makeText</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> <span class="token string">"Upgrade Success: <span class="token interpolation variable">$oldVersion</span> -> <span class="token interpolation variable">$newVersion</span>"</span><span class="token punctuation">,</span> Toast<span class="token punctuation">.</span>LENGTH_SHORT<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>oldVersion <span class="token operator">&lt;=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            db<span class="token punctuation">.</span><span class="token function">execSQL</span><span class="token punctuation">(</span>createCategory<span class="token punctuation">)</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>oldVersion <span class="token operator">&lt;=</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            db<span class="token punctuation">.</span><span class="token function">execSQL</span><span class="token punctuation">(</span><span class="token string">"alter table Book add column category_id integer"</span><span class="token punctuation">)</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="2"><li>åœ¨ Activity ä¸­è§¦å‘æ•°æ®åº“çš„åˆ›å»º/æ›´æ–°, ç”Ÿæˆ DatabaseHelper çš„å®ä¾‹å¯¹è±¡, å¹¶è·å–æ•°æ®åº“ <code>writableDatabase/readableDatabase</code></li></ol><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">class</span> MainActivity <span class="token operator">:</span> <span class="token function">AppCompatActivity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> View<span class="token punctuation">.</span><span class="token function">OnClickListener</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">lateinit</span> <span class="token keyword">var</span> dbHelper<span class="token operator">:</span> JCDatabaseHelper    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">onCreate</span><span class="token punctuation">(</span>savedInstanceState<span class="token operator">:</span> Bundle<span class="token operator">?</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onCreate</span><span class="token punctuation">(</span>savedInstanceState<span class="token punctuation">)</span>        <span class="token function">setContentView</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>layout<span class="token punctuation">.</span>activity_main<span class="token punctuation">)</span>        dbHelper <span class="token operator">=</span> <span class="token function">JCDatabaseHelper</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token string">"BookStore.db"</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>        <span class="token keyword">val</span> button_createdb <span class="token operator">=</span> findViewById<span class="token operator">&lt;</span>Button<span class="token operator">></span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>button_createdb<span class="token punctuation">)</span>        button_createdb<span class="token punctuation">.</span><span class="token function">setOnClickListener</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">onClick</span><span class="token punctuation">(</span>v<span class="token operator">:</span> View<span class="token operator">?</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">when</span><span class="token punctuation">(</span>v<span class="token operator">?</span><span class="token punctuation">.</span>id<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>button_createdb <span class="token operator">-></span> <span class="token punctuation">&#123;</span>                dbHelper<span class="token punctuation">.</span>writableDatabase            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="crud"><a class="markdownIt-Anchor" href="#crud"></a> CRUD</h2><p>SQLite å°† <code>Create æ·»åŠ , Retrieve æŸ¥è¯¢, Update æ›´æ–°, Delete åˆ é™¤</code> å°è£…å¥½äº†, å€ŸåŠ© SQLiteDatabase å¯¹è±¡å³å¯è½»æ¾å®Œæˆæ“ä½œ</p><h2 id="create-insert"><a class="markdownIt-Anchor" href="#create-insert"></a> Create - insert</h2><ol><li>é€šè¿‡æŒ‰é’®ç‚¹å‡»è·å–è¾“å…¥æ•°æ®å¹¶ç”¨ <code>ContentValues()</code> å°è£…</li></ol><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin">R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>button_add <span class="token operator">-></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">val</span> name <span class="token operator">=</span> edit_name<span class="token punctuation">.</span><span class="token function">checkBlack</span><span class="token punctuation">(</span><span class="token string">"ä¹¦åä¸èƒ½ä¸ºç©º"</span><span class="token punctuation">)</span> <span class="token operator">?:</span> <span class="token keyword">return</span>    <span class="token keyword">val</span> author <span class="token operator">=</span> edit_author<span class="token punctuation">.</span><span class="token function">checkBlack</span><span class="token punctuation">(</span><span class="token string">"ä½œè€…ä¸èƒ½ä¸ºç©º"</span><span class="token punctuation">)</span> <span class="token operator">?:</span> <span class="token keyword">return</span>    <span class="token keyword">val</span> pages <span class="token operator">=</span> <span class="token punctuation">(</span>edit_pages<span class="token punctuation">.</span><span class="token function">checkBlack</span><span class="token punctuation">(</span><span class="token string">"é¡µæ•°ä¸èƒ½ä¸ºç©º"</span><span class="token punctuation">)</span> <span class="token operator">?:</span> <span class="token keyword">return</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">val</span> price <span class="token operator">=</span> <span class="token punctuation">(</span>edit_price<span class="token punctuation">.</span><span class="token function">checkBlack</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span> <span class="token operator">?:</span> <span class="token string">"99999"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toFloat</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">val</span> db <span class="token operator">=</span> dbHelper<span class="token punctuation">.</span>writableDatabase    <span class="token keyword">val</span> values <span class="token operator">=</span> <span class="token function">ContentValues</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">apply</span> <span class="token punctuation">&#123;</span>        <span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span>        <span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"author"</span><span class="token punctuation">,</span> author<span class="token punctuation">)</span>        <span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"pages"</span><span class="token punctuation">,</span> pages<span class="token punctuation">)</span>        <span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"price"</span><span class="token punctuation">,</span> price<span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>    db<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token string">"Book"</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> values<span class="token punctuation">)</span>    Toast<span class="token punctuation">.</span><span class="token function">makeText</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token string">"Add Success!"</span><span class="token punctuation">,</span> Toast<span class="token punctuation">.</span>LENGTH_SHORT<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    edit_name<span class="token punctuation">.</span>text<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    edit_author<span class="token punctuation">.</span>text<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    edit_pages<span class="token punctuation">.</span>text<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    edit_price<span class="token punctuation">.</span>text<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="2"><li>åˆ¤ç©ºå¯ä»¥ä½¿ç”¨æ‰©å±•æ–¹æ³•ä¼˜é›…å®ç°</li></ol><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">fun</span> EditText<span class="token punctuation">.</span><span class="token function">checkBlack</span><span class="token punctuation">(</span>message<span class="token operator">:</span> String<span class="token punctuation">)</span><span class="token operator">:</span> String<span class="token operator">?</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">val</span> text <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>text<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>text<span class="token punctuation">.</span><span class="token function">isBlank</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>message<span class="token punctuation">.</span><span class="token function">isNotEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token function">showError</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">return</span> <span class="token keyword">null</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">return</span> text<span class="token punctuation">&#125;</span><span class="token keyword">fun</span> <span class="token function">showError</span><span class="token punctuation">(</span>message<span class="token operator">:</span> String<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    Toast<span class="token punctuation">.</span><span class="token function">makeText</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> message<span class="token punctuation">,</span> Toast<span class="token punctuation">.</span>LENGTH_SHORT<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="3"><li>æ•°æ®åº“çš„ç›¸å…³æ“ä½œç°åœ¨æ¨èæ”¾åˆ° DatabaseHelper ç±»ä¸­è¿›è¡Œå®ç°</li></ol><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">fun</span> <span class="token function">addBook</span><span class="token punctuation">(</span>name<span class="token operator">:</span> String<span class="token punctuation">,</span> author<span class="token operator">:</span> String<span class="token punctuation">,</span> pages<span class="token operator">:</span> Int<span class="token punctuation">,</span> price<span class="token operator">:</span> Float<span class="token punctuation">)</span><span class="token operator">:</span> Boolean <span class="token punctuation">&#123;</span>    <span class="token keyword">val</span> db <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>writableDatabase    <span class="token keyword">val</span> values <span class="token operator">=</span> <span class="token function">ContentValues</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">apply</span> <span class="token punctuation">&#123;</span>        <span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span>        <span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"author"</span><span class="token punctuation">,</span> author<span class="token punctuation">)</span>        <span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"pages"</span><span class="token punctuation">,</span> pages<span class="token punctuation">)</span>        <span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"price"</span><span class="token punctuation">,</span> price<span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">return</span> <span class="token operator">!</span>db<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token string">"Book"</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> values<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1L</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="retrieve-rawquery"><a class="markdownIt-Anchor" href="#retrieve-rawquery"></a> Retrieve - rawQuery</h2><p>SQLite å¯¹æŸ¥è¯¢çš„å°è£…è¾ƒä¸ºè¯¦å°½ä¹Ÿå¤æ‚, å› æ­¤æ¨èä½¿ç”¨åŸç”Ÿ SQL è¯­æ³•, ä½¿ç”¨ rawQuery æ‰§è¡Œ</p><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">fun</span> <span class="token function">findAllBooks</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> ArrayList<span class="token operator">&lt;</span>Book<span class="token operator">></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">val</span> booklist <span class="token operator">=</span> ArrayList<span class="token operator">&lt;</span>Book<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">val</span> query <span class="token operator">=</span> <span class="token string">"select * from Book"</span>    <span class="token keyword">val</span> db <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>writableDatabase    <span class="token keyword">val</span> cursor <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">rawQuery</span><span class="token punctuation">(</span>query<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span>    <span class="token keyword">if</span><span class="token punctuation">(</span>cursor<span class="token punctuation">.</span><span class="token function">moveToFirst</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">do</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">val</span> id <span class="token operator">=</span> cursor<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span>cursor<span class="token punctuation">.</span><span class="token function">getColumnIndexOrThrow</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token keyword">val</span> name <span class="token operator">=</span> cursor<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span>cursor<span class="token punctuation">.</span><span class="token function">getColumnIndexOrThrow</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>            <span class="token keyword">val</span> author <span class="token operator">=</span> cursor<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span>cursor<span class="token punctuation">.</span><span class="token function">getColumnIndexOrThrow</span><span class="token punctuation">(</span><span class="token string">"author"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>            <span class="token keyword">val</span> pages <span class="token operator">=</span> cursor<span class="token punctuation">.</span><span class="token function">getInt</span><span class="token punctuation">(</span>cursor<span class="token punctuation">.</span><span class="token function">getColumnIndexOrThrow</span><span class="token punctuation">(</span><span class="token string">"pages"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token keyword">val</span> price <span class="token operator">=</span> cursor<span class="token punctuation">.</span><span class="token function">getDouble</span><span class="token punctuation">(</span>cursor<span class="token punctuation">.</span><span class="token function">getColumnIndexOrThrow</span><span class="token punctuation">(</span><span class="token string">"price"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toDouble</span><span class="token punctuation">(</span><span class="token punctuation">)</span>            booklist<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token function">Book</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> name<span class="token punctuation">,</span> author<span class="token punctuation">,</span> pages<span class="token punctuation">,</span> price<span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">while</span><span class="token punctuation">(</span>cursor<span class="token punctuation">.</span><span class="token function">moveToNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>    cursor<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> booklist<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>rawQuery çš„ç¬¬äºŒä¸ªå‚æ•°æ˜¯ç”¨äºä¸ºæŸ¥è¯¢è¯­å¥ query å¡«å……æ•°æ®</p><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">fun</span> <span class="token function">findBookByID</span><span class="token punctuation">(</span>book_id<span class="token operator">:</span> Int<span class="token punctuation">)</span><span class="token operator">:</span> Book <span class="token punctuation">&#123;</span>    <span class="token keyword">val</span> db <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>writableDatabase    <span class="token keyword">val</span> query <span class="token operator">=</span> <span class="token string">"select * from Book where id=?"</span>    <span class="token keyword">val</span> cursor <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">rawQuery</span><span class="token punctuation">(</span>query<span class="token punctuation">,</span> <span class="token function">arrayOf</span><span class="token punctuation">(</span>book_id<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    cursor<span class="token punctuation">.</span><span class="token function">moveToFirst</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">val</span> name <span class="token operator">=</span> cursor<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span>cursor<span class="token punctuation">.</span><span class="token function">getColumnIndexOrThrow</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">val</span> author <span class="token operator">=</span> cursor<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span>cursor<span class="token punctuation">.</span><span class="token function">getColumnIndexOrThrow</span><span class="token punctuation">(</span><span class="token string">"author"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">val</span> pages <span class="token operator">=</span> cursor<span class="token punctuation">.</span><span class="token function">getInt</span><span class="token punctuation">(</span>cursor<span class="token punctuation">.</span><span class="token function">getColumnIndexOrThrow</span><span class="token punctuation">(</span><span class="token string">"pages"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">val</span> price <span class="token operator">=</span> cursor<span class="token punctuation">.</span><span class="token function">getDouble</span><span class="token punctuation">(</span>cursor<span class="token punctuation">.</span><span class="token function">getColumnIndexOrThrow</span><span class="token punctuation">(</span><span class="token string">"price"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toDouble</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> <span class="token function">Book</span><span class="token punctuation">(</span>book_id<span class="token punctuation">,</span> name<span class="token punctuation">,</span> author<span class="token punctuation">,</span> pages<span class="token punctuation">,</span> price<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="update-updateexecsql"><a class="markdownIt-Anchor" href="#update-updateexecsql"></a> Update - update/execSQL</h2><p>å¯ä»¥ä½¿ç”¨å°è£…å¥½çš„ update æ–¹æ³•æˆ–ç›´æ¥ä½¿ç”¨ execSQL æ–¹æ³•æ‰§è¡ŒåŸç”Ÿçš„ SQL è¯­å¥</p><p>update æ–¹æ³•å‚æ•°ä¸º: è¡¨å, è¦æ›´æ–°çš„é”®å€¼å°è£…, where è¯­å¥çš„çº¦æŸä¿¡æ¯, å ä½ç¬¦å†…å®¹</p><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">fun</span> <span class="token function">updateBookById</span><span class="token punctuation">(</span>book<span class="token operator">:</span> Book<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">val</span> db <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>writableDatabase    <span class="token keyword">val</span> values <span class="token operator">=</span> <span class="token function">ContentValues</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">apply</span> <span class="token punctuation">&#123;</span>        <span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">,</span> book<span class="token punctuation">.</span>name<span class="token punctuation">)</span>        <span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"author"</span><span class="token punctuation">,</span> book<span class="token punctuation">.</span>author<span class="token punctuation">)</span>        <span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"pages"</span><span class="token punctuation">,</span> book<span class="token punctuation">.</span>pages<span class="token punctuation">)</span>        <span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"price"</span><span class="token punctuation">,</span> book<span class="token punctuation">.</span>price<span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>    db<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token string">"Book"</span><span class="token punctuation">,</span> values<span class="token punctuation">,</span> <span class="token string">"id = ?"</span><span class="token punctuation">,</span> <span class="token function">arrayOf</span><span class="token punctuation">(</span>book<span class="token punctuation">.</span>id<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="contentvalues-é«˜é˜¶å°è£…"><a class="markdownIt-Anchor" href="#contentvalues-é«˜é˜¶å°è£…"></a> ContentValues é«˜é˜¶å°è£…</h3><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token comment">// æ¥æ”¶ Pair å‚æ•°; vararg å…³é”®å­—è¡¨ç¤ºæ¥æ”¶çš„æ˜¯å¯å˜å‚æ•°åˆ—è¡¨, å³å…è®¸ä¼ å…¥ 0-n ä¸ª Pair å‚æ•°</span><span class="token keyword">fun</span> <span class="token function">cvOf</span><span class="token punctuation">(</span><span class="token keyword">vararg</span> pairs<span class="token operator">:</span> Pair<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> Any<span class="token operator">?</span><span class="token operator">></span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token function">ContentValues</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">apply</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span>pair <span class="token keyword">in</span> pairs<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">val</span> key <span class="token operator">=</span> pair<span class="token punctuation">.</span>first        <span class="token keyword">val</span> value <span class="token operator">=</span> pair<span class="token punctuation">.</span>second        <span class="token keyword">when</span> <span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token comment">// Smart Cast åŠŸèƒ½ å¦‚æœè¿›å…¥äº† Int åˆ†æ”¯åˆ™ä¼šè‡ªåŠ¨è½¬å‹, ä¸å¿…æ‰‹åŠ¨å‘ä¸‹è½¬å‹äº†</span>            <span class="token keyword">is</span> Int <span class="token operator">-></span> <span class="token function">put</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">)</span>            <span class="token keyword">is</span> Long <span class="token operator">-></span> <span class="token function">put</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">)</span>            <span class="token keyword">is</span> Short <span class="token operator">-></span> <span class="token function">put</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">)</span>            <span class="token keyword">is</span> Float <span class="token operator">-></span> <span class="token function">put</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">)</span>            <span class="token keyword">is</span> Double <span class="token operator">-></span> <span class="token function">put</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">)</span>            <span class="token keyword">is</span> Boolean <span class="token operator">-></span> <span class="token function">put</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">)</span>            <span class="token keyword">is</span> String <span class="token operator">-></span> <span class="token function">put</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">)</span>            <span class="token keyword">is</span> Byte <span class="token operator">-></span> <span class="token function">put</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">)</span>            <span class="token keyword">is</span> ByteArray <span class="token operator">-></span> <span class="token function">put</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">)</span>            <span class="token keyword">null</span> <span class="token operator">-></span> <span class="token function">putNull</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åœ¨çœŸæ­£ä¼ å€¼æ—¶èƒ½æ˜¾è‘—å‡å°‘ä»£ç é‡</p><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">val</span> values <span class="token operator">=</span> <span class="token function">cvOf</span><span class="token punctuation">(</span><span class="token string">"name"</span> <span class="token keyword">to</span> book<span class="token punctuation">.</span>name<span class="token punctuation">,</span> <span class="token string">"author"</span> <span class="token keyword">to</span> book<span class="token punctuation">.</span>author<span class="token punctuation">,</span> <span class="token string">"pages"</span> <span class="token keyword">to</span> book<span class="token punctuation">.</span>pages<span class="token punctuation">,</span> <span class="token string">"price"</span> <span class="token keyword">to</span> book<span class="token punctuation">.</span>price<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="delete-deleteexecsql"><a class="markdownIt-Anchor" href="#delete-deleteexecsql"></a> Delete - delete/execSQL</h2><p>ä¸ update åŸºæœ¬ä¸€è‡´, è¿æ–¹æ³•çš„ä½¿ç”¨ä¹ŸåŸºæœ¬ä¸€è‡´</p><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">fun</span> <span class="token function">deleteBookById</span><span class="token punctuation">(</span>book_id<span class="token operator">:</span> Int<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">val</span> db <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>writableDatabase    db<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token string">"Book"</span><span class="token punctuation">,</span> <span class="token string">"id = ?"</span><span class="token punctuation">,</span> <span class="token function">arrayOf</span><span class="token punctuation">(</span>book_id<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h2 id="äº‹åŠ¡"><a class="markdownIt-Anchor" href="#äº‹åŠ¡"></a> äº‹åŠ¡</h2><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin">db<span class="token punctuation">.</span><span class="token function">beginTransaction</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// å¼€å¯äº‹åŠ¡</span><span class="token keyword">try</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// SQL å¤„ç†</span>    db<span class="token punctuation">.</span><span class="token function">setTransactionSuccessful</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// äº‹åŠ¡æ‰§è¡Œå®Œæ¯•ä¸”æˆåŠŸ</span><span class="token punctuation">&#125;</span> <span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token operator">:</span> Exception<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span> <span class="token keyword">finally</span> <span class="token punctuation">&#123;</span>    db<span class="token punctuation">.</span><span class="token function">endTransaction</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// ç»“æŸäº‹åŠ¡</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> Android Dev. </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Android </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>06-Broadcast</title>
      <link href="/Coming-blog/2022/08/19/06-broadcast/"/>
      <url>/Coming-blog/2022/08/19/06-broadcast/</url>
      
        <content type="html"><![CDATA[<h1 id="broadcast-mechanism"><a class="markdownIt-Anchor" href="#broadcast-mechanism"></a> Broadcast Mechanism</h1><p>æ¯ä¸ªåº”ç”¨ç¨‹åºéƒ½å¯ä»¥å¯¹æ„Ÿå…´è¶£çš„å¹¿æ’­è¿›è¡Œæ³¨å†Œï¼Œè¿™æ ·è¯¥ç¨‹åºå°±åªä¼šæ”¶åˆ°è‡ªå·±æ‰€å…³å¿ƒçš„å¹¿æ’­å†…å®¹</p><ul><li>æºå¯èƒ½æ¥è‡ªäºç³»ç»Ÿï¼Œä¹Ÿå¯èƒ½æ˜¯æ¥è‡ªäºå…¶ä»–åº”ç”¨ç¨‹åº</li></ul><p>System Broadcast: é€šè¿‡ç›‘å¬ System Broadcast è·å¾—å„ç§å„æ ·çš„ System Information(ç³»ç»Ÿå®Œæˆå¼€æœº\ç”µæ± ç”µé‡å˜åŒ–\ç³»ç»Ÿäº‹ä»¶å˜åŒ–)</p><h1 id="broadcast-type"><a class="markdownIt-Anchor" href="#broadcast-type"></a> Broadcast Type</h1><p>Normal Broadcast, æ ‡å‡†å¹¿æ’­, å¼‚æ­¥æ‰§è¡Œçš„å¹¿æ’­</p><ul><li>å¹¿æ’­å‘å‡ºä¹‹åï¼Œæ‰€æœ‰çš„ BroadcastReceiver å‡ ä¹ä¼šåœ¨åŒä¸€æ—¶åˆ»æ”¶åˆ°è¿™æ¡å¹¿æ’­æ¶ˆæ¯ï¼Œå› æ­¤å®ƒä»¬ä¹‹é—´æ²¡æœ‰ä»»ä½•å…ˆåé¡ºåºå¯è¨€</li><li>è¿™ç§å¹¿æ’­çš„æ•ˆç‡ä¼šæ¯”è¾ƒé«˜ï¼Œä½†åŒæ—¶ä¹Ÿæ„å‘³ç€å®ƒæ˜¯æ— æ³•è¢«æˆªæ–­çš„</li></ul><p>Ordered Broadcast, æœ‰åºå¹¿æ’­, åŒæ­¥æ‰§è¡Œçš„å¹¿æ’­</p><ul><li>å¹¿æ’­å‘å‡ºä¹‹åï¼ŒåŒä¸€æ—¶åˆ»åªä¼šæœ‰ä¸€ä¸ª BroadcastReceiver èƒ½å¤Ÿæ”¶åˆ°è¿™æ¡å¹¿æ’­æ¶ˆæ¯ï¼Œå½“è¿™ä¸ª BroadcastReceiver ä¸­çš„é€»è¾‘æ‰§è¡Œå®Œæ¯•åï¼Œå¹¿æ’­æ‰ä¼šç»§ç»­ä¼ é€’</li><li>ä¼˜å…ˆçº§é«˜çš„ BroadcastReceiver å°±å¯ä»¥å…ˆæ”¶åˆ°å¹¿æ’­æ¶ˆæ¯ï¼Œå¹¶ä¸”å‰é¢çš„ BroadcastReceiver è¿˜å¯ä»¥æˆªæ–­æ­£åœ¨ä¼ é€’çš„å¹¿æ’­</li></ul><h1 id="registration-of-broadcastreceiver"><a class="markdownIt-Anchor" href="#registration-of-broadcastreceiver"></a> Registration of BroadcastReceiver</h1><p>ç³»ç»Ÿä¸­çš„å¹¿æ’­åˆ—è¡¨: <code>D:\experiments\AndroidSdk\platforms\android-32\data\broadcast_actions.txt</code></p><h2 id="åŠ¨æ€æ³¨å†Œ"><a class="markdownIt-Anchor" href="#åŠ¨æ€æ³¨å†Œ"></a> åŠ¨æ€æ³¨å†Œ</h2><p>åœ¨ä»£ç æ–‡ä»¶ä¸­æ³¨å†Œï¼šæ–°å»ºä¸€ä¸ªç±»ï¼Œè®©å®ƒç»§æ‰¿è‡ª BroadcastReceiverï¼Œå¹¶é‡å†™çˆ¶ç±»çš„ onReceive() æ–¹æ³•. å½“æœ‰å¹¿æ’­åˆ°æ¥æ—¶, onReceive() æ–¹æ³•å°±ä¼šå¾—åˆ°æ‰§è¡Œ</p><p>ä¼˜åŠ¿: è‡ªç”±çš„æ§åˆ¶å¹¿æ’­çš„æ³¨å†Œä¸æ³¨é”€åŠ£åŠ¿: ç¨‹åºå¯åŠ¨åæ‰èƒ½æ¥æ”¶å¹¿æ’­</p><ul><li>é€šè¿‡å†…éƒ¨ç±»çš„å½¢å¼åŠ¨æ€æ³¨å†Œ TimeChangeReceiver()</li></ul><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">inner</span> <span class="token keyword">class</span> TimeChangeReceiver<span class="token operator">:</span> <span class="token function">BroadcastReceiver</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">onReceive</span><span class="token punctuation">(</span>context<span class="token operator">:</span> Context<span class="token operator">?</span><span class="token punctuation">,</span> intent<span class="token operator">:</span> Intent<span class="token operator">?</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">val</span> mainLayout <span class="token operator">=</span> findViewById<span class="token operator">&lt;</span>LinearLayout<span class="token operator">></span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>main_layout<span class="token punctuation">)</span>        <span class="token keyword">val</span> ranColor <span class="token operator">=</span> Color<span class="token punctuation">.</span><span class="token function">argb</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">0</span> until <span class="token number">256</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">0</span> until <span class="token number">256</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">0</span> until <span class="token number">256</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        mainLayout<span class="token punctuation">.</span><span class="token function">setBackgroundColor</span><span class="token punctuation">(</span>ranColor<span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>åœ¨ Activity çš„ onCreate ç”Ÿå‘½å‘¨æœŸä¸­å®ŒæˆåŠ¨æ€æ³¨å†Œçš„ç»‘å®š</li></ul><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">lateinit</span> <span class="token keyword">var</span> timeChangeReceiver<span class="token operator">:</span> TimeChangeReceiver<span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">onCreate</span><span class="token punctuation">(</span>savedInstanceState<span class="token operator">:</span> Bundle<span class="token operator">?</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">val</span> intentFilter <span class="token operator">=</span> <span class="token function">IntentFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    intentFilter<span class="token punctuation">.</span><span class="token function">addAction</span><span class="token punctuation">(</span><span class="token string">"android.intent.action.TIME_TICK"</span><span class="token punctuation">)</span>    timeChangeReceiver <span class="token operator">=</span> <span class="token function">TimeChangeReceiver</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token function">registerReceiver</span><span class="token punctuation">(</span>timeChangeReceiver<span class="token punctuation">,</span> intentFilter<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>åœ¨ Activity çš„ onDestroy ç”Ÿå‘½å‘¨æœŸä¸­å®ŒæˆåŠ¨æ€æ³¨å†Œçš„æ³¨é”€</li></ul><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">onDestroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onDestroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token function">unregisterReceiver</span><span class="token punctuation">(</span>timeChangeReceiver<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h2 id="é™æ€æ³¨å†Œ"><a class="markdownIt-Anchor" href="#é™æ€æ³¨å†Œ"></a> é™æ€æ³¨å†Œ</h2><p>èƒ½å¤Ÿå®ç°åº”ç”¨å¯åŠ¨å‰çš„å¹¿æ’­ç›‘å¬</p><blockquote><p>ç”±äºæ¶æ„åº”ç”¨ç¨‹åºåˆ©ç”¨é™æ€æ³¨å†Œæœºåˆ¶åœ¨ç¨‹åºæœªå¯åŠ¨çš„æƒ…å†µä¸‹ç›‘å¬ç³»ç»Ÿå¹¿æ’­ï¼Œä»è€Œä½¿ä»»ä½•åº”ç”¨éƒ½å¯ä»¥é¢‘ç¹åœ°ä»åå°è¢«å”¤é†’ï¼Œä¸¥é‡å½±å“äº†ç”¨æˆ·æ‰‹æœºçš„ç”µé‡å’Œæ€§èƒ½ï¼Œå› æ­¤ Android ç³»ç»Ÿå‡ ä¹æ¯ä¸ªç‰ˆæœ¬éƒ½åœ¨å‰Šå‡é™æ€æ³¨å†Œ BroadcastReceiver çš„åŠŸèƒ½åœ¨ Android 8.0 ä¹‹åï¼Œæ‰€æœ‰éšå¼å¹¿æ’­éƒ½ä¸å…è®¸ä½¿ç”¨é™æ€æ³¨å†Œçš„æ–¹å¼æ¥æ¥æ”¶äº†ï¼Œä½†æ˜¯<a target="_blank" rel="noopener" href="https://developer.android.com/guide/components/broadcast-exceptions">å°‘æ•°ç‰¹æ®Šçš„ç³»ç»Ÿå¹¿æ’­</a>ç›®å‰ä»ç„¶å…è®¸ä½¿ç”¨é™æ€æ³¨å†Œçš„æ–¹å¼æ¥æ¥æ”¶éšå¼å¹¿æ’­æŒ‡æ²¡æœ‰å…·ä½“æŒ‡å®šå‘é€ç»™å“ªä¸ªåº”ç”¨ç¨‹åºçš„å¹¿æ’­ï¼Œå¤§å¤šæ•°ç³»ç»Ÿå¹¿æ’­å±äºéšå¼å¹¿æ’­</p></blockquote><ol><li>å»ºç«‹ BroadcastReceive å­ç±», é‡å†™ onReceive æ–¹æ³•</li></ol><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">class</span> BootCompleteReceiver <span class="token operator">:</span> <span class="token function">BroadcastReceiver</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">onReceive</span><span class="token punctuation">(</span>context<span class="token operator">:</span> Context<span class="token punctuation">,</span> intent<span class="token operator">:</span> Intent<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">// This method is called when the BroadcastReceiver is receiving an Intent broadcast.</span>        Toast<span class="token punctuation">.</span><span class="token function">makeText</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> <span class="token string">"JCAPP INFOS: Boot Complete"</span><span class="token punctuation">,</span> Toast<span class="token punctuation">.</span>LENGTH_SHORT<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="2"><li>åœ¨ AndroidManifest.xml ä¸­å¯¹ receiver è¿›è¡Œé™æ€æ³¨å†Œï¼šExported å±æ€§è¡¨ç¤ºæ˜¯å¦å…è®¸ BroadcastReceiver æ¥æ”¶æœ¬ç¨‹åºä»¥å¤–çš„å¹¿æ’­ï¼›Enabled å±æ€§è¡¨ç¤ºæ˜¯å¦å¯ç”¨è¿™ä¸ª BroadcastReceiver</li></ol><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>receiver</span>    <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>.BootCompleteReceiver<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">android:</span>enabled</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">android:</span>exported</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>intent-filter</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>action</span> <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>android.intent.action.BOOT_COMPLETED<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>intent-filter</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>receiver</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="customized-broadcast"><a class="markdownIt-Anchor" href="#customized-broadcast"></a> Customized Broadcast</h1><h2 id="normal-broadcast"><a class="markdownIt-Anchor" href="#normal-broadcast"></a> Normal Broadcast</h2><p>æ ‡å‡†å¹¿æ’­, å¼‚æ­¥æ‰§è¡Œçš„å¹¿æ’­, å‘é€åæ‰€æœ‰æ³¨å†Œçš„ Receiver éƒ½ä¼šåœ¨åŒä¸€æ—¶é—´è¿›è¡Œå¤„ç†</p><ol><li>ç¼–å†™è‡ªå®šä¹‰å¹¿æ’­ BroadcastReceiver ç±», å®ç°å¹¿æ’­å“åº”å¤„ç†</li></ol><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">class</span> JCNormalBroadcast <span class="token operator">:</span> <span class="token function">BroadcastReceiver</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">onReceive</span><span class="token punctuation">(</span>context<span class="token operator">:</span> Context<span class="token punctuation">,</span> intent<span class="token operator">:</span> Intent<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">// This method is called when the BroadcastReceiver is receiving an Intent broadcast.</span>        Toast<span class="token punctuation">.</span><span class="token function">makeText</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> <span class="token string">"received in JCNormalBroadcast"</span><span class="token punctuation">,</span> Toast<span class="token punctuation">.</span>LENGTH_SHORT<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="2"><li>åœ¨ AndroidManifest ä¸­å®ç°é™æ€æ³¨å†Œ</li></ol><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>receiver</span>    <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>.JCNormalBroadcast<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">android:</span>enabled</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">android:</span>exported</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>intent-filter</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>action</span> <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.example.a09broadcasttest.JC_BROADCAST<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>intent-filter</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>receiver</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="3"><li>é€šè¿‡æŒ‰é’®ç‚¹å‡»å‘é€è‡ªå®šä¹‰å¹¿æ’­</li></ol><blockquote><p>8.0 ä¹‹åï¼Œé™æ€æ³¨å†Œçš„ BroadcastReceiver æ˜¯æ— æ³•æ¥æ”¶éšå¼å¹¿æ’­çš„è€Œé»˜è®¤æƒ…å†µä¸‹æˆ‘ä»¬å‘å‡ºçš„è‡ªå®šä¹‰å¹¿æ’­éƒ½æ˜¯éšå¼å¹¿æ’­å› æ­¤è¿™é‡Œä¸€å®šè¦è°ƒç”¨ setPackage() æ–¹æ³•ï¼ŒæŒ‡å®šè¿™æ¡å¹¿æ’­æ˜¯å‘é€ç»™å“ªä¸ªåº”ç”¨ç¨‹åºçš„ï¼Œä»è€Œè®©å®ƒå˜æˆä¸€æ¡æ˜¾å¼å¹¿æ’­å¦åˆ™é™æ€æ³¨å†Œçš„ BroadcastReceiver å°†æ— æ³•æ¥æ”¶åˆ°è¿™æ¡å¹¿æ’­</p></blockquote><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">onClick</span><span class="token punctuation">(</span>view<span class="token operator">:</span> View<span class="token operator">?</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">when</span><span class="token punctuation">(</span>view<span class="token operator">?</span><span class="token punctuation">.</span>id<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>main_jc_nbc <span class="token operator">-></span> <span class="token punctuation">&#123;</span>            <span class="token keyword">val</span> intent <span class="token operator">=</span> <span class="token function">Intent</span><span class="token punctuation">(</span><span class="token string">"com.example.a09broadcasttest.JC_BROADCAST"</span><span class="token punctuation">)</span>            intent<span class="token punctuation">.</span><span class="token function">setPackage</span><span class="token punctuation">(</span>packageName<span class="token punctuation">)</span>            <span class="token function">sendBroadcast</span><span class="token punctuation">(</span>intent<span class="token punctuation">)</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="ordered-broadcast"><a class="markdownIt-Anchor" href="#ordered-broadcast"></a> Ordered Broadcast</h2><p>æœ‰åºå¹¿æ’­, åŒæ­¥æ‰§è¡Œçš„å¹¿æ’­, å‘é€åå„ä¸ªç»‘å®šçš„ BroadcastReceiver ä¼šæŒ‰ç…§ä¼˜å…ˆçº§å…ˆåå¤„ç†</p><ol><li>ç¼–å†™æœ‰åºå¹¿æ’­çš„ BroadReceiver å¤„ç†ç±»ï¼š<code>abortBroadcast()</code> å¯ä»¥é˜¶æ®µæœ‰åºå¹¿æ’­çš„å‘ä¸‹åºŠåº•</li></ol><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">class</span> JCOrderedBroadcastReceiver <span class="token operator">:</span> <span class="token function">BroadcastReceiver</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">onReceive</span><span class="token punctuation">(</span>context<span class="token operator">:</span> Context<span class="token punctuation">,</span> intent<span class="token operator">:</span> Intent<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">val</span> toast <span class="token operator">=</span> Toast<span class="token punctuation">.</span><span class="token function">makeText</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> <span class="token string">"received in JCOrderedBroadcastReceiver"</span><span class="token punctuation">,</span> Toast<span class="token punctuation">.</span>LENGTH_SHORT<span class="token punctuation">)</span>        toast<span class="token punctuation">.</span><span class="token function">setGravity</span><span class="token punctuation">(</span>Gravity<span class="token punctuation">.</span>TOP<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>        toast<span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token function">abortBroadcast</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="2"><li>åœ¨ AndroidManifest ä¸­å®ç°é™æ€æ³¨å†Œï¼š<code>&lt;intent-filter android:priority=&quot;100&quot;&gt;</code> è®¾ç½®æœ‰åºå¹¿æ’­å“åº”çš„ä¼˜å…ˆçº§</li></ol><p>é»˜è®¤ä¼˜å…ˆçº§ä¸º 0, ä¼˜å…ˆçº§è®¾å®šèŒƒå›´ä¸º <code>-1000 ~ 10000</code></p><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>receiver</span>    <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>.JCOrderedBroadcastReceiver<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">android:</span>enabled</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">android:</span>exported</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>intent-filter</span> <span class="token attr-name"><span class="token namespace">android:</span>priority</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>100<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>action</span> <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.example.a09broadcasttest.JC_BROADCAST<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>intent-filter</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>receiver</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="3"><li>é€šè¿‡æŒ‰é’®ç‚¹å‡»å‘é€ Ordered Broadcast</li></ol><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin">R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>main_jc_obc <span class="token operator">-></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">val</span> intent <span class="token operator">=</span> <span class="token function">Intent</span><span class="token punctuation">(</span><span class="token string">"com.example.a09broadcasttest.JC_BROADCAST"</span><span class="token punctuation">)</span>    intent<span class="token punctuation">.</span><span class="token function">setPackage</span><span class="token punctuation">(</span>packageName<span class="token punctuation">)</span>    <span class="token function">sendOrderedBroadcast</span><span class="token punctuation">(</span>intent<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token comment">// Ordered Broadcast</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="bestpractice"><a class="markdownIt-Anchor" href="#bestpractice"></a> BestPractice</h1><p>ç™»é™†ä¸å¼ºåˆ¶ä¸‹çº¿åŠŸèƒ½</p><ol start="0"><li>æ¶‰åŠåˆ°ä¸‹çº¿åŠŸèƒ½, å› æ­¤ä½¿ç”¨ ActivityCollector ä¸ BaseActivity ç®¡ç†æ‰€æœ‰ Activity</li></ol><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token comment">// å•ä¾‹ç±»</span><span class="token keyword">object</span> ActivityCollector <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token keyword">val</span> activities <span class="token operator">=</span> ArrayList<span class="token operator">&lt;</span>Activity<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">fun</span> <span class="token function">addActivity</span><span class="token punctuation">(</span>activity<span class="token operator">:</span> Activity<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        activities<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>activity<span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">fun</span> <span class="token function">removeActivity</span><span class="token punctuation">(</span>activity<span class="token operator">:</span> Activity<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        activities<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>activity<span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">fun</span> <span class="token function">finishAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span>activity <span class="token keyword">in</span> activities<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>activity<span class="token punctuation">.</span>isFinishing<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                activity<span class="token punctuation">.</span><span class="token function">finish</span><span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>        activities<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token comment">// å¯è¢«å…¶å®ƒ Activity ç»§æ‰¿</span><span class="token keyword">open</span> <span class="token keyword">class</span> BaseActivity<span class="token operator">:</span> <span class="token function">AppCompatActivity</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">lateinit</span> <span class="token keyword">var</span> receiver<span class="token operator">:</span> ForceOfflineReceiver    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">onCreate</span><span class="token punctuation">(</span>savedInstanceState<span class="token operator">:</span> Bundle<span class="token operator">?</span><span class="token punctuation">,</span> persistentState<span class="token operator">:</span> PersistableBundle<span class="token operator">?</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onCreate</span><span class="token punctuation">(</span>savedInstanceState<span class="token punctuation">,</span> persistentState<span class="token punctuation">)</span>        ActivityCollector<span class="token punctuation">.</span><span class="token function">addActivity</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">onDestroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onDestroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        ActivityCollector<span class="token punctuation">.</span><span class="token function">removeActivity</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="2"><li>ç¼–å†™ LoginActivity ç•Œé¢</li></ol><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">class</span> LoginActivity <span class="token operator">:</span> <span class="token function">BaseActivity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> View<span class="token punctuation">.</span><span class="token function">OnClickListener</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">lateinit</span> <span class="token keyword">var</span> accountEdit<span class="token operator">:</span> EditText    <span class="token keyword">lateinit</span> <span class="token keyword">var</span> passwordEdit<span class="token operator">:</span> EditText    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">onCreate</span><span class="token punctuation">(</span>savedInstanceState<span class="token operator">:</span> Bundle<span class="token operator">?</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onCreate</span><span class="token punctuation">(</span>savedInstanceState<span class="token punctuation">)</span>        <span class="token function">setContentView</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>layout<span class="token punctuation">.</span>activity_login<span class="token punctuation">)</span>        <span class="token keyword">val</span> button_login <span class="token operator">=</span> findViewById<span class="token operator">&lt;</span>Button<span class="token operator">></span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>login<span class="token punctuation">)</span>        button_login<span class="token punctuation">.</span><span class="token function">setOnClickListener</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>        accountEdit <span class="token operator">=</span> <span class="token function">findViewById</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>accountEdit<span class="token punctuation">)</span>        passwordEdit <span class="token operator">=</span> <span class="token function">findViewById</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>passwordEdit<span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">onClick</span><span class="token punctuation">(</span>v<span class="token operator">:</span> View<span class="token operator">?</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">when</span> <span class="token punctuation">(</span>v<span class="token operator">?</span><span class="token punctuation">.</span>id<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>login <span class="token operator">-></span> <span class="token punctuation">&#123;</span>                <span class="token keyword">val</span> account <span class="token operator">=</span> accountEdit<span class="token punctuation">.</span>text<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                <span class="token keyword">val</span> password <span class="token operator">=</span> passwordEdit<span class="token punctuation">.</span>text<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>account <span class="token operator">==</span> <span class="token string">"admin"</span> <span class="token operator">&amp;&amp;</span> password <span class="token operator">==</span> <span class="token string">"123456"</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    <span class="token keyword">val</span> intent <span class="token operator">=</span> <span class="token function">Intent</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> MainActivity<span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">.</span>java<span class="token punctuation">)</span>                    <span class="token function">startActivity</span><span class="token punctuation">(</span>intent<span class="token punctuation">)</span>                    <span class="token function">finish</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>                    Toast<span class="token punctuation">.</span><span class="token function">makeText</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token string">"Account or Password is invalid"</span><span class="token punctuation">,</span> Toast<span class="token punctuation">.</span>LENGTH_SHORT<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="3"><li>åœ¨ç™»é™†åçš„é¡µé¢ä¸­è®¾ç½®è§¦å‘å¼ºåˆ¶ä¸‹çº¿çš„å¹¿æ’­ Trigger</li></ol><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">val</span> button_force_offline <span class="token operator">=</span> findViewById<span class="token operator">&lt;</span>Button<span class="token operator">></span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>forceOffline<span class="token punctuation">)</span>button_force_offline<span class="token punctuation">.</span><span class="token function">setOnClickListener</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">val</span> intent <span class="token operator">=</span> <span class="token function">Intent</span><span class="token punctuation">(</span><span class="token string">"com.example.a10broadcastpractice.FORCE_OFFLINE"</span><span class="token punctuation">)</span>    <span class="token function">sendBroadcast</span><span class="token punctuation">(</span>intent<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="4"><li>éœ€è¦ä½¿å¾—å½“å‰å¤„äºæ ˆé¡¶çš„ Activity èƒ½å¤Ÿæ¥æ”¶åˆ°å¹¿æ’­å¹¶å¤„ç†, å› æ­¤åœ¨ BaseActivity ä¸­åˆ©ç”¨ç”Ÿå‘½å‘¨æœŸå‡½æ•° <code>onResume()</code> ä¸ <code>onPause()</code> å®ç° Receiver çš„åŠ¨æ€æ³¨å†Œä¸æ’¤é”€</li></ol><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token comment">// éœ€è¦ä¿è¯åªæœ‰å¤„äºæ ˆé¡¶çš„ Activity æ‰èƒ½æ¥æ”¶åˆ°è¿™æ¡å¼ºåˆ¶ä¸‹çº¿å¹¿æ’­</span><span class="token comment">// éæ ˆé¡¶çš„ Activity ä¸åº”è¯¥ä¹Ÿæ²¡å¿…è¦æ¥æ”¶è¿™æ¡å¹¿æ’­ï¼Œæ‰€ä»¥å†™åœ¨ onResume() å’Œ onPause() æ–¹æ³•é‡Œå°±å¯ä»¥å¾ˆå¥½åœ°è§£å†³è¿™ä¸ªé—®é¢˜</span><span class="token comment">// å½“ä¸€ä¸ª Activity å¤±å»æ ˆé¡¶ä½ç½®æ—¶å°±ä¼šè‡ªåŠ¨å–æ¶ˆ BroadcastReceiver çš„æ³¨å†Œ</span><span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">onResume</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onResume</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">val</span> intentFilter <span class="token operator">=</span> <span class="token function">IntentFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    intentFilter<span class="token punctuation">.</span><span class="token function">addAction</span><span class="token punctuation">(</span><span class="token string">"com.example.a10broadcastpractice.FORCE_OFFLINE"</span><span class="token punctuation">)</span>    receiver <span class="token operator">=</span> <span class="token function">ForceOfflineReceiver</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token function">registerReceiver</span><span class="token punctuation">(</span>receiver<span class="token punctuation">,</span> intentFilter<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">onPause</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onPause</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token function">unregisterReceiver</span><span class="token punctuation">(</span>receiver<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token keyword">inner</span> <span class="token keyword">class</span> ForceOfflineReceiver<span class="token operator">:</span> <span class="token function">BroadcastReceiver</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">onReceive</span><span class="token punctuation">(</span>context<span class="token operator">:</span> Context<span class="token punctuation">,</span> intent<span class="token operator">:</span> Intent<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        AlertDialog<span class="token punctuation">.</span><span class="token function">Builder</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">apply</span> <span class="token punctuation">&#123;</span>            <span class="token function">setTitle</span><span class="token punctuation">(</span><span class="token string">"Warning"</span><span class="token punctuation">)</span>            <span class="token function">setMessage</span><span class="token punctuation">(</span><span class="token string">"You are forced to be offline. Please try to login again."</span><span class="token punctuation">)</span>            <span class="token function">setCancelable</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>            <span class="token function">setPositiveButton</span><span class="token punctuation">(</span><span class="token string">"OK"</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> _<span class="token punctuation">,</span> _ <span class="token operator">-></span>                ActivityCollector<span class="token punctuation">.</span><span class="token function">finishAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                <span class="token keyword">val</span> intent <span class="token operator">=</span> <span class="token function">Intent</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> LoginActivity<span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">.</span>java<span class="token punctuation">)</span>                context<span class="token punctuation">.</span><span class="token function">startActivity</span><span class="token punctuation">(</span>intent<span class="token punctuation">)</span>            <span class="token punctuation">&#125;</span>            <span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> Android Dev. </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Android </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>05-Fragment</title>
      <link href="/Coming-blog/2022/08/18/05-fragment/"/>
      <url>/Coming-blog/2022/08/18/05-fragment/</url>
      
        <content type="html"><![CDATA[<h1 id="fragment"><a class="markdownIt-Anchor" href="#fragment"></a> Fragment</h1><p>ä¸€ç§å¯ä»¥åµŒå…¥åœ¨ Activity å½“ä¸­çš„ UI ç‰‡æ®µï¼Œèƒ½è®©ç¨‹åºæ›´åŠ åˆç†å’Œå……åˆ†åœ°åˆ©ç”¨å¤§å±å¹•çš„ç©ºé—´ï¼Œå› è€Œåœ¨å¹³æ¿ä¸Šåº”ç”¨å¾—éå¸¸å¹¿æ³›</p><ul><li>ä¸ Activity ç±»ä¼¼, èƒ½åŒ…å«å¸ƒå±€, æ‹¥æœ‰è‡ªå·±çš„å£°æ˜å‘¨æœŸ</li><li>ä½† Activity ä¸­å¯ä»¥åŒ…å«å¤šä¸ª Fragment å®ç°åˆ†é¡µæ•ˆæœ</li></ul><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/202208072008439.png" alt="" /></p><h2 id="quick-start"><a class="markdownIt-Anchor" href="#quick-start"></a> Quick Start</h2><ol><li>ä¸º Fragment è®¾ç½®å¥½å¸ƒå±€</li></ol><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="utf-8"?></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>LinearLayout</span> <span class="token attr-name"><span class="token namespace">xmlns:</span>android</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://schemas.android.com/apk/res/android<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">android:</span>orientation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>vertical<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Button</span>        <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@+id/left_button<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>layout_gravity</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>center_horizontal<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>text</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Button<span class="token punctuation">"</span></span>        <span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>LinearLayout</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="2"><li>æ–°å»º Fragment ç±», ä½¿å…¶ç»§æ‰¿ <code>androidx.fragment.app.Fragment</code> å®ç°å¯¹ Fragment å¸ƒå±€çš„åŠ è½½</li></ol><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">class</span> LeftFragment<span class="token operator">:</span> <span class="token function">Fragment</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">onCreateView</span><span class="token punctuation">(</span>        inflater<span class="token operator">:</span> LayoutInflater<span class="token punctuation">,</span>        container<span class="token operator">:</span> ViewGroup<span class="token operator">?</span><span class="token punctuation">,</span>        savedInstanceState<span class="token operator">:</span> Bundle<span class="token operator">?</span>    <span class="token punctuation">)</span><span class="token operator">:</span> View<span class="token operator">?</span> <span class="token punctuation">&#123;</span>        <span class="token comment">// é€šè¿‡ LayoutInflater çš„ inflate() æ–¹æ³•å°†åˆšæ‰å®šä¹‰çš„ left_fragment å¸ƒå±€åŠ¨æ€åŠ è½½è¿›æ¥</span>        <span class="token keyword">return</span> inflater<span class="token punctuation">.</span><span class="token function">inflate</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>layout<span class="token punctuation">.</span>left_fragment<span class="token punctuation">,</span> container<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="3"><li>åœ¨ä¸» Activity ä¸­çš„å¸ƒå±€ä¸­å¼•å…¥ Fragment</li></ol><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token operator">&lt;</span>LinearLayout xmlns<span class="token operator">:</span>android<span class="token operator">=</span><span class="token string">"http://schemas.android.com/apk/res/android"</span>    android<span class="token operator">:</span>orientation<span class="token operator">=</span><span class="token string">"horizontal"</span>    android<span class="token operator">:</span>layout_width<span class="token operator">=</span><span class="token string">"match_parent"</span>    android<span class="token operator">:</span>layout_height<span class="token operator">=</span><span class="token string">"match_parent"</span><span class="token operator">></span>    <span class="token operator">&lt;</span>fragment        android<span class="token operator">:</span>id<span class="token operator">=</span><span class="token string">"@+id/leftFrag"</span>        android<span class="token operator">:</span>name<span class="token operator">=</span><span class="token string">"com.example.a07fragment_1.LeftFragment"</span>        android<span class="token operator">:</span>layout_width<span class="token operator">=</span><span class="token string">"0dp"</span>        android<span class="token operator">:</span>layout_height<span class="token operator">=</span><span class="token string">"match_parent"</span>        android<span class="token operator">:</span>layout_weight<span class="token operator">=</span><span class="token string">"1"</span> <span class="token operator">/</span><span class="token operator">></span>    <span class="token operator">&lt;</span>fragment        android<span class="token operator">:</span>id<span class="token operator">=</span><span class="token string">"@+id/rightFrag"</span>        android<span class="token operator">:</span>name<span class="token operator">=</span><span class="token string">"com.example.a07fragment_1.RightFragment"</span>        android<span class="token operator">:</span>layout_width<span class="token operator">=</span><span class="token string">"0dp"</span>        android<span class="token operator">:</span>layout_height<span class="token operator">=</span><span class="token string">"match_parent"</span>        android<span class="token operator">:</span>layout_weight<span class="token operator">=</span><span class="token string">"1"</span> <span class="token operator">/</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>LinearLayout<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="åŠ¨æ€æ·»åŠ -fragment"><a class="markdownIt-Anchor" href="#åŠ¨æ€æ·»åŠ -fragment"></a> åŠ¨æ€æ·»åŠ  Fragment</h2><ol><li>åœ¨ä¸» Activity ä¸­ä¸ºåŠ¨æ€æ›¿æ¢çš„ Fragment ç•™æœ‰å¸ƒå±€</li></ol><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>FrameLayout</span>    <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0dp<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">android:</span>layout_weight</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@+id/rightLayout<span class="token punctuation">"</span></span>    <span class="token punctuation">/></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="2"><li>é€šè¿‡ç‚¹å‡»æˆ–å…¶ä»–äº‹ä»¶è§¦å‘ fragment çš„æ›¿æ¢åŠ è½½</li></ol><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token comment">// å°†å¾…æ·»åŠ  Fragment çš„å®ä¾‹ä½œä¸ºå‚æ•°ä¼ å…¥</span><span class="token keyword">private</span> <span class="token keyword">fun</span> <span class="token function">replaceFragment</span><span class="token punctuation">(</span>fragment<span class="token operator">:</span> Fragment<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// é€šè¿‡ getSupportFragmentManager() è·å– fragment æ“ä½œå¯¹è±¡</span>    <span class="token keyword">val</span> fragmentManager <span class="token operator">=</span> supportFragmentManager    <span class="token comment">// å¼€å¯ä¸€ä¸ªäº‹åŠ¡ï¼Œé€šè¿‡è°ƒç”¨ beginTransaction() æ–¹æ³•å¼€å¯</span>    <span class="token keyword">val</span> transaction <span class="token operator">=</span> fragmentManager<span class="token punctuation">.</span><span class="token function">beginTransaction</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token comment">// ä½¿ç”¨ replace()æ–¹æ³•å‘å®¹å™¨å†…æ›¿æ¢ Fragmentï¼Œéœ€è¦ä¼ å…¥å®¹å™¨çš„idå’Œå¾…æ·»åŠ çš„ Fragment å®ä¾‹</span>    transaction<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>rightLayout<span class="token punctuation">,</span> fragment<span class="token punctuation">)</span>    <span class="token comment">// æäº¤äº‹åŠ¡</span>    transaction<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// å¹¶è¡Œå¤„ç†</span>    <span class="token comment">// transaction.commitNow() // ç«‹å³æ‰§è¡Œï¼Œé¿å…å…¶å®ƒå¼•ç”¨å†²çª</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="å¸¦æœ‰å‚æ•°çš„-fragment"><a class="markdownIt-Anchor" href="#å¸¦æœ‰å‚æ•°çš„-fragment"></a> å¸¦æœ‰å‚æ•°çš„ Fragment</h2><p>Fragment æ˜¾ç¤ºçš„å†…å®¹å¯èƒ½éœ€è¦å…¶çˆ¶ Activity å‘ŠçŸ¥, å› æ­¤åˆå§‹åŒ–æ—¶éœ€è¦é…ç½®ç›¸åº”çš„å‚æ•°</p><ol><li>xml ä¸­ç”¨ FrameLayout ä¸º Fragment å ä½</li></ol><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>FrameLayout</span>    <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@+id/toolbar_fragment<span class="token punctuation">"</span></span>    <span class="token punctuation">/></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="2"><li>Activity ä¸­é€‰æ‹©é€‚å½“çš„æ—¶æœº<a href="#%E5%8A%A8%E6%80%81%E6%B7%BB%E5%8A%A0-fragment">åŠ¨æ€åŠ è½½</a>è¯¥ Fragment</li></ol><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">val</span> toolbarFragment <span class="token operator">=</span> <span class="token function">ToolbarFragment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">// æ ‡é¢˜æ å·¦å³ä¸¤ä¾§çš„å›¾æ ‡ä»¥åŠä¸­é—´çš„æ ‡é¢˜å</span><span class="token keyword">val</span> bundle <span class="token operator">=</span> <span class="token function">Bundle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">apply</span> <span class="token punctuation">&#123;</span>    <span class="token function">putString</span><span class="token punctuation">(</span><span class="token string">"toolbarName"</span><span class="token punctuation">,</span> toolbarNmae<span class="token punctuation">)</span>    toolbarLeft<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">let</span> <span class="token punctuation">&#123;</span> <span class="token function">putInt</span><span class="token punctuation">(</span><span class="token string">"toolbarLeft"</span><span class="token punctuation">,</span> it<span class="token punctuation">)</span> <span class="token punctuation">&#125;</span>    toolbarRight<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">let</span> <span class="token punctuation">&#123;</span> <span class="token function">putInt</span><span class="token punctuation">(</span><span class="token string">"toolbarRight"</span><span class="token punctuation">,</span> it<span class="token punctuation">)</span> <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>toolbarFragment<span class="token punctuation">.</span>arguments <span class="token operator">=</span> bundle<span class="token keyword">val</span> fragmentManager <span class="token operator">=</span> supportFragmentManager<span class="token keyword">val</span> transaction <span class="token operator">=</span> fragmentManager<span class="token punctuation">.</span><span class="token function">beginTransaction</span><span class="token punctuation">(</span><span class="token punctuation">)</span>transaction<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>toolbar_fragment<span class="token punctuation">,</span> toolbarFragment<span class="token punctuation">)</span>transaction<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">return</span> toolbarFragment<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="3"><li>Fragment ä¸­åœ¨ onCreateView ä¸­æ¥æ”¶å‚æ•°è¿›è¡Œå¤„ç†</li></ol><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">onCreateView</span><span class="token punctuation">(</span>inflater<span class="token operator">:</span> LayoutInflater<span class="token punctuation">,</span> container<span class="token operator">:</span> ViewGroup<span class="token operator">?</span><span class="token punctuation">,</span> savedInstanceState<span class="token operator">:</span> Bundle<span class="token operator">?</span><span class="token punctuation">)</span><span class="token operator">:</span> View <span class="token punctuation">&#123;</span>    <span class="token keyword">val</span> view<span class="token operator">:</span> View <span class="token operator">=</span> inflater<span class="token punctuation">.</span><span class="token function">inflate</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>layout<span class="token punctuation">.</span>toolbar_fragment<span class="token punctuation">,</span> container<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span>    <span class="token comment">// çœç•¥ findViewByID ...</span>    <span class="token comment">// Bundle.getArguments()</span>    toolbarName<span class="token punctuation">.</span>text <span class="token operator">=</span> arguments<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">"toolbarName"</span><span class="token punctuation">)</span>     <span class="token comment">// ....</span>    <span class="token keyword">return</span> view<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="ä¸ä¸»-activity-çš„äº¤äº’"><a class="markdownIt-Anchor" href="#ä¸ä¸»-activity-çš„äº¤äº’"></a> ä¸ä¸» Activity çš„äº¤äº’</h2><p>ç±»ä¼¼äºçˆ¶ç»„ä»¶ç®¡ç†å¤šä¸ªå­ç»„ä»¶, ä¸»è¦é€šè¿‡ <code>supportFragmentManager</code> å®ç°</p><ul><li>è·å– fragment View å®ä¾‹: <code>supportFragmentManager.findFragmentById(R.id.leftFrag) as LeftFragment</code></li><li>è·å–ä¸» Activity å®ä¾‹: <code>val mainActivity = getActivity() as MainActivity</code></li></ul><h1 id="ç”Ÿå‘½å‘¨æœŸ"><a class="markdownIt-Anchor" href="#ç”Ÿå‘½å‘¨æœŸ"></a> ç”Ÿå‘½å‘¨æœŸ</h1><p>ä¸ Activity ç±»ä¼¼, æ‹¥æœ‰å››ç§çŠ¶æ€: è¿è¡ŒçŠ¶æ€, æš‚åœçŠ¶æ€, åœæ­¢çŠ¶æ€, é”€æ¯çŠ¶æ€</p><ul><li>è¿è¡ŒçŠ¶æ€: å½“ä¸€ä¸ª Fragment æ‰€å…³è”çš„ Activity æ­£å¤„äºè¿è¡ŒçŠ¶æ€æ—¶ï¼Œè¯¥ Fragment ä¹Ÿå¤„äºè¿è¡ŒçŠ¶æ€</li><li>æš‚åœçŠ¶æ€: åŒä¸Š</li><li>åœæ­¢çŠ¶æ€: åŒä¸Š æˆ– é€šè¿‡ FragmentTransaction çš„ remove() replace() æ–¹æ³•å°† Fragment ä» Activity ä¸­ç§»é™¤å¹¶ä¸”è°ƒç”¨äº† addToBackStack() ä¹Ÿä¼šè¿›å…¥åœæ­¢çŠ¶æ€</li><li>é”€æ¯çŠ¶æ€: å½“ Activity è¢«é”€æ¯æ—¶ï¼Œä¸å®ƒç›¸å…³è”çš„ Fragment å°±ä¼šè¿›å…¥é”€æ¯çŠ¶æ€ æˆ–è€… åŒä¸Šä½†æ²¡æœ‰è°ƒç”¨ addToBackStack() å°†ä¼šè¿›å…¥é”€æ¯çŠ¶æ€</li></ul><p>ç‰¹æœ‰çš„çŠ¶æ€å›è°ƒæ–¹æ³•:</p><ul><li><code>onAttach()</code>: Fragment ä¸ Activity å»ºç«‹å…³è”</li><li><code>onCreateView()</code>: ä¸º Fragment åˆ›å»ºè§†å›¾(åŠ è½½å¸ƒå±€) æ—¶è°ƒç”¨</li><li><code>onActivityCreated()</code>: ç¡®ä¿ä¸ Fragment ç›¸å…³è”çš„ Activity å·²ç»åˆ›å»ºå®Œæ¯•æ—¶è°ƒç”¨</li><li><code>onDestroyView()</code>: å½“ä¸ Fragment å…³è”çš„è§†å›¾è¢«ç§»é™¤æ—¶</li><li><code>onDetach()</code>: å½“ Fragment å’Œ Activity è§£é™¤å…³è”æ—¶è°ƒç”¨</li></ul><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/202208092152914.png" alt="" /></p><h1 id="åŠ¨æ€å¸ƒå±€åŠ è½½æŠ€å·§"><a class="markdownIt-Anchor" href="#åŠ¨æ€å¸ƒå±€åŠ è½½æŠ€å·§"></a> åŠ¨æ€å¸ƒå±€åŠ è½½æŠ€å·§</h1><p>æ—¨åœ¨èƒ½æ›´çµæ´»çš„æ ¹æ®åˆ†è¾¨ç‡, å±å¹•å¤§å°ç­‰åœ¨è¿è¡Œæ—¶å†³å®šåŠ è½½å“ªä¸ªå¸ƒå±€</p><h2 id="é™å®šç¬¦-qualifier"><a class="markdownIt-Anchor" href="#é™å®šç¬¦-qualifier"></a> é™å®šç¬¦ qualifier</h2><p>å‡†å¤‡å¥½å•é¡µæ¨¡å¼çš„å¸ƒå±€ <code>layout/activity_main.xml</code> ä¸åŒé¡µæ¨¡å¼çš„å¸ƒå±€ <code>layout-large/activity_main.xml</code> è¿™é‡Œé¢çš„ large å°±æ˜¯ä¸€ä¸ªå†…ç½®çš„é™å®šç¬¦</p><p>å®é™…è¿‡ç¨‹ä¸­ä½ å¯ä»¥æŒ‰ç…§åŒé¡µæ¨¡å¼è¿›è¡Œå¸ƒå±€çš„ç»‘å®šåˆå§‹åŒ–, ä½†æ˜¯ä¸¤ç§å¸ƒå±€ä¼šæ ¹æ®è®¾å¤‡çš„å¤§å°è¿›è¡Œå±•ç¤º</p><p>å› æ­¤å¦‚æœæƒ³è¦ç¨‹åºæœ‰æ›´å¤šçš„é€‚é…, æˆ‘ä»¬å°±è¦ä¸ºå„ç±»é™å®šç¬¦ä½œå¥½å¸ƒå±€, å¸¸è§çš„é™å®šç¬¦æœ‰</p><p>å¤§å°ç±»é™å®šç¬¦</p><ul><li>small: å°å±å¹•</li><li>normal: ä¸­ç­‰å±å¹•</li><li>large: å¤§å±å¹•</li><li>xlarge: è¶…å¤§å¹³æ­¥</li><li>smallest-width qualifier: æœ€å°å®½åº¦é™å®šç¬¦, å…è®¸å¯¹å±å¹•çš„å®½åº¦æŒ‡å®šä¸€ä¸ªæœ€å°å€¼(å•ä½ dp) å±å¹•å®½åº¦å¤§äºè¿™ä¸ªå€¼çš„è®¾å¤‡å°±åŠ è½½è¿™ä¸ªå¸ƒå±€, å°äºè¿™ä¸ªå€¼çš„å°±åŠ è½½å¦ä¸€ä¸ªå¸ƒå±€, å…·ä½“åç¼€å¯ç¼©å†™ä¸º <code>-sw600dp</code></li></ul><p>åˆ†è¾¨ç‡ç±»é™å®šç¬¦:</p><ul><li>ldpi: 120 dpi ä»¥ä¸‹</li><li>mdpi: 120 - 160 dpi</li><li>hdpi: 160 - 240 dpi</li><li>xhdpi: 240 - 320 dpi</li><li>xxhdpi: 320 - 480 dpi</li></ul><p>æ–¹å‘:</p><ul><li>land: æ¨ªå±</li><li>port: ç«–å±</li></ul><h1 id="project"><a class="markdownIt-Anchor" href="#project"></a> Project</h1><p>ç¼–å†™å…¼å®¹æ‰‹æœºå’Œå¹³æ¿çš„åº”ç”¨ç¨‹åº</p><ol><li>MainActivity ä¸­æ ¹æ® layout è¿›è¡ŒåŠ¨æ€å¸ƒå±€åŠ è½½, é€‰æ‹©æ€§åŠ è½½å•é¡µå¸ƒå±€ <code>newsTitleFrag</code> å’ŒåŒé¡µå¸ƒå±€ <code>newsContentFrag</code></li><li>é’ˆå¯¹å•é¡µæ¨¡å¼è®¾ç½®å…¶ Fragment <code>NewsTitleFragment</code>: åœ¨å…¶ä¸­åŠ è½½æ ‡é¢˜åˆ—è¡¨æ‰€å¯¹åº”çš„å¸ƒå±€ <code>news_title_frag</code>; åœ¨ç”Ÿå‘½å‘¨æœŸ <code>onViewCreated</code> ä¸­åŠ è½½ <code>RecyclerView</code> çš„æ•°æ® <code>NewsAdapter</code>; <code>NewsAdapter</code> ä¸­é€šè¿‡ <code>ViewHolder</code> å®ä¾‹ä¸ºæ¯ä¸ªæ•°æ®é¡¹æ·»åŠ ç‚¹å‡»å¤„ç†äº‹ä»¶ <code>holder.itemView.setOnClickListener</code>, ç‚¹å‡»å¤„ç†äº‹ä»¶ä¸­é€šè¿‡åˆ¤æ–­å½“å‰ Activity ä¸­æ˜¯å¦æ˜¯åŒé¡µå¸ƒå±€æ¥é€‰æ‹©æ€§å®šä¹‰ç‚¹å‡»å¤„ç†æ–¹å¼ <code>isTwoPane = (activity?.findViewById&lt;View&gt;(R.id.newsContentLayout)) != null</code>:</li></ol><ul><li>å¦‚æœæ˜¯åŒé¡µå¸ƒå±€, åˆ™å®šä½åˆ°ç›®æ ‡ fragment å¯¹è±¡ååˆ·æ–°å†…å®¹å³å¯</li><li>å¦‚æœæ˜¯å•é¡µå¸ƒå±€, åˆ™éœ€è¦å¯åŠ¨ä¸€ä¸ªæ–°çš„ Activity ç”¨äºå±•ç¤ºç›®æ ‡æ–°é—»çš„è¯¦ç»†ä¿¡æ¯</li></ul><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin">holder<span class="token punctuation">.</span>itemView<span class="token punctuation">.</span><span class="token function">setOnClickListener</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">val</span> news <span class="token operator">=</span> newsList<span class="token punctuation">[</span>holder<span class="token punctuation">.</span>adapterPosition<span class="token punctuation">]</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>isTwoPane<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">val</span> fragment <span class="token operator">=</span> activity<span class="token operator">?</span><span class="token punctuation">.</span>supportFragmentManager<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">findFragmentById</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>newsContentFrag<span class="token punctuation">)</span> <span class="token keyword">as</span> NewsContentFragment        fragment<span class="token punctuation">.</span><span class="token function">refresh</span><span class="token punctuation">(</span>news<span class="token punctuation">.</span>title<span class="token punctuation">,</span> news<span class="token punctuation">.</span>contennt<span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>        NewsContentActivity<span class="token punctuation">.</span><span class="token function">actionStart</span><span class="token punctuation">(</span>parent<span class="token punctuation">.</span>context<span class="token punctuation">,</span> news<span class="token punctuation">.</span>title<span class="token punctuation">,</span> news<span class="token punctuation">.</span>contennt<span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="3"><li>é’ˆå¯¹åŒé¡µæ¨¡å¼è®¾ç½®å…¶ Fragment <code>NewsContentFragment</code>: åœ¨å…¶ä¸­åŠ è½½æ–°é—»å†…å®¹æ‰€å¯¹åº”çš„å¸ƒå±€, å¹¶å®šä¹‰å¸ƒå±€å†…å®¹åˆ·æ–°çš„æ¥å£å‡½æ•° <code>refresh</code> ä¾› MainActivity è°ƒç”¨</li></ol><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">fun</span> <span class="token function">refresh</span><span class="token punctuation">(</span>title<span class="token operator">:</span> String<span class="token punctuation">,</span> content<span class="token operator">:</span> String<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    contentLayout<span class="token punctuation">.</span>visibility <span class="token operator">=</span> View<span class="token punctuation">.</span>VISIBLE    newsTitle<span class="token punctuation">.</span>text <span class="token operator">=</span> title    newsContent<span class="token punctuation">.</span>text <span class="token operator">=</span> content<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol><li>é’ˆå¯¹å•é¡µæ¨¡å¼çš„ç‚¹å‡»äº‹ä»¶, å®šä¹‰æ–°çš„ Activity å±•ç¤ºæ–°é—»å†…å®¹ <code>NewsContentActivity</code> é€šè¿‡ <code>companion object</code> å®šä¹‰é™æ€æ–¹æ³• <code>actionStart</code> ä»¥å‘å¤–éƒ¨æä¾›å¿«é€Ÿå¯åŠ¨è¯¥ Activity çš„æ¥å£; å¯åŠ¨ååˆ™æ ¹æ®ä¼ é€’æ¥çš„æ•°æ®æ¸²æŸ“ç•Œé¢å³å¯</li></ol><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">fun</span> <span class="token function">actionStart</span><span class="token punctuation">(</span>context<span class="token operator">:</span> Context<span class="token punctuation">,</span> title<span class="token operator">:</span> String<span class="token punctuation">,</span> content<span class="token operator">:</span> String<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">val</span> intent <span class="token operator">=</span> <span class="token function">Intent</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> NewsContentActivity<span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">.</span>java<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">apply</span> <span class="token punctuation">&#123;</span>        <span class="token function">putExtra</span><span class="token punctuation">(</span><span class="token string">"news_title"</span><span class="token punctuation">,</span> title<span class="token punctuation">)</span>        <span class="token function">putExtra</span><span class="token punctuation">(</span><span class="token string">"news_content"</span><span class="token punctuation">,</span> content<span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>    context<span class="token punctuation">.</span><span class="token function">startActivity</span><span class="token punctuation">(</span>intent<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token keyword">val</span> title <span class="token operator">=</span> intent<span class="token punctuation">.</span><span class="token function">getStringExtra</span><span class="token punctuation">(</span><span class="token string">"news_title"</span><span class="token punctuation">)</span><span class="token keyword">val</span> content <span class="token operator">=</span> intent<span class="token punctuation">.</span><span class="token function">getStringExtra</span><span class="token punctuation">(</span><span class="token string">"news_content"</span><span class="token punctuation">)</span><span class="token keyword">if</span> <span class="token punctuation">(</span>title <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> content <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">val</span> fragment <span class="token operator">=</span> supportFragmentManager<span class="token punctuation">.</span><span class="token function">findFragmentById</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>newsContentFrag<span class="token punctuation">)</span> <span class="token keyword">as</span> NewsContentFragment    fragment<span class="token punctuation">.</span><span class="token function">refresh</span><span class="token punctuation">(</span>title<span class="token punctuation">,</span> content<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> Android Dev. </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Android </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>04-Android-UI</title>
      <link href="/Coming-blog/2022/08/07/04-android-ui/"/>
      <url>/Coming-blog/2022/08/07/04-android-ui/</url>
      
        <content type="html"><![CDATA[<h1 id="æ§ä»¶åŸºç¡€çŸ¥è¯†"><a class="markdownIt-Anchor" href="#æ§ä»¶åŸºç¡€çŸ¥è¯†"></a> æ§ä»¶åŸºç¡€çŸ¥è¯†</h1><h2 id="å®½åº¦é«˜åº¦çš„å–å€¼"><a class="markdownIt-Anchor" href="#å®½åº¦é«˜åº¦çš„å–å€¼"></a> å®½åº¦é«˜åº¦çš„å–å€¼</h2><ol><li><code>match_parent</code>: ç”±çˆ¶å¸ƒå±€æ¥å†³å®šå½“å‰æ§ä»¶çš„å¤§å°</li><li><code>wrap_content</code>: ç”±æ§ä»¶å†…å®¹å†³å®šå½“å‰æ§ä»¶çš„å¤§å°</li><li>å›ºå®šå€¼: å•ä½ä¸€èˆ¬ç”¨ dp(ä¸€ç§å±å¹•å¯†åº¦æ— å…³çš„å°ºå¯¸å•ä½, å¯ä»¥ä¿è¯åœ¨ä¸åŒåˆ†è¾¨ç‡çš„æ‰‹æœºä¸Šæ˜¾ç¤ºæ•ˆæœå°½å¯èƒ½åœ°ä¸€è‡´)</li></ol><h2 id="å¯è§æ€§çš„å–å€¼"><a class="markdownIt-Anchor" href="#å¯è§æ€§çš„å–å€¼"></a> å¯è§æ€§çš„å–å€¼</h2><ol><li><code>visible</code>: å¯è§</li><li><code>invisible</code>: ä¸å¯è§, ä½†æ˜¯ä»ç„¶å æ®ç€åŸæ¥çš„ä½ç½®å’Œå¤§å°</li><li><code>gone</code>: ä¸å¯è§, ä¸”ä¸å†å ç”¨ä»»ä½•å±å¹•ç©ºé—´</li></ol><h1 id="åŸºç¡€æ§ä»¶"><a class="markdownIt-Anchor" href="#åŸºç¡€æ§ä»¶"></a> åŸºç¡€æ§ä»¶</h1><h2 id="button"><a class="markdownIt-Anchor" href="#button"></a> Button</h2><ul><li>æŒ‰é’®ä¸­å­—æ¯å¤§å†™: <code>:textAllCaps: &quot;true&quot;</code></li></ul><h3 id="äº‹ä»¶"><a class="markdownIt-Anchor" href="#äº‹ä»¶"></a> äº‹ä»¶</h3><ul><li><code>setOnClickListener</code>: å•å‡»äº‹ä»¶</li></ul><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin">button1<span class="token punctuation">.</span><span class="token function">setOnClickListener</span> <span class="token punctuation">&#123;</span>    Toast<span class="token punctuation">.</span><span class="token function">makeText</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token string">"You click Button 1"</span><span class="token punctuation">,</span> Toast<span class="token punctuation">.</span>LENGTH_SHORT<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h3 id="äº‹ä»¶çš„ç»Ÿä¸€å¤„ç†æ¥å£"><a class="markdownIt-Anchor" href="#äº‹ä»¶çš„ç»Ÿä¸€å¤„ç†æ¥å£"></a> äº‹ä»¶çš„ç»Ÿä¸€å¤„ç†æ¥å£</h3><p>å°† Button çš„ç‚¹å‡»äº‹ä»¶ç»Ÿä¸€äº¤ç»™ Activity å¤„ç†</p><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">class</span> MainActivity <span class="token operator">:</span> <span class="token function">AppCompatActivity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> View<span class="token punctuation">.</span><span class="token function">OnClickListener</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">onCreate</span><span class="token punctuation">(</span>savedInstanceState<span class="token operator">:</span> Bundle<span class="token operator">?</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onCreate</span><span class="token punctuation">(</span>savedInstanceState<span class="token punctuation">)</span>        <span class="token function">setContentView</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>layout<span class="token punctuation">.</span>activity_main<span class="token punctuation">)</span>        <span class="token keyword">val</span> button_1 <span class="token operator">=</span> findViewById<span class="token operator">&lt;</span>Button<span class="token operator">></span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>button_1<span class="token punctuation">)</span>        <span class="token keyword">val</span> button_2 <span class="token operator">=</span> findViewById<span class="token operator">&lt;</span>Button<span class="token operator">></span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>button_2<span class="token punctuation">)</span>        button_1<span class="token punctuation">.</span><span class="token function">setOnClickListener</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>        button_2<span class="token punctuation">.</span><span class="token function">setOnClickListener</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">onClick</span><span class="token punctuation">(</span>view<span class="token operator">:</span> View<span class="token operator">?</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        Log<span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span><span class="token string">"TEMP"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>view <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token keyword">when</span> <span class="token punctuation">(</span>view<span class="token operator">?</span><span class="token punctuation">.</span>id<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>button_1 <span class="token operator">-></span> <span class="token punctuation">&#123;</span>                Toast<span class="token punctuation">.</span><span class="token function">makeText</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token string">"Button 1"</span><span class="token punctuation">,</span> Toast<span class="token punctuation">.</span>LENGTH_SHORT<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token punctuation">&#125;</span>            R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>button_2 <span class="token operator">-></span> <span class="token punctuation">&#123;</span>                Toast<span class="token punctuation">.</span><span class="token function">makeText</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token string">"Button 2"</span><span class="token punctuation">,</span> Toast<span class="token punctuation">.</span>LENGTH_SHORT<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token punctuation">&#125;</span>            <span class="token keyword">else</span> <span class="token operator">-></span> <span class="token punctuation">&#123;</span>                Toast<span class="token punctuation">.</span><span class="token function">makeText</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token string">"Button None"</span><span class="token punctuation">,</span> Toast<span class="token punctuation">.</span>LENGTH_SHORT<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="textview"><a class="markdownIt-Anchor" href="#textview"></a> TextView</h2><ul><li>æ–‡å­—å¯¹é½æ–¹å¼: <code>:gravity</code>, å–å€¼æœ‰(<code>top, bottom, start, end, center</code>); ä½¿ç”¨ <code>|</code> åŒæ—¶æŒ‡å®šå¤šä¸ªå€¼</li><li>æ–‡å­—é¢œè‰²: <code>:textColor=&quot;#00ff00&quot;</code></li><li>æ–‡å­—å¤§å°: <code>:textSize=&quot;24sp&quot;</code> ä½¿ç”¨ sp ä½œä¸ºå•ä½ï¼Œè¿™æ ·å½“ç”¨æˆ·åœ¨ç³»ç»Ÿä¸­ä¿®æ”¹äº†æ–‡å­—æ˜¾ç¤ºå°ºå¯¸æ—¶ï¼Œåº”ç”¨ç¨‹åºä¸­çš„æ–‡å­—å¤§å°ä¹Ÿä¼šè·Ÿç€å˜åŒ–</li></ul><h2 id="toast"><a class="markdownIt-Anchor" href="#toast"></a> Toast</h2><p>åœ¨çª—å£ä¸­è¿›è¡Œæç¤º <code>Toast.makeText(Context, Content, Time)</code>:</p><ul><li>Contextï¼šToast è¦æ±‚çš„ä¸Šä¸‹æ–‡ï¼Œç”±äº Activity æœ¬èº«å°±æ˜¯ä¸€ä¸ª Context å¯¹è±¡ï¼Œå› æ­¤é€šå¸¸ä¸º this</li><li>Content: æ˜¾ç¤ºçš„æ–‡æœ¬å†…å®¹</li><li>Time: æ˜¾ç¤ºçš„æ—¶é•¿ï¼Œæœ‰ä¸¤ä¸ªå†…ç½®å¸¸é‡å¯ä»¥é€‰æ‹©ï¼š<code>Toast.LENGTH_SHORT</code> å’Œ <code>Toast.LENGTH_LONG</code></li></ul><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin">Toast<span class="token punctuation">.</span><span class="token function">makeText</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token string">"You click Button 1"</span><span class="token punctuation">,</span> Toast<span class="token punctuation">.</span>LENGTH_SHORT<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="menu"><a class="markdownIt-Anchor" href="#menu"></a> Menu</h2><ol><li>æ–°å»º menu èµ„æº: <code>res/menu</code> + <code>res/menu/Menu_Resource_File_Name</code></li><li>åœ¨ <code>Menu_Resource_File_Name</code> è¿›è¡Œèµ„æºçš„æ·»åŠ : `<item/></li></ol><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="utf-8"?></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>menu</span> <span class="token attr-name"><span class="token namespace">xmlns:</span>android</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://schemas.android.com/apk/res/android<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>item</span>        <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@+id/add_item<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>title</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Add<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>item</span>        <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@+id/remove_item<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>title</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Remove<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>menu</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="3"><li>é‡å†™ Activity ä¸­çš„ <code>onCreateOptionsMenu()</code> æ–¹æ³•<ul><li>ä¼ å…¥çš„ menu æŒ‡å‘çš„æ˜¯å½“å‰ Activity çš„èœå•å¯¹è±¡å®ä¾‹</li><li><code>menuInflater</code> å®é™…ä¸Šè°ƒç”¨äº†çˆ¶ç±»ä¸­çš„ <code>getMenuInflater()</code> æ–¹æ³•è·å–åˆ° <code>MenuInflater</code> å¯¹è±¡</li><li>ç„¶åè°ƒç”¨ <code>inflate()</code> æ–¹æ³•ç»™å½“å‰ Activity åˆ›å»ºèœå•: ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºèœå•èµ„æºï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸ºèœå•ä¸Šä¸‹æ–‡</li><li>è¿”å› true è¡¨ç¤ºèœå•åˆ›å»ºåæ˜¾ç¤ºå‡ºæ¥</li></ul></li></ol><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">onCreateOptionsMenu</span><span class="token punctuation">(</span>menu<span class="token operator">:</span> Menu<span class="token operator">?</span><span class="token punctuation">)</span><span class="token operator">:</span> Boolean <span class="token punctuation">&#123;</span>    menuInflater<span class="token punctuation">.</span><span class="token function">inflate</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>menu<span class="token punctuation">.</span>main<span class="token punctuation">,</span> menu<span class="token punctuation">)</span>    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h3 id="å“åº”äº‹ä»¶"><a class="markdownIt-Anchor" href="#å“åº”äº‹ä»¶"></a> å“åº”äº‹ä»¶</h3><ul><li>èœå•é¡¹è¢«ç‚¹å‡»: <code>onOptionsItemSelected()</code></li></ul><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token comment">// èœå•å“åº”äº‹ä»¶</span><span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">onOptionsItemSelected</span><span class="token punctuation">(</span>item<span class="token operator">:</span> MenuItem<span class="token punctuation">)</span><span class="token operator">:</span> Boolean <span class="token punctuation">&#123;</span>    <span class="token keyword">when</span> <span class="token punctuation">(</span>item<span class="token punctuation">.</span>itemId<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>add_item <span class="token operator">-></span> Toast<span class="token punctuation">.</span><span class="token function">makeText</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token string">"You clicked Add"</span><span class="token punctuation">,</span> Toast<span class="token punctuation">.</span>LENGTH_SHORT<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>remove_item <span class="token operator">-></span> Toast<span class="token punctuation">.</span><span class="token function">makeText</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token string">"You clicked Remove"</span><span class="token punctuation">,</span> Toast<span class="token punctuation">.</span>LENGTH_SHORT<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">return</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onOptionsItemSelected</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="å›¾æ ‡å’Œä½ç½®"><a class="markdownIt-Anchor" href="#å›¾æ ‡å’Œä½ç½®"></a> å›¾æ ‡å’Œä½ç½®</h3><p>åœ¨å¸ƒå±€æ–‡ä»¶ä¸­é€šè¿‡ icon å±æ€§æŒ‡å®šèœå•é€‰é¡¹çš„å›¾æ ‡, é€šè¿‡ showAsAction å±æ€§æŒ‡å®šèœå•é€‰é¡¹çš„å±•ç¤ºä½ç½®</p><ul><li>always: è¡¨ç¤ºæ°¸è¿œæ˜¾ç¤ºåœ¨ Toolbar ä¸­, ç©ºé—´ä¸å¤Ÿåˆ™ä¸æ˜¾ç¤º</li><li>ifRoom: è¡¨ç¤ºä¼˜å…ˆæ˜¾ç¤ºåœ¨ Toolbar ä¸­, ç©ºé—´ä¸å¤Ÿæ˜¾ç¤ºåœ¨èœå•ä¸­</li><li>never: è¡¨ç¤ºåªæ˜¾ç¤ºåœ¨èœå•ä¸­</li></ul><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>item</span>    <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@+id/backup<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">android:</span>icon</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@drawable/ic_backup<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">android:</span>title</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Backup<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">app:</span>showAsAction</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>always<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="popupmenu"><a class="markdownIt-Anchor" href="#popupmenu"></a> PopupMenu</h2><p>è‡ªå®šä¹‰å¼¹å‡ºçš„ Menu èœå•</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/202210282053584.png" alt="" /></p><ol><li>å‡†å¤‡ Menu çš„èµ„æºæ–‡ä»¶</li></ol><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="utf-8"?></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>menu</span> <span class="token attr-name"><span class="token namespace">xmlns:</span>android</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://schemas.android.com/apk/res/android<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>item</span>        <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@+id/menu_info_by_day<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>icon</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@drawable/ic_meteor_64<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>title</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>æ˜Ÿè¿¹<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>item</span>        <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@+id/menu_export_db<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>icon</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@drawable/ic_db_export_64<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>title</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>å¯¼å‡ºæ•°æ®<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>item</span>        <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@+id/menu_import_db<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>icon</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@drawable/ic_db_import_64<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>title</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>å¯¼å…¥æ•°æ®<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>menu</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="2"><li>åˆå§‹åŒ–: åˆå§‹åŒ–æ—¶æŒ‡å®šå…¶å¼¹å‡ºçš„ä½ç½®ï¼ˆé€šè¿‡ä¸€ä¸ª view å¯¹è±¡æŒ‡å®šï¼‰å¦‚æœç©ºé—´è¶³å¤Ÿï¼Œå®ƒä¼šæ˜¾ç¤ºåœ¨é”šå®š View ä¸‹æ–¹ï¼Œå¦åˆ™æ˜¾ç¤ºåœ¨å…¶ä¸Šæ–¹</li></ol><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">val</span> popupMenu <span class="token keyword">by</span> lazy <span class="token punctuation">&#123;</span>    <span class="token keyword">val</span> menu <span class="token operator">=</span> <span class="token function">PopupMenu</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> toolbarFragment<span class="token punctuation">.</span>viewShowMenu<span class="token punctuation">)</span> <span class="token comment">// æŒ‡å®šå…¶å¼¹å‡ºçš„ä½ç½®</span>    menu<span class="token punctuation">.</span>menuInflater<span class="token punctuation">.</span><span class="token function">inflate</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>menu<span class="token punctuation">.</span>main_config<span class="token punctuation">,</span> menu<span class="token punctuation">.</span>menu<span class="token punctuation">)</span>    menu<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="3"><li>é…ç½®ç‚¹å‡»äº‹ä»¶: è¿”å› True è¡¨ç¤ºç‚¹å‡»äº‹ä»¶è¢«æ¶ˆè€—</li></ol><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin">popupMenu<span class="token punctuation">.</span><span class="token function">setOnMenuItemClickListener</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">when</span><span class="token punctuation">(</span>it<span class="token punctuation">.</span>itemId<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>menu_info_by_day <span class="token operator">-></span> <span class="token punctuation">&#123;</span>            TodoItemInfoByDayActivity<span class="token punctuation">.</span><span class="token function">onActionStart</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>            <span class="token boolean">true</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">else</span> <span class="token operator">-></span> <span class="token punctuation">&#123;</span>            <span class="token boolean">true</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="4"><li>é…ç½®ç‚¹å‡»æ˜¾ç¤º Menu: ä½¿ç”¨ MenuPopupHelper è¿›ä¸€æ­¥å°è£…, æ˜¯ä¸ºäº†åœ¨æ¯ä¸€ä¸ª Menu é¡¹ä¸­æ˜¾ç¤º Icon <code>setForceShowIcon(true)</code></li></ol><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">val</span> menu <span class="token operator">=</span> <span class="token function">MenuPopupHelper</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span>    <span class="token punctuation">(</span>popupMenu<span class="token punctuation">.</span><span class="token function">getMenu</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> MenuBuilder<span class="token punctuation">)</span><span class="token punctuation">,</span> toolbarFragment<span class="token punctuation">.</span>viewShowMenu<span class="token punctuation">)</span>menu<span class="token punctuation">.</span><span class="token function">setForceShowIcon</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>menu<span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h2 id="edittext"><a class="markdownIt-Anchor" href="#edittext"></a> EditText</h2><ul><li>æç¤ºå†…å®¹: <code>:hint=&quot;Type something here&quot;</code></li><li>æœ€å¤§è¡Œæ•°: <code>:maxLines=&quot;1&quot;</code> è¶…è¿‡æœ€å¤§è¡Œæ•°ä¼šæ»šåŠ¨æ˜¾ç¤ºï¼ˆç»„ä»¶ä¸ä¼šæ‹‰ä¼¸ï¼‰</li><li>å†…å®¹è¿‡æ»¤æ¨¡æ¿: <code>:inputType</code> å¸¸ç”¨çš„æœ‰ <code>text, textPassword, number</code></li></ul><p>æ–¹æ³•ï¼š</p><ul><li>è·å–å†…å®¹: <code>edit_username.text.toString()</code></li><li>è®¾ç½®å†…å®¹: <code>edit_username.setText(String)</code></li><li>è®¾ç½®å…‰æ ‡ä½ç½®: <code>edit_username.setSelection(Int)</code></li><li>è¯·æ±‚ Focus: <code>requestFocus()</code></li><li>å…¨é€‰: <code>selectAll()</code></li></ul><h2 id="imageview"><a class="markdownIt-Anchor" href="#imageview"></a> ImageView</h2><ul><li><p>è®¾å®šå›¾ç‰‡æº: <code>:src=&quot;@drawable/image_demo_1&quot;</code></p></li><li><p>ä¿®æ”¹å›¾ç‰‡æº: <code>.setImageResource(R.drawable.image_demo_2)</code></p></li></ul><h2 id="progressbar"><a class="markdownIt-Anchor" href="#progressbar"></a> ProgressBar</h2><h3 id="è¿›åº¦æ¡æ ·å¼"><a class="markdownIt-Anchor" href="#è¿›åº¦æ¡æ ·å¼"></a> è¿›åº¦æ¡æ ·å¼</h3><ul><li>é»˜è®¤æ—‹è½¬åŠ è½½è¿›åº¦æ¡</li><li>æ°´å¹³è¿›åº¦æ¡: <code>style=&quot;?android:attr/progressBarStyleHorizontal&quot;</code><ul><li>è®¾å®šè¿›åº¦æœ€å¤§å€¼: <code>:max=&quot;100&quot;</code></li><li>è®¾å®šåˆå§‹è¿›åº¦å€¼: <code>:progress=&quot;50&quot;</code></li><li>è·å–è¿›åº¦å€¼: <code>int progress = progressBarHorizontal.getProgress();</code></li><li>è®¾ç½®è¿›åº¦å€¼: <code>progressBarHorizontal.setProgress(progress);</code></li></ul></li></ul><h2 id="alertdialog"><a class="markdownIt-Anchor" href="#alertdialog"></a> AlertDialog</h2><p>åœ¨å½“å‰ç•Œé¢å¼¹å‡ºä¸€ä¸ªå¯¹è¯æ¡†, ç½®äºæ‰€æœ‰ç•Œé¢å…ƒç´ ä¹‹ä¸Š(å±è”½å…¶ä»–æ§ä»¶çš„äº¤äº’èƒ½åŠ›)</p><h3 id="äºŒæ¬¡ç¡®è®¤"><a class="markdownIt-Anchor" href="#äºŒæ¬¡ç¡®è®¤"></a> äºŒæ¬¡ç¡®è®¤</h3><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin">R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>button_change_image <span class="token operator">-></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">val</span> environment <span class="token operator">=</span> <span class="token keyword">this</span>    AlertDialog<span class="token punctuation">.</span><span class="token function">Builder</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">apply</span> <span class="token punctuation">&#123;</span>        <span class="token function">setTitle</span><span class="token punctuation">(</span><span class="token string">"Warning"</span><span class="token punctuation">)</span>        <span class="token function">setMessage</span><span class="token punctuation">(</span><span class="token string">"Do you really want to change the image source?"</span><span class="token punctuation">)</span>        <span class="token comment">// å¯å¦ä½¿ç”¨ Back é”®å…³é—­å¯¹è¯æ¡†</span>        <span class="token function">setCancelable</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>        <span class="token function">setPositiveButton</span><span class="token punctuation">(</span><span class="token string">"YES"</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> dialog<span class="token punctuation">,</span> which <span class="token operator">-></span>            Toast<span class="token punctuation">.</span><span class="token function">makeText</span><span class="token punctuation">(</span>environment<span class="token punctuation">,</span> <span class="token string">"Change Image"</span><span class="token punctuation">,</span> Toast<span class="token punctuation">.</span>LENGTH_SHORT<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token keyword">val</span> image_demo_1 <span class="token operator">=</span> findViewById<span class="token operator">&lt;</span>ImageView<span class="token operator">></span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>image_demo_1<span class="token punctuation">)</span>            image_demo_1<span class="token punctuation">.</span><span class="token function">setImageResource</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>drawable<span class="token punctuation">.</span>image_demo_2<span class="token punctuation">)</span>        <span class="token punctuation">&#125;</span>        <span class="token function">setNegativeButton</span><span class="token punctuation">(</span><span class="token string">"Cancel"</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> dialog<span class="token punctuation">,</span> which <span class="token operator">-></span> dialog<span class="token punctuation">.</span><span class="token function">dismiss</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span>        <span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="åˆ—è¡¨é€‰æ‹©"><a class="markdownIt-Anchor" href="#åˆ—è¡¨é€‰æ‹©"></a> åˆ—è¡¨é€‰æ‹©</h3><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">val</span> todoCategoryItems <span class="token operator">=</span> viewModel<span class="token punctuation">.</span>todoCategoryList<span class="token punctuation">.</span><span class="token function">map</span> <span class="token punctuation">&#123;</span> it<span class="token punctuation">.</span>name <span class="token punctuation">&#125;</span><span class="token punctuation">.</span><span class="token function">toTypedArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">val</span> alertBuilder<span class="token operator">:</span> AlertDialog<span class="token punctuation">.</span>Builder <span class="token operator">=</span> AlertDialog<span class="token punctuation">.</span><span class="token function">Builder</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">apply</span> <span class="token punctuation">&#123;</span>    <span class="token function">setTitle</span><span class="token punctuation">(</span><span class="token string">"æ—¶é—´è§„åˆ’é›†"</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">setItems</span><span class="token punctuation">(</span>todoCategoryItems<span class="token punctuation">,</span> DialogInterface<span class="token punctuation">.</span><span class="token function">OnClickListener</span> <span class="token punctuation">&#123;</span> dialog<span class="token punctuation">,</span> which <span class="token operator">-></span>        insertTodoitmeCategory<span class="token punctuation">.</span><span class="token function">setText</span><span class="token punctuation">(</span>todoCategoryItems<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>which<span class="token punctuation">)</span><span class="token punctuation">)</span>        dialog<span class="token punctuation">.</span><span class="token function">dismiss</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>    <span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/202211091917520.jpg" alt="" /></p><h2 id="progressdialogold"><a class="markdownIt-Anchor" href="#progressdialogold"></a> ProgressDialogã€OLDã€‘</h2><p>åŠŸèƒ½ï¼šå¼¹å‡ºçš„å¯¹è¯æ¡†ä¸­æ˜¾ç¤ºä¸€ä¸ªè¿›åº¦æ¡ï¼Œç¼“è§£ç”¨æˆ·ç­‰å¾…çš„ç„¦èºã€‚</p><p>æ„å»ºæ–¹æ³•ï¼šä¸AlertDialogç±»ä¼¼</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">ProgressDialog</span> progressDialog <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ProgressDialog</span><span class="token punctuation">(</span><span class="token class-name">MainActivity</span><span class="token punctuation">.</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>progressDialog<span class="token punctuation">.</span><span class="token function">setTitle</span><span class="token punctuation">(</span><span class="token string">"Progress Dialog"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>progressDialog<span class="token punctuation">.</span><span class="token function">setMessage</span><span class="token punctuation">(</span><span class="token string">"Loading..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>progressDialog<span class="token punctuation">.</span><span class="token function">setCancelable</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>progressDialog<span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="å¸ƒå±€"><a class="markdownIt-Anchor" href="#å¸ƒå±€"></a> å¸ƒå±€</h1><h2 id="linearlayout"><a class="markdownIt-Anchor" href="#linearlayout"></a> LinearLayout</h2><ul><li>å¸ƒå±€æ–¹å‘: <code>:orientation</code> å±æ€§æ’åˆ—æ–¹å‘æœ‰ <code>vertical, horizontal</code></li><li>å¯¹é½æ–¹å¼: <code>:layout_gravity</code> å’Œæ–‡å­—åœ¨ç©ºé—´ä¸­çš„å¯¹é½æ–¹å¼ç±»ä¼¼<ul><li>æ°´å¹³æ’åˆ—æ—¶, æ°´å¹³é•¿åº¦ä¸å›ºå®š, å› æ­¤ <code>center</code> ä¼šå¤±æ•ˆ; åŒç†, ...</li></ul></li><li>ç©ºé—´æ¯”ä¾‹æ’å¸ƒ: <code>:layout_weight=&quot;1&quot;</code> åœ¨ä¸€è¡Œæˆ–ä¸€åˆ—ä¸­æŒ‰ç…§æ¯”ä¾‹åˆ†é…å¤§å°, è‡ªé€‚åº”æ‹‰ä¼¸; éœ€è¦å°† <code>:layout_width</code> ç½®ä¸º 0</li></ul><p>å¸ƒå±€æŠ€å·§: å…ˆ Layout å ç»„ä»¶</p><h2 id="relativelayout"><a class="markdownIt-Anchor" href="#relativelayout"></a> RelativeLayout</h2><p>é€šè¿‡ç›¸å¯¹å®šä½çš„æ–¹å¼è®©æ§ä»¶å‡ºç°åœ¨å¸ƒå±€çš„ä»»ä½•ä½ç½®</p><p>æ ¹æ®çˆ¶ç»„ä»¶å¸ƒå±€:</p><ul><li><code>:layout_alignParentLeft=&quot;true&quot;</code></li><li><code>:layout_alignParentRight=&quot;true&quot;</code></li><li><code>:layout_centerInParent=&quot;true&quot;</code></li><li><code>:layout_alignParentTop=&quot;true&quot;</code></li><li><code>:layout_alignParenBottom=&quot;true&quot;</code></li></ul><p>æ ¹æ®æŸä¸€ç»„ä»¶çš„ä½ç½®å¸ƒå±€:</p><ul><li><code>:layout_toRightOf=&quot;@+id/button_center&quot;</code></li><li><code>:layout_toLefttOf=&quot;@+id/button_center&quot;</code></li><li><code>:layout_above=&quot;@+id/button_center&quot;</code></li><li><code>:layout_below=&quot;@+id/button_center&quot;</code></li></ul><p>ç›¸å¯¹äºç»„ä»¶å¯¹é½:</p><ul><li><code>:layout_alignLeft</code>: ä¸¤ç»„ä»¶å·¦è¾¹ç¼˜å¯¹é½</li><li><code>:layout_alignRight</code>: ä¸¤ç»„ä»¶å³è¾¹ç¼˜å¯¹é½</li><li><code>:layout_alignTop</code>: ä¸¤ç»„ä»¶ä¸Šè¾¹ç¼˜å¯¹é½</li><li><code>:layout_alignBottom</code>: ä¸¤ç»„ä»¶ä¸‹è¾¹ç¼˜å¯¹é½</li></ul><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/202207192024159.png" alt="" /></p><h2 id="framelayout"><a class="markdownIt-Anchor" href="#framelayout"></a> FrameLayout</h2><p>å¸§å¸ƒå±€, æ‰€æœ‰çš„æ§ä»¶éƒ½ä¼šé»˜è®¤æ‘†æ”¾åœ¨å¸ƒå±€çš„å·¦ä¸Šè§’</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/202207201944550.png" alt="" /></p><h1 id="è‡ªå®šä¹‰æ§ä»¶"><a class="markdownIt-Anchor" href="#è‡ªå®šä¹‰æ§ä»¶"></a> è‡ªå®šä¹‰æ§ä»¶</h1><p>æ‰€æœ‰æ§ä»¶éƒ½æ˜¯ç›´æ¥æˆ–é—´æ¥ç»§æ‰¿è‡ª View:</p><ul><li>View æ˜¯ Android ä¸­æœ€åŸºæœ¬çš„ä¸€ç§ UI ç»„ä»¶ï¼Œå®ƒå¯ä»¥åœ¨å±å¹•ä¸Šç»˜åˆ¶ä¸€å—çŸ©å½¢åŒºåŸŸï¼Œå¹¶èƒ½å“åº”è¿™å—åŒºåŸŸçš„å„ç§äº‹ä»¶</li></ul><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/202207201947883.png" alt="" /></p><p>Application:</p><ul><li>å…¬å…±ç»„ä»¶çš„å¤ç”¨ <code>&lt;include layout=&quot;@layout/title&quot; /&gt;</code>: æ ‡é¢˜æ , å°¾éƒ¨æ <ul><li>éœ€è¦å°†ç³»ç»Ÿè‡ªå¸¦çš„æ ‡é¢˜æ ç­‰è¿›è¡Œéšè—: <code>supportActionBar?.hide()</code></li></ul></li><li>ä½†æ˜¯å¦‚æœå¤ç”¨çš„ç»„ä»¶ä¸­æœ‰äº¤äº’æ€§äº‹ä»¶, å¦‚ä½•å¤ç”¨è¿™äº›äº‹ä»¶çš„å“åº”æ“ä½œå‘¢, å¼•å…¥äº†è‡ªå®šä¹‰æ§ä»¶</li></ul><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">class</span> <span class="token function">TitleLayout</span><span class="token punctuation">(</span>context<span class="token operator">:</span> Context<span class="token punctuation">,</span> attrs<span class="token operator">:</span> AttributeSet<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">LinearLayout</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> attrs<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">init</span> <span class="token punctuation">&#123;</span>        LayoutInflater<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">inflate</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>layout<span class="token punctuation">.</span>title<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span>        <span class="token keyword">val</span> titleBack <span class="token operator">=</span> findViewById<span class="token operator">&lt;</span>Button<span class="token operator">></span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>titleBack<span class="token punctuation">)</span>        <span class="token keyword">val</span> titleText <span class="token operator">=</span> findViewById<span class="token operator">&lt;</span>TextView<span class="token operator">></span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>titleText<span class="token punctuation">)</span>        <span class="token keyword">val</span> titleEdit <span class="token operator">=</span> findViewById<span class="token operator">&lt;</span>Button<span class="token operator">></span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>titleEdit<span class="token punctuation">)</span>        titleBack<span class="token punctuation">.</span><span class="token function">setOnClickListener</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">val</span> activity <span class="token operator">=</span> context <span class="token keyword">as</span> Activity            activity<span class="token punctuation">.</span><span class="token function">finish</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token punctuation">&#125;</span>        titleEdit<span class="token punctuation">.</span><span class="token function">setOnClickListener</span> <span class="token punctuation">&#123;</span>            Toast<span class="token punctuation">.</span><span class="token function">makeText</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> <span class="token string">"Editing..."</span><span class="token punctuation">,</span> Toast<span class="token punctuation">.</span>LENGTH_SHORT<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><code>LayoutInflater</code> å¯¹è±¡ç”¨äºå®ç°åŠ¨æ€åŠ è½½, é€šè¿‡ <code>LayoutInflater</code> çš„ <code>from()</code> æ–¹æ³•å¯ä»¥æ„å»ºå‡ºä¸€ä¸ª <code>LayoutInflater</code> å¯¹è±¡ï¼Œç„¶åè°ƒç”¨ <code>inflate()</code> æ–¹æ³•å°±å¯ä»¥åŠ¨æ€åŠ è½½ä¸€ä¸ªå¸ƒå±€æ–‡ä»¶<ul><li>ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯è¦åŠ è½½çš„å¸ƒå±€æ–‡ä»¶çš„ id</li><li>ç¬¬äºŒä¸ªå‚æ•°æ˜¯ç»™åŠ è½½å¥½çš„å¸ƒå±€å†æ·»åŠ ä¸€ä¸ªçˆ¶å¸ƒå±€ï¼Œè¿™é‡Œæˆ‘ä»¬æƒ³è¦æŒ‡å®šä¸º TitleLayoutï¼Œäºæ˜¯ç›´æ¥ä¼ å…¥ this</li></ul></li></ul><p>åœ¨å¸ƒå±€æ–‡ä»¶ä¸­æ·»åŠ è¿™ä¸ªè‡ªå®šä¹‰æ§ä»¶, å³å¯å°†ç›¸å…³çš„äº‹ä»¶å¤„ç†ä¹Ÿä¸€å¹¶å¤ç”¨å¼•å…¥:</p><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>com.example.a05_uicustomviews.TitleLayout</span>    <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h1 id="listview"><a class="markdownIt-Anchor" href="#listview"></a> ListView</h1><p>ListView å…è®¸ç”¨æˆ·é€šè¿‡æ‰‹æŒ‡ä¸Šä¸‹æ»‘åŠ¨çš„æ–¹å¼å°†å±å¹•å¤–çš„æ•°æ®æ»šåŠ¨åˆ°å±å¹•å†…ï¼ŒåŒæ—¶å±å¹•ä¸ŠåŸæœ‰çš„æ•°æ®ä¼šæ»šåŠ¨å‡ºå±å¹•</p><h2 id="quick-start"><a class="markdownIt-Anchor" href="#quick-start"></a> Quick Start</h2><ol><li>å‡†å¤‡å¥½æ•°æ®</li></ol><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">private</span> <span class="token keyword">val</span> <span class="token keyword">data</span> <span class="token operator">=</span> <span class="token function">listOf</span><span class="token punctuation">(</span><span class="token string">"Apple"</span><span class="token punctuation">,</span> <span class="token string">"Banana"</span><span class="token punctuation">,</span> <span class="token string">"Orange"</span><span class="token punctuation">,</span> <span class="token string">"Watermelon"</span><span class="token punctuation">,</span>    <span class="token string">"Pear"</span><span class="token punctuation">,</span> <span class="token string">"Grape"</span><span class="token punctuation">,</span> <span class="token string">"Pineapple"</span><span class="token punctuation">,</span> <span class="token string">"Strawberry"</span><span class="token punctuation">,</span> <span class="token string">"Cherry"</span><span class="token punctuation">,</span> <span class="token string">"Mango"</span><span class="token punctuation">,</span>    <span class="token string">"Apple"</span><span class="token punctuation">,</span> <span class="token string">"Banana"</span><span class="token punctuation">,</span> <span class="token string">"Orange"</span><span class="token punctuation">,</span> <span class="token string">"Watermelon"</span><span class="token punctuation">,</span> <span class="token string">"Pear"</span><span class="token punctuation">,</span> <span class="token string">"Grape"</span><span class="token punctuation">,</span>    <span class="token string">"Pineapple"</span><span class="token punctuation">,</span> <span class="token string">"Strawberry"</span><span class="token punctuation">,</span> <span class="token string">"Cherry"</span><span class="token punctuation">,</span> <span class="token string">"Mango"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><ol start="2"><li>å°è£…åˆ° adapter ä¸­</li></ol><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">val</span> adapter <span class="token operator">=</span> ArrayAdapter<span class="token operator">&lt;</span>String<span class="token operator">></span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> android<span class="token punctuation">.</span>R<span class="token punctuation">.</span>layout<span class="token punctuation">.</span>simple_list_item_1<span class="token punctuation">,</span> <span class="token keyword">data</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>æ³›å‹é€šè¿‡æ•°æ®ç±»å‹æŒ‡å®šä¸º <code>String</code></li><li>Context å‚æ•°ä¸ºå½“å‰ Activity</li><li>resource: å‚æ•°æŒ‡çš„æ˜¯æ•°æ®é¡¹çš„å¸ƒå±€ id, è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨å†…ç½®çš„ simple_list_item_1</li></ul><ol start="3"><li>è®¾ç½® adapter åˆ° listview ä¸­</li></ol><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin">list_main<span class="token punctuation">.</span>adapter <span class="token operator">=</span> adapter<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="adapter"><a class="markdownIt-Anchor" href="#adapter"></a> adapter</h2><p>é€‚é…å™¨, æ˜¯æ•°æ®é¡¹ä¸è§†å›¾(å±•ç¤º)çš„æ¡¥æ¢, å³ MVC ä¸­çš„ C(Controller): An Adapter object acts as a bridge between an AdapterView and the underlying data for that view. The Adapter provides access to the data items. The Adapter is also responsible for making a View for each item in the data set.</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/202207282231794.png" alt="" /></p><p>å¸¸ç”¨æœ‰ <code>ArrayAdapter</code>, <code>CursorAdapter</code>, <code>SimpleCursorAdapter</code> ä¸åŒçš„ç±»å®šä¹‰äº†ä¸åŒçš„æ•°æ®å±•ç¤ºå½¢å¼</p><h2 id="è‡ªå®šä¹‰-adapter"><a class="markdownIt-Anchor" href="#è‡ªå®šä¹‰-adapter"></a> è‡ªå®šä¹‰ adapter</h2><p>ä¸»è¦æ˜¯è‡ªå®šä¹‰æ•°æ®é¡¹çš„æ˜¾ç¤ºç•Œé¢</p><ol><li>é¦–å…ˆå¯¹æˆ‘ä»¬çš„æ•°æ®é¡¹ä¸­çš„æ•°æ®è¿›è¡Œå°è£…</li></ol><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">class</span> <span class="token function">Fruit</span><span class="token punctuation">(</span><span class="token keyword">val</span> name<span class="token operator">:</span>String<span class="token punctuation">,</span> <span class="token keyword">val</span> imageId<span class="token operator">:</span> Int<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ol start="2"><li>ç„¶åç¼–å†™æ•°æ®é¡¹çš„ Layout (ä½œä¸º Adapter çš„å‚æ•°)</li></ol><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token comment">&lt;!-- å·¦å›¾å³æ–‡å­— --></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>LinearLayout</span> <span class="token attr-name">...</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ImageView</span> <span class="token attr-name">...</span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>TextView</span> <span class="token attr-name">...</span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>LinearLayout</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="3"><li>è‡ªå®šä¹‰ Adapter: åœ¨ ArrayAdapter çš„åŸºç¡€ä¸Šè‡ªå®šä¹‰å±•ç¤ºè§†å›¾</li></ol><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">class</span> <span class="token function">FruitAdapter</span><span class="token punctuation">(</span>activity<span class="token operator">:</span> Activity<span class="token punctuation">,</span> <span class="token keyword">val</span> resourceId<span class="token operator">:</span> Int<span class="token punctuation">,</span> <span class="token keyword">data</span><span class="token operator">:</span> List<span class="token operator">&lt;</span>Fruit<span class="token operator">></span><span class="token punctuation">)</span><span class="token operator">:</span> ArrayAdapter<span class="token operator">&lt;</span>Fruit<span class="token operator">></span><span class="token punctuation">(</span>activity<span class="token punctuation">,</span> resourceId<span class="token punctuation">,</span> <span class="token keyword">data</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">inner</span> <span class="token keyword">class</span> <span class="token function">ViewHolder</span><span class="token punctuation">(</span><span class="token keyword">val</span> fruitImage<span class="token operator">:</span> ImageView<span class="token punctuation">,</span> <span class="token keyword">val</span> fruitName<span class="token operator">:</span> TextView<span class="token punctuation">)</span>    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">getView</span><span class="token punctuation">(</span>position<span class="token operator">:</span> Int<span class="token punctuation">,</span> convertView<span class="token operator">:</span> View<span class="token operator">?</span><span class="token punctuation">,</span> parent<span class="token operator">:</span> ViewGroup<span class="token punctuation">)</span><span class="token operator">:</span> View <span class="token punctuation">&#123;</span>        <span class="token keyword">val</span> view<span class="token operator">:</span> View        <span class="token keyword">val</span> viewHolder<span class="token operator">:</span> ViewHolder        <span class="token keyword">if</span> <span class="token punctuation">(</span>convertView <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            view <span class="token operator">=</span> LayoutInflater<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">inflate</span><span class="token punctuation">(</span>resourceId<span class="token punctuation">,</span> parent<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span>            <span class="token keyword">val</span> image_fruit_item<span class="token operator">:</span> ImageView <span class="token operator">=</span> view<span class="token punctuation">.</span><span class="token function">findViewById</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>image_fruit_item<span class="token punctuation">)</span>            <span class="token keyword">val</span> text_fruit_name<span class="token operator">:</span>TextView <span class="token operator">=</span> view<span class="token punctuation">.</span><span class="token function">findViewById</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>text_fruit_name<span class="token punctuation">)</span>            viewHolder <span class="token operator">=</span> <span class="token function">ViewHolder</span><span class="token punctuation">(</span><span class="token punctuation">(</span>image_fruit_item<span class="token punctuation">,</span> text_fruit_name<span class="token punctuation">)</span><span class="token punctuation">)</span>            view<span class="token punctuation">.</span>tag <span class="token operator">=</span> viewHolder        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>            view <span class="token operator">=</span> convertView            viewHolder <span class="token operator">=</span> view<span class="token punctuation">.</span>tag <span class="token keyword">as</span> ViewHolder        <span class="token punctuation">&#125;</span>        <span class="token keyword">val</span> fruit <span class="token operator">=</span> <span class="token function">getItem</span><span class="token punctuation">(</span>position<span class="token punctuation">)</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>fruit <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            viewHolder<span class="token punctuation">.</span>fruitImage<span class="token punctuation">.</span><span class="token function">setImageResource</span><span class="token punctuation">(</span>fruit<span class="token punctuation">.</span>imageId<span class="token punctuation">)</span>            viewHolder<span class="token punctuation">.</span>fruitName<span class="token punctuation">.</span>text <span class="token operator">=</span> fruit<span class="token punctuation">.</span>name        <span class="token punctuation">&#125;</span>        <span class="token keyword">return</span> view    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="4"><li>Apply Adapter to data</li></ol><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">private</span> <span class="token keyword">val</span> fruitList <span class="token operator">=</span> ArrayList<span class="token operator">&lt;</span>Fruit<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">onCreate</span><span class="token punctuation">(</span>savedInstanceState<span class="token operator">:</span> Bundle<span class="token operator">?</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onCreate</span><span class="token punctuation">(</span>savedInstanceState<span class="token punctuation">)</span>        <span class="token function">setContentView</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>layout<span class="token punctuation">.</span>activity_main<span class="token punctuation">)</span>        supportActionBar<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">hide</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">val</span> list_main <span class="token operator">=</span> findViewById<span class="token operator">&lt;</span>ListView<span class="token operator">></span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>list_main<span class="token punctuation">)</span>        <span class="token function">initFruits</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">val</span> adapter <span class="token operator">=</span> <span class="token function">FruitAdapter</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> R<span class="token punctuation">.</span>layout<span class="token punctuation">.</span>fruit_item<span class="token punctuation">,</span> fruitList<span class="token punctuation">)</span>        list_main<span class="token punctuation">.</span>adapter <span class="token operator">=</span> adapter    <span class="token punctuation">&#125;</span>    <span class="token keyword">private</span> <span class="token keyword">fun</span> <span class="token function">initFruits</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token function">repeat</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            fruitList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token function">Fruit</span><span class="token punctuation">(</span><span class="token string">"Cherry"</span><span class="token punctuation">,</span> R<span class="token punctuation">.</span>drawable<span class="token punctuation">.</span>cherry_pic<span class="token punctuation">)</span><span class="token punctuation">)</span>            fruitList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token function">Fruit</span><span class="token punctuation">(</span><span class="token string">"Mango"</span><span class="token punctuation">,</span> R<span class="token punctuation">.</span>drawable<span class="token punctuation">.</span>mango_pic<span class="token punctuation">)</span><span class="token punctuation">)</span>            <span class="token operator">..</span><span class="token punctuation">.</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="adapter-æ€§èƒ½ä¼˜åŒ–è¿‡ç¨‹"><a class="markdownIt-Anchor" href="#adapter-æ€§èƒ½ä¼˜åŒ–è¿‡ç¨‹"></a> Adapter æ€§èƒ½ä¼˜åŒ–è¿‡ç¨‹</h3><p>è¿™æ˜¯æœ€åˆçš„ Adapter ç¼–å†™æ€è·¯:</p><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token comment">// ç»§æ‰¿ä¸æ„é€ å‡½æ•° - kotlin åŸºç¡€</span><span class="token keyword">class</span> <span class="token function">FruitAdapter</span><span class="token punctuation">(</span>activity<span class="token operator">:</span> Activity<span class="token punctuation">,</span> <span class="token keyword">val</span> resourceId<span class="token operator">:</span> Int<span class="token punctuation">,</span> <span class="token keyword">data</span><span class="token operator">:</span> List<span class="token operator">&lt;</span>Fruit<span class="token operator">></span><span class="token punctuation">)</span><span class="token operator">:</span> ArrayAdapter<span class="token operator">&lt;</span>Fruit<span class="token operator">></span><span class="token punctuation">(</span>activity<span class="token punctuation">,</span> resourceId<span class="token punctuation">,</span> <span class="token keyword">data</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// éœ€è¦åŠ è½½æ•°æ®é¡¹æ—¶è°ƒç”¨, ä½†æ˜¯æ¯æ¬¡è°ƒç”¨æ—¶éƒ½ä¼šå°†æ•°æ®é¡¹å¸ƒå±€(resourceId)é‡æ–°åŠ è½½ä¸€é</span>    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">getView</span><span class="token punctuation">(</span>position<span class="token operator">:</span> Int<span class="token punctuation">,</span> convertView<span class="token operator">:</span> View<span class="token operator">?</span><span class="token punctuation">,</span> parent<span class="token operator">:</span> ViewGroup<span class="token punctuation">)</span><span class="token operator">:</span> View <span class="token punctuation">&#123;</span>        <span class="token comment">// åŠ è½½æ–°çš„æ•°æ®é¡¹: ä½¿ç”¨ LayoutInflater åŠ è½½æ•°æ®é¡¹å¯¹åº”çš„å¸ƒå±€</span>        <span class="token comment">// ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯è¦åŠ è½½çš„å¸ƒå±€æ–‡ä»¶çš„ id - å®ä¾‹åŒ– Adapter æ—¶ä¼ å…¥çš„å‚æ•°</span>        <span class="token comment">// ç¬¬äºŒä¸ªå‚æ•°æ˜¯ç»™åŠ è½½å¥½çš„å¸ƒå±€å†æ·»åŠ ä¸€ä¸ªçˆ¶å¸ƒå±€ï¼Œè¿™é‡Œå›è°ƒå‡½æ•°ä¸­å¸¦æœ‰çˆ¶å¸ƒå±€çš„ id ç›´æ¥ä½¿ç”¨</span>        <span class="token comment">// ç¬¬ä¸‰ä¸ªå‚æ•°ä¸º false æ—¶ ListView ä¸­çš„æ ‡å‡†å†™æ³•, è¡¨ç¤ºåªè®©æˆ‘ä»¬åœ¨çˆ¶å¸ƒå±€ä¸­å£°æ˜çš„ layout å±æ€§ç”Ÿæ•ˆï¼Œä½†ä¸ä¼šä¸ºè¿™ä¸ª View æ·»åŠ çˆ¶å¸ƒå±€, å› ä¸ºä¸€æ—¦ View æœ‰äº†çˆ¶å¸ƒå±€ä¹‹åï¼Œå®ƒå°±ä¸èƒ½å†æ·»åŠ åˆ° ListView ä¸­äº†</span>        <span class="token keyword">val</span> view <span class="token operator">=</span> LayoutInflater<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">inflate</span><span class="token punctuation">(</span>resourceId<span class="token punctuation">,</span> parent<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span>        <span class="token comment">// å®Œæˆ View çš„åŠ è½½å³å¯è·å– View ä¸­çš„ç»„ä»¶</span>        <span class="token keyword">val</span> image_fruit_item<span class="token operator">:</span> ImageView <span class="token operator">=</span> view<span class="token punctuation">.</span><span class="token function">findViewById</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>image_fruit_item<span class="token punctuation">)</span>        <span class="token keyword">val</span> text_fruit_name<span class="token operator">:</span>TextView <span class="token operator">=</span> view<span class="token punctuation">.</span><span class="token function">findViewById</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>text_fruit_name<span class="token punctuation">)</span>        <span class="token comment">// æ ¹æ® position åŠ è½½å¯¹åº”çš„æ•°æ®é¡¹ - æ­¥éª¤ 1 å°è£…åçš„å®ä¾‹</span>        <span class="token keyword">val</span> fruit <span class="token operator">=</span> <span class="token function">getItem</span><span class="token punctuation">(</span>position<span class="token punctuation">)</span>        <span class="token comment">// æˆåŠŸåŠ è½½åæ¸²æŸ“åˆ° view ä¸­</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>fruit <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            image_fruit_item<span class="token punctuation">.</span><span class="token function">setImageResource</span><span class="token punctuation">(</span>fruit<span class="token punctuation">.</span>imageId<span class="token punctuation">)</span>            text_fruit_name<span class="token punctuation">.</span>text <span class="token operator">=</span> fruit<span class="token punctuation">.</span>name        <span class="token punctuation">&#125;</span>        <span class="token keyword">return</span> view    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>Tips: getView é»˜è®¤æ¯æ¬¡è°ƒç”¨æ—¶éƒ½ä¼šå°†æ•°æ®é¡¹å¸ƒå±€é‡æ–°åŠ è½½ä¸€é, å› æ­¤å½“å¿«é€Ÿæ»‘åŠ¨æ—¶å°†ä¼šå¯¹æ€§èƒ½æœ‰æ‰€å½±å“, ä½†æ˜¯æ¯ä¸ªæ•°æ®é¡¹çš„å¸ƒå±€åŸºæœ¬æ˜¯ä¸€è‡´çš„, å› æ­¤æˆ‘ä»¬å¯ä»¥å€ŸåŠ©å¯¹ä¹‹å‰å¸ƒå±€çš„ç¼“å­˜ <code>convertView</code> è¿›è¡Œä¼˜åŒ–</p><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">val</span> view<span class="token operator">:</span> View<span class="token keyword">if</span> <span class="token punctuation">(</span>convertView <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    view <span class="token operator">=</span> LayoutInflater<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">inflate</span><span class="token punctuation">(</span>resourceId<span class="token punctuation">,</span> parent<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>    view <span class="token operator">=</span> convertView<span class="token punctuation">&#125;</span><span class="token comment">// åç»­ä¾æ—§æ˜¯å¯¹å¸ƒå±€çš„æ•°æ®ç»‘å®š ...</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>Tips: ç»§ç»­è§‚å¯Ÿä»£ç æˆ‘ä»¬å‘ç°é’ˆå¯¹å¸ƒå±€ä¸­çš„æ§ä»¶æˆ‘ä»¬æ¯æ¬¡è¿˜æ˜¯éœ€è¦ <code>find</code>, å¯ä»¥å€ŸåŠ© <code>ViewHolder</code> å¯¹è¿™éƒ¨åˆ†æ€§èƒ½è¿›è¡Œä¼˜åŒ–</p><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token comment">// è‡ªå®šä¹‰ä¸€ä¸ªå†…éƒ¨ç±»å®ç°å¯¹ç›®æ ‡æ§ä»¶ç»„çš„å°è£…</span><span class="token keyword">inner</span> <span class="token keyword">class</span> <span class="token function">ViewHolder</span><span class="token punctuation">(</span><span class="token keyword">val</span> fruitImage<span class="token operator">:</span> ImageView<span class="token punctuation">,</span> <span class="token keyword">val</span> fruitName<span class="token operator">:</span> TextView<span class="token punctuation">)</span><span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">getView</span><span class="token punctuation">(</span>position<span class="token operator">:</span> Int<span class="token punctuation">,</span> convertView<span class="token operator">:</span> View<span class="token operator">?</span><span class="token punctuation">,</span> parent<span class="token operator">:</span> ViewGroup<span class="token punctuation">)</span><span class="token operator">:</span> View <span class="token punctuation">&#123;</span>    <span class="token keyword">val</span> view<span class="token operator">:</span> View    <span class="token keyword">val</span> viewHolder<span class="token operator">:</span> ViewHolder    <span class="token comment">// å¦‚æœä¹‹å‰ä¸å­˜åœ¨ View çš„ç¼“å­˜åˆ™åŠ è½½ View å¹¶å¯»æ‰¾ç»‘å®šæ§ä»¶</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>convertView <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        view <span class="token operator">=</span> LayoutInflater<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">inflate</span><span class="token punctuation">(</span>resourceId<span class="token punctuation">,</span> parent<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span>        <span class="token keyword">val</span> image_fruit_item<span class="token operator">:</span> ImageView <span class="token operator">=</span> view<span class="token punctuation">.</span><span class="token function">findViewById</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>image_fruit_item<span class="token punctuation">)</span>        <span class="token keyword">val</span> text_fruit_name<span class="token operator">:</span>TextView <span class="token operator">=</span> view<span class="token punctuation">.</span><span class="token function">findViewById</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>text_fruit_name<span class="token punctuation">)</span>        viewHolder <span class="token operator">=</span> <span class="token function">ViewHolder</span><span class="token punctuation">(</span><span class="token punctuation">(</span>image_fruit_item<span class="token punctuation">,</span> text_fruit_name<span class="token punctuation">)</span><span class="token punctuation">)</span>        view<span class="token punctuation">.</span>tag <span class="token operator">=</span> viewHolder    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// å¦åˆ™ç›´æ¥åŠ è½½</span>        view <span class="token operator">=</span> convertView        viewHolder <span class="token operator">=</span> view<span class="token punctuation">.</span>tag <span class="token keyword">as</span> ViewHolder    <span class="token punctuation">&#125;</span>    <span class="token keyword">val</span> fruit <span class="token operator">=</span> <span class="token function">getItem</span><span class="token punctuation">(</span>position<span class="token punctuation">)</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>fruit <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        viewHolder<span class="token punctuation">.</span>fruitImage<span class="token punctuation">.</span><span class="token function">setImageResource</span><span class="token punctuation">(</span>fruit<span class="token punctuation">.</span>imageId<span class="token punctuation">)</span>        viewHolder<span class="token punctuation">.</span>fruitName<span class="token punctuation">.</span>text <span class="token operator">=</span> fruit<span class="token punctuation">.</span>name    <span class="token punctuation">&#125;</span>    <span class="token keyword">return</span> view<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="ç‚¹å‡»äº‹ä»¶"><a class="markdownIt-Anchor" href="#ç‚¹å‡»äº‹ä»¶"></a> ç‚¹å‡»äº‹ä»¶</h2><p>ListView çš„ç‚¹å‡»äº‹ä»¶ä¼šå†’æ³¡åˆ° ListView å¯¹è±¡ä¸Šè¿›è¡Œç»Ÿä¸€å¤„ç†:</p><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin">list_main<span class="token punctuation">.</span><span class="token function">setOnItemClickListener</span> <span class="token punctuation">&#123;</span> adapterView<span class="token punctuation">,</span> view<span class="token punctuation">,</span> i<span class="token punctuation">,</span> l <span class="token operator">-></span>    <span class="token keyword">val</span> fruitItem <span class="token operator">=</span> fruitList<span class="token punctuation">[</span>i<span class="token punctuation">]</span>    Toast<span class="token punctuation">.</span><span class="token function">makeText</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> fruitItem<span class="token punctuation">.</span>name<span class="token punctuation">,</span> Toast<span class="token punctuation">.</span>LENGTH_SHORT<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token comment">// Tips ä¸ç”¨åˆ°çš„å‚æ•°å¯ä»¥éƒ½ä½¿ç”¨ _ æ›¿ä»£</span>list_main<span class="token punctuation">.</span><span class="token function">setOnItemClickListener</span> <span class="token punctuation">&#123;</span> _<span class="token punctuation">,</span> _<span class="token punctuation">,</span> i<span class="token punctuation">,</span> _ <span class="token operator">-></span>    <span class="token keyword">val</span> fruitItem <span class="token operator">=</span> fruitList<span class="token punctuation">[</span>i<span class="token punctuation">]</span>    Toast<span class="token punctuation">.</span><span class="token function">makeText</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> fruitItem<span class="token punctuation">.</span>name<span class="token punctuation">,</span> Toast<span class="token punctuation">.</span>LENGTH_SHORT<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="recyclerview"><a class="markdownIt-Anchor" href="#recyclerview"></a> RecyclerView</h1><p>(Why) ListView åœ¨æ€§èƒ½, æ‰©å±•æ€§ç­‰æ–¹é¢å­˜åœ¨é™åˆ¶, å› æ­¤ Android æä¾›äº†æ›´å¼ºå¤§çš„ RecycleView æ›¿ä»£å¹¶å¢å¼ºäº† ListView(ä¸åˆ é™¤æ˜¯ä¸ºäº†å‘ä¸‹é€‚åº”è€ç‰ˆæœ¬)</p><h2 id="quick-start-2"><a class="markdownIt-Anchor" href="#quick-start-2"></a> Quick Start</h2><ol><li><p>å‡†å¤‡å¥½æ•°æ®é¡¹çš„å¸ƒå±€</p></li><li><p>åˆ›å»º Adapter ç±»ï¼šå®ç° ViewHoder çš„å£°æ˜ä¸å®šä¹‰, å­é¡¹çš„èµ‹å€¼ç­‰åŸºæœ¬åŠŸèƒ½</p></li></ol><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">class</span> <span class="token function">RecyclerFruitAdapter</span><span class="token punctuation">(</span><span class="token keyword">val</span> fruitList<span class="token operator">:</span> List<span class="token operator">&lt;</span>Fruit<span class="token operator">></span><span class="token punctuation">)</span> <span class="token operator">:</span> RecyclerView<span class="token punctuation">.</span>Adapter<span class="token operator">&lt;</span>RecyclerFruitAdapter<span class="token punctuation">.</span>ViewHolder<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// å†…éƒ¨ç±» ViewHolder</span>    <span class="token comment">// ä¸»æ„é€ å‡½æ•°ä¸­è¦ä¼ å…¥ä¸€ä¸ª View å‚æ•° ä½œä¸º RecyclerView å­é¡¹çš„æœ€å¤–å±‚å¸ƒå±€</span>    <span class="token keyword">inner</span> <span class="token keyword">class</span> <span class="token function">ViewHolder</span><span class="token punctuation">(</span>view<span class="token operator">:</span> View<span class="token punctuation">)</span> <span class="token operator">:</span> RecyclerView<span class="token punctuation">.</span><span class="token function">ViewHolder</span><span class="token punctuation">(</span>view<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">val</span> fruitImage<span class="token operator">:</span> ImageView <span class="token operator">=</span> view<span class="token punctuation">.</span><span class="token function">findViewById</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>image_fruit_item<span class="token punctuation">)</span>        <span class="token keyword">val</span> fruitName<span class="token operator">:</span> TextView <span class="token operator">=</span> view<span class="token punctuation">.</span><span class="token function">findViewById</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>text_fruit_name<span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">// åˆ›å»º ViewHoldedr å®ä¾‹</span>    <span class="token comment">// å®ç°å¯¹ å­é¡¹å¸ƒå±€çš„åŠ è½½</span>    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">onCreateViewHolder</span><span class="token punctuation">(</span>parent<span class="token operator">:</span> ViewGroup<span class="token punctuation">,</span> viewType<span class="token operator">:</span> Int<span class="token punctuation">)</span><span class="token operator">:</span> ViewHolder <span class="token punctuation">&#123;</span>        <span class="token keyword">val</span> view <span class="token operator">=</span> LayoutInflater<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>parent<span class="token punctuation">.</span>context<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">inflate</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>layout<span class="token punctuation">.</span>fruit_item<span class="token punctuation">,</span> parent<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> <span class="token function">ViewHolder</span><span class="token punctuation">(</span>view<span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">// å¯¹å­é¡¹è¿›è¡Œèµ‹å€¼</span>    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">onBindViewHolder</span><span class="token punctuation">(</span>holder<span class="token operator">:</span> ViewHolder<span class="token punctuation">,</span> position<span class="token operator">:</span> Int<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">val</span> fruit <span class="token operator">=</span> fruitList<span class="token punctuation">[</span>position<span class="token punctuation">]</span>        holder<span class="token punctuation">.</span>fruitImage<span class="token punctuation">.</span><span class="token function">setImageResource</span><span class="token punctuation">(</span>fruit<span class="token punctuation">.</span>imageId<span class="token punctuation">)</span>        holder<span class="token punctuation">.</span>fruitName<span class="token punctuation">.</span>text <span class="token operator">=</span> fruit<span class="token punctuation">.</span>name    <span class="token punctuation">&#125;</span>    <span class="token comment">// å­é¡¹çš„æ•°ç›®</span>    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">getItemCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> fruitList<span class="token punctuation">.</span>size<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="3"><li>ä¸º RecyclerView æŒ‡å®šçˆ¶å¸ƒå±€å’Œ adapter</li></ol><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">val</span> recyclerView <span class="token operator">=</span> findViewById<span class="token operator">&lt;</span>RecyclerView<span class="token operator">></span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>recyclerView<span class="token punctuation">)</span><span class="token keyword">val</span> layoutManager <span class="token operator">=</span> <span class="token function">LinearLayoutManager</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>recyclerView<span class="token punctuation">.</span>layoutManager <span class="token operator">=</span> layoutManager<span class="token keyword">val</span> adapter <span class="token operator">=</span> <span class="token function">RecyclerFruitAdapter</span><span class="token punctuation">(</span>fruitList<span class="token punctuation">)</span>recyclerView<span class="token punctuation">.</span>adapter <span class="token operator">=</span> adapter<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="æ‰©å±•å¸ƒå±€"><a class="markdownIt-Anchor" href="#æ‰©å±•å¸ƒå±€"></a> æ‰©å±•å¸ƒå±€</h2><h3 id="æ°´å¹³æ’åˆ—"><a class="markdownIt-Anchor" href="#æ°´å¹³æ’åˆ—"></a> æ°´å¹³æ’åˆ—</h3><ol><li>é¦–å…ˆè®¾ç½®å¥½æ•°æ®å­é¡¹çš„å¸ƒå±€ï¼Œè‡³å°‘æ°´å¹³æ’åˆ—æ—¶ä¸èƒ½å ä¸€æ»¡è¡Œ</li><li>ç„¶åå†å»è®¾ç½® RecyclerView çš„çˆ¶å¸ƒå±€å³å¯</li></ol><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">val</span> layoutManager <span class="token operator">=</span> <span class="token function">LinearLayoutManager</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>layoutManager<span class="token punctuation">.</span>orientation <span class="token operator">=</span> LinearLayoutManager<span class="token punctuation">.</span>HORIZONTALrecyclerView<span class="token punctuation">.</span>layoutManager <span class="token operator">=</span> layoutManager<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h3 id="ç€‘å¸ƒæµå¸ƒå±€"><a class="markdownIt-Anchor" href="#ç€‘å¸ƒæµå¸ƒå±€"></a> ç€‘å¸ƒæµå¸ƒå±€</h3><ol><li>è®¾ç½®å¥½å­é¡¹çš„å¸ƒå±€</li></ol><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>LinearLayout</span> <span class="token attr-name"><span class="token namespace">xmlns:</span>android</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://schemas.android.com/apk/res/android<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">android:</span>orientation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>vertical<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">android:</span>layout_margin</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>5dp<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ImageView</span>        <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>40dp<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>40dp<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@+id/image_fruit_item<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>layout_gravity</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>center_horizontal<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>layout_marginTop</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>10dp<span class="token punctuation">"</span></span>        <span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>TextView</span>        <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@+id/text_fruit_name<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>layout_gravity</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>left<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>layout_marginTop</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>10dp<span class="token punctuation">"</span></span>        <span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>LinearLayout</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="2"><li>ä½¿ç”¨ <code>StaggeredGridLayoutManager</code></li></ol><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">val</span> recyclerView <span class="token operator">=</span> findViewById<span class="token operator">&lt;</span>RecyclerView<span class="token operator">></span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>recyclerView<span class="token punctuation">)</span><span class="token keyword">val</span> layoutManager <span class="token operator">=</span> <span class="token function">StaggeredGridLayoutManager</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> StaggeredGridLayoutManager<span class="token punctuation">.</span>VERTICAL<span class="token punctuation">)</span>recyclerView<span class="token punctuation">.</span>layoutManager <span class="token operator">=</span> layoutManager<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h2 id="ç‚¹å‡»äº‹ä»¶-2"><a class="markdownIt-Anchor" href="#ç‚¹å‡»äº‹ä»¶-2"></a> ç‚¹å‡»äº‹ä»¶</h2><p>Recycler ä¸ºäº†æ›´ç²¾ç»†çš„æ§åˆ¶, å°†ç‚¹å‡»äº‹ä»¶çš„ç»‘å®šç²¾ç»†åˆ°äº†æ¯ä¸€ä¸ªå­é¡¹, åœ¨ç”Ÿæˆå­é¡¹å¸ƒå±€ <code>onCreateViewHolder</code> æ—¶è¿›è¡Œå®šä¹‰</p><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token comment">// itemView è¡¨ç¤ºæœ€å¤–å±‚çš„å¸ƒå±€</span><span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">onCreateViewHolder</span><span class="token punctuation">(</span>parent<span class="token operator">:</span> ViewGroup<span class="token punctuation">,</span> viewType<span class="token operator">:</span> Int<span class="token punctuation">)</span><span class="token operator">:</span> ViewHolder <span class="token punctuation">&#123;</span>    <span class="token keyword">val</span> view <span class="token operator">=</span> LayoutInflater<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>parent<span class="token punctuation">.</span>context<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">inflate</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>layout<span class="token punctuation">.</span>todoitem_card<span class="token punctuation">,</span> parent<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span>    <span class="token keyword">val</span> holder <span class="token operator">=</span> <span class="token function">ViewHolder</span><span class="token punctuation">(</span>view<span class="token punctuation">)</span>    holder<span class="token punctuation">.</span>itemView<span class="token punctuation">.</span><span class="token function">setOnClickListener</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">val</span> position <span class="token operator">=</span> holder<span class="token punctuation">.</span>adapterPosition        <span class="token keyword">val</span> todoItem <span class="token operator">=</span> todoItemList<span class="token punctuation">[</span>position<span class="token punctuation">]</span>        <span class="token function">startTodoItemInfo</span><span class="token punctuation">(</span>todoItem<span class="token punctuation">.</span>id<span class="token punctuation">,</span> todoItem<span class="token punctuation">.</span>name<span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">return</span> holder<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="æ»‘åŠ¨äº‹ä»¶"><a class="markdownIt-Anchor" href="#æ»‘åŠ¨äº‹ä»¶"></a> æ»‘åŠ¨äº‹ä»¶</h2><p>è¿™é‡Œä»¥æ»‘åŠ¨åˆ é™¤äº‹ä»¶ä¸ºä¾‹è¿›è¡Œç®€å•ä»‹ç»</p><ol><li>é¦–å…ˆè¦å»ºç«‹è‡ªå·±çš„ç±», ç»§æ‰¿ <code>ItemTouchHelper.XXCallback</code> è¿™äº›å›è°ƒæ–¹æ³•, å¹¶å®ç°å›è°ƒå¤„ç†, å…¶ä¸­ onSwiped å°±æ˜¯æ»‘åŠ¨çš„æ£€æµ‹; ä¸¤ä¸ªå‚æ•°åˆ†åˆ«ä¸ºæ‹–åŠ¨çš„æ–¹å‘(ä¸€èˆ¬å®ç°ä¸¤ä¸ªç»„ä»¶é—´ä½ç½®äº¤äº’)ä¸æ»‘åŠ¨(ä¸€èˆ¬å®ç°ç›®æ ‡ç»„ä»¶çš„äº¤äº’)çš„æ–¹å‘, 0 è¡¨ç¤ºä¸å¯æ‹–åŠ¨æˆ–æ»‘åŠ¨, å…·ä½“æ–¹å‘ç”± ItemTouchHelper ä¸­çš„é™æ€å±æ€§åˆ†é…</li></ol><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">class</span> <span class="token function">BookItemTouchHelperCallback</span><span class="token punctuation">(</span><span class="token keyword">var</span> adapter<span class="token operator">:</span> RecyclerBookAdapter<span class="token punctuation">)</span><span class="token operator">:</span> ItemTouchHelper<span class="token punctuation">.</span><span class="token function">SimpleCallback</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> ItemTouchHelper<span class="token punctuation">.</span>LEFT<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">onMove</span><span class="token punctuation">(</span>        recyclerView<span class="token operator">:</span> RecyclerView<span class="token punctuation">,</span>        viewHolder<span class="token operator">:</span> RecyclerView<span class="token punctuation">.</span>ViewHolder<span class="token punctuation">,</span>        target<span class="token operator">:</span> RecyclerView<span class="token punctuation">.</span>ViewHolder    <span class="token punctuation">)</span><span class="token operator">:</span> Boolean <span class="token punctuation">&#123;</span>        <span class="token function">TODO</span><span class="token punctuation">(</span><span class="token string">"Not yet implemented"</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">onSwiped</span><span class="token punctuation">(</span>viewHolder<span class="token operator">:</span> RecyclerView<span class="token punctuation">.</span>ViewHolder<span class="token punctuation">,</span> direction<span class="token operator">:</span> Int<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">var</span> pos <span class="token operator">=</span> viewHolder<span class="token punctuation">.</span>adapterPosition        adapter<span class="token punctuation">.</span><span class="token function">deleteItem</span><span class="token punctuation">(</span>pos<span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="2"><li>ç„¶åå€ŸåŠ©å›è°ƒæ–¹æ³•çš„å®ä¾‹åˆ›å»º <code>ItemTouchHelper</code> å®ä¾‹, å¹¶ç»‘å®šåˆ°ç›®æ ‡ <code>RecyclerView</code> ä¸Š</li></ol><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">val</span> itemTouchHelper <span class="token operator">=</span> <span class="token function">ItemTouchHelper</span><span class="token punctuation">(</span><span class="token function">BookItemTouchHelperCallback</span><span class="token punctuation">(</span>adapter<span class="token punctuation">)</span><span class="token punctuation">)</span>itemTouchHelper<span class="token punctuation">.</span><span class="token function">attachToRecyclerView</span><span class="token punctuation">(</span>recycler<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h1 id="android-å›¾æ ‡"><a class="markdownIt-Anchor" href="#android-å›¾æ ‡"></a> Android å›¾æ ‡</h1><p>åº”ç”¨ç¨‹åºçš„å›¾æ ‡åº”è¯¥è¢«åˆ†ä¸ºä¸¤å±‚ï¼šå‰æ™¯å±‚å’ŒèƒŒæ™¯å±‚</p><ul><li>å‰æ™¯å±‚ç”¨æ¥å±•ç¤ºåº”ç”¨å›¾æ ‡çš„ Logo:</li><li>Mask å±‚: åœ¨å›¾æ ‡çš„å‰æ™¯å±‚å’ŒèƒŒæ™¯å±‚ä¹‹é—´, æ‰‹æœºå‚å•†è´Ÿè´£å®šä¹‰</li><li>èƒŒæ™¯å±‚ç”¨æ¥è¡¬æ‰˜åº”ç”¨å›¾æ ‡çš„ Logo: åªå…è®¸å®šä¹‰é¢œè‰²å’Œçº¹ç†ï¼Œä¸èƒ½å®šä¹‰å½¢çŠ¶</li></ul><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/202209181547481.png" alt="" /></p><ol><li>res ç›®å½•å¤„å³å‡» new/Image_Asssert</li><li>ä¿®æ”¹å‰æ™¯çš„ Logo å›¾ç‰‡ä¸èƒŒæ™¯è‰²</li></ol><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/202209181604700.png" alt="" /></p><h1 id="android-ç­¾åæ–‡ä»¶"><a class="markdownIt-Anchor" href="#android-ç­¾åæ–‡ä»¶"></a> Android ç­¾åæ–‡ä»¶</h1><h2 id="android-studio-ç”Ÿæˆ"><a class="markdownIt-Anchor" href="#android-studio-ç”Ÿæˆ"></a> Android Studio ç”Ÿæˆ</h2><ol><li>Build/Generate Singed Bundle/APK</li></ol><ul><li>Android App Bundle æ–‡ä»¶æ˜¯ç”¨äºä¸Šæ¶ Google Play å•†åº—çš„</li><li>APK for Android</li></ul><ol start="2"><li>å¡«å…¥ keystore æ–‡ä»¶çš„è·¯å¾„å’Œå¯†ç </li><li>Create New...</li></ol><ul><li>Validity æ˜¯ keystore æ–‡ä»¶çš„æœ‰æ•ˆæ—¶é•¿ï¼Œå•ä½æ˜¯å¹´</li></ul><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/202209181614822.png" alt="" /></p><h2 id="gradle-ç”Ÿæˆ-ignore"><a class="markdownIt-Anchor" href="#gradle-ç”Ÿæˆ-ignore"></a> Gradle ç”Ÿæˆ [Ignore]</h2><ol><li>ç¼–è¾‘ app/build.gradle æ–‡ä»¶</li></ol>]]></content>
      
      
      <categories>
          
          <category> Android Dev. </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Android </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>03-Android-Activity</title>
      <link href="/Coming-blog/2022/07/18/03-android-activity/"/>
      <url>/Coming-blog/2022/07/18/03-android-activity/</url>
      
        <content type="html"><![CDATA[<h1 id="activity"><a class="markdownIt-Anchor" href="#activity"></a> Activity</h1><p>Activityï¼šä¸€ç§å¯ä»¥åŒ…å«ç”¨æˆ·ç•Œé¢çš„ç»„ä»¶ï¼Œä¸»è¦ç”¨äºå’Œç”¨æˆ·è¿›è¡Œäº¤äº’</p><h2 id="åˆ›å»º-activity"><a class="markdownIt-Anchor" href="#åˆ›å»º-activity"></a> åˆ›å»º Activity</h2><p>åœ¨æˆ‘ä»¬çš„é¡¹ç›®åŒ…ä¸‹å³å‡»åˆ›å»º:</p><ul><li>Generate Layout File: è¡¨ç¤ºè‡ªåŠ¨ä¸º Activity åˆ›å»ºå¯¹åº”çš„å¸ƒå±€æ–‡ä»¶</li><li>Launcher Activity: è¡¨ç¤ºè‡ªåŠ¨å°† Activity è®¾ç½®ä¸ºå½“å‰é¡¹ç›®çš„ä¸» Activity</li></ul><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">package</span> com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>helloandroid<span class="token keyword">class</span> FirstActivity <span class="token operator">:</span> <span class="token function">AppCompatActivity</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">onCreate</span><span class="token punctuation">(</span>savedInstanceState<span class="token operator">:</span> Bundle<span class="token operator">?</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onCreate</span><span class="token punctuation">(</span>savedInstanceState<span class="token punctuation">)</span>        <span class="token function">setContentView</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>layout<span class="token punctuation">.</span>first_layout<span class="token punctuation">)</span>        Log<span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span><span class="token string">"MainActivity"</span><span class="token punctuation">,</span> <span class="token string">"onCreate execute"</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="åˆ›å»ºå¸ƒå±€"><a class="markdownIt-Anchor" href="#åˆ›å»ºå¸ƒå±€"></a> åˆ›å»ºå¸ƒå±€</h2><p>æ¯ä¸€ä¸ª Activity éƒ½åº”å¯¹åº”ä¸€ä¸ªå¸ƒå±€ï¼ˆé€»è¾‘å’Œè§†å›¾åˆ†ç¦»ï¼‰ï¼Œåœ¨ <code>app/src/main/res</code> ç›®å½•ä¸­çš„ <code>layout</code> æ–‡ä»¶å¤¹ä¸­åˆ›å»º <code>Layout resource file</code> å³å¯</p><ul><li>åœ¨å¸ƒå±€ä¸­è¿›è¡Œå¸ƒå±€çš„é…ç½®ä»¥åŠå¸ƒå±€ä¸­å…ƒç´ çš„é…ç½®</li></ul><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="utf-8"?></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>LinearLayout</span> <span class="token attr-name"><span class="token namespace">xmlns:</span>android</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://schemas.android.com/apk/res/android<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">xmlns:</span>tools</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://schemas.android.com/tools<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">android:</span>orientation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>vertical<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Button</span>        <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@+id/button1<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>text</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@string/main_title<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">tools:</span>ignore</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>MissingConstraints<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>LinearLayout</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="åŠ è½½å¸ƒå±€"><a class="markdownIt-Anchor" href="#åŠ è½½å¸ƒå±€"></a> åŠ è½½å¸ƒå±€</h2><p>å°†å¸ƒå±€åŠ è½½åˆ° Activity ä¸­: <code>setContentView(R.layout.first_layout)</code> æ–¹æ³•ä¸­ä¼ å…¥çš„æ˜¯ç›®æ ‡å¸ƒå±€æ–‡ä»¶çš„ id</p><blockquote><p>é¡¹ç›®ä¸­æ·»åŠ çš„ä»»ä½•èµ„æºéƒ½ä¼šåœ¨ R æ–‡ä»¶ä¸­ç”Ÿæˆä¸€ä¸ªç›¸åº”çš„èµ„æº id</p></blockquote><h2 id="æ³¨å†Œ-activity"><a class="markdownIt-Anchor" href="#æ³¨å†Œ-activity"></a> æ³¨å†Œ Activity</h2><p>æ‰€æœ‰çš„ Activity éƒ½è¦åœ¨ AndroidManifest.xml ä¸­è¿›è¡Œæ³¨å†Œæ‰èƒ½ç”Ÿæ•ˆ, æ³¨å†Œå£°æ˜æ”¾åœ¨ <code>&lt;application&gt;</code> æ ‡ç­¾å†…</p><ul><li>åœ¨è¿™é‡Œé…ç½® activity çš„åŸºæœ¬å±æ€§: åç§°(<code>name</code>), æ˜¯å¦å¯è¢«å…¶å®ƒ APP ä½¿ç”¨(<code>exported</code>), æ ‡é¢˜å(<code>label</code>)</li><li>é…ç½®æ˜¯å¦ä¸ºä¸» Activity <code>intent-filter</code></li></ul><p>Tips: å¦‚æœä½ çš„åº”ç”¨ç¨‹åºä¸­æ²¡æœ‰å£°æ˜ä»»ä½•ä¸€ä¸ª Activity ä½œä¸ºä¸» Activityï¼Œè¿™ä¸ªç¨‹åºä»ç„¶æ˜¯å¯ä»¥æ­£å¸¸å®‰è£…ï¼Œåªæ˜¯æ— æ³•åœ¨å¯åŠ¨å™¨ä¸­çœ‹åˆ°æˆ–è€…æ‰“å¼€è¿™ä¸ªç¨‹åº (è¿™ç§ç¨‹åºä¸€èˆ¬æ˜¯ä½œä¸ºç¬¬ä¸‰æ–¹æœåŠ¡ä¾›å…¶ä»–åº”ç”¨åœ¨å†…éƒ¨è¿›è¡Œè°ƒç”¨çš„)</p><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>activity</span>    <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>.FirstActivity<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">android:</span>exported</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">android:</span>label</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>This is FirstActivity<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>intent-filter</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>action</span> <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>android.intent.action.MAIN<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>action</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>category</span> <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>android.intent.category.LAUNCHER<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>category</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>intent-filter</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>activity</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="é”€æ¯-activity"><a class="markdownIt-Anchor" href="#é”€æ¯-activity"></a> é”€æ¯ Activity</h2><p>é€šè¿‡ Back é”®æˆ–è€… <code>finish()</code> æ–¹æ³•</p><h1 id="intent"><a class="markdownIt-Anchor" href="#intent"></a> Intent</h1><p>Intent æ˜¯ Android ç¨‹åºä¸­å„ç»„ä»¶ä¹‹é—´è¿›è¡Œäº¤äº’çš„ä¸€ç§é‡è¦æ–¹å¼ï¼Œå®ƒä¸ä»…å¯ä»¥æŒ‡æ˜å½“å‰ç»„ä»¶æƒ³è¦æ‰§è¡Œçš„åŠ¨ä½œï¼Œè¿˜å¯ä»¥åœ¨ä¸åŒç»„ä»¶ä¹‹é—´ä¼ é€’æ•°æ®</p><ul><li>Application: å¯åŠ¨ Activityã€å¯åŠ¨ Service ä»¥åŠå‘é€å¹¿æ’­</li></ul><h2 id="æ˜¾ç¤º-intent"><a class="markdownIt-Anchor" href="#æ˜¾ç¤º-intent"></a> æ˜¾ç¤º Intent</h2><ol><li>ä½¿ç”¨æ„é€ å‡½æ•°, å®šä¹‰æˆ‘ä»¬çš„æ„å›¾: <code>Intent(Context packageContext, Class&lt;?&gt; cls)</code></li></ol><ul><li>Context: å¯åŠ¨ Activity çš„ä¸Šä¸‹æ–‡</li><li>Class: æŒ‡å®šæƒ³è¦å¯åŠ¨çš„ç›®æ ‡ Activity</li></ul><ol start="2"><li>ä½¿ç”¨ <code>startActivity()</code> æ‰§è¡Œæˆ‘ä»¬çš„æ„å›¾: <code>startActivity(intent)</code></li></ol><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">val</span> button_main2first <span class="token operator">=</span> findViewById<span class="token operator">&lt;</span>Button<span class="token operator">></span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>button_main2first<span class="token punctuation">)</span>button_main2first<span class="token punctuation">.</span><span class="token function">setOnClickListener</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// åœ¨FirstActivit çš„ç¯å¢ƒä¸­æ‰“å¼€ SecondActivity</span>    <span class="token comment">// (kotlin) FirstActivity::class.java === FirstActivity.class (Java)</span>    <span class="token keyword">val</span> intent <span class="token operator">=</span> <span class="token function">Intent</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> FirstActivity<span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">.</span>java<span class="token punctuation">)</span>    <span class="token function">startActivity</span><span class="token punctuation">(</span>intent<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="éšå¼-intent"><a class="markdownIt-Anchor" href="#éšå¼-intent"></a> éšå¼ Intent</h2><p>å¹¶ä¸æ˜ç¡®æŒ‡å‡ºæƒ³è¦å¯åŠ¨å“ªä¸€ä¸ª Activityï¼Œè€Œæ˜¯æŒ‡å®šäº†ä¸€ç³»åˆ—æ›´ä¸ºæŠ½è±¡çš„ action å’Œ category ç­‰ä¿¡æ¯ï¼Œç„¶åäº¤ç”±ç³»ç»Ÿå»åˆ†æè¿™ä¸ª Intentï¼Œå¹¶å¸®æˆ‘ä»¬æ‰¾å‡ºåˆé€‚çš„ Activity å»å¯åŠ¨</p><ul><li>åœ¨ <code>AndroidManifest.xml</code> ä¸­çš„ <code>activity</code> æ ‡ç­¾ä¸­çš„ <code>intent-filter</code> ä¸­å¯ä»¥æŒ‡å®šå½“å‰ Activity èƒ½å¤Ÿå“åº”çš„ action å’Œ category</li></ul><p>åªæœ‰ <code>&lt;action&gt;</code> å’Œ <code>&lt;category&gt;</code> ä¸­çš„å†…å®¹åŒæ—¶åŒ¹é… Intent ä¸­æŒ‡å®šçš„ action å’Œ category æ—¶ï¼Œè¿™ä¸ª Activity æ‰èƒ½å“åº”è¯¥ Intent:</p><ul><li>å¯ä»¥æŒ‡å®šå¤šä¸ª category, ä½†æ˜¯å¿…é¡»è¦æŒ‡å®šèƒ½å¤Ÿå“åº” <code>android.intent.category.DEFAULT</code> è¿™ä¸ª category</li></ul><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>activity</span>    <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>.SecondActivity<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">android:</span>exported</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">android:</span>label</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@string/second_label<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>intent-filter</span><span class="token punctuation">></span></span>        <span class="token comment">&lt;!-- å¯ä»¥å“åº” com.example.activitytest.ACTION_START --></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>action</span> <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.comingpro.intent.INFO_SHOW<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>        <span class="token comment">&lt;!-- æŒ‡æ˜äº†å½“å‰ Activity èƒ½å¤Ÿå“åº”çš„ Intent ä¸­è¿˜å¯èƒ½å¸¦æœ‰çš„ category --></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>category</span> <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>android.intent.category.DEFAULT<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>category</span> <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.comingpro.category.SECOND<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>intent-filter</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>activity</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>éšå¼è°ƒç”¨: æ¯ä¸ª Intent ä¸­åªèƒ½æŒ‡å®šä¸€ä¸ª actionï¼Œä½†èƒ½æŒ‡å®šå¤šä¸ª category</p><ul><li>ä½¿ç”¨ <code>intent.addCategory()</code> æ–¹æ³•æ·»åŠ è‡ªå®šä¹‰çš„ category</li></ul><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">val</span> button_main2second <span class="token operator">=</span> findViewById<span class="token operator">&lt;</span>Button<span class="token operator">></span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>button_main2second<span class="token punctuation">)</span>button_main2second<span class="token punctuation">.</span><span class="token function">setOnClickListener</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">val</span> intent <span class="token operator">=</span> <span class="token function">Intent</span><span class="token punctuation">(</span><span class="token string">"com.comingpro.intent.INFO_SHOW"</span><span class="token punctuation">)</span>    intent<span class="token punctuation">.</span><span class="token function">addCategory</span><span class="token punctuation">(</span><span class="token string">"com.comingpro.category.SECOND"</span><span class="token punctuation">)</span>    <span class="token comment">// android.intent.category.DEFAULT æ˜¯ä¸€ç§é»˜è®¤çš„ category</span>    <span class="token comment">// åœ¨è°ƒç”¨ startActivity() æ–¹æ³•çš„æ—¶å€™ä¼šè‡ªåŠ¨å°†è¿™ä¸ª category æ·»åŠ åˆ° Intent ä¸­</span>    <span class="token function">startActivity</span><span class="token punctuation">(</span>intent<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="è·¨ç¨‹åºæ„å›¾"><a class="markdownIt-Anchor" href="#è·¨ç¨‹åºæ„å›¾"></a> è·¨ç¨‹åºæ„å›¾</h2><p>éšå¼ Intent å¯ä»¥å¯åŠ¨å…¶å®ƒç¨‹åºå†…çš„ Activity</p><h3 id="setdata"><a class="markdownIt-Anchor" href="#setdata"></a> setData()</h3><p><code>setData()</code> æ–¹æ³•æ¥æ”¶ä¸€ä¸ª <code>Uri</code> å¯¹è±¡, ç”¨äºæŒ‡å®šå½“å‰ Intent æ­£åœ¨æ“ä½œçš„æ•°æ®, è¿™äº›æ•°æ®é€šå¸¸æ˜¯ä»¥å­—ç¬¦ä¸²å½¢å¼ä¼ å…¥ <code>Uri.parse()</code> æ–¹æ³•ä¸­è§£æäº§ç”Ÿçš„</p><p>æ›´è¯¦ç»†çš„é…ç½® Data æ ¼å¼å¯ä»¥åœ¨ <code>&lt;intent-filter&gt;</code> ä¸­é…ç½®ä¸€ä¸ª <code>&lt;data&gt;</code> æ ‡ç­¾, è¡¨æ˜å½“å‰ Activity æ”¯æŒå¤„ç†çš„ Data ç±»å‹: åªæœ‰å½“ data æ ‡ç­¾ä¸­æŒ‡å®šçš„å†…å®¹å’Œ Intent ä¸­æºå¸¦çš„ Data å®Œå…¨ä¸€è‡´æ—¶ï¼Œå½“å‰ Activity æ‰èƒ½å¤Ÿå“åº”è¯¥ Intent</p><ul><li><code>a:scheme</code>: æŒ‡å®šæ•°æ®çš„åè®®éƒ¨åˆ†(https, ...)</li><li><code>a:host</code>: æŒ‡å®šæ•°æ®çš„ä¸»æœºåéƒ¨åˆ†(<a target="_blank" rel="noopener" href="http://www.baidu.com">www.baidu.com</a>, ...)</li><li><code>a:port</code>: æŒ‡å®šæ•°æ®çš„ç«¯å£éƒ¨åˆ†</li><li><code>a:path</code>: æŒ‡å®šä¸»æœºåå’Œç«¯å£ä¹‹åçš„éƒ¨åˆ†</li><li><code>a:mimeType</code>: æŒ‡å®šå¯ä»¥å¤„ç†çš„æ•°æ®ç±»å‹ï¼Œå…è®¸ä½¿ç”¨é€šé…ç¬¦çš„æ–¹å¼è¿›è¡ŒæŒ‡å®š</li></ul><h3 id="å¯åŠ¨æµè§ˆå™¨"><a class="markdownIt-Anchor" href="#å¯åŠ¨æµè§ˆå™¨"></a> å¯åŠ¨æµè§ˆå™¨</h3><p>ä½¿ç”¨æœ¬åœ°æ³¨å†Œå¥½çš„æµè§ˆå™¨æ‰“å¼€ç™¾åº¦:</p><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">val</span> button_baidu <span class="token operator">=</span> findViewById<span class="token operator">&lt;</span>Button<span class="token operator">></span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>button_baidu<span class="token punctuation">)</span>button_baidu<span class="token punctuation">.</span><span class="token function">setOnClickListener</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// Android ç³»ç»Ÿå†…ç½®åŠ¨ä½œï¼Œå…¶å¸¸é‡å€¼ä¸º android.intent.action.VIEW</span>    <span class="token keyword">val</span> intent <span class="token operator">=</span> <span class="token function">Intent</span><span class="token punctuation">(</span>Intent<span class="token punctuation">.</span>ACTION_VIEW<span class="token punctuation">)</span>    <span class="token comment">// é€šè¿‡ Uri.parse() æ–¹æ³•å°†ä¸€ä¸ªç½‘å€å­—ç¬¦ä¸²è§£ææˆä¸€ä¸ª Uri å¯¹è±¡</span>    <span class="token comment">// å†è°ƒç”¨ Intent çš„ setData() æ–¹æ³•å°†è¿™ä¸ª Uri å¯¹è±¡ä¼ é€’è¿›å»</span>    intent<span class="token punctuation">.</span>data <span class="token operator">=</span> Uri<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token string">"https://www.baidu.com"</span><span class="token punctuation">)</span>    <span class="token function">startActivity</span><span class="token punctuation">(</span>intent<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä½¿ç”¨æœ¬ç¨‹åºåˆ›å»ºçš„å­ Activity åŒ¹é… Intent:</p><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>activity</span>    <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>.FakeBaiduActivity<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">android:</span>exported</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">android:</span>label</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@string/fake_baidu_label<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>intent-filter</span> <span class="token attr-name"><span class="token namespace">tools:</span>ignore</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>AppLinkUrlError<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>action</span> <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>android.intent.action.VIEW<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>category</span> <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>android.intent.category.DEFAULT<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>data</span> <span class="token attr-name"><span class="token namespace">android:</span>scheme</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>intent-filter</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>activity</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/202207162046144.png" alt="" /></p><h3 id="æ‹¨æ‰“ç”µè¯"><a class="markdownIt-Anchor" href="#æ‹¨æ‰“ç”µè¯"></a> æ‹¨æ‰“ç”µè¯</h3><p>action ä¸ºå†…ç½®çš„ <code>Intent.ACTION_DIAL</code> æ¥æ”¶çš„æ•°æ®æ ¼å¼ä¸º <code>tel: 12345</code></p><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">val</span> button_call12345 <span class="token operator">=</span> findViewById<span class="token operator">&lt;</span>Button<span class="token operator">></span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>button_call12345<span class="token punctuation">)</span>button_call12345<span class="token punctuation">.</span><span class="token function">setOnClickListener</span> <span class="token punctuation">&#123;</span>     <span class="token keyword">val</span> intent <span class="token operator">=</span> <span class="token function">Intent</span><span class="token punctuation">(</span>Intent<span class="token punctuation">.</span>ACTION_DIAL<span class="token punctuation">)</span>    intent<span class="token punctuation">.</span>data <span class="token operator">=</span> Uri<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token string">"tel: 12345"</span><span class="token punctuation">)</span>    <span class="token function">startActivity</span><span class="token punctuation">(</span>intent<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/202207162054621.png" alt="" /></p><h2 id="æ´»åŠ¨é—´ä¼ é€’æ•°æ®"><a class="markdownIt-Anchor" href="#æ´»åŠ¨é—´ä¼ é€’æ•°æ®"></a> æ´»åŠ¨é—´ä¼ é€’æ•°æ®</h2><p>é‡è½½ <code>putExtra()</code> æ–¹æ³•, å°†æƒ³è¦ä¼ é€’çš„æ•°æ®æš‚å­˜åœ¨ Intent ä¸­è¿›è¡Œä¼ é€’å³å¯, é€šè¿‡ <code>key, value</code> çš„å½¢å¼ä¼ é€’ä¸è·å–</p><p>å‘é€æ•°æ®:</p><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">val</span> button_greet <span class="token operator">=</span> findViewById<span class="token operator">&lt;</span>Button<span class="token operator">></span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>button_greet<span class="token punctuation">)</span>button_greet<span class="token punctuation">.</span><span class="token function">setOnClickListener</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">val</span> intent <span class="token operator">=</span> <span class="token function">Intent</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> HelloActivity<span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">.</span>java<span class="token punctuation">)</span>    intent<span class="token punctuation">.</span><span class="token function">putExtra</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">,</span> <span class="token string">"Coming"</span><span class="token punctuation">)</span>    <span class="token function">startActivity</span><span class="token punctuation">(</span>intent<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ¥æ”¶æ•°æ®:</p><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">val</span> text_hello <span class="token operator">=</span> findViewById<span class="token operator">&lt;</span>TextView<span class="token operator">></span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>text_hello<span class="token punctuation">)</span><span class="token keyword">val</span> extra_data_name <span class="token operator">=</span> intent<span class="token punctuation">.</span><span class="token function">getStringExtra</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">)</span>text_hello<span class="token punctuation">.</span>text <span class="token operator">=</span> <span class="token string">"Hello <span class="token interpolation variable">$extra_data_name</span>"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h2 id="æ´»åŠ¨é—´è¿”å›æ•°æ®"><a class="markdownIt-Anchor" href="#æ´»åŠ¨é—´è¿”å›æ•°æ®"></a> æ´»åŠ¨é—´è¿”å›æ•°æ®</h2><p>ç›®æ ‡ Activity é”€æ¯åèƒ½ç»™ä¸Šçº§ Activity å“åº”æ¶ˆæ¯</p><ol><li>åœ¨å¯åŠ¨ç›®æ ‡ Activity å‰ä½¿ç”¨ <code>registerForActivityResult</code> æ³¨å†Œç»‘å®šä¸€ä¸ªå›è°ƒ, å¯¹ç›®æ ‡ Activity é”€æ¯åä¼ é€’çš„ä¿¡æ¯è¿›è¡Œå¤„ç†</li></ol><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">private</span> <span class="token keyword">val</span> greet_advanced_activity <span class="token operator">=</span> <span class="token function">registerForActivityResult</span><span class="token punctuation">(</span>ActivityResultContracts<span class="token punctuation">.</span><span class="token function">StartActivityForResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> result <span class="token operator">-></span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">.</span>resultCode <span class="token operator">==</span> Activity<span class="token punctuation">.</span>RESULT_OK<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">val</span> <span class="token keyword">data</span><span class="token operator">:</span> Intent<span class="token operator">?</span> <span class="token operator">=</span> result<span class="token punctuation">.</span>data        <span class="token keyword">val</span> name <span class="token operator">=</span> <span class="token keyword">data</span><span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">getStringExtra</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">)</span> <span class="token operator">?:</span> <span class="token string">"What?"</span>        <span class="token keyword">val</span> button_greet_advanced <span class="token operator">=</span> findViewById<span class="token operator">&lt;</span>Button<span class="token operator">></span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>button_greet_advanced<span class="token punctuation">)</span>        button_greet_advanced<span class="token punctuation">.</span>text <span class="token operator">=</span> <span class="token string">"Say <span class="token interpolation"><span class="token delimiter variable">$&#123;</span>name<span class="token delimiter variable">&#125;</span></span> Success!"</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="2"><li>ä½¿ç”¨è¿™ä¸ªå›è°ƒæ³¨å†Œçš„ <code>launch()</code> æ–¹æ³•å¯åŠ¨ç›®æ ‡ Activity</li></ol><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">val</span> button_greet_advanced <span class="token operator">=</span> findViewById<span class="token operator">&lt;</span>Button<span class="token operator">></span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>button_greet_advanced<span class="token punctuation">)</span>button_greet_advanced<span class="token punctuation">.</span><span class="token function">setOnClickListener</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">val</span> intent <span class="token operator">=</span> <span class="token function">Intent</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> HelloActivity<span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">.</span>java<span class="token punctuation">)</span>    intent<span class="token punctuation">.</span><span class="token function">putExtra</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">,</span> <span class="token string">"CJC"</span><span class="token punctuation">)</span>    greet_advanced_activity<span class="token punctuation">.</span><span class="token function">launch</span><span class="token punctuation">(</span>intent<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="3"><li>ç›®æ ‡ Activity ä¸­ç¼–å†™é”€æ¯åè¿”ä¼ çš„æ¶ˆæ¯</li></ol><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">val</span> button_back2main <span class="token operator">=</span> findViewById<span class="token operator">&lt;</span>Button<span class="token operator">></span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>button_info2main<span class="token punctuation">)</span>button_back2main<span class="token punctuation">.</span><span class="token function">setOnClickListener</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">val</span> intent <span class="token operator">=</span> <span class="token function">Intent</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    intent<span class="token punctuation">.</span><span class="token function">putExtra</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">,</span> <span class="token string">"CJC"</span><span class="token punctuation">)</span>    <span class="token function">setResult</span><span class="token punctuation">(</span>RESULT_OK<span class="token punctuation">,</span> intent<span class="token punctuation">)</span>    <span class="token function">finish</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/202207162141011.png" alt="" /></p><h2 id="æ´»åŠ¨é—´ä¼ é€’å¤æ‚æ•°æ®"><a class="markdownIt-Anchor" href="#æ´»åŠ¨é—´ä¼ é€’å¤æ‚æ•°æ®"></a> æ´»åŠ¨é—´ä¼ é€’å¤æ‚æ•°æ®</h2><h3 id="serializable"><a class="markdownIt-Anchor" href="#serializable"></a> Serializable</h3><p>é’ˆå¯¹è‡ªå®šä¹‰å¯¹è±¡æˆ–è‡ªå®šä¹‰å¯¹è±¡çš„åˆ—è¡¨, éœ€è¦å€ŸåŠ© <code>Serializable</code> æ¥å£æ·»åŠ å…¶åºåˆ—åŒ–ä¸ååºåˆ—åŒ–æ–¹æ³•</p><ul><li>åºåˆ—åŒ–åçš„å¯¹è±¡å¯ä»¥åœ¨ç½‘ç»œä¸Šè¿›è¡Œä¼ è¾“ï¼Œä¹Ÿå¯ä»¥å­˜å‚¨åˆ°æœ¬åœ°</li><li>è‡³äºåºåˆ—åŒ–çš„æ–¹æ³•éå¸¸ç®€å•ï¼Œåªéœ€è¦è®©ä¸€ä¸ªç±»å»å®ç° Serializable è¿™ä¸ªæ¥å£å°±å¯ä»¥äº†</li></ul><ol><li>åœ¨ç±»çš„å®šä¹‰ä¸­å£°æ˜å¯¹ <code>Serializable</code> æ¥å£çš„å®ç°</li></ol><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">class</span> <span class="token function">Book</span><span class="token punctuation">(</span><span class="token operator">..</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token operator">:</span> Serializable <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ol start="2"><li>ä¼ é€’æ—¶è¿›è¡Œåºåˆ—åŒ–</li></ol><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">fun</span> <span class="token function">actionStart</span><span class="token punctuation">(</span>context<span class="token operator">:</span> Context<span class="token punctuation">,</span> bookList<span class="token operator">:</span> ArrayList<span class="token operator">&lt;</span>Book<span class="token operator">></span><span class="token punctuation">,</span> book<span class="token operator">:</span> Book<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">val</span> intent <span class="token operator">=</span> <span class="token function">Intent</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> BookInfosActivity<span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">.</span>java<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">apply</span> <span class="token punctuation">&#123;</span>        <span class="token function">putExtra</span><span class="token punctuation">(</span><span class="token string">"bookList"</span><span class="token punctuation">,</span> bookList <span class="token keyword">as</span> Serializable<span class="token punctuation">)</span>         <span class="token function">putExtra</span><span class="token punctuation">(</span><span class="token string">"book"</span><span class="token punctuation">,</span> book<span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>    context<span class="token punctuation">.</span><span class="token function">startActivity</span><span class="token punctuation">(</span>intent<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="3"><li>æ¥å—æ—¶ååºåˆ—åŒ–</li></ol><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">val</span> booklist <span class="token operator">=</span> intent<span class="token punctuation">.</span><span class="token function">getSerializableExtra</span><span class="token punctuation">(</span><span class="token string">"bookList"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> ArrayList<span class="token operator">&lt;</span>Book<span class="token operator">></span><span class="token keyword">val</span> book <span class="token operator">=</span> intent<span class="token punctuation">.</span><span class="token function">getSerializableExtra</span><span class="token punctuation">(</span><span class="token string">"book"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> Book<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="parcelable"><a class="markdownIt-Anchor" href="#parcelable"></a> Parcelable</h3><p>Parcelable æ–¹å¼çš„å®ç°åŸç†æ˜¯å°†ä¸€ä¸ªå®Œæ•´çš„å¯¹è±¡è¿›è¡Œåˆ†è§£ï¼Œä½¿å¾—åˆ†è§£åçš„æ¯ä¸€éƒ¨åˆ†éƒ½æ˜¯ Intent æ‰€æ”¯æŒçš„æ•°æ®ç±»å‹ï¼Œè¿™æ ·å°±èƒ½å®ç°ä¼ é€’å¯¹è±¡çš„åŠŸèƒ½äº†</p><ul><li>ç®€å•å®ç°</li></ul><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token annotation builtin">@Parcelize</span><span class="token keyword">class</span> <span class="token function">Person</span><span class="token punctuation">(</span><span class="token keyword">var</span> name<span class="token operator">:</span> String<span class="token punctuation">,</span> <span class="token keyword">var</span> age<span class="token operator">:</span> Int<span class="token punctuation">)</span> <span class="token operator">:</span> Parcelable<span class="token keyword">val</span> person <span class="token operator">=</span> intent<span class="token punctuation">.</span><span class="token function">getParcelableExtra</span><span class="token punctuation">(</span><span class="token string">"person_data"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> Person<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><ul><li>ç»†èŠ‚å¤„ç†</li></ul><ol><li>å®ç° Parcelable æ¥å£, é‡å†™ describeContents() å’Œ writeToParcel() è¿™ä¸¤ä¸ªæ–¹æ³•</li></ol><ul><li>describeContents() æ–¹æ³•ç›´æ¥è¿”å› 0 å°±å¯ä»¥</li><li>writeToParcel() æ–¹æ³•éœ€è¦è°ƒç”¨ Parcel çš„ writeXxx() æ–¹æ³•ï¼Œå°† Person ç±»ä¸­çš„å­—æ®µä¸€ä¸€å†™å‡º</li></ul><ol start="2"><li>é¡»åœ¨ Person ç±»ä¸­æä¾›ä¸€ä¸ªåä¸º CREATOR çš„åŒ¿åç±»å®ç°; åˆ›å»ºäº† Parcelable.Creator æ¥å£çš„ä¸€ä¸ªå®ç°ï¼Œå¹¶å°†æ³›å‹æŒ‡å®šä¸º Person; æ¥ç€éœ€è¦é‡å†™ createFromParcel() å’Œ newArray() è¿™ä¸¤ä¸ªæ–¹æ³•</li></ol><ul><li>åœ¨ createFromParcel() è¦åˆ›å»ºä¸€ä¸ª Person å¯¹è±¡è¿›è¡Œè¿”å›ï¼Œå¹¶è¯»å–åˆšæ‰å†™å‡ºçš„ name å’Œ age å­—æ®µ</li><li>newArray() æ–¹æ³•éœ€è¦è°ƒç”¨ arrayOfNulls() æ–¹æ³•ï¼Œå¹¶ä½¿ç”¨å‚æ•°ä¸­ä¼ å…¥çš„ size ä½œä¸ºæ•°ç»„å¤§å°ï¼Œåˆ›å»ºä¸€ä¸ªç©ºçš„ Person æ•°ç»„å³å¯</li></ul><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">class</span> Person <span class="token operator">:</span> Parcelable <span class="token punctuation">&#123;</span>    <span class="token keyword">var</span> name <span class="token operator">=</span> <span class="token string">""</span>    <span class="token keyword">var</span> age <span class="token operator">=</span> <span class="token number">0</span>    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">writeToParcel</span><span class="token punctuation">(</span>parcel<span class="token operator">:</span> Parcel<span class="token punctuation">,</span> flags<span class="token operator">:</span> Int<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        parcel<span class="token punctuation">.</span><span class="token function">writeString</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span> <span class="token comment">// å†™å‡ºname</span>        parcel<span class="token punctuation">.</span><span class="token function">writeInt</span><span class="token punctuation">(</span>age<span class="token punctuation">)</span> <span class="token comment">// å†™å‡ºage</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">describeContents</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> Int <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token number">0</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">companion</span> <span class="token keyword">object</span> CREATOR <span class="token operator">:</span> Parcelable<span class="token punctuation">.</span>Creator<span class="token operator">&lt;</span>Person<span class="token operator">></span> <span class="token punctuation">&#123;</span>        <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">createFromParcel</span><span class="token punctuation">(</span>parcel<span class="token operator">:</span> Parcel<span class="token punctuation">)</span><span class="token operator">:</span> Person <span class="token punctuation">&#123;</span>            <span class="token keyword">val</span> person <span class="token operator">=</span> <span class="token function">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token comment">// é¡ºåºä¸€è‡´</span>            person<span class="token punctuation">.</span>name <span class="token operator">=</span> parcel<span class="token punctuation">.</span><span class="token function">readString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">?:</span> <span class="token string">""</span> <span class="token comment">// è¯»å–name</span>            person<span class="token punctuation">.</span>age <span class="token operator">=</span> parcel<span class="token punctuation">.</span><span class="token function">readInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// è¯»å–age</span>            <span class="token keyword">return</span> person        <span class="token punctuation">&#125;</span>        <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">newArray</span><span class="token punctuation">(</span>size<span class="token operator">:</span> Int<span class="token punctuation">)</span><span class="token operator">:</span> Array<span class="token operator">&lt;</span>Person<span class="token operator">?</span><span class="token operator">></span> <span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> <span class="token function">arrayOfNulls</span><span class="token punctuation">(</span>size<span class="token punctuation">)</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="3"><li>è·å–æ•°æ®</li></ol><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">val</span> person <span class="token operator">=</span> intent<span class="token punctuation">.</span><span class="token function">getParcelableExtra</span><span class="token punctuation">(</span><span class="token string">"person_data"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> Person<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h1 id="ç”Ÿå‘½å‘¨æœŸ"><a class="markdownIt-Anchor" href="#ç”Ÿå‘½å‘¨æœŸ"></a> ç”Ÿå‘½å‘¨æœŸ</h1><p>Android ä¸­çš„ Activity æ˜¯å¯ä»¥å±‚å çš„ï¼šæ¯å¯åŠ¨ä¸€ä¸ªæ–°çš„ Activityï¼Œå°±ä¼šè¦†ç›–åœ¨åŸ Activity ä¹‹ä¸Šï¼Œç„¶åç‚¹å‡» Back é”®ä¼šé”€æ¯æœ€ä¸Šé¢çš„ Activityï¼Œä¸‹é¢çš„ä¸€ä¸ª Activity å°±ä¼šé‡æ–°æ˜¾ç¤ºå‡ºæ¥</p><p>Android ä½¿ç”¨ä»»åŠ¡ï¼ˆTaskï¼‰æ¥ç®¡ç†æ´»åŠ¨çš„ï¼šä¸€ä¸ªä»»åŠ¡å°±æ˜¯ä¸€ç»„å­˜æ”¾åœ¨æ ˆé‡Œçš„ Activity çš„é›†åˆï¼Œè¿™ä¸ªæ ˆä¹Ÿè¢«ç§°ä½œè¿”å›æ ˆï¼ˆBack Stackï¼‰</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/202207170842696.png" alt="" /></p><h2 id="activity-çŠ¶æ€"><a class="markdownIt-Anchor" href="#activity-çŠ¶æ€"></a> Activity çŠ¶æ€</h2><ol><li>è¿è¡ŒçŠ¶æ€ï¼šæ´»åŠ¨å¤„äºæ ˆé¡¶</li><li>æš‚åœçŠ¶æ€ï¼šä¸å†å¤„äºæ ˆé¡¶ï¼Œä½†ä»ç„¶å¯è§ï¼ˆå¹¶ä¸æ˜¯æ¯ä¸€ä¸ªæ´»åŠ¨éƒ½å æ»¡æ•´ä¸ªå±å¹•ï¼šå¯¹è¯æ¡†ï¼‰</li><li>åœæ­¢çŠ¶æ€ï¼šéæ ˆé¡¶ + å®Œå…¨ä¸å¯è§ï¼ˆç³»ç»Ÿä»ç„¶ä¼šä¸ºè¿™ç§ Activity ä¿å­˜ç›¸åº”çš„çŠ¶æ€å’Œæˆå‘˜å˜é‡ï¼‰</li><li>é”€æ¯çŠ¶æ€ï¼šä»è¿”å›æ ˆä¸­ç§»é™¤å</li></ol><p>Tips: ç³»ç»Ÿå›æ”¶çš„ä¼˜å…ˆçº§, å³å½“å†…å­˜ä¸è¶³æ—¶ä¼šä¼˜å…ˆå›æ”¶(é”€æ¯çŠ¶æ€, åœæ­¢çŠ¶æ€); è¿è¡ŒçŠ¶æ€ä¸æš‚åœçŠ¶æ€æ—¶å¯è§çš„, å›æ”¶ä¼šå½±å“ç”¨æˆ·ä½“éªŒã€‚</p><h2 id="ç”Ÿå‘½å‘¨æœŸçš„å›è°ƒ"><a class="markdownIt-Anchor" href="#ç”Ÿå‘½å‘¨æœŸçš„å›è°ƒ"></a> ç”Ÿå‘½å‘¨æœŸçš„å›è°ƒ</h2><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/202207170846189.png" alt="" /></p><p>Activity ç±»ä¸­å®šä¹‰äº† 7 ä¸ªå›è°ƒæ–¹æ³•ï¼Œè¦†ç›–äº† Activity ç”Ÿå‘½å‘¨æœŸçš„æ¯ä¸€ä¸ªç¯èŠ‚:</p><ul><li><code>onCreate()</code>ï¼šæ´»åŠ¨ç¬¬ä¸€æ¬¡è¢«åˆ›å»ºæ—¶è°ƒç”¨ï¼ˆåˆå§‹åŒ–æ“ä½œï¼šåŠ è½½å¸ƒå±€ï¼Œç»‘å®šäº‹ä»¶ï¼‰</li><li><code>onStart()</code>ï¼šæ´»åŠ¨ç”±ä¸å¯è§å˜ä¸ºå¯è§æ—¶è°ƒç”¨</li><li><code>onResume()</code>ï¼šæ´»åŠ¨ï¼ˆæ ˆé¡¶+è¿è¡Œæ€ï¼‰å‡†å¤‡å¥½å’Œç”¨æˆ·è¿›è¡Œäº¤äº’çš„æ—¶å€™è°ƒç”¨</li><li><code>onPause()</code>ï¼šç³»ç»Ÿå‡†å¤‡å»å¯åŠ¨æˆ–æ¢å¤å¦ä¸€ä¸ªæ´»åŠ¨çš„æ—¶å€™è°ƒç”¨<ul><li>é€šå¸¸ä¼šåœ¨è¿™ä¸ªæ–¹æ³•ä¸­å°†ä¸€äº›æ¶ˆè€— CPU çš„èµ„æºé‡Šæ”¾æ‰ï¼Œä»¥åŠä¿å­˜ä¸€äº›å…³é”®æ•°æ®</li><li>ä½†è¿™ä¸ªæ–¹æ³•çš„æ‰§è¡Œé€Ÿåº¦ä¸€å®šè¦å¿«ï¼Œä¸ç„¶ä¼šå½±å“åˆ°æ–°çš„æ ˆé¡¶ Activity çš„ä½¿ç”¨</li></ul></li><li><code>onStop()</code>ï¼šåœ¨æ´»åŠ¨å®Œå…¨ä¸å¯è§çš„æ—¶å€™è°ƒç”¨<ul><li>å¦‚æœå¯åŠ¨çš„æ–° Activity æ˜¯ä¸€ä¸ªå¯¹è¯æ¡†å¼çš„ Activityï¼Œé‚£ä¹ˆ onPause() æ–¹æ³•ä¼šå¾—åˆ°æ‰§è¡Œï¼Œè€Œ onStop() æ–¹æ³•å¹¶ä¸ä¼šæ‰§è¡Œ</li></ul></li><li><code>onDestroy()</code>ï¼šæ´»åŠ¨è¢«é”€æ¯å‰æ‰§è¡Œ</li><li><code>onRestart()</code>ï¼šæ´»åŠ¨ç”±åœæ­¢çŠ¶æ€å˜ä¸ºè¿è¡ŒçŠ¶æ€ä¹‹å‰è°ƒç”¨</li></ul><p>ä»¥ä¸Š 7 ä¸ªæ–¹æ³•ä¸­é™¤äº† onRestart() æ–¹æ³•ï¼Œå…¶ä»–éƒ½æ˜¯ä¸¤ä¸¤ç›¸å¯¹çš„ï¼Œä»è€Œåˆå¯ä»¥å°† Activity åˆ†ä¸ºä»¥ä¸‹ 3 ç§ç”Ÿå­˜æœŸ:</p><ul><li>å®Œæ•´ç”Ÿå­˜æœŸï¼šonCreate() æ–¹æ³•å’Œ onDestroy() æ–¹æ³•ä¹‹é—´ç»å†çš„<ul><li>onCreate() å®Œæˆå„ç§åˆå§‹åŒ–, onDestroy() å®Œæˆå„ç§é‡Šæ”¾å·¥ä½œ</li></ul></li><li>å¯è§ç”Ÿå­˜æœŸï¼šonStart() æ–¹æ³• å’Œ onStop() æ–¹æ³•ä¹‹é—´ï¼ˆActivity æ€»æ˜¯å¯è§çš„ï¼‰<ul><li>onStart() å¯¹èµ„æºè¿›è¡ŒåŠ è½½, onStop() å¯¹èµ„æºè¿›è¡Œé‡Šæ”¾(ä¿è¯å¤„äºåœæ­¢çŠ¶æ€çš„ Activity ä¸ä¼šå ç”¨è¿‡å¤šå†…å­˜)</li></ul></li><li>å‰å°ç”Ÿå­˜æœŸï¼šonResume() æ–¹æ³• å’Œ onPause() æ–¹æ³•ä¹‹é—´ï¼Œæ´»åŠ¨æ€»æ˜¯å¤„äºè¿è¡ŒçŠ¶æ€, å¯ä»¥ä¸ç”¨æˆ·è¿›è¡Œäº¤äº’, æœ€å¸¸è§</li></ul><h3 id="æµ‹è¯•ç”Ÿå‘½å‘¨æœŸæ‰§è¡Œè¿‡ç¨‹"><a class="markdownIt-Anchor" href="#æµ‹è¯•ç”Ÿå‘½å‘¨æœŸæ‰§è¡Œè¿‡ç¨‹"></a> æµ‹è¯•ç”Ÿå‘½å‘¨æœŸæ‰§è¡Œè¿‡ç¨‹</h3><ol><li><p>MainActivity åˆšåˆšå¯åŠ¨, å…ˆåæ‰§è¡Œä¸‰ä¸ªç”Ÿå‘½å‘¨æœŸ: <code>onCreate(), onStart(), onResume()</code></p></li><li><p>MainActivity æ‰“å¼€ NormalActivity æ—¶ä¼šå…ˆåæ‰§è¡Œä¸¤ä¸ªç”Ÿå‘½å‘¨æœŸ: <code>onPause(), onStop()</code></p></li><li><p>é€šè¿‡ Back é”®ä» NormalActivity ä¸­è¿”å›åˆ° MainActivity æ—¶, å…ˆåæ‰§è¡Œä¸‰ä¸ªç”Ÿå‘½å‘¨æœŸ: <code>onRestart(), onStart(), onResume()</code></p></li><li><p>MainActivity æ‰“å¼€ DialogActivity æ—¶ä¼šæ‰§è¡Œ: <code>onPause()</code> ï¼ˆåª Pause æœª Stopï¼‰</p></li><li><p>é€šè¿‡ Back é”®ä» DialogActivity ä¸­è¿”å›åˆ° MainActivity æ—¶, æ‰§è¡Œ: <code>onResume()</code></p></li><li><p>é€šè¿‡ Back é”®é€€å‡ºç¨‹åº, å…ˆåæ‰§è¡Œ: <code>onPause(), onStop(), onDestroy()</code></p></li></ol><h3 id="æ´»åŠ¨è¢«æ„å¤–é”€æ¯çš„å¤„ç†åŠæ³•"><a class="markdownIt-Anchor" href="#æ´»åŠ¨è¢«æ„å¤–é”€æ¯çš„å¤„ç†åŠæ³•"></a> æ´»åŠ¨è¢«æ„å¤–é”€æ¯çš„å¤„ç†åŠæ³•</h3><p>å¦‚æœå› ä¸ºå†…å­˜åŸå› å°†åœæ­¢çŠ¶æ€çš„æ´»åŠ¨é”€æ¯äº†, é€šè¿‡ Back é”®è¿”å›è¯¥æ´»åŠ¨, ä¼šæ‰§è¡Œ <code>onCreate()</code> é‡æ–°åˆ›å»ºè¯¥æ´»åŠ¨, ä½†æ˜¯æ´»åŠ¨ä¸­çš„çŠ¶æ€æ•°æ®éƒ½ä¸¢å¤±äº†, å› æ­¤ Android æä¾›äº† <code>onSaveInstanceState()</code> æ–¹æ³•, å…¶åœ¨ Activity è¢«å›æ”¶å‰è°ƒç”¨, å¯¹ä¸´æ—¶æ•°æ®è¿›è¡Œä¿å­˜</p><p>onSaveInstanceState() æ–¹æ³•ï¼šæ´»åŠ¨è¢«å›æ”¶ä¹‹å‰è°ƒç”¨ï¼Œæºå¸¦ä¸€ä¸ª Bundle ç±»å‹çš„å‚æ•°ï¼ŒBundle æä¾›äº†ä¸€ç³»åˆ—æ–¹æ³•ä¿å­˜æ•°æ®<code>putString putInt ...</code></p><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">onSaveInstanceState</span><span class="token punctuation">(</span>outState<span class="token operator">:</span> Bundle<span class="token punctuation">,</span> outPersistentState<span class="token operator">:</span> PersistableBundle<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onSaveInstanceState</span><span class="token punctuation">(</span>outState<span class="token punctuation">,</span> outPersistentState<span class="token punctuation">)</span>    <span class="token keyword">val</span> userName <span class="token operator">=</span> <span class="token string">"Coming"</span>    outState<span class="token punctuation">.</span><span class="token function">putString</span><span class="token punctuation">(</span><span class="token string">"userName"</span><span class="token punctuation">,</span> userName<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>onCreate()</code> ä¼šæ¥æ”¶ä¸€ä¸ª saveInstanceState å‚æ•°, é»˜è®¤ä¸º null, ä¸ä¸ºç©ºæ—¶è¡¨ç¤ºè¦è¿›è¡Œæ¢å¤å¤„ç†:</p><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">onCreate</span><span class="token punctuation">(</span>savedInstanceState<span class="token operator">:</span> Bundle<span class="token operator">?</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>savedInstanceState <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">val</span> userName <span class="token operator">=</span> savedInstanceState<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">"userName"</span><span class="token punctuation">)</span>        Log<span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>tag<span class="token punctuation">,</span> <span class="token string">"Name is <span class="token interpolation variable">$userName</span>"</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="å¯åŠ¨æ¨¡å¼"><a class="markdownIt-Anchor" href="#å¯åŠ¨æ¨¡å¼"></a> å¯åŠ¨æ¨¡å¼</h1><p>å¯åŠ¨æ¨¡å¼ä¼šå®šä¹‰ç›®æ ‡æ´»åŠ¨çš„å¯åŠ¨æ–¹å¼ï¼Œå¦‚æ–°å»ºä¸€ä¸ªç›®æ ‡æ´»åŠ¨çš„å®ä¾‹æˆ–è€…ç”¨æœªé”€æ¯çš„æ—§å®ä¾‹ç­‰ç­‰ï¼Œåœ¨äº¤äº’æ–¹é¢å‘æŒ¥é‡è¦ä½œç”¨</p><ul><li>å¯åŠ¨æ¨¡å¼ä¸€å…±æœ‰ 4 ç§ï¼Œåˆ†åˆ«æ˜¯ standardã€singleTopã€singleTask å’Œ singleInstance</li><li>åœ¨ AndroidManifest.xml ä¸­é€šè¿‡ç»™ <activity> æ ‡ç­¾æŒ‡å®š android:launchMode å±æ€§æ¥é€‰æ‹©å¯åŠ¨æ¨¡å¼</li></ul><h2 id="standard"><a class="markdownIt-Anchor" href="#standard"></a> standard</h2><p>é»˜è®¤çš„å¯åŠ¨æ¨¡å¼ï¼Œæ¯å½“å¯åŠ¨ä¸€ä¸ªæ–°çš„æ´»åŠ¨ï¼Œéƒ½ä¼šåˆ›å»ºè¯¥æ´»åŠ¨çš„ä¸€ä¸ªæ–°çš„å®ä¾‹ï¼Œå…¥æ ˆï¼Œå¹¶å¤„äºæ ˆé¡¶ä½ç½®</p><ul><li>ç³»ç»Ÿä¸ä¼šåœ¨ä¹è¿™ä¸ª Activity æ˜¯å¦å·²ç»åœ¨è¿”å›æ ˆä¸­å­˜åœ¨ï¼Œæ¯æ¬¡å¯åŠ¨éƒ½ä¼šåˆ›å»ºä¸€ä¸ªè¯¥ Activity çš„æ–°å®ä¾‹</li></ul><h2 id="singletop"><a class="markdownIt-Anchor" href="#singletop"></a> singleTop</h2><p>å¯åŠ¨æ´»åŠ¨æ—¶ï¼Œå¦‚æœå‘ç°è¿”å›æ ˆçš„æ ˆé¡¶å·²ç»æ˜¯è¯¥æ´»åŠ¨ï¼Œåˆ™è®¤ä¸ºå¯ä»¥ç›´æ¥ä½¿ç”¨å®ƒ</p><ul><li>ç›®æ ‡æ´»åŠ¨ä¸å¤„äºæ ˆé¡¶æ—¶ï¼Œä»ä¼šåˆ›å»ºæ–°çš„æ´»åŠ¨å®ä¾‹ã€‚</li></ul><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/202207171009445.png" alt="" /></p><h2 id="singletask"><a class="markdownIt-Anchor" href="#singletask"></a> singleTask</h2><p>å¯åŠ¨ç›®æ ‡æ´»åŠ¨(A)æ—¶ä¼šåœ¨è¿”å›æ ˆä¸­æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨è¯¥æ´»åŠ¨çš„å®ä¾‹(a)ï¼Œå¦‚æœå‘ç°å·²ç»å­˜åœ¨åˆ™ç›´æ¥ä½¿ç”¨è¯¥å®ä¾‹(a)ï¼Œå¹¶æŠŠ(a)ä¹‹ä¸Šçš„æ‰€æœ‰æ´»åŠ¨å®ä¾‹å‡ºæ ˆ</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/202207171016399.png" alt="" /></p><h2 id="singleinstance"><a class="markdownIt-Anchor" href="#singleinstance"></a> singleInstance</h2><p>å¯åŠ¨æ´»åŠ¨æ—¶ä¼šå¯ç”¨ä¸€ä¸ªæ–°çš„è¿”å›æ ˆæ¥ç®¡ç†è¿™ä¸ªæ´»åŠ¨</p><p>Application: å…¶ä»–ç¨‹åºå’Œæˆ‘ä»¬çš„ç¨‹åºå¯ä»¥å…±äº«è¿™ä¸ª Activity çš„å®ä¾‹æ—¶, ä½¿ç”¨ singleInstance æ¨¡å¼ä¼šæœ‰ä¸€ä¸ªå•ç‹¬çš„è¿”å›æ ˆæ¥ç®¡ç†è¿™ä¸ª Activityï¼Œä¹Ÿå°±è§£å†³äº†å…±äº«Activityå®ä¾‹çš„é—®é¢˜</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/202207171020987.png" alt="" /></p><h2 id="æ´»åŠ¨å¸¸ç”¨æ–¹æ³•"><a class="markdownIt-Anchor" href="#æ´»åŠ¨å¸¸ç”¨æ–¹æ³•"></a> æ´»åŠ¨å¸¸ç”¨æ–¹æ³•</h2><h3 id="å½“å‰å¯è§æ´»åŠ¨åç§°"><a class="markdownIt-Anchor" href="#å½“å‰å¯è§æ´»åŠ¨åç§°"></a> å½“å‰å¯è§æ´»åŠ¨åç§°</h3><ol><li>åˆ›å»ºä¸€ä¸ª BaseActivity ç±»</li></ol><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">open</span> <span class="token keyword">class</span> BaseActivity <span class="token operator">:</span> <span class="token function">AppCompatActivity</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">onCreate</span><span class="token punctuation">(</span>savedInstanceState<span class="token operator">:</span> Bundle<span class="token operator">?</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onCreate</span><span class="token punctuation">(</span>savedInstanceState<span class="token punctuation">)</span>        <span class="token comment">// javaClass == getClass()</span>        Log<span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span><span class="token string">"BaseActivity"</span><span class="token punctuation">,</span> javaClass<span class="token punctuation">.</span>simpleName<span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="ç»Ÿä¸€æ´»åŠ¨ç®¡ç†"><a class="markdownIt-Anchor" href="#ç»Ÿä¸€æ´»åŠ¨ç®¡ç†"></a> ç»Ÿä¸€æ´»åŠ¨ç®¡ç†</h3><p>å½“æˆ‘ä»¬çš„æ´»åŠ¨æ ˆä¸­å­˜åœ¨ä¸‰ä¸ª Activity æ—¶, å¦‚ä½•ç›´æ¥é€€å‡ºç¨‹åºå‘¢? è¿™å°±éœ€è¦ä¸€ä¸ªæ•°æ®ç»“æ„ <code>ActivityCollector()</code> å»ç»´æŠ¤æ‰€æœ‰ Activity çš„çŠ¶æ€, å¹¶ç»Ÿä¸€æ§åˆ¶å…¶è¡Œä¸º</p><ol><li>æ–°å»º ActivityCollector ç±»</li></ol><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">class</span> ActivityCollector <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token keyword">val</span> activityCollector <span class="token operator">=</span> ArrayList<span class="token operator">&lt;</span>Activity<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">fun</span> <span class="token function">addActivity</span><span class="token punctuation">(</span>activity<span class="token operator">:</span> Activity<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        activityCollector<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>activity<span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">fun</span> <span class="token function">removeActivity</span><span class="token punctuation">(</span>activity<span class="token operator">:</span> Activity<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        activityCollector<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>activity<span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">fun</span> <span class="token function">finishAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span> activity <span class="token keyword">in</span> activityCollector <span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>activity<span class="token punctuation">.</span>isFinishing<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                activity<span class="token punctuation">.</span><span class="token function">finish</span><span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>        activityCollector<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token comment">// é”€æ¯å½“å‰è¿›ç¨‹</span>        android<span class="token punctuation">.</span>os<span class="token punctuation">.</span>Process<span class="token punctuation">.</span><span class="token function">killProcess</span><span class="token punctuation">(</span>android<span class="token punctuation">.</span>os<span class="token punctuation">.</span>Process<span class="token punctuation">.</span><span class="token function">myPid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="2"><li>åœ¨ BaseActivity åŸºç±»ä¸­è¿›è¡Œå°è£…ç»´æŠ¤</li></ol><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">open</span> <span class="token keyword">class</span> BaseActivity <span class="token operator">:</span> <span class="token function">AppCompatActivity</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">onCreate</span><span class="token punctuation">(</span>savedInstanceState<span class="token operator">:</span> Bundle<span class="token operator">?</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onCreate</span><span class="token punctuation">(</span>savedInstanceState<span class="token punctuation">)</span>        <span class="token comment">// javaClass == getClass()</span>        Log<span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span><span class="token string">"BaseActivity"</span><span class="token punctuation">,</span> javaClass<span class="token punctuation">.</span>simpleName<span class="token punctuation">)</span>        ActivityCollector<span class="token punctuation">.</span><span class="token function">addActivity</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">onDestroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onDestroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        ActivityCollector<span class="token punctuation">.</span><span class="token function">removeActivity</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="3"><li>ä½¿ç”¨ finishAll() æ–¹æ³•å®ç°é€€å‡ºå³å¯</li></ol><h3 id="æ´»åŠ¨å¯åŠ¨æ¥å£"><a class="markdownIt-Anchor" href="#æ´»åŠ¨å¯åŠ¨æ¥å£"></a> æ´»åŠ¨å¯åŠ¨æ¥å£</h3><p>ä¸¤ä¸ªæ´»åŠ¨ç”±ä¸åŒçš„å¼€å‘è€…å¼€å‘, é‚£ä¹ˆç›¸äº’è°ƒç”¨æ—¶å¯èƒ½å› ä¸ºä¸ç†Ÿæ‚‰å‚æ•°å‘½åå¯¼è‡´ intent æ— æ³•ä¼ å‚, å› æ­¤å»ºè®®å¼€å‘æ´»åŠ¨æ—¶, åœ¨æ´»åŠ¨ä¸­å£°æ˜åˆ›å»ºè¯¥æ´»åŠ¨çš„æ„å›¾çš„æ¥å£</p><ul><li>è¿™å±äºæ´»åŠ¨ç±»çš„æ–¹æ³•, å› æ­¤ç”¨é™æ€ä¿®é¥°</li><li>Kotlin æä¾›äº† <code>companion object</code> è¯­æ³•ç»“æ„, å…¶ä¸­çš„æ–¹æ³•éƒ½å¯ä»¥ä½¿ç”¨ç±»ä¼¼äº java é™æ€æ–¹æ³•çš„å½¢å¼è°ƒç”¨</li></ul><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">companion</span> <span class="token keyword">object</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">fun</span> <span class="token function">actionStart</span><span class="token punctuation">(</span>context<span class="token operator">:</span> Context<span class="token punctuation">,</span> username<span class="token operator">:</span> String<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">val</span> intent <span class="token operator">=</span> <span class="token function">Intent</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> MainActivity<span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">.</span>java<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">apply</span> <span class="token punctuation">&#123;</span>            <span class="token function">putExtra</span><span class="token punctuation">(</span><span class="token string">"username"</span><span class="token punctuation">,</span> username<span class="token punctuation">)</span>        <span class="token punctuation">&#125;</span>        context<span class="token punctuation">.</span><span class="token function">startActivity</span><span class="token punctuation">(</span>intent<span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="context"><a class="markdownIt-Anchor" href="#context"></a> Context</h1><p>Context ä½¿ç”¨çš„åœºæ™¯éå¸¸å¤š: Toast, å¯åŠ¨ Activity, å‘é€å¹¿æ’­, æ“ä½œæ•°æ®åº“, é€šçŸ¥....</p><h2 id="å…¨å±€-context"><a class="markdownIt-Anchor" href="#å…¨å±€-context"></a> å…¨å±€ Context</h2><p>Android æä¾› Application ç±»ï¼Œæ¯å½“åº”ç”¨ç¨‹åºå¯åŠ¨çš„æ—¶å€™ï¼Œç³»ç»Ÿå°±ä¼šè‡ªåŠ¨å°†è¿™ä¸ªç±»è¿›è¡Œåˆå§‹åŒ–</p><p>è€Œæˆ‘ä»¬å¯ä»¥å®šåˆ¶ä¸€ä¸ªè‡ªå·±çš„ Application ç±»ï¼Œä»¥ä¾¿äºç®¡ç†ç¨‹åºå†…ä¸€äº›å…¨å±€çš„çŠ¶æ€ä¿¡æ¯ï¼Œæ¯”å¦‚å…¨å±€ Context</p><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">class</span> MyApplication <span class="token operator">:</span> <span class="token function">Application</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// å°† Context è®¾ç½®æˆé™æ€å˜é‡å¾ˆå®¹æ˜“ä¼šäº§ç”Ÿå†…å­˜æ³„æ¼çš„é—®é¢˜æ‰€ä»¥è¿™æ˜¯ä¸€ç§æœ‰é£é™©çš„åšæ³•</span>    <span class="token comment">// ä½†æ˜¯ç”±äºè¿™é‡Œè·å–çš„ä¸æ˜¯ Activity æˆ– Service ä¸­çš„ Context</span>    <span class="token comment">// è€Œæ˜¯ Application ä¸­çš„ Context å®ƒå…¨å±€åªä¼šå­˜åœ¨ä¸€ä»½å®ä¾‹</span>    <span class="token comment">// å¹¶ä¸”åœ¨æ•´ä¸ªåº”ç”¨ç¨‹åºçš„ç”Ÿå‘½å‘¨æœŸå†…éƒ½ä¸ä¼šå›æ”¶ï¼Œå› æ­¤æ˜¯ä¸å­˜åœ¨å†…å­˜æ³„æ¼é£é™©çš„</span>    <span class="token comment">// å› æ­¤å¯ä»¥å¿½ç•¥è­¦å‘Š</span>    <span class="token keyword">companion</span> <span class="token keyword">object</span> <span class="token punctuation">&#123;</span>        <span class="token annotation builtin">@SuppressLint</span><span class="token punctuation">(</span><span class="token string">"StaticFieldLeak"</span><span class="token punctuation">)</span>        <span class="token keyword">lateinit</span> <span class="token keyword">var</span> context<span class="token operator">:</span> Context    <span class="token punctuation">&#125;</span>    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">onCreate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onCreate</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        context <span class="token operator">=</span> applicationContext    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¹¶ä¸”åœ¨ Manifest ä¸­ä¿®æ”¹åˆå§‹åŒ–çš„ Application ç±»</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">&lt;application    android:name&#x3D;&quot;.MyApplication&quot;&gt;&lt;&#x2F;application&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h1 id="æ·±è‰²ä¸»é¢˜"><a class="markdownIt-Anchor" href="#æ·±è‰²ä¸»é¢˜"></a> æ·±è‰²ä¸»é¢˜</h1><p>Android 10.0 åŠä»¥ä¸Šç³»ç»Ÿçš„æ‰‹æœºï¼Œéƒ½å¯ä»¥åœ¨ Settingsâ†’Displayâ†’Dark theme ä¸­å¯¹æ·±è‰²ä¸»é¢˜è¿›è¡Œå¼€å¯å’Œå…³é—­</p><h2 id="force-dark"><a class="markdownIt-Anchor" href="#force-dark"></a> Force Dark</h2><p>èƒ½è®©åº”ç”¨ç¨‹åºå¿«é€Ÿé€‚é…æ·±è‰²ä¸»é¢˜ï¼Œå¹¶ä¸”å‡ ä¹ä¸ç”¨ç¼–å†™é¢å¤–ä»£ç çš„æ–¹å¼</p><ul><li>åˆ†ææµ…è‰²ä¸»é¢˜åº”ç”¨ä¸‹çš„æ¯ä¸€å±‚ Viewï¼Œå¹¶ä¸”åœ¨è¿™äº› View ç»˜åˆ¶åˆ°å±å¹•ä¹‹å‰ï¼Œè‡ªåŠ¨å°†å®ƒä»¬çš„é¢œè‰²è½¬æ¢æˆæ›´åŠ é€‚åˆæ·±è‰²ä¸»é¢˜çš„é¢œè‰²</li><li>å› æ­¤å¼€å‘è€…åªéœ€è¦é…ç½®å¥½æµ…è‰²ä¸»é¢˜çš„é¢œè‰²åˆ†å¸ƒå³å¯</li><li>ä½†æ˜¯ä¸ä¿è¯ç¾è§‚, å‰æœŸå¯ä»¥ä½¿ç”¨å…¶å¿«é€Ÿä¸Šçº¿, æœ€åè¿˜æ˜¯å»ºè®®ç²¾å¿ƒæ‰‹åŠ¨é…ç½®</li></ul><h3 id="quick-start"><a class="markdownIt-Anchor" href="#quick-start"></a> Quick Start</h3><p>åœ¨ res ç›®å½•ä¸‹æ–°å»º values-29 ç›®å½•, å¹¶åœ¨ values-29 ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ª styles.xml æ–‡ä»¶</p><p>Tips: è¿™ä¸ªå±æ€§æ˜¯ä» API 29ï¼Œä¹Ÿå°±æ˜¯ Android 10.0 ç³»ç»Ÿå¼€å§‹æ‰æœ‰çš„ï¼Œä¹‹å‰çš„ç³»ç»Ÿæ— æ³•æŒ‡å®šè¿™ä¸ªå±æ€§</p><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token operator">&lt;</span>resources<span class="token operator">></span>    <span class="token operator">&lt;</span>style name<span class="token operator">=</span><span class="token string">"AppTheme"</span> parent<span class="token operator">=</span><span class="token string">"Theme.AppCompat.Light.NoActionBar"</span><span class="token operator">></span>        <span class="token operator">&lt;</span>item name<span class="token operator">=</span><span class="token string">"colorPrimary"</span><span class="token operator">></span><span class="token label symbol">@color</span><span class="token operator">/</span>colorPrimary<span class="token operator">&lt;</span><span class="token operator">/</span>item<span class="token operator">></span>        <span class="token operator">&lt;</span>item name<span class="token operator">=</span><span class="token string">"colorPrimaryDark"</span><span class="token operator">></span><span class="token label symbol">@color</span><span class="token operator">/</span>colorPrimaryDark<span class="token operator">&lt;</span><span class="token operator">/</span>item<span class="token operator">></span>        <span class="token operator">&lt;</span>item name<span class="token operator">=</span><span class="token string">"colorAccent"</span><span class="token operator">></span><span class="token label symbol">@color</span><span class="token operator">/</span>colorAccent<span class="token operator">&lt;</span><span class="token operator">/</span>item<span class="token operator">></span>        <span class="token comment">// è¡¨æ˜å…è®¸ç³»ç»Ÿä½¿ç”¨ Force Dark å°†åº”ç”¨å¼ºåˆ¶è½¬æ¢æˆæ·±è‰²ä¸»é¢˜</span>        <span class="token operator">&lt;</span>item name<span class="token operator">=</span><span class="token string">"android:forceDarkAllowed"</span><span class="token operator">></span><span class="token boolean">true</span><span class="token operator">&lt;</span><span class="token operator">/</span>item<span class="token operator">></span>    <span class="token operator">&lt;</span><span class="token operator">/</span>style<span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>resources<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="manual-configuration"><a class="markdownIt-Anchor" href="#manual-configuration"></a> Manual Configuration</h2><p>ç±»ä¼¼çš„ Theme.AppCompat.Light.NoActionBar å°±æ˜¯æµ…è‰²ä¸»é¢˜ï¼Œè€Œ Theme.AppCompat.NoActionBar å°±æ˜¯æ·±è‰²ä¸»é¢˜</p><h3 id="quick-start-2"><a class="markdownIt-Anchor" href="#quick-start-2"></a> Quick Start</h3><ol><li>å®šä½åˆ° values/style.xml ä¸­, ä½¿ç”¨ DayNight ä¸‹çš„ä¸»é¢˜è¡¨æ˜ç”¨æˆ·åœ¨ç³»ç»Ÿè®¾ç½®ä¸­å¼€å¯æ·±è‰²ä¸»é¢˜æ—¶ï¼Œåº”ç”¨ç¨‹åºä¼šè‡ªåŠ¨ä½¿ç”¨æ·±è‰²ä¸»é¢˜ï¼Œåä¹‹åˆ™ä¼šä½¿ç”¨æµ…è‰²ä¸»é¢˜</li></ol><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resources</span><span class="token punctuation">></span></span>    <span class="token comment">&lt;!-- Base application theme. --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>AppTheme<span class="token punctuation">"</span></span> <span class="token attr-name">parent</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Theme.AppCompat.DayNight.NoActionBar<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token comment">&lt;!-- Customize your theme here. --></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>item</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>colorPrimary<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>@color/colorPrimary<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>item</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>item</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>colorPrimaryDark<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>@color/colorPrimaryDark<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>item</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>item</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>colorAccent<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>@color/colorAccent<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>item</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span>    ...<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resources</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="2"><li><p>å¦‚æœæ¶‰åŠåˆ°é™æ€ç¼–ç çš„é¢œè‰²å€¼, DayNight ä¸»é¢˜æ˜¯ä¸èƒ½å¯¹è¿™äº›é¢œè‰²è¿›è¡ŒåŠ¨æ€è½¬æ¢, éœ€è¦é¢å¤–åˆ›å»ºä¸€ä¸ª values-night ç›®å½•é…ç½®æ·±è‰²ä¸»é¢˜ä¸‹çš„é™æ€é¢œè‰²å€¼</p></li><li><p>ä»£ç ä¸­è·å–å½“å‰çš„ä¸»é¢˜çŠ¶æ€</p></li></ol><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">fun</span> <span class="token function">isDarkTheme</span><span class="token punctuation">(</span>context<span class="token operator">:</span> Context<span class="token punctuation">)</span><span class="token operator">:</span> Boolean <span class="token punctuation">&#123;</span>    <span class="token comment">// AND è¡¨ç¤ºæŒ‰ä½ä¸</span>    <span class="token keyword">val</span> flag <span class="token operator">=</span> context<span class="token punctuation">.</span>resources<span class="token punctuation">.</span>configuration<span class="token punctuation">.</span>uiMode <span class="token operator">and</span> Configuration<span class="token punctuation">.</span>UI_MODE_NIGHT_MASK    <span class="token keyword">return</span> flag <span class="token operator">==</span> Configuration<span class="token punctuation">.</span>UI_MODE_NIGHT_YES<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> Android Dev. </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Android </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>02-Kotlin-Advanced</title>
      <link href="/Coming-blog/2022/07/18/02-kotlin-advanced/"/>
      <url>/Coming-blog/2022/07/18/02-kotlin-advanced/</url>
      
        <content type="html"><![CDATA[<h1 id="æ ‡å‡†å‡½æ•°"><a class="markdownIt-Anchor" href="#æ ‡å‡†å‡½æ•°"></a> æ ‡å‡†å‡½æ•°</h1><h2 id="let"><a class="markdownIt-Anchor" href="#let"></a> let</h2><p>let å‡½æ•°æä¾›äº†å‡½æ•°å¼ API çš„ç¼–ç¨‹æ¥å£ï¼Œå¹¶å°†åŸå§‹è°ƒç”¨å¯¹è±¡ä½œä¸ºå‚æ•°ä¼ é€’åˆ° Lambda è¡¨è¾¾å¼ä¸­, é…åˆè¿›è¡Œéç©ºåˆ¤æ–­ååˆ†æ–¹ä¾¿:</p><ul><li><code>obj.let &#123; obj_ -&gt; ... &#125;</code>: <code>obj_</code> ä¸ <code>obj</code> æ˜¯ç›¸åŒçš„å¯¹è±¡, åªä¸è¿‡ä¸ºäº†ä¸é‡å</li><li>å¦‚ä¸‹ä¾‹, å¦‚æœ study ä¸º null åˆ™ä¸ä¼šæ‰§è¡Œ let å‡½æ•°; å¦‚æœ study ä¸ä¸º null åˆ™æ‰§è¡Œ let å‡½æ•°å¹¶å®ç°äº†éç©ºåˆ¤æ–­</li><li>ä¸ <code>if</code> ä¸åŒçš„æ˜¯, let å‡½æ•°æ˜¯å¯ä»¥å¤„ç†å…¨å±€å˜é‡çš„åˆ¤ç©ºé—®é¢˜çš„: if ä¸­å¦‚æœå­˜åœ¨å…¨å±€å˜é‡, å…¶å€¼éšæ—¶éƒ½æœ‰å¯èƒ½è¢«å…¶ä»–çº¿ç¨‹æ‰€ä¿®æ”¹ï¼Œå³ä½¿åšäº†åˆ¤ç©ºå¤„ç†ï¼Œä»ç„¶æ— æ³•ä¿è¯ if è¯­å¥ä¸­çš„ study å˜é‡æ²¡æœ‰ç©ºæŒ‡é’ˆé£é™©</li></ul><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">fun</span> <span class="token function">doStudy</span><span class="token punctuation">(</span>study<span class="token operator">:</span> Study<span class="token operator">?</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    study<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">let</span> <span class="token punctuation">&#123;</span> stu <span class="token operator">-></span>        stu<span class="token punctuation">.</span><span class="token function">readBooks</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        stu<span class="token punctuation">.</span><span class="token function">doHomework</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token comment">// lambda åªæœ‰ä¸€ä¸ªå‚æ•°æ—¶å¯ä»¥ç®€åŒ–æ”¹å‚æ•°ä¸º it</span><span class="token keyword">fun</span> <span class="token function">doStudy</span><span class="token punctuation">(</span>study<span class="token operator">:</span> Study<span class="token operator">?</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    study<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">let</span> <span class="token punctuation">&#123;</span>        it<span class="token punctuation">.</span><span class="token function">readBooks</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        it<span class="token punctuation">.</span><span class="token function">doHomework</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="with"><a class="markdownIt-Anchor" href="#with"></a> with</h2><p>æ¥æ”¶ä¸¤ä¸ªå‚æ•°: ä»»æ„ç±»å‹çš„å¯¹è±¡ + Lambda è¡¨è¾¾å¼, with å‡½æ•°åœ¨ Lambda è¡¨è¾¾å¼ä¸­æä¾›ç¬¬ä¸€ä¸ªå‚æ•°å¯¹è±¡çš„ä¸Šä¸‹æ–‡, å¹¶ä½¿ç”¨ Lambda è¡¨è¾¾å¼ä¸­çš„æœ€åä¸€è¡Œä»£ç ä½œä¸ºè¿”å›å€¼è¿”å›</p><ul><li>å¯ä»¥åœ¨è¿ç»­è°ƒç”¨åŒä¸€ä¸ªå¯¹è±¡çš„å¤šä¸ªæ–¹æ³•æ—¶è®©ä»£ç å˜å¾—æ›´åŠ ç²¾ç®€</li></ul><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">val</span> list <span class="token operator">=</span> <span class="token function">listOf</span><span class="token punctuation">(</span><span class="token string">"Apple"</span><span class="token punctuation">,</span> <span class="token string">"Banana"</span><span class="token punctuation">,</span> <span class="token string">"Orange"</span><span class="token punctuation">,</span> <span class="token string">"Pear"</span><span class="token punctuation">,</span> <span class="token string">"Grape"</span><span class="token punctuation">)</span><span class="token keyword">val</span> builder <span class="token operator">=</span> <span class="token function">StringBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>builder<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"Start eating fruits.\n"</span><span class="token punctuation">)</span><span class="token keyword">for</span> <span class="token punctuation">(</span>fruit <span class="token keyword">in</span> list<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    builder<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>fruit<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span>builder<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"Ate all fruits."</span><span class="token punctuation">)</span><span class="token keyword">val</span> result <span class="token operator">=</span> builder<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token function">println</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token comment">// å¯ä»¥è€ƒè™‘ä½¿ç”¨ with å…±äº« StringBuilder çš„ä¸Šä¸‹æ–‡, ç®€åŒ–ä»£ç </span><span class="token keyword">val</span> result2 <span class="token operator">=</span> <span class="token function">with</span><span class="token punctuation">(</span><span class="token function">StringBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"Start eating fruits.\n"</span><span class="token punctuation">)</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span>fruit <span class="token keyword">in</span> list<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token function">append</span><span class="token punctuation">(</span>fruit<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>    <span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"Ate all fruits."</span><span class="token punctuation">)</span>    <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token function">println</span><span class="token punctuation">(</span>result2<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="run"><a class="markdownIt-Anchor" href="#run"></a> run</h2><p>ç›¸å½“äºå¦ä¸€ç§å½¢å¼çš„ with: åœ¨æŸä¸ªå¯¹è±¡åŸºç¡€ä¸Šè¿›è¡Œè°ƒç”¨, æ¥æ”¶ Lambda å‚æ•°, å¹¶å°†å¯¹è±¡ä½œä¸º Lambda è¡¨è¾¾å¼çš„ä¸Šä¸‹æ–‡, ä»¥ Lambda è¡¨è¾¾å¼çš„æœ€åä¸€è¡Œä½œä¸ºè¿”å›å€¼è¿”å›</p><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">val</span> list <span class="token operator">=</span> <span class="token function">listOf</span><span class="token punctuation">(</span><span class="token string">"Apple"</span><span class="token punctuation">,</span> <span class="token string">"Banana"</span><span class="token punctuation">,</span> <span class="token string">"Orange"</span><span class="token punctuation">,</span> <span class="token string">"Pear"</span><span class="token punctuation">,</span> <span class="token string">"Grape"</span><span class="token punctuation">)</span><span class="token keyword">val</span> result2 <span class="token operator">=</span> <span class="token function">StringBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">run</span> <span class="token punctuation">&#123;</span>    <span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"Start eating fruits.\n"</span><span class="token punctuation">)</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span>fruit <span class="token keyword">in</span> list<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token function">append</span><span class="token punctuation">(</span>fruit<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>    <span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"Ate all fruits."</span><span class="token punctuation">)</span>    <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token function">println</span><span class="token punctuation">(</span>result2<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="apply"><a class="markdownIt-Anchor" href="#apply"></a> apply</h2><p>åœ¨æŸä¸ªå¯¹è±¡ä¸Šè°ƒç”¨, æ¥æ”¶ä¸€ä¸ª Lambda å‚æ•°, å°†å¯¹è±¡ä½œä¸º Lambda å‡½æ•°çš„ä¸Šä¸‹æ–‡, å¹¶å°†è°ƒç”¨å¯¹è±¡æœ¬èº«(å¤„ç†å)è¿”å›</p><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">val</span> list <span class="token operator">=</span> <span class="token function">listOf</span><span class="token punctuation">(</span><span class="token string">"Apple"</span><span class="token punctuation">,</span> <span class="token string">"Banana"</span><span class="token punctuation">,</span> <span class="token string">"Orange"</span><span class="token punctuation">,</span> <span class="token string">"Pear"</span><span class="token punctuation">,</span> <span class="token string">"Grape"</span><span class="token punctuation">)</span><span class="token keyword">val</span> stringBuilder <span class="token operator">=</span> <span class="token function">StringBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">apply</span> <span class="token punctuation">&#123;</span>     <span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"Start eating fruits.\n"</span><span class="token punctuation">)</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span>fruit <span class="token keyword">in</span> list<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token function">append</span><span class="token punctuation">(</span>fruit<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>    <span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"Ate all fruits."</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span><span class="token function">println</span><span class="token punctuation">(</span>stringBuilder<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="é™æ€æ–¹æ³•"><a class="markdownIt-Anchor" href="#é™æ€æ–¹æ³•"></a> é™æ€æ–¹æ³•</h1><p>åˆå«ä½œç±»æ–¹æ³•ï¼ŒæŒ‡çš„å°±æ˜¯é‚£ç§ä¸éœ€è¦åˆ›å»ºå®ä¾‹å°±èƒ½è°ƒç”¨çš„æ–¹æ³•; Kotlin ä¸­å°†ç”±é™æ€æ–¹æ³•ç»„æˆçš„å·¥å…·ç±»ç”¨å•ä¾‹ç±»å®ç°(<code>object</code> å…³é”®è¯è¿›è¡Œä¿®é¥°)</p><p>ä½†æ˜¯å¦‚æœåœ¨éå·¥å…·ç±»ä¸­å®šä¹‰é™æ€æ–¹æ³•, è¿™æ—¶å€™å°±éœ€è¦ <code>companion object</code> å—è¿›è¡Œå®šä¹‰äº†</p><blockquote><p>ä½†æ˜¯å…¶æœºç†æ˜¯ä¼šåœ¨ç±»çš„å†…éƒ¨äº§ç”Ÿä¸€ä¸ªä¼´ç”Ÿç±», ä¼´ç”Ÿç±»æ˜¯ä¸€ä¸ªå•ä¾‹ç±», å…·æœ‰å—ä¸­å®šä¹‰çš„æ–¹æ³•</p></blockquote><p>å¦‚æœè¦æ˜¾ç¤ºçš„å®šä¹‰å…¶ä¸ºé™æ€æ–¹æ³•:</p><ol><li>æ·»åŠ  @JvmStatic æ³¨è§£ï¼šåªèƒ½åŠ åœ¨å•ä¾‹ç±»æˆ– companion object ä¸­çš„æ–¹æ³•ä¸Š</li><li>é¡¶å±‚æ–¹æ³•: æ²¡æœ‰å®šä¹‰åœ¨ä»»ä½•ç±»ä¸­çš„æ–¹æ³•( package ); å°±æ¯”å¦‚æ–°å»ºä¸€ä¸ª tools.kt, ç›´æ¥å®šä¹‰æ–¹æ³•, è¿™äº›æ–¹æ³•éƒ½ä¼šè¢«ç¼–è¯‘ä¸ºé™æ€æ–¹æ³•; å¹¶ä¸”æ‰€æœ‰çš„é¡¶å±‚æ–¹æ³•éƒ½å¯ä»¥åœ¨ä»»ä½•ä½ç½®è¢«ç›´æ¥è°ƒç”¨ï¼Œä¸ç”¨ç®¡åŒ…åè·¯å¾„ï¼Œä¹Ÿä¸ç”¨åˆ›å»ºå®ä¾‹</li></ol><blockquote><p>å…¶åŸç†è¿˜æ˜¯ä»¥é¡¶å±‚æ–¹æ³•çš„æ–‡ä»¶ååˆ›å»ºä¸€ä¸ª Java ç±», å°†å…¶ä¸­çš„æ–¹æ³•å†™ä¸º Java çš„é™æ€æ–¹æ³•</p></blockquote><h1 id="å»¶è¿Ÿåˆå§‹åŒ–"><a class="markdownIt-Anchor" href="#å»¶è¿Ÿåˆå§‹åŒ–"></a> å»¶è¿Ÿåˆå§‹åŒ–</h1><p>æ¯”å¦‚ä¸€ä¸ªå…¨å±€å˜é‡éœ€è¦åˆ°è®¿é—®æŸä¸€ä¸ª Activity æ—¶æ‰èƒ½è¢«åˆå§‹åŒ–, å¦‚æœæå‰å®šä¹‰åœ¨ç±»ä¸­, å°±éœ€è¦å®šä¹‰ä¸º null, åç»­çš„æ“ä½œå…¨éƒ½è¦è€ƒè™‘åˆ¤ç©ºå¤„ç†, ååˆ†ä¸æ–¹ä¾¿, å› æ­¤å¼•å…¥äº† lateinit å…³é”®å­—è¿›è¡Œå…¨å±€åˆå§‹åŒ–; ä½†ç›¸å, æ‰€æœ‰çš„åˆ¤ç©ºé€»è¾‘æ£€æŸ¥å®é™…ä¸Šå°±äº¤ç»™ä»£ç ç¼–å†™è€…äº†, å¦‚æœç²—å¿ƒè¿˜æ˜¯å®¹æ˜“å‡ºç°åˆå§‹åŒ–å‰è¿›è¡Œä½¿ç”¨çš„é”™è¯¯~</p><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">class</span> MainActivity <span class="token operator">:</span> <span class="token function">AppCompatActivity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> View<span class="token punctuation">.</span><span class="token function">OnClickListener</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token keyword">lateinit</span> <span class="token keyword">var</span> adapter<span class="token operator">:</span> MsgAdapter    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">onCreate</span><span class="token punctuation">(</span>savedInstanceState<span class="token operator">:</span> Bundle<span class="token operator">?</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token operator">..</span><span class="token punctuation">.</span>        adapter <span class="token operator">=</span> <span class="token function">MsgAdapter</span><span class="token punctuation">(</span>msgList<span class="token punctuation">)</span>        <span class="token operator">..</span><span class="token punctuation">.</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">onClick</span><span class="token punctuation">(</span>v<span class="token operator">:</span> View<span class="token operator">?</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token operator">..</span><span class="token punctuation">.</span>        adapter<span class="token punctuation">.</span><span class="token function">notifyItemInserted</span><span class="token punctuation">(</span>msgList<span class="token punctuation">.</span>size <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>        <span class="token operator">..</span><span class="token punctuation">.</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¦‚æœåˆå§‹åŒ–çš„æ“ä½œèƒ½å¤Ÿé‡å¤è§¦å‘ä¹Ÿæ˜¯ä¸€ç§é‡å¤æ¶ˆè€—, å› æ­¤å¯ä»¥ä½¿ç”¨ <code>::ValueName.isInitialized</code> æ¥åˆ¤æ–­å˜é‡ <code>ValueName</code> æ˜¯å¦å®Œæˆåˆå§‹åŒ–å·¥ä½œäº†</p><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token operator">..</span><span class="token punctuation">.</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token operator">::</span>adapter<span class="token punctuation">.</span>isInitialized<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    adapter <span class="token operator">=</span> <span class="token function">MsgAdapter</span><span class="token punctuation">(</span>msgList<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token operator">..</span><span class="token punctuation">.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="å¯†å°ç±»"><a class="markdownIt-Anchor" href="#å¯†å°ç±»"></a> å¯†å°ç±»</h1><p>å½“åœ¨ when è¯­å¥ä¸­ä¼ å…¥ä¸€ä¸ªå¯†å°ç±»å˜é‡ä½œä¸ºæ¡ä»¶æ—¶ï¼ŒKotlin ç¼–è¯‘å™¨ä¼šè‡ªåŠ¨æ£€æŸ¥è¯¥å¯†å°ç±»æœ‰å“ªäº›å­ç±»ï¼Œå¹¶å¼ºåˆ¶è¦æ±‚ä½ å°†æ¯ä¸€ä¸ªå­ç±»æ‰€å¯¹åº”çš„æ¡ä»¶å…¨éƒ¨å¤„ç†ã€‚è¿™æ ·å°±å¯ä»¥ä¿è¯ï¼Œå³ä½¿æ²¡æœ‰ç¼–å†™ else æ¡ä»¶ï¼Œä¹Ÿä¸å¯èƒ½ä¼šå‡ºç°æ¼å†™æ¡ä»¶åˆ†æ”¯çš„æƒ…å†µã€‚</p><h1 id="æ‰©å±•å‡½æ•°"><a class="markdownIt-Anchor" href="#æ‰©å±•å‡½æ•°"></a> æ‰©å±•å‡½æ•°</h1><p>æ‰©å±•å‡½æ•°è¡¨ç¤ºå³ä½¿åœ¨ä¸ä¿®æ”¹æŸä¸ªç±»çš„æºç çš„æƒ…å†µä¸‹ï¼Œä»ç„¶å¯ä»¥æ‰“å¼€è¿™ä¸ªç±»ï¼Œå‘è¯¥ç±»æ·»åŠ æ–°çš„å‡½æ•°</p><ul><li>å®šä¹‰æ‰©å±•å‡½æ•°çš„è¯­æ³•ç»“æ„</li></ul><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">fun</span> ClassName<span class="token punctuation">.</span><span class="token function">methodName</span><span class="token punctuation">(</span>param1<span class="token operator">:</span> Int<span class="token punctuation">,</span> param2<span class="token operator">:</span> Int<span class="token punctuation">)</span><span class="token operator">:</span> Int <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><ul><li>å»ºè®®å‘å“ªä¸ªç±»ä¸­æ·»åŠ æ‰©å±•å‡½æ•°ï¼Œå°±å®šä¹‰ä¸€ä¸ªåŒåçš„ Kotlin æ–‡ä»¶; æˆ–å®šä¹‰åœ¨ä»»ä½•ä¸€ä¸ªç°æœ‰ç±»å½“ä¸­çš„</li><li>æ‰©å±•å‡½æ•°è‡ªåŠ¨æ‹¥æœ‰ç›®æ ‡ç±»çš„å®ä¾‹ä¸Šä¸‹æ–‡, é€šè¿‡ this å…³é”®å­—è¿›è¡Œè®¿é—®</li></ul><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">fun</span> String<span class="token punctuation">.</span><span class="token function">lettersCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> Int <span class="token punctuation">&#123;</span>    <span class="token keyword">var</span> count <span class="token operator">=</span> <span class="token number">0</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span>char <span class="token keyword">in</span> <span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>char<span class="token punctuation">.</span><span class="token function">isLetter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            count<span class="token operator">++</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">return</span> count<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="æ‰©å±•å‡½æ•°ä¼˜åŒ–-toast"><a class="markdownIt-Anchor" href="#æ‰©å±•å‡½æ•°ä¼˜åŒ–-toast"></a> æ‰©å±•å‡½æ•°ä¼˜åŒ– Toast</h2><p>å¯¹ Sting ä¸ Int è¿›è¡Œæ‰©å±•, å¿«é€Ÿ Toast æç¤º</p><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">fun</span> String<span class="token punctuation">.</span><span class="token function">showToast</span><span class="token punctuation">(</span>context<span class="token operator">:</span> Context<span class="token punctuation">,</span> duration<span class="token operator">:</span> Int <span class="token operator">=</span> Toast<span class="token punctuation">.</span>LENGTH_SHORT<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    Toast<span class="token punctuation">.</span><span class="token function">makeText</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">,</span> duration<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token keyword">fun</span> Int<span class="token punctuation">.</span><span class="token function">showToast</span><span class="token punctuation">(</span>context<span class="token operator">:</span> Context<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    Toast<span class="token punctuation">.</span><span class="token function">makeText</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">,</span> duration<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token comment">// Exec</span><span class="token string">"Success!"</span><span class="token punctuation">.</span><span class="token function">showToast</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token comment">// ç”šè‡³å¯ä»¥å°†æç¤ºä¿¡æ¯èµ„æºè¯</span>R<span class="token punctuation">.</span>string<span class="token punctuation">.</span>process_success_info<span class="token punctuation">.</span><span class="token function">showToast</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> Toast<span class="token punctuation">.</span>LENGTH_LONG<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="æ‰©å±•å‡½æ•°ä¼˜åŒ–-snackbar"><a class="markdownIt-Anchor" href="#æ‰©å±•å‡½æ•°ä¼˜åŒ–-snackbar"></a> æ‰©å±•å‡½æ•°ä¼˜åŒ– Snackbar</h2><p>Snackbar æ˜¯æ‰©å±•ç‰ˆçš„ Toast, èƒ½å¤Ÿæ ¹æ®æŒ‡å®šçš„ View å‘ä¸ŠæŸ¥è¯¢ Context å¹¶ç»™å‡ºå¯äº¤äº’çš„æç¤ºä¿¡æ¯, å› æ­¤é€‰æ‹©å¯¹ View è¿›è¡Œæ‰©å±•, ä¼˜åŒ– Snackbar çš„è°ƒç”¨</p><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token comment">// block è¡¨ç¤ºå…¶ç±»å‹å¯ä»¥æ˜¯å‡½æ•°ä¹Ÿå¯ä»¥æ˜¯ null, é»˜è®¤å€¼ä¸º null</span><span class="token keyword">fun</span> View<span class="token punctuation">.</span><span class="token function">showSnackbar</span><span class="token punctuation">(</span>text<span class="token operator">:</span> String<span class="token punctuation">,</span> actionText<span class="token operator">:</span> String<span class="token operator">?</span> <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">,</span>                     duration<span class="token operator">:</span> Int <span class="token operator">=</span> Snackbar<span class="token punctuation">.</span>LENGTH_SHORT<span class="token punctuation">,</span> block<span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span> Unit<span class="token punctuation">)</span><span class="token operator">?</span> <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">val</span> snackbar <span class="token operator">=</span> Snackbar<span class="token punctuation">.</span><span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> text<span class="token punctuation">,</span> duration<span class="token punctuation">)</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>actionText <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> block <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        snackbar<span class="token punctuation">.</span><span class="token function">setAction</span><span class="token punctuation">(</span>actionText<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token function">block</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    snackbar<span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token comment">// Exec</span>view<span class="token punctuation">.</span><span class="token function">showSnackbar</span><span class="token punctuation">(</span><span class="token string">"Delete Success!"</span><span class="token punctuation">,</span> <span class="token string">"UNDO"</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token string">"Undo Success!"</span><span class="token punctuation">.</span><span class="token function">showToast</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="è¿ç®—ç¬¦é‡è½½"><a class="markdownIt-Anchor" href="#è¿ç®—ç¬¦é‡è½½"></a> è¿ç®—ç¬¦é‡è½½</h1><p>Kotlin çš„è¿ç®—ç¬¦é‡è½½ä½¿ç”¨ <code>operator</code> å…³é”®å­—å…è®¸æˆ‘ä»¬è®©ä»»æ„ä¸¤ä¸ªå¯¹è±¡è¿›è¡Œè¿ç®—æ“ä½œ:</p><h2 id="quick-start"><a class="markdownIt-Anchor" href="#quick-start"></a> Quick Start</h2><p>åœ¨æŒ‡å®šå‡½æ•°çš„å‰é¢åŠ ä¸Š operator å…³é”®å­—ï¼Œå°±å¯ä»¥å®ç°è¿ç®—ç¬¦é‡è½½çš„åŠŸèƒ½äº†</p><ul><li>æŒ‡å®šå‡½æ•°: plus(), minus(),</li></ul><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">class</span> A <span class="token punctuation">&#123;</span>    <span class="token keyword">operator</span> <span class="token keyword">fun</span> <span class="token function">plus</span><span class="token punctuation">(</span>b<span class="token operator">:</span> B<span class="token punctuation">)</span><span class="token operator">:</span> C <span class="token punctuation">&#123;</span>        <span class="token comment">// å¤„ç†ç›¸åŠ çš„é€»è¾‘</span>        <span class="token keyword">return</span> <span class="token keyword">this</span> <span class="token operator">+</span> b    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token function">Money</span><span class="token punctuation">(</span><span class="token keyword">val</span> value<span class="token operator">:</span> Int<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">operator</span> <span class="token keyword">fun</span> <span class="token function">plus</span><span class="token punctuation">(</span>money<span class="token operator">:</span> Money<span class="token punctuation">)</span><span class="token operator">:</span> Money <span class="token punctuation">&#123;</span>        <span class="token keyword">val</span> sum <span class="token operator">=</span> value <span class="token operator">+</span> money<span class="token punctuation">.</span>value        <span class="token keyword">return</span> <span class="token function">Money</span><span class="token punctuation">(</span>sum<span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">operator</span> <span class="token keyword">fun</span> <span class="token function">plus</span><span class="token punctuation">(</span>newValue<span class="token operator">:</span> Int<span class="token punctuation">)</span><span class="token operator">:</span> Money <span class="token punctuation">&#123;</span>        <span class="token keyword">val</span> sum <span class="token operator">=</span> value <span class="token operator">+</span> newValue        <span class="token keyword">return</span> <span class="token function">Money</span><span class="token punctuation">(</span>sum<span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="è°ƒç”¨å¯¹ç…§è¡¨"><a class="markdownIt-Anchor" href="#è°ƒç”¨å¯¹ç…§è¡¨"></a> è°ƒç”¨å¯¹ç…§è¡¨</h2><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/202208181927672.png" alt="" /></p><h1 id="é«˜é˜¶å‡½æ•°"><a class="markdownIt-Anchor" href="#é«˜é˜¶å‡½æ•°"></a> é«˜é˜¶å‡½æ•°</h1><p>å¦‚æœä¸€ä¸ªå‡½æ•°æ¥æ”¶å¦ä¸€ä¸ªå‡½æ•°ä½œä¸ºå‚æ•°ï¼Œæˆ–è€…è¿”å›å€¼çš„ç±»å‹æ˜¯å¦ä¸€ä¸ªå‡½æ•°ï¼Œé‚£ä¹ˆè¯¥å‡½æ•°å°±ç§°ä¸ºé«˜é˜¶å‡½æ•°</p><ul><li>å‡½æ•°ç±»å‹: <code>(String, Int) -&gt; Unit</code>, å·¦ä¾§ä¸ºå‚æ•°ç±»å‹çš„å£°æ˜, å³ä¾§ä¸ºè¿”å›å€¼ç±»å‹çš„å£°æ˜, Unit è¡¨ç¤ºæ²¡æœ‰è¿”å›å€¼</li><li>ä¼ é€’å‡½æ•°å‚æ•°æ—¶é‡‡ç”¨å‡½æ•°å¼•ç”¨çš„æ–¹å¼è¿›è¡Œä¼ é€’: <code>::func</code> æˆ–è€…ç›´æ¥ä¼ é€’ lambda è¡¨è¾¾å¼</li></ul><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">val</span> result1 <span class="token operator">=</span> <span class="token function">num1AndNum2</span><span class="token punctuation">(</span>num1<span class="token punctuation">,</span> num2<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> n1<span class="token punctuation">,</span> n2 <span class="token operator">-></span>    n1 <span class="token operator">+</span> n2<span class="token punctuation">&#125;</span><span class="token keyword">val</span> result2 <span class="token operator">=</span> <span class="token function">num1AndNum2</span><span class="token punctuation">(</span>num1<span class="token punctuation">,</span> num2<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> n1<span class="token punctuation">,</span> n2 <span class="token operator">-></span>    n1 <span class="token operator">-</span> n2<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="é«˜é˜¶å‡½æ•°å®ç°ä¸Šä¸‹æ–‡å…±äº«"><a class="markdownIt-Anchor" href="#é«˜é˜¶å‡½æ•°å®ç°ä¸Šä¸‹æ–‡å…±äº«"></a> é«˜é˜¶å‡½æ•°å®ç°ä¸Šä¸‹æ–‡å…±äº«</h2><p>ç±»ä¼¼äºå†…ç½®çš„ apply å‡½æ•°</p><ul><li>åœ¨å‡½æ•°ç±»å‹çš„å‰é¢åŠ ä¸Š ClassName. è¡¨ç¤ºè¿™ä¸ªå‡½æ•°ç±»å‹æ˜¯å®šä¹‰åœ¨å“ªä¸ªç±»å½“ä¸­çš„, è°ƒç”¨ build æ—¶ä¼ å…¥çš„ lambda è¡¨è¾¾å¼å°†ä¼šè‡ªåŠ¨æ‹¥æœ‰ StringBuilder çš„ä¸Šä¸‹æ–‡</li></ul><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">fun</span> StringBuilder<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span>block<span class="token operator">:</span> StringBuilder<span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span> Unit<span class="token punctuation">)</span><span class="token operator">:</span> StringBuilder <span class="token punctuation">&#123;</span>    <span class="token function">block</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h2 id="é«˜é˜¶å‡½æ•°-kotlin-java"><a class="markdownIt-Anchor" href="#é«˜é˜¶å‡½æ•°-kotlin-java"></a> é«˜é˜¶å‡½æ•°: Kotlin - Java</h2><p>Kotlin çš„é«˜é˜¶å‡½æ•°ç¼–è¯‘ä¸º Java å­—èŠ‚ç æ–‡ä»¶å, å®é™…ä¸Šä½¿ç”¨çš„æ˜¯ Function æ¥å£ä¸­çš„ invoke() å‡½æ•°å®ç°çš„, è€Œä¼ å…¥çš„ lambda è¡¨è¾¾å¼éƒ½ä¼šç”±ä¸€ä¸ªåŒ¿åç±»å®ç°, è¿™æ ·å°±ä¼šå¯¼è‡´è¾ƒå¤§çš„ç³»ç»Ÿå¼€é”€</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">num1AndNum2</span><span class="token punctuation">(</span><span class="token keyword">int</span> num1<span class="token punctuation">,</span> <span class="token keyword">int</span> num2<span class="token punctuation">,</span> <span class="token class-name">Function</span> operation<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">int</span> result <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> operation<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>num1<span class="token punctuation">,</span> num2<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> result<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">int</span> num1 <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>    <span class="token keyword">int</span> num2 <span class="token operator">=</span> <span class="token number">80</span><span class="token punctuation">;</span>    <span class="token keyword">int</span> result <span class="token operator">=</span> <span class="token function">num1AndNum2</span><span class="token punctuation">(</span>num1<span class="token punctuation">,</span> num2<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token annotation punctuation">@Override</span>        <span class="token keyword">public</span> <span class="token class-name">Integer</span> <span class="token function">invoke</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> n1<span class="token punctuation">,</span> <span class="token class-name">Integer</span> n2<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> n1 <span class="token operator">+</span> n2<span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="å†…è”å‡½æ•°"><a class="markdownIt-Anchor" href="#å†…è”å‡½æ•°"></a> å†…è”å‡½æ•°</h1><p>é’ˆå¯¹é«˜é˜¶å‡½æ•°åº•å±‚çš„å¼€é”€è¾ƒå¤§, Kotlin å¼•å…¥äº†å†…è”å‡½æ•°, ä½¿ç”¨ <code>inline</code> å…³é”®å­—è¿›è¡Œä¿®é¥°, åœ¨ç¼–è¯‘æ—¶ Kotlin ç¼–è¯‘å™¨ä¼šå°†å†…è”å‡½æ•°ä¸­çš„ä»£ç åœ¨ç¼–è¯‘çš„æ—¶å€™è‡ªåŠ¨æ›¿æ¢åˆ°è°ƒç”¨å®ƒçš„åœ°æ–¹ï¼Œè¿™æ ·ä¹Ÿå°±ä¸å­˜åœ¨è¿è¡Œæ—¶çš„å¼€é”€äº†</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/202208191254781.png" alt="" /></p><p>é’ˆå¯¹å¤šä¸ªå‡½æ•°å‚æ•°æ—¶, å¦‚æœä¸å¸Œæœ›æŸä¸ªå‡½æ•°å‚æ•°è¢« inline åˆ™å¯åœ¨å‰é¢åŠ ä¸Š <code>noinline</code> è¿›è¡Œä¿®é¥°</p><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">inline</span> <span class="token keyword">fun</span> <span class="token function">inlineTest</span><span class="token punctuation">(</span>block1<span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span> Unit<span class="token punctuation">,</span> <span class="token keyword">noinline</span> block2<span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span> Unit<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="å†…è”çš„å±€é™ç•¥"><a class="markdownIt-Anchor" href="#å†…è”çš„å±€é™ç•¥"></a> å†…è”çš„å±€é™[ç•¥]</h2><p>å†…è”å‡½æ•°ç±»å‹çš„å‚æ•°åœ¨ç¼–è¯‘çš„æ—¶å€™ä¼šè¢«è¿›è¡Œä»£ç æ›¿æ¢ï¼Œå› æ­¤å®ƒæ²¡æœ‰çœŸæ­£çš„å‚æ•°å±æ€§ï¼Œåªå…è®¸ä¼ é€’ç»™å¦å¤–ä¸€ä¸ªå†…è”å‡½æ•°ï¼Œè¿™ä¹Ÿæ˜¯å®ƒæœ€å¤§çš„å±€é™æ€§</p><p>éå†…è”çš„å‡½æ•°ç±»å‹å‚æ•°å¯ä»¥è‡ªç”±åœ°ä¼ é€’ç»™å…¶ä»–ä»»ä½•å‡½æ•°ï¼Œå› ä¸ºå®ƒå°±æ˜¯ä¸€ä¸ªçœŸå®çš„å‚æ•°</p><p>å†…è”å‡½æ•°å®ç°äº†æ›¿æ¢, å› æ­¤å¯ä»¥å®ç°å±€éƒ¨çš„è¿”å›ä¸ç»ˆæ­¢; è€Œéå†…è”å‡½æ•°åˆ™é‡æ˜¯åœ¨å±€éƒ¨ä¸­æ­¢è‡ªèº«çš„å‡½æ•°ä½“, å¹¶ä¸èƒ½å®ç°é«˜é˜¶å‡½æ•°çš„å±€éƒ¨è¿”å›ä¸ç»ˆæ­¢</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/202208191541532.png" alt="" /></p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/202208191541886.png" alt="" /></p><h1 id="å§”æ‰˜"><a class="markdownIt-Anchor" href="#å§”æ‰˜"></a> å§”æ‰˜</h1><p>å§”æ‰˜æ˜¯ä¸€ç§è®¾è®¡æ¨¡å¼, æŒ‡æ“ä½œå¯¹è±¡è‡ªå·±ä¸ä¼šå»å¤„ç†æŸæ®µé€»è¾‘ï¼Œè€Œæ˜¯ä¼šæŠŠå·¥ä½œå§”æ‰˜ç»™å¦å¤–ä¸€ä¸ªè¾…åŠ©å¯¹è±¡å»å¤„ç†</p><ul><li>æ„ä¹‰æ‰€åœ¨: è®©å¤§éƒ¨åˆ†çš„æ–¹æ³•å®ç°è°ƒç”¨è¾…åŠ©å¯¹è±¡ä¸­çš„æ–¹æ³•ï¼Œå°‘éƒ¨åˆ†çš„æ–¹æ³•å®ç°ç”±è‡ªå·±æ¥é‡å†™ï¼Œç”šè‡³åŠ å…¥ä¸€äº›è‡ªå·±ç‹¬æœ‰çš„æ–¹æ³•</li></ul><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/202208220907140.png" alt="" /></p><h2 id="ç±»å§”æ‰˜"><a class="markdownIt-Anchor" href="#ç±»å§”æ‰˜"></a> ç±»å§”æ‰˜</h2><p>é€šè¿‡å§”æ‰˜åˆ›å»ºæ–°ç±»æ—¶ä½¿ç”¨ <code>by</code> å…³é”®å­—æŒ‡å®šå§”æ‰˜å¯¹è±¡, å°±ä¼šè‡ªåŠ¨å°†å…ƒå¯¹è±¡çš„æ–¹æ³•ç»§æ‰¿è¿‡æ¥, ä»è€Œå®ç°å¯¹ç›®æ ‡å¯¹è±¡çš„ç»§æ‰¿ä¸å°è£…</p><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">class</span> MySet<span class="token operator">&lt;</span>T<span class="token operator">></span><span class="token punctuation">(</span><span class="token keyword">val</span> helperSet<span class="token operator">:</span> HashSet<span class="token operator">&lt;</span>T<span class="token operator">></span><span class="token punctuation">)</span> <span class="token operator">:</span> Set<span class="token operator">&lt;</span>T<span class="token operator">></span> <span class="token keyword">by</span> helperSet <span class="token punctuation">&#123;</span>    <span class="token keyword">fun</span> <span class="token function">helloWorld</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Hello World"</span><span class="token punctuation">)</span>    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h2 id="å±æ€§å§”æ‰˜"><a class="markdownIt-Anchor" href="#å±æ€§å§”æ‰˜"></a> å±æ€§å§”æ‰˜</h2><p>åŒç±»å§”æ‰˜ç±»ä¼¼, å°†ä¸€ä¸ªå±æ€§ï¼ˆå­—æ®µï¼‰çš„å…·ä½“å®ç°å§”æ‰˜ç»™å¦ä¸€ä¸ªç±»å»å®Œæˆ, ä¾æ—§ä½¿ç”¨ <code>by</code> å…³é”®å­—æŒ‡å®šå§”æ‰˜å®ä¾‹</p><ul><li>å½“ä½¿ç”¨å±æ€§ p çš„æ—¶å€™ä¼šè‡ªåŠ¨è°ƒç”¨å®ä¾‹çš„ getValue() æ–¹æ³•, èµ‹å€¼å±æ€§ p åˆ™è°ƒç”¨ setValue() æ–¹æ³•</li><li>å› æ­¤ç±»ä¸­éœ€è¦æå‰å‡†å¤‡å¥½æ¥å£å®ç° value, getValue, setValue</li><li>getValue ä¸ setValue ä¸­çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯æ¥æ”¶ä½¿ç”¨å±æ€§å§”æ‰˜çš„ç±»çš„å®ä¾‹, ç¬¬äºŒä¸ªå‚æ•° KProperty&lt;*&gt; æ˜¯ Kotlin ä¸­çš„ä¸€ä¸ªå±æ€§æ“ä½œç±», ç”¨äºè·å–å„ç§å±æ€§ç›¸å…³å€¼</li></ul><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">class</span> MyClass <span class="token punctuation">&#123;</span>    <span class="token keyword">var</span> p <span class="token keyword">by</span> <span class="token function">Delegate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> Delegate <span class="token punctuation">&#123;</span>    <span class="token keyword">var</span> propValue<span class="token operator">:</span> Any<span class="token operator">?</span> <span class="token operator">=</span> <span class="token keyword">null</span>    <span class="token keyword">operator</span> <span class="token keyword">fun</span> <span class="token function">getValue</span><span class="token punctuation">(</span>myClass<span class="token operator">:</span> MyClass<span class="token punctuation">,</span> prop<span class="token operator">:</span> KProperty<span class="token operator">&lt;</span><span class="token operator">*</span><span class="token operator">></span><span class="token punctuation">)</span><span class="token operator">:</span> Any<span class="token operator">?</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> propValue    <span class="token punctuation">&#125;</span>    <span class="token keyword">operator</span> <span class="token keyword">fun</span> <span class="token function">setValue</span><span class="token punctuation">(</span>myClass<span class="token operator">:</span> MyClass<span class="token punctuation">,</span> prop<span class="token operator">:</span> KProperty<span class="token operator">&lt;</span><span class="token operator">*</span><span class="token operator">></span><span class="token punctuation">,</span> value<span class="token operator">:</span> Any<span class="token operator">?</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        propValue <span class="token operator">=</span> value    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="lazy-å‡½æ•°"><a class="markdownIt-Anchor" href="#lazy-å‡½æ•°"></a> lazy å‡½æ•°</h1><p>æ‡’åŠ è½½æŠ€æœ¯ä½¿å¾—å˜é‡çš„åˆå§‹åŒ–ä»£ç åœ¨å˜é‡è¢«é¦–æ¬¡è°ƒç”¨æ—¶ <code>by lazy&#123;&#125;</code> ä»£ç å—ä¸­çš„ä»£ç æ‰ä¼šæ‰§è¡Œ, æœ¬è´¨å°±æ˜¯å±æ€§å§”æ‰˜, lazy æ˜¯ Kotlin ä¸­çš„é«˜é˜¶å‡½æ•°, ç”¨äºå¿«é€Ÿåˆ›å»ºå¹¶è¿”å›ä¸€ä¸ª Delegate å¯¹è±¡</p><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">val</span> p <span class="token keyword">by</span> lazy <span class="token punctuation">&#123;</span> <span class="token operator">..</span><span class="token punctuation">.</span> <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>åŠ¨æ‰‹å®ç°é«˜é˜¶ lazy é«˜é˜¶å‡½æ•°</p><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">class</span> Later<span class="token operator">&lt;</span>T<span class="token operator">></span><span class="token punctuation">(</span><span class="token keyword">val</span> block<span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span> T<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">var</span> value<span class="token operator">:</span> Any<span class="token operator">?</span> <span class="token operator">=</span> <span class="token keyword">null</span>    <span class="token keyword">operator</span> <span class="token keyword">fun</span> <span class="token function">getValue</span><span class="token punctuation">(</span>any<span class="token operator">:</span> Any<span class="token operator">?</span><span class="token punctuation">,</span> prop<span class="token operator">:</span> KProperty<span class="token operator">&lt;</span><span class="token operator">*</span><span class="token operator">></span><span class="token punctuation">)</span><span class="token operator">:</span> T <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>value <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            value <span class="token operator">=</span> <span class="token function">block</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">return</span> value <span class="token keyword">as</span> T    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token comment">// é€šè¿‡ Later.kt ä¸­å®šä¹‰çš„é¡¶å±‚å‡½æ•°è¿›è¡Œä½¿ç”¨</span><span class="token keyword">fun</span> <span class="token operator">&lt;</span>T<span class="token operator">></span> <span class="token function">later</span><span class="token punctuation">(</span>block<span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span> T<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token function">Later</span><span class="token punctuation">(</span>block<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="infix"><a class="markdownIt-Anchor" href="#infix"></a> infix</h1><p>ä½¿ç”¨ infix å…³é”®å­—èƒ½å¤Ÿåˆ›å»ºç±»ä¼¼ <code>contentProviderOf(&quot;name&quot; to &quot;Coming&quot;)</code> è¿™æ ·çš„ A to B çš„ç”¨æ³•, å®è´¨ä¸º <code>A.to(B)</code> çš„è¯­æ³•ç³–</p><p>çº¦æŸæ¡ä»¶: infix å‡½æ•°å¿…é¡»ä¸ºæŸä¸ªç±»çš„æˆå‘˜å‡½æ•°, ä¸æ”¯æŒé¡¶å±‚å‡½æ•°; infix å‡½æ•°å¿…é¡»æ¥æ”¶ä¸”åªèƒ½æ¥æ”¶ä¸€ä¸ªå‚æ•°</p><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token comment">// ä½¿ç”¨ infix å¯¹ String å»ºç«‹æ‰©å±•å‡½æ•° beginsWith</span><span class="token keyword">infix</span> <span class="token keyword">fun</span> String<span class="token punctuation">.</span><span class="token function">beginsWith</span><span class="token punctuation">(</span>prefix<span class="token operator">:</span> String<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token function">startsWith</span><span class="token punctuation">(</span>prefix<span class="token punctuation">)</span><span class="token comment">// infix å‡½æ•°é¢å¤–æ”¯æŒä¸‹æ–¹è°ƒç”¨æ–¹å¼</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">"Hello Kotlin"</span> beginsWith <span class="token string">"Hello"</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token comment">// ç­‰ä»·äº</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">"Hello Kotlin"</span><span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">"Hello"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>Example2: åˆ¤æ–­é›†åˆä¸­æ˜¯å¦æœ‰æŸä¸ªå…ƒç´ </p><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">infix</span> <span class="token keyword">fun</span> <span class="token operator">&lt;</span>T<span class="token operator">></span> Collection<span class="token operator">&lt;</span>T<span class="token operator">></span><span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span>element<span class="token operator">:</span> T<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token function">contains</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span><span class="token keyword">val</span> list <span class="token operator">=</span> <span class="token function">listOf</span><span class="token punctuation">(</span><span class="token string">"Apple"</span><span class="token punctuation">,</span> <span class="token string">"Banana"</span><span class="token punctuation">,</span> <span class="token string">"Orange"</span><span class="token punctuation">,</span> <span class="token string">"Pear"</span><span class="token punctuation">,</span> <span class="token string">"Grape"</span><span class="token punctuation">)</span><span class="token keyword">if</span> <span class="token punctuation">(</span>list has <span class="token string">"Banana"</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>Example3: infix to å‡½æ•°çš„æºç </p><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">public</span> <span class="token keyword">infix</span> <span class="token keyword">fun</span> <span class="token operator">&lt;</span>A<span class="token punctuation">,</span> B<span class="token operator">></span> A<span class="token punctuation">.</span><span class="token function">to</span><span class="token punctuation">(</span>that<span class="token operator">:</span> B<span class="token punctuation">)</span><span class="token operator">:</span> Pair<span class="token operator">&lt;</span>A<span class="token punctuation">,</span> B<span class="token operator">></span> <span class="token operator">=</span> <span class="token function">Pair</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> that<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h1 id="advanced-generic"><a class="markdownIt-Anchor" href="#advanced-generic"></a> Advanced Generic</h1><h2 id="æ³›å‹å®åŒ–"><a class="markdownIt-Anchor" href="#æ³›å‹å®åŒ–"></a> æ³›å‹å®åŒ–</h2><p>ç±»å‹æ“¦é™¤æœºåˆ¶: æ³›å‹å¯¹äºç±»å‹çš„çº¦æŸåªåœ¨ç¼–è¯‘æ—¶æœŸå­˜åœ¨ï¼Œè¿è¡Œçš„æ—¶å€™ JVM æ˜¯è¯†åˆ«ä¸å‡ºæ¥æˆ‘ä»¬åœ¨ä»£ç ä¸­æŒ‡å®šçš„æ³›å‹ç±»å‹çš„; å³è¿è¡Œæ—¶ç±»å‹å·²ç»è¢«æ“¦é™¤äº†</p><ul><li>ä¾‹å¦‚ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ª <code>List&lt;String&gt;</code> é›†åˆï¼Œè™½ç„¶åœ¨ç¼–è¯‘æ—¶æœŸåªèƒ½å‘é›†åˆä¸­æ·»åŠ å­—ç¬¦ä¸²ç±»å‹çš„å…ƒç´ ï¼Œä½†æ˜¯åœ¨è¿è¡Œæ—¶æœŸ JVM å¹¶ä¸èƒ½çŸ¥é“å®ƒæœ¬æ¥åªæ‰“ç®—åŒ…å«å“ªç§ç±»å‹çš„å…ƒç´ ï¼Œåªèƒ½è¯†åˆ«å‡ºæ¥å®ƒæ˜¯ä¸ªList</li></ul><p>æ³›å‹å®åŒ–: å€ŸåŠ© Kotlin çš„å†…è”å‡½æ•°æ›¿æ¢çš„åŠŸèƒ½, ä»è€Œä¿ç•™äº†å‡½æ•°ä½“å†…çš„æ³›å‹, ç”šè‡³æ”¯æŒåœ¨å‡½æ•°ä½“ä¸­æ“ä½œæ³›å‹</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/202208231403755.png" alt="" /></p><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token comment">// å†…è”å‡½æ•° + å£°æ˜æ³›å‹çš„åœ°æ–¹åŠ ä¸Š reified å…³é”®å­—è¡¨ç¤ºè¯¥æ³›å‹è¦è¿›è¡Œå®åŒ–</span><span class="token keyword">inline</span> <span class="token keyword">fun</span> <span class="token operator">&lt;</span><span class="token keyword">reified</span> T<span class="token operator">></span> <span class="token function">getGenericType</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token comment">// å‡½æ•°ä½“å†…ç”šè‡³å¯ä»¥é€šè¿‡æ³›å‹è·å–å…¶åœ¨æ‰§è¡Œæ—¶çš„çœŸæ­£ç±»å‹</span><span class="token keyword">inline</span> <span class="token keyword">fun</span> <span class="token operator">&lt;</span><span class="token keyword">reified</span> T<span class="token operator">></span> <span class="token function">getGenericType</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> T<span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">.</span>java<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="application"><a class="markdownIt-Anchor" href="#application"></a> Application</h3><p>ä¼˜åŒ– startActivity:</p><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">inline</span> <span class="token keyword">fun</span> <span class="token operator">&lt;</span><span class="token keyword">reified</span> T<span class="token operator">></span> <span class="token function">startActivity</span><span class="token punctuation">(</span>context<span class="token operator">:</span> Context<span class="token punctuation">,</span> block<span class="token operator">:</span> Intent<span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span> Unit<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">val</span> intent <span class="token operator">=</span> <span class="token function">Intent</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> T<span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">.</span>java<span class="token punctuation">)</span>    <span class="token comment">// æ·»åŠ å‚æ•°ç­‰ä¿¡æ¯</span>    intent<span class="token punctuation">.</span><span class="token function">block</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    context<span class="token punctuation">.</span><span class="token function">startActivity</span><span class="token punctuation">(</span>intent<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token comment">// Application</span>startActivity<span class="token operator">&lt;</span>TestActivity<span class="token operator">></span><span class="token punctuation">(</span>context<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token function">putExtra</span><span class="token punctuation">(</span><span class="token string">"param1"</span><span class="token punctuation">,</span> <span class="token string">"data"</span><span class="token punctuation">)</span>    <span class="token function">putExtra</span><span class="token punctuation">(</span><span class="token string">"param2"</span><span class="token punctuation">,</span> <span class="token number">123</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="æ³›å‹çš„åå˜hard-todo"><a class="markdownIt-Anchor" href="#æ³›å‹çš„åå˜hard-todo"></a> æ³›å‹çš„åå˜[HARD, TODO]</h2><p>å‡å¦‚å®šä¹‰äº†ä¸€ä¸ª <code>MyClass&lt;T&gt;</code> çš„æ³›å‹ç±»ï¼Œå…¶ä¸­ A æ˜¯ B çš„å­ç±»å‹ï¼ŒåŒæ—¶ <code>MyClass&lt;A&gt;</code>åˆæ˜¯ <code>MyClass&lt;B&gt;</code> çš„å­ç±»å‹ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥ç§° MyClass åœ¨ T è¿™ä¸ªæ³›å‹ä¸Šæ˜¯åå˜çš„</p><ul><li>å‰æ: ä¸€ä¸ªæ³›å‹ç±»åœ¨å…¶æ³›å‹ç±»å‹çš„æ•°æ®ä¸Šæ˜¯åªè¯»çš„è¯. è¦å®ç°è¿™ä¸€ç‚¹ï¼Œåˆ™éœ€è¦è®© MyClass<T> ç±»ä¸­çš„æ‰€æœ‰æ–¹æ³•éƒ½ä¸èƒ½æ¥æ”¶ T ç±»å‹çš„å‚æ•°ã€‚æ¢å¥è¯è¯´ï¼ŒT åªèƒ½å‡ºç°åœ¨ out ä½ç½®ä¸Šï¼Œè€Œä¸èƒ½å‡ºç°åœ¨ in ä½ç½®ä¸Š</li></ul><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/202208231508585.png" alt="" /></p><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">class</span> SimpleData<span class="token operator">&lt;</span><span class="token keyword">out</span> T<span class="token operator">></span><span class="token punctuation">(</span><span class="token keyword">val</span> <span class="token keyword">data</span><span class="token operator">:</span> T<span class="token operator">?</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">fun</span> <span class="token keyword">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> T<span class="token operator">?</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token keyword">data</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="åç¨‹"><a class="markdownIt-Anchor" href="#åç¨‹"></a> åç¨‹</h1><p>åç¨‹å¯ä»¥ç†è§£ä¸ºè½»é‡çº§çš„çº¿ç¨‹, æ™®é€šçš„çº¿ç¨‹éœ€è¦ä¾é æ“ä½œç³»ç»Ÿçš„è°ƒåº¦å®ç°çº¿ç¨‹é—´çš„åˆ‡æ¢, ä½¿ç”¨åç¨‹å¯ä»¥ä»…åœ¨ç¼–ç¨‹è¯­è¨€çš„å±‚é¢å°±èƒ½å®ç°ä¸åŒåç¨‹ä¹‹é—´çš„åˆ‡æ¢ï¼Œä»è€Œå¤§å¤§æå‡äº†å¹¶å‘ç¼–ç¨‹çš„è¿è¡Œæ•ˆç‡</p><ul><li>åœ¨å•çº¿ç¨‹æ¨¡å¼ä¸‹æ¨¡æ‹Ÿå¤šçº¿ç¨‹ç¼–ç¨‹çš„æ•ˆæœï¼Œä»£ç æ‰§è¡Œæ—¶çš„æŒ‚èµ·ä¸æ¢å¤å®Œå…¨æ˜¯ç”±ç¼–ç¨‹è¯­è¨€æ¥æ§åˆ¶çš„ï¼Œå’Œæ“ä½œç³»ç»Ÿæ— å…³</li></ul><h2 id="quick-start-2"><a class="markdownIt-Anchor" href="#quick-start-2"></a> Quick Start</h2><ol><li>å¼•å…¥ä¾èµ–</li></ol><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">implementation &quot;org.jetbrains.kotlinx:kotlinx-coroutines-core:1.1.1&quot;implementation &quot;org.jetbrains.kotlinx:kotlinx-coroutines-android:1.1.1&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ol start="2"><li>ä½¿ç”¨ <code>GlobalScope.launch</code> åˆ›å»ºé¡¶å±‚åç¨‹ä½œç”¨åŸŸ: è¿™ç§åç¨‹å½“åº”ç”¨ç¨‹åºè¿è¡Œç»“æŸæ—¶ä¹Ÿä¼šè·Ÿç€ä¸€èµ·ç»“æŸ</li></ol><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">val</span> job <span class="token operator">=</span> GlobalScope<span class="token punctuation">.</span><span class="token function">launch</span> <span class="token punctuation">&#123;</span>    <span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"codes run in coroutine scope"</span><span class="token punctuation">)</span>    <span class="token keyword">for</span><span class="token punctuation">(</span>i <span class="token keyword">in</span> <span class="token number">0</span><span class="token operator">..</span><span class="token number">100</span> step <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"index = <span class="token interpolation variable">$i</span>"</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>job<span class="token punctuation">.</span><span class="token function">cancel</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// æ‰‹åŠ¨å–æ¶ˆåç¨‹</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="é˜»å¡"><a class="markdownIt-Anchor" href="#é˜»å¡"></a> é˜»å¡</h2><p>å¸¸è§çš„æœ‰ <code>Thread.sleep(millis)</code> ä¸ <code>delay(millis)</code></p><ul><li>delay: æ˜¯ä¸€ä¸ªéé˜»å¡å¼çš„æŒ‚èµ·å‡½æ•°ï¼Œå®ƒåªä¼šæŒ‚èµ·å½“å‰åç¨‹ï¼Œå¹¶ä¸ä¼šå½±å“å…¶ä»–åç¨‹çš„è¿è¡Œ (åªèƒ½åœ¨åç¨‹çš„ä½œç”¨åŸŸæˆ–å…¶ä»–æŒ‚èµ·å‡½æ•°ä¸­è°ƒ)</li><li>sleep: ä¼šé˜»å¡å½“å‰çš„çº¿ç¨‹ï¼Œè¿™æ ·è¿è¡Œåœ¨è¯¥çº¿ç¨‹ä¸‹çš„æ‰€æœ‰åç¨‹éƒ½ä¼šè¢«é˜»å¡</li></ul><h2 id="runblocking-åç¨‹"><a class="markdownIt-Anchor" href="#runblocking-åç¨‹"></a> runBlocking åç¨‹</h2><p>GlobalScope.launch åˆ›å»ºçš„åç¨‹ä¼šéšç€åº”ç”¨ç¨‹åºçš„ç»“æŸè€Œç»“æŸ, è¿™åœ¨ç¦»çº¿æµ‹è¯•æ—¶ååˆ†ä¸å‹å¥½, å› æ­¤å°è£…äº† runBlocking.launch å…¶å¯ä»¥ä¿è¯åœ¨åç¨‹ä½œç”¨åŸŸå†…çš„æ‰€æœ‰ä»£ç å’Œå­åç¨‹æ²¡æœ‰å…¨éƒ¨æ‰§è¡Œå®Œä¹‹å‰ä¸€ç›´é˜»å¡å½“å‰çº¿ç¨‹</p><p>Tips: runBlocking å‡½æ•°é€šå¸¸åªåº”è¯¥åœ¨æµ‹è¯•ç¯å¢ƒä¸‹ä½¿ç”¨ï¼Œåœ¨æ­£å¼ç¯å¢ƒä¸­ä½¿ç”¨å®¹æ˜“äº§ç”Ÿä¸€äº›æ€§èƒ½ä¸Šçš„é—®é¢˜</p><h3 id="åˆ›å»ºå¤šä¸ªå­åç¨‹"><a class="markdownIt-Anchor" href="#åˆ›å»ºå¤šä¸ªå­åç¨‹"></a> åˆ›å»ºå¤šä¸ªå­åç¨‹</h3><p>å¦‚æœå¤–å±‚ä½œç”¨åŸŸçš„åç¨‹ç»“æŸäº†ï¼Œè¯¥ä½œç”¨åŸŸä¸‹çš„æ‰€æœ‰å­åç¨‹ä¹Ÿä¼šä¸€åŒç»“æŸ</p><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin">runBlocking <span class="token punctuation">&#123;</span>    launch <span class="token punctuation">&#123;</span>        <span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"launch1"</span><span class="token punctuation">)</span>        <span class="token function">delay</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span>        <span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"launch1 finished"</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>    launch <span class="token punctuation">&#123;</span>        <span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"launch2"</span><span class="token punctuation">)</span>        <span class="token function">delay</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span>        <span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"launch2 finished"</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="å¯¹åç¨‹æ“ä½œçš„å°è£…"><a class="markdownIt-Anchor" href="#å¯¹åç¨‹æ“ä½œçš„å°è£…"></a> å¯¹åç¨‹æ“ä½œçš„å°è£…</h2><p>å¦‚æœæƒ³è¦å°†åç¨‹ä¸­æ‰§è¡Œçš„ä»»åŠ¡å°è£…ä¸ºå‡½æ•°, ä½†æ˜¯å¦‚ä½•<strong>æ‹¥æœ‰å…¶åç¨‹ä½œç”¨åŸŸ</strong>å‘¢ï¼Ÿå¯ä»¥ä½¿ç”¨ <code>suspend</code> å…³é”®å­—, å°†ä»»æ„å‡½æ•°å£°æ˜ä¸ºæŒ‚èµ·å‡½æ•°, å¹¶ä¸”æŒ‚èµ·å‡½æ•°ä¹‹é—´æ˜¯å¯ä»¥ç›¸äº’è°ƒç”¨çš„, è¿™å°±æ”¯æŒäº†å¦‚ delay ç­‰æŒ‚èµ·å‡½æ•°çš„è°ƒç”¨</p><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">suspend</span> <span class="token keyword">fun</span> <span class="token function">printDot</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token function">repeat</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"."</span><span class="token punctuation">)</span>        <span class="token function">delay</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä½†æ˜¯å¦‚ä½•<strong>çœŸæ­£çš„å®ç°åç¨‹ä½œç”¨åŸŸçš„å…±äº«</strong>å‘¢, éœ€è¦å€ŸåŠ© <code>coroutineScope</code> å‡½æ•°è¿›è¡Œæ˜¾ç¤ºçš„å£°æ˜</p><ul><li>coroutineScopre() ä¹Ÿæ˜¯ä¸€ä¸ªæŒ‚èµ·å‡½æ•°, å¯ä»¥åœ¨ä»»ä½•æŒ‚èµ·å‡½æ•°ä¸­æˆ–åç¨‹ä½œç”¨åŸŸä¸­è°ƒç”¨</li><li><strong>å…¶å¯ä»¥ç»§æ‰¿å¤–éƒ¨çš„åç¨‹çš„ä½œç”¨åŸŸå¹¶åˆ›å»ºä¸€ä¸ªå­åç¨‹</strong>ï¼Œå€ŸåŠ©è¿™ä¸ªç‰¹æ€§ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç»™ä»»æ„æŒ‚èµ·å‡½æ•°æä¾›åç¨‹ä½œç”¨åŸŸäº†</li><li>å…¶å¯ä»¥ä¿è¯å…¶ä½œç”¨åŸŸå†…çš„æ‰€æœ‰ä»£ç å’Œå­åç¨‹åœ¨å…¨éƒ¨æ‰§è¡Œå®Œä¹‹å‰ï¼Œå¤–éƒ¨çš„åç¨‹ä¼šä¸€ç›´è¢«æŒ‚èµ·</li><li>å’Œ runBlocking ä¸åŒçš„æ˜¯ coroutineScope å‡½æ•°åªä¼šé˜»å¡å½“å‰åç¨‹ï¼Œæ—¢ä¸å½±å“å…¶ä»–åç¨‹ï¼Œä¹Ÿä¸å½±å“ä»»ä½•çº¿ç¨‹ï¼Œå› æ­¤æ˜¯ä¸ä¼šé€ æˆä»»ä½•æ€§èƒ½ä¸Šçš„é—®é¢˜çš„: æ¶‰åŠçš„æ˜¯å­åç¨‹, ä¸ç”¨å…³æ³¨å¤–éƒ¨çº¿ç¨‹</li><li>è€Œ runBlocking å‡½æ•°ç”±äºä¼šæŒ‚èµ·å¤–éƒ¨çº¿ç¨‹ï¼Œå¦‚æœä½ æ°å¥½åˆåœ¨ä¸»çº¿ç¨‹ä¸­å½“ä¸­è°ƒç”¨å®ƒçš„è¯ï¼Œé‚£ä¹ˆå°±æœ‰å¯èƒ½ä¼šå¯¼è‡´ç•Œé¢å¡æ­»çš„æƒ…å†µï¼Œæ‰€ä»¥ä¸å¤ªæ¨èåœ¨å®é™…é¡¹ç›®ä¸­ä½¿ç”¨: æ¶‰åŠçš„æ˜¯é¡¶å±‚åç¨‹, éœ€è¦é˜»å¡çº¿ç¨‹ä»¥ä¿å­˜æ´»</li></ul><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">suspend</span> <span class="token keyword">fun</span> <span class="token function">printDot</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> coroutineScope <span class="token punctuation">&#123;</span>    launch <span class="token punctuation">&#123;</span>        <span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"."</span><span class="token punctuation">)</span>        <span class="token function">delay</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="æ¨èçš„åç¨‹å®è·µ"><a class="markdownIt-Anchor" href="#æ¨èçš„åç¨‹å®è·µ"></a> æ¨èçš„åç¨‹å®è·µ</h2><p>ä¸»è¦å°±æ˜¯æ–¹ä¾¿å¤šä¸ªå­åç¨‹çš„ç»´æŠ¤</p><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">val</span> job <span class="token operator">=</span> <span class="token function">Job</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">val</span> scope <span class="token operator">=</span> <span class="token function">CoroutineScope</span><span class="token punctuation">(</span>job<span class="token punctuation">)</span>scope<span class="token punctuation">.</span><span class="token function">launch</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token keyword">in</span> <span class="token number">1</span><span class="token operator">..</span><span class="token number">100</span> step <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token function">delay</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span>        <span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"index = <span class="token interpolation variable">$i</span>"</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>scope<span class="token punctuation">.</span><span class="token function">launch</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token keyword">in</span> <span class="token number">0</span><span class="token operator">..</span><span class="token number">100</span> step <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token function">delay</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span>        <span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"index = <span class="token interpolation variable">$i</span>"</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token comment">// é”€æ¯çš„æ—¶å€™è°ƒç”¨</span><span class="token comment">// job.cancel() // è°ƒç”¨ä¸€æ¬¡ cancel æ–¹æ³•å³å¯å–æ¶ˆç›®æ ‡ scope ä¸­çš„æ‰€æœ‰åç¨‹, ç»´æŠ¤èµ·æ¥æ›´åŠ æ–¹ä¾¿</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="åç¨‹çš„å›è°ƒ"><a class="markdownIt-Anchor" href="#åç¨‹çš„å›è°ƒ"></a> åç¨‹çš„å›è°ƒ</h2><h3 id="asyncawait"><a class="markdownIt-Anchor" href="#asyncawait"></a> async/await</h3><p>ä½¿ç”¨ <code>async</code> å…³é”®å­—è·å–ç›®æ ‡åç¨‹çš„è¿”å›å€¼, è¯¥å…³é”®å­—å¿…é¡»åœ¨åç¨‹ä½œç”¨åŸŸä¸­ä½¿ç”¨, å…¶åŸç†æ˜¯åˆ›å»ºä¸€ä¸ªæ–°çš„å­åç¨‹, å¹¶è¿”å›ä¸€ä¸ª Deferred å¯¹è±¡, é€šè¿‡æ‰§è¡Œè¯¥å¯¹è±¡çš„ <code>await()</code> æ–¹æ³•è·å–æ‰§è¡Œç»“æœ</p><ul><li>è°ƒç”¨äº† async å‡½æ•°ä¹‹åï¼Œä»£ç å—ä¸­çš„ä»£ç å°±ä¼šç«‹åˆ»å¼€å§‹æ‰§è¡Œ</li><li>å½“è°ƒç”¨ await() æ–¹æ³•æ—¶ï¼Œå¦‚æœä»£ç å—ä¸­çš„ä»£ç è¿˜æ²¡æ‰§è¡Œå®Œï¼Œé‚£ä¹ˆ await() æ–¹æ³•ä¼šå°†å½“å‰åç¨‹é˜»å¡ä½ï¼Œç›´åˆ°å¯ä»¥è·å¾— async å‡½æ•°çš„æ‰§è¡Œç»“æœ</li><li>å› æ­¤é€‰æ‹©ä½•æ—¶è°ƒç”¨ await çš„æ—¶æœºå¾ˆé‡è¦</li></ul><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin">GlobalScope<span class="token punctuation">.</span><span class="token function">launch</span> <span class="token punctuation">&#123;</span>    <span class="token function">getCoroutineRet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token comment">//--------------------------------------//</span><span class="token keyword">suspend</span> <span class="token keyword">fun</span> <span class="token function">getCoroutineRet</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">val</span> job <span class="token operator">=</span> <span class="token function">Job</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">val</span> scope <span class="token operator">=</span> <span class="token function">CoroutineScope</span><span class="token punctuation">(</span>job<span class="token punctuation">)</span>    <span class="token keyword">val</span> ret <span class="token operator">=</span> scope<span class="token punctuation">.</span><span class="token function">async</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">var</span> ret <span class="token operator">=</span> <span class="token number">0</span>        <span class="token keyword">for</span><span class="token punctuation">(</span>i <span class="token keyword">in</span> <span class="token number">0</span><span class="token operator">..</span><span class="token number">100</span> step <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            ret <span class="token operator">+=</span> i            <span class="token function">delay</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span>        <span class="token punctuation">&#125;</span>        ret    <span class="token punctuation">&#125;</span><span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"<span class="token interpolation variable">$ret</span>"</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä½¿ç”¨ runBlocking æ—¶æ›´åŠ ç®€ä¾¿, å› ä¸ºæœ‰ä¸€ä¸ªå…¨å±€çš„åç¨‹ä½œç”¨åŸŸ</p><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin">runBlocking <span class="token punctuation">&#123;</span>    <span class="token keyword">val</span> result <span class="token operator">=</span> async <span class="token punctuation">&#123;</span>        <span class="token number">5</span> <span class="token operator">+</span> <span class="token number">5</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token function">println</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="withcontext"><a class="markdownIt-Anchor" href="#withcontext"></a> withContext</h3><p>å¯ä»¥ç†è§£æˆ async å‡½æ•°çš„ä¸€ç§ç®€åŒ–ç‰ˆå†™æ³•</p><ul><li>è°ƒç”¨ withContext() å‡½æ•°ä¹‹åï¼Œä¼šç«‹å³æ‰§è¡Œä»£ç å—ä¸­çš„ä»£ç ï¼ŒåŒæ—¶å°†å¤–éƒ¨åç¨‹æŒ‚èµ·</li><li>å½“ä»£ç å—ä¸­çš„ä»£ç å…¨éƒ¨æ‰§è¡Œå®Œä¹‹åï¼Œä¼šå°†æœ€åä¸€è¡Œçš„æ‰§è¡Œç»“æœä½œä¸º withContext() å‡½æ•°çš„è¿”å›å€¼è¿”å›</li><li>Dispatchers.Default æ˜¯ withContext å¼ºåˆ¶è¦æ±‚çš„çº¿ç¨‹å‚æ•°, æ•°ç»™åç¨‹æŒ‡å®šä¸€ä¸ªå…·ä½“çš„è¿è¡Œçº¿ç¨‹<ul><li>Dispatchers.Default è¡¨ç¤ºä¼šä½¿ç”¨ä¸€ç§é»˜è®¤ä½å¹¶å‘çš„çº¿ç¨‹ç­–ç•¥ï¼Œå½“ä½ è¦æ‰§è¡Œçš„ä»£ç å±äºè®¡ç®—å¯†é›†å‹ä»»åŠ¡æ—¶ï¼Œå¼€å¯è¿‡é«˜çš„å¹¶å‘åè€Œå¯èƒ½ä¼šå½±å“ä»»åŠ¡çš„è¿è¡Œæ•ˆç‡ï¼Œæ­¤æ—¶å°±å¯ä»¥ä½¿ç”¨ Dispatchers.Default</li><li><a target="_blank" rel="noopener" href="http://Dispatchers.IO">Dispatchers.IO</a> è¡¨ç¤ºä¼šä½¿ç”¨ä¸€ç§è¾ƒé«˜å¹¶å‘çš„çº¿ç¨‹ç­–ç•¥ï¼Œå½“ä½ è¦æ‰§è¡Œçš„ä»£ç å¤§å¤šæ•°æ—¶é—´æ˜¯åœ¨é˜»å¡å’Œç­‰å¾…ä¸­ï¼Œæ¯”å¦‚è¯´æ‰§è¡Œç½‘ç»œè¯·æ±‚æ—¶ï¼Œä¸ºäº†èƒ½å¤Ÿæ”¯æŒæ›´é«˜çš„å¹¶å‘æ•°é‡ï¼Œæ­¤æ—¶å°±å¯ä»¥ä½¿ç”¨ <a target="_blank" rel="noopener" href="http://Dispatchers.IO">Dispatchers.IO</a></li><li>Dispatchers.Main åˆ™è¡¨ç¤ºä¸ä¼šå¼€å¯å­çº¿ç¨‹ï¼Œè€Œæ˜¯åœ¨ Android ä¸»çº¿ç¨‹ä¸­æ‰§è¡Œä»£ç ï¼Œä½†æ˜¯è¿™ä¸ªå€¼åªèƒ½åœ¨ Android é¡¹ç›®ä¸­ä½¿ç”¨ï¼Œçº¯ Kotlin ç¨‹åºä½¿ç”¨è¿™ç§ç±»å‹çš„çº¿ç¨‹å‚æ•°ä¼šå‡ºç°é”™è¯¯</li></ul></li></ul><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin">runBlocking <span class="token punctuation">&#123;</span>    <span class="token keyword">val</span> result <span class="token operator">=</span> <span class="token function">withContext</span><span class="token punctuation">(</span>Dispatchers<span class="token punctuation">.</span>Default<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token number">5</span> <span class="token operator">+</span> <span class="token number">5</span>    <span class="token punctuation">&#125;</span>    <span class="token function">println</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="ä½¿ç”¨åç¨‹ä¼˜åŒ–ä¼ ç»Ÿå›è°ƒ"><a class="markdownIt-Anchor" href="#ä½¿ç”¨åç¨‹ä¼˜åŒ–ä¼ ç»Ÿå›è°ƒ"></a> ä½¿ç”¨åç¨‹ä¼˜åŒ–ä¼ ç»Ÿå›è°ƒ</h2><p>å€ŸåŠ© suspendCoroutine å‡½æ•°å°±èƒ½å°†ä¼ ç»Ÿå›è°ƒæœºåˆ¶çš„å†™æ³•å¤§å¹…ç®€åŒ–ï¼š</p><ul><li>å¿…é¡»åœ¨åç¨‹ä½œç”¨åŸŸæˆ–æŒ‚èµ·å‡½æ•°ä¸­è°ƒç”¨</li><li>æ¥æ”¶ä¸€ä¸ª Lambda è¡¨è¾¾å¼å‚æ•°ï¼šå°†å½“å‰åç¨‹ç«‹å³æŒ‚èµ·ï¼Œç„¶ååœ¨ä¸€ä¸ªæ™®é€šçš„çº¿ç¨‹ä¸­æ‰§è¡Œ Lambda è¡¨è¾¾å¼ä¸­çš„ä»£ç <ul><li>Lambda è¡¨è¾¾å¼çš„å‚æ•°åˆ—è¡¨ä¸Šä¼šä¼ å…¥ä¸€ä¸ª Continuation å‚æ•°, è°ƒç”¨å®ƒçš„ resume() æ–¹æ³•æˆ– resumeWithException() å¯ä»¥è®©åç¨‹æ¢å¤æ‰§è¡Œ</li></ul></li></ul><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">suspend</span> <span class="token keyword">fun</span> <span class="token function">request</span><span class="token punctuation">(</span>address<span class="token operator">:</span> String<span class="token punctuation">)</span><span class="token operator">:</span> String <span class="token punctuation">&#123;</span>    <span class="token comment">// suspendCoroutine -> å½“å‰åç¨‹å°±ä¼šè¢«ç«‹åˆ»æŒ‚èµ·ï¼Œè€Œ Lambda è¡¨è¾¾å¼ä¸­çš„ä»£ç åˆ™ä¼šåœ¨æ™®é€šçº¿ç¨‹ä¸­æ‰§è¡Œ</span>    <span class="token keyword">return</span> suspendCoroutine <span class="token punctuation">&#123;</span> continuation <span class="token operator">-></span>        HttpUtil<span class="token punctuation">.</span><span class="token function">sendHttpRequest</span><span class="token punctuation">(</span>address<span class="token punctuation">,</span> <span class="token keyword">object</span> <span class="token operator">:</span> HttpCallbackListener <span class="token punctuation">&#123;</span>            <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">onFinish</span><span class="token punctuation">(</span>response<span class="token operator">:</span> String<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                continuation<span class="token punctuation">.</span><span class="token function">resume</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span>            <span class="token punctuation">&#125;</span>            <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">onError</span><span class="token punctuation">(</span>e<span class="token operator">:</span> Exception<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                continuation<span class="token punctuation">.</span><span class="token function">resumeWithException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token comment">// ä¸ç”¨å†æ‰‹åŠ¨å¤„ç†å›è°ƒ - å”¯ä¸€çš„çº¦æŸå°±æ˜¯å¿…é¡»å®šä¹‰ä¸ºæŒ‚èµ·å‡½æ•°, åªèƒ½å†åç¨‹ä½œç”¨åŸŸæˆ–å…¶å®ƒæŒ‚èµ·å‡½æ•°ä¸­è°ƒç”¨</span><span class="token keyword">suspend</span> <span class="token keyword">fun</span> <span class="token function">getBaiduResponse</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">val</span> response <span class="token operator">=</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token string">"https://www.baidu.com/"</span><span class="token punctuation">)</span>        <span class="token comment">// å¯¹æœåŠ¡å™¨å“åº”çš„æ•°æ®è¿›è¡Œå¤„ç† &lt;- continuation.resume(response)</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token operator">:</span> Exception<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">// å¯¹å¼‚å¸¸æƒ…å†µè¿›è¡Œå¤„ç† &lt;- continuation.resumeWithException(e)</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="dsl"><a class="markdownIt-Anchor" href="#dsl"></a> DSL</h1><p>DSL æ˜¯é¢†åŸŸç‰¹å®šè¯­è¨€ï¼ˆDomain Specific Languageï¼‰é€šè¿‡å®ƒæˆ‘ä»¬å¯ä»¥ç¼–å†™å‡ºä¸€äº›çœ‹ä¼¼è„±ç¦»å…¶åŸå§‹è¯­æ³•ç»“æ„çš„ä»£ç ï¼Œä»è€Œæ„å»ºå‡ºä¸€ç§ä¸“æœ‰çš„è¯­æ³•ç»“æ„</p><p>ä¾‹å¦‚æ„é€ ä¸€ä¸ªèƒ½å¤Ÿç”Ÿæˆ table, tr, td æ ‡ç­¾çš„è¯­æ³•ç»“æ„</p><ol><li>é¦–å…ˆå®šä¹‰åº•å±‚å•å…ƒç»“æ„ td</li></ol><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">class</span> Td <span class="token punctuation">&#123;</span>    <span class="token keyword">var</span> content <span class="token operator">=</span> <span class="token string">""</span>    <span class="token keyword">fun</span> <span class="token function">html</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token string">"\n\t\t&lt;td><span class="token interpolation variable">$content</span>&lt;/td>"</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><ol start="2"><li>é€å±‚å‘ä¸Š, å®šä¹‰ tr çš„ç»“æ„, å®ç°å¯¹å­ td çš„å°è£…ç»´æŠ¤</li></ol><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">class</span> Tr <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token keyword">val</span> children <span class="token operator">=</span> ArrayList<span class="token operator">&lt;</span>Td<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">fun</span> <span class="token function">td</span><span class="token punctuation">(</span>block<span class="token operator">:</span> Td<span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span> String<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">val</span> td <span class="token operator">=</span> <span class="token function">Td</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        td<span class="token punctuation">.</span>content <span class="token operator">=</span> td<span class="token punctuation">.</span><span class="token function">block</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        children<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>td<span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">fun</span> <span class="token function">html</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> String <span class="token punctuation">&#123;</span>        <span class="token keyword">val</span> builder <span class="token operator">=</span> <span class="token function">StringBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        builder<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"\n\t&lt;tr>"</span><span class="token punctuation">)</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span>childTag <span class="token keyword">in</span> children<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            builder<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>childTag<span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token punctuation">&#125;</span>        builder<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"\n\t&lt;/tr>"</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> builder<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="3"><li>ç»§ç»­å‘ä¸Š, å®šä¹‰ table çš„ç»“æ„, å®ç°å¯¹å­ tr çš„å°è£…ç»´æŠ¤</li></ol><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">class</span> Table <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token keyword">val</span> children <span class="token operator">=</span> ArrayList<span class="token operator">&lt;</span>Tr<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">fun</span> <span class="token function">tr</span><span class="token punctuation">(</span>block<span class="token operator">:</span> Tr<span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span> Unit<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">val</span> tr <span class="token operator">=</span> <span class="token function">Tr</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        tr<span class="token punctuation">.</span><span class="token function">block</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        children<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>tr<span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">fun</span> <span class="token function">html</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> String <span class="token punctuation">&#123;</span>        <span class="token keyword">val</span> builder <span class="token operator">=</span> <span class="token function">StringBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        builder<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"&lt;table>"</span><span class="token punctuation">)</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span>childTag <span class="token keyword">in</span> children<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            builder<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>childTag<span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token punctuation">&#125;</span>        builder<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"\n&lt;/table>"</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> builder<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="4"><li>å®ç°é¡¶å±‚ç»“æ„çš„å°è£…</li></ol><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">fun</span> <span class="token function">table</span><span class="token punctuation">(</span>block<span class="token operator">:</span> Table<span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span> Unit<span class="token punctuation">)</span><span class="token operator">:</span> String <span class="token punctuation">&#123;</span>    <span class="token keyword">val</span> table <span class="token operator">=</span> <span class="token function">Table</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    table<span class="token punctuation">.</span><span class="token function">block</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> table<span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="5"><li>æ„å»º table</li></ol><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">fun</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">val</span> html <span class="token operator">=</span> table <span class="token punctuation">&#123;</span>        tr <span class="token punctuation">&#123;</span>            td <span class="token punctuation">&#123;</span> <span class="token string">"Apple"</span> <span class="token punctuation">&#125;</span>            td <span class="token punctuation">&#123;</span> <span class="token string">"Grape"</span> <span class="token punctuation">&#125;</span>            td <span class="token punctuation">&#123;</span> <span class="token string">"Orange"</span> <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>        tr <span class="token punctuation">&#123;</span>            td <span class="token punctuation">&#123;</span> <span class="token string">"Pear"</span> <span class="token punctuation">&#125;</span>            td <span class="token punctuation">&#123;</span> <span class="token string">"Banana"</span> <span class="token punctuation">&#125;</span>            td <span class="token punctuation">&#123;</span> <span class="token string">"Watermelon"</span> <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token function">println</span><span class="token punctuation">(</span>html<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/202209111418343.png" alt="" /></p><h1 id="java2kotlin"><a class="markdownIt-Anchor" href="#java2kotlin"></a> Java2Kotlin</h1><ul><li>å€ŸåŠ© Android Studio: å°† Java ä»£ç ç²˜è´´åˆ° Android Studio çš„ Kotlin æ–‡ä»¶ä¸­, ä¼šè‡ªåŠ¨è¯†åˆ«å¹¶æç¤ºè½¬æ¢</li><li>å¯¼èˆªæ ä¸­çš„ Code â†’ Convert Java File to Kotlin File</li></ul><h1 id="kotlin2java"><a class="markdownIt-Anchor" href="#kotlin2java"></a> Kotlin2Java</h1><p>Kotlin æ‹¥æœ‰è®¸å¤š Java ä¸­å¹¶ä¸å­˜åœ¨çš„ç‰¹æ€§ï¼Œå› æ­¤å¾ˆéš¾æ‰§è¡Œä¸€é”®è½¬æ¢</p><p>ä½†æ˜¯å¯ä»¥å…ˆå°† Kotlin ä»£ç è½¬æ¢æˆ Kotlin å­—èŠ‚ç ï¼Œç„¶åé€šè¿‡åç¼–è¯‘çš„æ–¹å¼å°†å®ƒè¿˜åŸæˆ Java ä»£ç ï¼›è¿™ç§åç¼–è¯‘å‡ºæ¥çš„ä»£ç å¯èƒ½æ— æ³•åƒæ­£å¸¸ç¼–å†™çš„ Java ä»£ç é‚£æ ·ç›´æ¥è¿è¡Œï¼Œä½†æ˜¯éå¸¸æœ‰åˆ©äºå¸®åŠ©æˆ‘ä»¬ç†è§£è¯¸å¤š Kotlin ç‰¹æ€§èƒŒåçš„å®ç°åŸç†</p><ul><li>å¯¼èˆªæ ä¸­çš„ Toolsâ†’Kotlinâ†’Show Kotlin Bytecode</li><li>ç‚¹å‡»çª—å£å·¦ä¸Šè§’çš„ Decompile æŒ‰é’®ï¼Œå°±å¯ä»¥å°†è¿™äº› Kotlin å­—èŠ‚ç åç¼–è¯‘æˆ Java ä»£ç </li></ul>]]></content>
      
      
      <categories>
          
          <category> Android Dev. </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Android </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>04-Zenmap</title>
      <link href="/Coming-blog/2022/07/18/04-zenmap/"/>
      <url>/Coming-blog/2022/07/18/04-zenmap/</url>
      
        <content type="html"><![CDATA[<h1 id="zenmap"><a class="markdownIt-Anchor" href="#zenmap"></a> Zenmap</h1><p>Zenmap æ˜¯ä¸€ä¸ªå¯ä»¥åº”ç”¨åœ¨å¤šç§å¹³å°ä¸Šï¼Œè€Œä¸”ç”¨æˆ·æ“ä½œæ€§æä¸ºå‹å¥½çš„ Nmap å›¾å½¢åŒ–ç•Œé¢</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/202207181102041.png" alt="" /></p><h1 id="traceroute"><a class="markdownIt-Anchor" href="#traceroute"></a> TraceRoute</h1><p>è·å–ä¸»æœºä¸ç›®æ ‡æœåŠ¡å™¨ä¹‹é—´çš„è·¯ç”±ä¿¡æ¯</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/202207181216738.png" alt="" /></p>]]></content>
      
      
      <categories>
          
          <category> Kali </category>
          
      </categories>
      
      
        <tags>
            
            <tag> nmap </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>03-æœåŠ¡æ£€æµ‹æŠ€æœ¯</title>
      <link href="/Coming-blog/2022/07/18/03-fu-wu-jian-ce-ji-zhu/"/>
      <url>/Coming-blog/2022/07/18/03-fu-wu-jian-ce-ji-zhu/</url>
      
        <content type="html"><![CDATA[<h1 id="æ“ä½œç³»ç»Ÿæ£€æµ‹"><a class="markdownIt-Anchor" href="#æ“ä½œç³»ç»Ÿæ£€æµ‹"></a> æ“ä½œç³»ç»Ÿæ£€æµ‹</h1><p>æ²¡æœ‰ä¸€ç§å·¥å…·å¯ä»¥æä¾›ç»å¯¹å‡†ç¡®çš„è¿œç¨‹æ“ä½œç³»ç»Ÿä¿¡æ¯ï¼š</p><ul><li>æ£€æŸ¥çš„ç»†èŠ‚åŒ…æ‹¬åˆå§‹åºåˆ—å·ï¼ˆISNï¼‰ã€TCOé€‰é¡¹ã€IPæ ‡è¯†ç¬¦ï¼ˆIDï¼‰æ•°å­—æ—¶é—´æˆ³ã€æ˜¾ç¤ºæ‹¥å¡é€šçŸ¥ï¼ˆECNï¼‰ã€çª—å£å¤§å°ç­‰</li><li>æ¯ä¸ªæ“ä½œç³»ç»Ÿå¯¹äºè¿™äº›æ¢é’ˆéƒ½ä¼šåšå‡ºä¸åŒçš„å“åº”</li><li>é€šè¿‡ <code>-O</code> å‚æ•°è¿›è¡Œæ£€æµ‹</li></ul><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/202207171122383.png" alt="" /></p><p>æä¾›é¢å¤–é€‰é¡¹å¦‚ä¸‹:</p><ul><li><code>--osscan-limit</code>: åªå¯¹æ»¡è¶³ &quot;åŒæ—¶å…·æœ‰çŠ¶æ€ä¸º open å’Œ closed çš„ç«¯å£&quot; æ¡ä»¶çš„ä¸»æœºè¿›è¡Œæ“ä½œç³»ç»Ÿæ£€æµ‹</li><li><code>--osscan-guess</code>: çŒœæµ‹è®¤ä¸ºæœ€æ¥è¿‘ç›®æ ‡çš„åŒ¹é…æ“ä½œç³»ç»Ÿç±»å‹</li><li><code>--max-retries</code>: å¯¹æ“ä½œç³»ç»Ÿæ£€æµ‹å°è¯•çš„æ¬¡æ•°, é»˜è®¤ä¸º 5</li></ul><h2 id="æ“ä½œç³»ç»ŸæŒ‡çº¹"><a class="markdownIt-Anchor" href="#æ“ä½œç³»ç»ŸæŒ‡çº¹"></a> æ“ä½œç³»ç»ŸæŒ‡çº¹</h2><p>æ“ä½œç³»ç»ŸæŒ‡çº¹: æ¯ä¸€ç§ç±»å‹çš„æ“ä½œç³»ç»Ÿéƒ½æœ‰è‡ªå·±çš„ç‰¹å¾, é€šè¿‡å‘ä¸€å°è®¡ç®—æœºå‘é€ç‰¹å®šæ ¼å¼çš„æ¢é’ˆï¼ˆæ•°æ®åŒ…ï¼‰æ¥æŸ¥çœ‹ç›®æ ‡ä¸»æœºçš„å“åº”æ•°æ®ï¼Œè¿™ä¸€è¿‡ç¨‹å°±æ˜¯æ“ä½œç³»ç»ŸæŒ‡çº¹åˆ†æçš„è¿‡ç¨‹</p><ul><li>ç²¾å¿ƒæ„é€ ï¼šçª—å£å¤§å°ã€çª—å£å­—æ®µã€åˆ†ç‰‡æ ‡è¯†ã€æ—¶é—´æˆ³ã€åºå·ä»¥åŠå…¶ä»–ä¸€äº›ç»†èŠ‚ï¼Œä¾‹å¦‚ TTL ç­‰</li><li>nmap-os-db ä¸­å­˜å‚¨è¿™äº›æ“ä½œç³»ç»Ÿç‹¬ç‰¹çš„ç‰¹å¾</li></ul><h1 id="æœåŠ¡å‘ç°"><a class="markdownIt-Anchor" href="#æœåŠ¡å‘ç°"></a> æœåŠ¡å‘ç°</h1><p>éœ€è¦è¿›è¡Œç²¾ç¡®çš„æœåŠ¡å‘ç°, è€Œä¸æ˜¯æ ¹æ®å¼€æ”¾ç«¯å£å¸¸ç”¨çš„æœåŠ¡ç»‘å®šä¿¡æ¯æ¥æ¨æ–­</p><ul><li>ä½¿ç”¨ <code>-sV</code> å‚æ•°: ç«¯å£æ‰«æ + æœåŠ¡è¯†åˆ« + ç‰ˆæœ¬è¯†åˆ«</li><li><code>-A</code> å‚æ•°: åŒæ—¶æ‰“å¼€æ“ä½œç³»ç»Ÿæ¢æµ‹å’ŒæœåŠ¡å‘ç°</li><li>è¾…åŠ© <code>--allports</code>: ä¸ä¸ºç‰ˆæœ¬æ¢æµ‹æ’é™¤ä»»ä½•ç«¯å£</li><li>è¾…åŠ© <code>--version-intensity N</code>ï¼šè®¾å®šæ‰«æçš„å¼ºåº¦(<code>[0, 9]</code>, é»˜è®¤æ˜¯ 7)<ul><li><code>--version-light</code>: è½»é‡çº§æ¨¡å¼, æ‰«æå¼ºåº¦ä¸º 2, é€Ÿåº¦å—</li><li><code>--version-all</code>: æ‰«æå¼ºåº¦ä¸º 9, ä¿è¯å¯¹æ¯ä¸ªç«¯å£å°è¯•æ‰€æœ‰æ¢æµ‹æŠ¥æ–‡</li><li><code>--version-trace</code>: è·Ÿè¸ªç‰ˆæœ¬æ‰«ææ´»åŠ¨, ä½¿ nmap æ‰“å°å‡ºå…³äºæ­£åœ¨è¿›è¡Œçš„æ‰«æçš„è¯¦ç»†è°ƒè¯•ä¿¡æ¯(æ˜¯ç”¨<code>--packet-trace</code> æ‰€å¾—åˆ°çš„ä¿¡æ¯çš„å­é›†)</li></ul></li><li><code>-sR</code>: å¯¹æ‰€æœ‰è¢«å‘ç°å¼€æ”¾çš„ TCP/UDP ç«¯å£æ‰§è¡Œ SunRPC ç¨‹åº NULL å‘½ä»¤ï¼Œè¯•å›¾ç¡®å®šå®ƒä»¬æ˜¯å¦ RPC ç«¯å£ï¼Œå¦‚æœæ˜¯ï¼Œå¯ä»¥ç¡®å®šæ˜¯ä»€ä¹ˆç¨‹åºå’Œç‰ˆæœ¬å·</li></ul><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/202207171145951.png" alt="" /></p>]]></content>
      
      
      <categories>
          
          <category> Kali </category>
          
      </categories>
      
      
        <tags>
            
            <tag> nmap </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>02-ç«¯å£æ‰«ææŠ€æœ¯</title>
      <link href="/Coming-blog/2022/07/17/02-duan-kou-sao-miao-ji-zhu/"/>
      <url>/Coming-blog/2022/07/17/02-duan-kou-sao-miao-ji-zhu/</url>
      
        <content type="html"><![CDATA[<h1 id="ç«¯å£åˆ†ç±»"><a class="markdownIt-Anchor" href="#ç«¯å£åˆ†ç±»"></a> ç«¯å£åˆ†ç±»</h1><ul><li>å…¬è®¤ç«¯å£, Well Known Port: 0 - 1024, è¢«æ˜ç¡®çš„å’ŒæŸç§æœåŠ¡çš„åè®®è¿›è¡Œäº†å…³è”</li><li>æ³¨å†Œç«¯å£, Registered Port: 1025 - 49151, ä¸åŒçš„ç¨‹åºå¯ä»¥æ ¹æ®å®é™…æƒ…å†µè¿›è¡Œç»‘å®š</li><li>åŠ¨æ€å’Œ/æˆ–ç§æœ‰ç«¯å£, dynamic and/or private port: 49152 - 65535, å¸¸è§çš„æœåŠ¡ä¸ä½¿ç”¨, ä½†æ˜¯ç”±äºè¿™éƒ¨åˆ†ç«¯å£ä¸å®¹æ˜“å¼•èµ·æ³¨æ„ï¼Œå› æ­¤æœ‰äº›ç¨‹åºå°¤å…¶æ˜¯ä¸€äº›æœ¨é©¬æˆ–è€…ç—…æ¯’ç¨‹åºååˆ†é’Ÿçˆ±è¿™éƒ¨åˆ†ç«¯å£</li></ul><h1 id="å¸¸è§ç«¯å£"><a class="markdownIt-Anchor" href="#å¸¸è§ç«¯å£"></a> å¸¸è§ç«¯å£</h1><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/202207161909382.png" alt="" /></p><h1 id="nmap-ä¸­ç«¯å£çš„çŠ¶æ€"><a class="markdownIt-Anchor" href="#nmap-ä¸­ç«¯å£çš„çŠ¶æ€"></a> Nmap ä¸­ç«¯å£çš„çŠ¶æ€</h1><ul><li><p>Open: åº”ç”¨ç¨‹åºæ­£åœ¨è¿™ä¸ªç«¯å£ä¸Šç›‘å¬è¿æ¥, æ¥æ”¶ TCP è¿æ¥æˆ–è€… UDP æŠ¥æ–‡</p></li><li><p>Closed: ç«¯å£å¯¹æ¢æµ‹åšå‡ºäº†å“åº”ï¼Œä½†æ˜¯ç°åœ¨æ²¡æœ‰åº”ç”¨ç¨‹åºåœ¨ç›‘å¬è¿™ä¸ªç«¯å£</p></li><li><p>Filtered: æ²¡æœ‰å“åº”ï¼Œå¯èƒ½è¢«ä¸€äº›è¿‡æ»¤å™¨ï¼ˆé˜²ç«å¢™ï¼‰ç»ˆæ­¢äº†</p></li><li><p>Unfiltered: ç«¯å£å¯¹æ¢æµ‹åšå‡ºäº†å“åº”ï¼Œä½†æ˜¯ Nmap æ— æ³•ç¡®å®šå®ƒä»¬æ˜¯ Closed è¿˜æ˜¯ Openï¼ˆå¾ˆå°‘è§ï¼Œå¸¸è§äº ACK æ‰«æï¼‰</p></li><li><p>Open/Filtered: ç«¯å£è¢«è¿‡æ»¤æˆ–è€…æ˜¯å¼€æ”¾çš„ï¼ŒNmap æ— æ³•åšå‡ºåˆ¤æ–­ï¼ˆä¾‹å¦‚å¼€æ”¾çš„ç«¯å£ä¸å“åº”ï¼‰</p></li><li><p>Closed/Filtered: ç«¯å£è¢«è¿‡æ»¤æˆ–è€…æ˜¯å…³é—­çš„ï¼ŒNmapæ— æ³•åšå‡ºåˆ¤æ–­ï¼ˆåªæœ‰åœ¨ä½¿ç”¨ idle æ‰«ææ—¶æ‰ä¼šå‘ç”Ÿè¿™ç§æƒ…å†µï¼‰</p></li></ul><h1 id="æŒ‡å®šæ‰«æçš„ç«¯å£"><a class="markdownIt-Anchor" href="#æŒ‡å®šæ‰«æçš„ç«¯å£"></a> æŒ‡å®šæ‰«æçš„ç«¯å£</h1><p>é’ˆå¯¹ç«¯å£æ‰«æ, nmap å•ç‹¬åˆ—å‡ºäº†ä¸€äº›åˆ—å‚æ•°å®ç°ç›®æ ‡ç«¯å£çš„ç­›é€‰ï¼š</p><ul><li><code>-F</code>: æ‰«æå¸¸è§çš„ 100 ä¸ªç«¯å£</li><li><code>-p 80</code>: æ‰«ææŒ‡å®šçš„ä¸€ä¸ªç«¯å£</li><li><code>-p http</code>: ä½¿ç”¨æœåŠ¡åç§°æŒ‡å®šæ‰«æçš„ç›®æ ‡ç«¯å£</li><li><code>-p U: [UDP ports], T: [TCP, ports]</code>: æ ¹æ® TCP å’Œ UDP åŒºåˆ†</li><li><code>-p *</code>: æ‰«ææ‰€æœ‰ç«¯å£</li><li><code>--top-ports N</code>: æ‰«æå¸¸ç”¨çš„å‰ N ä¸ªç«¯å£</li></ul><h1 id="syn-æ‰«æ"><a class="markdownIt-Anchor" href="#syn-æ‰«æ"></a> SYN æ‰«æ</h1><p>é»˜è®¤çš„ç«¯å£æ‰«ææ–¹å¼</p><ul><li>ä¼˜åŠ¿: é€Ÿåº¦å¿«, éšè”½æ€§é«˜,</li></ul><ol><li>å‘ç›®æ ‡ä¸»æœºçš„ä¸€ä¸ªç«¯å£å‘é€è¯·æ±‚è¿æ¥çš„ SYN æ•°æ®åŒ…</li><li>ç›®æ ‡è®¡ç®—æœºåœ¨æ¥æ”¶åˆ°è¿™ä¸ª SYN æ•°æ®åŒ…ä¹‹åä¼šä»¥ SYN/ACK è¿›è¡Œåº”ç­”</li><li>æ”¶åˆ° SYN/ACK åä¼šå‘é€ RST åŒ…è¯·æ±‚æ–­å¼€è¿æ¥<ul><li>å¦‚æœæ”¶åˆ° RST: closed</li><li>æ²¡æœ‰æ”¶åˆ°åº”ç­”: filtered</li><li>ICMP æ— æ³•æŠµè¾¾é”™è¯¯(ç±»å‹ 3, ä»£ç  1, 2, 3, 4, 10, 13): filtered</li></ul></li></ol><p>Tips: ä¸‰æ¬¡æ¡æ‰‹æ²¡æœ‰å®Œæˆï¼Œæ— æ³•å»ºç«‹æ­£å¸¸çš„ TCP è¿æ¥ï¼Œå› æ­¤ï¼Œè¿™æ¬¡æ‰«æå°±ä¸ä¼šè¢«è®°å½•åˆ°ç³»ç»Ÿæ—¥å¿—ä¸­</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">nmap -sS 192.168.80.132<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h1 id="idle-æ‰«æ"><a class="markdownIt-Anchor" href="#idle-æ‰«æ"></a> idle æ‰«æ</h1><p>åœ¨æ•´ä¸ªæ‰«æè¿‡ç¨‹ä¸­ï¼Œæ‰«æè€…æ— é¡»å‘ç›®æ ‡ä¸»æœºå‘é€ä»»ä½•æ•°æ®åŒ…, é€šè¿‡ç¬¬ä¸‰æ–¹æ¢æµ‹ç›®æ ‡ä¸»æœº:</p><ol><li>æ£€æµ‹ç¬¬ä¸‰æ–¹çš„ IP ID å€¼å¹¶è®°å½•ä¸‹æ¥</li><li>åœ¨æœ¬æœºä¸Šä¼ªé€ ä¸€ä¸ªæºåœ°å€ä¸ºç¬¬ä¸‰æ–¹ä¸»æœºçš„æ•°æ®åŒ…ï¼Œå¹¶å°†æ•°æ®åŒ…å‘é€ç»™ç›®æ ‡ä¸»æœºç«¯å£ï¼Œæ ¹æ®ç›®æ ‡ç«¯å£çŠ¶æ€çš„ä¸åŒï¼Œç›®æ ‡ä¸»æœºå¯èƒ½ä¼šå¯¼è‡´ç¬¬ä¸‰æ–¹ä¸»æœºçš„ IP ID å€¼å¢åŠ </li><li>å†å›æ¥æ£€æŸ¥ç¬¬ä¸‰æ–¹ä¸»æœºçš„ IP ID å€¼, æ¯”è¾ƒè¿™ä¸¤æ¬¡çš„å€¼<ul><li>å¦‚æœå¢åŠ äº† 1: è¯´æ˜ç¬¬ä¸‰æ–¹ä¸»æœºåœ¨è¿™æœŸé—´å¹¶æ²¡æœ‰å‘å¤–å‘é€æ•°æ®åŒ…ï¼Œè¿™ç§æƒ…å†µå°±è®¤ä¸ºç›®æ ‡ä¸»æœºçš„ç«¯å£æ˜¯å…³é—­çš„</li><li>å¦‚æœå¢åŠ äº† 2: è¡¨æ˜ç¬¬ä¸‰æ–¹ä¸»æœºåœ¨è¿™æœŸé—´å‘å¤–éƒ¨å‘é€äº†æ•°æ®åŒ…ï¼Œè¿™æ ·å°±è¯´æ˜ç›®æ ‡ä¸»æœºçš„ç«¯å£æ˜¯å¼€æ”¾çš„</li></ul></li></ol><p>ä¼˜åŠ¿ï¼šéšè”½æ€§é«˜, å¯ä»¥ç»•è¿‡ç½‘ç»œä¸­çš„ä¸€äº›å®‰å…¨æœºåˆ¶ï¼ˆä¼ªé€ æŒ‡å®š IP ç»•è¿‡ ACLï¼‰</p><ul><li>æœ‰äº›æ—¶å€™ï¼Œä¸€äº›å·¥ä½œäººå‘˜ä¸ºäº†æ–¹ä¾¿ï¼Œç»å¸¸ä¼šåœ¨é˜²ç«å¢™æˆ–è€…è·¯ç”±å™¨ä¸Šè®¾ç½®ä¾‹å¤–ï¼Œå…è®¸ä»–ä»¬ä»å®¶ä¸­å¯¹å•ä½çš„ç½‘ç»œè¿›è¡Œè®¿é—®</li></ul><p>åŠ£åŠ¿ï¼šé€Ÿåº¦æ…¢, å¾ˆå¤šæ—¶å€™ï¼Œå®½å¸¦æä¾›å•†å¹¶ä¸ä¼šå…è®¸ä½ å‘å¤–å‘é€ä¼ªé€ çš„æ•°æ®åŒ…, è¦æ±‚ä½ å¿…é¡»èƒ½æ‰¾åˆ°ä¸€ä¸ªæ­£åœ¨å·¥ä½œçš„ç¬¬ä¸‰æ–¹ä¸»æœº</p><h2 id="å¯»æ‰¾åˆé€‚ç¬¬ä¸‰æ–¹ä¸»æœº"><a class="markdownIt-Anchor" href="#å¯»æ‰¾åˆé€‚ç¬¬ä¸‰æ–¹ä¸»æœº"></a> å¯»æ‰¾åˆé€‚ç¬¬ä¸‰æ–¹ä¸»æœº</h2><ol><li>åœ¨å¯¹ä¸€å°ä¸»æœºè¿›è¡Œæ‰«æçš„æ—¶å€™ï¼Œæ‰§è¡Œä¸€ä¸ªç«¯å£æ‰«æä»¥åŠæ“ä½œç³»ç»Ÿæ£€æµ‹ï¼Œå¯åŠ¨è¯¦ç»†æ¨¡å¼ï¼ˆ-vï¼‰ï¼Œæ“ä½œç³»ç»Ÿå°±ä¼šæ£€æµ‹ IP ID å¢é•¿æ–¹æ³•ï¼Œå¦‚æœè¿”å›å€¼ä¸º â€œIP ID Sequence Generation:Incrementalâ€ï¼Œè¡¨æ˜è¯¥æœºå™¨æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„åƒµå°¸å€™é€‰æœºå™¨</li><li>è¿è¡Œ ipidseq NSE è„šæœ¬</li></ol><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">nmap -Pn -p- -sI kiosk.adobe.com www.riaa.com<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h1 id="å…¶å®ƒæ‰«ææ–¹å¼"><a class="markdownIt-Anchor" href="#å…¶å®ƒæ‰«ææ–¹å¼"></a> å…¶å®ƒæ‰«ææ–¹å¼</h1><h2 id="connect-æ‰«æ"><a class="markdownIt-Anchor" href="#connect-æ‰«æ"></a> Connect æ‰«æ</h2><p>ä¸ SYN ç±»ä¼¼, åªä¸è¿‡å®Œæˆäº† TCP çš„ä¸‰æ¬¡æ¡æ‰‹(ä½†æ˜¯ä¸éœ€è¦ root æˆ– administrator æƒé™äº†)</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">nmap -sT 192.168.80.132<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="udp-æ‰«æ"><a class="markdownIt-Anchor" href="#udp-æ‰«æ"></a> UDP æ‰«æ</h2><p>UDP ç¨‹åºçš„æœåŠ¡é€šå¸¸ä¸ä¼šå¯¹ Nmap æ‰€å‘é€çš„ç©ºæ•°æ®åŒ…åšå‡ºå›åº”ï¼Œéœ€è¦å¯¹å¸¸è§çš„ UDP æœåŠ¡å‘é€åˆé€‚çš„æ•°æ®åŒ…ï¼š</p><ul><li><p>ä¸ºäº†é’ˆå¯¹æ€§çš„å‘é€åˆé€‚çš„æ•°æ®åŒ…, Nmap é‡‡ç”¨äº†ä¸€ä¸ªå¾ˆå¤§çš„æ•°æ®åº“æ¥å­˜å‚¨è¿™äº›æ ¼å¼ <code>Nmap-service-probes</code></p></li><li><p>å¯ä»¥ä½¿ç”¨ -sV æˆ–è€… -A, Nmap å°†ä¼šå‘æ¯ä¸ª open|filtered çš„ç«¯å£å‘é€ UDP probeï¼Œå¦‚æœç›®æ ‡ç«¯å£å¯¹ä»»ä½•ä¸€ä¸ª probe æœ‰äº†ååº”ï¼ŒçŠ¶æ€éƒ½ä¼šè¢«ä¿®æ”¹ä¸º open</p></li><li><p>å¦‚æœç›®æ ‡ç«¯å£æœ‰åº”ç­”: open</p></li><li><p>æ²¡æœ‰åº”ç­”: open | filtered</p></li><li><p>ICMP æ— æ³•æŠµè¾¾é”™è¯¯(ç±»å‹ 3, ä»£ç  3): closed</p></li><li><p>ICMP æ— æ³•æŠµè¾¾é”™è¯¯(ç±»å‹ 3, ä»£ç  1, 2, 9, 10, 13): filtered</p></li></ul><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">nmap -sU 192.168.80.132nmap -sV 192.168.80.132<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/202207161946961.png" alt="" /></p><h2 id="tcp-fin-æ‰«æ"><a class="markdownIt-Anchor" href="#tcp-fin-æ‰«æ"></a> TCP FIN æ‰«æ</h2><p>å‘ç›®æ ‡ç«¯å£å‘é€ä¸€ä¸ª FIN æ•°æ®åŒ…, å¯¹äºæ‰€æœ‰å…³é—­çš„ç«¯å£(RFC 793 è§„å®š), ç›®æ ‡ç³»ç»Ÿåº”è¿”å› RST æ ‡å¿—</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">nmap -sF 192.168.80.132<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="null-æ‰«æ"><a class="markdownIt-Anchor" href="#null-æ‰«æ"></a> NULL æ‰«æ</h2><p>å‘ç›®æ ‡ç«¯å£å‘é€ä¸€ä¸ªä¸åŒ…å«ä»»ä½•æ ‡å¿—çš„æ•°æ®åŒ…, å¯¹äºæ‰€æœ‰å…³é—­çš„ç«¯å£(RFC 793 è§„å®š), ç›®æ ‡ç³»ç»Ÿåº”è¿”å› RST æ ‡å¿—</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">nmap -sN 192.168.80.132<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="xmas-tree-æ‰«æ"><a class="markdownIt-Anchor" href="#xmas-tree-æ‰«æ"></a> Xmas Tree æ‰«æ</h2><p>å‘ç›®æ ‡ç«¯å£å‘é€ä¸€ä¸ªå«æœ‰ FINã€URG å’Œ PUSH æ ‡å¿—çš„æ•°æ®åŒ…, å¯¹äºæ‰€æœ‰å…³é—­çš„ç«¯å£(RFC 793 è§„å®š), ç›®æ ‡ç³»ç»Ÿåº”è¿”å› RST æ ‡å¿—</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">nmap -sX 192.168.80.132<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> Kali </category>
          
      </categories>
      
      
        <tags>
            
            <tag> nmap </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>01-æ´»è·ƒä¸»æœºå‘ç°æŠ€æœ¯</title>
      <link href="/Coming-blog/2022/07/15/01-huo-yue-zhu-ji-fa-xian-ji-zhu/"/>
      <url>/Coming-blog/2022/07/15/01-huo-yue-zhu-ji-fa-xian-ji-zhu/</url>
      
        <content type="html"><![CDATA[<h1 id="æ´»è·ƒä¸»æœºå‘ç°æŠ€æœ¯"><a class="markdownIt-Anchor" href="#æ´»è·ƒä¸»æœºå‘ç°æŠ€æœ¯"></a> æ´»è·ƒä¸»æœºå‘ç°æŠ€æœ¯</h1><p>æ´»è·ƒä¸»æœº: é‚£äº›å·²ç»äºè¿è¡ŒçŠ¶æ€å¹¶ä¸”ç½‘ç»œåŠŸèƒ½æ­£å¸¸çš„ä¸»æœº</p><p>åè®®ä¸çº¦å®š: åè®®ä¸­æ˜ç¡®è§„å®šäº†å¦‚æœä¸€å°è®¡ç®—æœºæ”¶åˆ°æ¥è‡ªå¦ä¸€å°è®¡ç®—æœºçš„ç‰¹å®šæ ¼å¼æ•°æ®åŒ…ååº”è¯¥å¦‚ä½•å¤„ç†</p><ul><li>æ‰€æœ‰çš„åè®®è§„èŒƒéƒ½å¯ä»¥å‚è€ƒ Request For Comments (RFCï¼‰</li></ul><p>Tips: Nmap ä¼šé¦–å…ˆåˆ¤æ–­ç›®æ ‡ä¸»æœºä¸ Nmap æ‰€åœ¨ä¸»æœºæ˜¯å¦åœ¨åŒä¸€ç½‘æ®µï¼Œå¦‚æœç›¸åŒçš„è¯ï¼Œåˆ™ç›´æ¥ä½¿ç”¨ ARP æ‰«ææ¨¡å¼</p><h2 id="å¿«é€Ÿçš„æ´»è·ƒä¸»æœºå‘ç°"><a class="markdownIt-Anchor" href="#å¿«é€Ÿçš„æ´»è·ƒä¸»æœºå‘ç°"></a> å¿«é€Ÿçš„æ´»è·ƒä¸»æœºå‘ç°</h2><p>Nmap åœ¨æ‰«ææ—¶ï¼Œé»˜è®¤ä¼šå°†ç›®æ ‡ç«¯å£ç­‰ä¿¡æ¯ä¹Ÿæ‰«æå‡ºæ¥, è¿™æ ·é€Ÿåº¦å°±ä¼šæ…¢ä¸‹æ¥, å› æ­¤å¦‚æœåªæƒ³çŸ¥é“ç›®æ ‡ä¸»æœºé›†åˆæ˜¯å¦å­˜åœ¨æ´»è·ƒä¸»æœºçš„åŒ–, å¯ä»¥ä½¿ç”¨ <code>-sn</code> å‚æ•°</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">nmap -sn 192.168.80.0&#x2F;24<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h1 id="åŸºäº-arp"><a class="markdownIt-Anchor" href="#åŸºäº-arp"></a> åŸºäº ARP</h1><p>ARP: è§£å†³é€»è¾‘åœ°å€ (IP) å’Œç‰©ç†åœ°å€ (MAC) çš„è½¬æ¢å…³ç³»</p><ul><li>åŒä¸€ç½‘æ®µä¸­çš„é€šä¿¡ä¸€èˆ¬ä½¿ç”¨ç‰©ç†åœ°å€ï¼Œä¸åŒç½‘æ®µä¹‹é—´çš„é€šä¿¡ä¸€èˆ¬ä½¿ç”¨é€»è¾‘åœ°å€</li><li>ä¸ºä»€ä¹ˆä¸åªç”¨ä¸€ä¸ªåœ°å€: åŒç½‘æ®µé€šä¿¡ä¸å¿…å…ˆç»è¿‡äº’è”ç½‘åœ¨è½¬å›æ¥ï¼ˆä¸å¿…å¿«é€’å‘˜å‚ä¸ï¼‰</li></ul><p>äº¤æ¢æœº: å†…å®¹å¯»å€å¯„å­˜å™¨ä¸­å­˜å‚¨äº†æ¯ä¸ªæ¥å£æ‰€è¿æ¥çš„ä¸»æœºçš„ç‰©ç†åœ°å€è¡¨, é€šè¿‡ ARP è·å–æ¯ä¸ªæ¥å£æ‰€è¿æ¥çš„ç‰©ç†åœ°å€</p><p>åŸç†: ARP åœ¨æœ¬ç½‘æ®µå†…å¯¹ç›®æ ‡ IP å¹¿æ’­è¯·æ±‚åŒ…, ç›®æ ‡ IP æ¥æ”¶åå¦‚æœæ´»è·ƒå°±å¿…é¡»å›åº”ï¼ˆå¦‚æœè¿å ARP è¿™ä¸ªçº¦å®š, å°†æ„å‘³ç€æ— æ³•é€šä¿¡ï¼‰,å¦‚æœæ²¡æœ‰å›åº”, åˆ™ç›®æ ‡ IP ä¸åœ¨çº¿</p><h2 id="ä¸»æœºå‘ç°"><a class="markdownIt-Anchor" href="#ä¸»æœºå‘ç°"></a> ä¸»æœºå‘ç°</h2><p><code>nmap -PR -sn 192.168.80.6</code>: å…ˆå‘é€ <code>who has 192.168.80.6 tell $&#123;me&#125;</code> ç›®æ ‡æ¥æ”¶åˆ°ä¼šå“åº” <code>ARP Reply 192.168.80.6 is-at $&#123;MAC&#125;</code></p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/202207150944059.png" alt="" /></p><h1 id="åŸºäº-icmp"><a class="markdownIt-Anchor" href="#åŸºäº-icmp"></a> åŸºäº ICMP</h1><p>ICMP: Internet Control Message Protocol, åœ¨IPä¸»æœºã€è·¯ç”±å™¨ä¹‹é—´ä¼ é€’æ§åˆ¶æ¶ˆæ¯</p><p>æŠ¥æ–‡ç§ç±»ç¹å¤š:</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/202207150947418.png" alt="" /></p><p>åŸç†: ä½¿ç”¨ ICMP çš„æŸ¥è¯¢æŠ¥æ–‡</p><ul><li>å“åº”è¯·æ±‚å’Œåº”ç­”: ï¼ˆping) æµ‹è¯•å‘é€ä¸æ¥æ”¶ä¸¤ç«¯é“¾è·¯åŠç›®æ ‡ä¸»æœº TCP/IP åè®®æ˜¯å¦æ­£å¸¸ï¼Œåªè¦æ”¶åˆ°å°±æ˜¯æ­£å¸¸</li><li>æ—¶é—´æˆ³è¯·æ±‚å’Œåº”ç­”: å‘å¦ä¸€ä¸ªç³»ç»ŸæŸ¥è¯¢å½“å‰çš„æ—¶é—´, è¿”å›çš„å»ºè®®å€¼æ˜¯è‡ªåˆå¤œå¼€å§‹è®¡ç®—çš„æ¯«ç§’æ•°ï¼Œå³åè°ƒä¸–ç•Œæ—¶ï¼ˆCoordinated Universal Time, UTCï¼‰</li><li>åœ°å€æ©ç è¯·æ±‚å’Œåº”ç­”: ç”¨äºæ— ç›˜ç³»ç»Ÿåœ¨å¼•å¯¼è¿‡ç¨‹ä¸­è·å–è‡ªå·±çš„å­ç½‘æ©ç </li></ul><h2 id="ä¸»æœºå‘ç°-2"><a class="markdownIt-Anchor" href="#ä¸»æœºå‘ç°-2"></a> ä¸»æœºå‘ç°</h2><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">nmap -PE -sn 192.168.80.132 # åŸºäºè¯·æ±‚ä¸åº”ç­”æŸ¥è¯¢æŠ¥æ–‡nmap -PP -sn 192.168.80.132 # åŸºäºæ—¶é—´æˆ³è¯·æ±‚ä¸åº”ç­”æŸ¥è¯¢æŠ¥æ–‡nmap -PM -sn 192.168.80.132 # åŸºäºåœ°å€æ©ç è¯·æ±‚ä¸åº”ç­”æŸ¥è¯¢æŠ¥æ–‡<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h1 id="åŸºäº-tcp"><a class="markdownIt-Anchor" href="#åŸºäº-tcp"></a> åŸºäº TCP</h1><p>TCP: Transmission Control Protocolï¼Œä¼ è¾“æ§åˆ¶åè®®</p><p>åŸç†: å‘ç›®æ ‡ä¸»æœºçš„ä¸€éƒ¨åˆ†å¸¸ç”¨ç«¯å£å‘é€è¿æ¥è¯·æ±‚æ•°æ®åŒ…ï¼Œå¦‚æœå¾—åˆ°å›åº”ï¼ˆæ³¨æ„<strong>åªè¦æ”¶åˆ°äº†æ•°æ®åŒ…</strong>ï¼‰ï¼Œå°±å¯ä»¥è®¤ä¸ºä¸»æœº B æ˜¯æ´»è·ƒä¸»æœº</p><h2 id="å¸¸ç”¨ç«¯å£"><a class="markdownIt-Anchor" href="#å¸¸ç”¨ç«¯å£"></a> å¸¸ç”¨ç«¯å£</h2><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/202207151113401.png" alt="" /></p><h2 id="ä¸»æœºå‘ç°-3"><a class="markdownIt-Anchor" href="#ä¸»æœºå‘ç°-3"></a> ä¸»æœºå‘ç°</h2><h3 id="syn-rst"><a class="markdownIt-Anchor" href="#syn-rst"></a> SYN + RST</h3><p><code>-PS</code>: å‘ç›®æ ‡ä¸»æœºå‘é€ä¸€ä¸ªè®¾ç½®äº† SYN æ ‡å¿—çš„æ•°æ®åŒ…(å†…å®¹éƒ¨åˆ†ä¸ºç©º, é»˜è®¤çš„ç›®æ ‡ç«¯å£æ˜¯ 80)</p><ul><li>å¯ä»¥ä½¿ç”¨å‚æ•°æ¥æ”¹å˜ç›®æ ‡ç«¯å£, å½“æŒ‡å®šå¤šä¸ªç«¯å£æ—¶ï¼ŒNmap å°†ä¼šå¹¶å‘åœ°å¯¹è¿™äº›ç«¯å£è¿›è¡Œæµ‹è¯•</li><li>å¦‚æœç«¯å£å¼€æ”¾ï¼šå“åº” SYN/ACK æ•°æ®åŒ…ï¼Œè¡¨ç¤ºåŒæ„å»ºç«‹è¿æ¥, æœ¬åœ°å“åº” RST ç»“æŸè¿æ¥</li><li>å¦‚æœç«¯å£å…³é—­ï¼šå“åº” RST æ•°æ®åŒ…ï¼Œè¡¨ç¤ºæ‹’ç»è¿æ¥</li><li>ä½†æ˜¯æ— è®ºç«¯å£æ˜¯å¦å¼€æ”¾, åªè¦æœ‰å“åº”éƒ½è¡¨ç¤ºä¸»æœºæ´»è·ƒ</li></ul><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/202207151110352.png" alt="" /></p><h3 id="ack"><a class="markdownIt-Anchor" href="#ack"></a> ACK</h3><p><code>-PA</code>: ç›´æ¥å‘ç›®æ ‡ä¸»æœºå‘é€ä¸€ä¸ª ACK æ•°æ®åŒ…ï¼Œç›®æ ‡ä¸»æœºæ˜¾ç„¶æ— æ³•æ¸…æ¥šè¿™æ˜¯æ€ä¹ˆå›äº‹ï¼Œå½“ç„¶ä¹Ÿä¸å¯èƒ½æˆåŠŸå»ºç«‹ TCP è¿æ¥ï¼Œå› æ­¤åªèƒ½å‘ Nmap æ‰€åœ¨ä¸»æœºå‘é€ä¸€ä¸ª RST æ ‡å¿—ä½çš„æ•°æ®åŒ…ï¼Œè¡¨ç¤ºæ— æ³•å»ºç«‹è¿™ä¸ª TCP è¿æ¥</p><ul><li>ä¸æ¨èä½¿ç”¨, å› ä¸ºå¯èƒ½ä¼šè¢«é˜²ç«å¢™è¿‡æ»¤æ‰è€Œå¯¼è‡´å“åº”çš„æƒ…å†µå¤šæ ·</li></ul><h1 id="åŸºäº-udp"><a class="markdownIt-Anchor" href="#åŸºäº-udp"></a> åŸºäº UDP</h1><p>UDP: éé¢å‘è¿æ¥çš„, ä½¿å¾— UDP ç«¯å£æ‰«æçš„å¯é æ€§ä¸é«˜</p><p>åŸç†: å½“ä¸€ä¸ª UDP ç«¯å£æ”¶åˆ°ä¸€ä¸ª UDP æ•°æ®åŒ…æ—¶ï¼Œå¦‚æœå®ƒæ˜¯å…³é—­çš„ï¼Œå°±ä¼šç»™æºç«¯å‘å›ä¸€ä¸ª ICMP ç«¯å£ä¸å¯è¾¾æ•°æ®åŒ…ï¼›å¦‚æœå®ƒæ˜¯å¼€æ”¾çš„ï¼Œå°±ä¼šå¿½ç•¥è¿™ä¸ªæ•°æ®åŒ…ï¼Œä¹Ÿå°±æ˜¯å°†å®ƒä¸¢å¼ƒè€Œä¸è¿”å›ä»»ä½•ä¿¡æ¯</p><ul><li>ä½†æ˜¯ä¸è¿”å›ä»»ä½•ä¿¡æ¯å¯èƒ½è¡¨ç¤ºè¿™ä¸ªæ•°æ®åŒ…åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­ä¸¢å¤±äº†æˆ–è€…è¢«é˜²ç«å¢™æ‹¦æˆªäº†</li><li>æ­¤å¤–ç¡®å®šä¸è¿”å›ä»»ä½•ä¿¡æ¯æ‰€éœ€è¦çš„æ—¶é—´ä¹Ÿå¾ˆé•¿, å› æ­¤æ‰«ææ•ˆç‡é™ä½</li></ul><h2 id="ä¸»æœºå‘ç°-4"><a class="markdownIt-Anchor" href="#ä¸»æœºå‘ç°-4"></a> ä¸»æœºå‘ç°</h2><ul><li><code>-PU</code>:</li></ul><h1 id="åŸºäº-sctp"><a class="markdownIt-Anchor" href="#åŸºäº-sctp"></a> åŸºäº SCTP</h1><p>SCTP: ä¸ TCP åŒå±äºä¼ è¾“å±‚ä¸Šçš„åè®®ï¼Œä¸ TCP å®Œæˆçš„ä»»åŠ¡æ˜¯ç›¸åŒçš„ï¼Œä½†ä¸¤è€…ä¹‹é—´å´å­˜åœ¨ç€å¾ˆå¤§çš„ä¸åŒä¹‹å¤„</p><ul><li>TCP åè®®ä¸€èˆ¬æ˜¯ç”¨äºå•åœ°å€è¿æ¥çš„ï¼Œè€Œ SCTP å´å¯ä»¥ç”¨äºå¤šåœ°å€è¿æ¥</li><li>TCP åè®®æ˜¯åŸºäºå­—èŠ‚æµçš„ï¼ŒSCTP æ˜¯åŸºäºæ¶ˆæ¯æµçš„</li><li>TCP åªèƒ½æ”¯æŒä¸€ä¸ªæµï¼Œè€Œ SCTP è¿æ¥ï¼ˆassociationï¼‰åŒæ—¶å¯ä»¥æ”¯æŒå¤šä¸ªæµï¼ˆstreamï¼‰</li><li>TCP è¿æ¥çš„å»ºç«‹æ˜¯é€šè¿‡ä¸‰æ¬¡æ¡æ‰‹å®ç°çš„ï¼Œè€Œ SCTP æ˜¯é€šè¿‡ä¸€ç§ 4 æ¬¡æ¡æ‰‹çš„æœºåˆ¶å®ç°çš„ï¼Œè¿™ç§æœºåˆ¶å¯ä»¥æœ‰æ•ˆé¿å…æ”»å‡»çš„äº§ç”Ÿ</li></ul><p>æµç¨‹:</p><ol><li>å®¢æˆ·ç«¯ä½¿ç”¨ä¸€ä¸ª INIT æŠ¥æ–‡å‘èµ·ä¸€ä¸ªè¿æ¥</li><li>æœåŠ¡å™¨ç«¯ä½¿ç”¨ä¸€ä¸ª INIT-ACK æŠ¥æ–‡è¿›è¡Œåº”ç­”ï¼Œå…¶ä¸­å°±åŒ…æ‹¬äº† cookieï¼ˆæ ‡è¯†è¿™ä¸ªè¿æ¥çš„å”¯ä¸€ä¸Šä¸‹æ–‡ï¼‰</li><li>å®¢æˆ·ç«¯ä½¿ç”¨ä¸€ä¸ª COOKIE-ECHO æŠ¥æ–‡è¿›è¡Œå“åº”ï¼Œå…¶ä¸­åŒ…å«äº†æœåŠ¡å™¨ç«¯æ‰€å‘é€çš„ cookie</li><li>æœåŠ¡å™¨ç«¯è¦ä¸ºè¿™ä¸ªè¿æ¥åˆ†é…èµ„æºï¼Œå¹¶é€šè¿‡å‘å®¢æˆ·ç«¯å‘é€ä¸€ä¸ª COOKIE-ACK æŠ¥æ–‡å¯¹å…¶è¿›è¡Œå“åº”</li></ol><h2 id="ä¸»æœºå‘ç°-5"><a class="markdownIt-Anchor" href="#ä¸»æœºå‘ç°-5"></a> ä¸»æœºå‘ç°</h2><ul><li><code>-PY</code>: ç›®å‰æ”¯æŒè¿™ä¸ªåè®®çš„ä¸»æœºå¹¶ä¸å¤šï¼Œå› æ­¤è¿™ç§æ–¹æ³•åªèƒ½ä½œä¸ºä¸€ç§å¤‡ç”¨æ‰‹æ®µ</li></ul><h1 id="åŸºäº-ip-åè®®"><a class="markdownIt-Anchor" href="#åŸºäº-ip-åè®®"></a> åŸºäº IP åè®®</h1><p>IP åè®®: æ˜¯ TCP/IP åè®®æ—ä¸­çš„æ ¸å¿ƒåè®®ï¼Œä¹Ÿæ˜¯ TCP/IP çš„è½½ä½“ã€‚æ‰€æœ‰çš„ TCPã€UDPã€ICMP åŠ IGMP æ•°æ®éƒ½ä»¥ IP æ•°æ®åŒ…æ ¼å¼ä¼ è¾“</p><ul><li>åè®®åŸŸ: æ ‡è¯†æ˜¯å“ªä¸ªåè®®å‘ IP ä¼ é€æ•°æ®, ICMP(1), IGMP(2), TCP(6), UDP(17), GRE(47), ESP(50)</li></ul><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/202207151152444.png" alt="" /></p><p>åŸç†: Nmap å…è®¸å‘ç›®æ ‡ä¸»æœºå‘é€ IP æ•°æ®åŒ…æ¥æ£€æµ‹ç›®æ ‡ä¸»æœºæ˜¯å¦æ´»è·ƒ, é»˜è®¤ä½¿ç”¨ ICMPã€IGMP å’Œ IP-in-IPï¼ˆIPåè®®ç¼–å·4ï¼‰ä¸‰ä¸ªåè®®ï¼Œå¦å¤–ä¹Ÿå¯ä»¥ä½¿ç”¨å‚æ•° <code>-PO</code> æ¥æŒ‡å®šæ‰€è¦ä½¿ç”¨åè®®çš„ç¼–å·ï¼Œä¾‹å¦‚é»˜è®¤çš„ IP æ‰«ææ–¹å¼</p><h2 id="ä¸»æœºå‘ç°-6"><a class="markdownIt-Anchor" href="#ä¸»æœºå‘ç°-6"></a> ä¸»æœºå‘ç°</h2><p>æŒ‡å®š IP åè®®è¿›è¡Œä¸»æœºå‘ç°ï¼š</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">nmap -sP -PO 192.168.80.132nmap -sP -PO 1,2,4 192.168.80.132<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>é»˜è®¤æƒ…å†µ IP åŒ…ä¸­çš„æ•°æ®éƒ½æ˜¯ç©ºçš„, å› æ­¤å¯ä»¥ä½¿ç”¨ <code>--data-length</code> æ¥è®¾ç½®éšæœºæ•°æ®çš„é•¿åº¦</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">nmap -sP -PO --data-length 25 192.168.80.132<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h1 id="ä¸»æœºåŸŸåè§£æ"><a class="markdownIt-Anchor" href="#ä¸»æœºåŸŸåè§£æ"></a> ä¸»æœºåŸŸåè§£æ</h1><ul><li><code>-R</code> å‚æ•°: å°†æ‰«æçš„ IP é›†åˆæ— è®ºæ˜¯å¦æ˜¯æ´»è·ƒä¸»æœº, éƒ½å°è¯•åˆ—å‡ºä¸»æœºå¯¹åº”çš„åŸŸåï¼ˆå°†ä¼šè€—è´¹å¤§é‡æ—¶é—´ï¼‰</li><li><code>-n</code>: å–æ¶ˆå¯¹åŸŸåçš„è½¬æ¢</li><li><code>--dns-servers</code>: æŒ‡å®šæŸä¸€ä¸ª DNS æœåŠ¡æŸ¥è¯¢ç›®æ ‡åŸŸå</li></ul><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"># å¤šä¸ª DNS æœåŠ¡å™¨ä½¿ç”¨ é€—å· åˆ†å‰²nmap --packet-trace -R --dns-servers 202.99.160.68 192.168.80.132<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h1 id="tips"><a class="markdownIt-Anchor" href="#tips"></a> Tips</h1><ul><li><code>--packet-trace</code> é€‰é¡¹: å¯ä»¥è§‚å¯Ÿ Nmap å‘å‡ºäº†å“ªäº›æ•°æ®åŒ…ï¼Œæ”¶åˆ°äº†å“ªäº›æ•°æ®åŒ…</li></ul><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/202207151305994.png" alt="" /></p>]]></content>
      
      
      <categories>
          
          <category> Kali </category>
          
      </categories>
      
      
        <tags>
            
            <tag> nmap </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>02-Kotlin</title>
      <link href="/Coming-blog/2022/07/14/02-kotlin/"/>
      <url>/Coming-blog/2022/07/14/02-kotlin/</url>
      
        <content type="html"><![CDATA[<h1 id="kotlin"><a class="markdownIt-Anchor" href="#kotlin"></a> Kotlin</h1><p>JetBrains å…¬å¸å¼€å‘è®¾è®¡çš„:</p><ul><li>Java -&gt; .class -&gt; JAVA è™šæ‹Ÿæœº -&gt; äºŒè¿›åˆ¶</li><li>Kotlin -&gt; .class -&gt; JAVA è™šæ‹Ÿæœº -&gt; äºŒè¿›åˆ¶</li></ul><p>å¼€å‘å·¥å…·:</p><ul><li>IntelliJ IDEA</li><li><a target="_blank" rel="noopener" href="https://try.kotlinlang.org/">åœ¨çº¿</a></li><li>Android Studio: åœ¨ä¸€ä¸ª Android é¡¹ç›®ä¸­ç¼–å†™ä¸€ä¸ª Kotlin çš„ main() å‡½æ•°å³å¯ç‹¬ç«‹è¿è¡Œ Kotlin ä»£ç </li></ul><h2 id="ä¼˜åŠ¿"><a class="markdownIt-Anchor" href="#ä¼˜åŠ¿"></a> ä¼˜åŠ¿</h2><ul><li>è¯­æ³•ç®€æ´, ä»£ç é‡å°‘äº†</li><li>è¯­æ³•é«˜çº§, å¼€å‘æ•ˆç‡é«˜</li><li>è¯­è¨€å®‰å…¨</li><li>æ”¯æŒä½¿ç”¨ Java ç¬¬ä¸‰æ–¹çš„å¼€æºåº“</li></ul><h1 id="å˜é‡"><a class="markdownIt-Anchor" href="#å˜é‡"></a> å˜é‡</h1><h2 id="å˜é‡å£°æ˜"><a class="markdownIt-Anchor" href="#å˜é‡å£°æ˜"></a> å˜é‡å£°æ˜</h2><p>Kotlin å…·æœ‰å‡ºè‰²çš„ç±»å‹æ¨å¯¼æœºåˆ¶, å› æ­¤ä»…æœ‰ä¸¤ç§å£°æ˜å˜é‡çš„å…³é”®å­—:</p><ul><li><code>val</code>: value, å£°æ˜ä¸€ä¸ª<strong>ä¸å¯å˜</strong>çš„å˜é‡, åœ¨åˆå§‹èµ‹å€¼ä¹‹åå°±å†ä¹Ÿä¸èƒ½é‡æ–°èµ‹å€¼(å¯¹åº” Java ä¸­çš„ final å˜é‡)</li><li><code>var</code>: variable, å£°æ˜ä¸€ä¸ª<strong>å¯å˜</strong>çš„å˜é‡</li></ul><h2 id="æ˜¾ç¤ºç±»å‹å£°æ˜"><a class="markdownIt-Anchor" href="#æ˜¾ç¤ºç±»å‹å£°æ˜"></a> æ˜¾ç¤ºç±»å‹å£°æ˜</h2><p>å½“å˜é‡éœ€è¦å»¶è¿Ÿèµ‹å€¼æ—¶, é€šè¿‡ <code>: Type</code> çš„å½¢å¼æŒ‡å®šå˜é‡çš„ç±»å‹</p><ul><li>Kotlin å®Œå…¨æŠ›å¼ƒäº† Java çš„åŸºæœ¬æ•°æ®ç±»å‹, ä½¿ç”¨å¯¹è±¡æ•°æ®ç±»å‹</li><li><code>Int, Long, Short, Float, Double, Boolean, Char, Byte</code></li><li><code>Unit</code> ç±»å‹è¡¨ç¤ºå‡½æ•°è¿”å›æ— æ„ä¹‰çš„å€¼, å¯ä»¥çœç•¥</li></ul><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">val</span> a<span class="token operator">:</span> Int <span class="token operator">=</span> <span class="token number">10</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="å®šä¹‰åŒºé—´"><a class="markdownIt-Anchor" href="#å®šä¹‰åŒºé—´"></a> å®šä¹‰åŒºé—´</h2><ul><li><code>val range = 0..10</code>: å®šä¹‰ <code>[0, 10]</code> çš„åŒºé—´</li><li><code>val range = 0 until 10</code>: å®šä¹‰ <code>[0, 10)</code> çš„åŒºé—´</li><li><code>val range = 10 downTo 0</code>: å®šä¹‰ <code>[10, 0]</code> çš„åŒºé—´</li></ul><p>ä½¿ç”¨ <code>in</code> å…³é”®å­—æ£€æµ‹ç›®æ ‡æ˜¯å¦åœ¨åŒºé—´/é›†åˆä¸­:</p><ul><li><code>if (-1 !in 0..list.lastIndex) &#123; ... &#125;</code></li><li><code>if (list.size !in list.indices) &#123; ... &#125;</code></li></ul><h2 id="æ¨¡æ¿å­—ç¬¦ä¸²"><a class="markdownIt-Anchor" href="#æ¨¡æ¿å­—ç¬¦ä¸²"></a> æ¨¡æ¿å­—ç¬¦ä¸²</h2><ul><li><code>$value</code> åœ¨å­—ç¬¦ä¸²ä¸­è°ƒç”¨å˜é‡</li><li><code>$&#123;s1.replace(&quot;is&quot;, &quot;was&quot;)&#125;</code> æ¨¡æ¿è¡¨è¾¾å¼</li></ul><h2 id="ç±»å‹æ£€æµ‹"><a class="markdownIt-Anchor" href="#ç±»å‹æ£€æµ‹"></a> ç±»å‹æ£€æµ‹</h2><p>ä½¿ç”¨ <code>is</code> å…³é”®å­—(ç±»æ¯” Java çš„ <code>instanceof</code>)</p><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">if</span> <span class="token punctuation">(</span>obj <span class="token keyword">is</span> String<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> obj<span class="token punctuation">.</span>length<span class="token punctuation">&#125;</span><span class="token comment">// å–å</span><span class="token keyword">if</span> <span class="token punctuation">(</span>obj <span class="token operator">!</span><span class="token keyword">is</span> String<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token keyword">null</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="é€»è¾‘"><a class="markdownIt-Anchor" href="#é€»è¾‘"></a> é€»è¾‘</h1><h2 id="if"><a class="markdownIt-Anchor" href="#if"></a> if</h2><p>Kotlin ä¸­çš„ if è¯­å¥å­˜åœ¨è¿”å›å€¼, å€¼ä¸ºæ¡ä»¶ä¸­æœ€åä¸€è¡Œä»£ç çš„è¿”å›å€¼</p><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">fun</span> <span class="token function">JCMax2</span><span class="token punctuation">(</span>a<span class="token operator">:</span> Int<span class="token punctuation">,</span> b<span class="token operator">:</span> Int<span class="token punctuation">)</span><span class="token operator">:</span> Int <span class="token punctuation">&#123;</span>    <span class="token keyword">val</span> ret<span class="token operator">:</span> Int <span class="token operator">=</span> <span class="token keyword">if</span> <span class="token punctuation">(</span> a <span class="token operator">></span> b<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        a    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>        b    <span class="token punctuation">&#125;</span>    <span class="token keyword">return</span> ret<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="when"><a class="markdownIt-Anchor" href="#when"></a> when</h2><p>ç±»ä¼¼äº switch è¯­å¥, ä½†æ˜¯åŠŸèƒ½æ›´åŠ å¼ºå¤§:</p><ul><li>å­˜åœ¨è¿”å›å€¼, è¿”å›å€¼ä¸ºåˆ†æ”¯çš„è¿”å›å€¼</li><li>åŒ¹é…å€¼æ”¯æŒä»»æ„ç±»å‹çš„å‚æ•°</li></ul><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">fun</span> <span class="token function">getScore2</span><span class="token punctuation">(</span>name<span class="token operator">:</span> String<span class="token punctuation">)</span> <span class="token operator">=</span>        <span class="token keyword">when</span> <span class="token punctuation">(</span>name<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token string">"Tom"</span> <span class="token operator">-></span> <span class="token number">86</span>            <span class="token string">"Jim"</span> <span class="token operator">-></span> <span class="token number">77</span>            <span class="token string">"Jack"</span> <span class="token operator">-></span> <span class="token number">95</span>            <span class="token string">"Lily"</span> <span class="token operator">-></span> <span class="token number">100</span>            <span class="token keyword">else</span> <span class="token operator">-></span> <span class="token number">0</span>        <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>æ”¯æŒç±»å‹åŒ¹é…: <code>is</code> (ç±»ä¼¼ Java çš„ instanceof)</li></ul><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">fun</span> <span class="token function">checkNumber</span><span class="token punctuation">(</span>num<span class="token operator">:</span> Number<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">when</span> <span class="token punctuation">(</span>num<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">is</span> Int <span class="token operator">-></span> <span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"number is Int"</span><span class="token punctuation">)</span>        <span class="token keyword">is</span> Double <span class="token operator">-></span> <span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"number is Double"</span><span class="token punctuation">)</span>        <span class="token keyword">else</span> <span class="token operator">-></span> <span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"number not support"</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>æ”¯æŒæ— å‚æ•°çš„æ›´å¤æ‚çš„åŒ¹é…</li></ul><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">fun</span> <span class="token function">getScore3</span><span class="token punctuation">(</span>name<span class="token operator">:</span> String<span class="token punctuation">)</span> <span class="token operator">=</span>        <span class="token keyword">when</span> <span class="token punctuation">&#123;</span>            name<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">"Tom"</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token number">86</span>            name <span class="token operator">==</span> <span class="token string">"Jim"</span> <span class="token operator">-></span> <span class="token number">77</span>            name <span class="token operator">==</span> <span class="token string">"Jack"</span> <span class="token operator">-></span> <span class="token number">95</span>            name <span class="token operator">==</span> <span class="token string">"Lily"</span> <span class="token operator">-></span> <span class="token number">100</span>            <span class="token keyword">else</span> <span class="token operator">-></span> <span class="token number">0</span>        <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="for"><a class="markdownIt-Anchor" href="#for"></a> for</h2><p>ä¸»è¦ä½¿ç”¨ <code>for-in</code> å¾ªç¯:</p><ul><li><p>éå†åŒºé—´</p></li><li><p>ä½¿ç”¨ <code>step</code> è®¾ç½®éå†æ­¥é•¿</p></li><li><p>éå†åŒºé—´</p></li></ul><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">fun</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">val</span> range1 <span class="token operator">=</span> <span class="token number">0</span><span class="token operator">..</span><span class="token number">10</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span> i <span class="token keyword">in</span> range1<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token function">println</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>ä½¿ç”¨ <code>step</code> è®¾ç½®éå†æ­¥é•¿</li></ul><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">val</span> range2 <span class="token operator">=</span> <span class="token number">0</span> until <span class="token number">10</span><span class="token keyword">for</span> <span class="token punctuation">(</span> i <span class="token keyword">in</span> range2 step <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token function">println</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h2 id="while"><a class="markdownIt-Anchor" href="#while"></a> while</h2><p>ä¸ Java çš„ç”¨æ³•ä¸€è‡´</p><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">fun</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">val</span> items <span class="token operator">=</span> <span class="token function">listOf</span><span class="token punctuation">(</span><span class="token string">"apple"</span><span class="token punctuation">,</span> <span class="token string">"banana"</span><span class="token punctuation">,</span> <span class="token string">"kiwifruit"</span><span class="token punctuation">)</span>    <span class="token keyword">var</span> index <span class="token operator">=</span> <span class="token number">0</span>    <span class="token keyword">while</span> <span class="token punctuation">(</span>index <span class="token operator">&lt;</span> items<span class="token punctuation">.</span>size<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"item at <span class="token interpolation variable">$index</span> is <span class="token interpolation"><span class="token delimiter variable">$&#123;</span>items<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token delimiter variable">&#125;</span></span>"</span><span class="token punctuation">)</span>        index <span class="token operator">++</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="repeat"><a class="markdownIt-Anchor" href="#repeat"></a> repeat</h2><p>å…è®¸ä¼ å…¥ä¸€ä¸ª n å€¼, ä¼šæŠŠ Lambda è¡¨è¾¾å¼ä¸­çš„å†…å®¹æ‰§è¡Œ n é:</p><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token function">repeat</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    fruitList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token function">Fruit</span><span class="token punctuation">(</span><span class="token string">"Apple"</span><span class="token punctuation">,</span> R<span class="token punctuation">.</span>drawable<span class="token punctuation">.</span>apple_pic<span class="token punctuation">)</span><span class="token punctuation">)</span>    fruitList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token function">Fruit</span><span class="token punctuation">(</span><span class="token string">"Banana"</span><span class="token punctuation">,</span> R<span class="token punctuation">.</span>drawable<span class="token punctuation">.</span>banana_pic<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token comment">// é‡å¤åŠ è½½æ•°æ®</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="å‡½æ•°"><a class="markdownIt-Anchor" href="#å‡½æ•°"></a> å‡½æ•°</h1><ul><li>æ”¯æŒé»˜è®¤å‚æ•°</li><li>vararg è¡¨ç¤ºæ¥æ”¶ä»»æ„å¤šä¸ªå‚æ•°: <code>fun max(vararg nums: Int): Int &#123;...&#125;</code></li><li>æ³›å‹: <code>fun &lt;T: Comparable&lt;T&gt;&gt; max(vararg nums: T): T &#123;...&#125;</code> æŒ‡å®šæ³›å‹ T æ˜¯å¯æ¯”è¾ƒç±»å‹çš„å­ç±»å‹, å³å¯å¯¹æ±‚æœ€å¤§å€¼æŒ‡å®šæ³›å‹äº†</li><li></li></ul><h1 id="ç±»"><a class="markdownIt-Anchor" href="#ç±»"></a> ç±»</h1><ul><li>å®ä¾‹åŒ–æ—¶å–æ¶ˆäº† <code>new</code> å…³é”®å­—</li><li>Kotlin ä¸­ä»»ä½•ä¸€ä¸ªéæŠ½è±¡ç±»éƒ½æ˜¯ä¸å¯ä»¥è¢«ç»§æ‰¿çš„; å¦‚æœå…è®¸ç»§æ‰¿, åˆ™åœ¨ç±»ä¹‹å‰åŠ ä¸Š <code>open</code> ä¿®é¥°</li></ul><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">class</span> Person <span class="token punctuation">&#123;</span>    <span class="token keyword">var</span> name <span class="token operator">=</span> <span class="token string">""</span>    <span class="token keyword">var</span> age <span class="token operator">=</span> <span class="token number">0</span>    <span class="token keyword">fun</span> <span class="token function">eat</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token function">println</span><span class="token punctuation">(</span>name <span class="token operator">+</span> <span class="token string">" is eating. He is "</span> <span class="token operator">+</span> age <span class="token operator">+</span> <span class="token string">" years old."</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">fun</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">var</span> p <span class="token operator">=</span> <span class="token function">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    p<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">"Coming"</span>    p<span class="token punctuation">.</span>age <span class="token operator">=</span> <span class="token number">23</span>    p<span class="token punctuation">.</span><span class="token function">eat</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token function">println</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="ç»§æ‰¿"><a class="markdownIt-Anchor" href="#ç»§æ‰¿"></a> ç»§æ‰¿</h2><p>ä½¿ç”¨ <code>:</code> è¡¨ç¤ºç»§æ‰¿, ç»§æ‰¿æ—¶çˆ¶ç±»æ˜¯å¸¦æœ‰ <code>()</code> çš„</p><ul><li>ä¸ºä»€ä¹ˆè¦æœ‰ <code>()</code>: å­ç±»è¦å…ˆè°ƒç”¨çˆ¶ç±»çš„æ„é€ å‡½æ•°, ä½†æ˜¯ä¸»æ„é€ å‡½æ•°çš„å®ç°é»˜è®¤æ²¡æœ‰å‡½æ•°ä½“, å› æ­¤ä½¿ç”¨ <code>()</code> å®ç°çˆ¶ç±»æ„é€ å‡½æ•°çš„é¢„è°ƒç”¨( å½“ç„¶æœ‰å‚æ•°çš„æ„é€ å‡½æ•°ä¸­æ‹¬å·ä¸­æ˜¯è¦å¸¦å‚æ•°çš„)</li></ul><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">class</span> Student<span class="token operator">:</span> <span class="token function">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">var</span> grade <span class="token operator">=</span> <span class="token string">"1"</span>    <span class="token keyword">fun</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token function">println</span><span class="token punctuation">(</span>name <span class="token operator">+</span> <span class="token string">" æ­£åœ¨ "</span> <span class="token operator">+</span> grade <span class="token operator">+</span> <span class="token string">" ç­è€ƒè¯•..."</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="æ„é€ å‡½æ•°"><a class="markdownIt-Anchor" href="#æ„é€ å‡½æ•°"></a> æ„é€ å‡½æ•°</h2><p>ä¸»æ„é€ å‡½æ•°: æ²¡æœ‰å‡½æ•°ä½“, ç›´æ¥å®šä¹‰åœ¨ç±»åé¢; å¦‚æœæƒ³åœ¨æ„é€ å‡½æ•°ä¸­æ‰§è¡Œä¸€äº›é€»è¾‘, ä½¿ç”¨ <code>init</code> å—å®ç°</p><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">class</span> <span class="token function">Person2</span><span class="token punctuation">(</span><span class="token keyword">val</span> name<span class="token operator">:</span> String<span class="token punctuation">,</span> <span class="token keyword">var</span> age<span class="token operator">:</span> Int<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">init</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>name <span class="token operator">==</span> <span class="token string">"Coming"</span> <span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            age <span class="token operator">+=</span> <span class="token number">1</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">fun</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token function">println</span><span class="token punctuation">(</span>name <span class="token operator">+</span> <span class="token string">"is running..."</span> <span class="token operator">+</span> <span class="token string">"Age = "</span> <span class="token operator">+</span> age<span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ¬¡æ„é€ å‡½æ•°, æ‹¥æœ‰å‡½æ•°ä½“,</p><ul><li>å½“ä¸€ä¸ªç±»æ—¢æœ‰ä¸»æ„é€ å‡½æ•°åˆæœ‰æ¬¡æ„é€ å‡½æ•°æ—¶ï¼Œæ‰€æœ‰çš„æ¬¡æ„é€ å‡½æ•°éƒ½å¿…é¡»è°ƒç”¨ä¸»æ„é€ å‡½æ•°ï¼ˆåŒ…æ‹¬é—´æ¥è°ƒç”¨ï¼‰</li><li>ä»»ä½•ä¸€ä¸ªç±»åªæœ‰ä¸€ä¸ªä¸»æ„é€ å‡½æ•°, ä½†æ˜¯å¯ä»¥æœ‰å¤šä¸ªæ¬¡æ„é€ å‡½æ•°</li><li>æ¬¡æ„é€ å‡½æ•°ä¹Ÿèƒ½å¤Ÿç”¨äºå®ä¾‹åŒ–ä¸€ä¸ªç±»</li><li>æ²¡æœ‰ä¸»æ„é€ å‡½æ•°æ—¶ç»§æ‰¿æ—¶å°±ä¸å¿…ä¸ºçˆ¶ç±»åŠ æ‹¬å·äº†, è€Œæ˜¯åœ¨æ¬¡æ„é€ ä¸­çš„å‡½æ•°ä½“å†…é€šè¿‡ <code>super</code> å…³é”®å­—å®ç°</li></ul><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">open</span> <span class="token keyword">class</span> <span class="token function">Person3</span><span class="token punctuation">(</span><span class="token keyword">val</span> name<span class="token operator">:</span> String<span class="token punctuation">,</span> <span class="token keyword">val</span> age<span class="token operator">:</span> Int<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">fun</span> <span class="token function">showPersonInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"name = "</span> <span class="token operator">+</span> name <span class="token operator">+</span> <span class="token string">" age = "</span> <span class="token operator">+</span> age<span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token function">Student3</span><span class="token punctuation">(</span><span class="token keyword">val</span> grade<span class="token operator">:</span> String<span class="token punctuation">,</span> <span class="token keyword">val</span> score<span class="token operator">:</span> Int<span class="token punctuation">,</span> name<span class="token operator">:</span> String<span class="token punctuation">,</span> age<span class="token operator">:</span> Int<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token function">Person3</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> age<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">constructor</span><span class="token punctuation">(</span>name<span class="token operator">:</span> String<span class="token punctuation">,</span> age<span class="token operator">:</span> Int<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> name<span class="token punctuation">,</span> age<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>    <span class="token keyword">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span> <span class="token comment">// æ²¡æœ‰å‚æ•°æ—¶, å…ˆå®šä¹‰é»˜è®¤å€¼åè°ƒç”¨ç¬¬ä¸€ä¸ªæ¬¡æ„é€ å‡½æ•°</span>    <span class="token keyword">fun</span> <span class="token function">showStudentInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"name = "</span> <span class="token operator">+</span> name <span class="token operator">+</span> <span class="token string">" age = "</span> <span class="token operator">+</span> age <span class="token operator">+</span> <span class="token string">" grade = "</span> <span class="token operator">+</span> grade <span class="token operator">+</span> <span class="token string">" score = "</span> <span class="token operator">+</span> score<span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> Student4 <span class="token operator">:</span> Person3 <span class="token punctuation">&#123;</span>    <span class="token keyword">constructor</span><span class="token punctuation">(</span>name<span class="token operator">:</span> String<span class="token punctuation">,</span> age<span class="token operator">:</span> Int<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token keyword">super</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> age<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">fun</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">val</span> student1 <span class="token operator">=</span> <span class="token function">Student3</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">val</span> student2 <span class="token operator">=</span> <span class="token function">Student3</span><span class="token punctuation">(</span><span class="token string">"Jack"</span><span class="token punctuation">,</span> <span class="token number">19</span><span class="token punctuation">)</span>    <span class="token keyword">val</span> student3 <span class="token operator">=</span> <span class="token function">Student3</span><span class="token punctuation">(</span><span class="token string">"a123"</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token string">"Jack"</span><span class="token punctuation">,</span> <span class="token number">19</span><span class="token punctuation">)</span>    student1<span class="token punctuation">.</span><span class="token function">showStudentInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    student2<span class="token punctuation">.</span><span class="token function">showStudentInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    student3<span class="token punctuation">.</span><span class="token function">showStudentInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">val</span> student4 <span class="token operator">=</span> <span class="token function">Student4</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span>    student4<span class="token punctuation">.</span><span class="token function">showPersonInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="æ¥å£"><a class="markdownIt-Anchor" href="#æ¥å£"></a> æ¥å£</h2><p>ä»»ä½•ä¸€ä¸ªç±»åªèƒ½ç»§æ‰¿ä¸€ä¸ªçˆ¶ç±», ä½†æ˜¯å¯ä»¥å®ç°ä»»æ„å¤šä¸ªæ¥å£, å¯ä»¥åœ¨æ¥å£ä¸­å®šä¹‰ä¸€ç³»åˆ—æŠ½è±¡è¡Œä¸º, ç„¶åç”±å…·ä½“çš„ç±»å»å®ç°</p><ul><li>å®ç°æ¥å£ä¸­çš„æ–¹æ³•æ—¶éœ€è¦ä½¿ç”¨ <code>override</code> å…³é”®å­—</li><li>kotlin å…è®¸å¯¹æ¥å£ä¸­å®šä¹‰çš„å‡½æ•°è¿›è¡Œé»˜è®¤å®ç°</li></ul><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">open</span> <span class="token keyword">class</span> <span class="token function">Person5</span><span class="token punctuation">(</span><span class="token keyword">val</span> name<span class="token operator">:</span> String<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">(</span><span class="token string">"UNKNOWN"</span><span class="token punctuation">)</span>    <span class="token keyword">fun</span> <span class="token function">showPersonInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Person name = "</span> <span class="token operator">+</span> name<span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">interface</span> Study <span class="token punctuation">&#123;</span>    <span class="token keyword">fun</span> <span class="token function">readBooks</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">fun</span> <span class="token function">doHomework</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Default implement"</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token function">Student5</span><span class="token punctuation">(</span>name<span class="token operator">:</span> String<span class="token punctuation">,</span> <span class="token keyword">val</span> age<span class="token operator">:</span> Int<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token function">Person5</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">,</span> Study <span class="token punctuation">&#123;</span>    <span class="token keyword">constructor</span><span class="token punctuation">(</span>age<span class="token operator">:</span> Int<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">(</span><span class="token string">"UNKNOWN"</span><span class="token punctuation">,</span> age<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token punctuation">&#125;</span>    <span class="token keyword">constructor</span><span class="token punctuation">(</span>name<span class="token operator">:</span> String<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token punctuation">&#125;</span>    <span class="token keyword">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">readBooks</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token function">println</span><span class="token punctuation">(</span>name <span class="token operator">+</span> <span class="token string">"(age = "</span> <span class="token operator">+</span> age <span class="token operator">+</span> <span class="token string">") is reading"</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">doHomework</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token function">println</span><span class="token punctuation">(</span>name <span class="token operator">+</span> <span class="token string">"(age = "</span> <span class="token operator">+</span> age <span class="token operator">+</span> <span class="token string">") is homeworking"</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">fun</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">val</span> s1 <span class="token operator">=</span> <span class="token function">Student5</span><span class="token punctuation">(</span><span class="token string">"Coming"</span><span class="token punctuation">,</span> <span class="token number">23</span><span class="token punctuation">)</span>    <span class="token keyword">val</span> s2 <span class="token operator">=</span> <span class="token function">Student5</span><span class="token punctuation">(</span><span class="token string">"CJC"</span><span class="token punctuation">)</span>    <span class="token keyword">val</span> s3 <span class="token operator">=</span> <span class="token function">Student5</span><span class="token punctuation">(</span><span class="token number">24</span><span class="token punctuation">)</span>    <span class="token keyword">val</span> s4 <span class="token operator">=</span> <span class="token function">Student5</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token function">println</span><span class="token punctuation">(</span>s1<span class="token punctuation">.</span><span class="token function">readBooks</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token function">println</span><span class="token punctuation">(</span>s2<span class="token punctuation">.</span><span class="token function">readBooks</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token function">println</span><span class="token punctuation">(</span>s3<span class="token punctuation">.</span><span class="token function">doHomework</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token function">println</span><span class="token punctuation">(</span>s4<span class="token punctuation">.</span><span class="token function">doHomework</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="å¯è§æ€§ä¿®é¥°ç¬¦"><a class="markdownIt-Anchor" href="#å¯è§æ€§ä¿®é¥°ç¬¦"></a> å¯è§æ€§ä¿®é¥°ç¬¦</h2><ul><li>private: ç±»å†…å¯è§</li><li>public: æ‰€æœ‰ç±»å¯è§, é»˜è®¤ä¿®é¥°ç¬¦</li><li>protected: å½“å‰ç±»å’Œå­ç±»å¯è§</li><li>internal: å¯¹åŒä¸€æ¨¡å—ä¸­çš„ç±»å¯è§, æ¯”å¦‚æˆ‘ä»¬å¼€å‘äº†ä¸€ä¸ªæ¨¡å—ç»™åˆ«äººä½¿ç”¨ï¼Œä½†æ˜¯æœ‰ä¸€äº›å‡½æ•°åªå…è®¸åœ¨æ¨¡å—å†…éƒ¨è°ƒç”¨ï¼Œä¸æƒ³æš´éœ²ç»™å¤–éƒ¨ï¼Œå°±å¯ä»¥å°†è¿™äº›å‡½æ•°å£°æ˜æˆ internal</li></ul><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/202207141024518.png" alt="" /></p><h2 id="æ•°æ®ç±»"><a class="markdownIt-Anchor" href="#æ•°æ®ç±»"></a> æ•°æ®ç±»</h2><p>æ•°æ®ç±»ç”¨äºå°†æœåŠ¡å™¨ç«¯æˆ–æ•°æ®åº“ä¸­çš„æ•°æ®æ˜ å°„åˆ°å†…å­˜ä¸­ï¼Œä¸ºç¼–ç¨‹é€»è¾‘æä¾›æ•°æ®æ¨¡å‹çš„æ”¯æŒ, Kotlin ä¸­ä½¿ç”¨ <code>data</code> å…³é”®å­—è¿›è¡Œä¿®é¥°</p><ul><li>MVCã€MVPã€MVVM ä¹‹ç±»çš„æ¶æ„æ¨¡å¼ä¸­çš„ M æŒ‡çš„å°±æ˜¯æ•°æ®ç±»</li><li>æ•°æ®ç±»é€šå¸¸éœ€è¦é‡å†™ <code>equals()ã€hashCode()ã€toString()</code> ç­‰æ–¹æ³•<ul><li><code>equals()</code>: åˆ¤æ–­ä¸¤ä¸ªæ•°æ®ç±»æ˜¯å¦ç›¸ç­‰</li><li><code>hashCode()</code>: <code>equals()</code> çš„é…å¥—æ–¹æ³•</li><li><code>toString()</code>: ç”¨äºæä¾›æ›´æ¸…æ™°çš„è¾“å…¥æ—¥å¿—ï¼ˆå¦åˆ™ä¸€ä¸ªæ•°æ®ç±»é»˜è®¤æ‰“å°å‡ºæ¥çš„å°±æ˜¯ä¸€è¡Œå†…å­˜åœ°å€ï¼‰</li></ul></li></ul><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token comment">// å®ç° Cellphone æ•°æ®ç±»ååˆ†ç®€å•</span><span class="token comment">// å½“ä¸€ä¸ªç±»ä¸­æ²¡æœ‰ä»»ä½•ä»£ç æ—¶, å¯ä»¥å°†å°¾éƒ¨çš„å¤§æ‹¬å·çœç•¥</span><span class="token keyword">data</span> <span class="token keyword">class</span> <span class="token function">Cellphone</span><span class="token punctuation">(</span><span class="token keyword">val</span> brand<span class="token operator">:</span> String<span class="token punctuation">,</span> <span class="token keyword">val</span> price<span class="token operator">:</span> Double<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h2 id="å•ä¾‹ç±»"><a class="markdownIt-Anchor" href="#å•ä¾‹ç±»"></a> å•ä¾‹ç±»</h2><p>å•ä¾‹æ¨¡å¼: æœ€å¸¸ç”¨ã€æœ€åŸºç¡€çš„è®¾è®¡æ¨¡å¼ä¹‹ä¸€ï¼Œç”¨äºé¿å…åˆ›å»ºé‡å¤çš„å¯¹è±¡</p><p>Java ä¸­çš„å•ä¾‹æ€æƒ³:</p><ul><li>é¦–å…ˆä¸ºäº†ç¦æ­¢å¤–éƒ¨åˆ›å»º Singleton çš„å®ä¾‹ï¼Œéœ€è¦ç”¨ private å…³é”®å­—å°† Singleton çš„æ„é€ å‡½æ•°ç§æœ‰åŒ–</li><li>ç„¶åç»™å¤–éƒ¨æä¾›äº†ä¸€ä¸ª getInstance() é™æ€æ–¹æ³•ç”¨äºè·å– Singleton çš„å®ä¾‹</li><li>åœ¨ getInstance() æ–¹æ³•ä¸­ï¼Œå¦‚æœå½“å‰ç¼“å­˜çš„ Singleton å®ä¾‹ä¸º nullï¼Œå°±åˆ›å»ºä¸€ä¸ªæ–°çš„å®ä¾‹</li><li>å¦åˆ™ç›´æ¥è¿”å›ç¼“å­˜çš„å®ä¾‹å³å¯</li></ul><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Singleton</span><span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">Singleton</span> instance<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">Singleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">static</span> <span class="token class-name">Singleton</span> <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>instance <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>        <span class="token punctuation">&#123;</span>            instance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Singleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">return</span> instance<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">singletonTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"singletonTest is called."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token class-name">Singleton</span> singleton <span class="token operator">=</span> <span class="token class-name">Singleton</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>singleton<span class="token punctuation">.</span><span class="token function">singletonTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>Kotlin ä¸­çš„å•ä¾‹ç±»ä¾æ—§éšè—äº†å›ºå®šçš„é‡å¤çš„é€»è¾‘, å°† <code>class</code> æ”¹ä¸º <code>object</code> å³å¯åˆ›å»ºå•ä¾‹ç±»</p><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">object</span> Singoton <span class="token punctuation">&#123;</span>    <span class="token keyword">val</span> name<span class="token operator">:</span> String <span class="token operator">=</span> <span class="token string">"Coming"</span>    <span class="token keyword">fun</span> <span class="token function">SingotonTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"called"</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">fun</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    Singoton<span class="token punctuation">.</span><span class="token function">SingotonTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// Kotlin ä¼šå…ˆåˆ›å»º Singoton çš„å®ä¾‹ç„¶ååœ¨è°ƒç”¨(å¹¶ä¸”ä¿è¯å…¨å±€åªæœ‰ä¸€ä¸ªå®ä¾‹)</span>    <span class="token function">println</span><span class="token punctuation">(</span>Singoton<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="æ³›å‹ç±»"><a class="markdownIt-Anchor" href="#æ³›å‹ç±»"></a> æ³›å‹ç±»</h2><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">class</span> MyClass<span class="token operator">&lt;</span>T<span class="token operator">></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">fun</span> <span class="token function">func</span><span class="token punctuation">(</span>param<span class="token operator">:</span> T<span class="token punctuation">)</span><span class="token operator">:</span> T <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> param    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="æ³›å‹å‡½æ•°"><a class="markdownIt-Anchor" href="#æ³›å‹å‡½æ•°"></a> æ³›å‹å‡½æ•°</h2><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">fun</span> <span class="token operator">&lt;</span>T<span class="token operator">></span> <span class="token function">method</span><span class="token punctuation">(</span>param<span class="token operator">:</span> T<span class="token punctuation">)</span><span class="token operator">:</span> T <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> param<span class="token punctuation">&#125;</span>method<span class="token operator">&lt;</span>Int<span class="token operator">></span><span class="token punctuation">(</span><span class="token number">123</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h1 id="lambda-ç¼–ç¨‹"><a class="markdownIt-Anchor" href="#lambda-ç¼–ç¨‹"></a> Lambda ç¼–ç¨‹</h1><p>Lambda å°±æ˜¯ä¸€å°æ®µå¯ä»¥ä½œä¸ºå‚æ•°ä¼ é€’çš„ä»£ç </p><p>è¯­æ³•ç»“æ„: <code>&#123;å‚æ•°å1: å‚æ•°ç±»å‹, å‚æ•°å2: å‚æ•°ç±»å‹ -&gt; å‡½æ•°ä½“&#125;</code></p><h2 id="é›†åˆ"><a class="markdownIt-Anchor" href="#é›†åˆ"></a> é›†åˆ</h2><ul><li><code>listOf()</code>: åˆå§‹åŒ–ä¸å¯å˜é›†åˆ, åªèƒ½è¯»å–, ä¸èƒ½æ·»åŠ ä¿®æ”¹æˆ–åˆ é™¤</li><li><code>mutableListOf()</code>: åˆå§‹åŒ–å¯å˜é›†åˆ</li><li>åŒç† <code>setOf()</code> äº <code>mutableSetOf()</code> åªæ˜¯ set ä¸­ä¸å¯ä»¥å­˜æ”¾é‡å¤çš„å…ƒç´ , å¯¹äºé‡å¤çš„å…ƒç´ åªä¼šä¿ç•™ä¸€ä»½</li><li>æ–¹æ³•: <code>.filter</code>, <code>map</code>, <code>maxBy</code>, <code>any</code>, <code>all</code></li></ul><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">fun</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">val</span> fruitList <span class="token operator">=</span> <span class="token function">listOf</span><span class="token punctuation">(</span><span class="token string">"Apple"</span><span class="token punctuation">,</span> <span class="token string">"Banana"</span><span class="token punctuation">,</span> <span class="token string">"Orange"</span><span class="token punctuation">,</span> <span class="token string">"Pear"</span><span class="token punctuation">,</span> <span class="token string">"Grape"</span><span class="token punctuation">)</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span>fruit <span class="token keyword">in</span> fruitList<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token function">println</span><span class="token punctuation">(</span>fruit<span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">val</span> friendList <span class="token operator">=</span> <span class="token function">mutableListOf</span><span class="token punctuation">(</span><span class="token string">"Coming"</span><span class="token punctuation">,</span> <span class="token string">"ZH"</span><span class="token punctuation">,</span> <span class="token string">"ZCY"</span><span class="token punctuation">)</span>    friendList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"GTY"</span><span class="token punctuation">)</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span>friend <span class="token keyword">in</span> friendList<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token function">println</span><span class="token punctuation">(</span>friend<span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="éå†ç´¢å¼•å€¼"><a class="markdownIt-Anchor" href="#éå†ç´¢å¼•å€¼"></a> éå†ç´¢å¼•å€¼</h3><p>é€šè¿‡é›†åˆçš„å±æ€§ <code>indices</code></p><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">val</span> items <span class="token operator">=</span> <span class="token function">listOf</span><span class="token punctuation">(</span><span class="token string">"apple"</span><span class="token punctuation">,</span> <span class="token string">"banana"</span><span class="token punctuation">,</span> <span class="token string">"kiwifruit"</span><span class="token punctuation">)</span><span class="token keyword">for</span> <span class="token punctuation">(</span>index <span class="token keyword">in</span> items<span class="token punctuation">.</span>indices<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"item at <span class="token interpolation variable">$index</span> is <span class="token interpolation"><span class="token delimiter variable">$&#123;</span>items<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token delimiter variable">&#125;</span></span>"</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h2 id="map"><a class="markdownIt-Anchor" href="#map"></a> Map</h2><ul><li>æ”¯æŒ Java ä¸­çš„ put ä¸ get, ä½†æ˜¯ä¸æ¨è</li><li>æ¨èä½¿ç”¨ç±»ä¼¼äºæ•°ç»„ä¸‹æ ‡çš„è¯­æ³•ç»“æ„å»èµ‹å€¼ä¸è·å–</li><li>ä¹Ÿæ”¯æŒ <code>mapOf()</code> ä¸ <code>mutableMapOf()</code></li></ul><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">fun</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">val</span> map1 <span class="token operator">=</span> HashMap<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> Int<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span>    map1<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"Coming"</span><span class="token punctuation">,</span> <span class="token number">23</span><span class="token punctuation">)</span>    <span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Coming's age = "</span> <span class="token operator">+</span> map1<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"Coming"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">val</span> map2 <span class="token operator">=</span> HashMap<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> Int<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span>    map2<span class="token punctuation">[</span><span class="token string">"Coming"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">23</span>    <span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Coming's age = "</span> <span class="token operator">+</span> map2<span class="token punctuation">[</span><span class="token string">"Coming"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token keyword">val</span> fruitMap <span class="token operator">=</span> <span class="token function">mapOf</span><span class="token punctuation">(</span><span class="token string">"Apple"</span> <span class="token keyword">to</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"Banana"</span> <span class="token keyword">to</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">"Orange"</span> <span class="token keyword">to</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">"Pear"</span> <span class="token keyword">to</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token string">"Grape"</span> <span class="token keyword">to</span> <span class="token number">5</span><span class="token punctuation">)</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>fruit<span class="token punctuation">,</span> id<span class="token punctuation">)</span> <span class="token keyword">in</span> fruitMap<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token function">println</span><span class="token punctuation">(</span>fruit <span class="token operator">+</span> <span class="token string">" : "</span> <span class="token operator">+</span> id<span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="java-å‡½æ•°å¼-api-çš„ä½¿ç”¨"><a class="markdownIt-Anchor" href="#java-å‡½æ•°å¼-api-çš„ä½¿ç”¨"></a> Java å‡½æ•°å¼ API çš„ä½¿ç”¨</h2><p>Kotlin ä¸­è°ƒç”¨ Java æ–¹æ³•æ—¶ä¹Ÿå¯ä»¥ä½¿ç”¨å‡½æ•°å¼ API, å¦‚æœæˆ‘ä»¬åœ¨ Kotlin ä»£ç ä¸­è°ƒç”¨äº†ä¸€ä¸ª Java æ–¹æ³•ï¼Œå¹¶ä¸”è¯¥æ–¹æ³•<strong>æ¥æ”¶ä¸€ä¸ª Java å•æŠ½è±¡æ–¹æ³•æ¥å£å‚æ•°</strong>ï¼Œå°±å¯ä»¥ä½¿ç”¨å‡½æ•°å¼API</p><ul><li>æ¥å£ä¸­åªæœ‰ä¸€ä¸ªå¾…å®ç°æ–¹æ³•</li><li>Java å‡½æ•°å¼ API çš„ä½¿ç”¨éƒ½é™å®šäºä» Kotlin ä¸­è°ƒç”¨ Java æ–¹æ³•ï¼Œå¹¶ä¸”å•æŠ½è±¡æ–¹æ³•æ¥å£ä¹Ÿå¿…é¡»æ˜¯ç”¨ Java è¯­è¨€å®šä¹‰çš„</li></ul><p>åœ¨ Java ä¸­ä½¿ç”¨å‡½æ•°å¼ API: åŒ¿åç±», åˆ›å»ºäº†ä¸€ä¸ª Runnable æ¥å£çš„åŒ¿åç±»å®ä¾‹ï¼Œå¹¶å°†å®ƒä¼ ç»™äº† Thread ç±»çš„æ„é€ æ–¹æ³•</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Runnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Thread is running"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä½¿ç”¨ Kotlin ç›´è§‚çš„æ”¹å†™: object å…³é”®å­—æ˜¯ç”¨äºå®šä¹‰å•ä¾‹ç±», åœ¨è¿™é‡Œä¹Ÿç›´æ¥ç”¨äºåˆ›å»ºäº†åŒ¿åç±»çš„å®ä¾‹(å› ä¸ºå•ä¾‹ç±»åªæœ‰ä¸€ä¸ªå®ä¾‹, æ‰€ä»¥ç±»åç›´æ¥å¼•ç”¨æ˜¯å’§)</p><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">fun</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token function">Thread</span><span class="token punctuation">(</span><span class="token keyword">object</span> <span class="token operator">:</span> Runnable <span class="token punctuation">&#123;</span>        <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"RUNNING"</span><span class="token punctuation">)</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>ç®€åŒ–å®ç°ä»£ç :å› ä¸ºåªæœ‰ä¸€ä¸ªå¾…å®ç°çš„æ–¹æ³•, æ‰€ä»¥æ²¡å¿…è¦æ˜¾ç¤ºçš„é‡å†™ <code>run</code> æ–¹æ³•</li></ul><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token function">Thread</span><span class="token punctuation">(</span>Runnable <span class="token punctuation">&#123;</span>    <span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"RUNING2"</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><ul><li>ç»§ç»­ç®€åŒ–å®ç°ä»£ç : å¦‚æœä¸€ä¸ª Java æ–¹æ³•çš„å‚æ•°åˆ—è¡¨ä¸­æœ‰ä¸”ä»…æœ‰ä¸€ä¸ª Java å•æŠ½è±¡æ–¹æ³•æ¥å£å‚æ•°ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥å°†æ¥å£åè¿›è¡Œçœç•¥</li></ul><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token function">Thread</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>    <span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"RUNING3"</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><ul><li>æœ€ç»ˆç®€åŒ–: å½“ Lambda è¡¨è¾¾å¼æ˜¯æ–¹æ³•çš„æœ€åä¸€ä¸ªå‚æ•°æ—¶ï¼Œå¯ä»¥å°† Lambda è¡¨è¾¾å¼ç§»åˆ°æ–¹æ³•æ‹¬å·çš„å¤–é¢</li><li>åŒæ—¶ï¼Œå¦‚æœ Lambda è¡¨è¾¾å¼è¿˜æ˜¯æ–¹æ³•çš„å”¯ä¸€ä¸€ä¸ªå‚æ•°ï¼Œè¿˜å¯ä»¥å°†æ–¹æ³•çš„æ‹¬å·çœç•¥</li></ul><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin">Thread <span class="token punctuation">&#123;</span> <span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"RUNNING4"</span><span class="token punctuation">)</span> <span class="token punctuation">&#125;</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h1 id="ç©ºæŒ‡é’ˆæ£€æŸ¥"><a class="markdownIt-Anchor" href="#ç©ºæŒ‡é’ˆæ£€æŸ¥"></a> ç©ºæŒ‡é’ˆæ£€æŸ¥</h1><p>Kotlin é»˜è®¤æ‰€æœ‰çš„å‚æ•°å’Œå˜é‡éƒ½ä¸å¯ä¸ºç©º, ä½†å¯ä»¥åœ¨ç±»å‹ååé¢åŠ ä¸Š <code>?</code> æ¥å®šä¹‰å¯ç©ºç±»å‹ç³»ç»Ÿï¼š</p><ul><li><code>Int</code> è¡¨ç¤ºä¸å¯ä¸ºç©ºçš„æ•´å‹, <code>Int?</code> è¡¨ç¤ºå¯ä¸ºç©ºçš„æ•´å‹</li></ul><p>ä½†ä½¿ç”¨å¯ç©ºç±»å‹ç³»ç»Ÿæ—¶å°±éœ€è¦å¯¹å‚æ•°è¿›è¡Œåˆ¤ç©ºå¤„ç†, å¸¸ç”¨çš„ç¬¦å·æœ‰ <code>?.</code> <code>!!.</code> <code>?:</code></p><ul><li><code>a?.doSomething()</code>: a ä¸º null æ—¶ä¸å†æ‰§è¡Œ, ç›´æ¥è¿”å› null, a ä¸ä¸º null æ—¶æ­£å¸¸æ‰§è¡Œ</li><li><code>a ?: b</code>: å·¦å³ä¸¤è¾¹éƒ½æ¥æ”¶ä¸€ä¸ªè¡¨è¾¾å¼ï¼Œå¦‚æœå·¦è¾¹è¡¨è¾¾å¼çš„ç»“æœä¸ä¸ºç©ºå°±è¿”å›å·¦è¾¹è¡¨è¾¾å¼çš„ç»“æœï¼Œå¦åˆ™å°±è¿”å›å³è¾¹è¡¨è¾¾å¼çš„ç»“æœ</li><li><code>!!.</code>: å‡½æ•°å†…éƒ¨è¿›è¡Œäº†éç©ºåˆ¤æ–­, ä½†æ˜¯å‡½æ•°è¿”å›å Kotlin ä¸èƒ½çŸ¥é“å·²ç»åšäº†éç©ºåˆ¤æ–­, å› æ­¤ä½¿ç”¨ <code>!!.</code> è¿›è¡Œéç©ºæ–­è¨€, è¡¨æ˜è¿™ä¸ªå¯¹è±¡ç»å¯¹ä¸ä¸ºç©º</li></ul><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">fun</span> <span class="token function">getTextLength</span><span class="token punctuation">(</span>text<span class="token operator">:</span> String<span class="token operator">?</span><span class="token punctuation">)</span><span class="token operator">:</span> Int <span class="token punctuation">&#123;</span>    <span class="token function">println</span><span class="token punctuation">(</span>text<span class="token operator">?</span><span class="token punctuation">.</span>length<span class="token punctuation">)</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>text <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> text<span class="token punctuation">.</span>length    <span class="token punctuation">&#125;</span>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">&#125;</span><span class="token comment">// text ä¸ä¸º null åˆ™ text.length è¿”å›å€¼ä¸ä¸ºç©º, ?: æ“ä½œç¬¦è¿”å›å·¦è¾¹çš„ç»“æœ</span><span class="token comment">// text ä¸º null åˆ™ text.length è¿”å›å€¼ä¸ºç©º, ?: æ“ä½œç¬¦è¿”å›å³è¾¹çš„ç»“æœ</span><span class="token keyword">fun</span> <span class="token function">JCGetTextLength</span><span class="token punctuation">(</span>text<span class="token operator">:</span> String<span class="token operator">?</span><span class="token punctuation">)</span> <span class="token operator">=</span> text<span class="token operator">?</span><span class="token punctuation">.</span>length <span class="token operator">?:</span> <span class="token number">0</span><span class="token keyword">fun</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token function">getTextLength</span><span class="token punctuation">(</span><span class="token string">"WWW"</span><span class="token punctuation">)</span> <span class="token comment">// text?.length = 3</span>    <span class="token function">getTextLength</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token comment">// text?.length = null</span>    <span class="token function">println</span><span class="token punctuation">(</span><span class="token function">JCGetTextLength</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token function">println</span><span class="token punctuation">(</span><span class="token function">JCGetTextLength</span><span class="token punctuation">(</span><span class="token string">"Hello World"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="let-å‡½æ•°"><a class="markdownIt-Anchor" href="#let-å‡½æ•°"></a> let å‡½æ•°</h2><p>è¿™ä¸ªå‡½æ•°æä¾›äº†å‡½æ•°å¼ API çš„ç¼–ç¨‹æ¥å£ï¼Œå¹¶å°†åŸå§‹è°ƒç”¨å¯¹è±¡ä½œä¸ºå‚æ•°ä¼ é€’åˆ° Lambda è¡¨è¾¾å¼ä¸­, é…åˆè¿›è¡Œéç©ºåˆ¤æ–­ååˆ†æ–¹ä¾¿:</p><ul><li><code>obj.let &#123; obj_ -&gt; ... &#125;</code>: <code>obj_</code> ä¸ <code>obj</code> æ˜¯ç›¸åŒçš„å¯¹è±¡, åªä¸è¿‡ä¸ºäº†ä¸é‡å</li><li>å¦‚ä¸‹ä¾‹, å¦‚æœ study ä¸º null åˆ™ä¸ä¼šæ‰§è¡Œ let å‡½æ•°; å¦‚æœ study ä¸ä¸º null åˆ™æ‰§è¡Œ let å‡½æ•°å¹¶å®ç°äº†éç©ºåˆ¤æ–­</li><li>ä¸ <code>if</code> ä¸åŒçš„æ˜¯, let å‡½æ•°æ˜¯å¯ä»¥å¤„ç†å…¨å±€å˜é‡çš„åˆ¤ç©ºé—®é¢˜çš„: if ä¸­å¦‚æœå­˜åœ¨å…¨å±€å˜é‡, å…¶å€¼éšæ—¶éƒ½æœ‰å¯èƒ½è¢«å…¶ä»–çº¿ç¨‹æ‰€ä¿®æ”¹ï¼Œå³ä½¿åšäº†åˆ¤ç©ºå¤„ç†ï¼Œä»ç„¶æ— æ³•ä¿è¯ if è¯­å¥ä¸­çš„ study å˜é‡æ²¡æœ‰ç©ºæŒ‡é’ˆé£é™©</li></ul><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">fun</span> <span class="token function">doStudy</span><span class="token punctuation">(</span>study<span class="token operator">:</span> Study<span class="token operator">?</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    study<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">let</span> <span class="token punctuation">&#123;</span> stu <span class="token operator">-></span>        stu<span class="token punctuation">.</span><span class="token function">readBooks</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        stu<span class="token punctuation">.</span><span class="token function">doHomework</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token comment">// lambda åªæœ‰ä¸€ä¸ªå‚æ•°æ—¶å¯ä»¥ç®€åŒ–æ”¹å‚æ•°ä¸º it</span><span class="token keyword">fun</span> <span class="token function">doStudy</span><span class="token punctuation">(</span>study<span class="token operator">:</span> Study<span class="token operator">?</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    study<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">let</span> <span class="token punctuation">&#123;</span>        it<span class="token punctuation">.</span><span class="token function">readBooks</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        it<span class="token punctuation">.</span><span class="token function">doHomework</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="å¸¸ç”¨å·¥å…·ç±»"><a class="markdownIt-Anchor" href="#å¸¸ç”¨å·¥å…·ç±»"></a> å¸¸ç”¨å·¥å…·ç±»</h1><h2 id="localdatetime"><a class="markdownIt-Anchor" href="#localdatetime"></a> LocalDateTime</h2><h3 id="æ ¼å¼åŒ–è¾“å‡º"><a class="markdownIt-Anchor" href="#æ ¼å¼åŒ–è¾“å‡º"></a> æ ¼å¼åŒ–è¾“å‡º</h3><ul><li>æ—¥æœŸæ—¶é—´æ ¼å¼</li></ul><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token comment">/** * è¾“å‡ºæ—¥æœŸæ—¶é—´æ ¼å¼ *      dateSplit = "-", timeSplit = ":", minTime = "min": 2022-10-31 16:52 *      dateSplit = "chinese", timeSplit = "chinese", minTime = "min": 2022å¹´10æœˆ31æ—¥ 16æ—¶52åˆ† */</span><span class="token keyword">fun</span> LocalDateTime<span class="token punctuation">.</span><span class="token function">dateTimeFormatter</span><span class="token punctuation">(</span>dateSplit<span class="token operator">:</span> String <span class="token operator">=</span> <span class="token string">"-"</span><span class="token punctuation">,</span> timeSplit<span class="token operator">:</span> String <span class="token operator">=</span> <span class="token string">":"</span><span class="token punctuation">,</span> minTime<span class="token operator">:</span> String <span class="token operator">=</span> <span class="token string">"min"</span><span class="token punctuation">)</span><span class="token operator">:</span> String <span class="token punctuation">&#123;</span>    <span class="token keyword">val</span> datePattern<span class="token operator">:</span> String <span class="token operator">=</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>dateSplit <span class="token operator">==</span> <span class="token string">"chinese"</span><span class="token punctuation">)</span> <span class="token string">"yyyyå¹´MMæœˆddæ—¥"</span> <span class="token keyword">else</span> <span class="token string">"yyyy<span class="token interpolation"><span class="token delimiter variable">$&#123;</span>dateSplit<span class="token delimiter variable">&#125;</span></span>MM<span class="token interpolation"><span class="token delimiter variable">$&#123;</span>dateSplit<span class="token delimiter variable">&#125;</span></span>dd"</span>    <span class="token keyword">val</span> timePattern<span class="token operator">:</span> String <span class="token operator">=</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>timeSplit <span class="token operator">==</span> <span class="token string">"chinese"</span><span class="token punctuation">)</span> <span class="token string">"HHæ—¶mmåˆ†ssç§’"</span> <span class="token keyword">else</span> <span class="token string">"HH<span class="token interpolation"><span class="token delimiter variable">$&#123;</span>timeSplit<span class="token delimiter variable">&#125;</span></span>mm<span class="token interpolation"><span class="token delimiter variable">$&#123;</span>timeSplit<span class="token delimiter variable">&#125;</span></span>ss"</span>    <span class="token keyword">val</span> datetimeFormatter<span class="token operator">:</span> DateTimeFormatter <span class="token operator">=</span> DateTimeFormatter<span class="token punctuation">.</span><span class="token function">ofPattern</span><span class="token punctuation">(</span>datePattern <span class="token operator">+</span> <span class="token string">" "</span> <span class="token operator">+</span> timePattern<span class="token punctuation">)</span>    <span class="token keyword">var</span> cutIndex<span class="token operator">:</span> Int <span class="token operator">=</span> <span class="token number">0</span>    <span class="token keyword">when</span> <span class="token punctuation">(</span>minTime<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token string">"hour"</span> <span class="token operator">-></span> cutIndex <span class="token operator">=</span> <span class="token number">6</span>        <span class="token string">"min"</span> <span class="token operator">-></span> cutIndex <span class="token operator">=</span> <span class="token number">3</span>        <span class="token keyword">else</span> <span class="token operator">-></span> cutIndex <span class="token operator">=</span> <span class="token number">0</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">val</span> dateTimeString <span class="token operator">=</span> datetimeFormatter<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> dateTimeString<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> dateTimeString<span class="token punctuation">.</span>length <span class="token operator">-</span> cutIndex<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/202210312029662.png" alt="" /></p><ul><li>æ—¥æœŸæ ¼å¼</li></ul><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">fun</span> LocalDateTime<span class="token punctuation">.</span><span class="token function">dateFormatter</span><span class="token punctuation">(</span>dateSplit<span class="token operator">:</span> String <span class="token operator">=</span> <span class="token string">"-"</span><span class="token punctuation">)</span><span class="token operator">:</span> String <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">dateTimeFormatter</span><span class="token punctuation">(</span>dateSplit <span class="token operator">=</span> dateSplit<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">first</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><ul><li>æ—¶é—´æ ¼å¼</li></ul><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">fun</span> LocalDateTime<span class="token punctuation">.</span><span class="token function">timeFormatter</span><span class="token punctuation">(</span>timeSplit<span class="token operator">:</span> String <span class="token operator">=</span> <span class="token string">":"</span><span class="token punctuation">,</span> minTime<span class="token operator">:</span> String <span class="token operator">=</span> <span class="token string">"min"</span><span class="token punctuation">)</span><span class="token operator">:</span> String <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">dateTimeFormatter</span><span class="token punctuation">(</span>timeSplit <span class="token operator">=</span> timeSplit<span class="token punctuation">,</span> minTime <span class="token operator">=</span> minTime<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">last</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/202210312042687.png" alt="" /></p><h3 id="ç±»å‹è½¬æ¢"><a class="markdownIt-Anchor" href="#ç±»å‹è½¬æ¢"></a> ç±»å‹è½¬æ¢</h3><ul><li>LocalDateTime 2 Long</li></ul><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">fun</span> LocalDateTime<span class="token punctuation">.</span><span class="token function">toLong</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> Long <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">toInstant</span><span class="token punctuation">(</span>ZoneOffset<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token string">"+8"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toEpochMilli</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><ul><li>Long 2 LocalDateTime: æŸå¤±äº†æ¯«ç§’çš„ç²¾åº¦</li></ul><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">fun</span> Long<span class="token punctuation">.</span><span class="token function">toLocalDateTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> LocalDateTime <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> LocalDateTime<span class="token punctuation">.</span><span class="token function">ofEpochSecond</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token operator">/</span><span class="token number">1000</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> ZoneOffset<span class="token punctuation">.</span><span class="token function">ofHours</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/202210312114079.png" alt="" /></p><h3 id="è®¡ç®—è·ç¦»"><a class="markdownIt-Anchor" href="#è®¡ç®—è·ç¦»"></a> è®¡ç®—è·ç¦»</h3><ul><li>ä¸¤ä¸ª LocalDateTime ä¹‹é—´çš„ç§’çº§è·ç¦»</li></ul><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">fun</span> LocalDateTime<span class="token punctuation">.</span><span class="token function">distence</span><span class="token punctuation">(</span>targetLocalDateTime<span class="token operator">:</span> LocalDateTime<span class="token punctuation">)</span><span class="token operator">:</span> Long <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token function">abs</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">toLong</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> targetLocalDateTime<span class="token punctuation">.</span><span class="token function">toLong</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">1000</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/202210312116316.png" alt="" /></p><h2 id="float"><a class="markdownIt-Anchor" href="#float"></a> Float</h2><h3 id="æ ¼å¼åŒ–è¾“å‡º-2"><a class="markdownIt-Anchor" href="#æ ¼å¼åŒ–è¾“å‡º-2"></a> æ ¼å¼åŒ–è¾“å‡º</h3><p>ä¿ç•™å°æ•°ç‚¹å n ä½çš„åŒæ—¶, å¦‚æœå°æ•°ç‚¹å n ä½ä¸º 0 åˆ™è½¬ä¸ºæ•´æ•°</p><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">fun</span> Float<span class="token punctuation">.</span><span class="token function">toTypedString</span><span class="token punctuation">(</span>keepLength<span class="token operator">:</span> Int<span class="token punctuation">)</span><span class="token operator">:</span> String <span class="token punctuation">&#123;</span>    <span class="token keyword">val</span> checkValue <span class="token operator">=</span> <span class="token number">10.0</span><span class="token punctuation">.</span><span class="token function">pow</span><span class="token punctuation">(</span>keepLength<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token comment">// å keepLength ä½ä¸º 0 è½¬ä¸ºæ•´æ•°</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">this</span> <span class="token operator">*</span> checkValue<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">%</span> checkValue <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">toInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> String<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"%.<span class="token interpolation"><span class="token delimiter variable">$&#123;</span>keepLength<span class="token delimiter variable">&#125;</span></span>f"</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> Android Dev. </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Android </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>01-Android Basic</title>
      <link href="/Coming-blog/2022/07/14/01-android-basic/"/>
      <url>/Coming-blog/2022/07/14/01-android-basic/</url>
      
        <content type="html"><![CDATA[<h1 id="android-ç³»ç»Ÿæ¶æ„"><a class="markdownIt-Anchor" href="#android-ç³»ç»Ÿæ¶æ„"></a> Android ç³»ç»Ÿæ¶æ„</h1><p>å››å±‚æ¶æ„ï¼š</p><ul><li>Linux å†…æ ¸å±‚ï¼šä¸º Android è®¾å¤‡çš„å„ç§ç¡¬ä»¶æä¾›äº†åº•å±‚çš„é©±åŠ¨ï¼Œå¦‚é©±åŠ¨ã€ç”µæºç®¡ç†ç­‰</li><li>ç¡¬ä»¶æŠ½è±¡å±‚: Hardware Abstraction Layer, HAL, æä¾›æ ‡å‡†ç•Œé¢ï¼Œå‘æ›´é«˜çº§åˆ«çš„ Java API æ¡†æ¶æ˜¾ç¤ºè®¾å¤‡ç¡¬ä»¶åŠŸèƒ½<ul><li>HAL åŒ…å«å¤šä¸ªåº“æ¨¡å—ï¼Œå…¶ä¸­æ¯ä¸ªæ¨¡å—éƒ½ä¸ºç‰¹å®šç±»å‹çš„ç¡¬ä»¶ç»„ä»¶å®ç°ä¸€ä¸ªç•Œé¢ï¼Œä¾‹å¦‚ç›¸æœºæˆ–è“ç‰™æ¨¡å—</li><li>å½“æ¡†æ¶ API è¦æ±‚è®¿é—®è®¾å¤‡ç¡¬ä»¶æ—¶ï¼ŒAndroid ç³»ç»Ÿå°†ä¸ºè¯¥ç¡¬ä»¶ç»„ä»¶åŠ è½½åº“æ¨¡å—</li></ul></li><li>Android Runtime<ul><li>Android 5.0ï¼ˆAPI çº§åˆ« 21ï¼‰æˆ–æ›´é«˜ç‰ˆæœ¬çš„è®¾å¤‡ï¼Œæ¯ä¸ªåº”ç”¨éƒ½åœ¨å…¶è‡ªå·±çš„è¿›ç¨‹ä¸­è¿è¡Œï¼Œå¹¶ä¸”æœ‰å…¶è‡ªå·±çš„ Android Runtime (ART) å®ä¾‹</li></ul></li><li>Native Layer: C/C++ Libraries,<ul><li>è®¸å¤šæ ¸å¿ƒ Android ç³»ç»Ÿç»„ä»¶å’ŒæœåŠ¡ï¼ˆä¾‹å¦‚ ART å’Œ HALï¼‰æ„å»ºè‡ªåŸç”Ÿä»£ç ï¼Œéœ€è¦ä»¥ C å’Œ C++ ç¼–å†™çš„åŸç”Ÿåº“</li><li>Android å¹³å°æä¾› Java æ¡†æ¶ API ä»¥å‘åº”ç”¨æ˜¾ç¤ºå…¶ä¸­éƒ¨åˆ†åŸç”Ÿåº“çš„åŠŸèƒ½</li></ul></li><li>Java layer:<ul><li>é€šè¿‡ä»¥ Java è¯­è¨€ç¼–å†™çš„ API ä½¿ç”¨ Android OS çš„æ•´ä¸ªåŠŸèƒ½é›†</li></ul></li><li>åº”ç”¨å±‚: æ‰‹æœºä¸Šçš„åº”ç”¨ç¨‹åº</li></ul><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/202208050902709.png" alt="" /></p><h1 id="android-ç³»ç»Ÿå››å¤§ç»„ä»¶"><a class="markdownIt-Anchor" href="#android-ç³»ç»Ÿå››å¤§ç»„ä»¶"></a> Android ç³»ç»Ÿå››å¤§ç»„ä»¶</h1><ul><li>Activity: ç¨‹åºçš„ç•Œé¢</li><li>Service: åå°æœåŠ¡, é€»è¾‘å¤„ç†</li><li>BroadcastReceiver: æ¥æ”¶/å‘å‡ºå¹¿æ’­æ¶ˆæ¯</li><li>ContentProvider: åº”ç”¨ç¨‹åºé—´æ•°æ®å…±äº«</li></ul><h1 id="sqlite-æ•°æ®åº“"><a class="markdownIt-Anchor" href="#sqlite-æ•°æ®åº“"></a> SQLite æ•°æ®åº“</h1><p>è‡ªå¸¦è½»é‡çº§ã€è¿ç®—é€Ÿåº¦æå¿«çš„åµŒå…¥å¼å…³ç³»å‹æ•°æ®åº“ï¼š</p><ul><li>æ”¯æŒæ ‡å‡†çš„ SQL è¯­æ³•</li><li>é€šè¿‡ Android å°è£…å¥½çš„ API è¿›è¡Œæ“ä½œï¼Œè®©å­˜å‚¨å’Œè¯»å–æ•°æ®å˜å¾—éå¸¸æ–¹ä¾¿</li></ul><h1 id="å¼€å‘ç¯å¢ƒ"><a class="markdownIt-Anchor" href="#å¼€å‘ç¯å¢ƒ"></a> å¼€å‘ç¯å¢ƒ</h1><ul><li>JDK: Java è¯­è¨€çš„è½¯ä»¶å¼€å‘åŒ…, åŒ…å«äº† Java çš„è¿è¡Œç¯å¢ƒã€å·¥å…·é›†åˆã€åŸºç¡€ç±»åº“ç­‰</li><li>Android SDK: Google æä¾›çš„ Android å¼€å‘å·¥å…·åŒ…ï¼Œåœ¨å¼€å‘ Android ç¨‹åºæ—¶ï¼Œæˆ‘ä»¬éœ€è¦é€šè¿‡å¼•å…¥è¯¥å·¥å…·åŒ…æ¥ä½¿ç”¨ Android ç›¸å…³çš„ API</li><li>Android Studio: <a target="_blank" rel="noopener" href="https://developer.android.google.cn/studio">Android ç¨‹åºå¼€å‘</a></li></ul><h2 id="æ³¨æ„äº‹é¡¹"><a class="markdownIt-Anchor" href="#æ³¨æ„äº‹é¡¹"></a> æ³¨æ„äº‹é¡¹</h2><ul><li>Android ç³»ç»Ÿå°±æ˜¯é€šè¿‡åŒ…åæ¥åŒºåˆ†ä¸åŒåº”ç”¨ç¨‹åº</li><li>Android ç¨‹åºçš„æ¶‰åŠè®²ç©¶é€»è¾‘å’Œè§†å›¾åˆ†ç¦»</li></ul><h1 id="é¡¹ç›®ç»“æ„"><a class="markdownIt-Anchor" href="#é¡¹ç›®ç»“æ„"></a> é¡¹ç›®ç»“æ„</h1><ul><li><code>app</code>: é¡¹ç›®ä¸­çš„ä»£ç ã€èµ„æºç­‰å†…å®¹éƒ½æ”¾ç½®åœ¨è¿™ä¸ªç›®å½•ä¸‹</li><li><code>.gradle &amp; .idea</code>ï¼šå­˜æ”¾è‡ªåŠ¨ç”Ÿæˆçš„æ–‡ä»¶ï¼Œä¸å¿…å…³å¿ƒ</li><li><code>build</code>: ç¼–è¯‘æ—¶è‡ªåŠ¨ç”Ÿæˆçš„æ–‡ä»¶ï¼Œä¸å¿…å…³å¿ƒ</li><li><code>gradle</code>: åŒ…å«äº† gradle wrapper çš„é…ç½®æ–‡ä»¶</li><li><code>.gitignore</code>: å°†æŒ‡å®šçš„ç›®å½•æˆ–æ–‡ä»¶æ’é™¤åœ¨ç‰ˆæœ¬æ§åˆ¶ä¹‹å¤–</li><li><code>build.gradle</code>: å…¨å±€çš„ gradle æ„å»ºè„šæœ¬ï¼Œé€šå¸¸ä¸éœ€è¦ä¿®æ”¹</li><li><code>gradle.properties</code>: å…¨å±€çš„ gradle é…ç½®æ–‡ä»¶ï¼Œåœ¨è¿™é‡Œé…ç½®çš„å±æ€§ä¼šå½±å“åˆ°é¡¹ç›®ä¸­æ‰€æœ‰çš„ gradle ç¼–è¯‘è„šæœ¬</li><li><code>gradlew &amp; gradlew.bat</code>: åœ¨å‘½ä»¤è¡Œç•Œé¢ä¸­æ‰§è¡Œ gradle å‘½ä»¤</li><li><code>*.iml</code>: Android Studio åŸºäº IntelliJ IDEA å¼€å‘ï¼Œæ¯ä¸ªé¡¹ç›®éƒ½ä¼šè‡ªåŠ¨ç”Ÿæˆä¸€äº› iml æ–‡ä»¶</li><li><code>local.properties</code>: æŒ‡å®šæœ¬æœºä¸­ Android SDK è·¯å¾„</li><li><code>settings.gradle</code>: æŒ‡å®šé¡¹ç›®ä¸­æ‰€æœ‰å¼•å…¥çš„æ¨¡å—ï¼ˆappæ¨¡å—ï¼‰è‡ªåŠ¨å®Œæˆå¼•å…¥</li><li></li></ul><h2 id="app"><a class="markdownIt-Anchor" href="#app"></a> app</h2><ul><li><code>java</code>: Java ä»£ç </li><li><code>build</code>: ä¸å¤–å±‚ build ç±»ä¼¼ï¼ŒåŒ…å«äº†ä¸€äº›åœ¨ç¼–è¯‘æ—¶è‡ªåŠ¨ç”Ÿæˆçš„æ–‡ä»¶</li><li><code>libs</code>: ç¬¬ä¸‰æ–¹ jar åŒ…</li><li><code>androidTest</code>: ç¼–å†™ AndroidTest æµ‹è¯•ç”¨ä¾‹ï¼Œè‡ªåŠ¨åŒ–æµ‹è¯•</li><li><code>res</code>: é¡¹ç›®ä¸­ä½¿ç”¨åˆ°çš„æ‰€æœ‰å›¾ç‰‡ã€å¸ƒå±€ã€å­—ç¬¦ä¸²ç­‰èµ„æº</li><li><code>AndroidManifest.xml</code>: Android é¡¹ç›®é…ç½®æ–‡ä»¶ï¼Œå…¶ä½™ç»„ä»¶éœ€è¦åœ¨æ­¤è¿›è¡Œæ³¨å†Œ/æ·»åŠ æƒé™å£°æ˜</li><li><code>test</code>: ç¼–å†™ Unit Test æµ‹è¯•ç”¨ä¾‹ï¼Œè‡ªåŠ¨åŒ–æµ‹è¯•çš„å¦ä¸€ç§æ–¹æ³•</li><li><code>build.gradle</code>: app æ¨¡å—çš„ gradle æ„å»ºè„šæœ¬ï¼ŒæŒ‡å®šé¡¹ç›®æ„å»ºç›¸å…³é…ç½®</li><li><code>proguard-rules.pro</code>: æŒ‡å®šé¡¹ç›®ä»£ç çš„æ··æ·†è§„åˆ™, ä¿æŠ¤ä»£ç </li></ul><h2 id="androidmanifestxml"><a class="markdownIt-Anchor" href="#androidmanifestxml"></a> AndroidManifest.xml</h2><p>è§„åˆ™:</p><ul><li>æ²¡æœ‰åœ¨ AndroidManifest.xml é‡Œæ³¨å†Œçš„ Activity æ˜¯ä¸èƒ½ä½¿ç”¨çš„</li></ul><p>å¯¹ Activity çš„å£°æ˜ <code>&lt;activity/&gt;</code>:</p><ul><li>å£°æ˜é¡¹ç›®çš„ä¸» Activity `<intent-filter/></li><li>æŒ‡å®šæ´»åŠ¨çš„æ ‡é¢˜æ å†…å®¹ <code>android:label</code></li></ul><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>activity</span> <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>.MainActivity<span class="token punctuation">"</span></span>          <span class="token attr-name"><span class="token namespace">android:</span>label</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>This is FirstActivity<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  // æŒ‡å®šæ ‡é¢˜æ çš„å†…å®¹    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>intent-filter</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>action</span> <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>android.intent.action.MAIN<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>category</span> <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>android.intent.category.LAUNCHER<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>intent-filter</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>activity</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="res"><a class="markdownIt-Anchor" href="#res"></a> Res</h2><ul><li><code>drawable-*</code>ï¼šå­˜æ”¾å›¾ç‰‡</li></ul><ul><li><code>mipmap-*</code>ï¼šå­˜æ”¾å›¾æ ‡</li><li><code>values-*</code>ï¼šå­˜æ”¾å­—ç¬¦ä¸²ã€æ ·å¼ã€é¢œè‰²ç­‰é…ç½®</li><li><code>layout-*</code>ï¼šå­˜æ”¾å¸ƒå±€æ–‡ä»¶</li></ul><h3 id="stringsxml"><a class="markdownIt-Anchor" href="#stringsxml"></a> strings.xml</h3><p>åœ¨ <code>res/values/strings.xml</code> ä¸­å¯¹é™æ€å­—ç¬¦ä¸²è¿›è¡Œå®šä¹‰</p><ul><li>åœ¨ä»£ç ä¸­é€šè¿‡ <code>R.string.app_name</code> å¼•ç”¨</li><li>åœ¨ XML ä¸­é€šè¿‡ <code>@string/app_name</code> è¿›è¡Œå¼•ç”¨</li></ul><p>Tips: drawable ä¸ mipmap åŒç†, <code>R.drawable.app_name</code></p><h2 id="buildgradle"><a class="markdownIt-Anchor" href="#buildgradle"></a> build.gradle</h2><p>Gradle æ˜¯é¡¹ç›®æ„å»ºå·¥å…·ï¼ŒåŸºäº Groovy çš„é¢†åŸŸç‰¹å®šè¯­è¨€ï¼ˆDSLï¼‰æ¥å£°æ˜é¡¹ç›®è®¾ç½®ï¼Œæ‘’å¼ƒäº†ä¼ ç»ŸåŸºäº XMLï¼ˆå¦‚Antå’ŒMavenï¼‰çš„å„ç§ç¹çé…ç½®</p><h3 id="å¤–å±‚-buildgradle"><a class="markdownIt-Anchor" href="#å¤–å±‚-buildgradle"></a> å¤–å±‚ build.gradle</h3><ul><li>jcenterï¼šä»£ç æ‰˜ç®¡ä»“åº“ï¼ŒAndroid å¼€æºé¡¹ç›®éƒ½ä¼šå°†ä»£ç æ‰˜ç®¡åˆ° jcenter ä¸Šã€‚å£°æ˜åå¯ä»¥åœ¨é¡¹ç›®ä¸­è½»æ¾å¼•ç”¨ä»»ä½• jcenter ä¸Šçš„å¼€æºé¡¹ç›®</li><li>gradle æ’ä»¶ï¼šç”¨äºæ„å»º Android é¡¹ç›®</li></ul><h3 id="å†…éƒ¨-buildgradle"><a class="markdownIt-Anchor" href="#å†…éƒ¨-buildgradle"></a> å†…éƒ¨ build.gradle</h3><ul><li>åº”ç”¨ç¨‹åºæ¨¡å—ï¼šcom.android.applicatioinã€å¯ä»¥ç›´æ¥è¿è¡Œ</li><li>åº“æ¨¡å—ï¼šcom.android.libraryã€ä½œä¸ºä»£ç åº“ä¾é™„äºåˆ«çš„åº”ç”¨ç¨‹åºæ¨¡å—æ¥è¿è¡Œ</li><li>compileSdkVersionï¼šé¡¹ç›®çš„ç¼–è¯‘ç‰ˆæœ¬</li><li>buildToolsVersionï¼šæŒ‡å®šé¡¹ç›®æ„å»ºå·¥å…·çš„ç‰ˆæœ¬</li><li>applicationIdï¼šæŒ‡å®šé¡¹ç›®çš„åŒ…å</li><li>minSdkVersionï¼šæŒ‡å®šé¡¹ç›®æœ€ä½å…¼å®¹çš„ Android ç³»ç»Ÿç‰ˆæœ¬</li><li>targetSdkVersionï¼šç›®æ ‡ä¸Šçº¿ç‰ˆæœ¬</li><li>versionCodeï¼šæŒ‡å®šé¡¹ç›®çš„ç‰ˆæœ¬å·</li><li>versionNameï¼šæŒ‡å®šé¡¹ç›®çš„ç‰ˆæœ¬å</li><li>buildTypeï¼šæŒ‡å®šç”Ÿæˆå®‰è£…æ–‡ä»¶çš„ç›¸å…³é…ç½®</li><li>debugï¼šæŒ‡å®šç”Ÿæˆæµ‹è¯•ç‰ˆå®‰è£…æ–‡ä»¶çš„é…ç½®</li><li>releaseï¼šæŒ‡å®šç”Ÿæˆæ­£å¼ç‰ˆå®‰è£…æ–‡ä»¶çš„é…ç½®</li><li>minifyEnabledï¼šæŒ‡å®šæ˜¯å¦å¯¹é¡¹ç›®è¿›è¡Œæ··æ·†</li><li>proguardFilesï¼šæŒ‡å®šæ··æ·†æ—¶ä½¿ç”¨çš„è§„åˆ™</li><li>proguard-android.txtï¼šåœ¨Android SDKç›®å½•ä¸‹ï¼ŒåŒ…å«æ‰€æœ‰é¡¹ç›®é€šç”¨çš„æ··æ·†è§„åˆ™</li><li><a target="_blank" rel="noopener" href="http://proguard-rules.pro">proguard-rules.pro</a>ï¼šå½“å‰é¡¹ç›®çš„æ··æ·†è§„åˆ™</li><li>dependenciesï¼šæŒ‡å®šå½“å‰é¡¹ç›®æ‰€æœ‰çš„ä¾èµ–å…³ç³»<ul><li>æœ¬åœ°ä¾èµ–ï¼šå¯¹æœ¬åœ°jaråŒ…æˆ–ç›®å½•æ·»åŠ ä¾èµ–å…³ç³»</li><li>åº“ä¾èµ–ï¼šå¯¹é¡¹ç›®ä¸­çš„åº“æ¨¡å—æ·»åŠ ä¾èµ–å…³ç³»</li><li>è¿œç¨‹ä¾èµ–ï¼šå¯¹jcenteråº“ä¸Šçš„å¼€æºé¡¹ç›®æ·»åŠ ä¾èµ–å…³ç³»</li></ul></li></ul><h1 id="æ—¥å¿—å·¥å…·"><a class="markdownIt-Anchor" href="#æ—¥å¿—å·¥å…·"></a> æ—¥å¿—å·¥å…·</h1><ul><li><code>Log.v()</code>: verbose, æœ€ä¸ºçç¢çš„ã€æ„ä¹‰æœ€å°çš„æ—¥å¿—ä¿¡æ¯</li><li><code>Log.d()</code>: debug, è°ƒè¯•ä¿¡æ¯</li><li><code>Log.o()</code>: info, æ¯”è¾ƒé‡è¦çš„æ•°æ®ï¼Œè¿™äº›æ•°æ®åº”è¯¥æ˜¯ä½ éå¸¸æƒ³çœ‹åˆ°çš„ã€å¯ä»¥å¸®ä½ åˆ†æç”¨æˆ·è¡Œä¸ºçš„æ•°æ®</li><li><code>Log.w()</code>: warn, è­¦å‘Šä¿¡æ¯, æç¤ºç¨‹åºåœ¨è¿™ä¸ªåœ°æ–¹å¯èƒ½ä¼šæœ‰æ½œåœ¨çš„é£é™©ï¼Œæœ€å¥½å»ä¿®å¤ä¸€ä¸‹è¿™äº›å‡ºç°è­¦å‘Šçš„åœ°æ–¹</li><li><code>Log.e()</code>: error, é”™è¯¯ä¿¡æ¯</li></ul><p>å‚æ•°ä¸€èˆ¬ä¸¤ä¸ª: tag + msg</p><ul><li>tag: ä¸€èˆ¬ä¼ å…¥å½“å‰çš„ç±»åå°±å¥½ï¼Œä¸»è¦ç”¨äºå¯¹æ‰“å°ä¿¡æ¯è¿›è¡Œè¿‡æ»¤</li><li>msg: å…·ä½“å†…å®¹</li></ul><h2 id="å®šåˆ¶è‡ªå·±çš„æ—¥å¿—å·¥å…·"><a class="markdownIt-Anchor" href="#å®šåˆ¶è‡ªå·±çš„æ—¥å¿—å·¥å…·"></a> å®šåˆ¶è‡ªå·±çš„æ—¥å¿—å·¥å…·</h2><p>Targets</p><ul><li>å½“ç¨‹åºå¤„äºå¼€å‘é˜¶æ®µæ—¶å°±è®©æ—¥å¿—æ‰“å°å‡ºæ¥ï¼Œå½“ç¨‹åºä¸Šçº¿ä¹‹åå°±æŠŠæ—¥å¿—å±è”½æ‰</li></ul><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">object</span> LogUtil <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token keyword">const</span> <span class="token keyword">val</span> VERBOSE <span class="token operator">=</span> <span class="token number">1</span>    <span class="token keyword">private</span> <span class="token keyword">const</span> <span class="token keyword">val</span> DEBUG <span class="token operator">=</span> <span class="token number">2</span>    <span class="token keyword">private</span> <span class="token keyword">const</span> <span class="token keyword">val</span> INFO <span class="token operator">=</span> <span class="token number">3</span>    <span class="token keyword">private</span> <span class="token keyword">const</span> <span class="token keyword">val</span> WARN <span class="token operator">=</span> <span class="token number">4</span>    <span class="token keyword">private</span> <span class="token keyword">const</span> <span class="token keyword">val</span> ERROR <span class="token operator">=</span> <span class="token number">5</span>    <span class="token comment">// å¼€å‘é˜¶æ®µå°† level æ‰‹åŠ¨æŒ‡å®šæˆ VERBOSE</span>    <span class="token comment">// é¡¹ç›®æ­£å¼ä¸Šçº¿çš„æ—¶å€™å°† level æŒ‡å®šæˆ ERROR å°±å¯ä»¥äº†</span>    <span class="token keyword">private</span> <span class="token keyword">var</span> level <span class="token operator">=</span> VERBOSE    <span class="token keyword">fun</span> <span class="token function">v</span><span class="token punctuation">(</span>tag<span class="token operator">:</span> String<span class="token punctuation">,</span> msg<span class="token operator">:</span> String<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>level <span class="token operator">&lt;=</span> VERBOSE<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            Log<span class="token punctuation">.</span><span class="token function">v</span><span class="token punctuation">(</span>tag<span class="token punctuation">,</span> msg<span class="token punctuation">)</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">fun</span> <span class="token function">d</span><span class="token punctuation">(</span>tag<span class="token operator">:</span> String<span class="token punctuation">,</span> msg<span class="token operator">:</span> String<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>level <span class="token operator">&lt;=</span> DEBUG<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            Log<span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>tag<span class="token punctuation">,</span> msg<span class="token punctuation">)</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">fun</span> <span class="token function">i</span><span class="token punctuation">(</span>tag<span class="token operator">:</span> String<span class="token punctuation">,</span> msg<span class="token operator">:</span> String<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>level <span class="token operator">&lt;=</span> INFO<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            Log<span class="token punctuation">.</span><span class="token function">i</span><span class="token punctuation">(</span>tag<span class="token punctuation">,</span> msg<span class="token punctuation">)</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">fun</span> <span class="token function">w</span><span class="token punctuation">(</span>tag<span class="token operator">:</span> String<span class="token punctuation">,</span> msg<span class="token operator">:</span> String<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>level <span class="token operator">&lt;=</span> WARN<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            Log<span class="token punctuation">.</span><span class="token function">w</span><span class="token punctuation">(</span>tag<span class="token punctuation">,</span> msg<span class="token punctuation">)</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">fun</span> <span class="token function">e</span><span class="token punctuation">(</span>tag<span class="token operator">:</span> String<span class="token punctuation">,</span> msg<span class="token operator">:</span> String<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>level <span class="token operator">&lt;=</span> ERROR<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            Log<span class="token punctuation">.</span><span class="token function">e</span><span class="token punctuation">(</span>tag<span class="token punctuation">,</span> msg<span class="token punctuation">)</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> Android Dev. </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Android </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>03-TSçš„ç±»å‹ç¼©å°æœºåˆ¶</title>
      <link href="/Coming-blog/2022/07/04/03-ts-de-lei-xing-suo-xiao-ji-zhi/"/>
      <url>/Coming-blog/2022/07/04/03-ts-de-lei-xing-suo-xiao-ji-zhi/</url>
      
        <content type="html"><![CDATA[<h1 id="ç±»å‹ç¼©å°"><a class="markdownIt-Anchor" href="#ç±»å‹ç¼©å°"></a> ç±»å‹ç¼©å°</h1><p>é’ˆå¯¹è”åˆç±»å‹, åœ¨å‚æ•°ä½¿ç”¨æ˜¯é€šå¸¸è¦å¯¹å‚æ•°çš„ç±»å‹è¿›ä¸€æ­¥åˆ¤æ–­ååœ¨è¿›è¡Œä¸“é—¨çš„å¤„ç†, è¿™ä¸ªåˆ¤æ–­è¿‡ç¨‹å°±å¯ä»¥è®¤ä¸ºæ˜¯ç±»å‹é˜²æŠ¤; å°†ç±»å‹ç»†åŒ–ä¸ºæ¯”å£°æ˜æ›´å…·ä½“çš„ç±»å‹çš„è¿‡ç¨‹ä¸ºç±»å‹ç¼©å°</p><ul><li>å…·ä½“çš„ TS æ˜¯é’ˆå¯¹å‡½æ•°æ§åˆ¶æµå›¾æ¥å®ç°ç±»å‹ç¼©å°ä¸åç»­æ‰§è¡Œå†…å®¹çš„ç±»å‹æ£€æŸ¥çš„</li></ul><pre class="line-numbers language-ts" data-language="ts"><code class="language-ts"><span class="token keyword">function</span> <span class="token function">padLeft</span><span class="token punctuation">(</span>padding<span class="token operator">:</span> <span class="token builtin">number</span> <span class="token operator">|</span> <span class="token builtin">string</span><span class="token punctuation">,</span> input<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> padding <span class="token operator">===</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token builtin">Array</span></span><span class="token punctuation">(</span>padding <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">)</span> <span class="token operator">+</span> input<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">return</span> padding <span class="token operator">+</span> input<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¸¸è§ç±»å‹é˜²æŠ¤ï¼š</p><ul><li><code>typeof</code>: <code>typeof strs === &quot;object&quot;</code> ....</li><li><code>if(value)</code>: if å‹çœŸå€¼ç¼©å°, æ’é™¤ <code>0, NaN, &quot;&quot;, 0n, null, undefined</code></li><li></li></ul><h1 id="çœŸå€¼ç¼©å°"><a class="markdownIt-Anchor" href="#çœŸå€¼ç¼©å°"></a> çœŸå€¼ç¼©å°</h1><ul><li>if å‹çœŸå€¼ç¼©å°: <code>0, NaN, &quot;&quot;, 0n, null, undefined</code> ä¼šè¢« if è®¤ä¸ºå¼ false</li><li>Boolean å¼ºåˆ¶ç±»å‹è½¬æ¢çš„ç±»å‹ç¼©å°: <code>Boolean(&quot;hello&quot;)</code></li><li>åŒå¹å·ç±»å‹ç¼©å°: <code>!!&quot;world&quot;</code></li></ul><pre class="line-numbers language-ts" data-language="ts"><code class="language-ts"><span class="token keyword">function</span> <span class="token function">getUserOnlineMessage</span><span class="token punctuation">(</span>numUsersOnline<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// </span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>numUsersOnline<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> `ç°åœ¨å…±æœ‰ $<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span> äººåœ¨çº¿<span class="token operator">!</span>`<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">return</span> <span class="token string">"ç°åœ¨æ²¡æœ‰äººåœ¨çº¿. :("</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åº”ç”¨ï¼šä¸»è¦ç”¨äºåˆ¤æ–­å‚æ•°æ˜¯å¦ä¸ºæœ‰æ•ˆå€¼ï¼ˆé null, é undefinedï¼‰</p><pre class="line-numbers language-ts" data-language="ts"><code class="language-ts"><span class="token keyword">function</span> <span class="token function">multiplyAll</span><span class="token punctuation">(</span>    values<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">|</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span>    factor<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// å¦‚æœ values æ˜¯ number[] é‚£ä¹ˆå°±å°†é‡Œé¢çš„å€¼éƒ½ä¹˜ä»¥ factor å¦åˆ™ç›´æ¥è¿”å› values</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>values<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        values <span class="token operator">=</span> values<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> item <span class="token operator">*</span> factor        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> item <span class="token keyword">of</span> values<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>        <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>values<span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">return</span> values<span class="token punctuation">&#125;</span> <span class="token function">multiplyAll</span><span class="token punctuation">(</span><span class="token keyword">undefined</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token function">multiplyAll</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="ç­‰å€¼ç¼©å°"><a class="markdownIt-Anchor" href="#ç­‰å€¼ç¼©å°"></a> ç­‰å€¼ç¼©å°</h1><p>ä½¿ç”¨ <code>=== | !== | == | !=</code> è¿›è¡Œåˆ¤æ–­åä¹Ÿå¯ä»¥ç¼©å°ç±»å‹ç©ºé—´, ä½†æ˜¯ä¸ªäººæ„Ÿè§‰æ¯”è¾ƒé¸¡è‚‹, åº”è¯¥ä¸å¸¸ç”¨</p><h1 id="in-æ“ä½œç¬¦ç¼©å°"><a class="markdownIt-Anchor" href="#in-æ“ä½œç¬¦ç¼©å°"></a> in æ“ä½œç¬¦ç¼©å°</h1><p>in ç”¨äºåˆ¤æ–­å¯¹è±¡æ˜¯å¦å…·æœ‰æŸä¸ªå±æ€§, å¯ä»¥è¢«ç”¨äºç¼©å°ç±»å‹èŒƒå›´</p><pre class="line-numbers language-ts" data-language="ts"><code class="language-ts"><span class="token keyword">type</span> <span class="token class-name">Fish</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token function-variable function">swim</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">void</span> <span class="token punctuation">&#125;</span><span class="token keyword">type</span> <span class="token class-name">Bird</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token function-variable function">fly</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">void</span> <span class="token punctuation">&#125;</span><span class="token keyword">type</span> <span class="token class-name">Human</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span> swim<span class="token operator">?</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">void</span><span class="token punctuation">;</span> fly<span class="token operator">?</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">void</span> <span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function">move</span><span class="token punctuation">(</span>animal<span class="token operator">:</span> Fish <span class="token operator">|</span> Bird <span class="token operator">|</span> Human<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">"swim"</span> <span class="token keyword">in</span> animal<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">// Fish | Human ä½†æ˜¯ Human å¯èƒ½æ²¡æœ‰ swim</span>        <span class="token comment">// å› æ­¤å¯ä»¥ç”¨æ–­è¨€è¿›è¡Œç©ºé—´ç¼©å°</span>        <span class="token keyword">return</span> <span class="token punctuation">(</span>animal <span class="token keyword">as</span> Fish<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">swim</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">// å¯èƒ½æ˜¯ Bird æˆ– Human ä½†æ˜¯ Human å¯èƒ½æ²¡æœ‰ fly</span>    <span class="token keyword">return</span> <span class="token punctuation">(</span>animal <span class="token keyword">as</span> Bird<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">fly</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="instanceof-æ“ä½œç¬¦ç¼©å°"><a class="markdownIt-Anchor" href="#instanceof-æ“ä½œç¬¦ç¼©å°"></a> instanceof æ“ä½œç¬¦ç¼©å°</h1><p>ç”¨äºæ£€æŸ¥ç›®æ ‡æ˜¯å¦æ˜¯å¦ä¸€ä¸ªç›®æ ‡çš„å®ä¾‹ï¼š æ£€æŸ¥åŸå‹é“¾</p><pre class="line-numbers language-ts" data-language="ts"><code class="language-ts"><span class="token keyword">function</span> <span class="token function">logValue</span><span class="token punctuation">(</span>x<span class="token operator">:</span> Date <span class="token operator">|</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>x <span class="token keyword">instanceof</span> <span class="token class-name">Date</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>x<span class="token punctuation">.</span><span class="token function">toUTCString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>        <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>x<span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token function">logValue</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token function">logValue</span><span class="token punctuation">(</span><span class="token string">"TIME"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="åˆ†é…ç¼©å°"><a class="markdownIt-Anchor" href="#åˆ†é…ç¼©å°"></a> åˆ†é…ç¼©å°</h1><p>åœ¨å¯¹ç›®æ ‡éå†è¿›è¡Œç¬¬ä¸€ä¸ªèµ‹å€¼æ—¶, ts ä¼šå¯¹ç›®æ ‡å¯¹è±¡è¿›è¡Œç±»å‹æ¨æ–­, è¿™æ ·å°±é™åˆ¶äº†ç›®æ ‡å¯¹è±¡çš„ç±»å‹ç©ºé—´</p><pre class="line-numbers language-ts" data-language="ts"><code class="language-ts"><span class="token comment">// let x: string | number</span><span class="token keyword">let</span> x <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0.5</span> <span class="token operator">?</span> <span class="token number">10</span> <span class="token operator">:</span> <span class="token string">"hello world"</span>x <span class="token operator">=</span> <span class="token number">1</span><span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span>x <span class="token operator">=</span> <span class="token string">"Hello World"</span><span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span>x <span class="token operator">=</span> <span class="token boolean">true</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/202207042148443.png" alt="" /></p><h1 id="ç±»å‹è°“è¯"><a class="markdownIt-Anchor" href="#ç±»å‹è°“è¯"></a> ç±»å‹è°“è¯</h1><p>æ ¼å¼: <code>parameterName is Type</code>, parameterName æ˜¯å‡½æ•°ä¸­å­˜åœ¨çš„å‚æ•°, å®ç°ç±»å‹çš„ç¼©å°</p><p>å°è£…ç¨‹åº¦è¿‡é«˜, äº†è§£å³å¯</p><pre class="line-numbers language-ts" data-language="ts"><code class="language-ts"><span class="token keyword">type</span> <span class="token class-name">Fish1</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span>    name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span>    <span class="token function-variable function">swim</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">void</span><span class="token punctuation">&#125;</span><span class="token keyword">type</span> <span class="token class-name">Bird1</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span>    name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span>    <span class="token function-variable function">fly</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">void</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function">isFish</span><span class="token punctuation">(</span>pet<span class="token operator">:</span> Fish1 <span class="token operator">|</span> Bird1<span class="token punctuation">)</span><span class="token operator">:</span> pet <span class="token keyword">is</span> Fish1 <span class="token punctuation">&#123;</span>    <span class="token comment">// return true</span>    <span class="token comment">// æ–­è¨€æ˜¯ä¸ºäº†è®©ç¼–è¯‘é€šè¿‡çš„ï¼Œå®é™…ä¸Šä¼ è¿‡æ¥çš„å‚æ•°ä¸ä¼šå› ä¸º as è€Œæ”¹å˜ä»€ä¹ˆ</span>    <span class="token keyword">return</span> <span class="token punctuation">(</span>pet <span class="token keyword">as</span> Fish1<span class="token punctuation">)</span><span class="token punctuation">.</span>swim <span class="token operator">!==</span> <span class="token keyword">undefined</span><span class="token punctuation">&#125;</span><span class="token keyword">const</span> fish_demo<span class="token operator">:</span> Fish1 <span class="token operator">=</span> <span class="token punctuation">&#123;</span>    name<span class="token operator">:</span> <span class="token string">"fish"</span><span class="token punctuation">,</span>    <span class="token function-variable function">swim</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"FISHING"</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token keyword">const</span> bird_demo<span class="token operator">:</span> Bird1 <span class="token operator">=</span> <span class="token punctuation">&#123;</span>    name<span class="token operator">:</span> <span class="token string">"bird"</span><span class="token punctuation">,</span>    <span class="token function-variable function">fly</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"FLYING"</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">isFish</span><span class="token punctuation">(</span>fish_demo<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">isFish</span><span class="token punctuation">(</span>bird_demo<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">function</span> <span class="token function">getSmallPet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> Fish1 <span class="token operator">|</span> Bird1 <span class="token punctuation">&#123;</span>    <span class="token keyword">const</span> fish_demo<span class="token operator">:</span> Fish1 <span class="token operator">=</span> <span class="token punctuation">&#123;</span>        name<span class="token operator">:</span> <span class="token string">"fish"</span><span class="token punctuation">,</span>        <span class="token function-variable function">swim</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"FISHING"</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>        <span class="token keyword">const</span> bird_demo<span class="token operator">:</span> Bird1 <span class="token operator">=</span> <span class="token punctuation">&#123;</span>        name<span class="token operator">:</span> <span class="token string">"bird"</span><span class="token punctuation">,</span>        <span class="token function-variable function">fly</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"FLYING"</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">return</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0.5</span> <span class="token operator">?</span> fish_demo <span class="token operator">:</span> bird_demo<span class="token punctuation">&#125;</span><span class="token keyword">let</span> pet <span class="token operator">=</span> <span class="token function">getSmallPet</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// fish | bird</span><span class="token comment">// æ§åˆ¶æµåˆ†æå®ç°äº†ç±»å‹çš„ç¼©å°</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">isFish</span><span class="token punctuation">(</span>pet<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    pet<span class="token punctuation">.</span><span class="token function">swim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>    pet<span class="token punctuation">.</span><span class="token function">fly</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token keyword">const</span> zoo<span class="token operator">:</span> <span class="token punctuation">(</span>Fish1 <span class="token operator">|</span> Bird1<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token function">getSmallPet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">getSmallPet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">getSmallPet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">getSmallPet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">getSmallPet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token keyword">const</span> underWater<span class="token operator">:</span> Fish1<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> zoo<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>isFish<span class="token punctuation">)</span><span class="token keyword">const</span> underWater1<span class="token operator">:</span> Fish1<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> zoo<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>isFish<span class="token punctuation">)</span> <span class="token keyword">as</span> Fish1<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token keyword">const</span> underWater2<span class="token operator">:</span> Fish1<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> zoo<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span>pet<span class="token punctuation">)</span><span class="token operator">:</span> pet <span class="token keyword">is</span> Fish1 <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>pet<span class="token punctuation">.</span>name <span class="token operator">===</span> <span class="token string">'frog'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">// å¯ä»¥é¢å¤–æ‰©å±•</span>        <span class="token keyword">return</span> <span class="token boolean">false</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">return</span> <span class="token function">isFish</span><span class="token punctuation">(</span>pet<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> TypeScript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> typescript-basic </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>02-TSçš„ç±»å‹å£°æ˜ä¸åŸºæœ¬æ“ä½œ</title>
      <link href="/Coming-blog/2022/07/04/02-ts-de-lei-xing-sheng-ming-yu-ji-ben-cao-zuo/"/>
      <url>/Coming-blog/2022/07/04/02-ts-de-lei-xing-sheng-ming-yu-ji-ben-cao-zuo/</url>
      
        <content type="html"><![CDATA[<h1 id="ç±»å‹å£°æ˜"><a class="markdownIt-Anchor" href="#ç±»å‹å£°æ˜"></a> ç±»å‹å£°æ˜</h1><p>ä½¿ç”¨ <code>:</code> + <code>ç±»å‹</code> ä¸ºç›®æ ‡å˜é‡åˆ¶å®šæ˜¾ç¤ºç±»å‹</p><ul><li><code>let param: type = value</code></li><li><code>function fn(param1: type1, param2: type2): typeRet &#123;&#125;</code></li></ul><p>æ­¤å¤–, TS è¿˜èƒ½æ”¯æŒç±»å‹æ¨æ–­, å› æ­¤ä¸ç”¨ä¸€ç›´æ‰‹åŠ¨æŒ‡å®šç±»å‹</p><h1 id="typescript-ç±»å‹"><a class="markdownIt-Anchor" href="#typescript-ç±»å‹"></a> TypeScript ç±»å‹</h1><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/202207051644467.png" alt="" /></p><h2 id="åŸºæœ¬ç±»å‹"><a class="markdownIt-Anchor" href="#åŸºæœ¬ç±»å‹"></a> åŸºæœ¬ç±»å‹</h2><ul><li><code>string</code>, <code>number</code>, <code>boolean</code></li></ul><pre class="line-numbers language-ts" data-language="ts"><code class="language-ts"><span class="token keyword">let</span> str<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">=</span> <span class="token string">'hello typescript'</span><span class="token keyword">let</span> num<span class="token operator">:</span> <span class="token builtin">number</span> <span class="token operator">=</span> <span class="token number">100</span><span class="token keyword">let</span> bool<span class="token operator">:</span> <span class="token builtin">boolean</span> <span class="token operator">=</span> <span class="token boolean">true</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><ul><li>æ•°ç»„: <code>type[]</code> æˆ– <code>Array&lt;type&gt;</code></li></ul><pre class="line-numbers language-ts" data-language="ts"><code class="language-ts"><span class="token keyword">let</span> arr<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token keyword">let</span> strArr<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'1'</span><span class="token punctuation">,</span> <span class="token string">'2'</span><span class="token punctuation">,</span> <span class="token string">'3'</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ul><li>tuple: å…ƒç»„, å›ºå®šé•¿åº¦çš„æ•°ç»„</li></ul><pre class="line-numbers language-ts" data-language="ts"><code class="language-ts"><span class="token keyword">let</span> h<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token builtin">number</span><span class="token punctuation">]</span> <span class="token comment">// è¡¨ç¤ºé•¿åº¦ä¸º 3 çš„æ•°ç»„, æ•°ç»„ä¸­å…ƒç´ çš„ç±»å‹å¯ä»¥ä¸ä¸€è‡´</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="object-ç±»å‹"><a class="markdownIt-Anchor" href="#object-ç±»å‹"></a> object ç±»å‹</h2><p>å¯¹å¯¹è±¡çš„å±æ€§è¿›è¡Œç±»å‹çº¦æŸ</p><pre class="line-numbers language-ts" data-language="ts"><code class="language-ts"><span class="token comment">// é€—å·ä¸åˆ†å·éƒ½èƒ½å½“ä½œåˆ†éš”ç¬¦</span><span class="token keyword">function</span> <span class="token function">printCoord</span><span class="token punctuation">(</span>pt<span class="token operator">:</span> <span class="token punctuation">&#123;</span> x<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span> y<span class="token operator">:</span> <span class="token builtin">number</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">&#123;</span>    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"åæ ‡çš„ x å€¼ä¸º: "</span> <span class="token operator">+</span> pt<span class="token punctuation">.</span>x<span class="token punctuation">)</span>    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"åæ ‡çš„ y å€¼ä¸º: "</span> <span class="token operator">+</span> pt<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>? è¡¨ç¤ºå¯é€‰å±æ€§</li></ul><pre class="line-numbers language-ts" data-language="ts"><code class="language-ts"><span class="token keyword">function</span> <span class="token function">printName</span><span class="token punctuation">(</span>obj<span class="token operator">:</span> <span class="token punctuation">&#123;</span> first<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span> last<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span>last <span class="token operator">===</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        obj<span class="token punctuation">.</span>last <span class="token operator">=</span> <span class="token string">''</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>        obj<span class="token punctuation">.</span>last <span class="token operator">+=</span> <span class="token string">' '</span>    <span class="token punctuation">&#125;</span>    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span>last <span class="token operator">+</span> obj<span class="token punctuation">.</span>first<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>å½“æœ‰å¤šä¸ªå¯é€‰å±æ€§æ—¶, <code>[propName: string]</code> æ˜¯å¯¹å±æ€§åçš„é™åˆ¶, <code>: any</code> æ˜¯å¯¹å±æ€§å€¼çš„é™åˆ¶</li></ul><pre class="line-numbers language-ts" data-language="ts"><code class="language-ts"><span class="token keyword">let</span> d<span class="token operator">:</span> <span class="token punctuation">&#123;</span>name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>propName<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>d <span class="token operator">=</span> <span class="token punctuation">&#123;</span>name<span class="token operator">:</span> <span class="token string">'coming'</span><span class="token punctuation">,</span> age<span class="token operator">:</span> <span class="token number">23</span><span class="token punctuation">,</span> like<span class="token operator">:</span> <span class="token string">'123'</span><span class="token punctuation">,</span> apple<span class="token operator">:</span> <span class="token string">'apple'</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="any-ä¸-unknown"><a class="markdownIt-Anchor" href="#any-ä¸-unknown"></a> any ä¸ unknown</h2><p>ä»»æ„ç±»å‹, any ç›¸å½“äºå…³é—­äº†ç›¸å…³çš„ç±»å‹æ£€æŸ¥, unknown ç›¸å½“äºç±»å‹å®‰å…¨çš„ any</p><p>å½“æŠŠä¸€ä¸ª any ç±»å‹èµ‹å€¼ç»™ä¸€ä¸ªæŒ‡å®šç±»å‹(å¦‚å­—ç¬¦ä¸²æ—¶), å°±ä¼šå½±å“åˆ°ç›®æ ‡çš„ç±»å‹æ£€æŸ¥; ä½†æ˜¯å¦‚æœæŠŠä¸€ä¸ª unknown ç±»å‹èµ‹å€¼ç»™ä¸€ä¸ªæŒ‡å®šç±»å‹(å¦‚å­—ç¬¦ä¸²æ—¶), å°±ä¼šè¿›è¡ŒæŠ¥é”™æé†’</p><pre class="line-numbers language-ts" data-language="ts"><code class="language-ts"><span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token string">'hello'</span><span class="token keyword">let</span> b<span class="token operator">:</span> <span class="token builtin">unknown</span><span class="token punctuation">;</span><span class="token keyword">let</span> c<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">;</span>a <span class="token operator">=</span> c <span class="token comment">// é€šè¿‡æ£€æŸ¥</span><span class="token comment">// a = b // ä¸èƒ½å°†ç±»å‹â€œunknownâ€åˆ†é…ç»™ç±»å‹â€œstringâ€</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="å‡½æ•°ç±»å‹"><a class="markdownIt-Anchor" href="#å‡½æ•°ç±»å‹"></a> å‡½æ•°ç±»å‹</h2><p>æ•…åæ€æ„, å…¶å€¼æ˜¯ä¸€ä¸ªå‡½æ•°, å¯ä»¥è¿›ä¸€æ­¥è§„å®šå…¶å‡½æ•°è¿”å›å€¼çš„ç±»å‹ç­‰</p><pre class="line-numbers language-ts" data-language="ts"><code class="language-ts"><span class="token keyword">type</span> <span class="token class-name">Fish</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token function-variable function">swim</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">void</span> <span class="token punctuation">&#125;</span><span class="token keyword">type</span> <span class="token class-name">Bird</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token function-variable function">fly</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">void</span> <span class="token punctuation">&#125;</span><span class="token keyword">type</span> <span class="token class-name">Human</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span> swim<span class="token operator">?</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">void</span><span class="token punctuation">;</span> fly<span class="token operator">?</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">void</span> <span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function">move</span><span class="token punctuation">(</span>animal<span class="token operator">:</span> Fish <span class="token operator">|</span> Bird <span class="token operator">|</span> Human<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">"swim"</span> <span class="token keyword">in</span> animal<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">// Fish | Human ä½†æ˜¯ Human å¯èƒ½æ²¡æœ‰ swim</span>        <span class="token comment">// å› æ­¤å¯ä»¥ç”¨æ–­è¨€è¿›è¡Œç©ºé—´ç¼©å°</span>        <span class="token keyword">return</span> <span class="token punctuation">(</span>animal <span class="token keyword">as</span> Fish<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">swim</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">// å¯èƒ½æ˜¯ Bird æˆ– Human ä½†æ˜¯ Human å¯èƒ½æ²¡æœ‰ fly</span>    <span class="token keyword">return</span> <span class="token punctuation">(</span>animal <span class="token keyword">as</span> Bird<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">fly</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token keyword">const</span> petA<span class="token operator">:</span> Fish <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token function-variable function">swim</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"petA is a Fish."</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">const</span> petB<span class="token operator">:</span> Bird <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token function-variable function">fly</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"petB is a Bird."</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">const</span> petC<span class="token operator">:</span> Human <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token function">move</span><span class="token punctuation">(</span>petA<span class="token punctuation">)</span><span class="token function">move</span><span class="token punctuation">(</span>petB<span class="token punctuation">)</span><span class="token comment">// move(petC) // å› ä¸ºæ–­è¨€è€ŒæŠ¥é”™</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="æ–‡å­—ç±»å‹"><a class="markdownIt-Anchor" href="#æ–‡å­—ç±»å‹"></a> æ–‡å­—ç±»å‹</h2><p>let ä¸ const: æ–‡å­—ç±»å‹å°±æ˜¯å»æ¨¡æ‹Ÿ const çš„å£°æ˜é™åˆ¶</p><pre class="line-numbers language-ts" data-language="ts"><code class="language-ts"><span class="token keyword">let</span> testString <span class="token operator">=</span> <span class="token string">"hello world"</span>testString <span class="token operator">=</span> <span class="token string">"world hello"</span><span class="token keyword">const</span> constantString <span class="token operator">=</span> <span class="token string">"hello world"</span><span class="token comment">// constantString = "world hello" // Wrong</span><span class="token keyword">let</span> x<span class="token operator">:</span> <span class="token string">'hello'</span> <span class="token operator">=</span> <span class="token string">'hello'</span> <span class="token comment">// ç±»å‹å®šä¹‰ä¸º 'hello' å…¶å€¼åªèƒ½æ˜¯å­—ç¬¦ä¸² 'hello'</span><span class="token keyword">let</span> b1<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token operator">=</span> <span class="token boolean">true</span> <span class="token comment">// å¸ƒå°”æ–‡å­—ç±»å‹</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å•ç‹¬çš„åº”ç”¨å…¶å®å°±æ˜¯ const, ä½†æ˜¯ç»“åˆè”åˆç±»å‹, å°±å¯ä»¥è§„å®šå˜é‡çš„å†…å®¹é€‰æ‹©ç©ºé—´</p><pre class="line-numbers language-ts" data-language="ts"><code class="language-ts"><span class="token comment">// demo-1</span><span class="token keyword">function</span> <span class="token function">printText</span><span class="token punctuation">(</span>s<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> alignment<span class="token operator">:</span> <span class="token string">'left'</span> <span class="token operator">|</span> <span class="token string">'right'</span> <span class="token operator">|</span> <span class="token string">'center'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>alignment <span class="token operator">+</span> <span class="token string">' : '</span> <span class="token operator">+</span> s<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token comment">// demo-2</span><span class="token keyword">function</span> <span class="token function">compare</span><span class="token punctuation">(</span>a<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span> b<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">|</span> <span class="token number">0</span> <span class="token operator">|</span> <span class="token number">1</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> a <span class="token operator">===</span> b <span class="token operator">?</span> <span class="token number">0</span> <span class="token operator">:</span> a <span class="token operator">></span> b <span class="token operator">?</span> <span class="token number">1</span> <span class="token operator">:</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="ä¸ç±»å‹æ¨æ–­ç»“åˆä½¿ç”¨"><a class="markdownIt-Anchor" href="#ä¸ç±»å‹æ¨æ–­ç»“åˆä½¿ç”¨"></a> ä¸ç±»å‹æ¨æ–­ç»“åˆä½¿ç”¨</h3><p>å½“æˆ‘ä»¬å®šä¹‰ä¸€ä¸ªå¯¹è±¡çš„å±æ€§ä½†æ²¡æœ‰æ˜¾ç¤ºæŒ‡æ˜å…¶ç±»å‹æ—¶ï¼Œts ä¼šè‡ªåŠ¨å¸®åŠ©æˆ‘ä»¬è¿›è¡Œç±»å‹æ¨æ–­ï¼š</p><pre class="line-numbers language-ts" data-language="ts"><code class="language-ts"><span class="token keyword">const</span> obj2 <span class="token operator">=</span> <span class="token punctuation">&#123;</span>    count<span class="token operator">:</span> <span class="token number">0</span> <span class="token comment">// æ¨æ–­ä¸º number ç±»å‹</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    obj2<span class="token punctuation">.</span>count <span class="token operator">=</span> <span class="token number">1</span>    <span class="token comment">// obj2.count = "1" // Wrong:  Type 'string' is not assignable to type 'number'.</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>é’ˆå¯¹å¤æ‚çš„å‡½æ•°è°ƒç”¨ï¼Œæˆ‘ä»¬å¯ä»¥å°†æœ‰é™çš„å¯ä¼ é€’çš„å‚æ•°å°è£…ä¸ºå¯¹è±¡å®ç°å¤ç”¨ï¼š</p><pre class="line-numbers language-ts" data-language="ts"><code class="language-ts"><span class="token keyword">function</span> <span class="token function">handleRequest</span><span class="token punctuation">(</span>url<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> method<span class="token operator">:</span> <span class="token string">'GET'</span> <span class="token operator">|</span> <span class="token string">'POST'</span> <span class="token operator">|</span> <span class="token string">'GUESS'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// pass</span><span class="token punctuation">&#125;</span><span class="token keyword">const</span> req <span class="token operator">=</span> <span class="token punctuation">&#123;</span>    url<span class="token operator">:</span> <span class="token string">'https://example.com'</span><span class="token punctuation">,</span>    method<span class="token operator">:</span> <span class="token string">'GET'</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token comment">// handleRequest(req.url, req.method) // Wrong: Argument of type 'string' is not assignable to parameter of type '"GET" | "POST" | "GUESS"'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä½†æ˜¯åŸºäºç±»å‹æ¨æ–­ï¼Œå±æ€§ method ä¼šè¢«æ¨æ–­ä¸º string ç±»å‹ï¼Œå¹¶ä¸æ˜¯å‡½æ•°å‚æ•°æ‰€è¦æ±‚çš„æ–‡å­—ç±»å‹ï¼Œå› æ­¤éœ€è¦è¿›è¡Œç±»å‹è½¬æ¢</p><pre class="line-numbers language-ts" data-language="ts"><code class="language-ts"><span class="token comment">// æ¯”è¾ƒç®€å•çš„è§£å†³æ–¹æ¡ˆå°±æ˜¯åœ¨å‚æ•°å¯¹è±¡å®šä¹‰æ—¶æ‰‹åŠ¨è¿›è¡Œç±»å‹æ¨æ–­</span><span class="token keyword">const</span> req <span class="token operator">=</span> <span class="token punctuation">&#123;</span>    url<span class="token operator">:</span> <span class="token string">'https://example.com'</span><span class="token punctuation">,</span>    method<span class="token operator">:</span> <span class="token string">'GET'</span> <span class="token keyword">as</span> <span class="token string">'GET'</span><span class="token punctuation">&#125;</span><span class="token comment">// æˆ–è€…ç›´æ¥å°†å‚æ•°å¯¹è±¡æ¨æ–­ä¸ºæ–‡å­—ç±»å‹</span><span class="token keyword">const</span> req <span class="token operator">=</span> <span class="token punctuation">&#123;</span>    url<span class="token operator">:</span> <span class="token string">'https://example.com'</span><span class="token punctuation">,</span>    method<span class="token operator">:</span> <span class="token string">'GET'</span><span class="token punctuation">&#125;</span> <span class="token keyword">as</span> <span class="token keyword">const</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="void-ç±»å‹"><a class="markdownIt-Anchor" href="#void-ç±»å‹"></a> void ç±»å‹</h2><p>ä¸»è¦ç”¨äºå‡½æ•°æ— è¿”å›å€¼çš„æƒ…å†µ</p><h2 id="null-undefined"><a class="markdownIt-Anchor" href="#null-undefined"></a> null undefined</h2><p>null å’Œ undefined ç±»å‹åˆ†åˆ«å¯¹åº” JS çš„ null å’Œ undefined ç±»å‹</p><p>å£°æ˜ä¸å®šä¹‰æ—¶ä¼šè‡ªåŠ¨è¿›è¡Œç±»å‹æ¨æ–­ï¼š</p><pre class="line-numbers language-ts" data-language="ts"><code class="language-ts"><span class="token keyword">let</span> x_11 <span class="token operator">=</span> <span class="token keyword">undefined</span> <span class="token comment">// è‡ªåŠ¨æ¨æ–­ undefined</span><span class="token keyword">let</span> x_11_1<span class="token operator">:</span> <span class="token keyword">undefined</span> <span class="token operator">=</span> <span class="token keyword">undefined</span><span class="token keyword">let</span> y_11 <span class="token operator">=</span> <span class="token keyword">null</span><span class="token keyword">let</span> y_11_1<span class="token operator">:</span> <span class="token keyword">null</span> <span class="token operator">=</span> <span class="token keyword">null</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>ä½†æ˜¯é»˜è®¤æƒ…å†µä¸‹ï¼ˆä¸¥æ ¼æ¨¡å¼ï¼‰å…¶å®ƒç±»å‹çš„æ˜¾ç¤ºå£°æ˜ä¸èƒ½è¢«èµ‹å€¼ä¸º null æˆ– undefinedï¼š</p><pre class="line-numbers language-ts" data-language="ts"><code class="language-ts"><span class="token comment">// let z_11: string = undefined // å› ä¸ºå¼€å¯äº† strictNullChecks å› æ­¤ä¸èƒ½å°† string ç±»å‹é¢„å®šä¹‰ä¸º undefined ç±»å‹</span><span class="token keyword">let</span> z_11_1<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">=</span> <span class="token keyword">undefined</span> <span class="token comment">// å…³é—­åå³å¯, ä½†æ˜¯ä¸å»ºè®®å…³é—­</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>é’ˆå¯¹ null ä¸ undefined è¿™ä¸¤ä¸ªç±»å‹ï¼Œ<code>!</code> è¡¨ç¤ºæ–­è¨€ç›®æ ‡å˜é‡ä¸ä¸º null æˆ– undefinedï¼š</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">liveDangerously_11</span><span class="token punctuation">(</span><span class="token parameter">x<span class="token operator">?</span><span class="token operator">:</span> number <span class="token operator">|</span> <span class="token keyword">null</span></span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// x! è¡¨ç¤ºæ–­è¨€(assert) è™½ç„¶æ”¯æŒ null çš„è¾“å…¥ï¼Œä½†æ˜¯æ‰§è¡Œåˆ°è¿™å¥æ—¶ä¼šè¿›è¡Œå¼‚å¸¸å¤„ç†</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>x<span class="token operator">!</span><span class="token punctuation">.</span><span class="token function">toFixed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// ä½†æ˜¯ä¸æ¨èä½¿ç”¨ï¼Œå¤æ‚åº¦æå‡å¯èƒ½å¯¼è‡´æ½œåœ¨é—®é¢˜</span><span class="token punctuation">&#125;</span><span class="token function">liveDangerously_11</span><span class="token punctuation">(</span><span class="token number">1.1</span><span class="token punctuation">)</span><span class="token comment">// liveDangerously_11(null)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="never-ç±»å‹"><a class="markdownIt-Anchor" href="#never-ç±»å‹"></a> never ç±»å‹</h2><p>åœ¨ç±»å‹ç¼©å°æ—¶, å¦‚æœç›®æ ‡å˜é‡çš„ç±»å‹å¯èƒ½æ€§ä¸º 0 æ—¶, å°±ä¼šè¢«èµ‹äºˆ never ç±»å‹, è¡¨ç¤ºä¸å­˜åœ¨çš„çŠ¶æ€</p><ul><li>never ç±»å‹å¯ä»¥åˆ†é…ç»™æ¯ä¸ªç±»å‹</li><li>ä½†æ²¡æœ‰ä»»ä½•ç±»å‹å¯ä»¥åˆ†é…ç»™ never</li></ul><pre class="line-numbers language-ts" data-language="ts"><code class="language-ts"><span class="token keyword">interface</span> <span class="token class-name">Circle3</span> <span class="token punctuation">&#123;</span>    kind<span class="token operator">:</span> <span class="token string">'circle'</span><span class="token punctuation">,</span>    radius<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">&#125;</span><span class="token keyword">interface</span> <span class="token class-name">Square3</span> <span class="token punctuation">&#123;</span>    kind<span class="token operator">:</span> <span class="token string">'square'</span><span class="token punctuation">,</span>    length<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">&#125;</span><span class="token keyword">interface</span> <span class="token class-name">Triangle3</span> <span class="token punctuation">&#123;</span>    kind<span class="token operator">:</span> <span class="token string">'triangle'</span><span class="token punctuation">,</span>    length<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">&#125;</span><span class="token keyword">type</span> <span class="token class-name">Shape3</span> <span class="token operator">=</span> Circle3 <span class="token operator">|</span> Square3 <span class="token operator">|</span> Triangle3<span class="token comment">// ä½¿ç”¨ç±»å‹ç¼©å°</span><span class="token keyword">function</span> <span class="token function">getArea3</span><span class="token punctuation">(</span>shape<span class="token operator">:</span> Shape3<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">switch</span><span class="token punctuation">(</span>shape<span class="token punctuation">.</span>kind<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">case</span> <span class="token string">'circle'</span><span class="token operator">:</span>            <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>shape<span class="token punctuation">.</span>radius<span class="token punctuation">)</span>            <span class="token keyword">return</span> shape<span class="token punctuation">.</span>radius        <span class="token keyword">case</span> <span class="token string">'square'</span><span class="token operator">:</span>        <span class="token keyword">case</span> <span class="token string">'triangle'</span><span class="token operator">:</span>            <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>shape<span class="token punctuation">.</span>length<span class="token punctuation">)</span>            <span class="token keyword">return</span> shape<span class="token punctuation">.</span>length        <span class="token comment">// ç©·å°½æ€§æ£€æŸ¥</span>        <span class="token keyword">default</span><span class="token operator">:</span>            <span class="token keyword">const</span> _exhaustiveCheck<span class="token operator">:</span> <span class="token builtin">never</span> <span class="token operator">=</span> shape            <span class="token keyword">return</span> _exhaustiveCheck    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ­¤å¤– never è¿˜èƒ½è¡¨ç¤ºæ°¸è¿œä¸ä¼šè¿”å›ç»“æœçš„æƒ…å†µ(ç”¨äºæŠ¥é”™çš„å‡½æ•°) äº†è§£å³å¯</p><pre class="line-numbers language-ts" data-language="ts"><code class="language-ts"><span class="token keyword">function</span> <span class="token function">fn2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">never</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">"Wrong Input..."</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h2 id="æšä¸¾ç±»å‹"><a class="markdownIt-Anchor" href="#æšä¸¾ç±»å‹"></a> æšä¸¾ç±»å‹</h2><p>TypeScript ä¸º JS é¢å¤–æä¾›çš„è¯­æ³•, ç›®æ ‡å±æ€§çš„å–å€¼å¯ä»¥ç¦»æ•£ç´¢å¼•</p><pre class="line-numbers language-ts" data-language="ts"><code class="language-ts"><span class="token comment">// Definition</span><span class="token keyword">enum</span> Direction <span class="token punctuation">&#123;</span>    Up <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span>    Down<span class="token punctuation">,</span> <span class="token comment">// default 2 - æšä¸¾ä¼šè‡ªåŠ¨æå‡</span>    Left<span class="token punctuation">,</span>    Right<span class="token punctuation">&#125;</span><span class="token comment">// Assess</span><span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Direction<span class="token punctuation">.</span>Up<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä¸ JS ä»£ç å¯¹æ¯”ä¸€ä¸‹ï¼š</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// Definition</span><span class="token keyword">var</span> Direction<span class="token punctuation">;</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">Direction</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    Direction<span class="token punctuation">[</span>Direction<span class="token punctuation">[</span><span class="token string">"Up"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"Up"</span><span class="token punctuation">;</span>    Direction<span class="token punctuation">[</span>Direction<span class="token punctuation">[</span><span class="token string">"Down"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"Down"</span><span class="token punctuation">;</span>    Direction<span class="token punctuation">[</span>Direction<span class="token punctuation">[</span><span class="token string">"Left"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"Left"</span><span class="token punctuation">;</span>    Direction<span class="token punctuation">[</span>Direction<span class="token punctuation">[</span><span class="token string">"Right"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"Right"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">(</span>Direction <span class="token operator">||</span> <span class="token punctuation">(</span>Direction <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// Assess</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Direction<span class="token punctuation">.</span>Up<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="è”åˆç±»å‹"><a class="markdownIt-Anchor" href="#è”åˆç±»å‹"></a> è”åˆç±»å‹</h1><p><code>|</code> è¡¨ç¤ºå¯èƒ½æ˜¯ç›®æ ‡ç±»å‹é›†ä¸­çš„ä»»æ„ä¸€ç§ç±»å‹</p><pre class="line-numbers language-ts" data-language="ts"><code class="language-ts"><span class="token keyword">function</span> <span class="token function">printId</span><span class="token punctuation">(</span>id<span class="token operator">:</span> <span class="token builtin">number</span> <span class="token operator">|</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> id <span class="token operator">===</span> <span class="token string">'string'</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>id<span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>        <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å› ä¸ºä¼ å…¥çš„å€¼å¯èƒ½æ˜¯ä¼—å¤šç±»å‹çš„ä¸€ç§, å› æ­¤éœ€è¦è¿›è¡Œç±»å‹åˆ¤æ–­:</p><ul><li>åˆ¤æ–­æ˜¯å¦ä¸ºåŸºæœ¬ç±»å‹: <code>typeof value === 'string'</code> OR <code>number</code> OR <code>boolean</code></li><li>åˆ¤æ–­æ˜¯å¦ä¸ºæ•°ç»„: <code>Array.isArray(value)</code></li></ul><p><code>&amp;</code> åˆ™æ˜¯è¡¨æ˜è¦åŒæ—¶æ»¡è¶³ä¸¤ä¸ªç±»å‹çš„çº¦æŸ, é€šå¸¸ç”¨äºåˆå¹¶ä¸¤ä¸ªå¯¹è±¡çš„çº¦æŸ</p><pre class="line-numbers language-ts" data-language="ts"><code class="language-ts"><span class="token keyword">let</span> j<span class="token operator">:</span> <span class="token punctuation">&#123;</span> name<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">&#125;</span> <span class="token operator">&amp;</span> <span class="token punctuation">&#123;</span> age<span class="token operator">:</span> <span class="token builtin">number</span> <span class="token punctuation">&#125;</span>j <span class="token operator">=</span> <span class="token punctuation">&#123;</span>name<span class="token operator">:</span> <span class="token string">'coming'</span><span class="token punctuation">,</span> age<span class="token operator">:</span> <span class="token number">23</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h1 id="ç±»å‹å—é™"><a class="markdownIt-Anchor" href="#ç±»å‹å—é™"></a> ç±»å‹å—é™</h1><p>å½“å‚æ•°æ˜¯è”åˆç±»å‹æ—¶, æœ‰äº›é€»è¾‘éœ€è¦é…åˆç±»å‹ç¼©å°å®ç°è¿›ä¸€æ­¥çš„ç±»å‹ç»†åŒ–ä¸æ£€æŸ¥:</p><pre class="line-numbers language-ts" data-language="ts"><code class="language-ts"><span class="token keyword">interface</span> <span class="token class-name">Circle</span> <span class="token punctuation">&#123;</span>    kind<span class="token operator">:</span> <span class="token string">'circle'</span><span class="token punctuation">,</span>    radius<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">&#125;</span><span class="token keyword">interface</span> <span class="token class-name">Square</span> <span class="token punctuation">&#123;</span>    kind<span class="token operator">:</span> <span class="token string">'square'</span><span class="token punctuation">,</span>    length<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">&#125;</span><span class="token keyword">type</span> <span class="token class-name">Shape2</span> <span class="token operator">=</span> Circle <span class="token operator">|</span> Square<span class="token comment">// ä½¿ç”¨ç±»å‹ç¼©å°</span><span class="token keyword">function</span> <span class="token function">getArea</span><span class="token punctuation">(</span>shape<span class="token operator">:</span> Shape2<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>shape<span class="token punctuation">.</span>kind <span class="token operator">===</span> <span class="token string">'circle'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>shape<span class="token punctuation">.</span>radius<span class="token punctuation">)</span>        <span class="token keyword">return</span> shape<span class="token punctuation">.</span>radius    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>        <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>shape<span class="token punctuation">.</span>length<span class="token punctuation">)</span>        <span class="token keyword">return</span> shape<span class="token punctuation">.</span>length    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="type-ç±»å‹åˆ«å"><a class="markdownIt-Anchor" href="#type-ç±»å‹åˆ«å"></a> type ç±»å‹åˆ«å</h1><p>å¤§å‹é¡¹ç›®ä¸­å¯ä»¥å°†å¸¸ç”¨çš„ç±»å‹é›†åˆé¢„å®šä¹‰ä¸ºæŸä¸ªç±»å‹åˆ«å(é€šå¸¸é¦–å­—æ¯å¤§å†™)</p><pre class="line-numbers language-ts" data-language="ts"><code class="language-ts"><span class="token keyword">type</span> <span class="token class-name">Point</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span>    x<span class="token operator">:</span> Number<span class="token punctuation">;</span>    y<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">type</span> <span class="token class-name"><span class="token constant">ID</span></span> <span class="token operator">=</span> <span class="token builtin">number</span> <span class="token operator">|</span> <span class="token builtin">string</span><span class="token keyword">function</span> <span class="token function">printCoord2</span><span class="token punctuation">(</span>pt<span class="token operator">:</span> Point<span class="token punctuation">,</span> id<span class="token operator">?</span><span class="token operator">:</span> <span class="token constant">ID</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">X: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>pt<span class="token punctuation">.</span>x<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">; Y: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>pt<span class="token punctuation">.</span>y<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä¹Ÿæ”¯æŒæ‰©å±•, ä½¿ç”¨ç¬¦å· <code>&amp;</code> å®ç°ç»§æ‰¿çš„æ„æ€</p><pre class="line-numbers language-ts" data-language="ts"><code class="language-ts"><span class="token keyword">type</span> <span class="token class-name">Animal</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span>    name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">&#125;</span><span class="token keyword">type</span> <span class="token class-name">Bear</span> <span class="token operator">=</span> Animal <span class="token operator">&amp;</span> <span class="token punctuation">&#123;</span>    honey<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="æ¥å£"><a class="markdownIt-Anchor" href="#æ¥å£"></a> æ¥å£</h1><p>ç”¨æ¥å®šä¹‰ä¸€ä¸ªç±»çš„ç»“æ„, æŒ‡æ˜ä¸€ä¸ªç±»ä¸­åº”è¯¥åŒ…å«å“ªäº›å±æ€§å’Œæ–¹æ³•; ä¹Ÿå¯ä»¥å½“æˆç±»å‹å£°æ˜å»ä½¿ç”¨</p><ul><li>å°†ç±»å‹å°è£…ä¸ºç»“æ„, æ›´åŠ å·¥ç¨‹åŒ–</li></ul><pre class="line-numbers language-ts" data-language="ts"><code class="language-ts"><span class="token keyword">interface</span> <span class="token class-name">Point3</span> <span class="token punctuation">&#123;</span>    x<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span>    y<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function">printCoord3</span><span class="token punctuation">(</span>pt<span class="token operator">:</span> Point<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">X: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>pt<span class="token punctuation">.</span>x<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">; Y: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>pt<span class="token punctuation">.</span>y<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¹¶ä¸”æ”¯æŒå¤šç§ç±»å‹çš„ç»§æ‰¿, æ›´é€‚åˆå®Œæ•´ä¼˜é›…çš„å·¥ç¨‹</p><pre class="line-numbers language-ts" data-language="ts"><code class="language-ts"><span class="token keyword">interface</span> <span class="token class-name">Animal</span> <span class="token punctuation">&#123;</span>    name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">&#125;</span><span class="token keyword">interface</span> <span class="token class-name">Bear</span> <span class="token keyword">extends</span> <span class="token class-name">Animal</span> <span class="token punctuation">&#123;</span>    honey<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">&#125;</span><span class="token keyword">const</span> teedyBear<span class="token operator">:</span> Bear <span class="token operator">=</span> <span class="token punctuation">&#123;</span>    name<span class="token operator">:</span> <span class="token string">'Teedy'</span><span class="token punctuation">,</span>    honey<span class="token operator">:</span> <span class="token number">100</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="æ·»åŠ æ–°çš„å­—æ®µ"><a class="markdownIt-Anchor" href="#æ·»åŠ æ–°çš„å­—æ®µ"></a> æ·»åŠ æ–°çš„å­—æ®µ</h2><p>åŒåçš„æ¥å£ä¸ä¼šè¦†ç›–, è€Œæ˜¯ä¼šåˆå¹¶</p><blockquote><p>type ä¸æ”¯æŒé‡å¤å®šä¹‰è¿›è¡Œç±»å‹åˆå¹¶</p></blockquote><pre class="line-numbers language-ts" data-language="ts"><code class="language-ts"><span class="token keyword">interface</span> <span class="token class-name">JCWindow</span> <span class="token punctuation">&#123;</span>    count<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">&#125;</span><span class="token keyword">interface</span> <span class="token class-name">JCWindow</span> <span class="token punctuation">&#123;</span>    title<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">&#125;</span><span class="token keyword">const</span> myWindow<span class="token operator">:</span> JCWindow <span class="token operator">=</span> <span class="token punctuation">&#123;</span>    count<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>    title<span class="token operator">:</span> <span class="token string">"JCWindow"</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="ç±»å‹æ–­è¨€"><a class="markdownIt-Anchor" href="#ç±»å‹æ–­è¨€"></a> ç±»å‹æ–­è¨€</h1><p>ç±»å‹æ–­è¨€: é’ˆå¯¹å†…ç½®çš„ JS è¯­æ³•è·å–å¯¹è±¡æ—¶, æŒ‡å®šå¯¹è±¡çš„ç±»å‹</p><p>ä¸»è¦æ˜¯ä¸ºäº†é€šè¿‡ç±»å‹æ£€æŸ¥, å¦‚æœæŒ‰ç…§ä½ çš„é€»è¾‘æ­¤å¤„çš„å˜é‡ç±»å‹ä¸€å®šèƒ½èµ°çš„é€š, å¯ä»¥ç”¨ as è¿›è¡Œç±»å‹æ–­è¨€</p><pre class="line-numbers language-ts" data-language="ts"><code class="language-ts"><span class="token keyword">const</span> myCanvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"main_canvas"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> HTMLCanvasElement <span class="token comment">// Method 1</span><span class="token keyword">const</span> myCanvas <span class="token operator">=</span> <span class="token operator">&lt;</span>HTMLCanvasElement<span class="token operator">></span>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"main_canvas"</span><span class="token punctuation">)</span> <span class="token comment">// Method 2</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h1 id="åŸè¯­"><a class="markdownIt-Anchor" href="#åŸè¯­"></a> åŸè¯­</h1><p>ä¸å¸¸ç”¨, äº†è§£å³å¯</p><ul><li><code>bigint</code>: è¡¨ç¤ºéå¸¸å¤§çš„æ•´æ•°, å¯¹åº” ES2020 ä»¥åå¼•å…¥çš„ <code>BigInt</code></li><li><code>symbol</code>: ç”¨äºå®šä¹‰å…¨å±€å”¯ä¸€çš„å¼•ç”¨</li></ul><pre class="line-numbers language-ts" data-language="ts"><code class="language-ts"><span class="token keyword">const</span> oneHundred<span class="token operator">:</span> bigint <span class="token operator">=</span> <span class="token function">BigInt</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token keyword">const</span> anotherHundred<span class="token operator">:</span> bigint <span class="token operator">=</span> <span class="token number">100n</span><span class="token comment">// è™½ç„¶éƒ½æ˜¯ç¬¦å· name, ä½†æ˜¯ä»–ä»¬çš„å€¼æ˜¯å®Œå…¨ä¸ä¸€æ ·çš„</span><span class="token keyword">const</span> firstName <span class="token operator">=</span> <span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">)</span><span class="token keyword">const</span> lastName <span class="token operator">=</span> <span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">)</span><span class="token comment">// å§‹ç»ˆè¿”å› false</span><span class="token keyword">if</span> <span class="token punctuation">(</span>firstName <span class="token operator">===</span> lastName<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"Equal"</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="å±æ€§çš„å°è£…"><a class="markdownIt-Anchor" href="#å±æ€§çš„å°è£…"></a> å±æ€§çš„å°è£…</h1><p>å±æ€§æ˜¯åœ¨å¯¹è±¡ä¸­è®¾ç½®çš„, ä½†æ˜¯åœ¨å¤–éƒ¨å±æ€§å¯ä»¥è¢«ä»»æ„ä¿®æ”¹, å› æ­¤ TS å¼•å…¥äº†å±æ€§ä¿®é¥°ç¬¦: public ä¸ private protected</p><ul><li>private è¡¨ç¤ºç§æœ‰å±æ€§, åªèƒ½åœ¨ç±»å†…éƒ¨è¿›è¡Œä¿®æ”¹ï¼ˆä¸èƒ½ç»§æ‰¿ï¼‰</li><li>protected å—ä¿æŠ¤çš„å±æ€§, åªèƒ½åœ¨å½“å‰ç±»å’Œå­ç±»ä¸­è®¿é—®ä¸ä¿®æ”¹ï¼ˆèƒ½å¤Ÿç»§æ‰¿ï¼‰</li></ul><p>ES6 å¼•å…¥äº†æ›´æ–¹ä¾¿çš„ getter ä¸ setter æœºåˆ¶</p><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">get</span> <span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>propName<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">set</span> <span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token operator">...</span><span class="token punctuation">&#125;</span>person<span class="token punctuation">.</span>name <span class="token comment">// å¯¹åº”çš„å°±æ˜¯ get ä¿®é¥°çš„ name()</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> TypeScript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> typescript-basic </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>01-TSçš„åŸºæœ¬é…ç½®ä¸ä½¿ç”¨</title>
      <link href="/Coming-blog/2022/07/03/01-ts-de-ji-ben-pei-zhi-yu-shi-yong/"/>
      <url>/Coming-blog/2022/07/03/01-ts-de-ji-ben-pei-zhi-yu-shi-yong/</url>
      
        <content type="html"><![CDATA[<h1 id="typescript"><a class="markdownIt-Anchor" href="#typescript"></a> TypeScript</h1><p>Backdropï¼šJS æ²¡æœ‰è¡¨è¾¾ä¸åŒä»£ç å•å…ƒä¹‹é—´å…³ç³»çš„èƒ½åŠ›ï¼Œå› æ­¤å¼•ç”³å‡ºæ¥ TS, ç›®æ ‡æ˜¯æˆä¸º JS çš„é™æ€ç±»å‹æ£€æŸ¥å™¨</p><ul><li>ä»¥ Javascript ä¸ºåŸºç¡€æ„å»ºçš„è¯­è¨€</li><li>Javascript çš„è¶…é›†</li><li>å¯ä»¥åœ¨ä»»ä½•æ”¯æŒ Javascript çš„å¹³å°ä¸­æ‰§è¡Œ(ä¸ä»£è¡¨èƒ½è¢« JS è§£æå™¨ç›´æ¥æ‰§è¡Œ, .ts -&gt; .js -&gt; æµè§ˆå™¨æ‰§è¡Œ)</li><li>Typescript æ‰©å±•äº† Javascript å¹¶æ·»åŠ äº†ç±»å‹</li></ul><h2 id="jsests"><a class="markdownIt-Anchor" href="#jsests"></a> JS\ES\TS</h2><ul><li>JS, JavaScript</li><li>ES, ECMAScript, ä¸º JS åˆ¶å®šæ ‡å‡†, ä¸€å¹´ä¸€ä¸ªæ–°ç‰ˆæœ¬</li><li>TS, TypeScript</li></ul><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/202206222129869.png" alt="" /></p><h2 id="åŒç±»ç«å“"><a class="markdownIt-Anchor" href="#åŒç±»ç«å“"></a> åŒç±»ç«å“</h2><ul><li>ESLint, TSLint</li><li>CoffeeScript, Flow</li></ul><ol><li>TypeScript çš„å®šä½æ˜¯é™æ€ç±»å‹è¯­è¨€ï¼Œåœ¨<strong>å†™ä»£ç é˜¶æ®µå°±èƒ½æ£€æŸ¥é”™è¯¯</strong>ï¼Œè€Œéè¿è¡Œé˜¶æ®µ(è¾¹è§£æè¾¹æ‰§è¡Œ)</li><li>ç±»å‹ç³»ç»Ÿæ˜¯æœ€å¥½çš„æ–‡æ¡£ï¼Œå¢åŠ äº†ä»£ç çš„<strong>å¯è¯»æ€§</strong>å’Œå¯ç»´æŠ¤æ€§</li><li>æœ‰ä¸€å®šçš„å­¦ä¹ æˆæœ¬ï¼Œéœ€è¦ç†è§£æ¥å£(Interfaces)ã€æ³›å‹(Generics)ã€ç±»(Classes)ç­‰</li><li>ts æœ€åè¢«ç¼–è¯‘æˆ js</li></ol><h1 id="ä¸ºä»€ä¹ˆéœ€è¦-typescript"><a class="markdownIt-Anchor" href="#ä¸ºä»€ä¹ˆéœ€è¦-typescript"></a> ä¸ºä»€ä¹ˆéœ€è¦ TypeScript</h1><ol><li>JS åªæ”¯æŒåŠ¨æ€ç±»å‹ï¼šç¼–å†™ JS ä»£ç æ—¶é€šå¸¸éœ€è¦çŸ¥é“å˜é‡æˆ–å¯¹è±¡çš„æ‰€æœ‰ç»†èŠ‚ï¼ˆæ‹¥æœ‰çš„å‡½æ•°ï¼Œæ˜¯å¦å¯è°ƒç”¨ï¼‰</li><li>é™æ€ç±»å‹æ£€æŸ¥ï¼šåœ¨ä»£ç æ‰§è¡Œå‰å°±èƒ½æ£€æŸ¥ä»£ç æ˜¯å¦æœ‰é—®é¢˜</li><li>é€»è¾‘é”™è¯¯æ£€æŸ¥ï¼š</li></ol><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/202206282010687.png" alt="" /></p><h1 id="quick-start"><a class="markdownIt-Anchor" href="#quick-start"></a> Quick Start</h1><p>å…¨å±€ç¯å¢ƒé…ç½®ï¼š</p><ul><li><code>npm install -g typescript</code></li></ul><p>è„šæ‰‹æ¶ä¸­ä½¿ç”¨</p><ul><li><code>create-react-app my-app --template typescript</code></li></ul><h2 id="ç¼–è¯‘æ‰§è¡Œ"><a class="markdownIt-Anchor" href="#ç¼–è¯‘æ‰§è¡Œ"></a> ç¼–è¯‘æ‰§è¡Œ</h2><ol><li>å‘½ä»¤è¡Œä¸­é€šè¿‡ <code>tsc</code> å°†ç›®æ ‡ <code>ts</code> æ–‡ä»¶ç¼–è¯‘ä¸º <code>js</code> æ–‡ä»¶: <code>tsc 01-hello.ts</code> -&gt; <code>01-hello.js</code></li><li>é€šè¿‡ <code>node</code> å‘½ä»¤å³å¯æ‰§è¡Œç›®æ ‡ <code>js</code> æ–‡ä»¶: <code>node 01-hello.js</code></li></ol><h1 id="é…ç½®ä¸ä½¿ç”¨"><a class="markdownIt-Anchor" href="#é…ç½®ä¸ä½¿ç”¨"></a> é…ç½®ä¸ä½¿ç”¨</h1><h2 id="tsconfigjson"><a class="markdownIt-Anchor" href="#tsconfigjson"></a> tsconfig.json</h2><p>è¾“å…¥å‘½ä»¤ <code>tsc --init</code> -å³å¯ç”Ÿæˆ-&gt; <code>tsconfig.json</code></p><ul><li>è§£å†³ TS ä¸ JS çš„å†²çªï¼šæ³¨é‡Šæ‰ <code>strict</code> å³å¯å…³é—­ä¸¥æ ¼æ¨¡å¼ï¼Œä½†ä¸æ¨èä½¿ç”¨ï¼Œæ¨èæ‰‹åŠ¨é¿å…å†²çª</li><li>é™çº§ç¼–è¯‘ï¼šä¸ºäº†æ›´å¥½çš„å…¼å®¹, åœ¨ <code>tsconfig.json</code> ä¸­å¯ä»¥é€šè¿‡ <code>target:</code> æ¥æŒ‡å®šæƒ³è¦ç¼–è¯‘å‡ºçš„ <code>ES</code> ç‰ˆæœ¬</li><li>ä¸¥æ ¼ç¨‹åº¦æ§åˆ¶ï¼šå»ºè®®æ£€æŸ¥å…¨éƒ¨å¼€å¯: å¦åˆ™è¿˜ä¸å¦‚ç›´æ¥ç”¨ JavaScript<ul><li><code>strict: true</code>: å¼€å¯ç±»å‹æ£€æŸ¥</li><li><code>noImplicitAny: true</code>: æ›´åŠ ä¸¥æ ¼, ç¦ç”¨ any ç±»å‹</li><li><code>strictNullChecks: true</code>:</li></ul></li></ul><h3 id="ç¼–è¯‘é…ç½®"><a class="markdownIt-Anchor" href="#ç¼–è¯‘é…ç½®"></a> ç¼–è¯‘é…ç½®</h3><ul><li>include: æ•°ç»„, é‡Œé¢å­˜æ”¾è¦è¿›è¡Œç¼–è¯‘çš„ ts æ–‡ä»¶, æ”¯æŒ ** è¡¨ç¤ºä»»æ„æ–‡ä»¶å¤¹, * è¡¨ç¤ºä»»æ„æ–‡ä»¶</li><li>exclude: æ•°ç»„, é‡Œé¢å­˜æ”¾ä¸éœ€è¦è¿›è¡Œç¼–è¯‘çš„ ts æ–‡ä»¶, é€šå¸¸ä¸ºé»˜è®¤å€¼å³å¯</li><li>files: æ•°ç»„, æŒ‡å®šéœ€è¦ç¼–è¯‘çš„æ–‡ä»¶</li></ul><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token punctuation">&#123;</span>  <span class="token string">"include"</span><span class="token operator">:</span> <span class="token punctuation">[</span>    <span class="token string">"./src/**/*"</span>  <span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token string">"exclude"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token string">"files"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="ç¼–è¯‘å™¨é…ç½®"><a class="markdownIt-Anchor" href="#ç¼–è¯‘å™¨é…ç½®"></a> ç¼–è¯‘å™¨é…ç½®</h3><p>compilerOptionsï¼š</p><ul><li>target: è®¾ç½® ts ä»£ç ç¼–è¯‘çš„ç›®æ ‡ç‰ˆæœ¬: <code>ES3, ES5, ES6(ES2015), ES7(ES2016), ES2017, ES2018, ES2019, ES2020, ESNext</code><ul><li>ESNext è¡¨ç¤ºæœ€æ–°ç‰ˆæœ¬</li></ul></li><li>lib: æŒ‡å®šä»£ç è¿è¡Œæ—¶æ‰€åŒ…å«çš„åº“(å®¿ä¸»ç¯å¢ƒ): <code>DOM, WebWorker, ScriptHost, ES3, ES5, ES6(ES2015), ES7(ES2016), ES2017, ES2018, ES2019, ES2020, ESNext, ...</code></li><li>module: è®¾ç½®ç¼–è¯‘åä»£ç ä½¿ç”¨çš„æ¨¡å—åŒ–ç³»ç»Ÿ: <code>CommonJS, UMD, AMD, System, ES2020, ESNext, None</code></li><li>outDir: ç¼–è¯‘åç”Ÿæˆçš„ js æ–‡ä»¶æ‰€åœ¨çš„ç›®å½•, é»˜è®¤ä¼šåœ¨åŒä¸€ç›®å½•</li><li>outFile: å°†æ‰€æœ‰ ts æ–‡ä»¶åˆå¹¶ç”Ÿæˆä¸ºä¸€ä¸ª js æ–‡ä»¶</li><li>allowJS: æ˜¯å¦å¯¹ js æ–‡ä»¶è¿›è¡Œç¼–è¯‘ç”Ÿæˆåˆ° outDir, é»˜è®¤ä¸º false</li><li>checkJs: æ˜¯å¦å¯¹ js ä»£ç è¿›è¡Œè¯­æ³•è§„èŒƒæ£€æŸ¥ï¼ˆåƒ TS ä¸€æ ·æ£€æŸ¥ï¼‰, é»˜è®¤ä¸º false</li><li><strong>removeComments</strong>: ç¼–è¯‘åæ˜¯å¦ç§»é™¤æ³¨é‡Š</li><li>noEmit: ä¸ç”Ÿäº§ç¼–è¯‘åçš„æ–‡ä»¶</li><li>noEmitOnError: å½“æœ‰é”™è¯¯æ—¶ä¸ç”Ÿæˆç¼–è¯‘é”™è¯¯çš„æ–‡ä»¶</li><li>alwaysStrict: è®¾ç½®ç¼–è¯‘åçš„æ–‡ä»¶æ˜¯å¦ä½¿ç”¨ä¸¥æ ¼æ¨¡å¼</li><li>noImplicitAny: ä¸æŒ‡å®šç±»å‹æ—¶é»˜è®¤å…¶ç±»å‹ä¸º any ï¼ˆéšå¼ï¼‰</li><li>noImplicitThis: ä¸å…è®¸ä¸æ˜ç¡®ç±»å‹çš„ this</li><li>strictNullChecks: ä¸¥æ ¼çš„æ£€æŸ¥ç©ºå€¼, æ¯”å¦‚æ ¹æ® id è·å–ç›®æ ‡ç»„ä»¶å¯¹è±¡, å¯èƒ½è¿”å›çš„æ˜¯ null</li><li>strict: æ‰€æœ‰ä¸¥æ ¼æ£€æŸ¥çš„æ€»å¼€å…³, å¦‚æœæ˜¯ true åˆ™å¼€å¯æœ€é«˜çš„ä¸¥æ ¼æ£€æŸ¥, æ¨èæ‰“å¼€</li></ul><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">let</span> box1 <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"box1"</span><span class="token punctuation">)</span>box1<span class="token operator">?.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"BOX"</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token punctuation">&#123;</span>  <span class="token string">"compilerOptions"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>    <span class="token string">"target"</span><span class="token operator">:</span> <span class="token string">"ES6"</span><span class="token punctuation">,</span>    <span class="token string">"lib"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"DOM"</span><span class="token punctuation">,</span> <span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token string">"module"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"es2015"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token string">"outDir"</span><span class="token operator">:</span> <span class="token string">"./dist"</span><span class="token punctuation">,</span>    <span class="token string">"outFile"</span><span class="token operator">:</span> <span class="token string">"./app.js"</span><span class="token punctuation">,</span>    <span class="token string">"allowJs"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>    <span class="token string">"checkJs"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="è‡ªåŠ¨ç¼–è¯‘ä¸ç¦æ­¢é”™è¯¯æ›´æ–°"><a class="markdownIt-Anchor" href="#è‡ªåŠ¨ç¼–è¯‘ä¸ç¦æ­¢é”™è¯¯æ›´æ–°"></a> è‡ªåŠ¨ç¼–è¯‘ä¸ç¦æ­¢é”™è¯¯æ›´æ–°</h2><ul><li>å¼€å¯è‡ªåŠ¨ç¼–è¯‘ï¼š<code>tsc --watch</code>ï¼Œå°†æ£€æŸ¥ <code>rootDir</code> ä¸­ <code>.ts</code> æ–‡ä»¶çš„æ›´æ”¹ï¼Œå¹¶è‡ªåŠ¨å¯¹å…¶è¿›è¡Œç¼–è¯‘</li><li>ç¦æ­¢é”™è¯¯æ›´æ–°ï¼š<code>tsc -noEmitOnError hello.ts</code> å¦‚æœç›®æ ‡ TS æ–‡ä»¶ä¸­å­˜åœ¨é”™è¯¯ï¼Œåˆ™ä¸ä¼šç”Ÿæˆæˆ–æ›¿æ¢ç°æœ‰çš„ <code>hello.js</code> æ–‡ä»¶</li><li>ç»“åˆä½¿ç”¨ï¼š<code>tsc --noEmitOnError --watch</code></li></ul>]]></content>
      
      
      <categories>
          
          <category> TypeScript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> typescript-basic </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>PubSub</title>
      <link href="/Coming-blog/2022/02/06/pubsub/"/>
      <url>/Coming-blog/2022/02/06/pubsub/</url>
      
        <content type="html"><![CDATA[<h1 id="æ¶ˆæ¯è®¢é˜…ä¸å‘å¸ƒæŠ€æœ¯"><a class="markdownIt-Anchor" href="#æ¶ˆæ¯è®¢é˜…ä¸å‘å¸ƒæŠ€æœ¯"></a> æ¶ˆæ¯è®¢é˜…ä¸å‘å¸ƒæŠ€æœ¯</h1><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">yarn add pubsub-jsimport PubSub from &#39;pubsub-js&#39;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>ä¸å¿…å°†ä¿¡æ¯ä¸€çº§ä¸€çº§çš„ä¼ é€’ä¸‹å»ï¼Œå¯ä»¥å®ç°ä»»ä¸€ç»„ä»¶ä¹‹é—´é€šä¿¡</p><p>1ã€App ä½œä¸ºé¡¶çº§ å£³ï¼Œä¸åº”è¯¥è¿‡å¤šçš„æ¶‰åŠç®¡ç†å­ç»„ä»¶ä¹‹é—´çš„çŠ¶æ€å˜åŒ–ä¸é€šä¿¡é—®é¢˜ï¼Œå› æ­¤ä½¿ç”¨æ¶ˆæ¯è®¢é˜…ä¸å‘å¸ƒæŠ€æœ¯å®ç°å­ç»„ä»¶ä¹‹é—´çš„è‡ªå‘é€šä¿¡</p><p>Qï¼šå®ç°æ¶ˆæ¯è®¢é˜…ä¸å‘å¸ƒçš„åº“å¾ˆå¤šï¼Œä½ è¦é€‰æ‹©å“ªä¸ªï¼Ÿ</p><p>Aï¼šPubSubï¼Œå†å²æ‚ ä¹…ï¼Œåº”ç”¨å¹¿æ³›</p><h2 id="ä½•æ—¶è®¢é˜…"><a class="markdownIt-Anchor" href="#ä½•æ—¶è®¢é˜…"></a> ä½•æ—¶è®¢é˜…</h2><p>Aï¼šåœ¨ç»„ä»¶åˆšæŒ‚è½½ä¸Šå°±è¦å®Œæˆæ‰€æœ‰çš„è®¢é˜…ï¼Œä¸€æ¬¡æ€§å®šä¹‰å®Œæˆè¯¥ç»„ä»¶æ‰€æ¥æ”¶çš„æ‰€æœ‰æ¶ˆæ¯ç±»å‹ã€‚</p><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx"><span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>updateHeaderData <span class="token operator">=</span> PubSub<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token string">'updateHeaderData'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">msgName<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="å¦‚ä½•å‘é€æ¶ˆæ¯"><a class="markdownIt-Anchor" href="#å¦‚ä½•å‘é€æ¶ˆæ¯"></a> å¦‚ä½•å‘é€æ¶ˆæ¯</h2><p>Aï¼šå¼•å…¥ <code>PubSub</code> åè°ƒç”¨å…¶ <code>publish</code> æ–¹æ³•</p><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx">PubSub<span class="token punctuation">.</span><span class="token function">publish</span><span class="token punctuation">(</span><span class="token string">'updateHeaderData'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>data<span class="token operator">:</span> activeName<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="å¦‚ä½•å–æ¶ˆè®¢é˜…"><a class="markdownIt-Anchor" href="#å¦‚ä½•å–æ¶ˆè®¢é˜…"></a> å¦‚ä½•å–æ¶ˆè®¢é˜…</h2><p>Aï¼šå¼•å…¥ <code>PubSub</code> åè°ƒç”¨å…¶ <code>unsubscribe</code> æ–¹æ³•ï¼Œä¸€èˆ¬å†ç»„ä»¶å¸è½½æ—¶è°ƒç”¨</p><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx"><span class="token function">componentWillUnmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// å–æ¶ˆè®¢é˜…</span>    PubSub<span class="token punctuation">.</span><span class="token function">unsubscribe</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>updateHeaderData<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> React </category>
          
      </categories>
      
      
        <tags>
            
            <tag> react </tag>
            
            <tag> react tools </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>UDP and UDP Protocol</title>
      <link href="/Coming-blog/2021/12/06/udp-and-udp-protocol/"/>
      <url>/Coming-blog/2021/12/06/udp-and-udp-protocol/</url>
      
        <content type="html"><![CDATA[<h1 id="ä¼ è¾“å±‚"><a class="markdownIt-Anchor" href="#ä¼ è¾“å±‚"></a> ä¼ è¾“å±‚</h1><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20211122204641955.png" alt="image-20211122204641955" /></p><p>Transport Layerï¼Œä»é€šä¿¡å’Œä¿¡æ¯å¤„ç†çš„è§’åº¦çœ‹ï¼Œä¼ è¾“å±‚å‘å®ƒä¸Šé¢çš„åº”ç”¨å±‚æä¾›é€šä¿¡æœåŠ¡ï¼Œå®ƒå±äºé¢å‘é€šä¿¡éƒ¨åˆ†çš„æœ€é«˜å±‚ï¼ŒåŒæ—¶ä¹Ÿæ˜¯ç”¨æˆ·åŠŸèƒ½ä¸­çš„æœ€ä½å±‚ï¼›</p><h2 id="åŸºç¡€æ¦‚å¿µ"><a class="markdownIt-Anchor" href="#åŸºç¡€æ¦‚å¿µ"></a> åŸºç¡€æ¦‚å¿µ</h2><h3 id="udp"><a class="markdownIt-Anchor" href="#udp"></a> UDP</h3><p>UDPï¼šç”¨æˆ·æ•°æ®æŠ¥åè®®ï¼ˆUser Datagram Protocolï¼‰ï¼Œä¸éœ€å»ºç«‹è¿æ¥ï¼Œæä¾›ä¸å¯é äº¤äº’ï¼Œæ•ˆç‡é«˜</p><h3 id="tcp"><a class="markdownIt-Anchor" href="#tcp"></a> TCP</h3><p>TCPï¼šä¼ è¾“æ§åˆ¶åè®®ï¼ˆTransmission Control Protocolï¼‰ï¼Œéœ€å»ºç«‹è¿æ¥ï¼Œæä¾›å¯é äº¤äº’ï¼Œæ•ˆç‡è¾ƒä½</p><h3 id="ä¼ è¾“åè®®æ•°æ®å•å…ƒ"><a class="markdownIt-Anchor" href="#ä¼ è¾“åè®®æ•°æ®å•å…ƒ"></a> ä¼ è¾“åè®®æ•°æ®å•å…ƒ</h3><p>ä¼ è¾“åè®®æ•°æ®å•å…ƒï¼ŒTPDU (Transport Protocol Data Unit)ï¼Œä¸¤ä¸ªå¯¹ç­‰ä¼ è¾“å®ä½“åœ¨é€šä¿¡æ—¶ä¼ é€çš„æ•°æ®å•ä½ï¼ŒUDP æŠ¥æ–‡æˆ–ç”¨æˆ·æ•°æ®æŠ¥ VS TCP æŠ¥æ–‡æ®µï¼ˆsegmentï¼‰</p><h3 id="ç«¯å£"><a class="markdownIt-Anchor" href="#ç«¯å£"></a> ç«¯å£</h3><p>ç«¯å£ï¼šè¿è¾“å±‚æœåŠ¡è®¿é—®ç‚¹ TSAPï¼Œè®©åº”ç”¨å±‚çš„å„ç§åº”ç”¨è¿›ç¨‹éƒ½èƒ½å°†å…¶æ•°æ®é€šè¿‡ç«¯å£å‘ä¸‹äº¤ä»˜ç»™ä¼ è¾“å±‚ï¼Œä»¥åŠè®©ä¼ è¾“å±‚çŸ¥é“åº”å½“å°†å…¶æŠ¥æ–‡æ®µä¸­çš„æ•°æ®å‘ä¸Šé€šè¿‡ç«¯å£äº¤ä»˜ç»™åº”ç”¨å±‚ç›¸åº”çš„è¿›ç¨‹</p><blockquote><p>å¯ä»¥å°†ç«¯å£çœ‹åšæ˜¯åº”ç”¨å±‚è¿›ç¨‹çš„ ID</p><p>ç†ŸçŸ¥ç«¯å£ï¼š0 - 1023</p><p>ä¸€èˆ¬ç«¯å£ï¼š1024 - ï¼Œç”¨äºéšæ—¶åˆ†é…ç»™è¯·æ±‚é€šä¿¡çš„å®¢æˆ·è¿›ç¨‹</p></blockquote><h3 id="å¥—æ¥å­—"><a class="markdownIt-Anchor" href="#å¥—æ¥å­—"></a> å¥—æ¥å­—</h3><p>å¥—æ¥å­—ï¼šTCP ä½¿ç”¨<strong>è¿æ¥</strong>ä½œä¸ºæœ€åŸºæœ¬çš„æŠ½è±¡ï¼ŒåŒæ—¶å°†è¿æ¥ç«¯ç‚¹ç§°ä¸ºå¥—æ¥å­—ï¼ˆSocketï¼‰</p><blockquote><p>å¥—æ¥å­— = IP åœ°å€ + ç«¯å£å·</p></blockquote><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20211028150508864.png" alt="image-20211028150508864" /></p><h2 id="ä¼ è¾“å±‚åŠŸèƒ½"><a class="markdownIt-Anchor" href="#ä¼ è¾“å±‚åŠŸèƒ½"></a> ä¼ è¾“å±‚åŠŸèƒ½</h2><p>1ã€ä¼ è¾“å±‚ä¸º<strong>åº”ç”¨è¿›ç¨‹ä¹‹é—´</strong>æä¾›ç«¯åˆ°ç«¯çš„é€»è¾‘é€šä¿¡</p><blockquote><p>ç½‘ç»œå±‚ä¸º<strong>ä¸»æœºä¹‹é—´</strong>æä¾›é€»è¾‘é€šä¿¡</p></blockquote><p>2ã€å¯¹æ”¶åˆ°çš„æŠ¥æ–‡æä¾›å·®é”™æ£€æµ‹</p><p>3ã€æ—¢æä¾›é¢å‘è¿æ¥çš„ TCP åˆæä¾›æ— è¿æ¥çš„ UDPï¼Œå› æ­¤å‘ä¸Šæä¾›å¯é çš„å’Œä¸å¯é çš„é€»è¾‘é€šä¿¡ä¿¡é“</p><h1 id="udp-2"><a class="markdownIt-Anchor" href="#udp-2"></a> UDP</h1><p>User Datagram Protocolï¼Œç”¨æˆ·æ•°æ®æŠ¥åè®®ï¼Œæä¾›äº†ç«¯å£åŠŸèƒ½ä¸å·®é”™æ£€æµ‹åŠŸèƒ½</p><p>Strengthï¼šå‘é€æ•°æ®å‰ä¸éœ€è¦å»ºç«‹è¿æ¥ï¼Œä¸éœ€è¦ç»´æŒè¿æ¥ï¼Œé¦–éƒ¨å¼€é”€å°ï¼ˆä»… 8 ä¸ªå­—èŠ‚ï¼‰ï¼›å¯¹æ–¹çš„ä¼ è¾“å±‚æ”¶åˆ° UDP æŠ¥æ–‡åä¹Ÿä¸éœ€è¦ç»™å‡ºç¡®è®¤ï¼›ç½‘ç»œå‡ºç°çš„æ‹¥å¡ä¸ä¼šä½¿æºä¸»æœºçš„å‘é€é€Ÿç‡é™ä½ï¼Œè¿™å¯¹æŸäº›å®æ—¶åº”ç”¨æ˜¯å¾ˆé‡è¦çš„</p><h2 id="æŠ¥æ–‡æ ¼å¼"><a class="markdownIt-Anchor" href="#æŠ¥æ–‡æ ¼å¼"></a> æŠ¥æ–‡æ ¼å¼</h2><p>é¦–éƒ¨æœ‰ 8 ä¸ªå­—èŠ‚ï¼Œç”±æºç«¯å£ã€ç›®çš„ç«¯å£ã€é•¿åº¦å’Œæ ¡éªŒå’Œ 4ä¸ªå­—æ®µç»„æˆ</p><p>ä¼ªé¦–éƒ¨ï¼šç”¨æ¥ç”Ÿæˆæ ¡éªŒå’Œï¼Œåªæ˜¯ä¸€ç§æ ¹æ®çœŸå®çš„é¦–éƒ¨éƒ¨åˆ†æ•°æ®æŠ½è±¡å‡ºæ¥çš„ä¸€ç§æ•°æ®ç»“æ„ã€‚å¹¶æ²¡æœ‰åœ¨æ•°æ®åŒ…ä¸­çœŸå®çš„å­˜åœ¨ã€‚åŒ…æ‹¬æº IPï¼Œç›®çš„ IPï¼Œå¡«å……ï¼Œåè®®å·ä»¥åŠ åŒ…é•¿åº¦</p><p>æ ¡éªŒå’Œï¼šåœ¨æ¥æ”¶ç«¯æ”¶åˆ°æ•°æ®æ—¶ï¼Œåˆ¤æ–­åè®®é¦–éƒ¨å’Œæ•°æ®æ˜¯å¦è¢«ç ´å</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20211122210359366.png" alt="image-20211122210359366" /></p><p><strong>ä¼ªé¦–éƒ¨ä¸­ä¸ºä»€ä¹ˆè¦å¡«å…… 8 ä¸ªå­—ç¬¦</strong></p><p>å› ä¸ºæ ¡éªŒå’Œç”Ÿæˆçš„è¿‡ç¨‹è¦æ±‚ä¼ªé¦–éƒ¨çš„é•¿åº¦åº”ä¸º 16 çš„å€æ•°ï¼Œå¡«å……å‰ä¸º 11 * 8ï¼Œå¡«å……åä¸º 12 * 8</p><h2 id="æ ¡éªŒå’Œè®¡ç®—è¿‡ç¨‹"><a class="markdownIt-Anchor" href="#æ ¡éªŒå’Œè®¡ç®—è¿‡ç¨‹"></a> æ ¡éªŒå’Œè®¡ç®—è¿‡ç¨‹</h2><p>1ã€ä»¥ 16 ä½ä¸ºå•ä½ï¼Œæ‹†åˆ†ä¼ªé¦–éƒ¨ï¼ŒUDP é¦–éƒ¨ä»¥åŠæ•°æ®éƒ¨åˆ†</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20211122211410103.png" alt="image-20211122211410103" /></p><p>2ã€æŒ‰ç…§äºŒè¿›åˆ¶åç è§„åˆ™æ‰§è¡Œæ±‚å’Œè¿ç®—ï¼š<code>0+0=0</code> <code>1+0=0+1=1</code> <code>1+1=10</code></p><p>3ã€å°†æ±‚å’Œç»“æœæ±‚åç å³å¾—åˆ°æ ¡éªŒå’Œ</p><p>4ã€æ¥æ”¶ç«¯æ”¶åˆ°æ•°æ®åæ ¹æ® TCP é¦–éƒ¨æ•°æ®æ„é€ å‡ºä¼ªé¦–éƒ¨ï¼Œé‡å¤ç”Ÿæˆæ ¡éªŒå’Œä¸€ç›´åˆ°å–åçš„å‰ä¸€æ­¥ï¼Œå°†å¾—åˆ°çš„ç»“æœå€¼ä¸ TCP é¦–éƒ¨ä¸­çš„æ ¡éªŒå’Œç›¸åŠ ï¼Œå¦‚æœæ˜¯ 16 ä¸ª 1ï¼Œåˆ™æ ¡éªŒæˆåŠŸ</p><h1 id="udpå®‰å…¨å¨èƒ"><a class="markdownIt-Anchor" href="#udpå®‰å…¨å¨èƒ"></a> UDPå®‰å…¨å¨èƒ</h1><h2 id="udp-flood"><a class="markdownIt-Anchor" href="#udp-flood"></a> UDP Flood</h2><p>æ³›æ´ªæ”»å‡»ï¼Œå±äºæ‹’ç»æœåŠ¡æ”»å‡»ï¼Œé€šè¿‡çŸ­æ—¶é—´å†…äº§ç”Ÿå¤§é‡çš„æµé‡å¯¹ç›®æ ‡ç½‘ç«™æˆ–æ•´ä¸ªç½‘ç»œè¿›è¡Œå¸¦å®½æˆ–èµ„æºæ¶ˆè€—ï¼Œä½¿ç›®æ ‡æ— æ³•å¤„ç†å¤§é‡æ•°æ®åŒ…ï¼Œå¯¼è‡´æœåŠ¡ä¸­æ–­æˆ–åœæ­¢</p><h3 id="æ”»å‡»æ–¹å¼"><a class="markdownIt-Anchor" href="#æ”»å‡»æ–¹å¼"></a> æ”»å‡»æ–¹å¼</h3><p>**Attack Pointï¼š**å¸¸è§çš„æƒ…å†µæ˜¯åˆ©ç”¨å¤§é‡ UDP å°åŒ…å†²å‡» DNS æœåŠ¡å™¨æˆ– Radius è®¤è¯æœåŠ¡å™¨ã€æµåª’ä½“è§†é¢‘æœåŠ¡å™¨</p><p>1ã€UDP æ— è¿æ¥ï¼Œå› æ­¤å­˜åœ¨è¾ƒå°‘çš„éªŒè¯å’Œé”™è¯¯æ£€æŸ¥ï¼Œä½¿å¾— Perpetrator ä»¥æ›´å°çš„ä»£ä»·å®ç° Dos æ”»å‡»</p><p>2ã€ç›®æ ‡ç«™ç‚¹åªè¦å¼€äº†ä¸€ä¸ª UDP ç«¯å£æä¾›ç›¸å…³æœåŠ¡çš„è¯ï¼Œé‚£ä¹ˆå°±å¯é’ˆå¯¹ç›¸å…³æœåŠ¡è¿›è¡Œæ”»å‡»</p><h3 id="udp-flood-æ£€æµ‹"><a class="markdownIt-Anchor" href="#udp-flood-æ£€æµ‹"></a> UDP Flood æ£€æµ‹</h3><p>1ã€æ­£å¸¸åº”ç”¨æƒ…å†µä¸‹ï¼ŒUDP åŒ…åŒå‘æµé‡ä¼šåŸºæœ¬ç›¸ç­‰ï¼Œè€Œä¸”å¤§å°å’Œå†…å®¹éƒ½æ˜¯éšæœºçš„ï¼Œå˜åŒ–å¾ˆå¤§ã€‚</p><p>2ã€é’ˆå¯¹åŒä¸€ç›®æ ‡çš„ UDP åŒ…åœ¨ä¸€ä¾§å¤§é‡å‡ºç°ï¼Œå¹¶ä¸”å†…å®¹å’Œå¤§å°éƒ½æ¯”è¾ƒå›ºå®š</p><h3 id="udp-flood-é˜²å¾¡"><a class="markdownIt-Anchor" href="#udp-flood-é˜²å¾¡"></a> UDP Flood é˜²å¾¡</h3><p>1ã€é™é€Ÿï¼›</p><p>2ã€æŠ¥æ–‡å†…å®¹ç‰¹å¾åŒ¹é…ï¼›</p><p>3ã€IP ç‰¹å¾ - ACLï¼›</p><p>4ã€éšæœºä¸¢åŒ…</p><h3 id="udp-flood-è¯„ä»·"><a class="markdownIt-Anchor" href="#udp-flood-è¯„ä»·"></a> UDP Flood è¯„ä»·</h3><p>è¯¥æ”»å‡»æ˜¯ä¸€ç§æ¶ˆè€—å¯¹æ–¹èµ„æºï¼ŒåŒæ—¶ä¹Ÿæ¶ˆè€—æ”»å‡»è€…è‡ªèº«èµ„æºçš„æ”»å‡»æ–¹å¼ï¼Œç°åœ¨å·²ç»é€æ¸è¢«å…¶å˜ç§ UDP åå°„æ”¾å¤§æ”»å‡»æ‰€ä»£æ›¿</p><h2 id="udp-åå°„æ”¾å¤§æ”»å‡»"><a class="markdownIt-Anchor" href="#udp-åå°„æ”¾å¤§æ”»å‡»"></a> UDP åå°„æ”¾å¤§æ”»å‡»</h2><p><strong>Principle:</strong> å¾ˆå¤š UDP åº”ç”¨çš„å“åº”åŒ…è¿œå¤§äºè¯·æ±‚åŒ…ï¼Œå› æ­¤é€šè¿‡ä¼ªé€ æº IP åœ°å€ï¼Œè®©å¤§é‡ UDP å“åº”åŒ…æ”»å‡»å—å®³ä¸»æœºï¼Œä½¿å…¶æä¾›æ­£å¸¸æœåŠ¡</p><p><strong>Strength:</strong> ä½æˆæœ¬ï¼Œé«˜éšè”½æ€§</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20211028152455221.png" alt="image-20211028152455221" /></p><h3 id="å¸¸è§-udp-åå°„æ”¾å¤§æ”»å‡»ç±»å‹"><a class="markdownIt-Anchor" href="#å¸¸è§-udp-åå°„æ”¾å¤§æ”»å‡»ç±»å‹"></a> å¸¸è§ UDP åå°„æ”¾å¤§æ”»å‡»ç±»å‹</h3><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/20211206133858.png" alt="åå°„æ”¾å¤§æ”»å‡»ç±»å‹" /></p><h3 id="é˜²å¾¡"><a class="markdownIt-Anchor" href="#é˜²å¾¡"></a> é˜²å¾¡</h3><p>1ã€IP æˆ– Port é™é€Ÿ</p><p>2ã€æŠ¥æ–‡ç‰¹å¾å­¦ä¹ </p><p>3ã€æœåŠ¡ç™½åå•</p><p>4ã€åœ°ç†ä½ç½®è¿‡æ»¤</p><p>5ã€æ‰©å®¹å¸¦å®½å’ŒæœåŠ¡å™¨</p><p>6ã€é‡‡ç”¨é«˜å¯ç”¨æ¶æ„</p>]]></content>
      
      
      <categories>
          
          <category> Protocol Security </category>
          
      </categories>
      
      
        <tags>
            
            <tag> security </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>BGP Protocol and Security</title>
      <link href="/Coming-blog/2021/12/06/bgp-protocol-and-security/"/>
      <url>/Coming-blog/2021/12/06/bgp-protocol-and-security/</url>
      
        <content type="html"><![CDATA[<h1 id="bgp"><a class="markdownIt-Anchor" href="#bgp"></a> BGP</h1><p>BGP æ˜¯å¤–éƒ¨ç½‘å…³åè®®ï¼Œå±äºå¢å¼ºçš„è·ç¦»çŸ¢é‡è·¯ç”±åè®®ï¼Œç”¨æ¥åœ¨ASä¹‹é—´ä¼ é€’è·¯ç”±ä¿¡æ¯</p><blockquote><p>AS ä¹‹é—´çš„åè®®ï¼Œå¹¶æ²¡æœ‰ç»Ÿä¸€çš„ç®¡ç†æœºæ„ï¼Œå› æ­¤å­˜åœ¨å¾ˆå¤§çš„å®‰å…¨å¨èƒ</p></blockquote><h2 id="åè¯é€Ÿè§ˆ"><a class="markdownIt-Anchor" href="#åè¯é€Ÿè§ˆ"></a> åè¯é€Ÿè§ˆ</h2><p>1ã€ASï¼Œè‡ªæ²»åŸŸæˆ–è‡ªæ²»ç³»ç»Ÿ</p><p>2ã€Speakerï¼Œå‘é€ BGP æ¶ˆæ¯çš„è·¯ç”±å™¨</p><p>3ã€Peersï¼ŒSpeaker ä¹‹é—´çš„é‚»å±…å…³ç³»</p><p>4ã€EBGPï¼Œå¤–éƒ¨ BGP</p><p>5ã€IBGPï¼Œå†…éƒ¨ BGP</p><p>6ã€IGPï¼Œå†…éƒ¨ç½‘å…³åè®®</p><h2 id="ç‰¹ç‚¹"><a class="markdownIt-Anchor" href="#ç‰¹ç‚¹"></a> ç‰¹ç‚¹</h2><p>(ä¸åŒæ ·æ˜¯è·ç¦»çŸ¢é‡åè®®çš„ RIP æ¯”æ¯”çœ‹)</p><p>1ã€å¯é çš„è·¯ç”±æ›´æ–°æœºåˆ¶ï¼šä¼ é€åè®®ä¸º TCP - 179ï¼›æ— éœ€å‘¨æœŸæ€§æ›´æ–°ï¼›éœ€è¦å‘¨æœŸæ€§å‘é€ keepalive æŠ¥æ–‡æ ¡éªŒ TCP çš„è¿é€šæ€§ï¼›è·¯ç”±æ›´æ–°æ—¶åªå‘é€å¢é‡è·¯ç”±ï¼›</p><p>2ã€ä¸°å¯Œçš„ Metric åº¦é‡æ–¹æ³•</p><p>3ã€ä»è®¾è®¡å±‚é¢é¿å…äº†ç¯è·¯çš„å‘ç”Ÿ</p><p>4ã€ä¸ºè·¯ç”±é™„å¸¦äº†å±æ€§ä¿¡æ¯</p><p>5ã€æ”¯æŒ CIDR - æ— ç±»åˆ«åŸŸé—´é€‰è·¯</p><p>6ã€éè´Ÿçš„è·¯ç”±è¿‡æ»¤å’Œè·¯ç”±ç­–ç•¥</p><blockquote><p>ä¼˜åŠ¿ç‚¹ä¹Ÿå¯èƒ½æˆä¸ºæ”»å‡»ç‚¹</p></blockquote><h2 id="bgp-åŸºæœ¬æ¦‚å¿µ"><a class="markdownIt-Anchor" href="#bgp-åŸºæœ¬æ¦‚å¿µ"></a> BGP åŸºæœ¬æ¦‚å¿µ</h2><h3 id="as"><a class="markdownIt-Anchor" href="#as"></a> AS</h3><p>ASï¼Œè‡ªæ²»åŸŸæˆ–è‡ªæ²»ç³»ç»Ÿï¼ŒæŒ‡æ‹¥æœ‰ç›¸åŒé€‰è·¯ç­–ç•¥çš„ç”±å•ä¸€æœºæ„ç®¡ç†çš„ç½‘ç»œé›†åˆï¼Œæ¯ä¸ª AS ç”± AS å·æ ‡è¯†</p><blockquote><p>ç›®å‰çš„äº’è”ç½‘å¤§çº¦ç”± 5 ä¸‡ä¸ª AS å’Œ 55 ä¸‡ä¸ªåœ°å€å‰ç¼€ç»„æˆ</p><p>æ¯ä¸ªåœ°å€å‰ç¼€ä»£è¡¨ä¸€ä¸ªç½‘ç»œç©ºé—´ï¼Œç”±è¿ç»­çš„ IP åœ°å€ç»„æˆï¼Œå¦‚å‰ç¼€ 59.66.132.0/24 ä»£è¡¨ä¸€ä¸ªæœ‰ 256 ä¸ª IP åœ°å€çš„ç½‘ç»œç©ºé—´</p></blockquote><h3 id="å‘è¨€è€…"><a class="markdownIt-Anchor" href="#å‘è¨€è€…"></a> å‘è¨€è€…</h3><p>Speakerï¼ŒæŒ‡å‘é€ BGP æ¶ˆæ¯çš„è·¯ç”±å™¨ï¼Œå®ƒæ¥æ”¶æˆ–äº§ç”Ÿæ–°çš„è·¯ç”±ä¿¡æ¯å¹¶å‘å¸ƒ/é€šå‘Šç»™å…¶å®ƒ Speaker</p><blockquote><p>å½“ BGP Speaker æ”¶åˆ°<strong>æ¥è‡ªå…¶å®ƒ AS çš„æ–°è·¯ç”±æ—¶</strong>ï¼Œå¦‚æœè¯¥è·¯ç”±æ¯”å½“å‰å·²çŸ¥è·¯ç”±æ›´ä¼˜æˆ–è€…å½“å‰è¿˜æ²¡æœ‰è¯¥è·¯ç”±ï¼Œå®ƒå°±æŠŠè¿™æ¡è·¯ç”±<strong>å‘å¸ƒç»™ AS å†…æ‰€æœ‰å…¶å®ƒ Speaker</strong></p></blockquote><h3 id="é‚»å±…"><a class="markdownIt-Anchor" href="#é‚»å±…"></a> é‚»å±…</h3><p>Peersï¼Œä»»ä½•ä¸¤ä¸ªå½¢æˆ TCP è¿æ¥æ¥äº¤æ¢ BGP è·¯ç”±ä¿¡æ¯çš„ Speaker ç§°ä¸ºé‚»å±…(peers)æˆ–å¯¹ç­‰ä½“</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/20211129105731.png" alt="Peers" /></p><h3 id="å¤–éƒ¨ä¸å†…éƒ¨-bgp"><a class="markdownIt-Anchor" href="#å¤–éƒ¨ä¸å†…éƒ¨-bgp"></a> å¤–éƒ¨ä¸å†…éƒ¨ BGP</h3><p>å¤–éƒ¨ BGP å³ EBGPï¼Œå½“ BGP é‚»å±…å±äºä¸åŒçš„è‡ªæ²»ç³»ç»Ÿï¼Œä»–ä»¬è¢«ç§°ä¸º EBGPï¼ˆç›¸å¯¹è€Œè¨€çš„ï¼‰</p><blockquote><p>EBGP é‚»å±…, é»˜è®¤æƒ…å†µä¸‹, éœ€è¦ç›´è¿</p></blockquote><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/20211206113218.png" alt="EBGP" /></p><p>å†…éƒ¨ BGP å³ IBGPï¼ŒæŒ‡ BGP é‚»å±…å­˜åœ¨äºåŒä¸€ä¸ª AS å†…ï¼Œé€šå¸¸è¿™ä¸¤ä¸ª BGP ä¸éœ€è¦ç›´è¿ï¼Œæ˜¯è¯¥ AS çš„ä¸¤ä¸ªè¾¹ç•Œ BGP</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/20211206113154.png" alt="IBGP" /></p><h3 id="äº”ç±»æ¶ˆæ¯æŠ¥æ–‡"><a class="markdownIt-Anchor" href="#äº”ç±»æ¶ˆæ¯æŠ¥æ–‡"></a> äº”ç±»æ¶ˆæ¯/æŠ¥æ–‡</h3><p>1ã€Open, å»ºç«‹ BGP è¿æ¥</p><p>2ã€Keepalive, æ£€æµ‹å’Œç»´æŠ¤ BGP è¿æ¥</p><p>3ã€<strong>Update</strong>, å‘é€ BGP è·¯ç”±æ›´æ–°</p><p>4ã€Notification, ä¸­æ–­ BGP è¿æ¥</p><p>5ã€Route-Refreshï¼Œé€šçŸ¥å¯¹ç­‰ä½“è‡ªå·±æ”¯æŒè·¯ç”±åˆ·æ–°èƒ½åŠ›</p><h2 id="bgp-å·¥ä½œæœºåˆ¶"><a class="markdownIt-Anchor" href="#bgp-å·¥ä½œæœºåˆ¶"></a> BGP å·¥ä½œæœºåˆ¶</h2><p>1ã€å»ºç«‹ TCP è¿æ¥ ï¼ˆ179ï¼‰</p><p>2ã€BGP Speaker é€šè¿‡ Open æ¶ˆæ¯åå•†å‚æ•°ï¼Œå»ºç«‹ BGP é‚»å±…å…³ç³»</p><p>3ã€å»ºç«‹è¿æ¥åï¼ŒBGP é‚»å±…ä¼šé€šè¿‡ Update æ¶ˆæ¯åŠæ—¶å¢é‡æ›´æ–°è·¯ç”±è¡¨</p><p>4ã€BGP ä¼šå‘é€ Keepalive æ¶ˆæ¯æ¥ç»´æŒé‚»å±…é—´çš„ BGP è¿æ¥</p><p>5ã€å½“ BGP æ£€æµ‹åˆ°ç½‘ç»œä¸­çš„é”™è¯¯çŠ¶æ€æ—¶ï¼ŒBGP å‘ Notification æ¶ˆæ¯æŠ¥é”™ï¼ŒBGP è¿æ¥ä¸­æ–­</p><h2 id="bgp-è·¯ç”±æ³¨å…¥"><a class="markdownIt-Anchor" href="#bgp-è·¯ç”±æ³¨å…¥"></a> BGP è·¯ç”±æ³¨å…¥</h2><p>å†…éƒ¨ç½‘å…³åè®®ä¿¡æ¯æ³¨å…¥å¤–éƒ¨ç½‘å…³åè®®ä¸­</p><h3 id="çº¯åŠ¨æ€æ³¨å…¥"><a class="markdownIt-Anchor" href="#çº¯åŠ¨æ€æ³¨å…¥"></a> çº¯åŠ¨æ€æ³¨å…¥</h3><p>è·¯ç”±å™¨å°†é€šè¿‡ IGP è·¯ç”±åè®®åŠ¨æ€è·å¾—çš„è·¯ç”±ä¿¡æ¯å¹¶ç›´æ¥æ³¨å…¥åˆ° BGP ç³»ç»Ÿä¸­å»</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/20211129111408.png" alt="åŠ¨æ€æ³¨å…¥" /></p><h3 id="åŠåŠ¨æ€æ³¨å…¥"><a class="markdownIt-Anchor" href="#åŠåŠ¨æ€æ³¨å…¥"></a> åŠåŠ¨æ€æ³¨å…¥</h3><p>è·¯ç”±å™¨æœ‰é€‰æ‹©æ€§çš„ï¼ˆé€šè¿‡é…ç½®å‘½ä»¤ï¼‰å°† IGP å‘ç°çš„åŠ¨æ€è·¯ç”±ä¿¡æ¯æ³¨å…¥åˆ° BGP ç³»ç»Ÿä¸­å»</p><blockquote><p>ä¼šæ£€æŸ¥è¯¥è·¯ç”±ç¬¦åˆä¹‹å‰é…ç½®çš„æ³¨å…¥æ¡ä»¶</p></blockquote><h3 id="é™æ€æ³¨å…¥"><a class="markdownIt-Anchor" href="#é™æ€æ³¨å…¥"></a> é™æ€æ³¨å…¥</h3><p>è·¯ç”±å™¨å°†é™æ€é…ç½®çš„æŸæ¡è·¯ç”±æ³¨å…¥åˆ° BGP ç³»ç»Ÿä¸­</p><blockquote><p>äººä¸ºé…ç½®æŸæ¡é™æ€è·¯ç”±ï¼Œç„¶åå°†å…¶æ³¨å…¥åˆ° BGP è·¯ç”±è¡¨ä¸­</p></blockquote><h2 id="bgp-è·¯ç”±é€šå‘ŠåŸåˆ™"><a class="markdownIt-Anchor" href="#bgp-è·¯ç”±é€šå‘ŠåŸåˆ™"></a> BGP è·¯ç”±é€šå‘ŠåŸåˆ™</h2><p>ä¸€æ—¦å»ºç«‹æ–°è¿æ¥ï¼ŒSpeaker æŒ‰ç…§ä¸‹è¿°åŸåˆ™å°†è‡ªå·±æ‰€æœ‰è·¯ç”±é€šå‘Šä¿¡æ¯é€šå‘Šç»™æ–°é‚»å±…</p><blockquote><p>å­˜åœ¨å¤šæ¡è·¯å¾„æ—¶ï¼ŒSpeaker åªé€‰å–æœ€ä¼˜çš„ä½¿ç”¨ï¼ˆä¸è€ƒè™‘è´Ÿè½½å‡è¡¡çš„æƒ…å†µï¼‰Speaker åªæŠŠè‡ªå·±ä½¿ç”¨çš„è·¯ç”±é€šå‘Šç»™é‚»å±…</p></blockquote><p>1ã€å¯¹äº BGP è·¯ç”±ï¼Œå¦‚æœå½“å‰è·¯ç”±å™¨ä¸ºè¯¥è·¯ç”±çš„å§‹å‘è·¯ç”±å™¨ï¼Œåˆ™ä¼šå°†è¯¥è·¯ç”±ä¼ é€’ç»™å…¶ä»–æ‰€æœ‰ IBGP å¯¹ç­‰ä½“ä»¥åŠæ‰€æœ‰ EBGP å¯¹ç­‰ä½“ï¼ˆå§‹å‘ä¿¡æ¯å…¨éƒ¨ä¼ ï¼‰</p><p>2ã€éå§‹å‘è·¯ç”±ï¼Œå¦‚æœæ‰€æ¥æ”¶è·¯ç”±æ¡ç›®ä¸º IBGP è·¯ç”±ï¼Œåˆ™åªä¼šå°†è¯¥è·¯ç”±æ¡ç›®è½¬å‘ç»™æ‰€æœ‰ EBGP å¯¹ç­‰ä½“ï¼›æ‰€æ¥æ”¶æ¡ç›®ä¸º EBGP è·¯ç”±æ—¶ï¼Œåˆ™ä¼šå‘ç»™æ‰€æœ‰ IBGP ä¸ EBGP å¯¹ç­‰ä½“ï¼ˆå†…éƒ¨æ¥æºä¿¡æ¯åªä¼ ç»™å¤–éƒ¨ï¼Œå¤–éƒ¨æ¥æºä¿¡æ¯ä¼ ç»™æ‰€æœ‰ï¼‰</p><blockquote><p>Speaker ä» IBGP è·å¾—çš„è·¯ç”±æ˜¯å¦é€šå‘Šç»™å®ƒçš„ EBGP é‚»å±…è¦ä¾ IGP å’Œ BGP åŒæ­¥çš„æƒ…å†µæ¥å†³å®šè¿™ä¸ªåŸåˆ™é¿å…äº† AS å†…éƒ¨ç¯è·¯</p></blockquote><h3 id="ebgp-ä¹‹é—´"><a class="markdownIt-Anchor" href="#ebgp-ä¹‹é—´"></a> EBGP ä¹‹é—´</h3><p>1ã€Speaker ä» EBGP è·å¾—çš„è·¯ç”±ä¼šå‘å®ƒæ‰€æœ‰ BGP é‚»å±…é€šå‘Šï¼ˆåŒ…æ‹¬ EBGP å’Œ IBGPï¼‰</p><blockquote><p>å»ºç«‹è¿æ¥åä¼šå‘é€æ‰€æœ‰æœ‰æ•ˆBGPè·¯ç”±ï¼Œä¹‹ååª<strong>å¢é‡æ›´æ–°è·¯ç”±</strong></p></blockquote><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/20211206125443.png" alt="å¢é‡è·¯ç”±" /></p><h3 id="ibgp-ä¹‹é—´"><a class="markdownIt-Anchor" href="#ibgp-ä¹‹é—´"></a> IBGP ä¹‹é—´</h3><p>Speaker ä» IBGP è·å¾—çš„è·¯ç”±ä¸å‘å®ƒçš„ IBGP é‚»å±…é€šå‘Šï¼ˆé¿å…ç¯è·¯ï¼‰</p><h2 id="bgp-è·¯ç”±å±æ€§"><a class="markdownIt-Anchor" href="#bgp-è·¯ç”±å±æ€§"></a> BGP è·¯ç”±å±æ€§</h2><p>BGP è·¯ç”±å±æ€§æ˜¯åŒ…å«åœ¨ BGP è·¯ç”±å™¨é€šå‘Šé‡Œçš„ä¸€å¥—å‚æ•°ï¼Œå®ƒå¯¹ç‰¹å®šçš„è·¯ç”±è¿›è¡Œæè¿°ï¼Œä½¿å¾—è·¯ç”±å™¨èƒ½å¤Ÿå¯¹è·¯ç”±è¿›è¡Œè¿‡æ»¤å’Œé€‰æ‹©</p><blockquote><p>IGP ä½¿ç”¨ networks é€šå‘Šè·¯ç”±ï¼Œç”¨åº¦é‡å€¼æ ‡è¯†è·¯å¾„å¥½åEGP ä¸­çš„ BGP é€šå‘Šæ•´æ¡è·¯å¾„å¹¶ä½¿ç”¨å±æ€§æ ‡è¯†è·¯å¾„å¥½å</p></blockquote><p>å››ç±»å±æ€§ï¼š</p><p>1ã€å…¬è®¤å¿…éµï¼šæ‰€æœ‰ BGP è·¯ç”±å™¨éƒ½å¯ä»¥è¯†åˆ«çš„å±æ€§ï¼Œä¸”å¿…é¡»å­˜åœ¨äº Update æ¶ˆæ¯ä¸­ã€‚å¦‚æœç¼ºå°‘è¿™ç§å±æ€§ï¼Œè·¯ç”±ä¿¡æ¯å°±ä¼šå‡ºé”™ï¼ˆæˆ‘æ”¯æŒä½ ä¹Ÿå¿…é¡»æœ‰ï¼‰</p><p>2ã€å…¬è®¤ä»»æ„ï¼šæ‰€æœ‰BGPè·¯ç”±å™¨éƒ½å¯ä»¥è¯†åˆ«ï¼Œä½†ä¸è¦æ±‚å¿…é¡»å­˜åœ¨äº Update æ¶ˆæ¯ä¸­ï¼Œå¯ä»¥æ ¹æ®å…·ä½“æƒ…å†µæ¥é€‰æ‹©ï¼ˆæˆ‘æ”¯æŒä½ å¯ä»¥æ²¡æœ‰ï¼‰</p><p>3ã€å¯é€‰è¿‡åº¦ï¼šåœ¨ AS ä¹‹é—´å…·æœ‰å¯ä¼ é€’æ€§çš„å±æ€§ã€‚BGP è·¯ç”±å™¨å¯ä»¥ä¸æ”¯æŒæ­¤å±æ€§ï¼Œä½†å®ƒä»ç„¶ä¼šæ¥æ”¶å¸¦æœ‰æ­¤å±æ€§çš„è·¯ç”±ï¼Œå¹¶é€šå‘Šç»™å…¶ä»–é‚»å±…ï¼ˆæˆ‘å¦‚æœä¸æ”¯æŒä½†æ˜¯ä¼šå¸®ä½ ä¼ é€’ï¼‰</p><p>4ã€å¯é€‰éè¿‡æ¸¡ï¼šå¦‚æœ BGP è·¯ç”±å™¨ä¸æ”¯æŒæ­¤å±æ€§ï¼Œåˆ™ç›¸åº”çš„ Update æ¶ˆæ¯ä¼šè¢«å¿½ç•¥ï¼Œä¸”ä¸ä¼šé€šå‘Šç»™å…¶ä»–é‚»å±…ï¼ˆæˆ‘å¦‚æœä¸æ”¯æŒå°±ä¸ç®¡é‚£ä¸ªå±æ€§ï¼‰</p><p>å¸¸ç”¨å±æ€§å¦‚ä¸‹ï¼š</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/20211129113701.png" alt="BGPè·¯ç”±å±æ€§" /></p><h2 id="bgp-è·¯ç”±æ›´æ–°ç­–ç•¥"><a class="markdownIt-Anchor" href="#bgp-è·¯ç”±æ›´æ–°ç­–ç•¥"></a> BGP è·¯ç”±æ›´æ–°ç­–ç•¥</h2><p>å½“ BGP è·¯ç”±å™¨ä»å¤šä¸ªé‚»å±…æ¥æ”¶åˆ°è¾¾åˆ°åŒä¸€ç›®çš„å‰ç¼€çš„è·¯ç”±ä¿¡æ¯æ—¶ï¼Œä¼šæ ¹æ®è·¯ç”±å±æ€§é€‰æ‹©å¹¶é€šå‘Šä¸€æ¡æœ€ä¼˜è·¯ç”±ï¼ˆé¡ºåºå†³ç­–ï¼‰</p><p>1ã€æœ¬åœ°ä¼˜å…ˆå±æ€§(Local_Pref)å€¼æœ€é«˜çš„è·¯ç”±</p><blockquote><p>ä¼˜å…ˆå±æ€§ç”± AS å•†ä¸šå…³ç³»å†³å®šC2P å…³ç³»ï¼šCustomer å‘ Provider è´­ä¹°æ¥å…¥äº’è”ç½‘æœåŠ¡ï¼Œæ”¯ä»˜æµé‡è´¹ï¼šé¡¾å®¢å°±æ˜¯ä¸Šå¸P2C å…³ç³»ï¼šProvider ä¸º Customer æä¾›æ¥å…¥äº’è”ç½‘æœåŠ¡ï¼Œæ”¶å–æµé‡è´¹P2P å…³ç³»ï¼šAS ä¹‹é—´å¯ä»¥äº’ç›¸ä¸ºå¯¹æ–¹(åŠå…¶Customer)å…è´¹è½¬å‘æµé‡ï¼šå…³ç³»å¹³ç­‰S2S å…³ç³»ï¼šAS ä¹‹é—´å¯ä»¥å…è´¹è½¬å‘å¯¹æ–¹ä»»ä½•æµé‡(å°‘è§)</p></blockquote><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/20211129115251.png" alt="è·¯ç”±ç­–ç•¥" /></p><p>Qï¼šä¸ºä»€ä¹ˆä¼˜å…ˆçº§æ¬¡åºä¸º Customer &gt; Peer &gt; Provider</p><p>Aï¼šè¿™æ˜¯ç”±æµé‡æ‰€äº§ç”Ÿçš„çš„ç»æµåˆ©ç›Šå†³å®šçš„ï¼Œcustomer ä¸ºè´­ä¹°æ–¹å…¶äº§ç”Ÿçš„ç»æµåˆ©ç›Šæœ€å¤§ï¼Œå› æ­¤ä¼˜å…ˆçº§æœ€é«˜ï¼›Peer ä¸æˆ‘æ˜¯åŒç­‰èº«ä»½ï¼Œç»æµåˆ©ç›Šåº”ä»‹äº Provider ä¸ Customer ä¹‹é—´ï¼›</p><p>2ã€ASè·¯å¾„(AS_Path)é•¿åº¦æœ€å°çš„è·¯ç”±</p><p>3ã€è·¯ç”±æºç±»å‹(Origin)æœ€å°çš„è·¯ç”±(IGP&lt;EGP&lt;INCOMPLETE)</p><p>4ã€MEDå€¼æœ€å°çš„è·¯ç”±(Next_Hopç›¸åŒçš„å‰æä¸‹)</p><p>5ã€EBGPç±»å‹è·¯ç”±ä¼˜äºIBGPç±»å‹è·¯ç”±</p><p>6ã€IGP Metricæœ€å°çš„è·¯ç”±(å¯¹äºå‡ºå£è¾¹ç•Œè·¯ç”±å™¨)</p><p>7ã€è·¯ç”±å™¨IDæœ€å°çš„è·¯ç”±</p><h2 id="bgp-è·¯ç”±é€šå‘Šç­–ç•¥"><a class="markdownIt-Anchor" href="#bgp-è·¯ç”±é€šå‘Šç­–ç•¥"></a> BGP è·¯ç”±é€šå‘Šç­–ç•¥</h2><p>BGP æ˜¯ä¸€ç§åŸºäºç­–ç•¥çš„è·¯ç”±åè®®ï¼Œåªæœ‰å½“ AS æ„¿æ„è®©é‚»å±… AS åˆ©ç”¨å…¶èµ„æºå»è®¿é—®æŸäº›ç½‘ç»œæ—¶ï¼Œæ‰ä¼šæŠŠè‡ªå·±æŒæ¡çš„ç‰¹å®šè·¯ç”±ä¿¡æ¯é€šå‘Šç»™é‚»å±… AS</p><blockquote><p>BGP è·¯ç”±é€šå‘Šç­–ç•¥ç”± AS å•†ä¸šå…³ç³»å†³å®š</p></blockquote><h3 id="å¯¼å‡ºè§„åˆ™"><a class="markdownIt-Anchor" href="#å¯¼å‡ºè§„åˆ™"></a> å¯¼å‡ºè§„åˆ™</h3><p>1ã€æ¥è‡ª Customer çš„è·¯ç”±é€šå‘Šç»™ Customerã€Peer ä»¥åŠ Provider</p><p>2ã€æ¥è‡ª Peer æˆ– Provider çš„è·¯ç”±ä»…é€šå‘Šç»™ Customerï¼Œä¸å‘ Peer å’Œ Provider ä¼ æ’­</p><p>Qï¼šä¸ºä»€ä¹ˆè¦è¿™æ ·æŒ‡å®šè§„åˆ™ï¼Ÿ</p><p>Aï¼šä¸è·¯ç”±å™¨é€šå‘ŠåŸåˆ™ä¸­æœ¬åœ°ä¼˜å…ˆå±æ€§è§„å®šç±»ä¼¼ï¼Œè€ƒè™‘åˆ°çš„è¿˜æ˜¯ç»æµæ•ˆç›Šï¼›æˆ‘ä»é¡¾å®¢é‚£é‡Œè·å¾—çš„è·¯ç”±å½“ç„¶è¦ç»™æˆ‘å…¶ä»–é¡¾å®¢ï¼Œä»¥åŠä¸æˆ‘åˆä½œçš„ peer ä¸ Provider å…±äº«ï¼›ä½†æ˜¯æˆ‘ä»ä¸æˆ‘åˆä½œçš„ peer ä¸ Provider è·å¾—çš„è·¯ç”±åªèƒ½ç»™ä¸æˆ‘çš„é¡¾å®¢ï¼Œä¸èƒ½ç»™ä¸å…¶å®ƒçš„ä¸æˆ‘åˆä½œçš„ peer ä¸ Providerï¼ˆå› ä¸ºä»–ä»¬ä¸ä¸€å®šæ˜¯åˆä½œå…³ç³»ï¼‰</p><h3 id="å¯¼å…¥è§„åˆ™"><a class="markdownIt-Anchor" href="#å¯¼å…¥è§„åˆ™"></a> å¯¼å…¥è§„åˆ™</h3><p>1ã€ä¼˜é€‰ Local preference é«˜çš„ï¼Œé€šå¸¸ä»é«˜åˆ°ä½æ’åˆ—ä¸º customer &gt; peer &gt; providerï¼›</p><p>2ã€å…¶æ¬¡çœ‹ AS-Path é•¿åº¦ï¼Œé•¿åº¦è¶Šå°è¶Šä¼˜å…ˆ</p><h1 id="bgp-å®‰å…¨å¨èƒ"><a class="markdownIt-Anchor" href="#bgp-å®‰å…¨å¨èƒ"></a> BGP å®‰å…¨å¨èƒ</h1><p>1ã€æ²¡æœ‰ä¿éšœé‚»å±…ä¹‹é—´é€šä¿¡æŠ¥æ–‡çš„å®Œæ•´æ€§ã€æ—¶æ•ˆæ€§å’Œé‚»å±…èº«ä»½çš„çœŸå®æ€§</p><p>2ã€æ²¡æœ‰éªŒè¯ AS å¯å‘èµ· NLRI çš„æƒé™ -&gt; å‰ç¼€åŠ«æŒ</p><blockquote><p>NIRIï¼Œç½‘ç»œå±‚å¯è¾¾ä¿¡æ¯ï¼Œå®ƒæè¿°äº†ä¸€ä¸ªè·¯ç”±å’Œæ€æ ·åˆ°è¾¾å®ƒï¼Œå°±æ˜¯ä¸€ä¸ªè·¯ç”±å‰ç¼€</p></blockquote><p>3ã€æ²¡æœ‰ä¿éšœ AS é€šå‘Šè·¯å¾„å±æ€§çš„çœŸå®æ€§ -&gt; è·¯å¾„ä¼ªé€ </p><p>4ã€æ— æ³•éªŒè¯è·¯ç”±ä¼ æ’­è¡Œä¸ºæ˜¯å¦åˆæ³• -&gt; è·¯ç”±æ³„éœ²</p><blockquote><p>å¼‚å¸¸è·¯ç”±é€šå‘Šï¼šå‰ç¼€åŠ«æŒï¼Œè·¯å¾„ä¼ªé€ ï¼Œè·¯ç”±æ³„éœ²ï¼Œæ˜¯ BGP é¢ä¸´çš„æœ€ä¸»è¦å®‰å…¨å¨èƒï¼Œè½»å¯é€ æˆè·¯ç”±é»‘æ´å’Œä¸­é—´äººæ”»å‡»ï¼Œé‡åˆ™å®¹æ˜“é€ æˆäº’è”ç½‘å¤§è§„æ¨¡ç˜«ç—ª</p></blockquote><h2 id="å‰ç¼€åŠ«æŒ"><a class="markdownIt-Anchor" href="#å‰ç¼€åŠ«æŒ"></a> å‰ç¼€åŠ«æŒ</h2><p>AS å¯¹å¤–å‘èµ·çš„è·¯ç”±é€šå‘Šä¸­çš„å‰ç¼€æœªè·æˆæƒï¼ˆæˆ‘å¯ä»¥éšä¾¿è¯´åˆ°æŸä¸ª IP è¦èµ°æˆ‘è‡ªå·±ï¼‰</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/20211129123047.png" alt="å‰ç¼€åŠ«æŒ" /></p><h2 id="è·¯å¾„ä¼ªé€ "><a class="markdownIt-Anchor" href="#è·¯å¾„ä¼ªé€ "></a> è·¯å¾„ä¼ªé€ </h2><p>AS å‘é‚»å±…ä¼ æ’­çš„è·¯ç”±é€šå‘Šä¸­çš„ AS_PATH è·¯å¾„å±æ€§éçœŸï¼ˆç±»ä¼¼äºå‰ç¼€åŠ«æŒï¼‰</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/20211129123141.png" alt="è·¯å¾„ä¼ªé€ " /></p><h2 id="è·¯ç”±æ³„éœ²"><a class="markdownIt-Anchor" href="#è·¯ç”±æ³„éœ²"></a> è·¯ç”±æ³„éœ²</h2><p>AS å‘é‚»å±…ä¼ æ’­çš„è·¯ç”±é€šå‘Šè¿åè·¯ç”±å‡ºç«™ç­–ç•¥ï¼šè·¯ç”±é€šå‘Šåˆæ³•ï¼Œè·¯ç”±ä¼ æ’­éæ³•ï¼Œä¼šé€ æˆæµé‡é‡å®šå‘</p><blockquote><p>æ¥è‡ª Peer æˆ– Provider çš„è·¯ç”±ä»…é€šå‘Šç»™ Customerï¼Œä¸å‘ Peer å’Œ Provider ä¼ æ’­</p></blockquote><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/20211129123340.png" alt="è·¯ç”±æ³„éœ²" /></p><h2 id="å…¸å‹äº‹ä»¶åˆ†æ"><a class="markdownIt-Anchor" href="#å…¸å‹äº‹ä»¶åˆ†æ"></a> å…¸å‹äº‹ä»¶åˆ†æ</h2><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/20211206130550.png" alt="å¼‚å¸¸è·¯ç”±äº‹ä»¶åˆ†æ" /></p><h3 id="å·´åŸºæ–¯å¦ç”µä¿¡æ¶æ„ä¸»åŠ¨åŠ«æŒ-youtube-å‰ç¼€"><a class="markdownIt-Anchor" href="#å·´åŸºæ–¯å¦ç”µä¿¡æ¶æ„ä¸»åŠ¨åŠ«æŒ-youtube-å‰ç¼€"></a> å·´åŸºæ–¯å¦ç”µä¿¡æ¶æ„ä¸»åŠ¨åŠ«æŒ YouTube å‰ç¼€</h3><p>1ã€å·´åŸºæ–¯å¦ç”µä¿¡è‡´ä½¿ YouTube æ–­ç½‘äº‹ä»¶ï¼šå·´åŸºæ–¯å¦ç”µä¿¡æƒ³è¦å°æ‰ YouTube çš„è®¿é—®ï¼Œå› æ­¤åœ¨è·¯ç”±å™¨åœ¨è·¯ç”±å™¨ä¸Šæ·»åŠ ä¸€æ¡é™æ€è·¯ç”±è¡¨é¡¹ï¼ˆäººæ–‡é™æ€æ³¨å…¥ï¼‰å°†ç›®çš„åœ°å€è®¾ä¸ºé»‘æ´è·¯ç”±åœ°å€ï¼›ä½†æ˜¯ç”µä¿¡å·¥ç¨‹å¸ˆä¸å°å¿ƒè®©è¿™ä¸ªè·¯ç”±æ³¨å…¥åˆ°äº† BGP ä¸­ï¼Œéšåè¢«é€šå‘Šç»™äº†å·´åŸºæ–¯å¦ç”µä¿¡çš„ Provider é¦™æ¸¯ç”µè®¯ç›ˆç§‘ï¼ŒProviderï¼ˆé¦™æ¸¯ç”µè®¯ç›ˆç§‘ï¼‰ ä¸€çœ‹ Customer ï¼ˆå·´åŸºæ–¯å¦ç”µä¿¡ï¼‰ä¼ æ¥äº†è·¯ç”±ï¼Œé‚£æˆ‘å¾—ç»™æ‰€æœ‰äººé€šå‘Šå•Šï¼Œå› æ­¤è¢«é€æ¸åŒæ­¥åˆ°äº†å…¨ä¸–ç•Œ</p><h1 id="bgp-å®‰å…¨æŠ€æœ¯"><a class="markdownIt-Anchor" href="#bgp-å®‰å…¨æŠ€æœ¯"></a> BGP å®‰å…¨æŠ€æœ¯</h1><p>BGP å®‰å…¨æŠ€æœ¯åˆ†ä¸º<strong>è·¯ç”±è®¤è¯æŠ€æœ¯</strong>å’Œ<strong>å¼‚å¸¸æ£€æµ‹æŠ€æœ¯</strong>ä¸¤å¤§ç±»</p><p>è·¯ç”±è®¤è¯æŠ€æœ¯ï¼šä»¥åˆ¶å®šå’Œå®Œå–„ BGP è·¯ç”±åè®®çš„å®‰å…¨æœºåˆ¶ä¸ºç›®æ ‡ï¼Œåˆ©ç”¨è¯ä¹¦ã€æ•°å­—ç­¾åå’Œå…¶ä»–åŠ å¯†æŠ€æœ¯æ¥ä¿æŠ¤è·¯ç”±ä¿¡æ¯çš„çœŸå®æ€§å’Œå®Œæ•´æ€§ã€‚å¯ä»¥ä»æ ¹æœ¬ä¸Šè§£å†³ BGP å¼‚å¸¸è·¯ç”±é€šå‘Šé—®é¢˜ï¼Œä½†åŒæ—¶ä¹Ÿéœ€è¦ä»˜å‡ºä¸å°çš„ä»£ä»·ï¼Œä¸»è¦åŒ…æ‹¬ï¼šéœ€è¦å»ºç«‹ PKIã€è·¯ç”±å™¨çš„æ€§èƒ½å¼€é”€ã€éœ€è¦ä¿®æ”¹ç°æœ‰åè®®è§„èŒƒç­‰</p><p>å¼‚å¸¸æ£€æµ‹æŠ€æœ¯ï¼šæå– BGP æ§åˆ¶å¹³é¢å’Œæ•°æ®å¹³é¢çš„å¼‚å¸¸ä¿¡æ¯ï¼Œå¯¹å¼‚å¸¸è·¯ç”±é€šå‘Šè¡Œä¸ºè¿›è¡Œæ£€æµ‹å¹¶æŠ¥è­¦ã€‚ä¸èƒ½å½»åº•è§£å†³ BGP çš„å®‰å…¨é—®é¢˜ï¼Œä½†åœ¨ç›®å‰å°šæœªéƒ¨ç½²å®Œæ•´ PKIä½“ç³»çš„æƒ…å†µä¸‹ï¼Œä¸å¤±ä¸ºä¸€ç§è½»é‡çº§çš„è§£å†³æ–¹æ¡ˆ</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/20211129124523.png" alt="BGP å®‰å…¨æŠ€æœ¯å¯¹æ¯”" /></p><h2 id="s-bgp"><a class="markdownIt-Anchor" href="#s-bgp"></a> S-BGP</h2><p>Secure BGPï¼ŒåŸºäºPKIï¼ˆå…¬é’¥åŸºç¡€è®¾æ–½ï¼‰çš„ BGP è·¯ç”±è®¤è¯æŠ€æœ¯ï¼š</p><h3 id="ç»„æˆ"><a class="markdownIt-Anchor" href="#ç»„æˆ"></a> ç»„æˆ</h3><p>1ã€å®šä¹‰äº†ä¸¤ç±» PKI æ¥è¡¨æ˜ AS å·å’Œ IP åœ°å€çš„æ‰€æœ‰æƒï¼Œé€šè¿‡<strong>ç»‘å®š</strong>æ¥è¯å®å®ƒä»¬ä¸æŸä¸ª AS çš„å…³ç³»ï¼›</p><p>2ã€å¢åŠ äº†ä¸€ä¸ªæ–°çš„è·¯ç”±å±æ€§ Attestationï¼ˆè¯æ˜ï¼‰ï¼Œå¯æºå¸¦æ•°å­—ç­¾åï¼Œç”¨äº BGP ç³»ç»Ÿåˆæ³•æ€§çš„ç¡®è®¤ï¼›</p><p>3ã€åº”ç”¨ IPsecBGP å¯¹è¯ç³»ç»Ÿé—´çš„ç¡®è®¤ã€‚IPsec åŒ BGP å‘è¨€è€…å‘å¸ƒçš„è¯ä¹¦ç›¸å…³è”ï¼Œæ¥è¯å® BGP é‚»å±…çš„çœŸå®æ€§ï¼Œæä¾› TCP è¿æ¥çš„æ•°æ®å®Œæ•´æ€§ä¿æŠ¤ï¼ŒåŒæ—¶å¯ä»¥é˜²æ­¢é‡æ”¾æ”»å‡»ï¼›</p><h3 id="attestation"><a class="markdownIt-Anchor" href="#attestation"></a> Attestation</h3><p>Attestation åˆ†ä¸º Address Attestationï¼ˆåœ°å€è¯æ˜ï¼‰ä¸ Route Attestationï¼ˆè·¯ç”±è¯æ˜ï¼‰ï¼š</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/20211129133832.png" alt="Attestation" /></p><h3 id="attestation-åœ°å€è¯æ˜"><a class="markdownIt-Anchor" href="#attestation-åœ°å€è¯æ˜"></a> Attestation åœ°å€è¯æ˜</h3><p>åœ°å€è¯æ˜ï¼šSigner æ˜¯ ISPï¼ŒExplicitPA å­—æ®µåŒ…å«æœ‰è¯¥ ISP æ‹¥æœ‰çš„ä¸€æ®µ I På‰ç¼€ï¼ŒTarget æ˜¯ ISP æˆæƒç”¨äºé€šå‘Šè¯¥ IP å‰ç¼€çš„ AS å·ã€‚ISP ä½¿ç”¨å…¶ç§é’¥å¯¹ IP å‰ç¼€å’Œ AS å·ç æ•°æ®è¿›è¡Œç­¾åå¹¶ç½®äº Signature å­—æ®µï¼Œä»¥ä¿æŠ¤è¯¥æ®µæ•°æ®çš„å®Œæ•´æ€§å’ŒçœŸå®æ€§ã€‚â€œåœ°å€è¯æ˜â€è¡¨æ˜äº†å“ªä¸ª AS è¢« ISP æˆæƒæ¥é€šå‘Šå…¶æ‰€æ‹¥æœ‰çš„å‰ç¼€</p><blockquote><p>è¯æ˜äº† AS æ‹¥æœ‰çš„ IP åœ°å€ï¼›è¿™æ ·æœªè¢«è¯æ˜çš„ AS å°±ä¸èƒ½ä¸»åŠ¨é€šå‘Šäº†</p></blockquote><h3 id="attestation-è·¯ç”±è¯æ˜"><a class="markdownIt-Anchor" href="#attestation-è·¯ç”±è¯æ˜"></a> Attestation è·¯ç”±è¯æ˜</h3><p>è·¯ç”±è¯æ˜ï¼šSigner æ˜¯ BGP è·¯ç”±å™¨ï¼ŒExplicitPA å­—æ®µå«æœ‰è¦é€šå‘Šçš„ IP å‰ç¼€ï¼ŒTarget æ˜¯è·¯ç”±å™¨é‚»å±…çš„ AS å·ã€‚â€œè·¯ç”±è¯æ˜â€ç”¨ BGP è·¯ç”±å™¨çš„ç§é’¥è¿›è¡Œç­¾å,â€œè·¯ç”±è¯æ˜â€ ä»£è¡¨äº† BGP è·¯ç”±é€šå‘Šæ–¹å¯¹å…¶é‚»å±…ç»§ç»­é€šå‘Šè¯¥ IP å‰ç¼€çš„æˆæƒ</p><blockquote><p>ä»£è¡¨æˆ‘å¯¹æˆ‘é‚»å±…èƒ½å¤Ÿç»§ç»­é€šå‘Šçš„æˆæƒï¼Œæˆ‘è®¤è¯äº†æˆ‘çš„é‚»å±…ï¼›è¿™æ ·æˆ‘æ²¡è®¤è¯çš„é‚»å±…æ”¶åˆ°äº†é€šå‘Šåæ˜¯ä¸èƒ½æ›´æ”¹æˆ–éšæ„è½¬å‘çš„ï¼›</p></blockquote><h3 id="s-bgp-è·¯ç”±è®¤è¯æ–¹æ³•"><a class="markdownIt-Anchor" href="#s-bgp-è·¯ç”±è®¤è¯æ–¹æ³•"></a> S-BGP è·¯ç”±è®¤è¯æ–¹æ³•ï¼š</h3><p>1ã€æå–è·¯ç”±ä¿¡æ¯ä¸­çš„ IP å‰ç¼€ï¼Œä»å…¶ä»–åœ°æ–¹è·å–ä¸è¯¥ IP å‰ç¼€ç»‘å®šçš„ ISP è¯ä¹¦å’Œåœ°å€è¯æ˜ï¼Œç”¨ ISP çš„å…¬é’¥éªŒè¯åœ°å€è¯æ˜ï¼Œå°±å¯è¯å®è·¯ç”±çš„ Origin AS æ˜¯å¦å…·æœ‰é€šå‘Šè¯¥å‰ç¼€çš„åˆæ³•æˆæƒ</p><p>2ã€å¯¹äº AS_PATH çš„è®¤è¯ï¼Œåˆ™ä½¿ç”¨ AS_PATH ä¸­æ¯ä¸€è·³ AS çš„è·¯ç”±å™¨è¯ä¹¦æ¥å¯¹è·¯ç”±æ¶ˆæ¯ä¸­æºå¸¦çš„è·¯ç”±è¯æ˜é€ä¸ªéªŒè¯ï¼Œä»¥è¯å®è¯¥ AS_PATH ç¡®å®å¯ä¿¡</p><p>Tipsï¼šS-BGP è™½ç„¶æˆåŠŸåœ°è§£å†³äº†è·¯ç”±è®¤è¯é—®é¢˜ï¼Œä¸è¿‡ä¹Ÿç›¸åº”åœ°å¸¦æ¥è®¡ç®—å¼€é”€å¤§ã€è·¯å¾„æ”¶æ•›æ—¶é—´å»¶é•¿çš„é—®é¢˜ï¼Œæ›´åŠ ä¸Šå»ºç«‹ PKI éœ€è¦ IANAã€RIRã€ISP ä»¥åŠè·¯ç”±å™¨å‚å•†çš„å…±åŒå‚ä¸ï¼Œè‡´ä½¿ S-BGP å§‹ç»ˆæœªèƒ½å®é™…éƒ¨ç½²</p><h2 id="moas-list"><a class="markdownIt-Anchor" href="#moas-list"></a> MOAS List</h2><p>MOASï¼ŒMulti-Origin ASï¼Œå†²çªï¼šä¸€ä¸ªå‰ç¼€ï¼ŒPrefixï¼ŒåŒ¹é…å¤šä¸ª Origin AS çš„è¡Œä¸º</p><blockquote><p>ä¹Ÿå°±æ˜¯æœ‰å¤šä¸ªæº AS å¯¹å‰ç¼€ P</p></blockquote><h3 id="åŸºæœ¬æ€æƒ³"><a class="markdownIt-Anchor" href="#åŸºæœ¬æ€æƒ³"></a> åŸºæœ¬æ€æƒ³</h3><p>åˆ›å»ºä¸€ä¸ªåŒ…å«æ‰€æœ‰æˆæƒé€šå‘ŠæŸä¸€å‰ç¼€çš„ Origin AS çš„åˆ—è¡¨ï¼ŒMOAS listï¼Œå°†è¯¥åˆ—è¡¨é™„äºæ¯ä¸€æˆæƒ AS çš„è·¯ç”±é€šå‘Šä¸­ï¼Œå½“å…¶ä»–è·¯ç”±å™¨æ¥æ”¶åˆ°å…³äºè¿™ä¸€å‰ç¼€çš„æ‰€æœ‰è·¯ç”±é€šå‘Šæ—¶ï¼Œæ¯”è¾ƒé€šå‘Šä¸­çš„ MOAS List æ˜¯å¦ä¸€è‡´ï¼Œä»¥æ­¤åˆ¤æ–­æ˜¯å¦å‘ç”Ÿäº†å‰ç¼€åŠ«æŒ</p><h3 id="æœ‰æ•ˆæ€§è¯æ˜"><a class="markdownIt-Anchor" href="#æœ‰æ•ˆæ€§è¯æ˜"></a> æœ‰æ•ˆæ€§è¯æ˜</h3><p>MOAS List æŠ€æœ¯ä¹‹æ‰€ä»¥æœ‰æ•ˆï¼Œä¸»è¦åœ¨äº Internet æ˜¯ä¸€ä¸ªé«˜åº¦äº’è”çš„ mesh ç½‘ç»œï¼Œæ— è®ºæ˜¯å› æ¶æ„æ”»å‡»è¿˜æ˜¯å› ç®¡ç†å‘˜è¯¯é…æ‰€äº§ç”Ÿçš„å‰ç¼€åŠ«æŒï¼Œç”±äº BGP è·¯ç”±ä¼ æ’­çš„å¤šè·¯å¾„ç‰¹æ€§ï¼Œé”™è¯¯çš„ MOAS List å’Œæ­£ç¡®çš„ MOAS List æœ€ç»ˆéƒ½ä¼šè¢«æ¥æ”¶è·¯ç”±å™¨æ”¶åˆ°ï¼Œä¸¤è€…çš„ä¸ä¸€è‡´å°±ä¼šä½¿æ¥æ”¶è·¯ç”±å™¨æ„è¯†åˆ°å‘ç”Ÿäº†å‰ç¼€åŠ«æŒäº‹ä»¶</p>]]></content>
      
      
      <categories>
          
          <category> Protocol Security </category>
          
      </categories>
      
      
        <tags>
            
            <tag> security </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>OSPF Protocol and Security</title>
      <link href="/Coming-blog/2021/12/06/ospf-protocol-and-security/"/>
      <url>/Coming-blog/2021/12/06/ospf-protocol-and-security/</url>
      
        <content type="html"><![CDATA[<h1 id="ospf"><a class="markdownIt-Anchor" href="#ospf"></a> OSPF</h1><p>Open Shorted Path Firstï¼Œå¼€æ”¾æœ€çŸ­è·¯å¾„ä¼˜å…ˆï¼Œæ˜¯ IETF å¼€å‘çš„åŸºäºé“¾è·¯çŠ¶æ€çš„è‡ªæ²»ç³»ç»Ÿå†…éƒ¨è·¯ç”±åè®®ï¼Œç›´æ¥å·¥ä½œäº IP å±‚ä¹‹ä¸Šï¼ŒIP åè®®å·ä¸º 89ï¼›ä»¥<strong>ç»„æ’­</strong>åœ°å€å‘é€åè®®æ•°æ®åŒ…</p><p><strong>ä¼˜åŠ¿</strong>ï¼šä»…ä¼ æ’­å¯¹ç«¯è®¾å¤‡ä¸å…·å¤‡çš„è·¯ç”±ä¿¡æ¯ï¼Œç½‘ç»œæ”¶æ•›è¿…é€Ÿï¼Œå¹¶æœ‰æ•ˆé¿å…äº†ç½‘ç»œèµ„æºæµªè´¹</p><h2 id="åè¯é€Ÿè§ˆ"><a class="markdownIt-Anchor" href="#åè¯é€Ÿè§ˆ"></a> åè¯é€Ÿè§ˆ</h2><p>1ã€DRï¼ŒæŒ‡å®šè·¯ç”±å™¨</p><p>2ã€BDRï¼Œå¤‡é€‰æŒ‡å®šè·¯ç”±å™¨</p><p>3ã€DRothersï¼Œç›¸äº’ä¹‹é—´è™½ç„¶ä¸ºé‚»å±…ï¼Œå´ä¸ä¼šå»ºç«‹å®Œå…¨é‚»æ¥å…³ç³»ï¼Œä¹Ÿä¸ä¼šç›´æ¥å…±äº«é“¾è·¯çŠ¶æ€ä¿¡æ¯</p><p>4ã€LSAï¼Œé“¾è·¯çŠ¶æ€é€šå‘Š</p><p>5ã€ABRã€åŒºåŸŸè¾¹ç•Œè·¯ç”±å™¨</p><h2 id="rip-è‡ªèº«ç¼ºé™·"><a class="markdownIt-Anchor" href="#rip-è‡ªèº«ç¼ºé™·"></a> RIP è‡ªèº«ç¼ºé™·</h2><p>1ã€ä»¥è·³æ•°æ¥è¯„ä¼°çš„è·¯ç”±å¹¶éæœ€ä¼˜è·¯ç”±ï¼ˆå¹¶æ²¡æœ‰è€ƒè™‘çº¿è·¯çš„å¸¦å®½ï¼‰</p><p>2ã€æœ€å¤§è·³æ•°ï¼ˆ16ï¼Œä¸ºäº†é¿å…ç¯è·¯çš„ä¸€ç§æœºåˆ¶ï¼‰é™åˆ¶ç½‘ç»œç›´å¾„ä¸èƒ½è¶…è¿‡ 16 è·³ï¼Œå¯¼è‡´ç½‘ç»œå°ºåº¦è¿‡å°</p><p>3ã€æ”¶æ•›é€Ÿåº¦æ…¢ï¼ˆæŠ‘åˆ¶æ—¶é—´é˜»æ­¢äº†é”™è¯¯æ›´æ–°çš„åŒæ—¶ä¹Ÿå°†é˜»æ­¢æ­£ç¡®æ›´æ–°ï¼‰</p><p>4ã€æ›´æ–°å‘é€å…¨éƒ¨è·¯ç”±è¡¨æµªè´¹ç½‘ç»œèµ„æº</p><h2 id="ospf-æŠ¥æ–‡æ ¼å¼"><a class="markdownIt-Anchor" href="#ospf-æŠ¥æ–‡æ ¼å¼"></a> OSPF æŠ¥æ–‡æ ¼å¼</h2><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/20211128203653.png" alt="OSPF æŠ¥æ–‡æ ¼å¼" /></p><h3 id="åŒºåŸŸ"><a class="markdownIt-Anchor" href="#åŒºåŸŸ"></a> åŒºåŸŸ</h3><p>ä¸ºè§£å†³æ‹“æ‰‘å’Œè·¯ç”±è®¡ç®—å¤æ‚åº¦éšç½‘ç»œè§„æ¨¡å¢å¤§è€Œæ€¥å‰§å¢å¤§çš„é—®é¢˜ï¼ŒOSPFå®šä¹‰äº†åŒºåŸŸçš„æ¦‚å¿µï¼Œå®ç°äº†<strong>è·¯ç”±ç½‘ç»œçš„å±‚çº§åŒ–</strong></p><h3 id="authentication"><a class="markdownIt-Anchor" href="#authentication"></a> Authentication</h3><p>å…¶å†…å®¹æ˜¯æ ¹æ® AuType æ¥å®šä¹‰çš„ï¼š</p><p>1ã€ä¸è®¤è¯ï¼ˆAuType=0ï¼‰æ—¶ Authentication ä¸ºç©ºï¼›</p><p>2ã€ç®€å•è®¤è¯ï¼ˆAuType=1ï¼‰æ—¶ Authentication ä¸ºå¯†ç /å£ä»¤ä¿¡æ¯ï¼›</p><p>3ã€MD5 è®¤è¯ï¼ˆAuType=2ï¼‰æ—¶ Authentication åŒ…æ‹¬ Key IDï¼ŒMD5 éªŒè¯æ•°æ®é•¿åº¦å’Œåºåˆ—å·çš„ä¿¡æ¯</p><blockquote><p>Key IDï¼šå¯†é’¥æ˜¯ç»å¸¸æ”¹å˜çš„ï¼Œéœ€è¦å¯¹å…¶è¿›è¡Œç¼–å·ç´¢å¼•ï¼Œä½¿ç”¨ç´¢å¼•å»è·å–è¯¦ç»†åŠ å¯†ä¿¡æ¯åºåˆ—å·ï¼šé’ˆå¯¹æ¯æ¬¡å‘é€çš„æ¶ˆæ¯è¿›è¡Œçš„ç¼–å·ï¼ˆé˜²é‡æ”¾ï¼‰ï¼Œå°†åºåˆ—ä¿¡æ¯å’Œå¯†é’¥è¿›è¡Œç¦»æ•£ç¼–å·åä¼ è¾“</p></blockquote><h2 id="ospfåè®®å·¥ä½œè¿‡ç¨‹"><a class="markdownIt-Anchor" href="#ospfåè®®å·¥ä½œè¿‡ç¨‹"></a> OSPFåè®®å·¥ä½œè¿‡ç¨‹</h2><p>ä¸»è¦æœ‰å››ä¸ªé˜¶æ®µï¼šå¯»æ‰¾é‚»å±…ã€å»ºç«‹é‚»æ¥å…³ç³»ã€é“¾è·¯çŠ¶æ€ä¿¡æ¯ä¼ é€’ã€è®¡ç®—è·¯ç”±</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/20211128204301.png" alt="OSPFåè®®å·¥ä½œè¿‡ç¨‹" /></p><h3 id="å¯»æ‰¾é‚»å±…"><a class="markdownIt-Anchor" href="#å¯»æ‰¾é‚»å±…"></a> å¯»æ‰¾é‚»å±…</h3><p>ç»´æŠ¤é‚»å±…è¡¨ï¼ˆé‚»å±… IDï¼Œé‚»å±…åœ°å€ï¼Œé‚»å±…çŠ¶æ€ï¼‰ï¼š</p><p>1ã€éƒ½å¹¿æ’­ Hello åŒ…ï¼Œå°è¯•å¯»æ‰¾å¯äº¤æ¢è·¯ç”±ä¿¡æ¯çš„é‚»å±…ï¼ˆå‘¨è¾¹è®¾å¤‡ï¼‰</p><p>2ã€æ”¶åˆ°å¯¹æ–¹çš„ Hello åŒ…åæ›´æ–°é‚»å±…è¡¨ï¼Œé‚»å±…çŠ¶æ€ç½®ä¸º init çŠ¶æ€</p><p>3ã€Hello åŒ…ä¸­æºå¸¦çš„å‚æ•°å¼€å§‹åå•†ï¼Œå¦‚æœåå•†æˆåŠŸåˆ™å°†é‚»å±…çŠ¶æ€ç½®ä¸º 2-way çŠ¶æ€</p><blockquote><p>é‚»å±…çŠ¶æ€è¾¾åˆ° 2-way çŠ¶æ€åï¼ŒRTA ä¸ RTB ä¹‹é—´å¼€å§‹å»ºç«‹é‚»æ¥å…³ç³»</p></blockquote><h3 id="å»ºç«‹é‚»æ¥å…³ç³»"><a class="markdownIt-Anchor" href="#å»ºç«‹é‚»æ¥å…³ç³»"></a> å»ºç«‹é‚»æ¥å…³ç³»</h3><p>DRï¼ŒæŒ‡å®šè·¯ç”±å™¨ï¼Œè¯¥è·¯ç”±å™¨ä¼šä¸æ‰€æœ‰é‚»å±…å»ºç«‹å¯ä»¥ç›¸äº’å…±äº«é“¾è·¯çŠ¶æ€ä¿¡æ¯çš„å®Œå…¨é‚»æ¥ï¼ˆFullï¼‰å…³ç³»</p><p>BDRï¼Œå¤‡é€‰æŒ‡å®šè·¯ç”±å™¨ï¼Œä¸ DR ä¸€è‡´ï¼Œé˜²æ­¢ DR æŒ‚æ‰</p><p>DRothersï¼Œç›¸äº’ä¹‹é—´è™½ç„¶ä¸ºé‚»å±…ï¼Œå´ä¸ä¼šå»ºç«‹å®Œå…¨é‚»æ¥å…³ç³»ï¼Œä¹Ÿä¸ä¼šç›´æ¥å…±äº«é“¾è·¯çŠ¶æ€ä¿¡æ¯</p><p>1ã€åˆå§‹çš„é‚»æ¥å…³ç³»ä¸ºæ€»çº¿æ¨¡å‹ï¼šå®Œå…¨å›¾ (n(n-1)/2)</p><p>2ã€é‡‡ç”¨ DR / BDR æ–¹å¼å»ºç«‹é‚»æ¥å…³ç³»ï¼š(2 * (n-2) + 1)</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/20211128210401.png" alt="å»ºç«‹é‚»æ¥å…³ç³»" /></p><p>Qï¼šä¸ºä»€ä¹ˆéœ€è¦ DR å’Œ BDR ï¼Ÿ</p><p>Aï¼šåˆå§‹çš„å…¨è¿æ¥é‚»æ¥å…³ç³»å­˜åœ¨ç€å¤§é‡çš„æ€§èƒ½æµªè´¹ï¼›æ‰€ä»¥é€šè¿‡é€‰ä¸¾ DR ä¸ BDR çš„æ–¹å¼å‡å°‘è·¯ç”±ä¿¡æ¯äº¤æ¢çš„æ•°ç›®ï¼Œå‡å°‘ç½‘ç»œä¸­ä¼ é€’è·¯ç”±ä¿¡æ¯çš„å¼€é”€ï¼›</p><p>Qï¼šå¦‚ä½•é€‰ä¸¾ï¼Ÿ</p><p>Aï¼šHello åŒ…æºå¸¦è·¯ç”±å™¨ä¼˜å…ˆçº§ï¼Œä¼˜å…ˆçº§ä¸º 0 çš„è·¯ç”±å™¨ä¸å…·å¤‡é€‰ä¸¾èµ„æ ¼ï¼›å…ˆé€‰ä¸¾ BDRï¼Œå†é€‰ä¸¾ DRï¼›</p><blockquote><p>DR å’Œ BDRä¸€æ—¦é€‰å®šï¼Œå³ä½¿ OSPF åŒºåŸŸå†…æ–°å¢ä¼˜å…ˆçº§æ›´é«˜çš„è·¯ç”±å™¨ï¼ŒDR å’Œ BDRä¹Ÿä¸é‡æ–°é€‰ä¸¾ï¼Œåªæœ‰å½“ DR å’Œ BDR éƒ½å¤±æ•ˆåï¼Œæ‰å‚ä¸é€‰ä¸¾ (ä¿è¯ç½‘ç»œçš„ç¨³å®š)</p></blockquote><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/20211206110834.png" alt="DRé€‰ä¸¾" /></p><h3 id="é“¾è·¯çŠ¶æ€ä¿¡æ¯ä¼ é€’"><a class="markdownIt-Anchor" href="#é“¾è·¯çŠ¶æ€ä¿¡æ¯ä¼ é€’"></a> é“¾è·¯çŠ¶æ€ä¿¡æ¯ä¼ é€’</h3><p>1ã€è§¦å‘æ›´æ–°æ—¶ï¼Œå‘é€ RTA å…·å¤‡çš„ LSA(é“¾è·¯çŠ¶æ€é€šå‘Šï¼Œç•¥) <strong>æ¦‚è¦</strong>ç»™ RTB</p><p>2ã€RTB åˆ†ææ¯”è¾ƒ RTA ä¸ RTB çš„é“¾è·¯ä¿¡æ¯</p><p>3ã€RTB å‘é€è¯·æ±‚ï¼Œè¦æ±‚è·å¾— RTB ä¸å…·å¤‡çš„ LSA</p><p>4ã€RTA å°† RTB è¯·æ±‚çš„ LSA å‘ç»™ RTB</p><p>5ã€åŒç† RTA ä¹Ÿé€šè¿‡ç›¸åŒæ–¹å¼è·å– RTB çš„ LSA</p><p>6ã€åŒæ–¹é‚»å±…çŠ¶æ€å˜æ›´ä¸ºå®Œå…¨è¿æ¥å…³ç³»</p><p>Tipsï¼š</p><p>1ã€OSPF åè®®åŒ…å…·å¤‡è¶…æ—¶é‡ä¼ æœºåˆ¶ï¼Œåœ¨è§„å®šæ—¶é—´å†…æ²¡æœ‰æ”¶åˆ°å›åº”ï¼Œè®¤ä¸ºåŒ…ä¸¢å¤±ï¼Œé‡å‘åŒ…ï¼</p><p>2ã€OSPF åè®®åŒ…å…·å¤‡åºåˆ—å·ï¼Œå¯¹é‡å¤åŒ…ä¸åšå¤„ç†</p><p>3ã€LSA(é“¾è·¯çŠ¶æ€é€šå‘Š)æ›´æ–°æºå¸¦<strong>æ©ç </strong>ï¼Œæ”¯æŒ VLSM</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/20211128211414.png" alt="è¶…æ—¶é‡ä¼ æœºåˆ¶" /></p><h3 id="è·¯ç”±è®¡ç®—"><a class="markdownIt-Anchor" href="#è·¯ç”±è®¡ç®—"></a> è·¯ç”±è®¡ç®—</h3><p>1ã€ç»è¿‡é“¾è·¯çŠ¶æ€ä¿¡æ¯ä¼ é€’åï¼Œæ¯å°è·¯ç”±å™¨ä¸­éƒ½å­˜å‚¨äº† LSDB</p><p>2ã€ç”± LSDB ç”Ÿæˆå¸¦æƒæœ‰å‘å›¾</p><blockquote><p>æƒå€¼ä¼šç»¼åˆè€ƒè™‘æ—¶å»¶ï¼Œå¸¦å®½ï¼Œä¸¢åŒ…ç‡ç­‰</p></blockquote><p>3ã€æ¯å°è·¯ç”±å™¨åˆ†åˆ«ä»¥è‡ªå·±ä¸ºæ ¹èŠ‚ç‚¹è®¡ç®—æœ€å°ç”Ÿæˆæ ‘</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/20211128211752.png" alt="è·¯ç”±è®¡ç®—" /></p><h1 id="ospf-å®‰å…¨æœºåˆ¶"><a class="markdownIt-Anchor" href="#ospf-å®‰å…¨æœºåˆ¶"></a> OSPF å®‰å…¨æœºåˆ¶</h1><h2 id="ospf-è®¤è¯æœºåˆ¶"><a class="markdownIt-Anchor" href="#ospf-è®¤è¯æœºåˆ¶"></a> OSPF è®¤è¯æœºåˆ¶</h2><p>1ã€OSPF æ”¯æŒå¯¹æŠ¥æ–‡è¿›è¡Œç®€å•è®¤è¯ä¸ md5 è®¤è¯ï¼ˆæŠ¥æ–‡æ ¼å¼ä¸­ï¼‰ï¼Œä¸ RIPv1 ä¸ä¸€æ ·ï¼Œé˜²èŒƒäº†è·¯ç”±æ¬ºéª—æ”»å‡»</p><p>2ã€OSPF æŠ¥æ–‡è¿›è¡Œç®€å•è®¤è¯æ—¶ï¼ŒéªŒè¯å­—æ®µå°†ä¿å­˜ä¸€ä¸ªæ˜æ–‡å£ä»¤ï¼Œè¯¥å£ä»¤å¾ˆå®¹æ˜“è¢«è·å–ï¼ŒåŒæ ·å®¹æ˜“é­å—è·¯ç”±æ¬ºéª—æ”»å‡»ï¼›å› æ­¤å¼•å…¥äº†æ›´åŠ å®‰å…¨çš„ MD5 éªŒè¯</p><p>3ã€MD5 è®¤è¯ï¼š</p><blockquote><p>aã€åœ¨ç›¸é‚»è·¯ç”±å™¨ä¸­é…ç½®ç›¸åŒçš„å…±äº«å¯†é’¥bã€ç”¨å…±äº«å¯†é’¥åŠ å¯†æŠ¥æ–‡åºåˆ—å·cã€ç”±å…±äº«å¯†é’¥å’Œè·¯ç”±æ¶ˆæ¯å…±åŒç”Ÿæˆ MACï¼ˆæ¶ˆæ¯é‰´åˆ«ç ï¼‰ï¼Œåˆ¤æ–­ä¸å‘é€æ¥çš„ MAC æ˜¯å¦ä¸€è‡´</p></blockquote><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/20211128212402.png" alt="MD5 è®¤è¯" /></p><p>Qï¼šOSPF MD5 è®¤è¯ä¸ RIPv2 MD5 è®¤è¯æœ‰ä½•ä¸åŒï¼Ÿ</p><p>Aï¼šOSPF MD5 è®¤è¯åœ¨ RIPv2 MD5 è®¤è¯æ–¹å¼çš„åŸºç¡€ä¸Šé¢å¤–æ”¯æŒäº†åŠ å¯†è®¤è¯çš„ HMAC æ–¹å¼ï¼Œå°†æ•°æ®å’Œç§˜é’¥ä¸€èµ·è®¡ç®—å¾—åˆ° HMAC å€¼åŒæ•°æ®ä¸€èµ·å‘é€ï¼Œå¯¹æ–¹æ¥åˆ°ä¹‹åï¼Œä½¿ç”¨è‡ªå·±æ‰‹ä¸­çš„ç§˜é’¥æŠŠæ¶ˆæ¯è®¡ç®—ä¸€ä¸‹ HMACï¼Œå¦‚æœæ¥æ”¶åˆ°çš„ HMAC ä¸€è‡´ï¼Œé‚£ä¹ˆå¯ä»¥è®¤ä¸ºè¿™ä¸ªæ¶ˆæ¯æ—¢æ²¡æœ‰è¢«ç¯¡æ”¹ä¹Ÿæ²¡æœ‰å†’å……ï¼›ç›¸æ¯”æ¥è¯´ OSPF çš„è®¤è¯æ–¹å¼æ›´ä¸ºå®‰å…¨</p><h2 id="å±‚æ¬¡åŒ–è·¯ç”±"><a class="markdownIt-Anchor" href="#å±‚æ¬¡åŒ–è·¯ç”±"></a> å±‚æ¬¡åŒ–è·¯ç”±</h2><p>ä¸€ä¸ªè¿è¡Œ OSPF åè®®çš„è‡ªæ²»ç³»ç»Ÿå¯åˆ’åˆ†ä¸º<strong>éª¨å¹²åŒºåŸŸ</strong>å’Œè‹¥å¹²<strong>ééª¨å¹²åŒºåŸŸ</strong>ï¼Œå„ééª¨å¹²åŒºåŸŸé€šè¿‡åŒºåŸŸè¾¹ç•Œè·¯ç”±å™¨ï¼ˆABRï¼‰ä¸éª¨å¹²åŒºåŸŸç›¸è¿</p><blockquote><p>è¿›è¡Œç½‘ç»œæµ‹ç»˜çš„é€šä¿¡éƒ½ä¼šåœ¨è¾¹ç•Œè·¯ç”±å™¨å¤„è¢«æ‹¦æˆªï¼Œæ— æ³•è·å–éª¨å¹²åŒºåŸŸå†…çš„ LSDB ä¿¡æ¯</p></blockquote><p>æ¯ä¸ªåŒºåŸŸå„è‡ªæ‹¥æœ‰è‡ªå·±çš„ LSDBï¼Œå„è‡ªåœ¨æœ¬åŒºåŸŸå†…æ‰§è¡Œé“¾è·¯çŠ¶æ€è·¯ç”±ç®—æ³•ï¼Œä½¿å¾—æœ¬åŒºåŸŸå†…æ‹“æ‰‘å¯å¯¹åŒºåŸŸå¤–ç½‘ç»œå±è”½ï¼ŒåŒæ—¶ä¸å—å…¶ä»–åŒºåŸŸé”™è¯¯è·¯ç”±ä¿¡æ¯çš„å½±å“</p><h2 id="å¯é æ³›æ´ª"><a class="markdownIt-Anchor" href="#å¯é æ³›æ´ª"></a> å¯é æ³›æ´ª</h2><p>æ³›æ´ªï¼šå°†ä»æŸä¸ªæ¥å£æ”¶åˆ°çš„æ•°æ®æµå‘é™¤è¯¥æ¥å£ä¹‹å¤–çš„æ‰€æœ‰æ¥å£å‘é€å‡ºå»</p><p>OSPF åè®®é€šè¿‡æ³›æ´ªè¿›è¡Œ LSA(é“¾è·¯çŠ¶æ€é€šå‘Š) ä¼ æ’­ï¼Œä½¿ç”¨ç±»ä¼¼ TCP çš„ç¡®è®¤é‡ä¼ æœºåˆ¶ä¿è¯å¯é æ€§ï¼Œç¡®ä¿åŒä¸€åŒºåŸŸå†…è·¯ç”±å™¨æœ‰åŒæ ·çš„ LSDBï¼Œä»è€Œè®¡ç®—è·¯ç”±ä¸€è‡´</p><h2 id="åå‡»æœºåˆ¶"><a class="markdownIt-Anchor" href="#åå‡»æœºåˆ¶"></a> åå‡»æœºåˆ¶</h2><p>å½“è·¯ç”±å™¨æ”¶åˆ°è‡ªå·±å‘é€æˆ–ä»¥è‡ªå·±åä¹‰å‘é€çš„ LSA æ¯”å½“å‰ç”Ÿæˆçš„å®ä¾‹æ–°ä¸”æè¿°ä¿¡æ¯ä¸è‡ªèº«è·çŸ¥ä¸ä¸€è‡´æ—¶ï¼Œå°†ç«‹å³é€šå‘Šä¸€ä¸ªå«æœ‰æ­£ç¡®é“¾è·¯çŠ¶æ€ä¸”<strong>å¤§é“¾è·¯åºå·</strong>çš„ LSA æ–°å®ä¾‹ï¼Œä»¥çº æ­£é”™è¯¯</p><blockquote><p>åå‡»æœºåˆ¶ä½¿æ¶æ„ç”¨æˆ·ä¼ªé€ çš„ LSA å¾ˆéš¾è¢«å…¶ä»–è·¯ç”±å™¨ä½¿ç”¨ï¼Œä»è€Œå¾ˆéš¾å½±å“è·¯ç”±é€‰æ‹©</p></blockquote><h2 id="åŒå‘è¿æ¥"><a class="markdownIt-Anchor" href="#åŒå‘è¿æ¥"></a> åŒå‘è¿æ¥</h2><p>åªæœ‰å½“ä¸€æ¡é“¾æ¥åŒæ—¶è¢«è¿æ¥ä¸¤ç«¯çš„è·¯ç”±å™¨é€šå‘Šæ—¶ï¼Œæ‰ä¼šè€ƒè™‘æ”¾å…¥ LSDB</p><blockquote><p>æ¶æ„ç”¨æˆ·å‘ç›¸é‚»è·¯ç”±å™¨é€šå‘Šä¸€æ¡ä¸å­˜åœ¨çš„é“¾æ¥ï¼Œä¸ä¼šå¯¹è·¯ç”±è¡¨äº§ç”Ÿå½±å“ï¼Œå› æ— å…¶ä»–è·¯ç”±å™¨åŒæ—¶é€šå‘Šè¯¥é“¾æ¥</p></blockquote><h1 id="ospf-å®‰å…¨å¨èƒ"><a class="markdownIt-Anchor" href="#ospf-å®‰å…¨å¨èƒ"></a> OSPF å®‰å…¨å¨èƒ</h1><h2 id="å‘¨æœŸæ€§æ³¨å…¥"><a class="markdownIt-Anchor" href="#å‘¨æœŸæ€§æ³¨å…¥"></a> å‘¨æœŸæ€§æ³¨å…¥</h2><p>Backdropï¼šOSPF åè®®è§„å®šè·¯ç”±å™¨ LSDB ä¿å­˜çš„ LSA åˆ·æ–°é—´éš” <code>â‰¥5S</code>ï¼Œä¸”å…·æœ‰åå‡»æœºåˆ¶ï¼Œå› æ­¤æ¶æ„ç”¨æˆ·æ³¨å…¥çš„æ¶æ„ LSA å¾ˆå¿«ä¼šè¢«åˆ·æ–°å’Œæ›¿æ¢ï¼Œæ— æ³•äº§ç”ŸæŒä¹…æ•ˆæœ</p><p>ä½†æ¶æ„ç”¨æˆ·ä¸æ–­ç”¨æ¶æ„ LSA æ›´æ–°è·¯ç”±å™¨çš„ LSDBï¼ˆå‘¨æœŸæ€§æ³¨å…¥ï¼‰ï¼Œå¯èƒ½ä¼šå¯¼è‡´ç½‘ç»œä¸ç¨³å®šï¼Œæ¶ˆè€—å¤§é‡èµ„æºï¼Œé€ æˆæ‹’ç»æœåŠ¡æ”»å‡»ï¼Œä»è€Œå¯èƒ½æ›´æ”¹è·¯ç”±è¡¨</p><blockquote><p>ç„¶è€Œæ¶æ„ç”¨æˆ·éœ€ä¸æ–­å‘é€æ›´æ”¹çš„ LSAï¼Œå®æ–½æ¶æ„è¡Œä¸ºæœ¬èº«éš¾åº¦è¾ƒå¤§ï¼Œä¸”å¢åŠ ç½‘ç»œæµé‡ï¼Œæ˜“è¢«å‘ç°</p></blockquote><h2 id="åˆ†å—æ³¨å…¥"><a class="markdownIt-Anchor" href="#åˆ†å—æ³¨å…¥"></a> åˆ†å—æ³¨å…¥</h2><p>å¦‚æ¶æ„ç”¨æˆ·æ§åˆ¶çš„è·¯ç”±å™¨æ‰€å¤„ä½ç½®å°†åŒºåŸŸåˆ†ä¸º 2 ä¸ªå­åŒºåŸŸï¼Œåˆ™è¯¥ç”¨æˆ·å¯ä»¥ç”¨ä¸€ä¸ªå­åŒºåŸŸä¸­æŸè·¯ç”±å™¨èº«ä»½å‘å¦ä¸€ä¸ªå­åŒºåŸŸæ³¨å…¥è™šå‡ LSAï¼Œä»è€Œé¿å¼€ OSPF åè®®åå‡»æœºåˆ¶ï¼ˆå¦ä¸€ä¸ªåŒºåŸŸå†…çš„ä¼ æ’­ä¸ä¼šä¼ é€’åˆ°å®˜æ–¹è·¯ç”±å™¨ä¸­ - ä¸åœ¨ä¸€ä¸ªåŒºåŸŸï¼‰</p><blockquote><p>è¯¥å¨èƒä»…å½±å“è‡ªæ²»ç³»ç»Ÿçš„ä¸€éƒ¨åˆ†ï¼Œä¸”å¯¹æ¶æ„ç”¨æˆ·æ‰€å¤„ä½ç½®æœ‰é™åˆ¶ï¼Œè€Œç°å®ä¸­è¿™ç§æƒ…å†µå¹¶ä¸å¸¸è§</p></blockquote><h2 id="å¹»å½±è·¯ç”±å™¨"><a class="markdownIt-Anchor" href="#å¹»å½±è·¯ç”±å™¨"></a> å¹»å½±è·¯ç”±å™¨</h2><p>æ¶æ„ç”¨æˆ·è™šæ„ä¸€ä¸ªä¸å­˜åœ¨çš„è·¯ç”±å™¨ï¼Œå³å¹»å½±è·¯ç”±å™¨ï¼Œä»¥å¹»å½±è·¯ç”±å™¨èº«ä»½æ³¨å…¥å¤§é‡è™šå‡ä¿¡æ¯ï¼Œåˆ™ä¸ä¼šè§¦å‘åå‡»æœºåˆ¶</p><blockquote><p>ä½†ç”±äºåŒå‘é“¾æ¥æœºåˆ¶ï¼Œæ³¨å…¥çš„ LSA ä¸ä¸€å®šå‚ä¸è·¯ç”±è®¡ç®—ï¼Œé™¤éè¯¥å¹»å½±è·¯ç”±å™¨ä¸æŸæ­£å¸¸è·¯ç”±å™¨å½¢æˆé‚»æ¥å…³ç³»è¯¥å¨èƒéœ€å»ºç«‹é‚»æ¥å…³ç³»ï¼Œå› è€Œå®æ–½éš¾åº¦è¾ƒå¤§</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> Protocol Security </category>
          
      </categories>
      
      
        <tags>
            
            <tag> security </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>RIP Protocol and Security</title>
      <link href="/Coming-blog/2021/12/06/rip-protocol-and-security/"/>
      <url>/Coming-blog/2021/12/06/rip-protocol-and-security/</url>
      
        <content type="html"><![CDATA[<h1 id="rip"><a class="markdownIt-Anchor" href="#rip"></a> RIP</h1><p>RIPï¼ŒRouting Information Protocolï¼Œè·¯ç”±ä¿¡æ¯åè®®ï¼Œæ˜¯ä¸€ç§è·ç¦»çŸ¢é‡è·¯ç”±åè®®ï¼ŒåŸºäº UDP ä¼ è¾“ï¼Œç«¯å£å· 520</p><blockquote><p>é€‚ç”¨äºå°å‹ç½‘ç»œ</p></blockquote><h2 id="rip-æŠ¥æ–‡æ ¼å¼-v2"><a class="markdownIt-Anchor" href="#rip-æŠ¥æ–‡æ ¼å¼-v2"></a> RIP æŠ¥æ–‡æ ¼å¼ (v2)</h2><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/20211128171804.png" alt="RIPæŠ¥æ–‡æ ¼å¼" /></p><h2 id="rip-å·¥ä½œè¿‡ç¨‹"><a class="markdownIt-Anchor" href="#rip-å·¥ä½œè¿‡ç¨‹"></a> RIP å·¥ä½œè¿‡ç¨‹</h2><p>1ã€è·¯ç”±å™¨åˆå§‹å¯åŠ¨ï¼Œå‘ç°ç›´è¿ç½‘æ®µï¼ˆå“ªä¸ªæ¥å£å¯¹åº”å“ªä¸ªåœ°å€ï¼‰</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/20211128172017.png" alt="RIP1" /></p><p>2ã€é‚»å±…äº’ç›¸å‘èµ·è¯·æ±‚ï¼Œäº¤æ¢è‡ªå·±çš„è·¯ç”±è¡¨å­¦ä¹ è‡ªå·±ä¸çŸ¥é“çš„ç½‘æ®µ</p><blockquote><p>ç›´åˆ°æ”¶æ•›ï¼šå³å½“æ‰€æœ‰è·¯ç”±è¡¨éƒ½åŒ…å«ç›¸åŒçš„ç½‘ç»œä¿¡æ¯ä¸”æ— æ–°ä¿¡æ¯æ—¶RIP åè®®æ‰€æ¥æ”¶çš„è·¯ç”±ä¿¡æ¯éƒ½æ˜¯å°è£…åœ¨ UDP åè®®çš„æ•°æ®åŒ…ä¸­çš„ï¼Œä½¿ç”¨ UDP çš„ 520 å·ç«¯å£æ¥æ”¶æ¥è‡ªç›¸é‚»è·¯ç”±å™¨çš„è·¯ç”±è¡¨ä¿¡æ¯ï¼Œå¹¶å¯¹æœ¬åœ°çš„è·¯ç”±è¡¨è¿›è¡Œç›¸åº”çš„ä¿®æ”¹Tipsï¼šç½‘è·¯åœ¨è·¯ç”±å™¨æ”¶æ•›ç»“æŸä¹‹å‰æ˜¯æ— æ³•å®Œæˆæ­£å¸¸å·¥ä½œçš„</p></blockquote><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/20211128172124.png" alt="RIP2" /></p><p>3ã€å‘¨æœŸæ€§å‘é€ Response ä¿¡æ¯ï¼Œç¡®ä¿è·¯ç”±çš„æœ‰æ•ˆæ€§</p><h2 id="metric-åº¦é‡å€¼"><a class="markdownIt-Anchor" href="#metric-åº¦é‡å€¼"></a> Metric åº¦é‡å€¼</h2><p>RIP æ˜¯ä»¥è·³æ•°ä½œä¸º metric çš„å”¯ä¸€æ ‡å‡†</p><p>åŒä¸€å°è·¯ç”±å™¨å¯èƒ½ä»ä¸åŒæ–¹å‘å­¦åˆ°å»å¾€åŒä¸€æ–¹å‘çš„è·¯ç”±ï¼Œæ­¤æ—¶å°±ä¼šæ¯”è¾ƒ Metric å€¼ï¼Œé€‰æ‹©æœ€ä¼˜çš„è·¯ç”±åŠ å…¥è·¯ç”±è¡¨</p><blockquote><p>æ¬¡ä¼˜æ¡ç›®ä¼šéšè—èµ·æ¥ä½œä¸ºå¤‡ç”¨ï¼Œåœ¨ä¼˜é€‰è·¯å¾„ Down æ‰ä¹‹åä¼šé‡æ–°è¡¡é‡å¤‡ç”¨ routeå½“ä¸¤æ¡ route çš„ metric ç›¸ç­‰æ—¶ï¼Œä¼šå½¢æˆè´Ÿè½½å‡è¡¡</p></blockquote><h1 id="rip-ç¯è·¯é—®é¢˜"><a class="markdownIt-Anchor" href="#rip-ç¯è·¯é—®é¢˜"></a> RIP ç¯è·¯é—®é¢˜</h1><p>RIP æ”¯æŒæ°´å¹³åˆ†å‰²ã€æ¯’æ€§é€†è½¬å’Œè§¦å‘æ›´æ–°ç­‰å·¥ä½œæœºåˆ¶é˜²æ­¢è·¯ç”±ç¯è·¯</p><h2 id="ç¯è·¯äº§ç”ŸåŸå› "><a class="markdownIt-Anchor" href="#ç¯è·¯äº§ç”ŸåŸå› "></a> ç¯è·¯äº§ç”ŸåŸå› </h2><p>è¿™å’Œ RIP æ£€æµ‹åˆ°æ‹“æ‰‘å˜åŒ–å¹¶åœ¨ç½‘ç»œä¸­æ‰©å±•çš„è¿‡ç¨‹æœ‰å…³ï¼š RIP å°†å…ˆæ›´æ–°è·¯ç”±è¡¨ï¼Œç­‰å¾…ä¸‹ä¸€ä¸ªå‘¨æœŸåœ¨ä¼ é€’æ›´æ–°</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/20211206100433.png" alt="æ‹“æ‰‘å˜åŒ–" /></p><h2 id="å•è·¯å¾„ç¯è·¯äº§ç”Ÿ"><a class="markdownIt-Anchor" href="#å•è·¯å¾„ç¯è·¯äº§ç”Ÿ"></a> å•è·¯å¾„ç¯è·¯äº§ç”Ÿ</h2><p>1ã€ä»¥çº¿æ€§è·¯ç”±ä¸ºä¾‹ï¼šæ­¤æ—¶ç½‘ç»œæ­£å¸¸æ”¶æ•›</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/20211128172756.png" alt="circle1" /></p><p>2ã€çªç„¶ <code>10.4.0.0</code> ç½‘æ®µå‘ç”Ÿé”™è¯¯ï¼ŒRTC è·¯ç”±å™¨æ£€æµ‹å‡ºæ¥åå…ˆæ›´æ–°è‡ªå·±çš„è·¯ç”±è¡¨ï¼šå°†ç›¸å…³è·¯ç”±è¡¨é¡¹åº”è¢«åˆ é™¤</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/20211128172928.png" alt="circle2" /></p><p>3ã€éšå RTC ç­‰å¾…ä¸‹ä¸€å‘¨æœŸå‘é€è·¯ç”±æ›´æ–°ä¿¡æ¯ï¼Œä½†æ˜¯æ­¤æ—¶ RTB çš„æ›´æ–°ä¿¡æ¯å…ˆæ¥åˆ°ï¼Œå°±æŠŠæ­£ç¡®çš„ä¿¡æ¯ç»™è¦†ç›–äº†</p><blockquote><p>RTB ä» RTC å­¦çš„èƒ½åˆ° <code>10.4.0.0</code> åˆåæ‰‹æ•™ç»™äº† RTC</p></blockquote><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/20211128173035.png" alt="circle3" /></p><h2 id="å•è·¯å¾„ç¯è·¯é¿å…"><a class="markdownIt-Anchor" href="#å•è·¯å¾„ç¯è·¯é¿å…"></a> å•è·¯å¾„ç¯è·¯é¿å…</h2><h3 id="è·¯ç”±æ¯’åŒ–"><a class="markdownIt-Anchor" href="#è·¯ç”±æ¯’åŒ–"></a> è·¯ç”±æ¯’åŒ–</h3><p>ç±»ä¼¼è§¦å‘æ›´æ–°æœºåˆ¶ï¼Œä¸€æ—¦ç½‘ç»œæ‹“æ‰‘ç»“æ„å‘ç”Ÿå˜åŒ–ï¼Œè·¯ç”±å°†å°†å¤±æ•ˆæ¡ç›®åº¦é‡å€¼è®¾ä¸ºæ— ç©·å¤§å¹¶ç«‹å³ä¸»åŠ¨é€šå‘Šå‡ºå»ï¼Œåšåˆ°åŠæ—¶æ›´æ–°</p><h3 id="æ°´å¹³åˆ†å‰²"><a class="markdownIt-Anchor" href="#æ°´å¹³åˆ†å‰²"></a> æ°´å¹³åˆ†å‰²</h3><p>ç¦æ­¢è·¯ç”±å™¨å°†ä»ä¸€ä¸ªæ¥å£å­¦ä¹ åˆ°çš„è·¯ç”±å†ä»åŒä¸€ä¸ªæ¥å£å¹¿æ’­å‡ºå»</p><h3 id="æ¯’æ€§é€†è½¬"><a class="markdownIt-Anchor" href="#æ¯’æ€§é€†è½¬"></a> æ¯’æ€§é€†è½¬</h3><p>æŒ‡å½“è·¯ç”±å™¨ä»ä¸€ä¸ªæ¥å£å­¦ä¹ åˆ°å»å¾€æŸä¸ªç½‘ç»œçš„è·¯ç”±æ—¶ï¼Œå®ƒå°±ä¼šä»è¯¥æ¥å£é€šå‘Šä¸€ä¸ªè¯¥ç½‘ç»œä¸å¯è¾¾çš„è·¯ç”±</p><blockquote><p>å®è´¨ä¸Šå°±æ˜¯æ°´å¹³åˆ†å‰²çš„å‡çº§ç‰ˆï¼Œç›®çš„éƒ½æ˜¯ä¸ºäº†é¿å…ä¼ é€’é”™è¯¯ä¿¡æ¯</p></blockquote><h2 id="å¤šè·¯å¾„ç¯è·¯äº§ç”Ÿ"><a class="markdownIt-Anchor" href="#å¤šè·¯å¾„ç¯è·¯äº§ç”Ÿ"></a> å¤šè·¯å¾„ç¯è·¯äº§ç”Ÿ</h2><p>1ã€æ­£å¸¸çš„æ”¶æ•›çŠ¶æ€</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/20211128175601.png" alt="æ­£å¸¸çš„æ”¶æ•›çŠ¶æ€" /></p><p>2ã€çªç„¶ <code>10.4.0.0</code> ç½‘æ®µå‘ç”Ÿé”™è¯¯ï¼ŒRTC ç½®è·¯ç”±è¡¨é¡¹ 10.4.0.0 ä¸ºæ— ç©·å¤§å¹¶å‘é€è·¯ç”±æ›´æ–°ä¿¡æ¯(è·¯ç”±æ¯’åŒ–æœºåˆ¶)ï¼šä½†æ­¤æ—¶ RTA ä¹Ÿç»™ RTB æ›´æ–°ï¼Œä¸€å¯¹æ¯”é€‰æ‹©äº† RTA çš„ï¼Œç¯è·¯äº§ç”Ÿ</p><blockquote><p>RTA ä» RTC å­¦çš„ï¼Œä¸ä¼šç»™ RTC å‘ï¼ˆæ°´å¹³åˆ†å‰²ï¼‰</p></blockquote><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/20211128175627.png" alt="ç½‘ç»œå‘ç”Ÿæ•…éšœ" /></p><p>3ã€éšå RTB è½¬è€Œåˆä¼šå½±å“ RTC</p><blockquote><p>RTB ä» RTA å­¦çš„ï¼Œå› æ­¤å¯ä»¥å‘Šè¯‰ RTCï¼Œå¹¶æ²¡æœ‰è¿èƒŒæ°´å¹³åˆ†å‰²éšå RTC åˆä¼šå‘Šè¯‰ RTAï¼ŒRTA æ”¶åˆ°çœ‹ä¹‹é—´èµ° RTC 1 æ­¥åˆ° 10.4.0.0 ç°åœ¨å˜äº†å•Šè¦èµ°ä¸‰æ­¥ï¼Œé‚£æˆ‘å¾—æ›´æ–°ï¼›ç¯è·¯è‡³æ­¤é—­åˆ</p></blockquote><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/20211128175751.png" alt="" /></p><h2 id="å¤šè·¯å¾„ç¯è·¯é¿å…"><a class="markdownIt-Anchor" href="#å¤šè·¯å¾„ç¯è·¯é¿å…"></a> å¤šè·¯å¾„ç¯è·¯é¿å…</h2><h3 id="å®šä¹‰æœ€å¤§å€¼"><a class="markdownIt-Anchor" href="#å®šä¹‰æœ€å¤§å€¼"></a> å®šä¹‰æœ€å¤§å€¼</h3><p>ç»™è¿™ä¸ªç¯è·¯å­¦ä¹ å®šä¹‰ä¸€ä¸ªæœ€å¤§å€¼ï¼Œè¶…è¿‡è¿™ä¸ªå€¼åˆ™è®¤å®šè¯¥å­¦ä¹ è¿‡ç¨‹ä¸ºç¯è·¯ï¼Œå› æ­¤ä¸å†è½¬å‘ç›®æ ‡ IP çš„åŒ…</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/20211128175943.png" alt="å®šä¹‰æœ€å¤§å€¼" /></p><h3 id="æŠ‘åˆ¶æ—¶é—´"><a class="markdownIt-Anchor" href="#æŠ‘åˆ¶æ—¶é—´"></a> æŠ‘åˆ¶æ—¶é—´</h3><p>æŒ‡ä¸€æ¡è·¯ç”±ä¿¡æ¯æ— æ•ˆä¹‹åï¼Œä¸€æ®µæ—¶é—´å†…è¿™æ¡è·¯ç”±éƒ½å¤„äºæŠ‘åˆ¶çŠ¶æ€ï¼Œå³åœ¨ä¸€å®šæ—¶é—´å†…ä¸å†æ¥æ”¶å…³äºåŒä¸€ç›®çš„åœ°å€çš„è·¯ç”±æ›´æ–°</p><blockquote><p>æ­¤æ—¶ RTB æ¥æ”¶åˆ° RTA å’Œ RTC å…³äº 10.4.0.0 çš„æ¶ˆæ¯æ—¶ä¼šè®¤å®š 10.4.0.0 ä¸ºæŠ‘åˆ¶çŠ¶æ€ï¼Œå› æ­¤å¿½ç•¥ RTAæŠ‘åˆ¶æ—¶é—´æ—¶é—´å†…å°äº 16 çš„æ›´æ–°å°†è¢«å¿½ç•¥ï¼Œå› æ­¤ä¼šè®¾å®šä¸º infï¼›æŠ‘åˆ¶æ—¶é—´ååªæ¥æ‰‹å°äº 16 çš„æ›´æ–°</p></blockquote><h3 id="è§¦å‘æ›´æ–°"><a class="markdownIt-Anchor" href="#è§¦å‘æ›´æ–°"></a> è§¦å‘æ›´æ–°</h3><p>ä¸å¿…ç­‰åˆ°æ›´æ–°å‘¨æœŸåˆ°æ¥ï¼Œè·¯ç”±å™¨é©¬ä¸Šå‘é€è·¯ç”± 10.4.0.0 ä¸å¯è¾¾æ¶ˆæ¯</p><h1 id="rip-ç‰ˆæœ¬ç®€ä»‹"><a class="markdownIt-Anchor" href="#rip-ç‰ˆæœ¬ç®€ä»‹"></a> RIP ç‰ˆæœ¬ç®€ä»‹</h1><h2 id="ripv1-çš„ç¼ºé™·"><a class="markdownIt-Anchor" href="#ripv1-çš„ç¼ºé™·"></a> RIPv1 çš„ç¼ºé™·</h2><p>å‘é€åè®®æŠ¥æ–‡æ—¶ä¸æºå¸¦æ©ç ï¼Œè·¯ç”±äº¤æ¢è¿‡ç¨‹ä¸­æœ‰æ—¶ä¼šé€ æˆé”™è¯¯ï¼›ä¸æ”¯æŒè®¤è¯ï¼›åªèƒ½ä»¥å¹¿æ’­æ–¹å¼å‘å¸ƒåè®®æŠ¥æ–‡ï¼›</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/20211206102248.png" alt="RIPv1 çš„ç¼ºé™·" /></p><h2 id="ripv2"><a class="markdownIt-Anchor" href="#ripv2"></a> RIPv2</h2><p>RIPv2 æ˜¯ä¸€ç§æ— ç±»åˆ«è·¯ç”±åè®®ï¼ŒæŠ¥æ–‡ä¸­æºå¸¦æ©ç ä¿¡æ¯ï¼Œæ”¯æŒ VLSMï¼ˆå¯å˜é•¿å­ç½‘æ©ç ï¼‰å’Œ CIDRï¼ˆæ— ç±»åˆ«åŸŸé—´è·¯ç”±ï¼‰ï¼›</p><p>æ”¯æŒä»¥ç»„æ’­æ–¹å¼å‘é€è·¯ç”±æ›´æ–°æŠ¥æ–‡ï¼Œç»„æ’­åœ°å€ä¸º 224.0.0.9ï¼Œå‡å°‘ç½‘ç»œä¸ç³»ç»Ÿèµ„æºæ¶ˆè€—ï¼›</p><p>æ”¯æŒå¯¹åè®®æŠ¥æ–‡è¿›è¡ŒéªŒè¯ï¼Œå¹¶æä¾›æ˜æ–‡éªŒè¯å’Œ MD5 éªŒè¯ä¸¤ç§æ–¹å¼ï¼Œå¢å¼ºå®‰å…¨æ€§</p><p>æ€»è¯„ï¼šRIP åè®®ç®€å•ã€ä¾¿æ·ï¼Œåœ¨ä¸­å°å‹ç½‘ç»œä¸­å¾—åˆ°å¹¿æ³›åº”ç”¨</p><h3 id="cidrç•¥"><a class="markdownIt-Anchor" href="#cidrç•¥"></a> CIDRï¼ˆç•¥ï¼‰</h3><p>æ— ç±»åˆ«åŸŸé—´è·¯ç”±ï¼ŒClassless Inter-Domain Routingï¼Œæ˜¯ä¸€ä¸ªç”¨äºç»™ç”¨æˆ·åˆ†é… IP åœ°å€ä»¥åŠåœ¨äº’è”ç½‘ä¸Šæœ‰æ•ˆåœ°è·¯ç”± IP æ•°æ®åŒ…çš„å¯¹ IP åœ°å€è¿›è¡Œå½’ç±»çš„æ–¹æ³•</p><p>åŸºäºå¯å˜é•¿å­ç½‘æ©ç ï¼ˆVLSMï¼‰æ¥è¿›è¡Œä»»æ„é•¿åº¦çš„å‰ç¼€çš„åˆ†é…çš„ï¼Œå°†å¥½å‡ ä¸ª IP ç½‘ç»œç»“åˆåœ¨ä¸€èµ·ï¼Œä½¿ç”¨ä¸€ç§æ— ç±»åˆ«çš„åŸŸé™…è·¯ç”±é€‰æ‹©ç®—æ³•ï¼Œä½¿å®ƒä»¬åˆå¹¶æˆä¸€æ¡è·¯ç”±ä»è€Œè¾ƒå°‘è·¯ç”±è¡¨ä¸­çš„è·¯ç”±æ¡ç›®ï¼Œå‡è½» Internet è·¯ç”±å™¨çš„è´Ÿæ‹…ã€‚</p><p>ä¾‹å¦‚ï¼š192.168.0.0/24 - 192.168.3.0/24ï¼ŒCIDR æ±‡æ€»åï¼š192.168.0.0/30</p><h3 id="vlsmç•¥"><a class="markdownIt-Anchor" href="#vlsmç•¥"></a> VLSMï¼ˆç•¥ï¼‰</h3><p>å¯å˜é•¿å­ç½‘æ©ç ï¼ŒæŠŠä¸€ä¸ªæ ‡å‡†ç½‘ç»œåˆ†æˆå‡ ä¸ªå°å‹ç½‘ç»œ(å­ç½‘)</p><h3 id="è·¯ç”±æ±‡æ€»"><a class="markdownIt-Anchor" href="#è·¯ç”±æ±‡æ€»"></a> è·¯ç”±æ±‡æ€»</h3><p>ç•¥</p><h3 id="æœ‰ç±»åˆ«ä¸æ— ç±»åˆ«è·¯ç”±åè®®"><a class="markdownIt-Anchor" href="#æœ‰ç±»åˆ«ä¸æ— ç±»åˆ«è·¯ç”±åè®®"></a> æœ‰ç±»åˆ«ä¸æ— ç±»åˆ«è·¯ç”±åè®®</h3><p>1ã€æœ‰ç±»çš„è·¯ç”±åè®®ä¸ä¼šè¯†åˆ«å­ç½‘çš„ä¿¡æ¯åªèƒ½è¯†åˆ«å‡ºåŸºæœ¬çš„ IPv4 ç±»åˆ«åˆ’åˆ†ï¼Œæ— ç±»åˆ«è·¯ç”±åè®®èƒ½æ ¹æ®å­ç½‘æ©ç çš„é•¿åº¦æ¥åŒºåˆ†ç½‘æ®µ</p><blockquote><p>æ­£æ˜¯å› ä¸ºæœ‰ç±»çš„ä¸èƒ½è¯†åˆ«å­ç½‘ï¼Œå› æ­¤å¾€å¾€è¦åœ¨æ¢çº½è·¯ç”±å™¨è¿›è¡Œè·¯ç”±æ±‡æ€»ï¼Œæ¯”å¦‚ 10.0.0.8/24 ä¸ 10.0.9.9/24 éƒ½ä¼šæ±‡æ€»ä¸º 10.0.10.10 å› ä¸ºåœ¨Aç±»çœ‹æ¥ä»–ä»¬éƒ½æ˜¯ä¸€æ ·çš„</p></blockquote><p>2ã€æœ‰ç±»çš„è·¯ç”±åè®®åªä¼šä¼ é€ç½‘ç»œå‰ç¼€ï¼ˆç½‘ç»œåœ°å€ï¼‰ï¼›æ— ç±»è·¯ç”±åè®®ä¼ è¾“ç½‘ç»œå‰ç¼€ï¼ˆç½‘ç»œåœ°å€ï¼‰çš„åŒæ—¶ä¹Ÿä¼šä¼ è¾“å­ç½‘æ©ç ï¼Œæ‰€ä»¥å®ƒæ”¯æŒ VLSMï¼ˆå¯å˜é•¿å­ç½‘æ©ç ï¼‰</p><h1 id="rip-å®‰å…¨ç¼ºé™·"><a class="markdownIt-Anchor" href="#rip-å®‰å…¨ç¼ºé™·"></a> RIP å®‰å…¨ç¼ºé™·</h1><p>1ã€ä½¿ç”¨ä¸å¯é çš„ UDP æŠ¥æ–‡è¿›è¡Œä¼ é€ï¼Œå®‰å…¨æ€§å·®</p><p>2ã€è·¯ç”±å™¨å¦‚æœæ²¡æœ‰ä½¿ç”¨è®¤è¯æœºåˆ¶ï¼Œåˆ™æ²¡æœ‰å‘å‡ºæ›´æ–°è¯·æ±‚çš„è·¯ç”±å™¨ä¹Ÿèƒ½å¤Ÿæ¥æ”¶åˆ°æ›´æ–°æŠ¥æ–‡</p><h2 id="rip-è·¯ç”±æ¬ºéª—"><a class="markdownIt-Anchor" href="#rip-è·¯ç”±æ¬ºéª—"></a> RIP è·¯ç”±æ¬ºéª—</h2><p>æ”»å‡»è€…å†’å……æ­£å¸¸è·¯ç”±å™¨å‘å—å®³è·¯ç”±å™¨å‘é€è·¯ç”±æ›´æ–°è¯·æ±‚ï¼Œæ›´æ–°åå®ç°æµé‡åŠ«æŒ</p><p>1ã€å…ˆä¼ªé€ åŒ…å†’å…… R1 æ¯æ‰åŸæœ‰çš„è·¯å¾„ï¼š1.0.0.0/8ï¼Œ Metric 4</p><p>2ã€ç„¶åå‘é€ä¼˜å…ˆçº§æ›´é«˜çš„è™šå‡è·¯ç”±è·Ÿæ–°ï¼š1.0.0.0/8, Metric 1</p><p>3ã€å®Œæˆæµé‡åŠ«æŒ</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/20211128202300.png" alt="RIP è·¯ç”±æ¬ºéª—" /></p><h2 id="rip-è·¯ç”±é˜²å¾¡"><a class="markdownIt-Anchor" href="#rip-è·¯ç”±é˜²å¾¡"></a> RIP è·¯ç”±é˜²å¾¡</h2><p>åŸºäº RIPv2 æŠ¥æ–‡éªŒè¯ï¼Œå°† RIP æŠ¥æ–‡å‰ 20 ä¸ªå­—èŠ‚ä½œä¸ºéªŒè¯ä¿¡æ¯ï¼š</p><p>1ã€å»ºç«‹é‚»å±…çš„åŒæ–¹å¿…é¡»ä½¿ç”¨ç›¸åŒçš„éªŒè¯æ–¹å¼å’Œå£ä»¤</p><p>2ã€ä¸ç›´æ¥å»ºç«‹é‚»å±…çš„è·¯ç”±å™¨å¯ä»¥ä½¿ç”¨ä¸åŒçš„éªŒè¯æ–¹å¼å’Œå£ä»¤</p><p>3ã€åœ¨å“ªäº›é“¾è·¯ä¸Šå®æ–½éªŒè¯ã€ä½¿ç”¨å“ªç§éªŒè¯æ–¹å¼ï¼Œå…¨ç”±ç®¡ç†å‘˜æ ¹æ®éœ€æ±‚è¿›è¡Œè€ƒé‡å’Œè®¾è®¡</p><p>Tipsï¼šä»…ä»…é‡‡ç”¨ MAC æœºåˆ¶å¹¶ä¸å®‰å…¨ï¼Œå¦‚ä¸Šå›¾ æ”»å‡»è€…å¯ä»¥åŠ«æŒ R1 åˆ° R2 çš„æ˜æ–‡ä¿¡æ¯ï¼Œè€Œ MAC åªèƒ½ä¿è¯å®Œæ•´æ€§ï¼Œæ‰€ä»¥è¯¥è®¤è¯è¿˜æ˜¯èƒ½è¢«ç¯¡æ”¹ï¼›åªæœ‰å¸¦å¯†é’¥åŠ å¯†çš„ HMAC æ‰æ¯”è¾ƒå®‰å…¨</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/20211128202442.png" alt="æŠ¥æ–‡éªŒè¯æœºåˆ¶" /></p>]]></content>
      
      
      <categories>
          
          <category> Protocol Security </category>
          
      </categories>
      
      
        <tags>
            
            <tag> security </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Overview of Routing Protocol</title>
      <link href="/Coming-blog/2021/12/06/overview-of-routing-protocol/"/>
      <url>/Coming-blog/2021/12/06/overview-of-routing-protocol/</url>
      
        <content type="html"><![CDATA[<h1 id="è·¯ç”±"><a class="markdownIt-Anchor" href="#è·¯ç”±"></a> è·¯ç”±</h1><p>è·¯ç”±å¯ä»¥é™æ€é…ç½®ä¹Ÿå¯ä»¥é€šè¿‡è·¯ç”±åè®®æ¥è‡ªåŠ¨ç”Ÿæˆ</p><blockquote><p>é™æ€è·¯ç”±é…ç½®éœ€è¦äººä¸ºåœ°é€æ¡åœ¨å„è·¯ç”±å™¨ä¸­æ·»åŠ ï¼Œé…ç½®è¾ƒä¸ºçƒ¦çï¼Œæ¯”è¾ƒé€‚åˆç½‘ç»œç»“æ„ç›¸å¯¹ç¨³å®šçš„å°å‹ç½‘ç»œï¼Œä¸èƒ½è‡ªåŠ¨é€‚åº”ç½‘ç»œæ‹“æ‰‘ç»“æ„çš„æ”¹å˜åŠ¨æ€è·¯ç”±é…ç½®åæœŸæ— éœ€äººå·¥å¹²é¢„ï¼Œé€šè¿‡å„è‡ªçš„è·¯ç”±ç®—æ³•èƒ½å¤Ÿè‡ªåŠ¨é€‚åº”ç½‘ç»œæ‹“æ‰‘ç»“æ„çš„æ”¹å˜ï¼Œä½†å¯¹ç³»ç»Ÿèµ„æºçš„å ç”¨é«˜äºé™æ€è·¯ç”±é…ç½®</p></blockquote><p>è·¯ç”±åè®®ï¼šè·¯ç”±å™¨ç”¨æ¥è®¡ç®—ã€ç»´æŠ¤ç½‘ç»œè·¯ç”±ä¿¡æ¯çš„åè®®ï¼Œèƒ½å¤Ÿè‡ªåŠ¨å‘ç°å’Œè®¡ç®—è·¯ç”±ï¼Œå¹¶åœ¨æ‹“æ‰‘å˜åŒ–æ—¶è‡ªåŠ¨æ›´æ–°ï¼Œå·¥ä½œåœ¨ä¼ è¾“å±‚æˆ–åº”ç”¨å±‚ï¼Œå¦‚ï¼šRIPï¼ŒOSPFï¼ŒBGP</p><blockquote><p>è·¯ç”±åè®®åˆ†ç±»ï¼šè·ç¦»çŸ¢é‡åè®®ã€é“¾è·¯çŠ¶æ€åè®®</p></blockquote><p>å¯è·¯ç”±åè®®ï¼šå¯è¢«è·¯ç”±å™¨è¯†åˆ«å¹¶ä»ä¸€ä¸ªè®¾å¤‡è½¬å‘åˆ°å¦ä¸€ä¸ªè®¾å¤‡çš„åè®®ï¼Œå·¥ä½œåœ¨ç½‘ç»œå±‚ï¼Œå¦‚ IPï¼ˆIPæ•°æ®æŠ¥ï¼‰</p><h2 id="åè¯é€Ÿè§ˆ"><a class="markdownIt-Anchor" href="#åè¯é€Ÿè§ˆ"></a> åè¯é€Ÿè§ˆ</h2><p>1ã€IGPï¼Œå†…éƒ¨ç½‘å…³åè®®</p><p>2ã€EGPï¼Œå¤–éƒ¨ç½‘å…³åè®®</p><p>3ã€RIPï¼Œå†…éƒ¨ç½‘å…³åè®®ä¸­çš„è·ç¦»çŸ¢é‡åè®®</p><p>4ã€OSPFï¼Œå†…éƒ¨ç½‘å…³åè®®ä¸­çš„é“¾è·¯çŠ¶æ€åè®®</p><p>5ã€BGPï¼Œå¤–éƒ¨ç½‘å…³åè®®ä¸­çš„è·ç¦»çŸ¢é‡åè®®</p><p>6ã€ASï¼Œè‡ªæ²»ç³»ç»Ÿæˆ–è‡ªæ²»åŸŸ</p><p>7ã€VLSMï¼Œå¯å˜é•¿å­ç½‘æ©ç </p><p>8ã€CIDRï¼Œæ— ç±»åˆ«åŸŸé—´è·¯ç”±</p><h2 id="è·¯ç”±åè®®æ¦‚è¿°"><a class="markdownIt-Anchor" href="#è·¯ç”±åè®®æ¦‚è¿°"></a> è·¯ç”±åè®®æ¦‚è¿°</h2><p>åŠ¨æ€è·¯ç”±åè®®åœ¨åè®®æ ˆä¸Šçš„ä½ç½®å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/20211201141135.png" alt="è·¯ç”±åè®®" /></p><p>RIP åŸºäº UDPï¼Œç«¯å£ä¸º 520</p><p>OSPF åŸºäº IPï¼Œåè®®å·ä¸º 89</p><p>BGP åŸºäº TCPï¼Œç«¯å£å·ä¸º 179</p><h2 id="è·¯ç”±åè®®çš„åŸºæœ¬åŸç†"><a class="markdownIt-Anchor" href="#è·¯ç”±åè®®çš„åŸºæœ¬åŸç†"></a> è·¯ç”±åè®®çš„åŸºæœ¬åŸç†</h2><p>ä¸ç®¡é‡‡ç”¨ä½•ç§è·¯ç”±åè®®ï¼Œå…¶ä¸»è¦éƒ½æ˜¯å®ç°ä»¥ä¸‹å››ä¸ªè¿‡ç¨‹ï¼š</p><p>1ã€é‚»å±…å‘ç°ï¼šè·¯ç”±å™¨é€šè¿‡å‘é€å¹¿æ’­æŠ¥æ–‡æˆ–å‘é€ç»™æŒ‡å®šçš„è·¯ç”±å™¨é‚»å±…ä»¥ä¸»åŠ¨æŠŠè‡ªå·±ä»‹ç»ç»™ç½‘æ®µå†…çš„å…¶å®ƒè·¯ç”±å™¨</p><p>2ã€è·¯ç”±äº¤æ¢ï¼šæ¯å°è·¯ç”±å™¨å°†è‡ªå·±å·²çŸ¥çš„è·¯ç”±ç›¸å…³ä¿¡æ¯å‘ç»™ç›¸é‚»è·¯ç”±å™¨</p><p>3ã€è·¯ç”±è®¡ç®—ï¼šæ¯å°è·¯ç”±å™¨è¿è¡ŒæŸç§ç®—æ³•ï¼Œè®¡ç®—å‡ºæœ€ç»ˆçš„è·¯ç”±æ¥</p><p>4ã€è·¯ç”±ç»´æŠ¤ï¼šè·¯ç”±å™¨ä¹‹é—´é€šè¿‡å‘¨æœŸæ€§åœ°å‘é€åè®®æŠ¥æ–‡æ¥ç»´æŠ¤é‚»å±…ä¿¡æ¯</p><h2 id="å†…éƒ¨ç½‘å…³åè®®igpä¸-å¤–éƒ¨ç½‘å…³åè®®egp"><a class="markdownIt-Anchor" href="#å†…éƒ¨ç½‘å…³åè®®igpä¸-å¤–éƒ¨ç½‘å…³åè®®egp"></a> å†…éƒ¨ç½‘å…³åè®®ï¼ˆIGPï¼‰ä¸ å¤–éƒ¨ç½‘å…³åè®®ï¼ˆEGPï¼‰</h2><p>ASï¼ŒAutonomous Systemï¼Œè‡ªæ²»ç³»ç»Ÿï¼Œåˆå«è‡ªæ²»åŸŸï¼Œæ˜¯æŒ‡æ‹¥æœ‰ç›¸åŒé€‰è·¯ç­–ç•¥çš„ç”±å•ä¸€æœºæ„ç®¡ç†çš„ç½‘ç»œçš„é›†åˆï¼Œæ¯ä¸ª AS ç”± AS å·æ ‡è¯†</p><blockquote><p>å¯ä»¥ç†è§£ä¸ºè·¯ç”±å™¨çš„é›†åˆï¼Œä»–ä»¬æ‹¥æœ‰ç›¸åŒçš„é€‰è·¯ç­–ç•¥è¢«åŒä¸€æŠ€æœ¯ç®¡ç†éƒ¨é—¨ç®¡ç†åŸå‹</p></blockquote><p>IGPï¼ŒInterior Gateway Protocolsï¼Œå†…éƒ¨ç½‘å…³åè®®ï¼Œåœ¨ä¸€ä¸ª AS å†…éƒ¨ä½¿ç”¨çš„è·¯ç”±åè®®ã€‚RIPã€OSPFã€IS-ISéƒ½æ˜¯å…¸å‹çš„IGP</p><p>EGPï¼ŒExterior Gateway Protocolï¼Œå¤–éƒ¨ç½‘å…³åè®®ï¼Œåœ¨å¤šä¸ª AS ä¹‹é—´ä½¿ç”¨çš„è·¯ç”±åè®®ã€‚BGP æ˜¯äº’è”ç½‘äº‹å®ä¸Šçš„ EGP æ ‡å‡†</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/20211128170339.png" alt="IGP, EGP" /></p><p>åŒºåˆ«ï¼šå†…éƒ¨ç½‘å…³åè®®å’Œä½œç”¨äºä¸€ä¸ªASï¼ˆè‡ªæ²»ç³»ç»Ÿï¼‰å†…éƒ¨ï¼Œè€Œå¤–éƒ¨ç½‘å…³åè®®ä½œç”¨äºä¸¤ä¸ªç›¸é‚»çš„ASï¼ˆè‡ªæ²»ç³»ç»Ÿï¼‰ä¹‹é—´ï¼›å†…éƒ¨ç½‘å…³åè®®æœ‰ä¸€æ—ï¼Œè€Œå¤–éƒ¨ç½‘å…³åè®®åªæœ‰ä¸€ä¸ªã€‚</p><h2 id="è·ç¦»çŸ¢é‡åè®®ä¸é“¾è·¯çŠ¶æ€åè®®"><a class="markdownIt-Anchor" href="#è·ç¦»çŸ¢é‡åè®®ä¸é“¾è·¯çŠ¶æ€åè®®"></a> è·ç¦»çŸ¢é‡åè®®ä¸é“¾è·¯çŠ¶æ€åè®®</h2><h3 id="è·ç¦»çŸ¢é‡åè®®"><a class="markdownIt-Anchor" href="#è·ç¦»çŸ¢é‡åè®®"></a> è·ç¦»çŸ¢é‡åè®®</h3><p>è·ç¦»çŸ¢é‡æ„å‘³ç€åˆ©ç”¨è·ç¦»å’Œæ–¹å‘çŸ¢é‡æ¥é€šå‘Šè·¯ç”±ï¼ˆè·ç¦»å¯ä»¥æŒ‡ï¼šè·³æ•°ï¼›æ–¹å‘å¯ä»¥æŒ‡ä¸‹ä¸€è·³è·¯ç”±å™¨æˆ–æ¥å£ï¼‰ï¼Œå¦‚ RIPï¼ŒBGP</p><blockquote><p>ä½¿ç”¨è·ç¦»çŸ¢é‡è·¯ç”±åè®®çš„è·¯ç”±å™¨åªçŸ¥é“ï¼šè‡ªèº«ä¸ç›®çš„ç½‘ç»œä¹‹é—´çš„è·ç¦»ä»¥åŠä¸‹ä¸€æ­¥åº”è¯¥ä½¿ç”¨å“ªä¸ªæ¥å£è½¬å‘æ•°æ®åŒ…ï¼›å¹¶ä¸äº†è§£åˆ°è¾¾ç›®çš„ç½‘ç»œçš„å…·ä½“è·¯å¾„ï¼›å› æ­¤ä¹Ÿå°±é“ºå«äº†ç¯è·¯å‡ºç°çš„å¯èƒ½æ€§</p></blockquote><p>ä¼˜åŠ¿ï¼šå®æ–½å’Œç»´æŠ¤ç®€å•ï¼›èµ„æºè¦æ±‚ä½ï¼›ä¸éœ€è¦è¾ƒé«˜çš„é“¾è·¯å¸¦å®½ï¼›åŠ£åŠ¿ï¼šæ”¶æ•›é€Ÿåº¦æ…¢ï¼›å¯æ‰©å±•æ€§æœ‰é™ï¼›è·¯ç”±ç¯è·¯ï¼›</p><blockquote><p>åœ¨å‘ç”Ÿäº†æ”¹å˜çš„æ‹“æ‰‘ä¸­ï¼Œæ”¶æ•›é€Ÿåº¦ç¼“æ…¢ä¼šå¯¼è‡´ä¸ä¸€è‡´çš„è·¯ç”±è¡¨æ— æ³•åŠæ—¶å¾—åˆ°æ›´æ–°ï¼Œä»è€Œå¯èƒ½é€ æˆè·¯ç”±ç¯è·¯</p></blockquote><h3 id="é“¾è·¯çŠ¶æ€åè®®"><a class="markdownIt-Anchor" href="#é“¾è·¯çŠ¶æ€åè®®"></a> é“¾è·¯çŠ¶æ€åè®®</h3><p>åˆç§°æœ€çŸ­è·¯å¾„ä¼˜å…ˆåè®®ï¼Œè·¯ç”±å™¨ä¹‹é—´ä¼ é€’é“¾è·¯çŠ¶æ€ä¿¡æ¯ï¼Œå½¢æˆè·¯ç”±æ•°æ®åº“ï¼Œé€šè¿‡SPFï¼ˆæœ€çŸ­è·¯å¾„ä¼˜å…ˆç®—æ³•ï¼‰ï¼Œè®¡ç®—å‡ºæœ€çŸ­è·¯å¾„å¯¹åº”çš„è·¯ç”±æ¡ç›®ï¼Œå¦‚ OSPF</p><p>ä¼˜åŠ¿ï¼šæ¯å°è·¯ç”±å™¨<strong>è‡ªè¡Œåˆ›å»ºç½‘ç»œæ‹“æ‰‘å›¾</strong>ä»¥ç¡®å®šæœ€çŸ­è·¯å¾„ï¼›ç«‹å³æ³›æ´ªï¼Œå®ç°å¿«é€Ÿæ”¶æ•›ï¼›ä»…å½“æ‹“æ‰‘å˜åŒ–æ—¶æ‰å‘é€é“¾è·¯çŠ¶æ€æ•°æ®åŒ…ï¼Œä¸”ä»…åŒ…å«å˜åŒ–çš„ä¿¡æ¯ï¼›å¤šåŸŸç¯å¢ƒä¸­é‡‡å–äº†å±‚æ¬¡å¼è®¾è®¡</p><p>åŠ£åŠ¿ï¼šå¯¹èµ„æºè¦æ±‚è¾ƒé«˜ï¼ˆå†…å­˜ï¼Œå¤„ç†å™¨ï¼Œå¸¦å®½ï¼‰</p><h3 id="å¯¹æ¯”"><a class="markdownIt-Anchor" href="#å¯¹æ¯”"></a> å¯¹æ¯”</h3><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/20211128171046.png" alt="å¯¹æ¯”" /></p><p>1ã€è·ç¦»çŸ¢é‡åè®®ä¿¡æ¯ä¼ é€’å’Œæ›´æ–°æ—¶æ˜¯å‘é€å®Œæ•´çš„è·¯ç”±è¡¨ï¼Œèµ„æºåˆ©ç”¨ä½ï¼›è€Œé“¾è·¯çŠ¶æ€åè®®åªæ˜¯å‘é€å¿…è¦çš„é“¾è·¯çŠ¶æ€ä¿¡æ¯ï¼Œèµ„æºåˆ©ç”¨ç‡é«˜</p><p>2ã€è·ç¦»çŸ¢é‡åè®®å°†è·¯ç”±è½¬å‘ç»™å…¶å®ƒè·¯ç”±å™¨ä¹‹å‰ï¼Œå…ˆè¿è¡Œè·¯ç”±ç®—æ³•ï¼ˆæ›´æ–°è‡ªå·±çš„åº¦é‡å€¼ï¼‰ï¼Œéšåé€è·³å‘é€ç»™é‚»å±…ï¼Œæ‰€ä»¥ç½‘ç»œçš„è§„æ¨¡è¶Šå¤§ï¼Œå…¶æ”¶æ•›é€Ÿåº¦è¶Šæ…¢ï¼›è€Œé“¾è·¯çŠ¶æ€åè®®åœ¨è½¬å‘é“¾è·¯çŠ¶æ€åŒ…æ—¶ï¼Œå¯ä»¥ç›´æ¥è½¬å‘ä¸”åˆ’åˆ†äº†åŒºåŸŸï¼Œåªéœ€è¦ä½œåŒºåŸŸé€šå‘Šå³å¯ï¼Œå› æ­¤é“¾è·¯çŠ¶æ€æ”¶æ•›æ›´å¿«ã€‚</p><p>3ã€è·ç¦»çŸ¢é‡åæ›´æ–°çš„æ˜¯è·¯ç”±æ¡ç›®ï¼›è€Œé“¾è·¯çŠ¶æ€åè®®æ›´æ–°çš„æ˜¯â€œæ‹“æ‰‘â€ï¼Œæ¯å°è·¯ç”±å™¨ä¸Šéƒ½æœ‰å®Œå…¨ç›¸åŒçš„æ‹“æ‰‘ï¼Œä»–ä»¬å„è‡ªåˆ†åˆ«è¿›è¡ŒSPFç®—æ³•ï¼Œè®¡ç®—å‡ºè·¯ç”±æ¡ç›®ï¼›å› æ­¤ä¸€æ¡é‡è¦é“¾è·¯çš„å˜åŒ–ï¼Œè·ç¦»çŸ¢é‡åè®®éœ€è¦å°†å˜åŒ–çš„æ¡ç›®é€è·³æ›´æ–°å¹¶é€šå‘Šï¼Œè€Œé“¾è·¯çŠ¶æ€åè®®åªéœ€è¦å‘é€ä¸€æ¡é€šå‘Šå³å¯ï¼Œä½¿å¾—ç›¸å…³è·¯ç”±å™¨æ”¹å˜æ‹“æ‰‘ï¼Œå¹¶é‡æ–°è®¡ç®—ã€‚</p><p>4ã€è·ç¦»çŸ¢é‡åè®®åªèƒ½çœ‹åˆ°è¾ƒä¼˜çš„ä¸‹ä¸€æ¡ï¼Œè·¯ç”±å™¨æ— æ³•è‡ªè¡Œåˆ¤æ–­åˆ°æ¯ä¸€ä¸ªç½‘ç»œçš„æœ€çŸ­è·¯å¾„ï¼Œä¸”ä½¿ç”¨çš„æ˜¯ Bellman-Ford ç®—æ³•ï¼Œå®¹æ˜“äº§ç”Ÿç¯è·¯ï¼›è€Œé“¾è·¯çŠ¶æ€åè®®ä½¿ç”¨äº†å¼ºå¥çš„SPFç®—æ³•ä¸æ˜“äº§ç”Ÿè·¯ç”±ç¯è·¯ï¼Œæ¯ä¸ªè·¯ç”±å™¨éƒ½èƒ½åˆ¤æ–­åˆ°æ¯ä¸€ä¸ªåŸŸå†…èŠ‚ç‚¹çš„æœ€çŸ­è·¯å¾„ï¼Œæ•ˆç‡ä¹Ÿé«˜ï¼›</p><p>5ã€è·ç¦»çŸ¢é‡åè®®ç®€å•ï¼Œä¾¿æ·ï¼Œå› æ­¤å®æ–½å’Œç»´æŠ¤èµ·æ¥è¾ƒå¤æ‚çš„é“¾è·¯çŠ¶æ€åè®®ç®€å•</p><h2 id="è¡¡é‡è·¯ç”±åè®®çš„ä¸»è¦æŒ‡æ ‡"><a class="markdownIt-Anchor" href="#è¡¡é‡è·¯ç”±åè®®çš„ä¸»è¦æŒ‡æ ‡"></a> è¡¡é‡è·¯ç”±åè®®çš„ä¸»è¦æŒ‡æ ‡</h2><p>1ã€åè®®è®¡ç®—çš„æ­£ç¡®æ€§ï¼šåè®®ä½¿ç”¨çš„ç®—æ³•èƒ½å¤Ÿè®¡ç®—å‡ºæœ€ä¼˜çš„è·¯ç”±ï¼Œæ­£ç¡®æ— è‡ªç¯</p><p>2ã€è·¯ç”±æ”¶æ•›é€Ÿåº¦ï¼šå½“ç½‘ç»œçš„æ‹“æ‰‘ç»“æ„å‘ç”Ÿå˜åŒ–ä¹‹åï¼Œèƒ½å¤Ÿè¿…é€Ÿæ„ŸçŸ¥å¹¶åŠæ—¶æ›´æ–°ç›¸åº”çš„è·¯ç”±ä¿¡æ¯</p><p>3ã€åè®®å ç”¨ç³»ç»Ÿå¼€é”€ï¼šåè®®è‡ªèº«çš„å¼€é”€ï¼ˆå†…å­˜ã€CPUã€ç½‘ç»œå¸¦å®½ï¼‰æœ€å°</p><p>4ã€åè®®è‡ªèº«çš„å®‰å…¨æ€§ï¼šåè®®è‡ªèº«ä¸æ˜“å—æ”»å‡»ï¼Œæœ‰å®‰å…¨æœºåˆ¶</p><p>5ã€åè®®é€‚ç”¨ç½‘ç»œè§„æ¨¡ï¼šåè®®å¯ä»¥åº”ç”¨åœ¨ä½•ç§æ‹“æ‰‘ç»“æ„å’Œè§„æ¨¡çš„ç½‘ç»œä¸­</p>]]></content>
      
      
      <categories>
          
          <category> Protocol Security </category>
          
      </categories>
      
      
        <tags>
            
            <tag> security </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>DHCP Protocol and Security</title>
      <link href="/Coming-blog/2021/12/06/dhcp-protocol-and-security/"/>
      <url>/Coming-blog/2021/12/06/dhcp-protocol-and-security/</url>
      
        <content type="html"><![CDATA[<h1 id="dhcp"><a class="markdownIt-Anchor" href="#dhcp"></a> DHCP</h1><p>Dynamic Host Configuration Protocolï¼ŒåŠ¨æ€ä¸»æœºé…ç½®åè®®ï¼Œæä¾›åŠ¨æ€ IP é…ç½®ï¼Œå®ƒå¢å¼ºäº† BOOTPï¼Œå¹¶ä¸ BOOTP å‘åå…¼å®¹</p><h2 id="bootp"><a class="markdownIt-Anchor" href="#bootp"></a> BOOTP</h2><p>å¼•å¯¼ç¨‹åºåè®®ï¼ŒBootstrap protocolï¼ŒBOOTPï¼Œä½¿ä¸€ä¸ªå®¢æˆ·å·¥ä½œç«™èƒ½å¤Ÿç”¨ä¸€ä¸ªæœ€å°çš„ IP å †æ ˆè¿›è¡Œåˆå§‹åŒ–ï¼Œå¹¶å‘ BOOTP æœåŠ¡å™¨è¯·æ±‚å®ƒçš„ IP åœ°å€ã€ç½‘å…³åœ°å€ä»¥åŠåå­—æœåŠ¡å™¨çš„åœ°å€ï¼Œæ˜¯ DHCP åè®®çš„å‰èº«</p><h3 id="bootp-å·¥ä½œè¿‡ç¨‹"><a class="markdownIt-Anchor" href="#bootp-å·¥ä½œè¿‡ç¨‹"></a> BOOTP å·¥ä½œè¿‡ç¨‹</h3><p>1ã€å®¢æˆ·ç¡®å®šå®ƒè‡ªå·±çš„ç¡¬ä»¶åœ°å€ï¼Œåœ°å€ä¸€èˆ¬åœ¨ç¡¬ä»¶çš„ ROM å†…</p><p>2ã€BOOTP å®¢æˆ·åœ¨ä¸€ä¸ª UDP æ•°æ®æŠ¥ä¸­æŠŠå®ƒçš„ç¡¬ä»¶åœ°å€å‘é€åˆ°æœåŠ¡å™¨</p><p>3ã€æœåŠ¡å™¨æ¥æ”¶æ•°æ®æŠ¥ï¼Œå¹¶åœ¨å®ƒçš„é…ç½®æ–‡ä»¶ä¸­æŸ¥æ‰¾å®¢æˆ·çš„ç¡¬ä»¶åœ°å€ï¼Œè¿™ä¸ªæ–‡ä»¶åŒ…å«å®¢æˆ·çš„ IP åœ°å€</p><h2 id="dhcp-åŠŸèƒ½"><a class="markdownIt-Anchor" href="#dhcp-åŠŸèƒ½"></a> DHCP åŠŸèƒ½</h2><p>1ã€ä¿è¯ä»»ä½• IP åœ°å€åœ¨åŒä¸€æ—¶åˆ»åªèƒ½ç”±ä¸€å° DHCP å®¢æˆ·æœºæ‰€ä½¿ç”¨</p><p>2ã€DHCP åº”å½“å¯ä»¥ç»™ç”¨æˆ·åˆ†é…æ°¸ä¹…å›ºå®šçš„ IP åœ°å€</p><p>3ã€DHCP åº”å½“å¯ä»¥åŒç”¨å…¶ä»–æ–¹æ³•è·å¾— IP åœ°å€çš„ä¸»æœºå…±å­˜ï¼ˆå¦‚æ‰‹å·¥é…ç½® IP åœ°å€çš„ä¸»æœºï¼‰</p><p>4ã€DHCP æœåŠ¡å™¨åº”å½“å‘ç°æœ‰çš„ BOOTP å®¢æˆ·ç«¯æä¾›æœåŠ¡ï¼ˆå‘ä¸‹å…¼å®¹ï¼‰</p><h2 id="dhcp-æ•°æ®åŒ…"><a class="markdownIt-Anchor" href="#dhcp-æ•°æ®åŒ…"></a> DHCP æ•°æ®åŒ…</h2><p>DHCP å±äºåº”ç”¨å±‚åè®®ï¼Œå»ºç«‹åœ¨ UDP åè®®ä¹‹ä¸Šï¼Œå› æ­¤æ•°æ®åŒ…å½¢å¼å¦‚ä¸‹ï¼š</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/20211206090640.png" alt="DHCP æ•°æ®åŒ…" /></p><p>1ã€æœ€å¤–å±‚çš„ä»¥å¤ªç½‘æ ‡å¤´ï¼ˆ MAC å¸§ï¼‰æº MAC åœ°å€ä¸ºå®¢æˆ· MAC åœ°å€ï¼Œç›®çš„ MAC åœ°å€æœªçŸ¥ï¼Œå› æ­¤å¡«å…¥å¹¿æ’­ MAC <code>FF-FF-FF-FF-FF-FF</code></p><p>2ã€å†…éƒ¨æ˜¯ IP æ ‡å¤´ï¼Œæº IP åœ°å€æœªçŸ¥ï¼Œè¿™é‡Œè®¾ç½®ä¸º <code>0.0.0.0</code> ç›®çš„ IP ä¹ŸæœªçŸ¥ï¼Œè¿™é‡Œè®¾ç½®ä¸º <code>255.255.255.255</code></p><blockquote><p><code>255.255.255.255</code> åœ¨ <a href="https://coming98.github.io/Coming-blog/2021/12/05/ipv4-protocol-and-security/#toc-heading-7">IPv4 Protocol and Security</a> æˆ‘ä»¬æåˆ°è¿‡è¿™æ˜¯å—é™å¹¿æ’­åœ°å€ï¼Œåº”ç”¨äº DHCP ä¸­</p></blockquote><p>3ã€UDP æ ‡å¤´ï¼Œæºç«¯å£å›ºå®šä¸º 68ï¼Œç›®çš„ç«¯å£å›ºå®šä¸º 67</p><h3 id="æ•°æ®åŒ…å‘é€è¿‡ç¨‹"><a class="markdownIt-Anchor" href="#æ•°æ®åŒ…å‘é€è¿‡ç¨‹"></a> æ•°æ®åŒ…å‘é€è¿‡ç¨‹</h3><p>1ã€å¹¿æ’­å‘é€ï¼Œå­ç½‘å†…æ¯ä¸ªä¸»æœºéƒ½èƒ½æ”¶åˆ°è¯¥åŒ…</p><p>2ã€æ ¹æ® MAC åœ°å€æ— æ³•åˆ¤æ–­ç›®çš„åœ°æ˜¯è°ï¼Œå› æ­¤æŸ¥çœ‹ IP ä¿¡æ¯(<code>0.0.0.0</code> -&gt; <code>255.255.255.255</code>) DHCP æœåŠ¡å™¨å°±èƒ½æ„è¯†åˆ°è¿™æ˜¯ DHCP DISCOVER åŒ…ï¼Œå…¶å®ƒä¸»æœºå°†ä¸¢å¼ƒè¯¥åŒ…</p><p>3ã€DHCP åˆ†é…å¥½ IP åœ°å€åå°†è¿”å›ä¸€ä¸ª DHCP OFFER åŒ…ï¼Œæº MAC ä¸ç›®çš„ MAC éƒ½æ˜ç¡®äº†ï¼Œæº IP ä¸º DHCP æœåŠ¡å™¨çš„ IPï¼Œç›®çš„ IP æœªçŸ¥ï¼Œæ­¤æ—¶ä»è®¾ç½®ä¸º <code>255.255.255.255</code> ï¼Œæºç«¯å£ä¸º 67ï¼Œç›®çš„ç«¯å£ä¸º 68ï¼Œåˆ†é…ç»™è¯·æ±‚ç«¯çš„ IP åœ°å€å’Œæœ¬ç½‘ç»œçš„å…·ä½“å‚æ•°åˆ™åŒ…å«åœ¨ Data éƒ¨åˆ†</p><blockquote><p>é€šè¿‡ MAC å¯»å€</p></blockquote><h2 id="dhcp-å·¥ä½œè¿‡ç¨‹"><a class="markdownIt-Anchor" href="#dhcp-å·¥ä½œè¿‡ç¨‹"></a> DHCP å·¥ä½œè¿‡ç¨‹</h2><p>1ã€å®¢æˆ·åœ¨å®ƒçš„æœ¬åœ°ç‰©ç†å­ç½‘ä¸Šå¹¿æ’­ä¸€ä¸ª DHCP DISCOVER æ¶ˆæ¯</p><p>2ã€æ¯ä¸ªæœåŠ¡å™¨å¯ä»¥ç”¨ä¸€ä¸ª DHCP OFFER æ¶ˆæ¯ä½œå‡ºå“åº”ï¼Œè¿™ä¸ªæ¶ˆæ¯åŒ…å«ä¸€ä¸ªå¯ç”¨çš„ç½‘ç»œåœ°å€å’Œå…¶ä»–é…ç½®é€‰é¡¹</p><p>3ã€å®¢æˆ·ä»ä¸€ä¸ªæˆ–å¤šä¸ªæœåŠ¡å™¨æ¥æ”¶åˆ°ä¸€ä¸ªæˆ–è€…å¤šä¸ª DHCP OFFER æ¶ˆæ¯ï¼Œé€‰æ‹©ä¸€ä¸ª</p><p>4ã€æœåŠ¡å™¨ä»å®¢æˆ·æ¥æ”¶ DHCP REQUEST</p><p>5ã€å®¢æˆ·æ¥æ”¶åˆ°å¸¦æœ‰é…ç½®å‚æ•°çš„ DHCP ACK æ¶ˆæ¯</p><p>6ã€å®¢æˆ·é€šè¿‡å‘é€ä¸€ä¸ª DHCP RELEASE æ¶ˆæ¯ç»™æœåŠ¡å™¨ï¼Œå®ƒå¯ä»¥é€‰æ‹©ä¸å†ç»§ç»­ç§Ÿç”¨åœ°å€</p><h2 id="dhcp-æ¬ºéª—"><a class="markdownIt-Anchor" href="#dhcp-æ¬ºéª—"></a> DHCP æ¬ºéª—</h2><p>1ã€æ”»å‡»è€…é¦–å…ˆå‘èµ·å¤§é‡çš„ DHCP è¯·æ±‚ï¼ˆä¼ªé€ å¤§é‡çš„ DHCP è¯·æ±‚åŒ…ï¼‰ï¼Œä¼ªè£…æˆ DHCP å®¢æˆ·ç«¯</p><p>2ã€å¾ˆå¿«æ­£å¸¸çš„ DHCP æœåŠ¡å™¨çš„ IP åœ°å€è¢«æ¶ˆè€—æ®†å°½ï¼ŒDHCPæœåŠ¡å™¨åœæ­¢ä¸ºå…¶ä»– DHCP å®¢æˆ·ç«¯åˆ†é… IP åœ°å€</p><p>3ã€æ”»å‡»è€…åœ¨ç½‘ç»œæ¶è®¾è‡ªå·±çš„ DHCP æœåŠ¡å™¨ï¼Œä¸ºçœŸæ­£éœ€è¦ IP åœ°å€çš„å®¢æˆ·ç«¯åˆ†é… IP åœ°å€</p><p>4ã€æ”»å‡»è€…çš„ DHCP æœåŠ¡å™¨ä¸ºå®¢æˆ·ç«¯åˆ†é… IP å‚æ•°ï¼Œè¿™äº›å‚æ•°é‡Œå¯èƒ½åŒ…å«äººä¸ºé”™è¯¯è®¾ç½®çš„å‚æ•°</p><blockquote><p>DNS å¯ä»¥æŒ‡å‘æ¶æ„ DNS æœåŠ¡å™¨ç½‘å…³æŒ‡å‘æ”»å‡»è€…æ§åˆ¶çš„è·¯ç”±å™¨ï¼Œå®ç°ä¸­é—´äººæ”»å‡»</p></blockquote><h2 id="dhcp-é˜²å¾¡"><a class="markdownIt-Anchor" href="#dhcp-é˜²å¾¡"></a> DHCP é˜²å¾¡</h2><p>1ã€å¯ä»¥é€šè¿‡å»ºç«‹ä¸€å¼ åŒ…å«æœ‰ç”¨æˆ· MAC åœ°å€ã€IP åœ°å€ã€ç§Ÿç”¨æœŸã€VLAN IDã€äº¤æ¢æœºç«¯å£ç­‰ä¿¡æ¯çš„ä¸€å¼ è¡¨ï¼Œé™åˆ¶åŒä¸€ç«¯å£ä¸‹çš„æ•°ç›®ï¼Œé™åˆ¶ MACç­‰</p><p>2ã€å°†äº¤æ¢æœºçš„ç«¯å£åˆ†ä¸ºå¯ä¿¡ä»»ç«¯å£å’Œä¸å¯ä¿¡ä»»ç«¯å£ï¼Œå½“äº¤æ¢æœºä»ä¸€ä¸ªä¸å¯ä¿¡ä»»ç«¯å£æ”¶åˆ° DHCP æœåŠ¡å™¨çš„æŠ¥æ–‡æ—¶ï¼Œæ¯”å¦‚ DHCP OFFER æŠ¥æ–‡ã€DHCP ACKæŠ¥æ–‡ã€DHCP NAK æŠ¥æ–‡ï¼Œäº¤æ¢æœºä¼šç›´æ¥å°†è¯¥æŠ¥æ–‡å¼ƒ</p><h1 id="refs"><a class="markdownIt-Anchor" href="#refs"></a> Refs</h1><p><a target="_blank" rel="noopener" href="https://www.zhihu.com/question/23337642?sort=created">çŸ¥ä¹ - wuxinliulei - DHCPå±äºOSIçš„å“ªä¸€å±‚ï¼Ÿ</a></p>]]></content>
      
      
      <categories>
          
          <category> Protocol Security </category>
          
      </categories>
      
      
        <tags>
            
            <tag> security </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>IPv6 Protocol and Security</title>
      <link href="/Coming-blog/2021/12/05/ipv6-protocol-and-security/"/>
      <url>/Coming-blog/2021/12/05/ipv6-protocol-and-security/</url>
      
        <content type="html"><![CDATA[<h1 id="ipv6"><a class="markdownIt-Anchor" href="#ipv6"></a> IPv6</h1><h2 id="ipv4-å­˜åœ¨çš„é—®é¢˜"><a class="markdownIt-Anchor" href="#ipv4-å­˜åœ¨çš„é—®é¢˜"></a> IPv4 å­˜åœ¨çš„é—®é¢˜</h2><p>1ã€åœ°å€ç©ºé—´åŒ®ä¹ï¼›</p><p>2ã€æŠ¥æ–‡å¤´ç»“æ„å†—ä½™ï¼Œå½±å“è½¬å‘æ•ˆç‡ï¼›</p><p>3ã€<strong>å­˜åœ¨ç½‘ç»œç©ºé—´å®‰å…¨éšæ‚£</strong>ï¼›</p><p>4ã€ä¸æä¾›æœåŠ¡è´¨é‡ä¿è¯ï¼›</p><p>5ã€ç¼ºå°‘ç§»åŠ¨æ€§æ”¯æŒï¼›</p><h2 id="ipv6-çš„ç‰¹ç‚¹"><a class="markdownIt-Anchor" href="#ipv6-çš„ç‰¹ç‚¹"></a> IPv6 çš„ç‰¹ç‚¹</h2><p>å‡ ä¹æ— é™å¤§çš„åœ°å€ç©ºé—´ï¼›å‡å°‘è·¯ç”±è¡¨å¤§å°ï¼›<strong>æ›´å¥½çš„å®‰å…¨æ€§</strong>ï¼›</p><p>ä¸»è¦è§£å†³çš„é—®é¢˜ï¼š</p><p>1ã€åœ°å€çŸ­ç¼ºé—®é¢˜</p><p>2ã€è·¯ç”±é€Ÿåº¦æ…¢çš„é—®é¢˜ï¼š(a) é€šè¿‡å¯¹æŠ¥å¤´ç»“æ„çš„æ›´æ”¹ç®€åŒ–è·¯ç”±ï¼ŒåŠ å¿«è·¯ç”±é€Ÿåº¦; (b) è‹¥ä¸èƒ½æŒ‡å®šè·¯ç”±å™¨å°±ä¸ä¼šæ‰“å¼€å¤„ç†æ‰©å±•å¤´éƒ¨ï¼Œæ”¹å–„äº†è·¯ç”±æ€§èƒ½ï¼›(c) åœ¨ IPv6 å¤´éƒ¨ï¼Œæœ‰ä¸¤ä¸ªç›¸åº”çš„ä¼˜å…ˆæƒå’Œæµæ ‡è¯†å­—æ®µï¼Œå…è®¸æŠŠæ•°æ®æŠ¥æŒ‡å®šä¸ºæŸä¸€ä¿¡æ¯æµçš„ç»„æˆéƒ¨åˆ†ï¼Œå¹¶å¯å¯¹è¿™äº›æ•°æ®æŠ¥è¿›è¡Œæµé‡æ§åˆ¶ã€‚</p><p>3ã€å®‰å…¨ç¼ºé™·é—®é¢˜</p><h2 id="ipv6-æŠ¥æ–‡æ ¼å¼"><a class="markdownIt-Anchor" href="#ipv6-æŠ¥æ–‡æ ¼å¼"></a> IPv6 æŠ¥æ–‡æ ¼å¼</h2><p>IPv6 åè®®æ•°æ®å•å…ƒç”±å›ºå®šé¦–éƒ¨ï¼Œbase headerï¼Œå’Œæœ‰æ•ˆè½½è·ï¼Œpayloadï¼Œç»„æˆï¼Œå›ºå®šé¦–éƒ¨æœ‰ 40 å­—èŠ‚ï¼ŒåŒ…å«æœ‰ 8 ä¸ªå­—æ®µ</p><p>å¯¹æ¯” IPv4ï¼šåè®®é¦–éƒ¨å»æ‰äº† 7 ä¸ªå­—æ®µï¼Œå¢åŠ äº† 1 ä¸ªæµæ ‡ç­¾å­—æ®µï¼Œæºåœ°å€å’Œç›®çš„åœ°å€å­—æ®µçš„åœ°å€ä½æ•°æ‰©å¤§åˆ° 128 æ¯”ç‰¹</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/20211205192327.png" alt="IPv6 æŠ¥æ–‡æ ¼å¼" /></p><h2 id="ipv6-æ‰©å±•é¦–éƒ¨"><a class="markdownIt-Anchor" href="#ipv6-æ‰©å±•é¦–éƒ¨"></a> IPv6 æ‰©å±•é¦–éƒ¨</h2><p>æœ‰æ•ˆè½½è·åˆåŒ…æ‹¬æ‰©å±•é¦–éƒ¨ï¼Œextension headerï¼Œå’Œæ•°æ®éƒ¨åˆ†ï¼ŒIPv6 æ•°æ®æŠ¥åœ¨åŸºæœ¬é¦–éƒ¨åé¢å…è®¸æœ‰é›¶ä¸ªæˆ–å¤šä¸ªæ‰©å±•é¦–éƒ¨ï¼Œå†åé¢æ˜¯æ•°æ®</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/20211205192657.png" alt="IPv6 æ‰©å±•é¦–éƒ¨" /></p><p>è¿™ä¹ˆå¤šæ‰©å±•é¦–éƒ¨å°†é€šè¿‡ <code>ä¸‹ä¸€ä¸ªé¦–éƒ¨å­—æ®µ</code> è¿›è¡Œè¿æ¥ï¼Œä¾‹å¦‚ï¼ŒNext Header ä¸º 58 è¡¨ç¤ºä¸‹ä¸€ä¸ªæ‰©å±•é¦–éƒ¨ä¸º ICMP æŠ¥æ–‡</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/20211205192918.png" alt="ä¸‹ä¸€ä¸ªé¦–éƒ¨å­—æ®µ" /></p><h3 id="æ‰©å±•æŠ¥å¤´"><a class="markdownIt-Anchor" href="#æ‰©å±•æŠ¥å¤´"></a> æ‰©å±•æŠ¥å¤´</h3><p>IPv6 æä¾›äº†è¯¸å¤šæ‰©å±•é€‰é¡¹</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/20211205192829.png" alt="è¯¸å¤šæ‰©å±•é€‰é¡¹" /></p><h2 id="ipv6-åœ°å€"><a class="markdownIt-Anchor" href="#ipv6-åœ°å€"></a> IPv6 åœ°å€</h2><p>IPv6 åœ°å€ç»“æ„ï¼šå…±128ä½ï¼Œç”±å…¨çƒè·¯ç”±å‰ç¼€(GRP)ï¼Œå­ç½‘ IDï¼Œæ¥å£ IDç»„æˆï¼Œå†™æˆ 8 ä¸ª 16 è¿›åˆ¶æ•°çš„å½¢å¼ï¼Œå¦‚ <code>2001:A304:6101:1::E0:F726:4E58</code></p><h3 id="æ¥å£æ ‡è¯†"><a class="markdownIt-Anchor" href="#æ¥å£æ ‡è¯†"></a> æ¥å£æ ‡è¯†</h3><p>å…¶ç”Ÿæˆæ–¹å¼æœ‰ä¸‰ï¼š</p><p>1ã€æœ‰ IEEE EUI-64 è§„èŒƒè‡ªåŠ¨ç”Ÿæˆï¼šå°† 48 æ¯”ç‰¹çš„ MAC åœ°å€è½¬åŒ–ä¸º 64 æ¯”ç‰¹çš„æ¥å£ ID</p><blockquote><p>è¿™æ˜¯è®¾å¤‡è‡ªåŠ¨ç”Ÿæˆçš„ï¼ŒMAC å”¯ä¸€å› æ­¤ç”Ÿæˆçš„æ¥å£ ID ä¹Ÿå”¯ä¸€</p></blockquote><p>2ã€è®¾å¤‡éšæœºç”Ÿæˆï¼šä¸€å®šç¨‹åº¦ä¸Šä¿æŠ¤ä¸»æœºçš„ç§å¯†æ€§</p><p>3ã€æ‰‹å·¥é…ç½®ï¼šå»ºè®®åœ¨æœåŠ¡å™¨å’Œé‡è¦ç½‘ç»œè®¾å¤‡ä¸Šé…ç½®</p><h3 id="åœ°å€åˆ†ç±»"><a class="markdownIt-Anchor" href="#åœ°å€åˆ†ç±»"></a> åœ°å€åˆ†ç±»</h3><p>å•æ’­åœ°å€ï¼šUnicast Addressï¼Œç”¨äºæ ‡è¯†å•ä¸€ç½‘ç»œæ¥å£</p><p>å¤šæ’­åœ°å€ï¼šMulticast Addressï¼Œç”¨æ¥æ ‡è¯†ä¸€ç»„ç½‘ç»œæ¥å£(é€šå¸¸å±äºä¸åŒçš„èŠ‚ç‚¹)</p><p>ä»»æ’­åœ°å€ï¼šAnycast Addressï¼Œç”¨æ¥æ ‡è¯†ä¸€ç»„ç½‘ç»œæ¥å£ï¼Œè¿™äº›æ¥å£é€šå¸¸å±äºä¸åŒçš„èŠ‚ç‚¹</p><blockquote><p>ä»»æ’­åœ°å€æ˜¯ IPv6 å¼•äººçš„ä¸€ç§æ–°çš„åœ°å€ç±»å‹å¹¿æ’­ï¼ŒBroadcast Addressï¼Œåœ°å€å› ä¸ºå®‰å…¨é—®é¢˜è¢« IPv4 å–æ¶ˆ</p></blockquote><h2 id="å¤šæ’­åœ°å€"><a class="markdownIt-Anchor" href="#å¤šæ’­åœ°å€"></a> å¤šæ’­åœ°å€</h2><p>å»æ‰å¹¿æ’­åå¯¹é‚£äº›åŸæ¥ä½¿ç”¨äº†å¹¿æ’­åœ°å€çš„åœºåˆï¼Œåˆ™ä½¿ç”¨ä¸€äº›æ›´åŠ <strong>æœ‰é™</strong>çš„å¤šæ’­åœ°å€ï¼šä¹Ÿå°±æ˜¯å„èŠ‚ç‚¹è‡ªè¡Œé€‰æ‹©åŠ å…¥æŸå¤šæ’­åœ°å€ï¼Œä½¿å¾—èŠ‚ç‚¹å‘é€çš„å•ä¸ªæ•°æ®æŠ¥å¯ä»¥è¢«<strong>æŒ‡æ˜çš„</strong>å¤šä¸ªç›®çš„èŠ‚ç‚¹æ”¶åˆ°</p><h3 id="å¹¿æ’­å­˜åœ¨çš„é—®é¢˜"><a class="markdownIt-Anchor" href="#å¹¿æ’­å­˜åœ¨çš„é—®é¢˜"></a> å¹¿æ’­å­˜åœ¨çš„é—®é¢˜</h3><p>1ã€å¹¿æ’­è¢«ç”¨æ¥æºå¸¦å»å‘å¤šä¸ªèŠ‚ç‚¹çš„ä¿¡æ¯ï¼Œæˆ–è¢«é‚£äº›ä¸çŸ¥ä¿¡æ¯æ¥è‡ªä½•æ–¹çš„èŠ‚ç‚¹ç”¨æ¥å‘å‡ºè¯·æ±‚</p><p>2ã€å¹¿æ’­å¯èƒ½ä¼šä¸ºç½‘ç»œæ€§èƒ½è®¾ç½®éšœç¢ï¼šåŒä¸€ç½‘ç»œé“¾è·¯ä¸Šçš„å¤§é‡å¹¿æ’­æ„å‘³ç€è¯¥é“¾è·¯ä¸Šçš„æ¯ä¸ªèŠ‚ç‚¹éƒ½å¿…é¡»å¤„ç†æ‰€æœ‰å¹¿æ’­ï¼Œä½†æ˜¯å…¶ä¸­ç»å¤§éƒ¨åˆ†èŠ‚ç‚¹æœ€ç»ˆéƒ½å°†å¿½ç•¥è¯¥å¹¿æ’­ï¼Œå› ä¸ºè¯¥å¹¿æ’­ä¿¡æ¯ä¸è‡ªå·±æ— å…³</p><h3 id="å¤šæ’­åœ°å€æ ¼å¼"><a class="markdownIt-Anchor" href="#å¤šæ’­åœ°å€æ ¼å¼"></a> å¤šæ’­åœ°å€æ ¼å¼</h3><p>ç”¨æœ€é«˜ 8 ä½æ˜¯ 11111111 äºŒè¿›åˆ¶ä½ç»„åˆæ¥æ ‡è¯†å¤šæ’­åœ°å€ï¼Œå³ <code>FFxx::...</code></p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/20211205193939.png" alt="å¤šæ’­" /></p><p>1ã€Flags å­—æ®µï¼šç”¨æ¥è¡¨ç¤º permanent æˆ– transient å¤šæ’­ç»„</p><p>2ã€Scope å­—æ®µï¼šè¡¨ç¤ºå¤šæ’­ç»„çš„èŒƒå›´</p><p>3ã€Group ID å­—æ®µï¼šè¡¨ç¤ºå¤šæ’­ç»„çš„ ID</p><h3 id="é¢„å®šä¹‰çš„å¤šæ’­ç»„"><a class="markdownIt-Anchor" href="#é¢„å®šä¹‰çš„å¤šæ’­ç»„"></a> é¢„å®šä¹‰çš„å¤šæ’­ç»„</h3><p>æœ¬åœ°é“¾è·¯æ—¶å¯ç”¨ï¼š</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/20211205194153.png" alt="é¢„å®šä¹‰çš„å¤šæ’­ç»„" /></p><h2 id="ä»»æ’­åœ°å€"><a class="markdownIt-Anchor" href="#ä»»æ’­åœ°å€"></a> ä»»æ’­åœ°å€</h2><p>ä»»æ’­åœ°å€æ˜¯ IPv6 åè®®ç‰¹æœ‰çš„åœ°å€ç±»å‹ï¼Œé€‚åˆäºä¸€å¯¹ä¸€ç»„ä¸­çš„ä¸€ä¸ª(One to One of Many)çš„é€šä¿¡éœ€æ±‚</p><blockquote><p>å› æ­¤ä»»æ’­åœ°å€åªèƒ½ç”¨ä½œ IPv6 æ•°æ®æŠ¥çš„ç›®çš„åœ°å€ï¼Œä»»æ’­åœ°å€åªèƒ½åˆ†é…ç»™ IPv6 è·¯ç”±å™¨æˆ–æœåŠ¡å™¨ä¸»æœºã€‚</p></blockquote><p>å› æ­¤ä»»æ’­åœ°å€ä¼šæ ‡è¯†ä¸€ç»„ç½‘ç»œæ¥å£ï¼Œä½†æ˜¯è·¯ç”±å™¨ä¼šæŠŠç›®æ ‡åœ°å€æ˜¯ä»»æ’­åœ°å€çš„æ•°æ®å‘é€ç»™ç¦»è¯¥è·¯ç”±å™¨æœ€è¿‘çš„ä¸€ä¸ªç½‘ç»œæ¥å£</p><h3 id="ä¸å¤šæ’­æ¯”è¾ƒ"><a class="markdownIt-Anchor" href="#ä¸å¤šæ’­æ¯”è¾ƒ"></a> ä¸å¤šæ’­æ¯”è¾ƒ</h3><p>1ã€åŒæ ·æ˜¯å¤šä¸ªèŠ‚ç‚¹å…±äº«ä¸€ä¸ªä»»æ’­åœ°å€</p><p>2ã€ä¸åŒçš„æ˜¯ï¼Œåªæœ‰ä¸€ä¸ªèŠ‚ç‚¹æœŸå¾…æ¥æ”¶ç»™ä»»æ’­åœ°å€çš„æ•°æ®æŠ¥ï¼›è€Œå¤šæ’­è¿˜æ˜¯å…¨éƒ¨å‘é€ï¼Œæ›´åƒæ˜¯å—é™çš„å¹¿æ’­ã€‚</p><h3 id="ä»»æ’­çš„åº”ç”¨"><a class="markdownIt-Anchor" href="#ä»»æ’­çš„åº”ç”¨"></a> ä»»æ’­çš„åº”ç”¨</h3><p>ä»»æ’­åœ°å€åœ¨ç§»åŠ¨é€šä¿¡ä¸­å¾ˆæœ‰ç”¨ï¼Œæ¥æ”¶æ–¹åªéœ€è¦æ˜¯ä¸€ç»„æ¥å£ä¸­çš„ä¸€ä¸ªå³å¯ï¼Œè¿™æ ·å¯ä»¥ä½¿ç§»åŠ¨ç”¨æˆ·åœ¨åœ°ç†ä½ç½®ä¸Šä¸ä¼šå—è¿‡å¤šçš„é™åˆ¶</p><h2 id="æœ¬åœ°é“¾è·¯åœ°å€"><a class="markdownIt-Anchor" href="#æœ¬åœ°é“¾è·¯åœ°å€"></a> æœ¬åœ°é“¾è·¯åœ°å€</h2><p>link-local addressï¼Œæœ¬åœ°é“¾è·¯åœ°å€å…·æœ‰å›ºå®šçš„åœ°å€æ ¼å¼ï¼Œæ˜¯åœ¨ IPv6 ä¸­åº”ç”¨èŒƒå›´å—é™åˆ¶çš„åœ°å€ç±»å‹</p><p>1ã€åº”ç”¨èŒƒå›´é™åˆ¶åœ¨è¿æ¥åˆ°åŒä¸€æœ¬åœ°é“¾è·¯çš„èŠ‚ç‚¹ä¹‹é—´</p><p>2ã€åœ¨é‚»å±…å‘ç°ç­‰ IPv6 æœºåˆ¶ä¸­ä½¿ç”¨åˆ°è¯¥ç±»å‹çš„åœ°å€</p><p>3ã€ç”±è®¾å¤‡è‡ªåŠ¨ç”Ÿæˆï¼Œåœ¨æœ¬åœ°ç½‘ç»œä¸­ä½¿ç”¨</p><h3 id="æœ¬åœ°é“¾è·¯åœ°å€æ ¼å¼"><a class="markdownIt-Anchor" href="#æœ¬åœ°é“¾è·¯åœ°å€æ ¼å¼"></a> æœ¬åœ°é“¾è·¯åœ°å€æ ¼å¼</h3><p>ä¸€ä¸ªç‰¹å®šçš„å‰ç¼€å’Œæ¥å£ ID ä¸¤éƒ¨åˆ†ï¼Œä½¿ç”¨ç‰¹å®šçš„æœ¬åœ°é“¾è·¯å‰ç¼€ FE80:: /64ï¼Œä½ 64 ä½ä¸ºæ¥å£IDï¼ˆè®¾å¤‡è‡ªåŠ¨ç”Ÿæˆï¼‰ã€‚</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/20211205195005.png" alt="æœ¬åœ°é“¾è·¯åœ°å€æ ¼å¼" /></p><h2 id="æœ¬åœ°ç«™ç‚¹åœ°å€"><a class="markdownIt-Anchor" href="#æœ¬åœ°ç«™ç‚¹åœ°å€"></a> æœ¬åœ°ç«™ç‚¹åœ°å€</h2><p>site-local addressï¼Œæœ¬åœ°ç«™ç‚¹åœ°å€ä¹Ÿæ˜¯åº”ç”¨èŒƒå›´å—é™çš„åœ°å€ï¼Œä»…èƒ½åœ¨ä¸€ä¸ªå•ä½çš„ç½‘ç»œå†…ä½¿ç”¨ï¼Œç±»ä¼¼äº IPv4 ä¸­çš„ä¸“ç”¨åœ°å€ï¼ˆç§æœ‰åœ°å€ï¼‰</p><h2 id="åœ°å€é…ç½®æŠ€æœ¯"><a class="markdownIt-Anchor" href="#åœ°å€é…ç½®æŠ€æœ¯"></a> åœ°å€é…ç½®æŠ€æœ¯</h2><p>å³å¯¹è·¯ç”±å™¨çš„æ¥å£é…ç½®ä¸€ä¸ª IPv6 åœ°å€ï¼Œå¹¶æŒ‡å®šä¸€ä¸ªå‰ç¼€é•¿åº¦</p><blockquote><p>IPv6 æ²¡æœ‰å­ç½‘æ©ç çš„æ¦‚å¿µï¼Œè€Œæ˜¯å‰ç¼€é•¿åº¦å–ä»£äº†å­ç½‘æ©ç </p></blockquote><h3 id="æ— çŠ¶æ€è‡ªåŠ¨é…ç½®"><a class="markdownIt-Anchor" href="#æ— çŠ¶æ€è‡ªåŠ¨é…ç½®"></a> æ— çŠ¶æ€è‡ªåŠ¨é…ç½®</h3><p>ç”¨äºç½‘ç»œèŠ‚ç‚¹çš„åœ°å€è‡ªåŠ¨é…ç½®ï¼Œç½‘ç»œæ¥å£æ¥æ”¶è·¯ç”±å™¨å®£å‘Šçš„å…¨å±€åœ°å€å‰ç¼€ï¼Œå†ç»“åˆæ¥å£ ID å¾—åˆ°ä¸€ä¸ªå¯èšé›†å…¨å±€å•æ’­åœ°å€</p><p>å…·ä½“å¦‚ä¸‹ï¼š</p><p>1ã€ä¸»æœºå‘é€ Router Solicitation æŠ¥æ–‡ï¼Œè·¯ç”±å™¨å›åº” Router Advertisement æŠ¥æ–‡</p><p>2ã€ä¸»æœºè·å¾—å‰ç¼€åŠå…¶å®ƒå‚æ•°</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/20211205204554.png" alt="æ— çŠ¶æ€è‡ªåŠ¨é…ç½®" /></p><h3 id="æœ‰çŠ¶æ€è‡ªåŠ¨é…ç½®"><a class="markdownIt-Anchor" href="#æœ‰çŠ¶æ€è‡ªåŠ¨é…ç½®"></a> æœ‰çŠ¶æ€è‡ªåŠ¨é…ç½®</h3><p>è¯¥é…ç½®å°±éœ€è¦ä¸“é—¨çš„ DHCP æœåŠ¡å™¨çš„æ”¯æŒäº†ï¼Œç½‘ç»œæ¥å£é€šè¿‡å®¢æˆ·æœº/æœåŠ¡å™¨æ¨¡å¼ä» DHCP æœåŠ¡å™¨å¤„å¾—åˆ°åœ°å€é…ç½®ä¿¡æ¯</p><h3 id="æ‰‹å·¥é…ç½®"><a class="markdownIt-Anchor" href="#æ‰‹å·¥é…ç½®"></a> æ‰‹å·¥é…ç½®</h3><p>å¸¸ç”¨äºæœåŠ¡å™¨å’Œé‡è¦ç½‘ç»œè®¾å¤‡</p><h2 id="icmpv6"><a class="markdownIt-Anchor" href="#icmpv6"></a> ICMPv6</h2><p>Internet Control Message Protocolï¼Œç½‘é™…ç®¡ç†åè®®, å®ç° IPv4 ä¸­ ICMPã€ARP å’Œ IGMP çš„åŠŸèƒ½</p><p>å‘æºèŠ‚ç‚¹æŠ¥å‘Šå…³äºç›®çš„åœ°å€ä¼ è¾“ IPv6 åŒ…çš„é”™è¯¯å’Œä¿¡æ¯ï¼Œå…·æœ‰å·®é”™æŠ¥å‘Šã€ç½‘ç»œè¯Šæ–­ã€é‚»èŠ‚ç‚¹å‘ç°å’Œå¤šæ’­å®ç°ç­‰åŠŸèƒ½</p><h3 id="æŠ¥æ–‡æ ¼å¼"><a class="markdownIt-Anchor" href="#æŠ¥æ–‡æ ¼å¼"></a> æŠ¥æ–‡æ ¼å¼</h3><p>è¯¥æŠ¥æ–‡å°è£…åœ¨ IPv6 ä¸­ï¼Œnext header å·æ˜¯ 58</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/20211128110949.png" alt="IPv6ä¸­çš„å°è£…" /></p><p>ä½†æ˜¯æ˜¯åœ¨æœ€åä¸€ä¸ªæ‰©å±•é¦–éƒ¨å:</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/20211205205144.png" alt="æŠ¥æ–‡ä½ç½®" /></p><p>å…·ä½“æŠ¥æ–‡æ ¼å¼å¦‚ä¸‹ï¼šIMCP ç±»å‹ï¼ŒICMP ä»£ç ï¼Œæ ¡éªŒå’Œï¼ŒICMP æŠ¥æ–‡å†…å®¹</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/20211128111232.png" alt="å…·ä½“æŠ¥æ–‡æ ¼å¼" /></p><h3 id="é¢„å®šä¹‰ç±»å‹"><a class="markdownIt-Anchor" href="#é¢„å®šä¹‰ç±»å‹"></a> é¢„å®šä¹‰ç±»å‹</h3><p>å­˜åœ¨å¤šç§é¢„å®šä¹‰ç±»å‹ï¼š</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/20211128111330.png" alt="é¢„å®šä¹‰ç±»å‹" /></p><h2 id="ndp"><a class="markdownIt-Anchor" href="#ndp"></a> NDP</h2><p>NDPï¼ŒNeighbor Discovery Protocolï¼Œé‚»å±…å‘ç°åè®®ï¼Œæ˜¯ç”± IPv4 ä¸­çš„åœ°å€è§£æåè®®ARPã€ICMP è·¯ç”±æ¢æµ‹åè®® RDISCã€ICMP æŠ¥æ–‡é‡å®šå‘ç­‰åè®®ç»¼åˆè€Œæˆçš„</p><blockquote><p>å¹¶éå…¨æ–°çš„åè®®éœ€è¦ç”¨åˆ° 133 - 137 è¿™äº”ç±»é¢„å®šä¹‰ IMCPæŠ¥æ–‡</p></blockquote><p>1ã€æ›¿æ¢äº†åŸæ¥çš„ ARP åè®®</p><p>2ã€æ— çŠ¶æ€åœ°å€è‡ªåŠ¨é…ç½®ï¼šå‰ç¼€é€šå‘Šï¼›é‡å¤åœ°å€æ£€æµ‹ï¼›å‰ç¼€é‡æ–°ç¼–å€</p><p>3ã€è·¯ç”±å™¨é‡å®šå‘</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/20211128111652.png" alt="æŠ¥æ–‡ç±»å‹çš„åº”ç”¨" /></p><h3 id="ndp-é‚»æ¥ç‚¹è¯·æ±‚ä¸é€šå‘ŠæŠ¥æ–‡"><a class="markdownIt-Anchor" href="#ndp-é‚»æ¥ç‚¹è¯·æ±‚ä¸é€šå‘ŠæŠ¥æ–‡"></a> NDP é‚»æ¥ç‚¹è¯·æ±‚ä¸é€šå‘ŠæŠ¥æ–‡</h3><p>é‚»å±…èŠ‚ç‚¹è¯·æ±‚/é€šå‘ŠæŠ¥æ–‡å®Œæˆ ARP åŠŸèƒ½ä»¥åŠè¿é€šæ€§æµ‹è¯•</p><p><strong>å®ç° ARP çš„åŠŸèƒ½</strong>ï¼š</p><p>1ã€æºåœ°å€ä¸ºæœ¬åœ°é“¾è·¯åœ°å€ï¼Œç›®çš„åœ°å€ä¸º FF02::1 (æ‰€æœ‰èŠ‚ç‚¹çš„å¤šæ’­åœ°å€)</p><blockquote><p>é‚»æ¥ç‚¹è¯·æ±‚æŠ¥æ–‡ï¼Œå¤šæ’­å½¢å¼å‘é€</p></blockquote><p>2ã€æ”¶åˆ°çš„æ•°æ®å°†æ£€æŸ¥ ICMP æŠ¥æ–‡ä¸­çš„ IPv6 åœ°å€æ˜¯å¦ä¸ºè‡ªå·±çš„ä¸»æœºåœ°å€</p><p>3ã€ï¼ˆTï¼‰å°†è‡ªå·±æ•°æ®é“¾è·¯å±‚åœ°å€ MAC å°è£…åœ¨é‚»èŠ‚ç‚¹é€šå‘ŠæŠ¥æ–‡ä¸­ï¼Œåº”ç­”é‚»æ¥ç‚¹è¯·æ±‚æŠ¥æ–‡</p><p><strong>å®ç°è¿é€šæ€§æµ‹è¯•ï¼ˆICMPï¼‰</strong>ï¼šå·²çŸ¥ MAC åœ°å€çš„æƒ…å†µä¸‹åˆ¤æ–­å­˜æ´»æ€§</p><p>1ã€é‚»èŠ‚ç‚¹è¯·æ±‚æŠ¥æ–‡ä»¥<strong>å•æ’­</strong> IPv6 åˆ†ç»„çš„å½¢å¼å‘é€ï¼šæºåœ°å€ä¸ºè‡ªå·±çš„æœ¬åœ°é“¾è·¯åœ°å€ï¼Œç›®çš„åœ°å€ä¸ºå¯¹æ–¹çš„é“¾è·¯åœ°å€</p><p>2ã€å¦‚æœå‘é€è€…æ”¶åˆ°äº†åº”ç­”çš„é‚»èŠ‚ç‚¹é€šå‘ŠæŠ¥æ–‡ï¼Œå®ƒè®¤ä¸ºç›®çš„åœ°å€æ˜¯å¯è¾¾çš„ï¼›å¦åˆ™å®ƒè®¤ä¸ºç›®çš„ä¸»æœºæ˜¯ä¸å¯è¾¾çš„ã€‚</p><blockquote><p>åœ¨è¿™ä¸€è¿‡ç¨‹ä¸­æ¶‰åŠæºåœ°å€ä¸ç›®çš„åœ°å€<strong>éƒ½ä½¿ç”¨æœ¬åœ°é“¾è·¯åœ°å€ï¼Œå¹¶éçœŸå®çš„ IPv6 åœ°å€</strong>ï¼Œå› ä¸ºæœ¬åœ°é“¾è·¯åœ°å€å°±æ˜¯ç”¨æ¥<strong>é‚»å±…èŠ‚ç‚¹</strong>å‘ç°çš„</p></blockquote><h3 id="ndp-è·¯ç”±å™¨è¯·æ±‚æŠ¥æ–‡å’Œè·¯ç”±å™¨é€šå‘ŠæŠ¥æ–‡"><a class="markdownIt-Anchor" href="#ndp-è·¯ç”±å™¨è¯·æ±‚æŠ¥æ–‡å’Œè·¯ç”±å™¨é€šå‘ŠæŠ¥æ–‡"></a> NDP è·¯ç”±å™¨è¯·æ±‚æŠ¥æ–‡å’Œè·¯ç”±å™¨é€šå‘ŠæŠ¥æ–‡</h3><p>è·¯ç”±å™¨æ¯ 5 åˆ†é’Ÿå°±å‘é€ä¸€ä¸ªè·¯ç”±å™¨é€šå‘ŠæŠ¥æ–‡ï¼Œä½¿å¾—ä¸»æœºäº†è§£å¹¶æ›´æ–°æ¯ä¸ªç½‘ç»œæ¥å£æ‰€è¿æ¥çš„é“¾è·¯ä¸Šçš„è·¯ç”±å™¨çš„æœ‰å…³ä¿¡æ¯</p><blockquote><p>å¤šæ¥å£ä¸»æœºéœ€è¦å‘é€ IPv6 åˆ†ç»„æ—¶ï¼Œéœ€è¦äº†è§£æ¯ä¸ªç½‘ç»œæ¥å£æ‰€è¿æ¥çš„é“¾è·¯ä¸Šçš„è·¯ç”±å™¨çš„æœ‰å…³ä¿¡æ¯</p></blockquote><p>å¦å¤–ï¼Œä¸»æœºå¯ä»¥ä¸»åŠ¨å‘è·¯ç”±å™¨å‘é€è·¯ç”±å™¨è¯·æ±‚æŠ¥æ–‡ï¼Œè·¯ç”±å™¨ä¸€æ—¦æ”¶åˆ°è·¯ç”±å™¨è¯·æ±‚æŠ¥æ–‡ï¼Œå°†ç«‹å³å‘é€è·¯ç”±å™¨é€šå‘ŠæŠ¥æ–‡</p><blockquote><p>é€‚ç”¨äºç½‘ç»œåˆšè¿æ¥è¿‘ä¸€å°æ–°ä¸»æœº</p></blockquote><p><strong>å®ç°å‰ç¼€é€šå‘ŠåŠŸèƒ½</strong>ï¼šå‰ç¼€é€šå‘Šæ˜¯æ— çŠ¶æ€è‡ªåŠ¨é…ç½®ä¸­çš„åˆå§‹æœºåˆ¶ï¼ŒIPv6 è·¯ç”±å™¨ä½¿ç”¨æ‰€æœ‰èŠ‚ç‚¹å¤šæ’­åœ°å€ <code>FF02::1</code>ï¼Œåœ¨æœ¬åœ°é“¾è·¯ä¸Šå‘¨æœŸæ€§åœ°å‘é€è·¯ç”±å™¨é€šå‘ŠæŠ¥æ–‡</p><blockquote><p>åªæœ‰ IPv6 è·¯ç”±å™¨èƒ½åœ¨æœ¬åœ°é“¾è·¯ä¸Šé€šå‘Šå‰ç¼€ï¼Œç¦æ­¢ä¸»æœºé€šå‘Šå‰ç¼€</p></blockquote><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/20211205210051.png" alt="å‰ç¼€é€šå‘Š" /></p><h3 id="ndp-é‡å¤åœ°å€æ£€æµ‹"><a class="markdownIt-Anchor" href="#ndp-é‡å¤åœ°å€æ£€æµ‹"></a> NDP é‡å¤åœ°å€æ£€æµ‹</h3><p>æ¯ä¸ªç½‘ç»œæ¥å£å¯ä»¥è¿›è¡Œ IPv6 åœ°å€çš„æ— çŠ¶æ€é…ç½®ï¼Œä½†æ˜¯é…ç½®å‰éœ€è¦æ ¹æ®è·¯ç”±å™¨è¯·æ±‚æŠ¥æ–‡å’Œè·¯ç”±å™¨é€šå‘ŠæŠ¥æ–‡è·å–å‰ç¼€ï¼Œç„¶åè¿›è¡Œé‡å¤åœ°å€æ£€æµ‹ï¼Œå³å‘é€ä¸€ä¸ªé‚»æ¥ç‚¹è¯·æ±‚åŸŸé€šå‘ŠæŠ¥æ–‡è¯¢é—®æ˜¯å¦æœ‰äººä½¿ç”¨äº†è¿™ä¸ªåœ°å€</p><p>Qï¼šMAC åœ°å€ç”Ÿæˆçš„æ¥å£ ID æ˜¯å”¯ä¸€çš„ï¼Œè¿˜é€šå‘Šå•¥ï¼Ÿ</p><p>Aï¼šåœ°å€æ—¢å¯ä»¥æ— çŠ¶æ€é…ç½®ä¹Ÿå¯ä»¥æ‰‹åŠ¨é…ç½®ï¼Œå› æ­¤éœ€è¦é˜²æ­¢ä¸æ‰‹åŠ¨é…ç½®çš„åœ°å€å†²çªã€‚</p><h1 id="ipv6-å®‰å…¨æœºåˆ¶"><a class="markdownIt-Anchor" href="#ipv6-å®‰å…¨æœºåˆ¶"></a> IPv6 å®‰å…¨æœºåˆ¶</h1><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/20211128121525.png" alt="æ”»å‡»æ–¹å¼å¯¹æ¯”" /></p><p>1ã€v6 æ²¡æœ‰å¹¿æ’­åŒ…ï¼ˆä½†æ˜¯å¤šæ’­åŒ…æˆ–è®¸ä¹Ÿå¯ä»¥è¢«åˆ©ç”¨ï¼‰</p><p>2ã€v6 æ²¡æœ‰ ARP åè®®ï¼ˆä½†æ˜¯ ICMP çš„é‚»èŠ‚ç‚¹è¯·æ±‚å®ç°æ¬ºéª—æˆ–è®¸ä¹Ÿå¯ä»¥ï¼‰</p><p>3ã€v6 åœ°å€ç©ºé—´å¤ªå¤§ï¼Œå¯ä»¥æœ‰æ•ˆé˜²æ­¢ IP æ‰«æ</p><p>4ã€v6 å¿½ç•¥å¾ˆå°çš„åˆ†ç‰‡ï¼Œé˜²æ­¢ç¢ç‰‡æ”»å‡»</p><p>5ã€v6 é›†æˆäº† IPSec</p><p>6ã€Dos è·Ÿ IP çš„å…³ç³»è¾ƒå°‘ï¼Œæ¯”å¦‚ TCP å’Œ UDP çš„DOS</p><p>7ã€v6 ä¼šè¿›è¡ŒçœŸå®æºåœ°å€æ£€æŸ¥ï¼Œé˜²æ­¢ç½‘ç»œæ”¾å¤§æ”»å‡»ï¼Œå¯æº¯æº</p><p>8ã€v6 ç¦ç”¨äº† NAT é‚£ä¹ˆç›®æ ‡ä¸»æœºåœ°å€å°†ä¼šæš´éœ²</p><p>9ã€v6 çš„åŠŸèƒ½å¼ºå¤§ï¼Œå› æ­¤å¯¹åº”çš„æ”»å‡»ç‚¹ä¹Ÿæ›´å¤š</p><p>10ã€v6 å¼•å…¥äº†æ‰©å±•å¤´</p><p>11ã€v6 ä¸­ DNS å¼•å…¥äº†ä¸€å®šçš„å˜åŒ–ï¼Œç•¥</p><h2 id="ç«¯åˆ°ç«¯-ipsec-å®‰å…¨åè®®"><a class="markdownIt-Anchor" href="#ç«¯åˆ°ç«¯-ipsec-å®‰å…¨åè®®"></a> ç«¯åˆ°ç«¯ IPSec å®‰å…¨åè®®</h2><p>IPv6 ä¸­é›†æˆäº† IPSecï¼Œé€šè¿‡è®¤è¯æŠ¥å¤´ï¼ˆAHï¼‰å’Œå°è£…å®‰å…¨è½½è·æŠ¥å¤´ï¼ˆESPï¼‰ä¸¤ä¸ªæ‰©å±•å¤´å®ç°åŠ å¯†ã€éªŒè¯åŠŸèƒ½</p><blockquote><p>IPSec æŠ—é‡æ”¾æ”»å‡»ç­‰å®‰å…¨åŠŸèƒ½åœ¨ IPv6 åè®®ä¸­åŒæ ·è¢«ç»§æ‰¿</p></blockquote><p>Tipsï¼šIPv6 é™åˆ¶ä½¿ç”¨ NATï¼Œå› æ­¤é›†æˆäº† IPSec çš„ IPv6 åè®®çœŸæ­£å®ç°äº†ç«¯åˆ°ç«¯çš„å®‰å…¨ï¼Œä¸­é—´è½¬å‘è®¾å¤‡åªéœ€è¦å¯¹å¸¦æœ‰ IPSec æ‰©å±•åŒ…å¤´çš„æŠ¥æ–‡è¿›è¡Œæ™®é€šé€æ˜è½¬å‘ï¼Œå¤§å¤§å‡è½»è½¬å‘å‹åŠ›</p><blockquote><p>é€æ˜è½¬å‘ï¼šä¸­é—´è·¯ç”±å™¨å°†ä¸å¿…å¤„ç†æŠ¥æ–‡ç›´æ¥è½¬å‘å³å¯</p><p>IPv6 æé«˜äº†è½¬å‘æ•ˆç‡å‡è½»äº†è½¬å‘å‹åŠ›ï¼šIPv4 ä¸­åŒ…å¤´ä¸­é¡¹è¾ƒå¤šï¼Œæ¯ä¸€å°è·¯ç”±å™¨éƒ½å¾—å¤„ç†ä¸€éï¼›åœ¨ IPv6 ä¸­ç¼©å‡äº†åŒ…å¤´ï¼Œå°†å¤§éƒ¨åˆ†åŠŸèƒ½æ”¾åˆ°äº†æ‰©å±•æŠ¥å¤´ä¸­å®ç°ï¼Œè·¯ç”±å™¨å€ŸåŠ© Next Header åªæ£€æŸ¥å¿…è¦çš„æ‰©å±•åŒ…å¤´å³å¯</p></blockquote><h2 id="çœŸå®æºåœ°å€æ£€æŸ¥ä½“ç³»"><a class="markdownIt-Anchor" href="#çœŸå®æºåœ°å€æ£€æŸ¥ä½“ç³»"></a> çœŸå®æºåœ°å€æ£€æŸ¥ä½“ç³»</h2><p>åœ¨ IPv6 ä¸­å°†å¯¹æ¥å…¥è·¯ç”±å™¨çš„ç”¨æˆ·è¿›è¡Œæºåœ°å€æ£€æŸ¥ï¼Œä½¿å¾—å› ç‰¹ç½‘æœåŠ¡æä¾›å•† ISP å¯ä»¥éªŒè¯å…¶å®¢æˆ·åœ°å€çš„åˆæ³•æ€§</p><blockquote><p>çœŸå®IPæºåœ°å€çš„ä¸‰é‡å«ä¹‰ï¼šç»æˆæƒçš„ (æ˜¯ä¸æ˜¯æˆ‘é…çš„æˆ–è€…å¯ä¿¡æœºæ„é…çš„)ã€å”¯ä¸€çš„ã€å¯è¿½æº¯çš„</p></blockquote><p>çœŸå®æº IPv6 åœ°å€éªŒè¯ä½“ç³»ç»“æ„ï¼ˆSAVAï¼‰ï¼šåˆ†ä¸ºæ¥å…¥ç½‘ï¼ˆAccess Networkï¼‰ã€åŒºåŸŸå†…ï¼ˆIntra-ASï¼‰å’ŒåŒºåŸŸé—´ï¼ˆInter-ASï¼‰æºåœ°å€éªŒè¯ä¸‰ä¸ªå±‚æ¬¡</p><blockquote><p>ä»ä¸»æœºIPåœ°å€ã€IPåœ°å€å‰ç¼€å’Œè‡ªæ²»åŸŸä¸‰ä¸ªç²’åº¦æ„æˆå¤šé‡ç›‘æ§é˜²å¾¡ä½“ç³»</p><p>è¯¥ä½“ç³»ä¸ä½†å¯ä»¥æœ‰æ•ˆé˜»æ­¢ä»¿å†’æºåœ°å€ç±»æ”»å‡»ï¼›è€Œä¸”èƒ½å¤Ÿé€šè¿‡ç›‘æ§æµé‡æ¥å®ç°åŸºäºçœŸå®æºåœ°å€çš„è®¡è´¹å’Œç½‘ç®¡ã€‚</p></blockquote><h2 id="é˜²æ‰«æ"><a class="markdownIt-Anchor" href="#é˜²æ‰«æ"></a> é˜²æ‰«æ</h2><p>IPv4 ä¸­ï¼šé»‘å®¢æ”»å‡»å‰é€šå¸¸å¯¹ç›®æ ‡ä¸»æœºåŠç½‘ç»œè¿›è¡Œæ‰«æå¹¶æœé›†æ•°æ®ï¼Œä»¥æ­¤æ¨æ–­å‡ºç›®æ ‡ç½‘ç»œçš„æ‹“æ‰‘ç»“æ„åŠä¸»æœºå¼€æ”¾çš„æœåŠ¡ã€ç«¯å£ç­‰</p><p>IPv6 ä¸­ï¼šæ¯ä¸€ä¸ª IPv6 åœ°å€æ˜¯ 128 ä½ï¼Œå‡è®¾ç½‘ç»œå‰ç¼€ä¸º 64 ä½ï¼Œé‚£ä¹ˆåœ¨ä¸€ä¸ªå­ç½‘ä¸­å°±ä¼šå­˜åœ¨ 2^64 ä¸ªåœ°å€ï¼Œå‡è®¾æ”»å‡»è€…ä»¥ 10M/s çš„é€Ÿåº¦æ‰«æï¼Œéœ€è¦ 5 ä¸‡å¹´æ‰èƒ½éå†æ‰€æœ‰çš„åœ°å€</p><blockquote><p>è¿™ä½¿ç½‘ç»œä¾¦å¯Ÿçš„éš¾åº¦å’Œä»£ä»·éƒ½å¤§å¤§å¢åŠ ä¹Ÿé—´æ¥å¢åŠ äº†è •è™«ç—…æ¯’æ‰©æ•£çš„éš¾åº¦</p></blockquote><h2 id="å¯æº¯æº"><a class="markdownIt-Anchor" href="#å¯æº¯æº"></a> å¯æº¯æº</h2><p>IPv4 ä¸­ï¼šNAT çš„å¹¿æ³›åº”ç”¨ä¸€å®šç¨‹åº¦ä¸Šç ´åäº†äº’è”ç½‘ç«¯åˆ°ç«¯é€šä¿¡çš„ç‰¹æ€§å¹¶éšè—äº†ç”¨æˆ·çš„çœŸå® IPï¼Œå¯¼è‡´äº‹å‰åŸºäºè¿‡æ»¤ç±»çš„é¢„é˜²æœºåˆ¶å’Œäº‹åè¿½è¸ªæº¯æºå˜çš„å°¤ä¸ºå›°éš¾</p><blockquote><p>æˆ‘è¿‡æ»¤çš„å…¬ç½‘åœ°å€å¯èƒ½æ˜¯ä¸€ä¸ªæœºæ„çš„å…¬ç½‘åœ°å€ï¼Œä¸èƒ½å› ä¸ºæœºæ„å†…çš„ä¸€ä¸ªäººï¼Œå°æ‰æ•´ä¸ªæœºæ„</p></blockquote><p>IPv6 ä¸­ï¼šæ¯ä¸€ä¸ªç»ˆç«¯éƒ½å¯ä»¥åˆ†é…åˆ°ä¸€ä¸ª IP åœ°å€å¹¶å’Œä¸ªäººä¿¡æ¯è¿›è¡Œç»‘å®šï¼Œå®‰å…¨è®¾å¤‡å¯ä»¥é€šè¿‡ç®€å•çš„è¿‡æ»¤ç­–ç•¥å¯¹èŠ‚ç‚¹è¿›è¡Œå®‰å…¨æ§åˆ¶ï¼Œè¿›ä¸€æ­¥æé«˜ç½‘ç»œå®‰å…¨æ€§</p><h2 id="é˜²æ­¢ç½‘ç»œæ”¾å¤§æ”»å‡»"><a class="markdownIt-Anchor" href="#é˜²æ­¢ç½‘ç»œæ”¾å¤§æ”»å‡»"></a> é˜²æ­¢ç½‘ç»œæ”¾å¤§æ”»å‡»</h2><p>IPv6 ä¸­ä¸å­˜å¹¿æ’­åœ°å€åªæœ‰æœ‰é™çš„å¤šæ’­åœ°å€ï¼Œå› æ­¤åœ¨ä¸€å®šç¨‹åº¦ä¸Šé˜²æ­¢äº†ç½‘ç»œæ”¾å¤§æ”»å‡»</p><blockquote><p>ICMPv6 åœ¨è®¾è®¡ä¸Šä¸ä¼šå“åº”ç»„æ’­åœ°å€å’Œå¹¿æ’­åœ°å€çš„æ¶ˆæ¯ï¼Œä¸å­˜åœ¨å¹¿æ’­ï¼Œæ‰€ä»¥ï¼Œåªéœ€è¦åœ¨ç½‘ç»œè¾¹ç¼˜è¿‡æ»¤ç»„æ’­æ•°æ®åŒ…ï¼Œå³å¯é˜»æ­¢ç”±æ”»å‡»è€…å‘å¹¿æ’­ç½‘æ®µå‘é€æ•°æ®åŒ…è€Œå¼•èµ·çš„ç½‘ç»œæ”¾å¤§æ”»å‡»ã€‚</p></blockquote><h2 id="é˜²æ­¢ç¢ç‰‡æ”»å‡»"><a class="markdownIt-Anchor" href="#é˜²æ­¢ç¢ç‰‡æ”»å‡»"></a> é˜²æ­¢ç¢ç‰‡æ”»å‡»</h2><p>IPv6 è®¤ä¸º MTU å°äº 1280 å­—èŠ‚çš„æ•°æ®åŒ…æ˜¯éæ³•çš„ï¼Œå¤„ç†æ—¶ä¼šä¸¢å¼ƒ MTU å°äº 1280 å­—èŠ‚çš„æ•°æ®åŒ…(é™¤éå®ƒæ˜¯æœ€åä¸€ä¸ªåŒ…)</p><h1 id="ipv6-å®‰å…¨é—®é¢˜"><a class="markdownIt-Anchor" href="#ipv6-å®‰å…¨é—®é¢˜"></a> IPv6 å®‰å…¨é—®é¢˜</h1><h2 id="æ‰©å±•åŒ…å¤´å®‰å…¨é—®é¢˜"><a class="markdownIt-Anchor" href="#æ‰©å±•åŒ…å¤´å®‰å…¨é—®é¢˜"></a> æ‰©å±•åŒ…å¤´å®‰å…¨é—®é¢˜</h2><p>åè®®è§„èŒƒæ²¡æœ‰çº¦æŸæ‰©å±•æŠ¥å¤´çš„ä½¿ç”¨ï¼Œè¿™å­˜åœ¨æå¤§çš„å®‰å…¨éšæ‚£</p><h3 id="ä¸‹ä¸€æŠ¥å¤´ä¸å­˜åœ¨"><a class="markdownIt-Anchor" href="#ä¸‹ä¸€æŠ¥å¤´ä¸å­˜åœ¨"></a> ä¸‹ä¸€æŠ¥å¤´ä¸å­˜åœ¨</h3><p>æ”»å‡»è€…å¯å°†ä¸‹ä¸€æŠ¥å¤´å­—æ®µè®¾ç½®ç•¸å½¢å€¼ï¼Œå¯å®æ–½æ‹’ç»æœåŠ¡ï¼ˆDoSï¼‰æ”»å‡»</p><h3 id="æ‰©å±•æŠ¥å¤´æ•°ç›®è¿‡å¤š"><a class="markdownIt-Anchor" href="#æ‰©å±•æŠ¥å¤´æ•°ç›®è¿‡å¤š"></a> æ‰©å±•æŠ¥å¤´æ•°ç›®è¿‡å¤š</h3><p>v6 åè®®å¯¹æ‰©å±•å¤´æ•°é‡æ²¡æœ‰åšå‡ºé™åˆ¶ä¸”åŒä¸€ç§ç±»å‹çš„æ‰©å±•å¤´ä¹Ÿå¯ä»¥å‡ºç°å¤šæ¬¡ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡æ„é€ åŒ…å«å¼‚å¸¸æ•°é‡æ‰©å±•å¤´çš„æŠ¥æ–‡å¯¹é˜²ç«å¢™è¿›è¡Œ DOS æ”»å‡»ï¼Œé˜²ç«å¢™åœ¨è§£ææŠ¥æ–‡æ—¶è€—è´¹å¤§é‡èµ„æºï¼Œä»è€Œå½±å“è½¬å‘æ€§èƒ½</p><blockquote><p>é˜²å¾¡æŠ€æœ¯ï¼šé™åˆ¶æ‰©å±•å¤´çš„æ•°é‡å’ŒåŒä¸€ç±»å‹æ‰©å±•å¤´çš„æ•°ç›®æ¥é¿å…</p></blockquote><h3 id="é€è·³é€‰é¡¹æŠ¥å¤´"><a class="markdownIt-Anchor" href="#é€è·³é€‰é¡¹æŠ¥å¤´"></a> é€è·³é€‰é¡¹æŠ¥å¤´</h3><p>å‘é€å¤§é‡åŒ…å«è·¯ç”±æç¤ºé€‰é¡¹çš„ IPv6 æ•°æ®åŒ…ï¼ŒåŒ…å«æœ‰è¯¥æŠ¥å¤´çš„æ•°æ®åŒ…ä¸ºæ¯æ¬¡è·³è½¬æŒ‡å®šè½¬å‘å‚æ•°ï¼Œè¦æ±‚æ‰€æœ‰è·¯ç”±å™¨å¯¹è¯¥æ•°æ®åŒ…è¿›è¡Œå¤„ç†å¹¶ä»”ç»†æŸ¥çœ‹è¯¥æ•°æ®åŒ…çš„æŠ¥å¤´ä¿¡æ¯ï¼Œå½“æ”»å‡»è€…å‘é€å¤§é‡æ­¤ç±» IPv6 æ•°æ®åŒ…æ—¶ï¼Œå°†æ¶ˆè€—é“¾è·¯ä¸Šè·¯ç”±å™¨å¤§é‡èµ„æºï¼Œä¸¥é‡å¯é€ æˆ DoS æ”»å‡»ã€‚</p><blockquote><p>é™åˆ¶è·¯ç”±å™¨å¯¹åŒ…å«è·¯ç”±æç¤ºé€‰é¡¹çš„æ•°æ®åŒ…çš„å¤„ç†æ•°é‡ã€‚</p></blockquote><h3 id="ç›®çš„é€‰é¡¹æŠ¥å¤´"><a class="markdownIt-Anchor" href="#ç›®çš„é€‰é¡¹æŠ¥å¤´"></a> ç›®çš„é€‰é¡¹æŠ¥å¤´</h3><p>ç›®çš„é€‰é¡¹æŠ¥å¤´æœ¬ç”¨äºä¸ºä¸­é—´æˆ–æœ€ç»ˆç›®æ ‡æŒ‡å®šæ•°æ®åŒ…çš„è½¬å‘å‚æ•°</p><p>å› ä¸ºåœ¨ç§»åŠ¨ IP åè®®çš„æ•°æ®é€šä¿¡ä»¥æ˜æ–‡è¿›è¡Œä¼ è¾“ï¼Œå…¶æœ¬èº«å°±æ˜¯ä¸å®‰å…¨çš„ï¼›æ”»å‡»è€…å¯å¯¹ç§»åŠ¨ IPv6 æ•°æ®åŒ…è¿›è¡Œå—…æ¢è¿›è€Œè¯†åˆ«å…¶é€šä¿¡èŠ‚ç‚¹ã€è½¬äº¤åœ°å€ã€å®¶ä¹¡åœ°å€ã€å®¶ä¹¡ä»£ç†ç­‰ä¿¡æ¯ï¼ˆå®šä¹‰äº†æ–°çš„ç›®çš„é€‰é¡¹æŠ¥å¤´ï¼‰ï¼Œå¹¶åˆ©ç”¨è¿™äº›ä¿¡æ¯ä¼ªé€ æ•°æ®åŒ…ï¼›</p><p>éšåæ”»å‡»è€…å¯é€šè¿‡æ‹¦æˆªç±»å‹ä¸ºæ¶ˆæ¯ç»‘å®šæ›´æ–°çš„æ•°æ®åŒ…ï¼Œä¿®æ”¹ç»‘å®šå…³ç³»ä¸­çš„è½¬äº¤åœ°å€ï¼ˆç›®çš„é€‰é¡¹ï¼‰</p><blockquote><p>æ­¤å¤–ï¼Œç§»åŠ¨èŠ‚ç‚¹æ ‡è¯†ç¬¦é€‰é¡¹æ­ç¤ºäº†ç”¨æˆ·çš„å®¶ä¹¡ä»å±å…³ç³»ï¼Œæ”»å‡»è€…å¯åˆ©ç”¨è¯¥é€‰é¡¹ç¡®å®šç”¨æˆ·èº«ä»½ï¼Œé”å®šç‰¹å®šçš„æ”»å‡»å¯¹è±¡</p></blockquote><blockquote><p>è§£å†³ TCP/IP ä¸æ”¯æŒç§»åŠ¨æ€§çš„é—®é¢˜ï¼›å®¶ä¹¡åœ°å€ä¸­é…æœ‰æœåŠ¡ï¼Œå°†æˆªè·é€šä¿¡å¹¶é€šè¿‡éš§é“è½¬å‘ç»™æ–°åœ°å€ï¼Œä¿è¯äº† TCP äº”å…ƒç»„ä¸å˜ï¼Œè¿æ¥ä¸æ–­ã€‚å¼€å¯IPSecä¿è¯æ•°æ®åŒ…ä¸ä¼šè¢«çªƒå¬</p></blockquote><h3 id="è·¯ç”±æŠ¥å¤´"><a class="markdownIt-Anchor" href="#è·¯ç”±æŠ¥å¤´"></a> è·¯ç”±æŠ¥å¤´</h3><p>è·¯ç”±æŠ¥å¤´åˆ—å‡ºæ•°æ®åŒ…ä»æºåœ°å€åˆ°ç›®çš„åœ°å€ä¹‹é—´å°†è¦è®¿é—®çš„ä¸€ä¸ªæˆ–å¤šä¸ªä¸­é—´èŠ‚ç‚¹ï¼Œåœ¨ RH0 è·¯ç”±ç±»å‹ï¼ˆå³type 0ï¼‰ä¸‹ï¼Œæ”»æ”»å‡»è€…å¯åˆ©ç”¨è·¯ç”±æŠ¥å¤´é€‰é¡¹ä¼ªè£…æˆåˆæ³•ç”¨æˆ·æ¥æ”¶è¿”å›çš„æ•°æ®åŒ…</p><p>æ”»å‡»ç‚¹ï¼šRH0 å…è®¸åœ¨è·¯ç”±å¤´éƒ¨ä¸­çš„å¤šä¸ªä½ç½®æŒ‡å®šç›¸åŒåœ°å€ã€‚è¿™å¯èƒ½å¯¼è‡´æµé‡åœ¨ä¸€æ¡ç‰¹å®šè·¯å¾„ä¸Šçš„ä¸¤å°æˆ–å¤šå°è·¯ç”±å™¨æˆ–ä¸»æœºä¹‹é—´é‡å¤è½¬å‘</p><blockquote><p>å°½å¿«æ›´æ–°å®‰å…¨è®¾å¤‡å¹¶å‡çº§è‡³æœ€æ–°çš„ IPv6 åè®®ç‰ˆæœ¬ RH2 ï¼ŒåŒæ—¶å¯¹æ‰€æœ‰çš„ RH0 æ•°æ®åŒ…è¿›è¡Œä¸¢å¼ƒã€‚RH2 åªå®¹çº³ä¸€ä¸ªåœ°å€</p></blockquote><h3 id="åˆ†æ®µæŠ¥å¤´"><a class="markdownIt-Anchor" href="#åˆ†æ®µæŠ¥å¤´"></a> åˆ†æ®µæŠ¥å¤´</h3><p>ç•¥</p><h2 id="icmpv6-å®‰å…¨å¨èƒ"><a class="markdownIt-Anchor" href="#icmpv6-å®‰å…¨å¨èƒ"></a> ICMPv6 å®‰å…¨å¨èƒ</h2><h3 id="smurf-æ”»å‡»"><a class="markdownIt-Anchor" href="#smurf-æ”»å‡»"></a> Smurf æ”»å‡»</h3><p>ä»¥ç›®æ ‡èŠ‚ç‚¹ä½œä¸ºæºåœ°å€å‘ç»„æ’­åœ°å€ FF02::1 å‘é€ ICMPv6  Echo Request æ¶ˆæ¯å®ç°Smurfæ”»å‡»</p><h3 id="æœ¬åœ°é“¾è·¯æ‰«æ"><a class="markdownIt-Anchor" href="#æœ¬åœ°é“¾è·¯æ‰«æ"></a> æœ¬åœ°é“¾è·¯æ‰«æ</h3><p>å‘ç»„æ’­åœ°å€ FF02::1 å‘é€ Echo Request æŠ¥æ–‡ï¼Œé€šè¿‡æ¥æ”¶ Echo Reply æŠ¥æ–‡ï¼Œå®ç°æ‰«æ</p><h3 id="dos-æ”»å‡»"><a class="markdownIt-Anchor" href="#dos-æ”»å‡»"></a> Dos æ”»å‡»</h3><p>å‘ç›®æ ‡èŠ‚ç‚¹å‘é€è¿‡å¤šçš„ ICMPv6 åŒ…ä»¥åŠå‘é€é”™è¯¯æ¶ˆæ¯ï¼Œå¯¼è‡´ä¼šè¯è¢«ä¸¢å¼ƒï¼Œä»è€Œç ´åå·²å»ºç«‹çš„é€šä¿¡</p><h3 id="ä¸»æœºæ‰«æ"><a class="markdownIt-Anchor" href="#ä¸»æœºæ‰«æ"></a> ä¸»æœºæ‰«æ</h3><p>å‘ä¸»æœºå‘é€æ ¼å¼ä¸æ­£ç¡®çš„æ¶ˆæ¯åˆºæ¿€ä¸»æœºå¯¹ ICMPv6 çš„å“åº”ï¼Œä»è€Œå‘ç°æ½œåœ¨çš„æ”»å‡»ç›®æ ‡</p><h3 id="é™ä½ä¼ è¾“é€Ÿç‡"><a class="markdownIt-Anchor" href="#é™ä½ä¼ è¾“é€Ÿç‡"></a> é™ä½ä¼ è¾“é€Ÿç‡</h3><p>å‘ç›®æ ‡èŠ‚ç‚¹å‘é€ ICMPv6 Packet too big æŠ¥æ–‡ï¼Œå‡å°æ¥æ”¶èŠ‚ç‚¹çš„ MTUï¼Œé™ä½ä¼ è¾“é€Ÿç‡</p><h3 id="é˜²å¾¡"><a class="markdownIt-Anchor" href="#é˜²å¾¡"></a> é˜²å¾¡</h3><p>1ã€åœ¨äº¤æ¢æœºçš„æ¯ä¸ªç‰©ç†ç«¯å£è®¾ç½®æµé‡é™åˆ¶ï¼›</p><p>2ã€åœ¨é˜²ç«å¢™æˆ–è¾¹ç•Œè·¯ç”±å™¨ä¸Šå¯åŠ¨ ICMPv6 æ•°æ®åŒ…è¿‡æ»¤æœºåˆ¶ï¼›</p><p>3ã€é…ç½®è·¯ç”±å™¨æ‹’ç»è½¬å‘å¸¦æœ‰ç»„æ’­åœ°å€çš„ ICMPv6 Echo Request æŠ¥æ–‡ï¼›</p><p>4ã€å¯å°è¯•å…³é—­ PMTU å‘ç°æœºåˆ¶ï¼Œä½†å…¶ä¼šå½±å“åˆ°ç½‘ç»œæ•°æ®çš„ä¼ è¾“é€Ÿç‡</p><h2 id="ndp-åè®®æ”»å‡»"><a class="markdownIt-Anchor" href="#ndp-åè®®æ”»å‡»"></a> NDP åè®®æ”»å‡»</h2><h3 id="ä¸­é—´äººæ”»å‡»"><a class="markdownIt-Anchor" href="#ä¸­é—´äººæ”»å‡»"></a> ä¸­é—´äººæ”»å‡»</h3><p>NDP åè®®åŸºäºå¯ä¿¡ç½‘ç»œå› æ­¤å¹¶ä¸å…·å¤‡è®¤è¯åŠŸèƒ½ï¼Œå› æ­¤å¯é€šè¿‡ä¼ªé€  ICMPv6 NA/RA æŠ¥æ–‡å®ç°ä¸­é—´äººæ”»å‡»ã€‚</p><p>è¿‡ç¨‹ï¼šæ”»å‡»è€…å¯ä»¥ä¼ªé€  NA æŠ¥æ–‡ï¼ˆé‚»èŠ‚ç‚¹é€šå‘Šï¼‰ï¼Œå°†è‡ªå·±çš„é“¾è·¯å±‚åœ°å€ä½œä¸ºé“¾è·¯ä¸Šå…¶ä»–ä¸»æœºçš„åœ°å€è¿›è¡Œå¹¿æ’­ï¼ˆä¸»åŠ¨å“åº”å…¶å®ƒä¸»æœºçš„é‚»èŠ‚ç‚¹è¯·æ±‚ï¼‰ã€‚</p><p>æ”»å‡»è€…å¯ä¼ªé€  RA æŠ¥æ–‡ï¼ˆè·¯ç”±å™¨é€šå‘Šï¼‰å‘é€è‡³ç›®æ ‡èŠ‚ç‚¹ä¿®æ”¹å…¶é»˜è®¤ç½‘å…³ã€‚</p><h3 id="é‡å¤åœ°å€æ£€æµ‹æ”»å‡»"><a class="markdownIt-Anchor" href="#é‡å¤åœ°å€æ£€æµ‹æ”»å‡»"></a> é‡å¤åœ°å€æ£€æµ‹æ”»å‡»</h3><p>å½“ç›®æ ‡èŠ‚ç‚¹å‘ FF02::1 æ‰€æœ‰èŠ‚ç‚¹å‘é€ NS æ•°æ®åŒ…ï¼ˆé‚»èŠ‚ç‚¹è¯·æ±‚ï¼‰è¿›è¡Œé‡å¤åœ°å€æ£€æµ‹æ—¶ï¼Œæ”»å‡»è€…å¯å‘è¯¥èŠ‚ç‚¹å‘é€ NA æŠ¥æ–‡ï¼ˆé‚»èŠ‚ç‚¹é€šå‘Šï¼‰è¿›è¡Œå“åº”ï¼Œå¹¶è¡¨æ˜è¯¥åœ°å€å·²è¢«è‡ªå·±ä½¿ç”¨ã€‚å½“èŠ‚ç‚¹æ¥æ”¶åˆ°è¯¥åœ°å€å·²è¢«å ç”¨æ¶ˆæ¯åé‡æ–°ç”Ÿæˆæ–°çš„ IPv6 åœ°å€å¹¶å†ä¸€æ¬¡è¿›è¡Œé‡å¤åœ°å€æ£€æµ‹æ—¶ï¼Œæ”»å‡»è€…å¯ç»§ç»­è¿›è¡Œ NA å“åº”å®ç° DoS æ”»å‡»</p><h3 id="æ³›æ´ªæ”»å‡»"><a class="markdownIt-Anchor" href="#æ³›æ´ªæ”»å‡»"></a> æ³›æ´ªæ”»å‡»</h3><p>æ”»å‡»è€…å¯ä¼ªé€ ä¸åŒç½‘ç»œå‰ç¼€ RA æ¶ˆæ¯å¯¹ FF02 :: 1 è¿›è¡Œè¿›è¡Œæ³›æ´ªæ”»å‡»ï¼Œæ¥æ”¶èŠ‚ç‚¹å°†ä¼šæ ¹æ®ä¸åŒçš„ç½‘ç»œå‰ç¼€è¿›è¡Œæ›´æ–°ï¼Œä»è€Œæ¶ˆè€—å¤§é‡çš„ CPU èµ„æºã€‚</p><h2 id="ndp-åè®®é˜²å¾¡"><a class="markdownIt-Anchor" href="#ndp-åè®®é˜²å¾¡"></a> NDP åè®®é˜²å¾¡</h2><h3 id="send-åè®®"><a class="markdownIt-Anchor" href="#send-åè®®"></a> SEND åè®®</h3><p>å®‰å…¨é‚»å±…å‘ç°åè®®ï¼ŒSEND åè®®ï¼Œä½¿ç½‘ç»œä¸­æ¯ä¸ª IPv6 èŠ‚ç‚¹éƒ½æœ‰ä¸€å¯¹å…¬ç§é’¥ä»¥åŠå¤šä¸ªé‚»å±…æ‰©å±•é€‰é¡¹ã€‚</p><p>é‡‡ç”¨ SEND åè®®åï¼Œå„ä¸ªèŠ‚ç‚¹çš„æ¥å£æ ‡è¯†ç¬¦ï¼ˆIPv6 åœ°å€ä½ 64 æ¯”ç‰¹ï¼‰å°†åŸºäºå½“å‰çš„ IPv6 ç½‘ç»œå‰ç¼€ä¸å…¬é’¥è¿›è¡Œè®¡ç®—äº§ç”Ÿï¼Œè€Œä¸èƒ½ç”±å„ä¸ªèŠ‚ç‚¹è‡ªè¡Œé€‰æ‹©</p><p>å¹¶ä¸” SEND åè®®é€šè¿‡æ—¶é—´æˆ³å’Œ Nonce é€‰é¡¹æŠµå¾¡é‡æ”¾æ”»å‡»ï¼Œå¹¶å¼•å…¥äº† CGAï¼ˆå¯†ç ç”Ÿæˆåœ°å€ï¼‰ä¸ RSA ç­¾åå¯¹æ•°æ®æºè¿›è¡ŒéªŒè¯ä»¥è§£å†³é‚»å±…è¯·æ±‚/é‚»å±…é€šå‘Šæ¬ºéª—çš„é—®é¢˜</p><p>å±€é™ï¼šSEND è™½ç„¶å¯ä»¥è§£å†³ä¸€å®šçš„å®‰å…¨é—®é¢˜ï¼Œä½†ç›®å‰ç³»ç»Ÿä¸è®¾å¤‡å¯¹ SEND çš„æ”¯æŒååˆ†æœ‰é™</p><h3 id="ra-guard"><a class="markdownIt-Anchor" href="#ra-guard"></a> RA-Guard</h3><p>RA-Guardï¼Œä¸€ç§å®‰å…¨ RAï¼ˆè·¯ç”±å™¨é€šå‘Šï¼‰ æ–¹æ¡ˆï¼Œå…¶é€šè¿‡é˜»æ–­éä¿¡ä»»ç«¯å£ RA æŠ¥æ–‡è½¬å‘æ¥é¿å…æ¶æ„ RA å¯èƒ½å¸¦æ¥çš„å¨èƒï¼Œåœ¨æ”»å‡»åŒ…å®é™…åˆ°è¾¾ç›®æ ‡èŠ‚ç‚¹ä¹‹å‰é˜»å¡äºŒå±‚è®¾å¤‡ä¸Šçš„æ”»å‡»æ•°æ®åŒ…ï¼›</p><p>ä½¿ç”¨è®¿é—®æ§åˆ¶åˆ—è¡¨æˆ–ç©ºè·¯ç”±è¿‡æ»¤å¯¹åœ°å€ç©ºé—´ä¸­æœªåˆ†é…çš„éƒ¨åˆ†çš„è®¿é—®é™åˆ¶ï¼Œç”¨ä»¥é˜²æ­¢æ”»å‡»è€…è¿«ä½¿è·¯ç”±è§£ææœªä½¿ç”¨çš„åœ°å€</p><h2 id="å®‰å…¨ç¡¬ä»¶é—®é¢˜"><a class="markdownIt-Anchor" href="#å®‰å…¨ç¡¬ä»¶é—®é¢˜"></a> å®‰å…¨ç¡¬ä»¶é—®é¢˜</h2><h3 id="é˜²ç«å¢™"><a class="markdownIt-Anchor" href="#é˜²ç«å¢™"></a> é˜²ç«å¢™</h3><p>1ã€é˜²ç«å¢™å¿…é¡»å¯¹ IPv6 åŸºæœ¬æŠ¥å¤´ä¸æ‰€æœ‰çš„æ‰©å±•é¦–éƒ¨è¿›è¡Œè§£æï¼Œæ‰èƒ½è·å–ä¼ è¾“å±‚ä¸åº”ç”¨å±‚çš„ä¿¡æ¯ï¼Œä»è€Œç¡®å®šå½“å‰æ•°æ®æŠ¥æ˜¯å¦åº”è¯¥è¢«å…è®¸é€šè¿‡æˆ–æ˜¯è¢«ä¸¢å¼ƒã€‚åœ¨ä¸€å®šç¨‹åº¦ä¸Šå°†åŠ å‰§é˜²ç«å¢™çš„è´Ÿæ‹…ï¼Œå½±å“é˜²ç«å¢™çš„æ€§èƒ½ã€‚</p><p>2ã€å¦‚è‹¥åœ¨ IPv6 æ•°æ®åŒ…ä¸­å¯ç”¨åŠ å¯†é€‰é¡¹ï¼Œè´Ÿè½½æ•°æ®å°†è¿›è¡ŒåŠ å¯†å¤„ç†ï¼Œç”±äºåŒ…è¿‡æ»¤å‹é˜²ç«å¢™æ— æ³•å¯¹è´Ÿè½½æ•°æ®è¿›è¡Œè§£å¯†ï¼Œæ— æ³•è·å– TCP ä¸ UDP ç«¯å£å·ï¼Œå› æ­¤åŒ…è¿‡æ»¤å‹é˜²ç«å¢™æ— æ³•åˆ¤æ–­æ˜¯å¦å¯ä»¥å°†å½“å‰æ•°æ®åŒ…æ”¾è¡Œã€‚</p><h3 id="ids-ips"><a class="markdownIt-Anchor" href="#ids-ips"></a> IDS / IPS</h3><p>é¢å¯¹IPv6æ•°æ®åŒ…ï¼Œå€˜è‹¥å¯ç”¨äº†åŠ å¯†é€‰é¡¹ï¼ŒIDSï¼ˆå…¥ä¾µæ£€æµ‹ç³»ç»Ÿï¼‰ ä¸ IPSï¼ˆå…¥ä¾µé˜²å¾¡ç³»ç»Ÿï¼‰ åˆ™æ— æ³•å¯¹åŠ å¯†æ•°æ®è¿›è¡Œæå–ä¸åˆ†æï¼Œæ— æ³•é€šè¿‡æŠ¥æ–‡åˆ†æè·å– TCPã€UDP ä¿¡æ¯ï¼Œè¿›è€Œæ— æ³•å¯¹ç½‘ç»œå±‚è¿›è¡Œå…¨é¢çš„å®‰å…¨é˜²æŠ¤ã€‚å³ä¾¿åªå…è®¸æµé‡å¯ç”¨ AH è®¤è¯æŠ¥å¤´ï¼Œä½†è®¤è¯æŠ¥å¤´å†…éƒ¨å…·æœ‰å¯å˜é•¿åº¦å­—æ®µICVï¼Œå› æ­¤æ£€æµ‹å¼•æ“å¹¶ä¸èƒ½å‡†ç¡®åœ°å®šä½å¼€å§‹å†…å®¹æ£€æŸ¥çš„ä½ç½®ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Protocol Security </category>
          
      </categories>
      
      
        <tags>
            
            <tag> security </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>IPv4 Protocol and Security</title>
      <link href="/Coming-blog/2021/12/05/ipv4-protocol-and-security/"/>
      <url>/Coming-blog/2021/12/05/ipv4-protocol-and-security/</url>
      
        <content type="html"><![CDATA[<h1 id="ip-åè®®"><a class="markdownIt-Anchor" href="#ip-åè®®"></a> IP åè®®</h1><p>æ¥åˆ°äº†ç½‘ç»œå±‚åè®®å®‰å…¨ï¼Œç®€å•ä»‹ç»ä¸‹ IP åè®®çš„åŠŸèƒ½ï¼šåœ¨äº’è”ç½‘ç»œé—´è¿›è¡Œå¯»å€å’Œåˆ†ç»„è½¬å‘ï¼›å¯¹è®¾å¤‡è¿›è¡Œé€»è¾‘ç¼–å€ï¼›æä¾›ä¸å¯é å’Œæ— è¿æ¥çš„æ•°æ®åŒ…ä¼ é€æœåŠ¡ï¼›</p><p>å¹¶ç½—åˆ—ä¸€äº›åè¯ï¼š</p><p>1ã€æœ€å¤§ä¼ è¾“å•å…ƒ  MTUï¼šç”±å„ä¸ªç‰©ç†ç½‘ç»œä¸­çš„ç¡¬ä»¶å†³å®šï¼Œå¯¹æ•°æ®å¸§é•¿åº¦çš„é™åˆ¶ï¼›å¦‚æœ IP å±‚æ•°æ®æŠ¥æ¯”é“¾è·¯å±‚ MTU å¤§ï¼Œé‚£ä¹ˆ IP å±‚å°±éœ€è¦è´Ÿè´£å¯¹è¯¥æ•°æ®æŠ¥è¿›è¡Œåˆ†ç‰‡ï¼Œä½¿å¾—æ¯ä¸€ç‰‡éƒ½å°äº MTUTipsï¼šå„ä¸ªç‰©ç†ç½‘ç»œçš„æœ€å¤§ä¼ è¾“å•å…ƒ MTU å¯èƒ½ä¸åŒï¼ŒAï¼ŒB ä¸¤ä¸ªè·¯ç”±å™¨ä¹‹é—´ä¸ Bï¼ŒC ä¸¤ä¸ªè·¯ç”±å™¨ä¹‹é—´çš„ MTU å¯èƒ½ä¸ä¸€è‡´</p><h2 id="ip-åœ°å€"><a class="markdownIt-Anchor" href="#ip-åœ°å€"></a> IP åœ°å€</h2><p>ç»™è¿æ¥åˆ°å› ç‰¹ç½‘ä¸Šçš„æ¯ä¸€å°ä¸»æœºåˆ†é…ä¸€ä¸ªå…¨ä¸–ç•ŒèŒƒå›´å†…æƒŸä¸€çš„ 32 ä½çš„æ ‡è¯†ç¬¦ï¼ŒåŒ…å«äº†ä¸¤ä¸ªç‹¬ç«‹çš„ä¿¡æ¯æ®µï¼šç½‘ç»œå·ï¼ˆnet-idï¼‰+ ä¸»æœºå·ï¼ˆhost-idï¼‰ï¼Œå¸¸ç”¨ç‚¹åˆ†åè¿›åˆ¶è®°æ³•è¡¨ç¤º</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/20211205164142.png" alt="IP åœ°å€åˆ†ç±»" /></p><p>A ç±»ï¼š1 - 126</p><p>B ç±»ï¼š128 - 191</p><p>C ç±»ï¼š192 - 233</p><p>D ç±»ï¼š224 - 239</p><p>E ç±»ï¼š240 - 255</p><h3 id="ä¸“ç”¨åœ°å€"><a class="markdownIt-Anchor" href="#ä¸“ç”¨åœ°å€"></a> ä¸“ç”¨åœ°å€</h3><p>ä¹Ÿç§°ç§æœ‰åœ°å€ï¼Œprivate addressï¼Œç”±æœ¬æœºæ„è‡ªè¡Œåˆ†é…å…¶ IP åœ°å€ï¼Œåªåœ¨æœ¬æœºæ„å†…éƒ¨æœ‰æ•ˆï¼Œä¸ä¼šè¢«è·¯ç”±å™¨è½¬å‘åˆ°å…¬ç½‘ä¸­ï¼›ä¸éœ€è¦å‘å› ç‰¹ç½‘çš„ç®¡ç†æœºæ„ç”³è¯·ï¼ŒèŠ‚çœå…¨çƒ IP åœ°å€èµ„æº</p><p>ä¸“ç”¨åœ°å€ä¹Ÿæœ‰èŒƒå›´ï¼šABC ä¸‰ç±»åœ°å€ä¸­å„é¢„ç•™äº†ä¸€äº›åœ°å€ä¸“é—¨ç”¨äºä¸Šè¿°æƒ…å†µï¼Œè¿™æ ·å°±å¯ä»¥åŒºåˆ†ä¸“æœ‰ä¸å…¬ç½‘åœ°å€ï¼Œä¹Ÿæ–¹ä¾¿ NATï¼Œå› æ­¤å‡¡æ˜¯ Internet ä¸Šçš„ç½‘ç»œè®¾å¤‡å‡ä¸ä¼šæ¥æ”¶ï¼Œå‘é€æˆ–è€…è½¬å‘æº IP åœ°å€æˆ–ç›®çš„ IP åœ°å€åœ¨ä¸Šè¿°èŒƒå›´å†…çš„æŠ¥æ–‡ï¼Œè¿™äº› IP åœ°å€åªèƒ½ç”¨äºç§æœ‰ç½‘ç»œ</p><blockquote><p>ä¸åŠ ä»¥åŒºåˆ†çš„è¯ï¼Œæˆ‘ç§æœ‰åœ°å€çš„è®¾ç½®å¯èƒ½å’Œå…¬ç½‘åœ°å€åœ¨åŒä¸€ç½‘æ®µï¼Œé‚£æ ·å°±æ˜¯åœ¨å±€åŸŸç½‘é€šä¿¡ï¼ŒNAT ä¹Ÿå¸®ä¸äº†ä½ </p></blockquote><p>A ç±»åœ°å€èŒƒå›´ï¼š10.0.0.0 - 10.255.255.255</p><p>B ç±»åœ°å€èŒƒå›´ï¼š172.16.0.0 - 172.31.255.255</p><p>C ç±»åœ°å€èŒƒå›´ï¼š192.168.0.0 - 192.168.255.255</p><h3 id="å…¬ç½‘åœ°å€"><a class="markdownIt-Anchor" href="#å…¬ç½‘åœ°å€"></a> å…¬ç½‘åœ°å€</h3><p>åˆç§°åˆæ³•åœ°å€ï¼Œå¯ä»¥åœ¨å› ç‰¹ç½‘ä¸Šä½¿ç”¨ Aã€Bã€C ç±»åœ°å€</p><h2 id="åˆ’åˆ†å­ç½‘"><a class="markdownIt-Anchor" href="#åˆ’åˆ†å­ç½‘"></a> åˆ’åˆ†å­ç½‘</h2><p>å­ç½‘éƒ½åœ¨åŒä¸€ä¸ªç½‘æ®µï¼Œå…¶å­ç½‘æ©ç ä¸€è‡´</p><p>å­ç½‘æ©ç ï¼šé•¿åº¦ 32 ä½çš„äºŒè¿›åˆ¶æ•°å­—ï¼Œç”¨äºè¡¨ç¤ºç½‘ç»œå·ä¸ä¸»æœºå·çš„ä½æ•°</p><p>ç½‘ç»œåœ°å€ï¼šIP åœ°å€å’Œå­ç½‘æ©ç è¿›è¡Œä¸è¿ç®—ï¼Œå°†è¿ç®—ç»“æœä¸­çš„ç½‘ç»œåœ°å€ä¸å˜ï¼Œä¸»æœºåœ°å€å˜ä¸º 0</p><p>æ–¹å¼ï¼šä»ç½‘ç»œçš„ä¸»æœºå·å€Ÿç”¨è‹¥å¹²æ¯”ç‰¹ä½œä¸ºå­ç½‘å· subnet-id</p><p>è¿‡ç¨‹ï¼šæ­¤è·¯ç”±å™¨æ”¶åˆ° IP æ•°æ®æŠ¥åï¼Œå†æŒ‰ç›®çš„ç½‘ç»œå· net-id å’Œå­ç½‘å· subnet-id æ‰¾åˆ°ç›®çš„å­ç½‘ï¼Œå°† IP æ•°æ®æŠ¥äº¤ä»˜ç»™ç›®çš„ä¸»æœº</p><h2 id="å¹¿æ’­åœ°å€"><a class="markdownIt-Anchor" href="#å¹¿æ’­åœ°å€"></a> å¹¿æ’­åœ°å€</h2><h3 id="å—é™å¹¿æ’­åœ°å€"><a class="markdownIt-Anchor" href="#å—é™å¹¿æ’­åœ°å€"></a> å—é™å¹¿æ’­åœ°å€</h3><p>255.255.255.255ï¼ŒIP åœ°å€çš„ç½‘ç»œå­—æ®µå’Œä¸»æœºå­—æ®µå…¨ä¸º 1</p><blockquote><p>è·¯ç”±å™¨éƒ½ä¸è½¬å‘ç›®çš„åœ°å€ä¸ºå—é™çš„å¹¿æ’­åœ°å€çš„æ•°æ®æŠ¥ï¼Œè¿™æ ·çš„æ•°æ®æŠ¥ä»…å‡ºç°åœ¨æœ¬åœ°ç½‘ç»œä¸­</p><p>åº”ç”¨ï¼šæœ¬æœºä¸çŸ¥é“æ‰€å¤„çš„ç½‘ç»œæ—¶ æˆ– ç½‘ç»œæ©ç  æˆ– æœåŠ¡å™¨ IPï¼Œå°±ä¼šä½¿ç”¨å—é™å¹¿æ’­åœ°å€å‘ DHCP æœåŠ¡å™¨æ‰€è¦åœ°å€</p></blockquote><h3 id="ç›´æ¥å¹¿æ’­åœ°å€"><a class="markdownIt-Anchor" href="#ç›´æ¥å¹¿æ’­åœ°å€"></a> ç›´æ¥å¹¿æ’­åœ°å€</h3><p>åŒ…å«ä¸€ä¸ªæœ‰æ•ˆçš„ç½‘ç»œå·å’Œä¸€ä¸ªå…¨ 1 çš„ä¸»æœºå·</p><blockquote><p>åº”ç”¨ï¼šç”¨äºæœ¬åœ°ç½‘ç»œï¼Œä¹Ÿå¯ä»¥è·¨ç½‘æ®µå¹¿æ’­ï¼ˆè·¯ç”±å™¨è¦å¼€å¯å®šå‘å¹¿æ’­åŠŸèƒ½ï¼‰æ¯”å¦‚ä¸»æœº 192.168.1.1/30 å¯ä»¥å‘é€å¹¿æ’­åŒ…åˆ° 192.168.1.7ï¼Œä½¿ä¸»æœº 192.168.1.5/30ä¹Ÿå¯ä»¥æ¥æ”¶åˆ°è¯¥æ•°æ®åŒ…</p></blockquote><h1 id="ip-æ•°æ®æŠ¥"><a class="markdownIt-Anchor" href="#ip-æ•°æ®æŠ¥"></a> IP æ•°æ®æŠ¥</h1><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/20211205162718.png" alt="IP æ•°æ®æŠ¥æ ¼å¼" /></p><h2 id="ip-æ•°æ®æŠ¥é€‰é¡¹"><a class="markdownIt-Anchor" href="#ip-æ•°æ®æŠ¥é€‰é¡¹"></a> IP æ•°æ®æŠ¥é€‰é¡¹</h2><p>è¯¥é€‰é¡¹ä¸ºå˜é•¿éƒ¨åˆ†ï¼Œç”¨äºç½‘ç»œæ§åˆ¶å’Œæµ‹è¯•ç›®çš„ï¼ˆå¦‚æºè·¯ç”±ã€è®°å½•è·¯ç”±ã€æ—¶é—´æˆ³ç­‰ï¼‰ï¼Œæœ€å¤§é•¿åº¦ä¸èƒ½è¶…è¿‡ 40 å­—èŠ‚</p><blockquote><p>IP é€‰é¡¹åœ¨ä½¿ç”¨æ—¶æ˜¯å¯é€‰çš„ï¼Œä½†åœ¨ TCP/IP è½¯ä»¶çš„å®ç°ä¸­å´æ˜¯å¿…é¡»æœ‰çš„ï¼Œä¹Ÿå°±æ˜¯è¯´æ‰€æœ‰çš„IP åè®®éƒ½å…·æœ‰ IP é€‰é¡¹çš„å¤„ç†åŠŸèƒ½</p></blockquote><p>é€‰é¡¹æ ¼å¼å¦‚ä¸‹ï¼š</p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20211127123337344.png" alt="image-20211127123337344" style="zoom:50%;" /><h2 id="æºè·¯ç”±é€‰é¡¹"><a class="markdownIt-Anchor" href="#æºè·¯ç”±é€‰é¡¹"></a> æºè·¯ç”±é€‰é¡¹</h2><p>é€šå¸¸ IP æ•°æ®æŠ¥åœ¨ä¼ è¾“æ—¶ï¼Œç”±è·¯ç”±å™¨è‡ªåŠ¨ä¸ºå…¶é€‰æ‹©è·¯ç”±ã€‚ä¸ºäº†ä½¿æ•°æ®æŠ¥ç»•å¼€å‡ºé”™ç½‘ç»œï¼Œæˆ–è€…ä¸ºäº†å¯¹æŸç‰¹å®šç½‘ç»œçš„ååç‡è¿›è¡Œæµ‹è¯•ï¼Œéœ€è¦åœ¨ä¿¡æºæœºæ§åˆ¶ IP æ•°æ®æŠ¥çš„ä¼ è¾“è·¯å¾„</p><h3 id="ä¸¥æ ¼æºè·¯ç”±"><a class="markdownIt-Anchor" href="#ä¸¥æ ¼æºè·¯ç”±"></a> ä¸¥æ ¼æºè·¯ç”±</h3><p>è¦æ±‚ä¿¡æºæœºä¸Šçš„å‘é€è€…æŒ‡å®šæ•°æ®æŠ¥å¿…é¡»ç»è¿‡æ¯ä¸€ä¸ªè·¯ç”±å™¨</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20211127124111380.png" alt="image-20211127124111380" /></p><p>1ã€ä¿¡æºæœºä»ä¸Šå±‚æ”¶åˆ°æºè·¯ç”± IP åœ°å€è¡¨åï¼Œå°†ç¬¬ä¸€ä¸ª IP åœ°å€ä»åˆ—è¡¨ä¸­å»æ‰ï¼Œå¹¶ä½œä¸ºå½“å‰æ•°æ®æŠ¥çš„ç›®çš„åœ°å€</p><p>2ã€å°†å‰©ä½™çš„è¡¨é¡¹å‰ç§»ï¼ˆé€»è¾‘å‰ç§»ï¼Œå·²ç»ç»è¿‡çš„åœ°å€è¿˜ä¼šåœ¨è¡¨ä¸­ï¼‰</p><p>3ã€å°†æœ€ç»ˆè¦å»çš„ç›®çš„åœ°å€å†™å…¥åˆ°é€‰é¡¹åœ°å€è¡¨çš„æœ€åï¼ˆæœ€åä¸€æ­¥çœŸå®çš„ç›®çš„ IP å°†è¢«å–å‡ºï¼Œè·¯ç”±è¡¨é¡¹ä¸­å…¨éƒ¨ä¸ºä¸­é—´æŒ‡å®šçš„è·¯ç”±ï¼‰</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20211127124347061.png" alt="image-20211127124347061" /></p><h3 id="å®½æ¾æºè·¯ç”±"><a class="markdownIt-Anchor" href="#å®½æ¾æºè·¯ç”±"></a> å®½æ¾æºè·¯ç”±</h3><p>è¦æ±‚ä¿¡æºæœºä¸Šçš„å‘é€è€…æŒ‡å®šæ•°æ®æŠ¥å¿…é¡»ç»è¿‡æŒ‡å®šçš„è·¯ç”±ï¼ŒæŒ‡å®šçš„è·¯ç”±åªæ˜¯ä¸€äº›å…³é”®è·¯ç”±ï¼Œå¯èƒ½å¹¶ä¸ä¸´æ¥ï¼Œä¸¤ä¸ªè·¯ç”±ä¹‹é—´çš„é€šé“ç”±è·¯ç”±å™¨è‡ªåŠ¨è·¯ç”±å†³å®š</p><p>Tipsï¼šå…¶ IP é€‰é¡¹çš„æ ¼å¼ä¸ä¸¥æ ¼æºè·¯ç”±ç›¸åŒ</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20211127124111380.png" alt="image-20211127124111380" /></p><h2 id="æ— è¿æ¥æ•°æ®æŠ¥ä¼ è¾“"><a class="markdownIt-Anchor" href="#æ— è¿æ¥æ•°æ®æŠ¥ä¼ è¾“"></a> æ— è¿æ¥æ•°æ®æŠ¥ä¼ è¾“</h2><p>IP æ•°æ®æŠ¥ä¼ è¾“æ˜¯ IP å±‚è¦è§£å†³çš„é‡è¦é—®é¢˜ä¹‹ä¸€ï¼Œæ˜¯å½±å“æ•°æ®ä¼ è¾“æ•ˆç‡çš„ä¸€ä¸ªé‡è¦å› ç´ ï¼ŒIP æ•°æ®æŠ¥åœ¨ç»è¿‡è·¯ç”±å™¨è¿›è¡Œè½¬å‘æ—¶ä¸€èˆ¬è¦è¿›è¡Œä¸‰ä¸ªæ–¹é¢çš„å¤„ç†ï¼šé¦–éƒ¨æ ¡éªŒï¼Œè·¯ç”±é€‰æ‹©ï¼Œæ•°æ®åˆ†ç‰‡ã€‚</p><h3 id="é¦–éƒ¨æ ¡éªŒ"><a class="markdownIt-Anchor" href="#é¦–éƒ¨æ ¡éªŒ"></a> é¦–éƒ¨æ ¡éªŒ</h3><p>IP æ•°æ®æŠ¥çš„é¦–éƒ¨é€šè¿‡æ ¡éªŒå’Œï¼ˆChecksumï¼‰æ¥ä¿è¯å…¶æ­£ç¡®æ€§</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/20211205162443.png" alt="é¦–éƒ¨æ ¡éªŒ" /></p><p><strong>ä¸ºä»€ä¹ˆè¦è¿›è¡Œé¦–éƒ¨æ ¡éªŒï¼š</strong></p><p>1ã€IP é¦–éƒ¨å±äº IP å±‚åè®®çš„å†…å®¹ï¼Œä¸å¯èƒ½ç”±ä¸Šå±‚åè®®å¤„ç†</p><p>2ã€IP é¦–éƒ¨ä¸­çš„éƒ¨åˆ†å­—æ®µåœ¨ç‚¹åˆ°ç‚¹çš„ä¼ é€’è¿‡ç¨‹ä¸­æ˜¯ä¸æ–­å˜åŒ–çš„ï¼Œåªèƒ½åœ¨æ¯ä¸ªä¸­é—´ç‚¹é‡æ–°å½¢æˆæ ¡éªŒæ•°æ®ï¼Œåœ¨ç›¸é‚»ç‚¹ä¹‹é—´å®Œæˆæ ¡éªŒ</p><p><strong>ä¸ºä»€ä¹ˆ IP å±‚ä¸å¯¹æ•°æ®è¿›è¡Œæ ¡éªŒï¼š</strong></p><p>1ã€æ•ˆç‡æ–¹é¢ï¼šä¸Šå±‚ä¼ è¾“å±‚æ˜¯ç«¯åˆ°ç«¯çš„åè®®ï¼Œè¿›è¡Œç«¯åˆ°ç«¯çš„æ ¡éªŒæ¯”è¿›è¡Œç‚¹åˆ°ç‚¹çš„æ ¡éªŒå¼€é”€å°å¾—å¤šï¼Œåœ¨é€šä¿¡çº¿è·¯è¾ƒå¥½çš„æƒ…å†µä¸‹å°¤å…¶å¦‚æ­¤</p><p>2ã€çµæ´»æ€§ï¼šä¸Šå±‚åè®®å¯ä»¥æ ¹æ®å¯¹äºæ•°æ®å¯é æ€§çš„è¦æ±‚ï¼Œé€‰æ‹©è¿›è¡Œæ ¡éªŒæˆ–ä¸è¿›è¡Œæ ¡éªŒï¼Œç”šè‡³å¯ä»¥è€ƒè™‘é‡‡ç”¨ä¸åŒçš„æ ¡éªŒæ–¹æ³•ï¼Œè¿™ç»™ç³»ç»Ÿå¸¦æ¥å¾ˆå¤§çš„çµæ´»æ€§</p><h3 id="æ•°æ®åˆ†ç‰‡ä¸é‡ç»„"><a class="markdownIt-Anchor" href="#æ•°æ®åˆ†ç‰‡ä¸é‡ç»„"></a> æ•°æ®åˆ†ç‰‡ä¸é‡ç»„</h3><p>å› ä¸ºå„ä¸ªç‰©ç†ç½‘ç»œçš„æœ€å¤§ä¼ è¾“å•å…ƒ MTU å¯èƒ½ä¸åŒï¼Œæ‰€ä»¥ IPv4 ä¸­è§„å®šå°†æ•°æ®æŠ¥å…ˆä»¥ä¿¡æºç½‘ç»œçš„ MTU è¿›è¡Œå°è£…ï¼Œåœ¨ä¼ è¾“è¿‡ç¨‹ä¸­å†æ ¹æ®éœ€è¦å¯¹æ•°æ®æŠ¥è¿›è¡ŒåŠ¨æ€åˆ†ç‰‡</p><p>ä½†æ˜¯ IPv6 ä¸­å†³å®šå°†æ•°æ®æŠ¥ä»¥ä»ä¿¡æºåˆ°ä¿¡å®¿è·¯å¾„ä¸Šçš„æœ€å° MTU è¿›è¡Œå°è£…</p><h1 id="ipv4-å®‰å…¨æœºåˆ¶"><a class="markdownIt-Anchor" href="#ipv4-å®‰å…¨æœºåˆ¶"></a> IPv4 å®‰å…¨æœºåˆ¶</h1><h2 id="acl"><a class="markdownIt-Anchor" href="#acl"></a> ACL</h2><p>ACL ï¼šAccess Control Listï¼Œè®¿é—®æ§åˆ¶åˆ—è¡¨ï¼Œåº”ç”¨åœ¨<strong>è·¯ç”±å™¨æ¥å£</strong>ä¸Šçš„æŒ‡ä»¤åˆ—è¡¨ï¼›å‘ŠçŸ¥è·¯ç”±å™¨å“ªäº›æ•°æ®æŠ¥åˆ†ç»„å¯ä»¥æ¥æ”¶ï¼Œå“ªäº›æ‹’ç»</p><p>Applicationï¼šè·¯ç”±å™¨ä¸Šè¿›è¡Œé…ç½®ï¼›é˜²ç«å¢™çš„ç›¸å…³é…ç½®ä¹ŸåŸºäº ACL æŒ‡ä»¤ï¼›ä¸€ä¸ªè®¿é—®æ§åˆ¶åˆ—è¡¨å¯ä»¥è¢«åº”ç”¨åˆ°å¤šä¸ªæ¥å£ä¸Šï¼Œæ¥å£åˆåˆ†è¿›å…¥æ–¹å‘ä¸å‡ºå»æ–¹å‘ï¼›ä¸€ä¸ªæ¥å£çš„ in å’Œ out æ¯ä¸ªæ–¹å‘å„åªèƒ½åº”ç”¨ä¸€ä¸ªè®¿é—®æ§åˆ¶åˆ—è¡¨ã€‚</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20211127141040398.png" alt="image-20211127141040398" /></p><h3 id="æ ‡å‡†è®¿é—®æ§åˆ¶åˆ—è¡¨"><a class="markdownIt-Anchor" href="#æ ‡å‡†è®¿é—®æ§åˆ¶åˆ—è¡¨"></a> æ ‡å‡†è®¿é—®æ§åˆ¶åˆ—è¡¨</h3><p>æ ‡å‡†è®¿é—®æ§åˆ¶åˆ—è¡¨ï¼šåŸºäº<strong>æºåœ°å€</strong>ä½œä¸ºåˆ¤æ–­ä¾æ®ï¼Œç¼–å·ä¸ºï¼š1-99, 1300-1999</p><blockquote><p>è·¯ç”±å™¨å¯¹æ¯ä¸€ä¸ªæ•°æ®åŒ…éƒ½æŒ‰ç…§åˆ—è¡¨é¡ºåºé€æ¡æ£€æŸ¥ï¼Œå¦‚æœåŒ¹é…æŸä¸€æ¡è¯­å¥ï¼Œè¦ä¹ˆå…è®¸æ•°æ®åŒ…é€šè¿‡ï¼Œè¦ä¹ˆæ‹’ç»é€šè¿‡ï¼Œä¸å†æ£€æŸ¥åé¢çš„è¯­å¥ï¼›å¦åˆ™å‘ä¸‹ç»§ç»­åŒ¹é…ï¼›å¦‚æœæ‰€æœ‰çš„è¯­å¥éƒ½ä¸åŒ¹é…ï¼Œå°±æ‹’ç»æ•°æ®åŒ…é€šè¿‡ï¼ˆç¼ºçœç­–ç•¥ï¼‰ã€‚</p></blockquote><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20211007140314775.png" alt="image-20211007140314775" /></p><h3 id="æ‰©å±•è®¿é—®æ§åˆ¶åˆ—è¡¨"><a class="markdownIt-Anchor" href="#æ‰©å±•è®¿é—®æ§åˆ¶åˆ—è¡¨"></a> æ‰©å±•è®¿é—®æ§åˆ¶åˆ—è¡¨</h3><p>æ‰©å±•è®¿é—®æ§åˆ¶åˆ—è¡¨ï¼šåŸºäº <strong>æºåœ°å€ã€ç›®æ ‡åœ°å€ã€æºç«¯å£ã€ç›®æ ‡ç«¯å£ã€åè®®ç±»å‹</strong>ï¼Œæ›´ä¸ºçµæ´»ï¼Œç¼–å·ä¸º 100-199, 2000-2699</p><p>Applicationï¼šåŒ…è¿‡æ»¤é˜²ç«å¢™ï¼›</p><h2 id="nat"><a class="markdownIt-Anchor" href="#nat"></a> NAT</h2><p>Backdropï¼šåˆæ³•çš„ IP åœ°å€æ—¥ç›ŠçŸ­ç¼ºï¼šä¸€ä¸ªå±€åŸŸç½‘å†…éƒ¨æœ‰å¾ˆå¤šå°ä¸»æœºï¼Œä½†ä¸æ˜¯æ¯å°ä¸»æœºéƒ½æœ‰åˆæ³•çš„ IP åœ°å€ï¼Œä¸ºäº†ä½¿æ‰€æœ‰å†…éƒ¨ä¸»æœºéƒ½å¯ä»¥è¿æ¥å› ç‰¹ç½‘ï¼Œéœ€è¦ä½¿ç”¨åœ°å€è½¬æ¢ï¼ˆå°†ç§æœ‰åœ°å€è½¬ä¸ºå…¬æœ‰åœ°å€ï¼‰</p><p>Principleï¼šæ”¹å˜ IP åŒ…å¤´ï¼Œä½¿ç›®çš„åœ°å€ã€æºåœ°å€æˆ–ä¸¤ä¸ªåœ°å€åœ¨åŒ…å¤´ä¸­è¢«å…¬æœ‰åœ°å€æ›¿æ¢</p><p>Strengthï¼šèŠ‚çœå…¬æœ‰åˆæ³• IP åœ°å€ï¼›å¤„ç†åœ°å€äº¤å‰ï¼›å¢å¼ºçµæ´»æ€§ä¸å®‰å…¨æ€§ï¼›</p><p>Weaknessï¼šå»¶è¿Ÿå¢å¤§ï¼›é…ç½®å’Œç»´æŠ¤çš„å¤æ‚æ€§ï¼›ä¸æ”¯æŒæŸäº›åº”ç”¨</p><h3 id="åœ°å€è½¬æ¢æŠ€æœ¯"><a class="markdownIt-Anchor" href="#åœ°å€è½¬æ¢æŠ€æœ¯"></a> åœ°å€è½¬æ¢æŠ€æœ¯</h3><p>å¯ä»¥æœ‰æ•ˆåœ°éšè—å†…éƒ¨å±€åŸŸç½‘ä¸­çš„ä¸»æœºï¼Œå…·æœ‰ä¸€å®šçš„ç½‘ç»œå®‰å…¨ä¿æŠ¤ä½œç”¨ï¼ˆåŒ…åœ¨äº’è”ç½‘ä¸­æ˜¯è¯¥å­ç½‘çš„å…¬æœ‰åœ°å€å¹¶éå­ç½‘å†…çš„ç§æœ‰åœ°å€ï¼‰</p><p>å¯ä»¥åœ¨å±€åŸŸç½‘å†…éƒ¨æä¾›ç»™å¤–éƒ¨FTPã€WWWã€TelnetæœåŠ¡</p><h3 id="é™æ€-nat-é…ç½®"><a class="markdownIt-Anchor" href="#é™æ€-nat-é…ç½®"></a> é™æ€ NAT é…ç½®</h3><p>å®ç°å†…éƒ¨ IP åœ°å€ä¸ å¤–éƒ¨ IP åœ°å€çš„æ˜ å°„</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/20211205185404.png" alt="é™æ€ NAT é…ç½®" /></p><h3 id="ç«¯å£åœ°å€è½¬æ¢"><a class="markdownIt-Anchor" href="#ç«¯å£åœ°å€è½¬æ¢"></a> ç«¯å£åœ°å€è½¬æ¢</h3><p>Port Address Translationï¼ŒPATï¼Œè¯¥æŠ€æœ¯å‡ºç°ä¹‹å‰ä½¿ç”¨å¤šä¸ªå…¬ç½‘åœ°å€å•å°„å¤šä¸ªç§ç½‘åœ°å€ï¼Œå› æ­¤ä¸ºäº†è§£å†³å…¬ç½‘åœ°å€çŸ­ç¼ºé—®é¢˜ï¼Œå¼•å…¥ç«¯å£åœ°å€è½¬æ¢å®ç°ç§æœ‰åœ°å€å‘å…¬æœ‰åœ°å€çš„ n:1 çš„æ˜ å°„</p><p>Qï¼šå¤–é¢å›æ¥çš„åŒ…éƒ½æ˜¯ä¸€ä¸ªå…¬ç½‘ IP æˆ‘å’‹çŸ¥é“å‘ç»™ç§ç½‘ä¸­çš„è°å‘¢ï¼Ÿ</p><p>Aï¼šä½¿ç”¨ç«¯å£åœ°å€è½¬æ¢æŠ€æœ¯ï¼Œåˆ©ç”¨ä¸åŒçš„ç«¯å£åŒºåˆ†ç§ç½‘å†…å„ä¸ªæœºå™¨</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20211127142039263.png" alt="image-20211127142039263" /></p><h2 id="vpn"><a class="markdownIt-Anchor" href="#vpn"></a> VPN</h2><p>è™šæ‹Ÿä¸“ç”¨ç½‘ç»œï¼Œæ˜¯ä¼ä¸šç½‘åœ¨å› ç‰¹ç½‘ä¸Šçš„å»¶ä¼¸</p><p>éš§é“ï¼šå°è£…ä¸€ä¸ªéš§é“æŠ¥å¤´ï¼ˆä¸‰å±‚ï¼‰ï¼Œç›´æ¥å‘é€åˆ°ç›®æ ‡ç½‘ç»œæ‰€åœ¨çš„ç½‘å…³</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20211007142318338.png" alt="image-20211007142318338" /></p><h3 id="vpn-åŠŸèƒ½"><a class="markdownIt-Anchor" href="#vpn-åŠŸèƒ½"></a> VPN åŠŸèƒ½</h3><p>1ã€æ•°æ®æœºå¯†æ€§ä¿æŠ¤ï¼šä¼ è¾“æ—¶è¿›è¡ŒåŠ å¯†ä¼ è¾“</p><p>2ã€æ•°æ®å®Œæ•´æ€§ä¿æŠ¤ï¼šå¯¹æ•°æ®è¿›è¡Œ hash å¾—åˆ°æ‘˜è¦ï¼Œå°†æ‘˜è¦ä¸åŠ å¯†åçš„æ•°æ®ä¸€èµ·ä¼ è¾“ï¼›æ¥æ”¶æ–¹è§£å¯†æ•°æ®åå†æ¬¡è®¡ç®—æ‘˜è¦ï¼Œä¸ä¼ è¾“æ¥çš„æ‘˜è¦è¿›è¡Œæ¯”è¾ƒï¼ŒéªŒè¯æ•°æ®çš„å®Œæ•´æ€§</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/20211205185841.png" alt="æ•°æ®å®Œæ•´æ€§ä¿æŠ¤" /></p><p>3ã€æ•°æ®æºèº«ä»½è®¤è¯ï¼šä½¿ç”¨ç§é’¥å¯¹æ‘˜è¦è¿›è¡ŒåŠ å¯†å¾—åˆ°æ•°å­—ç­¾åï¼Œå°†æ‘˜è¦ä¸åŠ å¯†åçš„æ•°æ®ä¸€èµ·ä¼ è¾“ï¼›æ¥æ”¶æ–¹è§£å¯†æ•°æ®åå†æ¬¡è®¡ç®—æ‘˜è¦ï¼Œå°†ä¼ è¾“æ¥çš„æ•°å­—ç­¾åè§£å¯†å¾—åˆ°æºæ‘˜è¦ï¼Œå°†ä¸¤ä¸ªæ‘˜è¦è¿›è¡Œæ¯”å¯¹å®ç°èº«ä»½éªŒè¯</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/20211205185935.png" alt="æ•°æ®æºèº«ä»½è®¤è¯" /></p><p>4ã€é‡æ”¾æ”»å‡»ä¿æŠ¤ï¼šåŠ æ—¶é—´æˆ³ï¼›åŠ éšæœºæ•°ï¼›åŠ æµæ°´å· / åºåˆ—å·ï¼›</p><blockquote><p>Replay Attacksï¼Œé‡æ’­æ”»å‡»ï¼Œå›æ”¾æ”»å‡»ï¼ŒæŒ‡æ”»å‡»è€…å‘é€ä¸€ä¸ªç›®çš„ä¸»æœºå·²æ¥æ”¶è¿‡çš„åŒ…ï¼Œæ¥è¾¾åˆ°æ¬ºéª—ç³»ç»Ÿçš„ç›®çš„ï¼›æ¯”å¦‚èº«ä»½è®¤è¯é‡æ”¾ï¼Œè½¬è´¦é‡æ”¾ã€‚</p></blockquote><h2 id="vpnè¿æ¥æ¨¡å¼"><a class="markdownIt-Anchor" href="#vpnè¿æ¥æ¨¡å¼"></a> VPNè¿æ¥æ¨¡å¼</h2><h3 id="ä¼ è¾“æ¨¡å¼"><a class="markdownIt-Anchor" href="#ä¼ è¾“æ¨¡å¼"></a> ä¼ è¾“æ¨¡å¼</h3><p>å®ç°ç«¯åˆ°ç«¯çš„ä¿æŠ¤ï¼Œæ²¡æœ‰å°è£… IP åŒ…å¤´ï¼Œä¹Ÿæ²¡æœ‰æ·»åŠ æ–°çš„ IP åŒ…å¤´</p><p>ä¼˜ç‚¹ï¼šæ•ˆç‡é«˜</p><p>åŠ£åŠ¿ï¼šä¸èƒ½ç›´æ¥åœ¨å…¬ç½‘ä¸Šä¼ è¾“ï¼›å®‰å…¨æ€§ä½</p><p>Applicationï¼šç»“åˆå…¶ä»– VPN ä¸€èµ·ä½¿ç”¨æˆ–åœ¨ä¼ä¸šå†…ç½‘éƒ¨ç½²</p><h3 id="éš§é“æ¨¡å¼"><a class="markdownIt-Anchor" href="#éš§é“æ¨¡å¼"></a> éš§é“æ¨¡å¼</h3><p>å®ç°ç«™ç‚¹åˆ°ç«™ç‚¹çš„ä¿æŠ¤ï¼Œå¯¹æ•´ä¸ªåŒ…å¤´è¿›è¡Œäº†å°è£…ï¼ŒåŒæ—¶æ·»åŠ æ–°çš„ IP åŒ…å¤´</p><p>ä¼˜ç‚¹ï¼šå¯ä»¥ç›´æ¥åœ¨å…¬ç½‘ä¸Šä¼ è¾“ï¼Œå®‰å…¨æ€§è¾ƒé«˜</p><p>åŠ£åŠ¿ï¼šä¼ è¾“æ•ˆç‡ä½</p><h2 id="vpn-ç±»å‹"><a class="markdownIt-Anchor" href="#vpn-ç±»å‹"></a> VPN ç±»å‹</h2><p>ç«™ç‚¹åˆ°ç«™ç‚¹ VPNï¼šç«™ç‚¹æ˜¯å›ºå®šçš„</p><p>è¿œç¨‹è®¿é—® VPNï¼šIP åœ°å€æ˜¯ä¸ä¸€æ ·çš„</p>]]></content>
      
      
      <categories>
          
          <category> Protocol Security </category>
          
      </categories>
      
      
        <tags>
            
            <tag> security </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ICMP Protocol and Security</title>
      <link href="/Coming-blog/2021/12/05/icmp-protocol-and-security/"/>
      <url>/Coming-blog/2021/12/05/icmp-protocol-and-security/</url>
      
        <content type="html"><![CDATA[<h1 id="icmp"><a class="markdownIt-Anchor" href="#icmp"></a> ICMP</h1><p>Internet Control Message Protocolï¼ŒInternet æ§åˆ¶æŠ¥æ–‡åè®®ï¼Œç”¨äºåœ¨IPä¸»æœºã€è·¯ç”±å™¨ä¹‹é—´ä¼ é€’æ§åˆ¶æ¶ˆæ¯</p><blockquote><p>æ§åˆ¶æ¶ˆæ¯æ˜¯æŒ‡ç½‘ç»œé€šä¸é€šã€ä¸»æœºæ˜¯å¦å¯è¾¾ã€è·¯ç”±æ˜¯å¦å¯ç”¨ç­‰ç½‘ç»œæœ¬èº«çš„æ¶ˆæ¯</p></blockquote><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20211127135407400.png" alt="image-20211127135407400" /></p><h2 id="æŠ¥æ–‡ç§ç±»"><a class="markdownIt-Anchor" href="#æŠ¥æ–‡ç§ç±»"></a> æŠ¥æ–‡ç§ç±»</h2><p>æ”»å‡»ä¹Ÿæ˜¯ä»æ­£å¸¸çš„æ‰€æä¾›çš„åŠŸèƒ½å‡ºå‘ï¼š</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20211007133301183.png" alt="image-20211007133301183" /></p><h1 id="icmp-æ”»å‡»"><a class="markdownIt-Anchor" href="#icmp-æ”»å‡»"></a> ICMP æ”»å‡»</h1><h2 id="ping-of-death"><a class="markdownIt-Anchor" href="#ping-of-death"></a> Ping of death</h2><p>åˆå æ­»äº¡ä¹‹ ping</p><p>Backdropï¼šå½“ä¸€ä¸ª IP åŒ…çš„é•¿åº¦è¶…è¿‡ä»¥å¤ªç½‘å¸§çš„æœ€å¤§å°ºå¯¸æ—¶ï¼ŒåŒ…å°±ä¼šè¢«åˆ†ç‰‡ï¼Œä½œä¸ºå¤šä¸ªå¸§æ¥å‘é€ã€‚æ¥æ”¶ç«¯çš„æœºå™¨æå–å„ä¸ªåˆ†ç‰‡ï¼Œå¹¶é‡ç»„ä¸ºä¸€ä¸ªå®Œæ•´çš„ IP åŒ…ï¼›</p><p>Attack Point ï¼šIP åè®®è§„èŒƒè§„å®šäº†ä¸€ä¸ª IP åŒ…çš„æœ€å¤§å°ºå¯¸ï¼ˆ65535ï¼‰è€Œå¤§å¤šæ•°çš„åŒ…å¤„ç†ç¨‹åºåˆ<strong>å‡è®¾</strong>åŒ…çš„é•¿åº¦ä¸ä¼šè¶…è¿‡è¿™ä¸ªæœ€å¤§å°ºå¯¸ã€‚å› æ­¤ï¼ŒåŒ…é‡ç»„ä»£ç æ‰€åˆ†é…çš„å†…å­˜åŒºåŸŸä¹Ÿä¸ä¼šè¶…è¿‡è¿™ä¸ªå°ºå¯¸</p><h3 id="æ”»å‡»æ–¹å¼"><a class="markdownIt-Anchor" href="#æ”»å‡»æ–¹å¼"></a> æ”»å‡»æ–¹å¼</h3><p>Attackï¼šç¼“å­˜æº¢å‡ºï¼ˆBuffer Overflowï¼‰æ”»å‡»ï¼›æ„é€ è¶…è¿‡è¿™ä¸ªæœ€å¤§å°ºå¯¸çš„åŒ…ï¼ŒåŒ…å½“ä¸­çš„é¢å¤–æ•°æ®å°±ä¼šè¢«å†™å…¥å…¶ä»–æ­£å¸¸åŒºåŸŸï¼Œä½¿å¾—ç³»ç»Ÿè¿›å…¥éç¨³å®šçŠ¶æ€</p><blockquote><p>åœ¨é˜²ç«å¢™ä¸€çº§å¯¹è¿™ç§æ”»å‡»è¿›è¡Œæ£€æµ‹æ˜¯ç›¸å½“éš¾çš„ï¼Œå› ä¸ºæ¯ä¸ªåˆ†ç‰‡åŒ…çœ‹èµ·æ¥éƒ½å¾ˆæ­£å¸¸ï¼Œåœ¨å†…éƒ¨é‡ç»„åå´å‡ºäº‹äº†</p></blockquote><h3 id="demo"><a class="markdownIt-Anchor" href="#demo"></a> Demo</h3><p>ping æŒ‡ä»¤å°†å‘é€ä¸€ä¸ª ICMP å›å£°è¯·æ±‚æ¶ˆæ¯ç»™ç›®çš„åœ°å¹¶æŠ¥å‘Šæ˜¯å¦æ”¶åˆ°æ‰€å¸Œæœ›çš„ ICMP echoï¼Œç”¨äºæ£€æŸ¥ç½‘ç»œæ˜¯å¦é€šç•…æˆ–è€…ç½‘ç»œè¿æ¥é€Ÿåº¦çš„å‘½ä»¤</p><blockquote><p>Tips ï¼šping åªæ˜¯åˆ©ç”¨è¿™ä¸ªæ¼æ´çš„å·¥å…·ä¹‹ä¸€</p></blockquote><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">ping -l 65500 192.168.1.1 -t# æœ€ç»ˆçš„å¤§å°è¿˜æœ‰åŠ ä¸Š ICMP(8) ä¸ IP(20-60)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="é˜²å¾¡"><a class="markdownIt-Anchor" href="#é˜²å¾¡"></a> é˜²å¾¡</h3><p>å¯¹æ“ä½œç³»ç»Ÿæ‰“è¡¥ä¸ï¼Œä½¿å†…æ ¸å°†ä¸å†å¯¹è¶…è¿‡è§„å®šé•¿åº¦çš„åŒ…è¿›è¡Œé‡ç»„</p><h2 id="icmp-smurf-æ”»å‡»"><a class="markdownIt-Anchor" href="#icmp-smurf-æ”»å‡»"></a> ICMP Smurf æ”»å‡»</h2><p>åˆååå°„æ”¾å¤§æ”»å‡»ï¼Œåˆ©ç”¨ IP æ¬ºéª—å’Œ ICMP å›åº”åŒ…å¼•èµ·ç›®æ ‡ä¸»æœºç½‘ç»œé˜»å¡ï¼Œå®ç° DoS æ”»å‡»</p><h3 id="æ”»å‡»åŸç†"><a class="markdownIt-Anchor" href="#æ”»å‡»åŸç†"></a> æ”»å‡»åŸç†</h3><p>åœ¨æ„é€ æ•°æ®åŒ…æ—¶å°†æºåœ°å€è®¾ç½®ä¸ºè¢«æ”»å‡»ä¸»æœºçš„åœ°å€ï¼Œè€Œå°†ç›®çš„åœ°å€è®¾ç½®ä¸ºå¹¿æ’­åœ°å€ï¼Œäºæ˜¯å¤§é‡ ICMP echo çš„å›åº”åŒ… ICMP reply è¢«å‘é€ç»™è¢«æ”»å‡»ä¸»æœºï¼Œä½¿å…¶å› ç½‘ç»œé˜»å¡è€Œæ— æ³•æä¾›æœåŠ¡</p><h3 id="é˜²å¾¡-2"><a class="markdownIt-Anchor" href="#é˜²å¾¡-2"></a> é˜²å¾¡</h3><p>é˜²ç«å¢™æºåœ°å€æ£€æŸ¥è¿‡æ»¤</p><h2 id="icmp-redirect-æ”»å‡»"><a class="markdownIt-Anchor" href="#icmp-redirect-æ”»å‡»"></a> ICMP Redirect æ”»å‡»</h2><p>Backdropï¼šå½“è·¯ç”±å™¨æ£€æµ‹åˆ°ä¸»æœºåœ¨å¯åŠ¨æ—¶å…·æœ‰ä¸€å®šçš„è·¯ç”±ä¿¡æ¯ï¼ˆä½†ä¸ä¸€å®šæ˜¯æœ€ä¼˜çš„ï¼‰å¹¶æ£€æµ‹åˆ° IP æ•°æ®æŠ¥ç»éæœ€ä¼˜è·¯ç”±ä¼ è¾“ï¼Œå°±é€šè¿‡ <strong>ICMP é‡å®šå‘æŠ¥æ–‡</strong>é€šçŸ¥ä¸»æœºå»å¾€è¯¥ç›®çš„åœ°çš„æœ€ä¼˜è·¯å¾„ï¼›å…¶ç›®çš„æ—¨åœ¨ä¿è¯ä¸»æœºæ‹¥æœ‰åŠ¨æ€çš„ã€æ—¢å°ä¸”ä¼˜çš„è·¯ç”±è¡¨ï¼›</p><h3 id="æ”»å‡»åŸç†-2"><a class="markdownIt-Anchor" href="#æ”»å‡»åŸç†-2"></a> æ”»å‡»åŸç†</h3><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20211006104322321.png" alt="image-20211006104322321" /></p><p>Attackï¼šæ”»å‡»è€…é€šè¿‡å‘é€ ICMP é‡å®šå‘æŠ¥æ–‡å¯ä»¥åœ¨å—å®³è€…ä¸»æœºè·¯ç”±è¡¨ä¸­æ·»åŠ ä¸€æ¡åˆ°è¾¾ç‰¹å®šä¸»æœºçš„è·¯ç”±ä¿¡æ¯ï¼Œä½¿å¾—å—å®³è€…å‘å¾€ç‰¹å®šä¸»æœºçš„æ•°æ®åŒ…è¢«å‘å¾€æ”»å‡»è€…ä¸»æœºï¼Œæ”»å‡»è€…è¿›è€Œå®æ–½ç›‘å¬ã€æ¬ºéª—ç­‰æ”»å‡»è¡Œä¸ºï¼›</p><p>æ ¸å¿ƒï¼šæ¬ºéª—è·¯ç”±è¡¨ã€‚é€šè¿‡æ·»åŠ ç‰¹å®šè·¯ç”±è¡¨å®æ–½</p><h3 id="é™åˆ¶"><a class="markdownIt-Anchor" href="#é™åˆ¶"></a> é™åˆ¶</h3><p>1ã€ICMP é‡å®šå‘æœºåˆ¶åªèƒ½åœ¨åŒä¸€ç½‘ç»œçš„è·¯ç”±å™¨ä¸ä¸»æœºä¹‹é—´ä½¿ç”¨ï¼›</p><p>2ã€ICMP é‡å®šå‘æ”»å‡»ä¸€æ¬¡åªèƒ½æŒ‡å®šä¸€ä¸ªç›®çš„åœ°å€ï¼›</p><p>3ã€æŒ‡å®šçš„åœ°å€è·¯ç”±ä¸Šå¿…é¡»æ˜¯ç›´è¾¾çš„ï¼›</p><p>4ã€é‡å®šå‘åŒ…å¿…é¡»æ¥è‡ªå»å¾€ç›®æ ‡çš„å½“å‰è·¯ç”±ï¼›</p><p>5ã€é‡å®šå‘åŒ…ä¸èƒ½é€šçŸ¥ä¸»æœºç”¨è‡ªå·±åšè·¯ç”±ï¼ˆéœ€è¦åˆè°‹è€…ï¼‰ï¼›</p><p>6ã€å—å®³è€…å’Œæ”»å‡»è€…è¦å¤„äºåŒä¸€ç½‘ç»œç¯å¢ƒä¸­ï¼›</p><h3 id="é˜²å¾¡-3"><a class="markdownIt-Anchor" href="#é˜²å¾¡-3"></a> é˜²å¾¡</h3><p>ä¿®æ”¹ç³»ç»Ÿå’Œé˜²ç«å¢™é…ç½®ï¼Œæ‹’ç»æ¥æ”¶ ICMP é‡å®šå‘æŠ¥æ–‡</p>]]></content>
      
      
      <categories>
          
          <category> Protocol Security </category>
          
      </categories>
      
      
        <tags>
            
            <tag> security </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>VLAN and VLAN Security</title>
      <link href="/Coming-blog/2021/12/05/vlan-and-vlan-security/"/>
      <url>/Coming-blog/2021/12/05/vlan-and-vlan-security/</url>
      
        <content type="html"><![CDATA[<h1 id="vlan"><a class="markdownIt-Anchor" href="#vlan"></a> VLAN</h1><p>VLAN å³è™šæ‹Ÿå±€åŸŸç½‘ï¼Œé€šè¿‡ç«¯å£ä¸ VLAN çš„ç»‘å®šï¼ˆæˆ–å…¶ä»–æ–¹å¼ï¼‰ï¼Œåœ¨é€»è¾‘ä¸Šåˆ’åˆ†å±€åŸŸç½‘</p><blockquote><p>åˆ’åˆ†åARP ç­‰è¯·æ±‚å¹¿æ’­åŒ…å°†åœ¨åŒä¸€ VLAN ä¸‹è¿›è¡Œä¼ æ’­</p></blockquote><h2 id="vlan-çš„äº§ç”ŸåŸå› "><a class="markdownIt-Anchor" href="#vlan-çš„äº§ç”ŸåŸå› "></a> VLAN çš„äº§ç”ŸåŸå› </h2><p>Backdropï¼šå±€åŸŸç½‘è¿‡å¤§æ—¶ï¼Œå¹¿æ’­åŸŸè¿‡å¤§ï¼Œå¯¼è‡´ ARP è¿™ç§å¹¿æ’­è¯·æ±‚åŒ…éœ€è¦éå†æ•´ä¸ªå¹¿æ’­åŸŸï¼Œè¿™ä¸€ç°è±¡è¢«ç§°ä¸º<strong>å¹¿æ’­é£æš´</strong></p><blockquote><p>å› æ­¤éœ€è¦åˆ†å‰²å¹¿æ’­åŸŸ</p></blockquote><p>è§£å†³æ–¹æ³•ï¼šä½¿ç”¨è·¯ç”±å™¨å°†ç½‘ç»œåˆ†æ®µï¼›VLAN æŠ€æœ¯</p><blockquote><p>å¹¿æ’­é‡åˆ°ä¸‰å±‚è®¾å¤‡å°±ä¼šæˆªæ­¢</p></blockquote><h2 id="vlan-çš„ä¼˜åŠ¿"><a class="markdownIt-Anchor" href="#vlan-çš„ä¼˜åŠ¿"></a> VLAN çš„ä¼˜åŠ¿</h2><p>ä¸ä¼ ç»Ÿ LANï¼ˆå±€åŸŸç½‘ï¼‰ç›¸æ¯”</p><p>1ã€éš”ç¦»å¹¿æ’­åŸŸï¼ŒæŠ‘åˆ¶å¹¿æ’­æŠ¥æ–‡</p><p>2ã€å‡å°‘ç§»åŠ¨å’Œæ”¹å˜çš„ä»£ä»·</p><p>3ã€åˆ›å»ºè™šæ‹Ÿå·¥ä½œç»„ï¼Œè¶…è¶Šä¼ ç»Ÿç½‘ç»œçš„å·¥ä½œæ–¹å¼</p><p>4ã€å¢å¼ºé€šè®¯çš„å®‰å…¨æ€§</p><p>5ã€å¢å¼ºç½‘ç»œçš„å¥å£®æ€§ï¼ˆç¼©å°äº†å¹¿æ’­åŸŸï¼Œç¼©å°äº†æ”»å‡»èŒƒå›´ï¼‰</p><h2 id="vlan-å®ç°æ–¹å¼"><a class="markdownIt-Anchor" href="#vlan-å®ç°æ–¹å¼"></a> VLAN å®ç°æ–¹å¼</h2><p>åŸºäºç«¯å£çš„ VLANï¼›åŸºäº MAC çš„ VLANï¼›åŸºäºåè®®çš„ VLANï¼›åŸºäºå­ç½‘çš„ VLAN</p><h3 id="åŸºäºç«¯å£çš„-vlan"><a class="markdownIt-Anchor" href="#åŸºäºç«¯å£çš„-vlan"></a> åŸºäºç«¯å£çš„ VLAN</h3><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/20211205150331.png" alt="åŸºäºç«¯å£çš„ VLAN" /></p><p>éœ€è¦é…ç½® VLAN è¡¨ï¼šç«¯å£ä¸æ‰€å± VLAN æ˜ å°„è¡¨</p><p>ä¼˜åŠ¿ï¼šæ“ä½œç®€å•</p><p>åŠ£åŠ¿ï¼šä¸ç«¯å£ç»‘å®šï¼Œå¹¶æœªä¸ä¸»æœºç»‘å®šï¼Œä¸»æœºè¿ç§»åå®¹æ˜“å‘ç”Ÿé”™è¯¯</p><h3 id="åŸºäº-mac-çš„-vlan"><a class="markdownIt-Anchor" href="#åŸºäº-mac-çš„-vlan"></a> åŸºäº MAC çš„ VLAN</h3><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/20211205150415.png" alt="åŸºäº MAC çš„ VLAN" /></p><p>éœ€è¦é…ç½® VLAN è¡¨ï¼šMAC ä¸æ‰€å± VLAN æ˜ å°„è¡¨</p><p>ä¼˜åŠ¿ï¼šå½“ç”¨æˆ·ç‰©ç†ä½ç½®ç§»åŠ¨æ—¶ï¼Œå³ä»ä¸€ä¸ªäº¤æ¢æœºæ¢åˆ°å…¶ä»–çš„äº¤æ¢æœºæ—¶ï¼ŒVLANä¸ç”¨é‡æ–°é…ç½®ï¼Œæ•…è®¤ä¸ºè¿™ç§æ ¹æ® MAC åœ°å€çš„åˆ’åˆ†æ–¹æ³•æ˜¯åŸºäºç”¨æˆ·çš„ VLAN</p><p>åŠ£åŠ¿ï¼šåˆå§‹åŒ–æ—¶ï¼Œæ‰€æœ‰çš„ç”¨æˆ·éƒ½å¿…é¡»è¿›è¡Œé…ç½®ï¼Œå¦‚æœç”¨æˆ·å¾ˆå¤šï¼Œé…ç½®çš„å·¥ä½œé‡æ˜¯å¾ˆå¤§çš„ï¼›å¹¶ä¸”åŒä¸€ç«¯å£ä¸‹å¯èƒ½å­˜åœ¨å±äºä¸åŒ VLAN çš„å¤šä¸ªä¸»æœºï¼Œåˆ™è¯¥ç«¯å£ä¸èƒ½éš”ç¦»å¹¿æ’­åŒ…äº†</p><h3 id="åŸºäºåè®®çš„-vlan"><a class="markdownIt-Anchor" href="#åŸºäºåè®®çš„-vlan"></a> åŸºäºåè®®çš„ VLAN</h3><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/20211205150603.png" alt="åŸºäºåè®®çš„ VLAN" /></p><p>éœ€è¦é…ç½® VLAN è¡¨ï¼šåè®®ç±»å‹ä¸ VLAN çš„æ˜ å°„è¡¨ï¼ˆä¸å¸¸è§ï¼‰</p><p>æ ¹æ®äºŒå±‚æ•°æ®å¸§ä¸­çš„åè®®å­—æ®µè¿›è¡Œ VLAN çš„åˆ’åˆ†</p><h3 id="åŸºäºå­ç½‘çš„-vlan"><a class="markdownIt-Anchor" href="#åŸºäºå­ç½‘çš„-vlan"></a> åŸºäºå­ç½‘çš„ VLAN</h3><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/20211205150634.png" alt="åŸºäºå­ç½‘çš„ VLAN" /></p><p>éœ€è¦é…ç½® VLAN è¡¨ï¼šIP ç½‘ç»œä¸ VLAN çš„æ˜ å°„è¡¨</p><p>ä¼˜åŠ¿ï¼šç”¨æˆ·å¯ä»¥åœ¨ç½‘ç»œå†…éƒ¨è‡ªç”±ç§»åŠ¨è€Œä¸ç”¨é‡æ–°é…ç½®è‡ªå·±çš„å·¥ä½œç«™</p><p>åŠ£åŠ¿ï¼šæ•ˆç‡ä½ï¼Œæ£€æŸ¥æ¯ä¸€ä¸ªæ•°æ®åŒ…çš„ç½‘ç»œå±‚åœ°å€æ˜¯å¾ˆè´¹æ—¶çš„ï¼Œå¹¶ä¸”åŒä¸€ä¸ªç«¯å£ä¸‹å¯èƒ½å­˜åœ¨å¤šä¸ªVLAN çš„æˆå‘˜ï¼Œæ— æ³•éš”ç¦»å¹¿æ’­åŒ…</p><h2 id="vlan-çš„å¯è·¨è¶Šæ€§"><a class="markdownIt-Anchor" href="#vlan-çš„å¯è·¨è¶Šæ€§"></a> VLAN çš„å¯è·¨è¶Šæ€§</h2><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20210923160359426.png" alt="image-20210923160359426" /></p><p>1ã€VLAN æ•°æ®å¯ä»¥è·¨è¶Šå¤šå°äº¤æ¢æœºè¢«è½¬é€’</p><p>2ã€ä¸åŒ VLAN çš„ä¿¡æ¯å¿…é¡»é€šè¿‡ä¸‰å±‚è·¯ç”±å¤„ç†æ‰èƒ½è½¬å‘åˆ°è¿™ä¸ªç«¯å£ä¸Š</p><p>3ã€äºŒå±‚çš„å¹¿æ’­åªèƒ½åœ¨ä¸€ä¸ª VLAN ä¸‹è¿›è¡Œ</p><h2 id="äºŒå±‚äº¤æ¢æœºä¸ä¸‰å±‚äº¤æ¢æœº"><a class="markdownIt-Anchor" href="#äºŒå±‚äº¤æ¢æœºä¸ä¸‰å±‚äº¤æ¢æœº"></a> äºŒå±‚äº¤æ¢æœºä¸ä¸‰å±‚äº¤æ¢æœº</h2><p>äºŒå±‚äº¤æ¢æŠ€æœ¯å¯¹äºç½‘ç»œå±‚æˆ–è€…é«˜å±‚åè®®æ¥è¯´æ˜¯é€æ˜çš„</p><p>ä¼˜åŠ¿ï¼šæ•°æ®äº¤æ¢æ˜¯é ç¡¬ä»¶æ¥å®ç°çš„ï¼Œå…¶é€Ÿåº¦ç›¸å½“å¿«</p><blockquote><p>å®ƒä¸å¤„ç†ç½‘ç»œå±‚çš„IPåœ°å€ï¼Œä¸å¤„ç†é«˜å±‚åè®®çš„è¯¸å¦‚TCPã€UDPçš„ç«¯å£åœ°å€ï¼Œå®ƒåªéœ€è¦æ•°æ®åŒ…çš„ç‰©ç†åœ°å€å³MACåœ°å€</p></blockquote><p>åŠ£åŠ¿ï¼šå®ƒä¸èƒ½å¤„ç†ä¸åŒ IP å­ç½‘ï¼ˆåŒ…æ‹¬VLANï¼‰ä¹‹é—´çš„æ•°æ®äº¤æ¢</p><blockquote><p>è¯†åˆ«ä¸äº† IP åè®®ç­‰</p></blockquote><h3 id="è·¯ç”±å™¨çš„ä¼˜ç¼ºç‚¹"><a class="markdownIt-Anchor" href="#è·¯ç”±å™¨çš„ä¼˜ç¼ºç‚¹"></a> è·¯ç”±å™¨çš„ä¼˜ç¼ºç‚¹</h3><p>ä¼˜åŠ¿ï¼šé€‰æ‹©æœ€ä½³è·¯ç”±ã€è´Ÿè·åˆ†æ‹…ã€é“¾è·¯å¤‡ä»½åŠå’Œå…¶ä»–ç½‘ç»œè¿›è¡Œè·¯ç”±ä¿¡æ¯çš„äº¤æ¢ç­‰</p><p>åŠ£åŠ¿ï¼šè½¬å‘æ•ˆç‡è¾ƒä½ï¼ˆå¤„ç†å¤§é‡çš„è·¨è¶Š IP å­ç½‘çš„æ•°æ®åŒ…ï¼‰</p><p><strong>å› æ­¤è¦æƒ³åˆ©ç”¨äºŒå±‚äº¤æ¢ç‡é«˜è¿™ä¸€ä¼˜ç‚¹ï¼Œåˆè¦å¤„ç†ä¸‰å±‚IPæ•°æ®åŒ…çš„è½¬å‘ï¼Œä¸‰å±‚äº¤æ¢æŠ€æœ¯å°±è¯ç”Ÿäº†</strong></p><h3 id="ä¸‰å±‚äº¤æ¢æœºçš„ä¼˜ç‚¹"><a class="markdownIt-Anchor" href="#ä¸‰å±‚äº¤æ¢æœºçš„ä¼˜ç‚¹"></a> ä¸‰å±‚äº¤æ¢æœºçš„ä¼˜ç‚¹</h3><p>åœ¨ç½‘ç»œæ¨¡å‹ä¸­çš„ç¬¬ä¸‰å±‚å®ç°äº†æ•°æ®åŒ…çš„é«˜é€Ÿè½¬å‘ï¼Œå¯ä»¥ç†è§£ä¸ºï¼šäºŒå±‚äº¤æ¢æŠ€æœ¯ + ä¸‰å±‚è½¬å‘æŠ€æœ¯çš„ç»“åˆ = ä¸‰å±‚äº¤æ¢æœº</p><blockquote><p>æœ¬è´¨æ˜¯äºŒå±‚äº¤æ¢æœºçš„å‡çº§æ‰©å……</p></blockquote><p>ä¼˜åŠ¿ï¼šä¸€æ¬¡è·¯ç”±ï¼Œå¤šæ¬¡è½¬å‘ï¼›å¯¹äºæ•°æ®åŒ…è½¬å‘ç­‰è§„å¾‹æ€§çš„è¿‡ç¨‹ç”±ç¡¬ä»¶é«˜é€Ÿå®ç°ï¼Œè€Œåƒè·¯ç”±ä¿¡æ¯æ›´æ–°ã€è·¯ç”±è¡¨ç»´æŠ¤ã€è·¯ç”±è®¡ç®—ã€è·¯ç”±ç¡®å®šç­‰åŠŸèƒ½ï¼Œç”±è½¯ä»¶å®ç°</p><blockquote><p>ä¸‰å±‚äº¤æ¢æŠ€æœ¯çš„å‡ºç°ï¼Œè§£å†³äº†å±€åŸŸç½‘ä¸­ç½‘æ®µåˆ’åˆ†ä¹‹åï¼Œç½‘æ®µä¸­å­ç½‘å¿…é¡»ä¾èµ–è·¯ç”±å™¨è¿›è¡Œç®¡ç†çš„å±€é¢ï¼Œè§£å†³äº†ä¼ ç»Ÿè·¯ç”±å™¨ä½é€Ÿã€å¤æ‚æ‰€é€ æˆçš„ç½‘ç»œç“¶é¢ˆé—®é¢˜ã€‚</p></blockquote><h3 id="å·¥ä½œåŸç†"><a class="markdownIt-Anchor" href="#å·¥ä½œåŸç†"></a> å·¥ä½œåŸç†</h3><p>1ã€æ”¶åˆ°ä¸€ä¸ªæ•°æ®åŒ…ï¼ŒæŸ¥çœ‹åŒ…çš„ç›®çš„ MAC æ˜¯è‡ªå·±ï¼Œä½†æ˜¯ IP ä¸æ˜¯è‡ªå·±</p><p>2ã€æŸ¥æ‰¾ç¡¬ä»¶è½¬å‘è¡¨</p><p>3ã€å¦‚æœæ²¡æŸ¥åˆ°è¡¨é¡¹ï¼Œäº¤ç”±è·¯ç”±è¿›ç¨‹å¤„ç†ï¼ˆä¸€æ—¦äº¤ç”±cpuå¤„ç†ï¼Œå¿…ç„¶ä¼šæ¶ˆè€—cpuèµ„æºï¼‰</p><p>4ã€è·¯ç”±è¿›ç¨‹å°†æŒ‰ç…§ IP å±‚é‚£ä¸€å¥—ï¼ŒæŸ¥çœ‹è·¯ç”±è¡¨ï¼ŒæŸ¥æ‰¾ä¸‹ä¸€è·³çš„ IP åœ°å€ï¼Œåœ¨é€šè¿‡ ARP æ‰¾å‡ºæ­¤åœ°å€å¯¹åº”çš„ MAC åœ°å€</p><p>5ã€è½¬å‘å‰ä¸‰å±‚äº¤æ¢æœºä¿®æ”¹ IP åŒ…å¤´çš„ ttl å€¼ + ä¿®æ”¹åŸ mac åœ°å€æ”¹ä¸ºè‡ªå·±å‡ºå£ mac åœ°å€ + å»ºç«‹äº¤æ¢æœºç¡¬ä»¶è½¬å‘è¡¨ï¼ŒåŒ…æ‹¬ç›®çš„IPåœ°å€ï¼Œç›®çš„IPåœ°å€ï¼ˆä¸‹ä¸€è·³ï¼‰å¯¹åº”çš„macåœ°å€ï¼Œmacåœ°å€å¯¹åº”çš„vlanï¼Œä»¥åŠå¯¹åº”çš„ç«¯å£</p><blockquote><p>è¿™æ ·å½“ä¸€ä¸‹åŒ…è¿‡æ¥çš„æ—¶å€™ï¼Œäº¤æ¢æœºå°±ä¼š æŸ¥çœ‹ç¡¬ä»¶è½¬å‘è¡¨ç›´æ¥è½¬å‘è€Œä¸ä¼šå†ç»è¿‡è·¯ç”±è¡¨çš„æŸ¥è¯¢äº†ï¼Œä¹Ÿå³æ˜¯äº¤æ¢æœºçš„<strong>ä¸€æ¬¡è·¯ç”±ï¼Œå¤šæ¬¡äº¤æ¢</strong>çš„åŸç†</p></blockquote><h2 id="vlan-çš„é“¾è·¯ç±»å‹ä¸ç«¯å£ç±»å‹"><a class="markdownIt-Anchor" href="#vlan-çš„é“¾è·¯ç±»å‹ä¸ç«¯å£ç±»å‹"></a> VLAN çš„é“¾è·¯ç±»å‹ä¸ç«¯å£ç±»å‹</h2><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20210930133649605.png" alt="image-20210930133649605" /></p><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œäº¤æ¢æœºæ‰€æœ‰ç«¯å£éƒ½æ˜¯Access-Linkç«¯å£ï¼Œå¹¶å±äºVLAN-1</p><h3 id="æ¥å…¥é“¾è·¯"><a class="markdownIt-Anchor" href="#æ¥å…¥é“¾è·¯"></a> æ¥å…¥é“¾è·¯</h3><p>Access linkï¼Œäº¤æ¢æœºä¸ä¸»æœºä¹‹é—´ï¼Œé€šå¸¸åªæ¶‰åŠä¸€ä¸ª VLAN</p><blockquote><p>è¿™ä¸ªç«¯å£ä¸èƒ½ç›´æ¥æ¥æ”¶å…¶å®ƒ VLAN çš„ä¿¡æ¯ï¼Œä¹Ÿä¸èƒ½ç›´æ¥å‘å…¶å®ƒ VLAN å‘é€ä¿¡æ¯ã€‚ä¸åŒVLAN çš„ä¿¡æ¯å¿…é¡»é€šè¿‡ä¸‰å±‚è·¯ç”±å¤„ç†æ‰èƒ½è½¬å‘åˆ°è¿™ä¸ªç«¯å£ä¸Šã€‚</p><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œäº¤æ¢æœºæ‰€æœ‰ç«¯å£éƒ½æ˜¯Access-Linkç«¯å£ï¼Œå¹¶å±äºVLAN-1</p></blockquote><h3 id="å¹²é“é“¾è·¯"><a class="markdownIt-Anchor" href="#å¹²é“é“¾è·¯"></a> å¹²é“é“¾è·¯</h3><p>Trunk linkï¼Œäº¤æ¢æœºä¹‹é—´ / äº¤æ¢æœºè·¯ç”±å™¨ä¹‹é—´ï¼Œå¯ä»¥æ‰¿è½½å¤šä¸ª VLANï¼Œå› æ­¤æ•°æ®å¸§åœ¨å¹²é“é“¾è·¯ä¸Šä¼ è¾“æ—¶ï¼Œäº¤æ¢æœºå¿…é¡»è¦è¯†åˆ«æ•°æ®å¸§æ˜¯å±äºå“ªä¸ª VLAN çš„ä»¥è½¬å…¥æ­£ç¡®çš„ Access Link</p><blockquote><p>è´Ÿè´£ä¼ è¾“å¤šä¸ªVLANçš„æ•°æ®ï¼ŒTrunk-Linkç«¯å£é»˜è®¤ä¸º1</p></blockquote><h3 id="ç«¯å£ç±»å‹"><a class="markdownIt-Anchor" href="#ç«¯å£ç±»å‹"></a> ç«¯å£ç±»å‹</h3><p>Access ç«¯å£ï¼šç”¨äºæ¥ç”¨æˆ·è®¡ç®—æœºçš„ç«¯å£ï¼Œåªèƒ½å±äºä¸€ä¸ª VLAN</p><p>Trunk ç«¯å£ï¼šç”¨äºäº¤æ¢æœºä¹‹é—´è¿æ¥çš„ç«¯å£ï¼Œå¯ä»¥å±äºå¤šä¸ª VLAN</p><p>Hybrid ç«¯å£ï¼šäº¤æ¢æœºä¹‹é—´æˆ–ç”¨äºäº¤æ¢æœºä¸ç”¨æˆ·çš„è®¡ç®—æœºï¼Œå¯ä»¥å±äºå¤šä¸ª VLANï¼Œ</p><blockquote><p>hybrid ç«¯å£å¯ä»¥å…è®¸å¤šä¸ª VLAN çš„æŠ¥æ–‡ä¸æ‰“æ ‡ç­¾ï¼Œè€Œ trunk ç«¯å£åªå…è®¸ç¼ºçœ VLAN çš„æŠ¥æ–‡ä¸æ‰“æ ‡ç­¾</p><p>åŒä¸€ä¸ªäº¤æ¢æœºä¸Š hybrid ç«¯å£å’Œ trunk ç«¯å£ä¸èƒ½å¹¶å­˜</p></blockquote><h3 id="ç«¯å£çš„ç¼ºçœ-id"><a class="markdownIt-Anchor" href="#ç«¯å£çš„ç¼ºçœ-id"></a> ç«¯å£çš„ç¼ºçœ ID</h3><p>Access ç«¯å£åªå±äºä¸€ä¸ª VLANï¼Œå› æ­¤å…¶ç¼ºçœ ID å°±æ˜¯å®ƒæ‰€åœ¨çš„ VLAN</p><p>Trunk ç«¯å£å±äºå¤šä¸ª VLANï¼Œæ‰€ä»¥éœ€è¦è®¾ç½®ç¼ºçœ VLAN IDï¼Œé»˜è®¤ä¸º VLAN 1</p><blockquote><p>å¦‚æœæŠ¥æ–‡çš„ VLAN ID ä¸ ç«¯å£çš„ç¼ºçœ ID ç›¸åŒï¼Œåˆ™ç³»ç»Ÿå°†å»æ‰æŠ¥æ–‡çš„ VLAN Tagï¼Œå†å‘é€æŠ¥æ–‡ï¼›æ‰€ä»¥æ¥è‡ª Native VLAN çš„æ•°æ®å¸§é€šè¿‡ Trunk é“¾è·¯æ—¶ä¸é‡æ–°å°è£…ï¼Œä»¥åŸæœ‰çš„å¸§ä¼ è¾“åä¸ºäº¤æ¢æœºç¼ºçœVLANè¢«ç§°ä¸º â€œPvidVlanâ€ï¼Œå¯¹äºæ€ç§‘äº¤æ¢æœºç¼ºçœVLANè¢«ç§°ä¸º â€œNative Vlanâ€</p></blockquote><h2 id="vlan-å¸§æ ¼å¼"><a class="markdownIt-Anchor" href="#vlan-å¸§æ ¼å¼"></a> VLAN å¸§æ ¼å¼</h2><p>Swith é…ç½® VLAN åï¼Œä¼šå°†æ”¶åˆ°çš„æ•°æ®æŠ¥åŠ å…¥ VLAN å¤´ï¼š<strong>äº¤æ¢æœº</strong>è´Ÿè´£æ‰“æ ‡ç­¾å’Œå»æ ‡ç­¾ï¼Œå¯¹äºä¸»æœºæ¥è¯´æ˜¯é€æ˜çš„</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20210930135517564.png" alt="image-20210930135517564" /></p><h2 id="vlan-è½¬å‘åŸåˆ™"><a class="markdownIt-Anchor" href="#vlan-è½¬å‘åŸåˆ™"></a> VLAN è½¬å‘åŸåˆ™</h2><h3 id="access-ç«¯å£"><a class="markdownIt-Anchor" href="#access-ç«¯å£"></a> Access ç«¯å£</h3><p><strong>Access ç«¯å£æ”¶åˆ°å¸§æ—¶</strong>ï¼šè®¡ç®—æœº â†’ äº¤æ¢æœº</p><p>è¯¥å¸§ä¸åŒ…å« VLAN ä¿¡æ¯ï¼ˆæŒ‰ç†è¯´ä¸åŒ…å«ï¼‰ï¼Œå°†æ‰“ä¸Šç«¯å£çš„ PVID ï¼ˆåŸºäºç«¯å£çš„Vlan IDï¼‰ï¼›</p><p>è¯¥å¸§åŒ…å« VLAN ä¿¡æ¯ï¼Œæ£€æµ‹ VLAN ä¿¡æ¯ä¸ç«¯å£æ ‡ç­¾æ˜¯å¦ç›¸åŒï¼Œå¦‚æœç›¸åŒç›´æ¥è½¬å‘ï¼›ä¸ç›¸åŒåˆ™ä¸¢å¼ƒã€‚</p><p><strong>Access ç«¯å£å‘é€å¸§æ—¶</strong>ï¼šäº¤æ¢æœº â†’ è®¡ç®—æœº</p><p>åªç»‘å®šä¸€ä¸ª VLANï¼Œå› æ­¤å‰¥ç¦» VLAN ä¿¡æ¯ï¼Œå‘å‡ºçš„å¸§ä¸ºæ™®é€šä»¥å¤ªç½‘å¸§</p><h3 id="trunk-ç«¯å£"><a class="markdownIt-Anchor" href="#trunk-ç«¯å£"></a> Trunk ç«¯å£</h3><p><strong>Trunk ç«¯å£æ”¶åˆ°å¸§æ—¶</strong>ï¼šäº¤æ¢æœº â†’ äº¤æ¢æœº</p><p>è¯¥å¸§ä¸åŒ…å« VLAN ä¿¡æ¯ï¼ˆç‰¹æ®Šæƒ…å†µï¼‰ï¼Œåˆ™å°†æŠ¥æ–‡è½¬å‘ï¼ˆæ‰“æ ‡ç­¾ï¼‰åˆ°å±äºç¼ºçœ VLAN çš„ç«¯å£</p><p>è¯¥å¸§åŒ…å« VLAN ä¿¡æ¯ï¼ˆå¤§å¤šæ•°æƒ…å†µï¼‰ï¼Œåˆ™ä¸æ”¹å˜ï¼Œç›´æ¥è½¬å‘</p><p><strong>Trunk ç«¯å£å‘é€å¸§æ—¶</strong>ï¼šäº¤æ¢æœº â†’ äº¤æ¢æœº</p><p>å½“è¯¥å¸§çš„ VLAN ä¿¡æ¯ä¸ç«¯å£çš„ PVIDï¼ˆç¼ºçœ Port-base VLAN IDï¼‰ ä¸åŒæ—¶ï¼Œç›´æ¥è½¬å‘ï¼›</p><p>å½“è¯¥å¸§çš„ VLAN ä¿¡æ¯ä¸ç«¯å£çš„ PVID ç›¸åŒæ—¶ï¼Œåˆ™å‰¥ç¦»VLANä¿¡æ¯ï¼Œå†å‘é€</p><blockquote><p>åŒæ ‡ç­¾è·³è·ƒæ”»å‡»çš„å…³é”®ç‚¹</p></blockquote><h1 id="vlanå®‰å…¨å¨èƒ"><a class="markdownIt-Anchor" href="#vlanå®‰å…¨å¨èƒ"></a> VLANå®‰å…¨å¨èƒ</h1><p>ä¸»è¦ä»‹ç» è·³è·ƒæ”»å‡» ä¸ VTP æ”»å‡»</p><h2 id="åŒæ ‡ç­¾è·³è·ƒæ”»å‡»"><a class="markdownIt-Anchor" href="#åŒæ ‡ç­¾è·³è·ƒæ”»å‡»"></a> åŒæ ‡ç­¾è·³è·ƒæ”»å‡»</h2><p>Targetï¼šå®ç°è·¨ VLAN é€šä¿¡</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20210930140913396.png" alt="image-20210930140913396" /></p><h3 id="æ”»å‡»è¿‡ç¨‹"><a class="markdownIt-Anchor" href="#æ”»å‡»è¿‡ç¨‹"></a> æ”»å‡»è¿‡ç¨‹</h3><p>1ã€æ”»å‡»è€…ä½¿ç”¨åŒå±‚æ ‡ç­¾ï¼Œå…¶å¤–å±‚æ ‡è®°ä¸º Trunk é“¾è·¯çš„ Native VLAN å·ï¼ˆä¹Ÿæ˜¯æ”»å‡»è€…æ‰€å¤„çš„ VLANï¼‰ï¼Œå†…å±‚æ ‡è®°ä¸ºç›®çš„ Vlan ID</p><p>2ã€Access ç«¯å£æ”¶åˆ°ä¸»æœºå‘æ¥çš„å¸¦æœ‰ VLAN ID çš„åŒ…ï¼ŒåŒ¹é…ä¸€è‡´åï¼Œè½¬åˆ° Trunk ç«¯å£å‡†å¤‡å‘é€</p><p>3ã€Trunk ç«¯å£æ”¶åˆ°åŒ…åï¼Œå‘ç° VLAN ID ä¸ ç¼ºçœ ID ä¸€è‡´ï¼Œå»é™¤å¤–ä¾§ VLAN åå‘é€</p><p>4ã€Trunk ç«¯å£æ”¶åˆ°åŒ…åï¼Œè¯¥å¸§åŒ…å« VLAN ä¿¡æ¯ï¼ˆå¤§å¤šæ•°æƒ…å†µï¼‰ï¼Œåˆ™ä¸æ”¹å˜ï¼Œç›´æ¥è½¬å‘</p><p>5ã€Trunk ç«¯å£å‘é€åŒ…ï¼Œè¯¥å¸§çš„ VLAN ä¿¡æ¯ä¸ç«¯å£çš„ PVID ä¸åŒæ—¶ï¼Œç›´æ¥è½¬å‘åˆ° Access ç«¯å£</p><p>4ã€Access ç«¯å£æ”¶åˆ°åŒ…åï¼Œå°†ä¼šæŸ¥çœ‹åˆ°å†…å±‚çš„ VLAN IDï¼Œå°±ä¼šç›´æ¥è½¬å‘äº†ï¼Œè½¬å‘åˆ°è®¡ç®—æœº</p><h3 id="å±€é™"><a class="markdownIt-Anchor" href="#å±€é™"></a> å±€é™</h3><p>1ã€æœ‰çš„äº¤æ¢æœºä» Access æ¥å£æ”¶åˆ°å¸¦æ ‡ç­¾çš„å¸§ï¼Œè®¤ä¸ºæ˜¯éæ³•çš„ï¼Œä¼šç›´æ¥ä¸¢å¼ƒ</p><p>2ã€åŒæ ‡ç­¾æ”»å‡»åªèƒ½å®ç°å•å‘æ”»å‡»</p><blockquote><p>ç”±äºæ˜¯å•å‘æ”»å‡»ï¼Œæ”»å‡»è€…æ— æ³•è·å¾—è¢«æ”»å‡»è€…çš„ MACï¼Œå› æ­¤æ”»å‡»åŒ…åªèƒ½æ˜¯äºŒå±‚çš„å¹¿æ’­æˆ–è€…ç»„æ’­å¸§</p></blockquote><h3 id="é˜²å¾¡"><a class="markdownIt-Anchor" href="#é˜²å¾¡"></a> é˜²å¾¡</h3><p>1ã€è®¾ç½® Trunk ç¼ºçœ VLAN ID ä¸ºä¸å­˜åœ¨çš„ VLAN ID å³å¯ï¼›</p><p>2ã€Access ç«¯å£ä¸å…è®¸å¸¦æœ‰ VLAN æ ‡ç­¾çš„å¸§é€šè¿‡ï¼›</p><h2 id="dtp-è·³è·ƒæ”»å‡»"><a class="markdownIt-Anchor" href="#dtp-è·³è·ƒæ”»å‡»"></a> DTP è·³è·ƒæ”»å‡»</h2><p>DTPï¼ŒDynamic Trunk Protocolï¼Œè‡ªåŠ¨åå•† Trunk é“¾è·¯çš„ç¼ºçœ ID</p><blockquote><p>ç®¡ç†å‘˜å¯ä»¥æ‰‹åŠ¨æŒ‡å®šäº¤æ¢æœºä¹‹é—´çš„é“¾è·¯æ˜¯å¦å½¢æˆ Trunkï¼Œä¹Ÿå¯ä»¥è®©äº¤æ¢æœºä½¿ç”¨ DTP è‡ªåŠ¨åå•†</p></blockquote><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20210930141952004.png" alt="image-20210930141952004" /></p><p>Perpetrator ä¼ªè£…æˆäº¤æ¢æœºï¼Œå‘é€ DTP åŒ…ï¼Œå°†æ”»å‡»è€…ä¸äº¤æ¢æœºä¹‹é—´çš„é“¾è·¯åå•†ä¸ºä¸º Trunk é“¾è·¯ï¼Œéšåæ”»å‡»è€…é€šè¿‡è¯¥é“¾è·¯ï¼Œå¯ä»¥æ”¶å‘å¸¦ä»»æ„ VLAN æ ‡ç­¾çš„æ•°æ®ï¼Œä»è€Œå®ç°è®¿é—®ä»»æ„ VLAN çš„ç›®çš„</p><p>ç‰¹ç‚¹ï¼šå®ç°æ”»å‡»è€…å’Œè¢«æ”»å‡»è€…ä¹‹é—´çš„åŒå‘è®¿é—®ï¼Œå¯¼è‡´æ”»å‡»è€…ç»•è¿‡é˜²ç«å¢™ç›´æ¥è®¿é—®ç›®æ ‡ä¸»æœº</p><p>é˜²èŒƒï¼šå…³é—­ä¸éœ€è¦å¼€å¯çš„äº¤æ¢æœºæ¥å£ï¼›å…³é—­ DTPï¼›</p><h2 id="vtp-æ”»å‡»"><a class="markdownIt-Anchor" href="#vtp-æ”»å‡»"></a> VTP æ”»å‡»</h2><p>VTPï¼ŒVLAN Trunk Protocolï¼Œæ€ç§‘ç§æœ‰åè®®ï¼Œå¸®åŠ©ç”¨æˆ·å‡å°‘æ¯ç‡¥ç¹é‡çš„é…ç½®å·¥ä½œ</p><p>åŸç†ï¼šç®¡ç†å‘˜åœ¨ç½‘ç»œä¸­è®¾ç½®ä¸€ä¸ªæˆ–è€…å¤šä¸ª VTP Severï¼Œç„¶ååœ¨ VTP Sever ä¸Šé¢åˆ›å»ºã€åˆ é™¤ã€ä¿®æ”¹VLANï¼ŒVTPåè®®ä¼šå°†è¿™äº›å˜åŒ–é€šå‘Šåˆ°å…¶ä»–äº¤æ¢æœºï¼Œè¿™äº›äº¤æ¢æœºå¯ä»¥æ›´æ–° VLAN ä¿¡æ¯ï¼Œå®ç°ç®¡ç†çš„è‡ªåŠ¨åŒ–</p><p>1ã€VLAN ä¿¡æ¯çš„åŒæ­¥æ˜¯é€šè¿‡ VTP é€šå‘Šæ¥å®ç°çš„ï¼ŒVTP é€šå‘Šåªèƒ½åœ¨ Trunk é“¾è·¯ä¸Šä¼ è¾“</p><p>2ã€é€šå‘Šæ˜¯ä»¥ç»„æ’­å¸§çš„æ–¹å¼å‘é€çš„ï¼Œé€šå‘Šä¸­æœ‰ä¸€ä¸ªå­—æ®µç§°ä¸ºä¿®è®¢å· Revisionã€‚æ¯æ¬¡æ·»åŠ åˆ é™¤æˆ–ä¿®æ”¹æ—¶ï¼ŒRevisionéƒ½ä¼šé€’å¢</p><p>3ã€å¦‚æœæ”¶åˆ°çš„Revisionæ›´é«˜ï¼Œåˆ™æœ¬äº¤æ¢æœºå°†æ ¹æ®æ­¤é€šå‘Šæ›´æ–°è‡ªèº«çš„ä¿¡æ¯ã€‚å¦‚æœäº¤æ¢æœºæ”¶åˆ°æ›´ä½çš„é€šå‘Šï¼Œä¼šç”¨è‡ªå·±çš„ä¿¡æ¯åå‘è¦†ç›–</p><p>4ã€æ”»å‡»è€…å‘é€é«˜çš„Revisionçš„VTPé€šå‘Šï¼Œå°±èƒ½æŠŠç½‘ç»œä¸­çš„VLANä¿¡æ¯è¦†ç›–äº†ã€‚å¦‚æœæ”»å‡»è€…æŠŠç½‘ç»œä¸­çš„å…¨éƒ¨VLANä¿¡æ¯åˆ é™¤äº†ï¼Œæ•´ä¸ªç½‘ç»œçš„é€šä¿¡ä¹Ÿå°±ä¸­æ–­äº†</p><p>é˜²èŒƒï¼šå…³é—­ä¸éœ€è¦å¼€å¯çš„äº¤æ¢æœºæ¥å£ï¼›å’Œç”¨æˆ·è®¡ç®—æœºè¿æ¥çš„æ¥å£è¦æ˜ç¡®é…ç½®ä¸º Access æ¨¡å¼ã€‚åªè¦Trunkæ— æ³•åå•†æˆåŠŸï¼ŒVTPå°†æ— æ³•å·¥ä½œï¼›é…ç½®VTPå¯†ç ï¼Œä½¿æ”»å‡»è€…å‘é€çš„VTPæ¶ˆæ¯è¢«æ‹’ç»æ¥æ”¶</p>]]></content>
      
      
      <categories>
          
          <category> Protocol Security </category>
          
      </categories>
      
      
        <tags>
            
            <tag> security </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>802.11 Protocol and Security</title>
      <link href="/Coming-blog/2021/12/05/802-11-protocol-and-security/"/>
      <url>/Coming-blog/2021/12/05/802-11-protocol-and-security/</url>
      
        <content type="html"><![CDATA[<h1 id="æ— çº¿ç½‘ç»œåè®®-80211"><a class="markdownIt-Anchor" href="#æ— çº¿ç½‘ç»œåè®®-80211"></a> æ— çº¿ç½‘ç»œåè®® 802.11</h1><p>æ— çº¿ç½‘ç»œçš„ä¼˜åŠ¿ï¼šè®©ç½‘ç»œä½¿ç”¨æ›´åŠ è‡ªç”±ï¼›ç½‘ç»œå»ºè®¾æ›´åŠ ç»æµï¼›é€šä¿¡æ›´åŠ ä¾¿åˆ©ï¼›å·¥ä½œæ›´åŠ é«˜æ•ˆ...</p><h2 id="å¸¸ç”¨åè¯"><a class="markdownIt-Anchor" href="#å¸¸ç”¨åè¯"></a> å¸¸ç”¨åè¯</h2><p>SSID: Service Set ID æœåŠ¡é›†è¯†åˆ«ç ï¼Œæ— çº¿åç§°</p><p>STA: Stationï¼Œä»»ä½•çš„æ— çº¿ç»ˆç«¯è®¾å¤‡</p><p>AP: Access Pointï¼Œæ¥å…¥ç‚¹</p><p>BSS: Basic Service Set, åŸºæœ¬æœåŠ¡é›†</p><blockquote><p>BSS æŒ‡ä»£ä¸€æ•´ä¸ªæœåŠ¡èŒƒå›´ï¼ŒèŒƒå›´å†… AP æä¾›æœåŠ¡ï¼ŒAP çš„å¤–åœ¨åè¯ç”± SSID å®šä¹‰ï¼ŒSTA é€šè¿‡ SSID é€‰æ‹©è¿æ¥å“ªä¸ª AP</p></blockquote><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20210923153802256.png" alt="image-20210923153802256" style="zoom:50%;" /><p>ESS: Extended Service Set, æ‰©å±•æœåŠ¡é›†ï¼Œé‡‡ç”¨**ç›¸åŒçš„ SSID **çš„å¤šä¸ª BSS å½¢æˆæ›´å¤§è§„æ¨¡çš„è™šæ‹Ÿ BSS</p><p>DS: Distribution System, åˆ†å¸ƒå¼ç³»ç»Ÿ</p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20210923153934280.png" alt="image-20210923153934280" style="zoom:50%;" /><p>Ad Hoc: æ— çº¿è‡ªç»„ç½‘ç»œï¼Œæ„æˆä¸€ç§ç‰¹æ®Šçš„æ— çº¿ç½‘ç»œåº”ç”¨æ¨¡å¼ï¼ŒSTA é—´å¯ç›´æ¥äº’ç›¸è¿æ¥ï¼Œèµ„æºå…±äº«ï¼Œè€Œæ— éœ€é€šè¿‡ AP</p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20210923154117728.png" alt="image-20210923154117728" style="zoom:50%;" /><h1 id="æ— çº¿ç½‘ç»œåè®®å®‰å…¨å¨èƒ"><a class="markdownIt-Anchor" href="#æ— çº¿ç½‘ç»œåè®®å®‰å…¨å¨èƒ"></a> æ— çº¿ç½‘ç»œåè®®å®‰å…¨å¨èƒ</h1><p>è¿™é‡Œä¸»è¦ä»‹ç»æ¶æ„è®¿é—®æ¥å…¥ç‚¹ï¼Œå…¶æ–¹å¼æœ‰äºŒï¼š</p><h2 id="æ¶æ„apå‡å†’æˆåˆæ³•ap"><a class="markdownIt-Anchor" href="#æ¶æ„apå‡å†’æˆåˆæ³•ap"></a> æ¶æ„APå‡å†’æˆåˆæ³•AP</h2><p>æ¶æ„ AP ä½¿ç”¨ç›¸åŒæˆ–ç›¸ä¼¼çš„ SSID æ ‡è¯†ï¼Œå†’å……æ­£è§„ AP ï¼Œæ‹¦æˆªæµé‡</p><blockquote><p>æ— çº¿å®¢æˆ·ç«¯æ¢æµ‹è½¯ä»¶ä¼šè¯¯è®¤ä¸ºè¯¥ä¼ªé€  AP æ˜¯åˆæ³• APï¼Œäºæ˜¯å°±è¿æ¥ä¸Šæ­¤æ— çº¿æ¥å…¥ç‚¹</p></blockquote><h2 id="å±€åŸŸç½‘å†…éƒ¨äººå‘˜æ­å»ºæ— çº¿-ap"><a class="markdownIt-Anchor" href="#å±€åŸŸç½‘å†…éƒ¨äººå‘˜æ­å»ºæ— çº¿-ap"></a> å±€åŸŸç½‘å†…éƒ¨äººå‘˜æ­å»ºæ— çº¿ AP</h2><p>å†…éƒ¨äººå‘˜æ­è®¾æ— çº¿ AP æ˜¯ä¸å®‰å…¨çš„ï¼Œå®¹æ˜“è®©é»‘å®¢ç»•è¿‡é˜²ç«å¢™</p><h1 id="æ— çº¿ç½‘ç»œåè®®å®‰å…¨æœºåˆ¶"><a class="markdownIt-Anchor" href="#æ— çº¿ç½‘ç»œåè®®å®‰å…¨æœºåˆ¶"></a> æ— çº¿ç½‘ç»œåè®®å®‰å…¨æœºåˆ¶</h1><p>éšè— SSID ä¸ºæœ€ç®€å•æ–¹ä¾¿çš„ä¿è¯æ— çº¿ç½‘ç»œå®‰å…¨çš„æ‰‹æ®µä¹‹ä¸€</p><h2 id="mac-å±‚ç”¨æˆ·æ¥å…¥ç®¡ç†è¿‡ç¨‹"><a class="markdownIt-Anchor" href="#mac-å±‚ç”¨æˆ·æ¥å…¥ç®¡ç†è¿‡ç¨‹"></a> MAC å±‚ç”¨æˆ·æ¥å…¥ç®¡ç†è¿‡ç¨‹</h2><h3 id="scanning"><a class="markdownIt-Anchor" href="#scanning"></a> Scanning</h3><p>STA å¯»æ‰¾ä¸€ä¸ªæ— çº¿ç½‘ç»œ</p><p>1ã€Passive Scanningï¼šæ‰¾åˆ°æ—¶é—´è¾ƒé•¿ä½†æ˜¯çœç”µ</p><blockquote><p>é€šè¿‡ä¾¦å¬ AP å®šæœŸå‘é€çš„ Beacon å¸§æ¥å‘ç°ç½‘ç»œ</p></blockquote><p>2ã€Active Scannignï¼šèƒ½è¿…é€Ÿæ‰¾åˆ°</p><blockquote><p>STA åœ¨æ¯ä¸ªä¿¡é“ä¸Šå‘é€ Probe request æŠ¥æ–‡ï¼Œä» AP å›åº”çš„ Probe response ä¸­è·å– SSID ä¿¡æ¯åº”ç”¨äºå‘ç°éšè— AP</p></blockquote><h3 id="authentication"><a class="markdownIt-Anchor" href="#authentication"></a> Authentication</h3><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/20211205143718.png" alt="shared-key authentication" /></p><p>é‡‡ç”¨ shared-key authentication è¿›è¡Œè®¤è¯ï¼ŒåŠ å¯†ç®—æ³•ä¸º WEP</p><blockquote><p>Attackers å¯ä»¥é€šè¿‡ç›‘å¬ AP å‘é€çš„æ˜æ–‡å’Œ STA å›å¤çš„å¯†æ–‡è®¡ç®—å‡º WEP keyå› æ­¤ WEP å·²ç»ä¸å†å®‰å…¨ï¼Œå…±äº«ç§˜é’¥è®¤è¯æ–¹å¼å·²ç»è¢« WPA/WPA2 ä»£æ›¿</p></blockquote><p>è¯¦æƒ…å°† <a href="##%E5%8A%A0%E5%AF%86%E6%96%B9%E5%BC%8F">åŠ å¯†æ–¹å¼</a></p><h3 id="association"><a class="markdownIt-Anchor" href="#association"></a> Association</h3><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/20211205143915.png" alt="Association" /></p><p>å…³è”ï¼ŒSTA å’Œ AP å»ºç«‹å…³è”ï¼Œåç»­çš„æ•°æ®æŠ¥æ–‡çš„æ”¶å‘åªèƒ½å’Œå»ºç«‹Associationå…³ç³»çš„APè¿›è¡Œ</p><h3 id="æ•°æ®æ”¶å‘"><a class="markdownIt-Anchor" href="#æ•°æ®æ”¶å‘"></a> æ•°æ®æ”¶å‘</h3><p>ç•¥</p><h2 id="csmaca"><a class="markdownIt-Anchor" href="#csmaca"></a> CSMA/CA</h2><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/20211205144057.png" alt="CSMA/CA" /></p><p>å¸¦å†²çªé¿å…çš„è½½æ³¢ä¾¦å¬å¤šè·¯è®¿é—®</p><p>1ã€å†²çªé¿å…ï¼šé€å‡ºæ•°æ®å‰ç›‘å¬åª’ä½“çŠ¶æ€ï¼Œç¡®å®šæ²¡äººä½¿ç”¨ï¼Œç»´æŒä¸€æ®µæ—¶é—´ï¼Œå†ï¼ˆéšæœºï¼‰ç­‰å¾…ä¸€æ®µéšæœºæ—¶é—´åï¼Œä¾ç„¶æ— äººä½¿ç”¨é€å‡ºæ•°æ®</p><p>2ã€é€å‡ºæ•°æ®å‰ï¼Œå‘é€è¯·æ±‚ä¼ é€æŠ¥æ–‡ï¼ˆRTSï¼‰ç»™ç›®æ ‡ç«¯ï¼Œç­‰å¾…ç›®æ ‡ç«¯å›åº” CTS æŠ¥æ–‡åæ‰ï¼Œå¼€å§‹ä¼ é€</p><blockquote><p>è¯¢é—® + åº”ç­”ï¼šå…ˆç«™ä½é€šä¿¡æ—¶é—´</p><p>ç¼ºç‚¹ï¼šç½‘ç»œçš„æ•ˆç‡ä¸‹é™</p><p>ä¼˜ç‚¹ï¼šä¸¤ç§æ§åˆ¶å¸§éƒ½å¾ˆçŸ­ï¼Œå¼€é”€å°ã€‚ç›¸åï¼Œè‹¥ä¸ä½¿ç”¨ï¼Œåˆ™ä¸€æ—¦å‘ç”Ÿå†²çªè€Œå¯¼è‡´æ•°æ®å¸§é‡å‘ï¼Œåˆ™æµªè´¹çš„æ—¶é—´å°±æ›´å¤§ã€‚</p></blockquote><h2 id="åŠ å¯†æ–¹å¼"><a class="markdownIt-Anchor" href="#åŠ å¯†æ–¹å¼"></a> åŠ å¯†æ–¹å¼</h2><p>(ä»…ä½œäº†è§£ï¼ŒForget itï¼)WEPï¼ŒWired Equivalent Privacyï¼Œæœ‰çº¿å¯¹ç­‰ç§æœ‰åè®® ä¸ WPA/WPA2ï¼ŒWi-Fi Protected Accessï¼Œæ— çº¿ä¿æŠ¤æ¥å…¥</p><h3 id="wep"><a class="markdownIt-Anchor" href="#wep"></a> WEP</h3><p>Wired Equivalent Privacyï¼Œæœ‰çº¿å¯¹ç­‰ç§æœ‰åè®®</p><p>1ã€åˆå§‹åŒ–å‘é‡ IV + å¯†ç  PASSWORD + DATA æ˜æ–‡æ•°æ® + CRC-32 æ˜æ–‡çš„å®Œæ•´æ€§æ ¡éªŒå€¼</p><p>2ã€å¾—åˆ° KSA = IV + PASSWORD</p><blockquote><p>IVå‘é‡å¤ªçŸ­ï¼Œå¤§é‡ç›‘å¬ç”¨æˆ·æ•°æ®æŠ¥æ–‡åï¼ŒWEPåŠ å¯†å¾ˆå®¹æ˜“è¢«ç ´è§£</p></blockquote><p>3ã€ç»è¿‡ RC4 ä¼ªéšæœºæ•°å¯†é’¥åŠ å¯†å¾—åˆ° PRGA = RC4ï¼ˆKSAï¼‰</p><blockquote><p>RC4åŠ å¯†ç®—æ³•è¿‡äºç®€å•</p></blockquote><p>4ã€å¯¹ PRGA ä¸ DATA + CRC-32 è¿›è¡Œå¼‚æˆ–åŠ å†•ç®—æ³•</p><p>5ã€å¾—åˆ°å¯†æ–‡ ENCRYPTED DATA</p><p>6ã€å°†å¯†æ–‡ä¸ IV ä¸€èµ·å‘é€</p><blockquote><p>åŠ å¯†æ•´ä¸ªç½‘ç»œå…±ç”¨ä¸€ä¸ªå…±äº«å¯†é’¥ï¼Œä¸€æ—¦ä¸¢å¤±ï¼Œæ•´ä¸ªç½‘ç»œéƒ½å¾ˆå±é™©</p></blockquote><p><strong>è§£å¯†</strong></p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20211005192237440.png" alt="image-20211005192237440" /></p><h3 id="wpawpa2"><a class="markdownIt-Anchor" href="#wpawpa2"></a> WPA/WPA2</h3><p>Wi-Fi Protected Accessï¼Œæ— çº¿ä¿æŠ¤æ¥å…¥ï¼Œäº†è§£å³å¯ï¼Œä¸å¿…æ·±ç©¶</p><p>WPAå¯†ç ç ´è§£æ—¶ï¼Œåªè¦èƒ½æŠ“åˆ°ç”¨æˆ·å’ŒAPä¹‹é—´çš„4æ¬¡æ¡æ‰‹åŒ…ä¸­åŒ…å«çš„å’Œå¯†ç æœ‰è”ç³»çš„ä¿¡æ¯ï¼Œé‡‡ç”¨å­—å…¸è¿›è¡Œæš´åŠ›ç ´è§£ï¼Œèƒ½å¦ç ´è§£å°±å–å†³äºå­—å…¸å’Œå¯†ç çš„å¤æ‚ç¨‹åº¦äº†</p>]]></content>
      
      
      <categories>
          
          <category> Protocol Security </category>
          
      </categories>
      
      
        <tags>
            
            <tag> security </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>802.3 Protocol and Security</title>
      <link href="/Coming-blog/2021/12/05/802-3-protocol-and-security/"/>
      <url>/Coming-blog/2021/12/05/802-3-protocol-and-security/</url>
      
        <content type="html"><![CDATA[<h1 id="æœ‰çº¿ç½‘ç»œ8023åè®®å®‰å…¨"><a class="markdownIt-Anchor" href="#æœ‰çº¿ç½‘ç»œ8023åè®®å®‰å…¨"></a> æœ‰çº¿ç½‘ç»œï¼ˆ802.3ï¼‰åè®®å®‰å…¨</h1><p>802.3 å®šä¹‰äº†æœ‰çº¿ä»¥å¤ªç½‘çš„ç‰©ç†å±‚å’Œæ•°æ®é“¾è·¯å±‚çš„ä»‹è´¨è®¿é—®æ§åˆ¶ ï¼ˆMACï¼‰ï¼Œæ¶‰åŠåˆ°äº†ç‰©ç†å±‚ä¸æ•°æ®é“¾è·¯å±‚çš„å­å±‚ MAC å±‚.</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/20211130101819.png" alt="802.3" /></p><p>å±€åŸŸç½‘çš„ä»‹è´¨æ˜¯å…±äº«çš„ï¼Œè€Œå¹¿åŸŸç½‘æ˜¯ä¸“ç”¨çš„ï¼ˆç‚¹å¯¹ç‚¹ï¼‰ä¸å­˜åœ¨ä»‹è´¨å†²çªé—®é¢˜</p><blockquote><p>ç†è§£ä¸ºæ€»çº¿ç­‰ç»“æ„ï¼Œéœ€è¦è§£å†³å†²çªé—®é¢˜</p></blockquote><h1 id="å±€åŸŸç½‘"><a class="markdownIt-Anchor" href="#å±€åŸŸç½‘"></a> å±€åŸŸç½‘</h1><p>å±€åŸŸç½‘ä¸ºä¸€ä¸ªå•ä½æ‰€æ‹¥æœ‰ï¼Œå…¶åœ°ç†ä½ç½®å’Œç«™ç‚¹æ•°ç›®æœ‰é™</p><p>ä¼ è¾“ç‰¹ç‚¹ï¼š1ã€ç”¨å¸¦åœ°å€çš„å¸§æ¥ä¼ é€æ•°æ®ï¼›2ã€ä¸å­˜åœ¨ä¸­é—´è·¯ç”±ï¼›</p><p>ä¼˜ç‚¹ï¼šå…·æœ‰å¹¿æ’­åŠŸèƒ½ï¼›åˆ©äºæ‰©å±•ï¼›å„è®¾å¤‡ä½ç½®å¯çµæ´»è°ƒæ•´å’Œæ”¹å˜ï¼›æé«˜äº†ç³»ç»Ÿçš„å¯é æ€§ã€å¯ç”¨æ€§ã€ç”Ÿå­˜æ€§ï¼›</p><h2 id="æ‹“æ‰‘ç»“æ„"><a class="markdownIt-Anchor" href="#æ‹“æ‰‘ç»“æ„"></a> æ‹“æ‰‘ç»“æ„</h2><p>æ˜Ÿå½¢ï¼Œæ€»çº¿ï¼Œç¯å½¢ï¼Œæ ‘å½¢</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/20211205103954.png" alt="å±€åŸŸç½‘æ‹“æ‰‘ç»“æ„" /></p><h2 id="å±‚æ¬¡åˆ’åˆ†"><a class="markdownIt-Anchor" href="#å±‚æ¬¡åˆ’åˆ†"></a> å±‚æ¬¡åˆ’åˆ†</h2><p>äº”å±‚åè®®ä¸­å±äºç¬¬äºŒå±‚ï¼šä¼ è¾“é“¾è·¯å±‚ï¼Œä½†æ˜¯å…¶æ‰€éœ€çš„å±‚æ¬¡æ¶‰åŠåˆ°ç‰©ç†å±‚ï¼ˆç‰©ç†è¿æ¥æ˜¯åŸºç¡€ï¼‰ä»¥åŠ IP å±‚ï¼ˆARP åè®®å±äºç½‘ç»œå±‚ä½†æ˜¯å·¥ä½œåœ¨é“¾è·¯å±‚ï¼‰</p><p>å…·ä½“å¯åˆ†ä¸ºï¼šMAC å±‚ï¼ˆä»‹è´¨è®¿é—®æ§åˆ¶ï¼Œå’Œä»‹è´¨å¯†åˆ‡ç›¸å…³ï¼‰ä¸ LLC å±‚ï¼ˆé€»è¾‘é“¾è·¯æ§åˆ¶ï¼Œä¸æ‰€ç”¨ä»‹è´¨ã€ä»‹è´¨è®¿é—®æ–¹æ³•æ— å…³ï¼‰</p><p>MAC å±‚è´Ÿè´£ä¼ é€æ—¶å°†æ•°æ®å°è£…æˆå¸¦åœ°å€å’Œå·®é”™æ£€æµ‹çš„å¸§ï¼Œæ¥æ”¶æ—¶æ‹†å¸§å¹¶æ‰§è¡Œåœ°å€è¯†åˆ«å’Œå·®é”™æ£€æµ‹ï¼Œä»¥æ­¤æ§åˆ¶å¯¹ LAN ä¼ è¾“ä»‹è´¨çš„è®¿é—®</p><p>LLC å±‚ç»™é«˜å±‚æä¾›æ¥å£å¹¶æ‰§è¡Œæµæ§å’Œå·®é”™æ£€æµ‹</p><h2 id="cmsacd-å·¥ä½œåŸç†"><a class="markdownIt-Anchor" href="#cmsacd-å·¥ä½œåŸç†"></a> CMSA/CD å·¥ä½œåŸç†</h2><p>è½½æ³¢ç›‘å¬åè®®ï¼ŒCSMA/CDï¼ŒCarrier Sense Mutiple Access Collision detectï¼Œç½‘ç»œç«™ç‚¹ç›‘å¬è½½æ³¢æ˜¯å¦å­˜åœ¨ï¼ˆæ—¢æœ‰æ— ä¼ è¾“ï¼‰ï¼Œå¹¶éšä¹‹é‡‡å–ç›¸åº”çš„è¡ŒåŠ¨ï¼šå…ˆå¬åå‘ï¼Œè¾¹å‘è¾¹å¬ï¼Œå†²çªåœå‘ï¼Œéšæœºå»¶è¿Ÿåé‡å‘</p><p>1ã€ç›‘å¬åˆ°ä»‹è´¨ç©ºé—²åˆ™ä¼ è¾“ï¼›ç›‘å¬åˆ°ä»‹è´¨å¿™ï¼Œç»§ç»­ç›‘å¬ï¼Œç›´åˆ°ä»‹è´¨ç©ºé—²é©¬ä¸Šä¼ è¾“</p><p>2ã€åœ¨ä¼ è¾“æœŸé—´æ£€æµ‹åˆ°å†²çªï¼Œå‘åœå‘é€åŒæ—¶å‘é€ä¸€ç®€çŸ­ JAM ä¿¡å·</p><p>3ã€å‘å‡º JAM ä¿¡å·åï¼Œç­‰å¾…ä¸€éšæœºæ—¶é—´ï¼›ä»å¤´å¼€å§‹</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/20211130102214.png" alt="CMSA/CD å·¥ä½œåŸç†" /></p><p>å­˜åœ¨çš„é—®é¢˜ï¼šç­‰å¾…ä¸€å®šæ—¶é—´éƒ½æ£€æµ‹åˆ°ç©ºé—²å‘é€ï¼Œé‚£ä¹ˆåˆå¿…ç„¶ç›¸æ’ï¼Œå› æ­¤é‡‡ç”¨éšæœºç­‰å¾…ï¼Œä½†æ˜¯æ›´é«˜çº§çš„æ˜¯é€€é¿ç®—æ³•çš„åº”ç”¨ï¼šé€€é¿ç®—æ³•ï¼šéšæœºæ€§ç­‰æ–¹æ¡ˆï¼›ç•¥</p><p>Tipsï¼šé™¤æ­¤ä¹‹å¤–ï¼ŒMAC æœåŠ¡è§„èŒƒå³ä»‹è´¨è®¿é—®æ§åˆ¶å°†ä¼ è¾“ä»‹è´¨å¸¦å®½æœ‰æ•ˆåœ°åˆ†é…ç»™ç½‘ä¸Šå„ç«™ç‚¹ç”¨æˆ·</p><h1 id="ä»¥å¤ªç½‘-mac-å±‚"><a class="markdownIt-Anchor" href="#ä»¥å¤ªç½‘-mac-å±‚"></a> ä»¥å¤ªç½‘ MAC å±‚</h1><p>MAC åœ°å€ï¼šç½‘å¡å‡ºå‚æ—¶å³æœ‰çš„ï¼Œå…¨çƒå”¯ä¸€ï¼Œç”¨äºäºŒå±‚ä¸­çš„é€šä¿¡</p><p>é€‚é…å™¨ä»ç½‘ç»œä¸Šæ¯æ”¶åˆ°ä¸€ä¸ª MAC å¸§å°±é¦–å…ˆç”¨ç¡¬ä»¶æ£€æŸ¥ MAC å¸§ä¸­çš„ MAC åœ°å€ï¼Œå¦‚æœæ˜¯å‘å¾€æœ¬ç«™çš„å¸§åˆ™æ”¶ä¸‹ï¼Œç„¶åå†è¿›è¡Œå…¶ä»–çš„å¤„ç†ï¼›å¦åˆ™å°±å°†æ­¤å¸§ä¸¢å¼ƒï¼Œä¸å†è¿›è¡Œå…¶ä»–çš„å¤„ç†ï¼›</p><p>å¯èƒ½å—åˆ°çš„å¸§çš„ç§ç±»ï¼šå•æ’­å¸§ï¼›å¹¿æ’­å¸§ï¼›å¤šæ’­å¸§ï¼›</p><blockquote><p>å¹¿æ’­åœ°å€ä¸ºï¼š<code>FF-FF-FF-FF-FF-FF</code></p></blockquote><h2 id="mac-å¸§"><a class="markdownIt-Anchor" href="#mac-å¸§"></a> MAC å¸§</h2><p>ä»¥å¤ªç½‘ V2 æ ¼å¼çš„ MAC å¸§ï¼šç›®çš„ MACï¼Œæº MACï¼Œç±»å‹ï¼ŒIP æ•°æ®æŠ¥...</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/20211130102531.png" alt="MAC å¸§" /></p><h2 id="mac-å±‚æ‰©å±•æ–¹å¼"><a class="markdownIt-Anchor" href="#mac-å±‚æ‰©å±•æ–¹å¼"></a> MAC å±‚æ‰©å±•æ–¹å¼</h2><p>æ‰©å±•æ–¹å¼ï¼šåœ¨ç‰©ç†å±‚æ‰©å±•å±€åŸŸç½‘ï¼Œé‡‡ç”¨é›†çº¿å™¨ï¼ˆHubï¼‰å’Œäº¤æ¢æœºï¼ˆSwitching Hubï¼‰</p><p>æ‰©å±•çš„ç›®çš„ï¼šå¢åŠ å±€åŸŸç½‘å†…ä¸»æœºçš„ä¸ªæ•°ï¼›å¢å¤§å±€åŸŸç½‘çš„ä½œç”¨èŒƒå›´ï¼›</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/20211130102711.png" alt="MAC å±‚æ‰©å±•æ–¹å¼" /></p><h3 id="é›†çº¿å™¨"><a class="markdownIt-Anchor" href="#é›†çº¿å™¨"></a> é›†çº¿å™¨</h3><p>ä¼˜åŠ¿ï¼šä½¿åŸæ¥å±äºä¸åŒå†²çªåŸŸçš„å±€åŸŸç½‘ä¸Šçš„è®¡ç®—æœºèƒ½å¤Ÿè¿›è¡Œè·¨å†²çªåŸŸçš„é€šä¿¡ï¼›æ‰©å¤§äº†å±€åŸŸç½‘è¦†ç›–çš„åœ°ç†èŒƒå›´</p><p>åŠ£åŠ¿ï¼šå†²çªåŸŸå¢å¤§äº†ï¼Œä½†æ€»çš„ååé‡å¹¶æœªæé«˜ï¼ˆæ‰€ä»¥æœºå™¨å…±äº«ä¸€ä¸ªå¸¦å®½å¯¼è‡´æ•´ä½“æ€§èƒ½ä¸‹é™ï¼‰ï¼›å¦‚æœä¸åŒçš„å†²çªåŸŸä½¿ç”¨ä¸åŒçš„æ•°æ®ç‡ï¼Œé‚£ä¹ˆå°±ä¸èƒ½ç”¨é›†çº¿å™¨å°†å®ƒä»¬äº’è¿èµ·æ¥ï¼›</p><h3 id="å†²çªåŸŸ"><a class="markdownIt-Anchor" href="#å†²çªåŸŸ"></a> å†²çªåŸŸ</h3><p>ä»‹è´¨å…±äº«å†²çªçš„é—®é¢˜ï¼Œè€Œ Hub é›†çº¿å™¨å°±æ˜¯æ€»çº¿ç»“æ„ï¼Œæ‰€æœ‰çš„æœºå™¨éƒ½åœ¨ä¸€ä¸ªå†²çªåŸŸå†…</p><blockquote><p>ä¸ºäº†ä»–æé«˜ä¼ è¾“æ•ˆç‡å°±è¦å°½é‡åˆ†å‰²å†²çªåŸŸ</p></blockquote><p>äº¤æ¢æœºèƒŒæ¿äº¤æ¢çŸ©é˜µç»“æ„å®ç°äº†å†²çªåŸŸçš„åˆ’åˆ†ï¼šå…¶æ¯ä¸ªç«¯å£è®¿é—®å¦ä¸€ä¸ªç«¯å£æ—¶ï¼Œéƒ½æœ‰ä¸€æ¡ä¸“æœ‰çš„çº¿è·¯ï¼Œä¸ä¼šäº§ç”Ÿå†²çª</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/20211130104103.png" alt="èƒŒæ¿äº¤æ¢çŸ©é˜µç»“" /></p><h2 id="äº¤æ¢æœº"><a class="markdownIt-Anchor" href="#äº¤æ¢æœº"></a> äº¤æ¢æœº</h2><p>åˆåäº¤æ¢å¼é›†çº¿å™¨ï¼ˆSwitching Hubï¼‰ä¸ 1990 å¹´é—®ä¸–ï¼Œæ˜¾è‘—æé«˜äº†å±€åŸŸç½‘çš„æ€§èƒ½</p><p>èƒ½å¤Ÿæ ¹æ®ä»¥å¤ªç½‘å¸§ä¸­ç›®æ ‡åœ°å€æ™ºèƒ½çš„è½¬å‘æ•°æ®ï¼Œå®ç°äº†å†²çªåŸŸçš„åˆ’åˆ†</p><blockquote><p>å› æ­¤äº¤æ¢æœºå·¥ä½œåœ¨ç¬¬äºŒå±‚ï¼Œåˆåç¬¬äºŒå±‚äº¤æ¢æœº</p></blockquote><h3 id="ç‰¹ç‚¹"><a class="markdownIt-Anchor" href="#ç‰¹ç‚¹"></a> ç‰¹ç‚¹</h3><p>1ã€éš”ç¦»å†²çªåŸŸï¼šåœ¨å…±äº«å¼ä»¥å¤ªç½‘ä¸­ï¼Œä½¿ç”¨ CSMA/CD ç®—æ³•æ¥è¿›è¡Œä»‹è´¨è®¿é—®æ§åˆ¶</p><p>2ã€å¢åŠ æ€»å®¹é‡ï¼šäº¤æ¢æœºçš„æ¯ä¸ªç«¯å£å…·æœ‰ä¸“ç”¨å®¹é‡ï¼Œäº¤æ¢å¼å±€åŸŸç½‘æ€»å®¹é‡éšç€äº¤æ¢æœºçš„ç«¯å£æ•°é‡è€Œå¢åŠ </p><blockquote><p>å…¶ä¸‹çš„æ¯ä¸€ä¸ªå­ç½‘å—éƒ½ä¼šæ‹¥æœ‰äº¤æ¢æœºä¸Šç½‘å£çš„å…¨éƒ¨æµé‡ï¼Œå› æ­¤ä½¿ç”¨ç«¯å£è¶Šå¤šï¼Œæ€»å®¹é‡è¶Šå¤§</p></blockquote><p>3ã€æ•°æ®ç‡çµæ´»ï¼šäº¤æ¢æœºçš„æ¯ä¸ªç«¯å£å¯ä»¥ä½¿ç”¨ä¸åŒçš„æ•°æ®ç‡ï¼Œæ‰€ä»¥å¯ä»¥ä»¥ä¸åŒæ•°æ®ç‡éƒ¨ç½²ç«™ç‚¹</p><h3 id="é€šä¿¡æ–¹å¼"><a class="markdownIt-Anchor" href="#é€šä¿¡æ–¹å¼"></a> é€šä¿¡æ–¹å¼</h3><p>1ã€å•å·¥ï¼šåªæœ‰ä¸€ä¸ªä¿¡é“ï¼Œä¼ è¾“æ–¹å‘åªèƒ½æ˜¯å•å‘çš„ï¼Œå¦‚å¯»å‘¼æœº</p><p>2ã€åŠåŒå·¥ï¼šåªæœ‰ä¸€ä¸ªä¿¡é“ï¼Œåœ¨åŒä¸€æ—¶åˆ»ï¼Œåªèƒ½æ˜¯å•å‘ä¼ è¾“ï¼Œå¦‚å¯¹è®²æœº</p><p>3ã€åŒå·¥ï¼šåŒä¿¡é“ï¼ŒåŒæ—¶å¯ä»¥æœ‰åŒå‘æ•°æ®ä¼ è¾“ï¼Œå¦‚ç”µè¯</p><h3 id="æ•°æ®è½¬å‘åŸç†"><a class="markdownIt-Anchor" href="#æ•°æ®è½¬å‘åŸç†"></a> æ•°æ®è½¬å‘åŸç†</h3><p>æœ‰å››ç‚¹éœ€è¦ç†è§£ï¼šè½¬å‘ï¼Œå­¦ä¹ ï¼Œå¹¿æ’­ä¸æ›´æ–°</p><p>1ã€æ”¶åˆ°æ•°æ®å¸§åæŸ¥æ‰¾ MAC åœ°å€è¡¨</p><p>2ã€å¦‚æœæ²¡æŸ¥åˆ°ï¼šå­¦ä¹ è¿™ä¸ªå¸§çš„æºåœ°å€åˆ° MAC åœ°å€è¡¨ï¼Œå‘å…¶ä»–æ‰€æœ‰ç«¯å£å‘é€å¹¿æ’­</p><blockquote><p>ç›¸å…³ä¸»æœºæ”¶åˆ°å¹¿æ’­åŒ…åæŸ¥çœ‹æ•°æ®åŒ…çš„ç›®æ ‡ MAC åœ°å€æ˜¯ä¸æ˜¯è‡ªå·±ï¼Œä¸æ˜¯åˆ™ä¸¢å¼ƒæ•°æ®åŒ…ï¼›æ˜¯åˆ™æ¥æ”¶å¹¶å¤„ç†ï¼›å­¦ä¹ ï¼šMAC åœ°å€è¡¨æ˜¯äº¤æ¢æœºé€šè¿‡å­¦ä¹ æ¥æ”¶çš„æ•°æ®å¸§çš„æº MAC åœ°å€æ¥å½¢æˆçš„å¹¿æ’­ï¼šå¦‚æœç›®æ ‡åœ°å€åœ¨ MAC åœ°å€è¡¨ä¸­æ²¡æœ‰ï¼Œäº¤æ¢æœºå°±å‘é™¤æ¥æ”¶åˆ°è¯¥æ•°æ®å¸§çš„ç«¯å£å¤–çš„å…¶ä»–æ‰€æœ‰ç«¯å£å¹¿æ’­è¯¥æ•°æ®å¸§</p></blockquote><p>3ã€æŸ¥åˆ°äº†å•æ’­è½¬å‘å³å¯</p><blockquote><p>è½¬å‘ï¼šäº¤æ¢æœºæ ¹æ® MAC åœ°å€è¡¨å•æ’­è½¬å‘æ•°æ®å¸§</p></blockquote><p>æ›´æ–°ï¼šäº¤æ¢æœº MAC åœ°å€è¡¨çš„è€åŒ–æ—¶é—´æ˜¯ 300 ç§’ (300s å†…æ²¡æ”¶åˆ°é‚£ä¸ªæ¡ç›®ï¼Œåˆ™ä¼šåˆ é™¤)ï¼›äº¤æ¢æœºå¦‚æœå‘ç°ä¸€ä¸ªå¸§çš„å…¥ç«¯å£å’Œ MAC åœ°å€è¡¨ä¸­æº MAC åœ°å€çš„æ‰€åœ¨ç«¯å£ä¸åŒï¼Œäº¤æ¢æœºå°† MAC åœ°å€é‡æ–°å­¦ä¹ åˆ°æ–°çš„ç«¯å£</p><h1 id="8023-åè®®å®‰å…¨å¨èƒ"><a class="markdownIt-Anchor" href="#8023-åè®®å®‰å…¨å¨èƒ"></a> 802.3 åè®®å®‰å…¨å¨èƒ</h1><p>å†²çªåŸŸï¼šè¿æ¥åœ¨åŒä¸€åˆ°çº¿ä¸Šçš„æ‰€æœ‰å·¥ä½œç«™çš„é›†åˆï¼ˆäº¤æ¢æœºç ´é™¤å†²çªåŸŸï¼‰</p><p>å¹¿æ’­åŸŸï¼šæ¥æ”¶åŒæ ·å¹¿æ’­æ¶ˆæ¯çš„èŠ‚ç‚¹çš„é›†åˆï¼Œé€šå¸¸æ¥è¯´ä¸€ä¸ªå±€åŸŸç½‘å°±æ˜¯ä¸€ä¸ªå¹¿æ’­åŸŸ</p><h2 id="mac-æ³›æ´ªæ”»å‡»"><a class="markdownIt-Anchor" href="#mac-æ³›æ´ªæ”»å‡»"></a> MAC æ³›æ´ªæ”»å‡»</h2><p>å†…å®¹å¯å¯»å€å­˜å‚¨å™¨ï¼ŒContent Addressable Memoryï¼ŒCAMï¼Œå­˜å‚¨ MAC åœ°å€ä¸ç«¯å£çš„æ˜ å°„å…³ç³»</p><p>Processï¼šåœ¨å±€åŸŸç½‘ä¸­å‘é€å¸¦æœ‰æ¬ºéª—æ€§ MAC åœ°å€æºçš„æ•°æ®ï¼ŒCAM è¡¨ä¸­å°†ä¼šå¡«å……ä¼ªé€ çš„ MAC åœ°å€è®°å½•ï¼›å½“ CAM è¡¨ä¸­ç›¸å…³çš„äº¤æ¢æœºå†…å­˜å°†è¢«è€—å°½æ—¶ï¼Œäº¤æ¢æœºå°†ä»¥ç±»ä¼¼äºé›†çº¿å™¨çš„æ¨¡å¼å·¥ä½œï¼Œå‘å…¶å®ƒæ‰€æœ‰çš„ç‰©ç†ç«¯å£è½¬å‘æ•°æ®</p><blockquote><p>è¢«æ”»å‡»çš„ç°è±¡æ˜¯ç½‘ç»œé€Ÿåº¦æ˜æ˜¾é™ä½</p></blockquote><p>Protectï¼šé™åˆ¶ç«¯å£å¯ä»¥ç»‘å®šçš„ MAC æ•°ç›®ï¼›å›ºå®šå†™æ­» CAM ï¼ˆä¸çµæ´»ï¼‰ï¼›ç®¡ç†å‘˜å¯ä»¥æ ¹æ®æƒ…å†µåœ¨å‘ç”Ÿå®‰å…¨è¿è§„åå¯¹äº¤æ¢æœºé‡‡å–ï¼šå…³é—­æ¥å£ï¼ˆshutdownï¼‰ï¼Œé™åˆ¶æ¥å£ï¼ˆrestrictï¼‰ï¼Œä¿æŠ¤æ¥å£ï¼ˆprotectï¼‰ç­‰æ“ä½œã€‚</p><h2 id="mac-æ¬ºéª—"><a class="markdownIt-Anchor" href="#mac-æ¬ºéª—"></a> MAC æ¬ºéª—</h2><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/20211205140244.png" alt="MAC æ¬ºéª—" /></p><p>Processï¼šæ”»å‡»è€…å‘é€ä¼ªé€ ä»¥å¤ªç½‘å¸§ï¼šè®¾å®šæº MAC ä¸ºå—å®³è€…çš„ MACï¼›ç›®çš„ MAC ä¸ºæ”»å‡»è€…çš„ MACï¼Œè¿™æ ·äº¤æ¢æœºå°±ä¼šå°†å‘å¾€å—å®³è€…çš„æ•°æ®è½¬ç»™æ”»å‡»è€…ã€‚</p><blockquote><p>éšåå‘ç»™å—å®³ä¸»æœºçš„æ•°æ®å¸§å°†å‘é€ç»™æ”»å‡»è€…ï¼Œæ”»å‡»è€…å¯ä»¥å°†æ•°æ®ç¼“å­˜ï¼Œè®©ç½‘ç»œæ­£å¸¸åï¼ˆCAM è¡¨ä¸­çš„æ¶æ„è¡¨é¡¹300sè‡ªåŠ¨æ¶ˆå¤±æˆ–è€…å—å®³è€…ä¸»åŠ¨å‘èµ·çš„è¯·æ±‚æ›´æ–°äº†é”™è¯¯è¡¨é¡¹ï¼‰å†å°†æ•°æ®è½¬äº¤</p></blockquote><h2 id="arp-æ¬ºéª—"><a class="markdownIt-Anchor" href="#arp-æ¬ºéª—"></a> ARP æ¬ºéª—</h2><p>ARP ä¸ºä¸‰å±‚åè®®ï¼ˆå­˜å‚¨äº† IP ä¸ MAC çš„æ˜ å°„ï¼‰ï¼Œ<strong>ä½†æ˜¯æ˜¯å”¯ä¸€ä¸€ä¸ªä½œç”¨åœ¨äºŒå±‚çš„ä¸‰å±‚åè®®</strong>ï¼Œåªæœ‰ç»ˆç«¯å’Œè·¯ç”±å™¨èƒ½å¤Ÿè¯†åˆ«</p><p>å†²çªåŸŸï¼šè¿æ¥åœ¨åŒä¸€å¯¼çº¿ä¸Šçš„æ‰€æœ‰å·¥ä½œç«™çš„é›†åˆï¼ˆäº¤æ¢æœºç ´é™¤å†²çªåŸŸï¼‰</p><blockquote><p>å†²çªåŸŸå±äºç¬¬ä¸€å±‚ï¼Œå†²çªåŸŸæ˜¯ç”± hubï¼ˆé›†çº¿å™¨ï¼‰ç»„ç»‡çš„</p></blockquote><p>å¹¿æ’­åŸŸï¼šæ¥æ”¶åŒæ ·å¹¿æ’­æ¶ˆæ¯çš„èŠ‚ç‚¹çš„é›†åˆï¼Œé€šå¸¸æ¥è¯´ä¸€ä¸ªå±€åŸŸç½‘å°±æ˜¯ä¸€ä¸ªå¹¿æ’­åŸŸ</p><blockquote><p>å¹¿æ’­åŸŸå±äºç¬¬äºŒå±‚ï¼ŒSwitchï¼ˆäº¤æ¢æœºï¼‰æ‰€æœ‰ç«¯å£éƒ½åœ¨åŒä¸€ä¸ªå¹¿æ’­åŸŸå†…ï¼Œæ¯ä¸€ä¸ªç«¯å£å°±æ˜¯ä¸€ä¸ªå†²çªåŸŸ</p></blockquote><p><strong>Tips</strong>ï¼šå¹¿æ’­åŸŸå¯ä»¥è·¨ç½‘æ®µï¼Œå†²çªåŸŸåªæ˜¯å‘ç”Ÿåœ¨åŒä¸€ä¸ªç½‘æ®µï¼ˆç½‘æ®µåˆåæ½œåœ¨å†²çªåŸŸï¼‰</p><h3 id="arp-ç¼“å­˜è¡¨"><a class="markdownIt-Anchor" href="#arp-ç¼“å­˜è¡¨"></a> ARP ç¼“å­˜è¡¨</h3><p>ç”¨äºå­˜å‚¨å…¶å®ƒä¸»æœºæˆ–ç½‘å…³çš„ IP åœ°å€ä¸ MAC åœ°å€çš„å¯¹åº”å…³ç³»ï¼Œæ¯å°ä¸»æœºã€ç½‘å…³éƒ½æœ‰ä¸€ä¸ª ARP ç¼“å­˜è¡¨</p><blockquote><p>é™æ€ ARP ç¼“å­˜åœ°å€å¯¹ï¼šäººä¸ºå†™å…¥çš„ï¼Œä¸èƒ½è¢« ARP åº”ç­”åŒ…ä¿®æ”¹</p><p>åŠ¨æ€ ARP ç¼“å­˜è¡¨ï¼šèƒ½è¢« ARP åº”ç­”åŒ…ä¿®æ”¹</p></blockquote><h3 id="arp-æŠ¥æ–‡"><a class="markdownIt-Anchor" href="#arp-æŠ¥æ–‡"></a> ARP æŠ¥æ–‡</h3><p>ARP æŠ¥æ–‡ç›´æ¥åŠ å°ä»¥å¤ªç½‘æŠ¥å¤´ï¼Œä¸éœ€è¦æ”¾å…¥ IP æŠ¥æ–‡å†…ï¼ˆä¸ ICMP ä¸åŒï¼‰ã€‚</p><blockquote><p>ä½¿ç”¨ <code>arp -a</code> åœ¨ cmd ä¸­æŸ¥çœ‹æœ¬æœº ARP è¡¨</p></blockquote><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/20211130172924.png" alt="ARP æŠ¥æ–‡" /></p><p><strong>ARP è¯·æ±‚æŠ¥æ–‡</strong>ï¼šå‘é€å¹¿æ’­å¸§ï¼Œå·²çŸ¥ç›®æ ‡ IPï¼Œè¯·æ±‚ç›®æ ‡ MACï¼›æ­¤æ—¶ MAC å¸§çš„ç›®çš„åœ°å€ä¸ºå¹¿æ’­ MAC ï¼ˆå…¨ Fï¼‰ <code>:FF:FF</code>ï¼ŒARP çš„ç›®çš„ MAC ä¸º <code>:00:00</code> è¡¨ç¤ºæœªçŸ¥ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬æœ€ç»ˆæƒ³è¦è·å–çš„ <code>10.10.1.2</code> çš„ MAC</p><blockquote><p>Tipsï¼›ARP è¯·æ±‚å¹¿æ’­æ˜¯ç”¨äºŒå±‚ MAC å¹¿æ’­åœ°å€å‘é€ï¼Œä¸æ˜¯ç”¨ä¸‰å±‚ IP å¹¿æ’­åœ°å€ã€‚</p></blockquote><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20210923142159817.png" alt="image-20210923142159817" /></p><p><strong>ARP åº”ç­”æŠ¥æ–‡</strong>ï¼šç›®æ ‡ IP ç»ˆç«¯æ¥æ”¶åˆ° ARP è¯·æ±‚æŠ¥æ–‡ï¼Œè¿”å›è‡ªèº« MACï¼›MAC å¸§çš„æº MAC ä¸ ç›®çš„ MAC éƒ½æ˜¯å·²çŸ¥çš„ï¼Œæ‰€ä»¥æ˜¯å•æ’­å¸§ï¼›ç„¶å ARP çš„æº MAC ä¸ ç›®çš„ MAP åŒ…æ‹¬å¯¹åº”çš„ IP ä¹Ÿæ˜¯å·²çŸ¥çš„</p><blockquote><p>çŸ¥é“äº† 10.10.1.2 è¿™ä¸ª IP å¯¹åº”çš„ MAC ä¸º <code>:FA:3C</code></p></blockquote><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20210923142238810.png" alt="image-20210923142238810" /></p><h3 id="demo"><a class="markdownIt-Anchor" href="#demo"></a> Demo</h3><p><strong>Example - æµç¨‹ï¼ˆåŒä¸€ä¸ªå±€åŸŸç½‘å†…ï¼‰</strong>ï¼šä¸»æœº A ç›¸ä¸ ä¸»æœº B é€šä¿¡</p><p>0ã€ï¼ˆå¤šç§æ–¹å¼ï¼‰é€šè¿‡==Â DNSÂ ==è·å–äº†ä¸»æœº B çš„ IP åœ°å€</p><p>1ã€A å…ˆæ£€æŸ¥è‡ªå·±çš„ ARP ç¼“å­˜ä¸­æ˜¯å¦æœ‰ B çš„ IP åœ°å€å¯¹åº”çš„ MAC åœ°å€</p><p>2ã€å¦‚æœæ²¡æœ‰ï¼Œé‚£ä¹ˆ A å°†å‘é€ ==ARP== è¯·æ±‚æŠ¥æ–‡ï¼ˆå¹¿æ’­è¯·æ±‚ä¸»æœº B çš„ MAC åœ°å€ï¼‰</p><p>3ã€ä¸»æœº B æ”¶åˆ°è¯¥è¯·æ±‚åå›ç­”ä¸€ä¸ªå•æ’­çš„ ARP åº”ç­”æŠ¥æ–‡</p><p>4ã€A ä¸»æœºå¾—åˆ°äº† B ä¸»æœºçš„ MAC åœ°å€ï¼Œæ›´æ–° ARP ç¼“å­˜è¡¨</p><p>5ã€A ä¸»æœºä¸ B ä¸»æœºä¾é ä¸¤è€…ç¼“å­˜è¡¨é‡Œçš„è®°å½•å‘é€ MAC å¸§æ¥é€šè®¯å³å¯</p><p><strong>Example - æµç¨‹ï¼ˆä¸åŒå±€åŸŸç½‘å†…ï¼‰</strong>ï¼šä¸»æœº A ç›¸ä¸ ä¸»æœº B é€šä¿¡ï¼ŒARP - IP - ARO</p><p>0ã€ï¼ˆå¤šç§æ–¹å¼ï¼‰é€šè¿‡==Â DNSÂ ==è·å–äº†ä¸»æœº B çš„ IP åœ°å€</p><p>1ã€å·²çŸ¥ä¸»æœº B çš„ IP åœ°å€ï¼Œç›®çš„ MAC æœªçŸ¥ï¼ŒA å…ˆåˆ¤æ–­ä¸»æœº B çš„ IP åœ°å€æ˜¯å¦å±äºä¸€ä¸ªç½‘æ®µï¼Œä¸å±äºåˆ™è·å–ç½‘å…³çš„ MACï¼ˆå‘é€è·å–ç½‘å…³ MAC çš„ ARPï¼‰ï¼Œå±äºåˆ™æŒ‰ç…§ä¸Šä¸ª Demo æ¥åš</p><p>2ã€A æ£€æŸ¥è‡ªå·±çš„ ARP ç¼“å­˜è¡¨ä¸­æ˜¯å¦æœ‰ç½‘å…³ IP å¯¹åº”çš„ IP åœ°å€ï¼Œå¦‚æœæ²¡æœ‰ï¼Œé‚£ä¹ˆ A å°†å‘é€ ==ARP== è¯·æ±‚æŠ¥æ–‡ï¼ˆå¹¿æ’­è¯·æ±‚ç½‘å…³çš„ MAC åœ°å€ï¼ŒARP çš„ç›®çš„ IP å°†æ˜¯ç½‘å…³çš„ IPï¼Œä¸åœ¨æ˜¯ B çš„äº†ï¼›MAC å¸§åˆ™æ˜¯å¹¿æ’­å½¢å¼ä¸å˜ï¼‰ï¼Œç½‘å…³å›å¤ ARP åº”ç­”æŠ¥æ–‡ï¼ŒåŒæ–¹éƒ½æ›´æ–°äº† ARP ç¼“å­˜</p><blockquote><p>æ­¤æ—¶ A å°† MAC å¸§å•æ’­åˆ°ç½‘å…³å³å¯ï¼Œç½‘å…³å°†ä¼šé€šè¿‡å†…éƒ¨çš„ IP æ•°æ®åŒ…æ¥å¾—çŸ¥çœŸæ­£çš„ç›®çš„åœ°æ˜¯ B</p></blockquote><p>ff, A_mac, ..., A_mac, A_ip, 00, W_ip (ç½‘å…³çš„ ip)</p><p>3ã€éšåå°† MAC å¸§å‘ç»™ A çš„ç½‘å…³ï¼Œç½‘å…³æ”¶åˆ°æ•°æ®åŒ…åå‘ç°æ˜¯ç»™ B çš„ï¼Œåˆ™é€šè¿‡è·¯ç”±åè®®å‘é€åˆ° B æ‰€åœ¨çš„ç½‘å…³</p><p>4ã€B å¤„çš„ç½‘å…³å…ˆæ£€æŸ¥è‡ªå·±çš„ ARP ç¼“å­˜ï¼Œå¦‚æœæ²¡æœ‰ B å¯¹åº”çš„ MAC åˆ™åœ¨è¯¥å±€åŸŸç½‘å†…å‘é€ ARP è¯·æ±‚ï¼Œè·å–ä¸»æœº B å¯¹åº”çš„ MAC åœ°å€</p><p>5ã€å•æ’­ä¼ é€æ•°æ®æŠ¥</p><h3 id="arp-æ¬ºéª—å®ç°"><a class="markdownIt-Anchor" href="#arp-æ¬ºéª—å®ç°"></a> ARP æ¬ºéª—å®ç°</h3><p>åŒä¸€å±€åŸŸç½‘å†…æ¨¡æ‹Ÿå‘é€ ARP åº”ç­”æŠ¥æ–‡å³å¯ï¼ŒéåŒä¸€å±€åŸŸç½‘åˆ™éœ€è¦æ¬ºéª—ç½‘å…³ï¼ˆè·¯ç”±å™¨ï¼‰</p><p>1ã€æ”»å‡»è€…å‘ä¸»æœº A å’Œ B åˆ†åˆ«å‘é€ ARP æ¬ºéª—æŠ¥æ–‡ï¼Œæ¬ºéª—äº¤æ¢æœºçš„ CAM è¡¨</p><p>2ã€éšåæ”»å‡»è€…å°±èƒ½ä»ç½‘ç»œæ¥å£ä¸Šå—…æ¢å—å®³ä¸»æœºå‘è¿‡æ¥çš„æ•°æ®å¸§</p><p>3ã€æ”»å‡»è€…å°†å—…æ¢åˆ°çš„æ•°æ®å‘é€å›åŸæœ¬åº”è¯¥æ¥æ”¶çš„ä¸»æœº</p><p>å±å®³ï¼šä½¿åŒç½‘æ®µçš„å…¶ä»–ç”¨æˆ·æ— æ³•æ­£å¸¸ä¸Šç½‘ï¼ˆé¢‘ç¹æ–­ç½‘æˆ–è€…ç½‘é€Ÿæ…¢ï¼‰ï¼›å—…æ¢åˆ°äº¤æ¢å¼å±€åŸŸç½‘å†…æ‰€æœ‰æ•°æ®åŒ…ï¼Œä»è€Œå¾—åˆ°æ•æ„Ÿä¿¡æ¯ï¼›å¯¹ä¿¡æ¯è¿›è¡Œç¯¡æ”¹ï¼›æ§åˆ¶å±€åŸŸç½‘å†…ä»»ä½•ä¸»æœºï¼Œèµ·åˆ°â€œç½‘ç®¡â€çš„ä½œç”¨ï¼›</p><p>æ£€æµ‹ï¼šç½‘ç»œé¢‘ç¹æ‰çº¿ï¼Œç½‘é€Ÿçªç„¶å˜æ…¢ï¼›<code>arp -a</code> å‘½ä»¤ï¼›ä½¿ç”¨snifferè½¯ä»¶å‘ç°å±€åŸŸç½‘å†…å­˜åœ¨å¤§é‡çš„ARP replyåŒ…ï¼ŒåŒ…ä¸­æŒ‡å®šçš„MACå°±æ˜¯æ”»å‡»ä¸»æœºçš„MACåœ°å€</p><h3 id="arp-æ¬ºéª—é˜²å¾¡"><a class="markdownIt-Anchor" href="#arp-æ¬ºéª—é˜²å¾¡"></a> ARP æ¬ºéª—é˜²å¾¡</h3><p>1ã€MACåœ°å€ç»‘å®šï¼Œä½¿ç½‘ç»œä¸­æ¯ä¸€å°è®¡ç®—æœºçš„ IP åœ°å€ä¸ç¡¬ä»¶åœ°å€ä¸€ä¸€å¯¹åº”ï¼Œä¸å¯æ›´æ”¹</p><p>2ã€ä½¿ç”¨é™æ€ ARP ç¼“å­˜ï¼Œç”¨æ‰‹å·¥æ–¹æ³•æ›´æ–°ç¼“å­˜ä¸­çš„è®°å½•ï¼Œä½¿ ARP æ¬ºéª—æ— æ³•è¿›</p><p>3ã€ä½¿ç”¨ ARP æœåŠ¡å™¨ï¼Œé€šè¿‡è¯¥æœåŠ¡å™¨æŸ¥æ‰¾è‡ªå·±çš„ ARP è½¬æ¢è¡¨æ¥å“åº”å…¶ä»–æœºå™¨çš„ ARP å¹¿æ’­ã€‚ç¡®ä¿è¿™å° ARP æœåŠ¡å™¨ä¸è¢«é»‘</p><p>4ã€ä½¿ç”¨ ARP æ¬ºéª—é˜²æŠ¤è½¯ä»¶ï¼Œå¦‚ ARP é˜²ç«å¢™</p>]]></content>
      
      
      <categories>
          
          <category> Protocol Security </category>
          
      </categories>
      
      
        <tags>
            
            <tag> security </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>React Router</title>
      <link href="/Coming-blog/2021/12/04/react-router/"/>
      <url>/Coming-blog/2021/12/04/react-router/</url>
      
        <content type="html"><![CDATA[<h1 id="react-è·¯ç”±"><a class="markdownIt-Anchor" href="#react-è·¯ç”±"></a> React è·¯ç”±</h1><h2 id="spa"><a class="markdownIt-Anchor" href="#spa"></a> SPA</h2><p>SPAï¼Œsingle page web applicationï¼Œå•ä¸ªé¡µé¢ Web åº”ç”¨ï¼Œæ•´ä¸ªåº”ç”¨åªæœ‰ä¸€ä¸ªå®Œæ•´çš„é¡µé¢ï¼ˆå•é¡µé¢å¤šç»„ä»¶ï¼‰ï¼Œç‚¹å‡»é¡µé¢ä¸­çš„è¿æ¥ä¸ä¼šåˆ·æ–°é¡µé¢ï¼Œåªä¼šåšé¡µé¢çš„å±€éƒ¨æ›´æ–°</p><blockquote><p>æ•°æ®éƒ½éœ€è¦é€šè¿‡ ajax è¯·æ±‚è·å–ï¼Œå¹¶åœ¨å‰ç«¯å¼‚æ­¥å±•ç°</p></blockquote><h2 id="è·¯ç”±"><a class="markdownIt-Anchor" href="#è·¯ç”±"></a> è·¯ç”±</h2><p>è·¯ç”±å°±æ˜¯ä¸€ç§æ˜ å°„å…³ç³»ï¼Œå®ç° url ä¸­è·¯å¾„ä¸ç»„ä»¶/å¤„ç†å‡½æ•°çš„æ˜ å°„ï¼š</p><p>1ã€ç‚¹å‡»é“¾æ¥ï¼Œå˜æ¢urlï¼›</p><p>2ã€æ£€æµ‹åˆ° url å˜åŒ–æå– pathï¼›</p><p>3ã€æ ¹æ® path æ›´æ–°é¡µé¢ï¼›</p><h3 id="å‰ç«¯è·¯ç”±"><a class="markdownIt-Anchor" href="#å‰ç«¯è·¯ç”±"></a> å‰ç«¯è·¯ç”±</h3><p>å®ç° path ä¸ ç»„ä»¶çš„æ˜ å°„ï¼Œç›´æ¥åŠ è½½ç›®æ ‡ç»„ä»¶æ›´æ–°é¡µé¢</p><p>å·¥ä½œè¿‡ç¨‹ï¼šå½“ path å˜åŒ–ä¸º <code>/demo</code> æ—¶ï¼Œç‚¹å‰è·¯ç”±ç»„ä»¶å°±ä¼šå˜ä¸º <code>&lt;Demo/&gt;</code> ç»„ä»¶</p><h3 id="åç«¯è·¯ç”±"><a class="markdownIt-Anchor" href="#åç«¯è·¯ç”±"></a> åç«¯è·¯ç”±</h3><p>å®ç°çš„æ˜¯ path ä¸ å‡½æ•°çš„æ˜ å°„ï¼Œç”¨äºå¤„ç†å®¢æˆ·ç«¯æäº¤çš„è¯·æ±‚</p><p>æ³¨å†Œè·¯ç”±æ–¹å¼ï¼š<code>router.get(path, function(req, res))</code></p><p>å·¥ä½œè¿‡ç¨‹ï¼šå½“ node æ¥æ”¶åˆ°ä¸€ä¸ªè¯·æ±‚æ—¶ï¼Œæ ¹æ®è¯·æ±‚è·¯å¾„æ‰¾åˆ°åŒ¹é…çš„è·¯ç”±ï¼Œè°ƒç”¨è·¯ç”±ä¸­çš„å¤„ç†å‡½æ•°è¿”å›å“åº”æ•°æ®</p><h2 id="æµè§ˆå™¨åœ°å€æ“ä½œ"><a class="markdownIt-Anchor" href="#æµè§ˆå™¨åœ°å€æ“ä½œ"></a> æµè§ˆå™¨åœ°å€æ“ä½œ</h2><p>æµè§ˆå™¨çš„å†å²è®°å½•æ˜¯ä¸€ç§æ ˆç»“æ„ï¼ŒBOM ä¸­çš„ histroy å¯¹è±¡å¯¹å…¶ç»´æŠ¤ï¼Œä½¿ç”¨ history.js å¯ä»¥æ›´åŠ æ–¹ä¾¿çš„æ“ä½œ BOM ä¸­çš„ histroy</p><p>1ã€pushï¼š<code>history.push('/test')</code>ï¼Œå‘æ ˆä¸­æ¨å…¥ä¸€ä¸ªè·¯å¾„å¹¶æ›´æ”¹ url</p><p>2ã€replaceï¼š<code>history.repalce('/test')</code>ï¼Œæ›¿æ¢æ ˆé¡¶çš„è·¯å¾„å¹¶æ›´æ”¹ url</p><blockquote><p>æ³¨æ„æ›¿æ¢æ“ä½œå°†ä¸èƒ½å›é€€æ¯”å¦‚æˆ‘ä» demo1 æ¨å…¥äº† demo2 éšåæ‰§è¡Œæ›¿æ¢ åˆ°äº† demo3ï¼Œé‚£ä¹ˆæ‰§è¡Œå›é€€è·¯å¾„æ—¶ä¼šç›´æ¥åˆ° demo1ï¼Œdemo2 çš„è®°å½•ä¸¢å¤±äº†</p></blockquote><p>3ã€ç›‘å¬è·¯å¾„å˜åŒ–ï¼š</p><pre class="line-numbers language-javescript" data-language="javescript"><code class="language-javescript">history.listen((location) &#x3D;&gt; &#123;    console.log(&#39;è¯·æ±‚è·¯ç”±è·¯å¾„å˜åŒ–äº†&#39;, location)&#125;)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>å¦ä¸€ç§æ–¹æ³•æ˜¯é”šç‚¹è·³è½¬çš„æ€æƒ³ï¼šä»¥ <code>index.html</code> ä¸ºé¦–ï¼Œè¿›è¡Œé”šç‚¹è·³è½¬ä¼šå½¢æˆï¼š<code>index.html#demo</code></p><h1 id="react-router-dom"><a class="markdownIt-Anchor" href="#react-router-dom"></a> react-router-dom</h1><p>ç”¨äºå®ç°ä¸€ä¸ª SPA é¡¹ç›®ï¼ŒåŸºäº React çš„é¡¹ç›®åŸºæœ¬éƒ½ä¼šç”¨åˆ°æ­¤åº“</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">yarn add react-router-dom<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>1ã€æ˜ç¡®é¡µé¢ä¸­çš„å¯¼èˆªåŒºä¸å±•ç¤ºåŒº</p><p>2ã€å¯¼èˆªåŒºçš„ a æ ‡ç­¾æ”¹ä¸º Link æ ‡ç­¾ï¼Œto å±æ€§æŒ‡è·¯ç”±å˜åŒ–</p><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx"><span class="token punctuation">&#123;</span><span class="token comment">/* &lt;a className="list-group-item" href="./about.html">About&lt;/a> */</span><span class="token punctuation">&#125;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Link</span></span> <span class="token attr-name">className</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token string">'list-group-item '</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>activeName <span class="token operator">===</span> <span class="token string">'About'</span> <span class="token operator">?</span> <span class="token string">'active'</span> <span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">)</span> <span class="token punctuation">&#125;</span></span> <span class="token attr-name">to</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/about<span class="token punctuation">"</span></span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setActive</span><span class="token punctuation">(</span><span class="token string">'About'</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token punctuation">></span></span><span class="token plain-text">About</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Link</span></span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>3ã€å±•ç¤ºåŒºä¸è·¯ç”±åŒ¹é…</p><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx"><span class="token punctuation">&#123;</span><span class="token comment">/* æ³¨å†Œè·¯ç”± */</span><span class="token punctuation">&#125;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Routes</span></span><span class="token punctuation">></span></span><span class="token plain-text">    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Route</span></span> <span class="token attr-name">path</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/about<span class="token punctuation">"</span></span> <span class="token attr-name">element</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">About</span></span><span class="token punctuation">/></span></span><span class="token punctuation">&#125;</span></span><span class="token punctuation">/></span></span><span class="token plain-text">    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Route</span></span> <span class="token attr-name">path</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/home<span class="token punctuation">"</span></span> <span class="token attr-name">element</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Home</span></span><span class="token punctuation">/></span></span><span class="token punctuation">&#125;</span></span><span class="token punctuation">/></span></span><span class="token plain-text">    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Route</span></span> <span class="token attr-name">path</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/<span class="token punctuation">"</span></span> <span class="token attr-name">element</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Welcome</span></span><span class="token punctuation">/></span></span><span class="token punctuation">&#125;</span></span><span class="token punctuation">/></span></span><span class="token plain-text">    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Route</span></span> <span class="token attr-name">path</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/welcome<span class="token punctuation">"</span></span> <span class="token attr-name">element</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Welcome</span></span><span class="token punctuation">/></span></span><span class="token punctuation">&#125;</span></span><span class="token punctuation">/></span></span><span class="token plain-text"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Routes</span></span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>4ã€<App> æœ€å¤–ä¾§åŒ…è£¹ <BrowserRouter> - åŸºäºæµè§ˆå™¨è·¯ç”± æˆ– <HashRouter> - åŸºäºé”šç‚¹è·¯ç”±</p><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx">ReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">BrowserRouter</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">App</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">BrowserRouter</span></span><span class="token punctuation">></span></span><span class="token punctuation">,</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'root'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h1 id="é‡å®šå‘ä¸é»˜è®¤è·¯ç”±"><a class="markdownIt-Anchor" href="#é‡å®šå‘ä¸é»˜è®¤è·¯ç”±"></a> é‡å®šå‘ä¸é»˜è®¤è·¯ç”±</h1><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">HashRouter</span></span><span class="token punctuation">></span></span><span class="token plain-text">    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Routes</span></span><span class="token punctuation">></span></span><span class="token plain-text">        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Route</span></span> <span class="token attr-name">path</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/film<span class="token punctuation">"</span></span> <span class="token attr-name">element</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Film</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Film</span></span><span class="token punctuation">></span></span><span class="token punctuation">&#125;</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Route</span></span> <span class="token attr-name">path</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/cinema<span class="token punctuation">"</span></span> <span class="token attr-name">element</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Cinema</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Cinema</span></span><span class="token punctuation">></span></span><span class="token punctuation">&#125;</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Routes</span></span><span class="token punctuation">></span></span><span class="token plain-text"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">HashRouter</span></span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="ä½¿ç”¨-navigate-ç»„ä»¶å®ç°é‡å®šå‘"><a class="markdownIt-Anchor" href="#ä½¿ç”¨-navigate-ç»„ä»¶å®ç°é‡å®šå‘"></a> ä½¿ç”¨ Navigate ç»„ä»¶å®ç°é‡å®šå‘</h2><p>Navigate ä¸º React-router-dom æä¾›çš„</p><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Route</span></span> <span class="token attr-name">path</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>*<span class="token punctuation">"</span></span> <span class="token attr-name">element</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Navigate</span></span> <span class="token attr-name">to</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/film<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token punctuation">&#125;</span></span><span class="token punctuation">/></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="ä½¿ç”¨-redirect-ç»„ä»¶å®ç°é‡å®šå‘"><a class="markdownIt-Anchor" href="#ä½¿ç”¨-redirect-ç»„ä»¶å®ç°é‡å®šå‘"></a> ä½¿ç”¨ Redirect ç»„ä»¶å®ç°é‡å®šå‘</h2><p>Redirect éœ€è¦è‡ªè¡Œè®¾è®¡, é€šå¸¸é…åˆ useNavigate ä½¿ç”¨</p><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Route</span></span> <span class="token attr-name">path</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>*<span class="token punctuation">"</span></span> <span class="token attr-name">element</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Redirect</span></span> <span class="token attr-name">to</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/film<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><span class="token punctuation">&#125;</span></span> <span class="token punctuation">/></span></span><span class="token keyword">function</span> <span class="token function">Redirect</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">const</span> navigate <span class="token operator">=</span> <span class="token function">useNavigate</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>        <span class="token function">navigate</span><span class="token punctuation">(</span>props<span class="token punctuation">.</span>to<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> replace<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="é»˜è®¤åŒ¹é…å®ç°-404"><a class="markdownIt-Anchor" href="#é»˜è®¤åŒ¹é…å®ç°-404"></a> é»˜è®¤åŒ¹é…å®ç° 404</h2><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Route</span></span> <span class="token attr-name">path</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>*<span class="token punctuation">"</span></span> <span class="token attr-name">element</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">NotFound</span></span><span class="token punctuation">/></span></span><span class="token punctuation">&#125;</span></span> <span class="token punctuation">/></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h1 id="åµŒå¥—è·¯ç”±"><a class="markdownIt-Anchor" href="#åµŒå¥—è·¯ç”±"></a> åµŒå¥—è·¯ç”±</h1><ol><li>çˆ¶ç»„ä»¶ä¸­è¦ä½¿ç”¨ <code>&lt;Outlet&gt;&lt;/Outlet&gt;</code> è®¾ç½®å¥½è·¯ç”±å®¹å™¨</li></ol><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">Film</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token punctuation">(</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h3</span><span class="token punctuation">></span></span><span class="token plain-text"> Film </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h3</span><span class="token punctuation">></span></span><span class="token plain-text">            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">style</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span>height<span class="token operator">:</span> <span class="token string">"200px"</span><span class="token punctuation">,</span> background<span class="token operator">:</span> <span class="token string">"cyan"</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></span><span class="token punctuation">></span></span><span class="token plain-text"> å¤§è½®æ’­ </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">            </span><span class="token punctuation">&#123;</span><span class="token comment">/* è®¾ç½®å¥½è·¯ç”±å®¹å™¨, è¿™æ ·å¤šçº§è·¯ç”±ä¸å¿…åˆ†å¼€, æ–¹ä¾¿ç®¡ç† */</span><span class="token punctuation">&#125;</span><span class="token plain-text">            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Outlet</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Outlet</span></span><span class="token punctuation">></span></span><span class="token plain-text">        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>    <span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="2"><li>è·¯ç”±ç»„ä»¶ä¸­ç›´æ¥åµŒå¥—å†™å³å¯</li></ol><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Routes</span></span><span class="token punctuation">></span></span><span class="token plain-text">    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Route</span></span> <span class="token attr-name">path</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/film<span class="token punctuation">"</span></span> <span class="token attr-name">element</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Film</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Film</span></span><span class="token punctuation">></span></span><span class="token punctuation">&#125;</span></span> <span class="token punctuation">></span></span><span class="token plain-text">        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Route</span></span> <span class="token attr-name">path</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>nowplaying<span class="token punctuation">"</span></span> <span class="token attr-name">element</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Nowplaying</span></span><span class="token punctuation">/></span></span><span class="token punctuation">&#125;</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Route</span></span><span class="token punctuation">></span></span><span class="token plain-text">        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Route</span></span> <span class="token attr-name">path</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>comingsoon<span class="token punctuation">"</span></span> <span class="token attr-name">element</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Comingsoon</span></span><span class="token punctuation">/></span></span><span class="token punctuation">&#125;</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Route</span></span><span class="token punctuation">></span></span><span class="token plain-text">    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Route</span></span><span class="token punctuation">></span></span><span class="token plain-text">    ...</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Routes</span></span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="3"><li><code>index</code> é»˜è®¤åŒ¹é…åˆ°åªæä¾›äº†çˆ¶è·¯å¾„æ²¡æœ‰æä¾›å­è·¯å¾„çš„æƒ…å†µ; 404 çš„æƒ…å†µåªéœ€è¦åœ¨å¤–ä¾§ä½œä¸€å±‚å³å¯</li></ol><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Routes</span></span><span class="token punctuation">></span></span><span class="token plain-text">    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Route</span></span> <span class="token attr-name">path</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/film<span class="token punctuation">"</span></span> <span class="token attr-name">element</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Film</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Film</span></span><span class="token punctuation">></span></span><span class="token punctuation">&#125;</span></span> <span class="token punctuation">></span></span><span class="token plain-text">        </span><span class="token punctuation">&#123;</span><span class="token comment">/* æ²¡æœ‰åŒ¹é…åˆ°å­è·¯å¾„æ—¶ */</span><span class="token punctuation">&#125;</span><span class="token plain-text">        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Route</span></span> <span class="token attr-name">index</span> <span class="token attr-name">element</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Navigate</span></span> <span class="token attr-name">to</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/film/nowplaying<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token punctuation">&#125;</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Route</span></span><span class="token punctuation">></span></span><span class="token plain-text">        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Route</span></span> <span class="token attr-name">path</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>nowplaying<span class="token punctuation">"</span></span> <span class="token attr-name">element</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Nowplaying</span></span><span class="token punctuation">/></span></span><span class="token punctuation">&#125;</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Route</span></span><span class="token punctuation">></span></span><span class="token plain-text">        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Route</span></span> <span class="token attr-name">path</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>comingsoon<span class="token punctuation">"</span></span> <span class="token attr-name">element</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Comingsoon</span></span><span class="token punctuation">/></span></span><span class="token punctuation">&#125;</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Route</span></span><span class="token punctuation">></span></span><span class="token plain-text">    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Route</span></span><span class="token punctuation">></span></span><span class="token plain-text">    ...</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Routes</span></span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="å¯¼èˆª"><a class="markdownIt-Anchor" href="#å¯¼èˆª"></a> å¯¼èˆª</h1><h2 id="å£°æ˜å¼å¯¼èˆª"><a class="markdownIt-Anchor" href="#å£°æ˜å¼å¯¼èˆª"></a> å£°æ˜å¼å¯¼èˆª</h2><p>Link ä¸ NavLink</p><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>footer</span><span class="token punctuation">></span></span><span class="token plain-text">    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">></span></span><span class="token plain-text">        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">></span></span><span class="token plain-text"> </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">NavLink</span></span> <span class="token attr-name">to</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/film<span class="token punctuation">"</span></span> <span class="token attr-name">className</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span>handleJcActive<span class="token punctuation">&#125;</span></span><span class="token punctuation">></span></span><span class="token plain-text"> ç”µå½± </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">NavLink</span></span><span class="token punctuation">></span></span><span class="token plain-text"> </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span><span class="token plain-text">        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">></span></span><span class="token plain-text"> </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">NavLink</span></span> <span class="token attr-name">to</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/cinema<span class="token punctuation">"</span></span> <span class="token attr-name">className</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span>handleJcActive<span class="token punctuation">&#125;</span></span><span class="token punctuation">></span></span><span class="token plain-text"> å½±é™¢ </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">NavLink</span></span><span class="token punctuation">></span></span><span class="token plain-text"> </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span><span class="token plain-text">        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">></span></span><span class="token plain-text"> </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">NavLink</span></span> <span class="token attr-name">to</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/center<span class="token punctuation">"</span></span> <span class="token attr-name">className</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span>handleJcActive<span class="token punctuation">&#125;</span></span><span class="token punctuation">></span></span><span class="token plain-text"> æˆ‘çš„ </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">NavLink</span></span><span class="token punctuation">></span></span><span class="token plain-text"> </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span><span class="token plain-text">    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">></span></span><span class="token plain-text"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>footer</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>é»˜è®¤æƒ…å†µä¸‹ NavLink ä¼šç»™é€‰ä¸­çš„ç»„ä»¶æ·»åŠ  <code>active</code> çš„ className, ä½†æ˜¯å®¹æ˜“é‡å, å› æ­¤æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å…¶æä¾›çš„ className æ¥å£è¿›è¡Œæ›´æ”¹:</p><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx"><span class="token keyword">const</span> <span class="token function-variable function">handleJcActive</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span>props<span class="token punctuation">.</span>isActive<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token string">'jcActive'</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token string">''</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="ç¼–ç¨‹å¼å¯¼èˆª"><a class="markdownIt-Anchor" href="#ç¼–ç¨‹å¼å¯¼èˆª"></a> ç¼–ç¨‹å¼å¯¼èˆª</h2><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx"><span class="token keyword">const</span> navigate <span class="token operator">=</span> <span class="token function">useNavigate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">const</span> <span class="token function-variable function">hadleChangePage</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">id</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token function">navigate</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/detail?id=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>id<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h1 id="å¸¸ç”¨ç»„ä»¶"><a class="markdownIt-Anchor" href="#å¸¸ç”¨ç»„ä»¶"></a> å¸¸ç”¨ç»„ä»¶</h1><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx"><span class="token keyword">import</span> <span class="token punctuation">&#123;</span>Routes<span class="token punctuation">,</span> Route<span class="token punctuation">,</span> Redirect<span class="token punctuation">,</span> Link<span class="token punctuation">,</span> NavLink<span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'react-router-dom'</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="link"><a class="markdownIt-Anchor" href="#link"></a> Link</h2><p>Link ç»„ä»¶ç”¨äºå¯¼èˆªåŒºï¼Œå®ç°è·¯ç”±çš„å‘èµ·</p><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx"><span class="token keyword">import</span> <span class="token punctuation">&#123;</span>Link<span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'react-router-dom'</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Link</span></span> <span class="token attr-name">className</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token string">'list-group-item '</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>activeName <span class="token operator">===</span> <span class="token string">'About'</span> <span class="token operator">?</span> <span class="token string">'active'</span> <span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">)</span> <span class="token punctuation">&#125;</span></span> <span class="token attr-name">to</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/about<span class="token punctuation">"</span></span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setActive</span><span class="token punctuation">(</span><span class="token string">'About'</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token punctuation">></span></span><span class="token plain-text">About</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Link</span></span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="navlink"><a class="markdownIt-Anchor" href="#navlink"></a> NavLink</h2><p>é€šå¸¸ç”¨åˆ°çš„å°±æ˜¯å½“å‰å¯¼èˆªé¡¹çš„é«˜äº®ï¼Œå¯ä»¥é€šè¿‡ state ä¸ onClick è¿›è¡Œæ§åˆ¶åŠ¨æ€æ·»åŠ  active è¿™ä¸ª class å±æ€§</p><p>ä½†æ˜¯æ›´åŠ æ–¹ä¾¿çš„æ˜¯ç›´æ¥ä½¿ç”¨ NavLink è¿™ä¸ªç»„ä»¶ï¼Œé»˜è®¤æƒ…å†µä¸‹å®ƒè‡ªåŠ¨ç»™å½“å‰ç‚¹å‡»çš„ Link æ·»åŠ  active å±æ€§ï¼ˆåº”è¯¥æ˜¯é€šè¿‡è·¯ç”±åŒ¹é…ç»“æœæ¥é«˜äº®ç»„ä»¶ï¼‰ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ <code>activeClassName</code> å‚æ•°çš„ä¼ é€’æŒ‡å®šè‡ªåŠ¨æ·»åŠ çš„å±æ€§åç§°</p><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">NavLink</span></span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>list-group-item<span class="token punctuation">"</span></span> <span class="token attr-name">to</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/about<span class="token punctuation">"</span></span> <span class="token punctuation">></span></span><span class="token plain-text">About</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">NavLink</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">NavLink</span></span> <span class="token attr-name">activeClassName</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>redActive<span class="token punctuation">"</span></span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>list-group-item<span class="token punctuation">"</span></span> <span class="token attr-name">to</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/about<span class="token punctuation">"</span></span> <span class="token punctuation">></span></span><span class="token plain-text">About</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">NavLink</span></span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="äºŒæ¬¡å°è£…"><a class="markdownIt-Anchor" href="#äºŒæ¬¡å°è£…"></a> äºŒæ¬¡å°è£…</h3><p>æ›´è¿›ä¸€æ­¥çš„å¯ä»¥åˆ©ç”¨ç»„ä»¶äºŒæ¬¡å°è£…ä¸­æ‰€å­¦ï¼Œå°† NavLink ä¸­çš„å›ºå®šå­—æ®µè¿›è¡ŒäºŒæ¬¡å°è£…å¤„ç†</p><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx"><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// this.props ä¸­ä½¿ç”¨ children æ¥æ”¶ æ ‡ç­¾ä½“å†…å®¹ï¼Œå› æ­¤å¯ä»¥ç›´æ¥ä¼ é€’ç»™ NavLink çš„childå±æ€§ï¼Œå®ŒæˆäºŒæ¬¡å°è£…çš„ä¼˜ç§€å¯¹æ¥</span>    <span class="token keyword">return</span> <span class="token punctuation">(</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">NavLink</span></span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>list-group-item<span class="token punctuation">"</span></span> <span class="token spread"><span class="token punctuation">&#123;</span><span class="token operator">...</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">&#125;</span></span> <span class="token punctuation">/></span></span>    <span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="routes"><a class="markdownIt-Anchor" href="#routes"></a> Routes</h2><p>ç”¨äºåŒ…è£¹ä¼—å¤šè·¯ç”±ç»„ä»¶ <code>&lt;Route&gt;</code> å®ç°å¤š Route çš„å¿«é€ŸæŸ¥æ‰¾æ˜ å°„</p><p><strong>caseSensitive å±æ€§å®ç°è·¯ç”±å¤§å°å†™åŒºåˆ†</strong>ï¼šé»˜è®¤ä¸åŒºåˆ†å¤§å°å†™Tips: ä½†æ˜¯æˆ‘æµ‹è¯•æ—¶å¹¶æ²¡æœ‰æˆåŠŸï¼Œæ¯é¸¡</p><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Route</span></span> <span class="token attr-name">caseSensitive</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token boolean">true</span><span class="token punctuation">&#125;</span></span> <span class="token attr-name">path</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/about<span class="token punctuation">"</span></span> <span class="token attr-name">element</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">About</span></span><span class="token punctuation">/></span></span><span class="token punctuation">&#125;</span></span><span class="token punctuation">/></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="äºŒçº§è·¯ç”±"><a class="markdownIt-Anchor" href="#äºŒçº§è·¯ç”±"></a> äºŒçº§è·¯ç”±</h3><p>éœ€è¦æ˜ç¡®çš„æ˜¯äºŒçº§è·¯ç”±éœ€è¦é€šè¿‡ä¸€çº§è·¯ç”±çš„åŒ¹é…æ‰èƒ½è®¿é—®ï¼Œå› æ­¤ä»¥åŠè·¯ç”±é€šå¸¸è®¾å®šä¸º <code>/pagename/*</code> çš„å½¢å¼è¿™æ ·æ‰èƒ½è®¿é—®äºŒçº§è·¯ç”± <code>/pagename/pageone</code></p><p>v6 ä¸­ä¼šå¯¹äºŒçº§è·¯ç”±çš„å‰ç¼€è¿›è¡Œè‡ªåŠ¨æ‹¼æ¥ï¼Œå› æ­¤å†™è€³æœºè·¯ç”±æ—¶ä¸å¿…åŠ ä¸Šå‰ç¼€</p><p>Exampleï¼šä¸€çº§è·¯ç”±å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Routes</span></span><span class="token punctuation">></span></span><span class="token plain-text">    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Route</span></span> <span class="token attr-name">path</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/about<span class="token punctuation">"</span></span> <span class="token attr-name">element</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">About</span></span><span class="token punctuation">/></span></span><span class="token punctuation">&#125;</span></span><span class="token punctuation">/></span></span><span class="token plain-text">    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Route</span></span> <span class="token attr-name">path</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/home/*<span class="token punctuation">"</span></span> <span class="token attr-name">element</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Home</span></span><span class="token punctuation">/></span></span><span class="token punctuation">&#125;</span></span><span class="token punctuation">/></span></span><span class="token plain-text">    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Route</span></span> <span class="token attr-name">path</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>*<span class="token punctuation">"</span></span> <span class="token attr-name">element</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Welcome</span></span><span class="token punctuation">/></span></span><span class="token punctuation">&#125;</span></span><span class="token punctuation">/></span></span><span class="token plain-text"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Routes</span></span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è€³æœº <code>/home/*</code> è·¯ç”±å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Routes</span></span><span class="token punctuation">></span></span><span class="token plain-text">    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Route</span></span> <span class="token attr-name">path</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/news<span class="token punctuation">"</span></span> <span class="token attr-name">element</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">News</span></span><span class="token punctuation">/></span></span><span class="token punctuation">&#125;</span></span><span class="token punctuation">/></span></span><span class="token plain-text">    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Route</span></span> <span class="token attr-name">path</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/message<span class="token punctuation">"</span></span> <span class="token attr-name">element</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Message</span></span><span class="token punctuation">/></span></span><span class="token punctuation">&#125;</span></span><span class="token punctuation">/></span></span><span class="token plain-text">    </span><span class="token punctuation">&#123;</span><span class="token comment">/* ä½¿ç”¨è·³è½¬å®ç° NavLink çš„é»˜è®¤é€‰ä¸­åŠŸèƒ½ */</span><span class="token punctuation">&#125;</span><span class="token plain-text">    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Route</span></span> <span class="token attr-name">path</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>*<span class="token punctuation">"</span></span> <span class="token attr-name">element</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Navigate</span></span> <span class="token attr-name">to</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/home/news<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token punctuation">&#125;</span></span><span class="token punctuation">/></span></span><span class="token plain-text"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Routes</span></span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="é»˜è®¤è·¯ç”±"><a class="markdownIt-Anchor" href="#é»˜è®¤è·¯ç”±"></a> é»˜è®¤è·¯ç”±</h3><p>é»˜è®¤è·¯ç”±ï¼šåœ¨ Routes ä¸­åŒ¹é…æœªæ‰¾åˆ°åŒ¹é…å­—æ®µæ—¶çš„ç¼ºçœå¤„ç†ï¼Œé€šå¸¸è®¾ç½® <code>path=&quot;*&quot;</code> æ¥å®ç°</p><p>åœ¨ <code>&lt;Routes&gt;</code> ä¸­åŒ¹é…è·¯ç”±æ—¶ï¼Œå¦‚æœå‰é¢çš„ <code>&lt;Route&gt;</code> éƒ½æ²¡æœ‰åŒ¹é…ä¸Šï¼Œæœ€åå°±ä¼šèµ° å¸¦æœ‰ index å±æ€§çš„è·¯ç”±` ï¼ˆå¦‚æœé…ç½®äº†çš„è¯ï¼‰</p><p>è¿™ä¸ªåœ¨æˆ‘ä¹‹å‰è‡ªå·±è®¾ç½®æ—¶è€ƒè™‘åˆ°äº†ï¼Œæˆ‘æƒ³é»˜è®¤è®©ä»–è·¯ç”±åˆ° <Welcome/> ç»„ä»¶ä¹Ÿå°±æ˜¯å¯¹ <code>/</code> è¿›è¡Œè·¯ç”±</p><blockquote><p>æ·»åŠ  <code>/welcome</code> è·¯ç”±çš„åŸå› æ˜¯ï¼Œ<Welcome/> ä¹Ÿæ˜¯ä¸ªé¡µé¢ï¼Œç”¨æˆ·å¯å®šèƒ½é€šè¿‡æŸä¸ªäº¤äº’å» Welcomeï¼Œå› æ­¤ç”¨æˆ·ä¸»åŠ¨å»çš„æ—¶å€™æ€»ä¸èƒ½è®©ä»–çš„ url è¿˜æ˜¯ <code>/</code> å§</p></blockquote><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Routes</span></span><span class="token punctuation">></span></span><span class="token plain-text">    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Route</span></span> <span class="token attr-name">path</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/about<span class="token punctuation">"</span></span> <span class="token attr-name">element</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">About</span></span><span class="token punctuation">/></span></span><span class="token punctuation">&#125;</span></span><span class="token punctuation">/></span></span><span class="token plain-text">    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Route</span></span> <span class="token attr-name">path</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/home<span class="token punctuation">"</span></span> <span class="token attr-name">element</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Home</span></span><span class="token punctuation">/></span></span><span class="token punctuation">&#125;</span></span><span class="token punctuation">/></span></span><span class="token plain-text">    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Route</span></span> <span class="token attr-name">path</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/<span class="token punctuation">"</span></span> <span class="token attr-name">element</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Welcome</span></span><span class="token punctuation">/></span></span><span class="token punctuation">&#125;</span></span><span class="token punctuation">/></span></span><span class="token plain-text">    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Route</span></span> <span class="token attr-name">path</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/welcome<span class="token punctuation">"</span></span> <span class="token attr-name">element</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Welcome</span></span><span class="token punctuation">/></span></span><span class="token punctuation">&#125;</span></span><span class="token punctuation">/></span></span><span class="token plain-text"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Routes</span></span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä½†æ˜¯ä½¿ç”¨ <code>path=&quot;*&quot;</code> ä¼šè®©ç”¨æˆ·æœ‰æ›´å¥½çš„ä½“éªŒ</p><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Routes</span></span><span class="token punctuation">></span></span><span class="token plain-text">    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Route</span></span> <span class="token attr-name">path</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/about<span class="token punctuation">"</span></span> <span class="token attr-name">element</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">About</span></span><span class="token punctuation">/></span></span><span class="token punctuation">&#125;</span></span><span class="token punctuation">/></span></span><span class="token plain-text">    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Route</span></span> <span class="token attr-name">path</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/home/*<span class="token punctuation">"</span></span> <span class="token attr-name">element</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Home</span></span><span class="token punctuation">/></span></span><span class="token punctuation">&#125;</span></span><span class="token punctuation">/></span></span><span class="token plain-text">    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Route</span></span> <span class="token attr-name">path</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>*<span class="token punctuation">"</span></span> <span class="token attr-name">element</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Welcome</span></span><span class="token punctuation">/></span></span><span class="token punctuation">&#125;</span></span><span class="token punctuation">/></span></span><span class="token plain-text"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Routes</span></span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="é‡å®šå‘"><a class="markdownIt-Anchor" href="#é‡å®šå‘"></a> é‡å®šå‘</h3><p>é»˜è®¤è·¯ç”±ä¹Ÿå¯ä»¥å’Œé‡å®šå‘é…åˆä½¿ç”¨ï¼šå½“ç”¨æˆ·è®¿é—®äº†æŸä¸€ä¸å­˜åœ¨çš„èµ„æºæ—¶éƒ½é‡å®šå‘åˆ°åŒä¸€ä¸ªåœ°æ–¹ï¼Œè¿™å°†é€šè¿‡ Navigate ç»„ä»¶ä»¥åŠ to å±æ€§å®ç°</p><blockquote><p>Tipsï¼što å±æ€§çš„å€¼ä¸å—äºŒçº§è·¯ç”±çš„å½±å“å“¦</p></blockquote><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Routes</span></span><span class="token punctuation">></span></span><span class="token plain-text">    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Route</span></span> <span class="token attr-name">path</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/news<span class="token punctuation">"</span></span> <span class="token attr-name">element</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">News</span></span><span class="token punctuation">/></span></span><span class="token punctuation">&#125;</span></span><span class="token punctuation">/></span></span><span class="token plain-text">    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Route</span></span> <span class="token attr-name">path</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/message<span class="token punctuation">"</span></span> <span class="token attr-name">element</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Message</span></span><span class="token punctuation">/></span></span><span class="token punctuation">&#125;</span></span><span class="token punctuation">/></span></span><span class="token plain-text">    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Route</span></span> <span class="token attr-name">path</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>*<span class="token punctuation">"</span></span> <span class="token attr-name">element</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Navigate</span></span> <span class="token attr-name">to</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/home/news<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token punctuation">&#125;</span></span><span class="token punctuation">/></span></span><span class="token plain-text"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Routes</span></span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="index-å±æ€§"><a class="markdownIt-Anchor" href="#index-å±æ€§"></a> index å±æ€§</h3><p><strong>index å±æ€§å®ç°é»˜è®¤è·¯ç”±ï¼š</strong></p><p>åœ¨ <code>&lt;Routes&gt;</code> ä¸­åŒ¹é…è·¯ç”±æ—¶ï¼Œå¦‚æœå‰é¢çš„ <code>&lt;Route&gt;</code> éƒ½æ²¡æœ‰åŒ¹é…ä¸Šï¼Œæœ€åå°±ä¼šèµ° å¸¦æœ‰ index å±æ€§çš„è·¯ç”±` ï¼ˆå¦‚æœé…ç½®äº†çš„è¯ï¼‰</p><p>è¿™ä¸ªåœ¨æˆ‘ä¹‹å‰è‡ªå·±è®¾ç½®æ—¶è€ƒè™‘åˆ°äº†ï¼Œæˆ‘æƒ³é»˜è®¤è®©ä»–è·¯ç”±åˆ° <Welcome/> ç»„ä»¶ä¹Ÿå°±æ˜¯å¯¹ <code>/</code> è¿›è¡Œè·¯ç”±</p><blockquote><p>æ·»åŠ  <code>/welcome</code> è·¯ç”±çš„åŸå› æ˜¯ï¼Œ<Welcome/> ä¹Ÿæ˜¯ä¸ªé¡µé¢ï¼Œç”¨æˆ·å¯å®šèƒ½é€šè¿‡æŸä¸ªäº¤äº’å» Welcomeï¼Œå› æ­¤ç”¨æˆ·ä¸»åŠ¨å»çš„æ—¶å€™æ€»ä¸èƒ½è®©ä»–çš„ url è¿˜æ˜¯ <code>/</code> å§</p></blockquote><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Routes</span></span><span class="token punctuation">></span></span><span class="token plain-text">    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Route</span></span> <span class="token attr-name">path</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/about<span class="token punctuation">"</span></span> <span class="token attr-name">element</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">About</span></span><span class="token punctuation">/></span></span><span class="token punctuation">&#125;</span></span><span class="token punctuation">/></span></span><span class="token plain-text">    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Route</span></span> <span class="token attr-name">path</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/home<span class="token punctuation">"</span></span> <span class="token attr-name">element</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Home</span></span><span class="token punctuation">/></span></span><span class="token punctuation">&#125;</span></span><span class="token punctuation">/></span></span><span class="token plain-text">    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Route</span></span> <span class="token attr-name">path</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/<span class="token punctuation">"</span></span> <span class="token attr-name">element</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Welcome</span></span><span class="token punctuation">/></span></span><span class="token punctuation">&#125;</span></span><span class="token punctuation">/></span></span><span class="token plain-text">    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Route</span></span> <span class="token attr-name">path</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/welcome<span class="token punctuation">"</span></span> <span class="token attr-name">element</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Welcome</span></span><span class="token punctuation">/></span></span><span class="token punctuation">&#125;</span></span><span class="token punctuation">/></span></span><span class="token plain-text"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Routes</span></span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¼•å…¥ index å±æ€§åä¸€åˆ‡éƒ½ç®€å•äº†</p><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Routes</span></span><span class="token punctuation">></span></span><span class="token plain-text">    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Route</span></span> <span class="token attr-name">caseSensitive</span> <span class="token attr-name">path</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/about<span class="token punctuation">"</span></span> <span class="token attr-name">element</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">About</span></span><span class="token punctuation">/></span></span><span class="token punctuation">&#125;</span></span><span class="token punctuation">/></span></span><span class="token plain-text">    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Route</span></span> <span class="token attr-name">path</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/home<span class="token punctuation">"</span></span> <span class="token attr-name">element</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Home</span></span><span class="token punctuation">/></span></span><span class="token punctuation">&#125;</span></span><span class="token punctuation">/></span></span><span class="token plain-text">    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Route</span></span> <span class="token attr-name">index</span> <span class="token attr-name">element</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Welcome</span></span><span class="token punctuation">/></span></span><span class="token punctuation">&#125;</span></span><span class="token punctuation">/></span></span><span class="token plain-text"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Routes</span></span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>ç„¶åä»å®‰å…¨è§’åº¦æƒ³æƒ³ï¼šå¯ä»¥é€šè¿‡åˆ¤æ–­é¡µé¢æ˜¯å¦ä¸º <Welcome/> æ¥ç”¨å­—å…¸æ‰«æèµ„æºå¥¥ï¼Œå…¶å®ä¹Ÿæ— ä¼¤å¤§é›…ï¼Œå› ä¸ºè¿™ä»…ä»…æ˜¯å¯¹ä¸å­˜åœ¨çš„èµ„æºçš„ä¸€ä¸ªé»˜è®¤å¤„ç†ï¼Œè¿˜éœ€è¦ä»æµé‡è§’åº¦è§£å†³è¿™ä¸ªçˆ†ç ´é—®é¢˜</p></blockquote><h2 id="å¸¸è§é—®é¢˜"><a class="markdownIt-Anchor" href="#å¸¸è§é—®é¢˜"></a> å¸¸è§é—®é¢˜</h2><h3 id="é™æ€æ ·å¼ä¸¢å¤±é—®é¢˜"><a class="markdownIt-Anchor" href="#é™æ€æ ·å¼ä¸¢å¤±é—®é¢˜"></a> é™æ€æ ·å¼ä¸¢å¤±é—®é¢˜</h3><p>æ ·å¼å¼•å…¥æ—¶ä¸èƒ½ä»¥å½“å‰ç›¸å¯¹è·¯å¾„æ¥å¼•å…¥ï¼Œè·¯ç”±æœºåˆ¶ä¼šå¯¼è‡´èµ„æºæ‰¾ä¸åˆ°</p><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>stylesheet<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>./css/bootstrap.css<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>è§£å†³æ–¹æ³•æœ‰ä¸‰ï¼š</p><p>1ã€<code>href=&quot;%PUBLIC_URL%/css/bootstrap.css&quot;</code> ä½¿ç”¨ <code>%PUBLIC_URL%</code> æ„é€ ç»å¯¹è·¯å¾„å¼•å…¥ public ä¸‹èµ„æºæ–‡ä»¶</p><p>2ã€<code>href=&quot;/css/bootstrap.css&quot;</code> ä½¿ç”¨ <code>/</code> ä»¥æ ¹è·¯å¾„å½¢å¼è®¿é—®</p><p>3ã€ä½¿ç”¨ <code>&lt;HashRouter&gt;</code> é”šè·¯ç”±è¢« <code>#</code> éš”ç¦»äº†æ­£å¸¸çš„ url ä¸ä¼šå¯¹ç›¸å¯¹è·¯å¾„äº§ç”Ÿå½±å“äº†ï¼ˆä¸æ¨èï¼‰</p><h2 id="è·¯ç”±çš„åŒ¹é…æœºåˆ¶"><a class="markdownIt-Anchor" href="#è·¯ç”±çš„åŒ¹é…æœºåˆ¶"></a> è·¯ç”±çš„åŒ¹é…æœºåˆ¶</h2><p>V6 ä¸­æ²¡æœ‰è¿™ä¸ªæ¦‚å¿µäº†ï¼Œä¸‹é¢å°±ç®€å•è®°å½•ä¸‹å†å²å§...</p><h3 id="æ¨¡ç³ŠåŒ¹é…"><a class="markdownIt-Anchor" href="#æ¨¡ç³ŠåŒ¹é…"></a> æ¨¡ç³ŠåŒ¹é…</h3><p>é»˜è®¤æƒ…å†µä¸ºæ¨¡ç³ŠåŒ¹é…ï¼Œåªéœ€è¦åŒ¹é…åˆ°å‰ç¼€å³å¯</p><h3 id="ä¸¥æ ¼åŒ¹é…"><a class="markdownIt-Anchor" href="#ä¸¥æ ¼åŒ¹é…"></a> ä¸¥æ ¼åŒ¹é…</h3><p>å°±æ˜¯å®Œå…¨ä¸€è‡´ï¼Œåœ¨ Routes ä¸­ä»ä¸Šåˆ°å°æ‰¾ï¼ŒåŒ¹é…åˆ°å°±æ¸²æŸ“ï¼ŒåŒ¹é…ä¸åˆ°å°±ç©º</p><h2 id="äºŒçº§è·¯ç”±-2"><a class="markdownIt-Anchor" href="#äºŒçº§è·¯ç”±-2"></a> äºŒçº§è·¯ç”±</h2><p><img src="https://gitee.com/Butterflier/pictures/raw/master/20211204213135.png" alt="äºŒçº§è·¯ç”±" /></p><h1 id="å‚æ•°ä¼ é€’"><a class="markdownIt-Anchor" href="#å‚æ•°ä¼ é€’"></a> å‚æ•°ä¼ é€’</h1><h2 id="params"><a class="markdownIt-Anchor" href="#params"></a> params</h2><p>åªèƒ½ä¼ å­—ç¬¦ä¸², ä¼ å€¼è¿‡å¤š url ä¼šå˜å¾—å¾ˆé•¿, å‚æ•°å¿…é¡»åœ¨è·¯ç”±ä¸Šé…ç½®</p><p>å‚æ•°ç»‘å®šåœ¨ url ä¸Šï¼Œåˆ·æ–°é¡µé¢ï¼Œå‚æ•°ä¸ä¸¢å¤±</p><p>1ã€é€šè¿‡ <code>url</code> ä¼ é€’å‚æ•°</p><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">MyNavLink</span></span> <span class="token attr-name">to</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/paramsSend/cjc/123456<span class="token punctuation">"</span></span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setActive</span><span class="token punctuation">(</span><span class="token string">'paramsSend'</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token punctuation">></span></span><span class="token plain-text">paramsSend</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">MyNavLink</span></span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>2ã€åŒ¹é…è·¯ç”±æ—¶å®šä¹‰å¥½å‚æ•°æ¨¡å¼ - åŠ¨æ€è·¯ç”±</p><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Route</span></span> <span class="token attr-name">path</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/paramsSend/:user/:pwd<span class="token punctuation">"</span></span> <span class="token attr-name">element</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">ParamsSend</span></span><span class="token punctuation">/></span></span><span class="token punctuation">&#125;</span></span><span class="token punctuation">/></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>3ã€å¼•å…¥ <code>useParams</code> è·å–å‚æ•°</p><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx"><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> useParams <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'react-router-dom'</span><span class="token punctuation">;</span><span class="token keyword">const</span> params <span class="token operator">=</span> <span class="token function">useParams</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span><span class="token plain-text">ç”¨æˆ·åï¼š</span><span class="token punctuation">&#123;</span>params<span class="token punctuation">.</span>user<span class="token punctuation">&#125;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span><span class="token plain-text">å¯†ç ï¼š</span><span class="token punctuation">&#123;</span>params<span class="token punctuation">.</span>pwd<span class="token punctuation">&#125;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h2 id="search-ä¼ å‚"><a class="markdownIt-Anchor" href="#search-ä¼ å‚"></a> search ä¼ å‚</h2><p>ä¼˜ç‚¹ï¼šåˆ·æ–°é¡µé¢ï¼Œå‚æ•°ä¸ä¸¢å¤±</p><p>ç¼ºç‚¹ï¼šåªèƒ½ä¼ å­—ç¬¦ä¸²ï¼Œä¼ å€¼è¿‡å¤šurlä¼šå˜å¾—å¾ˆé•¿ï¼Œè·å–å‚æ•°éœ€è¦è‡ªå®šä¹‰hooks</p><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx"><span class="token keyword">const</span> <span class="token punctuation">[</span>searchParams<span class="token punctuation">,</span> setSearchParams<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useSearchParams</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">if</span><span class="token punctuation">(</span>searchParams<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span><span class="token string">"username"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">const</span> username <span class="token operator">=</span> searchParams<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"username"</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h1 id="åŠ¨æ€è·¯ç”±"><a class="markdownIt-Anchor" href="#åŠ¨æ€è·¯ç”±"></a> åŠ¨æ€è·¯ç”±</h1><p>æ¶‰åŠåˆ°ç”¨ä¸€ä¸ªç»„ä»¶å±•ç¤ºç›¸åŒé¡µé¢çš„ä¸åŒå†…å®¹, è¿™æ—¶å€™å°±éœ€è¦åŠ¨æ€è·¯ç”±è¿›è¡ŒåŒ¹é…</p><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Route</span></span> <span class="token attr-name">path</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/detail/:myid<span class="token punctuation">"</span></span> <span class="token attr-name">element</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Detail</span></span><span class="token punctuation">/></span></span><span class="token punctuation">&#125;</span></span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>åŠ¨æ€è·¯ç”±çš„å‚æ•°è·å–å°±æ˜¯ params å‚æ•°çš„è·å–å½¢å¼</p><h1 id="è·¯ç”±æ‹¦æˆª"><a class="markdownIt-Anchor" href="#è·¯ç”±æ‹¦æˆª"></a> è·¯ç”±æ‹¦æˆª</h1><p>æœªç™»å½•çš„æƒ…å†µä¸‹, å¤šä¸ªé¡µé¢çš„è·¯ç”±éœ€è¦æ‹¦æˆªå¹¶é‡å®šå‘åˆ°ç™»é™†ç•Œé¢</p><p>ä¸€ç§å®ç°æ–¹å¼å°±æ˜¯è‡ªå·±å†™å¥½çŠ¶æ€åˆ¤æ–­å‡½æ•°, ç„¶ååœ¨è·¯ç”±åŒ¹é…åæ¸²æŸ“æ—¶æ ¹æ®çŠ¶æ€é€‰æ‹©æ¸²æŸ“</p><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Route</span></span> <span class="token attr-name">path</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/center<span class="token punctuation">"</span></span> <span class="token attr-name">element</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token function">isAuth</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Center</span></span><span class="token punctuation">/></span></span> <span class="token operator">:</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Redirect</span></span> <span class="token attr-name">to</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/login<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token punctuation">&#125;</span></span> <span class="token punctuation">/></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ä½†æ˜¯è¿™æ ·æ²¡æœ‰å’Œç»„ä»¶ç»‘å®š, å¯¼è‡´å…¶å†…å®¹ä¸ä¼šæ”¹å˜, å› æ­¤è¦ç”¨ä¸€ä¸ªç»„ä»¶å°è£…è¯¥é€»è¾‘, å† <code>AuthComponent</code> å†…éƒ¨åˆ¤æ–­æ˜¯å¦å±•ç¤º <code>this.props.children</code></p><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Route</span></span> <span class="token attr-name">path</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/center<span class="token punctuation">"</span></span> <span class="token attr-name">element</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">AuthComponent</span></span><span class="token punctuation">></span></span><span class="token plain-text">    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Center</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Center</span></span><span class="token punctuation">></span></span><span class="token plain-text"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">AuthComponent</span></span><span class="token punctuation">></span></span><span class="token punctuation">&#125;</span></span> <span class="token punctuation">/></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h1 id="withrouter-è®¨è®º"><a class="markdownIt-Anchor" href="#withrouter-è®¨è®º"></a> withRouter è®¨è®º</h1><p>å‡¡æ˜¯è¢« <Route> åŒ…è£¹çš„ç»„ä»¶éƒ½ä¼šæœ‰ä¸€ä¸ª <code>history</code> çš„å±æ€§, ä½†æ˜¯è¿™ä¸ªå±æ€§ä¸èƒ½è‡ªåŠ¨ä¼ é€’ç»™å…¶å­ç»„ä»¶, å› æ­¤å¼•å…¥ <code>withRouter</code> å°†è¿™ä¸ªå±æ€§ä¼ é€’ç»™å­ç»„ä»¶</p><p>ä½†æ˜¯ç°åœ¨æœ‰ <code>useNavigate</code> withRouter å† v6 å°±ä¸å¿…è¦äº†</p><p>å¦‚æœè¦ä½¿ç”¨ç±»ç»„ä»¶é‚£ä¹ˆå°±éœ€è¦è‡ªè¡Œå°è£…ä¸€ä¸ª withRouter ç»„ä»¶</p><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx"><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> useNavigate <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'react-router-dom'</span><span class="token keyword">function</span> <span class="token function">withRouter</span><span class="token punctuation">(</span><span class="token parameter">Component</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">const</span> push <span class="token operator">=</span> <span class="token function">useNavigate</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Component</span></span> <span class="token spread"><span class="token punctuation">&#123;</span><span class="token operator">...</span>props<span class="token punctuation">&#125;</span></span> <span class="token attr-name">history</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span>push<span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></span><span class="token punctuation">/></span></span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="è·¯ç”±æ‡’åŠ è½½"><a class="markdownIt-Anchor" href="#è·¯ç”±æ‡’åŠ è½½"></a> è·¯ç”±æ‡’åŠ è½½</h1><p>è·¯ç”±æ¡ç›®å¤ªå¤š, å¯¼è‡´åŠ è½½æ‹¥å¡; è·¯ç”±æ‡’åŠ è½½å°†å®ç°æŒ‰éœ€åŠ è½½è·¯ç”±</p><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx"><span class="token keyword">const</span> <span class="token function-variable function">LazyLoad</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">path</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">const</span> Comp <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">lazy</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">../views/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>path<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> <span class="token punctuation">(</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">React.Suspense</span></span> <span class="token attr-name">fallback</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span></span><span class="token punctuation">></span></span><span class="token plain-text"> Loading... </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span></span><span class="token punctuation">></span></span><span class="token punctuation">&#125;</span></span><span class="token punctuation">></span></span><span class="token plain-text">            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Comp</span></span><span class="token punctuation">/></span></span><span class="token plain-text">        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">React.Suspense</span></span><span class="token punctuation">></span></span>    <span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Route</span></span> <span class="token attr-name">path</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/cinema<span class="token punctuation">"</span></span> <span class="token attr-name">element</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token function">LazyLoad</span><span class="token punctuation">(</span><span class="token string">"Cinema"</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span> <span class="token punctuation">/></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h1 id="useroutes-é’©å­é…ç½®è·¯ç”±"><a class="markdownIt-Anchor" href="#useroutes-é’©å­é…ç½®è·¯ç”±"></a> useRoutes é’©å­é…ç½®è·¯ç”±</h1><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">JCRouter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">const</span> element <span class="token operator">=</span> <span class="token function">useRoutes</span><span class="token punctuation">(</span><span class="token punctuation">[</span>        <span class="token punctuation">&#123;</span>            path<span class="token operator">:</span> <span class="token string">"/film"</span><span class="token punctuation">,</span>            element<span class="token operator">:</span> <span class="token function">LazyLoad</span><span class="token punctuation">(</span><span class="token string">"Film"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            children<span class="token operator">:</span> <span class="token punctuation">[</span>                <span class="token punctuation">&#123;</span>                    path<span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>                    element<span class="token operator">:</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Redirect</span></span> <span class="token attr-name">to</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/film/nowplaying<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>                <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>                <span class="token punctuation">&#123;</span>                    path<span class="token operator">:</span> <span class="token string">"nowplaying"</span><span class="token punctuation">,</span>                    element<span class="token operator">:</span> <span class="token function">LazyLoad</span><span class="token punctuation">(</span><span class="token string">"film/Nowplaying"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>                <span class="token punctuation">&#123;</span>                    path<span class="token operator">:</span> <span class="token string">"comingsoon"</span><span class="token punctuation">,</span>                    element<span class="token operator">:</span> <span class="token function">LazyLoad</span><span class="token punctuation">(</span><span class="token string">"film/Comingsoon"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>            <span class="token punctuation">]</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>        <span class="token punctuation">&#123;</span>            path<span class="token operator">:</span> <span class="token string">"/cinema"</span><span class="token punctuation">,</span>            element<span class="token operator">:</span> <span class="token function">LazyLoad</span><span class="token punctuation">(</span><span class="token string">"Cinema"</span><span class="token punctuation">)</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>    <span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> <span class="token punctuation">(</span>        element    <span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> React </category>
          
      </categories>
      
      
        <tags>
            
            <tag> react </tag>
            
            <tag> react components </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SSL/TLS Protocol and Security</title>
      <link href="/Coming-blog/2021/12/04/ssl-tls-protocol-and-security/"/>
      <url>/Coming-blog/2021/12/04/ssl-tls-protocol-and-security/</url>
      
        <content type="html"><![CDATA[<h1 id="ä¼ è¾“å±‚å®‰å…¨åè®®-ssltls"><a class="markdownIt-Anchor" href="#ä¼ è¾“å±‚å®‰å…¨åè®®-ssltls"></a> ä¼ è¾“å±‚å®‰å…¨åè®® SSL/TLS</h1><p>HTTPS = HTTP + SSL/TLS</p><h2 id="ssl-tls-ç®€è¿°"><a class="markdownIt-Anchor" href="#ssl-tls-ç®€è¿°"></a> SSL / TLS ç®€è¿°</h2><p>SSLï¼ŒSecure Socket Layerï¼Œå®‰å…¨å¥—æ¥å­—ï¼ˆIP åœ°å€ + ç«¯å£ï¼‰å±‚ï¼Œæ˜¯ä¸€ç§åœ¨ TCP åè®®ä¹‹ä¸Šä¸ºä¸¤ä¸ªåº”ç”¨å±‚ç«¯å®ä½“ï¼ˆEnd Entityï¼‰ä¹‹é—´æä¾›å®‰å…¨é€šé“çš„åè®®ï¼Œåˆ©ç”¨æ•°æ®åŠ å¯†æŠ€æœ¯ç¡®ä¿æ•°æ®åœ¨ç½‘ç»œä¸Šä¼ è¾“è¿‡ç¨‹ä¸­ä¸ä¼šè¢«çªƒå–æˆ–ç¯¡æ”¹</p><p>TLSï¼ŒTransport Layer Securityï¼Œä¼ è¾“å±‚å®‰å…¨åè®®ï¼Œç”¨äºä¸¤ä¸ªåº”ç”¨ç¨‹åºä¹‹é—´æä¾›ä¿å¯†æ€§å’Œæ•°æ®å®Œæ•´æ€§</p><blockquote><p>é€šå¸¸æ¥è®² SSL ä¸ TLS æ˜¯ä¸€ä¸ªä¸œè¥¿ï¼Œå› ä¸º SSL æ˜¯ä¼ä¸šæå‡ºçš„ï¼Œæ‰€ä»¥ TLS 1.0 æ‰æ˜¯ IETF åˆ¶å®šçš„ SSL çš„äº’è”ç½‘æ ‡å‡†ç‰ˆæœ¬ï¼Œå½“æ—¶çš„ SSL ç‰ˆæœ¬æ˜¯ 3.0ï¼Œå› æ­¤ TLS v1 ä¸ SSL v3 çš„å·®åˆ«éå¸¸å¾®å°</p></blockquote><h2 id="ipsec-ä¸-ssl"><a class="markdownIt-Anchor" href="#ipsec-ä¸-ssl"></a> IPSec ä¸ SSL</h2><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/20211204183341.png" alt="IPSec ä¸ SSL" /></p><p>è°æ›´å®‰å…¨ï¼Ÿ</p><p>å®‰å…¨å¯ä»¥ä» CIAï¼ˆæœºå¯†æ€§ï¼Œå®Œæ•´æ€§ï¼Œå¯ç”¨æ€§ï¼‰ï¼Œä¸å¯æŠµèµ–æ€§ï¼Œå¯æ§æ€§ è¿™äº”ä¸ªç»´åº¦æ¥è¯„ä»·ä¸‹ï¼ŒIPSec ä¸ SSL éƒ½èƒ½ä¿è¯æœºå¯†æ€§ï¼Œå®Œæ•´æ€§ï¼Œä¸å¯æŠµèµ–æ€§ï¼ˆç§é’¥ç­¾åä¸å…¬é’¥éªŒè¯ï¼‰</p><p>ä½†æ˜¯ä¸åŒçš„æ˜¯ IPSec åœ¨ç½‘ç»œå±‚ï¼ŒSSL åœ¨åº”ç”¨å±‚ï¼Œå› ä¸º TCP åè®®æ›´ä¸ºå¤æ‚ï¼Œæ‰€ä»¥ TCP å®‰å…¨å¨èƒä¹Ÿè¾ƒå¤šï¼Œå› æ­¤å¾ˆå¤šå¯¹ TCP çš„æ”»å‡»éƒ½å°†ä¼šå½±å“åˆ° SSL çš„å¯ç”¨æ€§ä¸å¯æ§æ€§ï¼Œå› æ­¤å·¥ä½œåœ¨è¾ƒå¯é çš„ IP ä¸Šçš„ IPSec æ›´ä¸ºå®‰å…¨</p><h2 id="ssl-æä¾›çš„å®‰å…¨æœåŠ¡"><a class="markdownIt-Anchor" href="#ssl-æä¾›çš„å®‰å…¨æœåŠ¡"></a> SSL æä¾›çš„å®‰å…¨æœåŠ¡</h2><p>SSL åŸºäºèº«ä»½è®¤è¯ï¼Œæœºå¯†æ€§ä¸å®Œæ•´æ€§å®‰å…¨æœåŠ¡å»ºç«‹æœåŠ¡å™¨ä¸å®¢æˆ·ç«¯ä¹‹é—´çš„å®‰å…¨æ•°æ®é€šé“</p><h3 id="èº«ä»½è®¤è¯"><a class="markdownIt-Anchor" href="#èº«ä»½è®¤è¯"></a> èº«ä»½è®¤è¯</h3><p>åˆ©ç”¨æ•°å­—è¯ä¹¦æŠ€æœ¯å’Œå¯ä¿¡ä»»çš„ç¬¬ä¸‰æ–¹è®¤è¯æœºæ„ï¼Œä¸ºå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„é€šä¿¡æä¾›èº«ä»½è®¤è¯åŠŸèƒ½ï¼Œä»¥ä¾¿äºå½¼æ­¤ä¹‹é—´è¿›è¡Œèº«ä»½è¯†åˆ«</p><p>1ã€ä½¿ç”¨ X.509 v3  æ•°å­—è¯ä¹¦</p><p>2ã€å®¢æˆ·å¯¹æœåŠ¡å™¨çš„èº«ä»½è®¤è¯ï¼šä½¿ç”¨æ ‡å‡†çš„å…¬é’¥åŠ å¯†æŠ€æœ¯å’Œå¯é è®¤è¯ä¸­å¿ƒï¼ˆCAï¼‰çš„è¯ä¹¦ï¼Œæ¥ç¡®è®¤æœåŠ¡å™¨çš„åˆæ³•æ€§</p><p>3ã€æœåŠ¡å™¨å¯¹å®¢æˆ·çš„èº«ä»½è®¤è¯ï¼šé€šè¿‡å…¬é’¥æŠ€æœ¯å’Œè¯ä¹¦è¿›è¡Œè®¤è¯æˆ–é€šè¿‡ç”¨æˆ·å + å£ä»¤æ¥è®¤è¯</p><blockquote><p>åŒå‘è®¤è¯æ‰èƒ½ä¿è¯ä¸€å®šçš„å®‰å…¨ï¼Œå•å‘è®¤è¯ä¸€å®šä¼šå­˜åœ¨æ¼æ´</p></blockquote><h3 id="æœºå¯†æ€§"><a class="markdownIt-Anchor" href="#æœºå¯†æ€§"></a> æœºå¯†æ€§</h3><p>åœ¨ SSL å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´ä¼ è¾“çš„æ‰€æœ‰æ•°æ®éƒ½ç»è¿‡äº†åŠ å¯†å¤„ç†ï¼Œä»¥é˜²æ­¢éæ³•ç”¨æˆ·è¿›è¡Œçªƒå–ã€ç¯¡æ”¹å’Œå†’å……ï¼šTriple DESï¼ŒIDEAï¼ŒRC2ï¼ŒRC4 â€¦</p><h3 id="å®Œæ•´æ€§"><a class="markdownIt-Anchor" href="#å®Œæ•´æ€§"></a> å®Œæ•´æ€§</h3><p>SSL åˆ©ç”¨åŠ å¯†ç®—æ³•å’Œ Hash å‡½æ•°æ¥ä¿è¯å®¢æˆ·æœºå’ŒæœåŠ¡å™¨ä¹‹é—´ä¼ è¾“çš„æ•°æ®çš„å®Œæ•´æ€§ï¼ŒMAC with MD5 or SHA-*</p><h2 id="ssl-ä½“ç³»ç»“æ„"><a class="markdownIt-Anchor" href="#ssl-ä½“ç³»ç»“æ„"></a> SSL ä½“ç³»ç»“æ„</h2><h3 id="è¿æ¥ä¸ä¼šè¯çš„å®šä¹‰"><a class="markdownIt-Anchor" href="#è¿æ¥ä¸ä¼šè¯çš„å®šä¹‰"></a> è¿æ¥ä¸ä¼šè¯çš„å®šä¹‰</h3><p><strong>è¿æ¥</strong>ï¼šè¿æ¥æ˜¯èƒ½æä¾›åˆé€‚æœåŠ¡ç±»å‹çš„ä¼ è¾“ï¼›å¯¹ SSL æ¥è¯´ï¼Œè¿æ¥æ˜¯ç‚¹å¯¹ç‚¹çš„è€Œä¸”æ˜¯æš‚æ—¶çš„ï¼›æ¯ä¸€æ¡è¿æ¥éƒ½ä¸ä¸€ä¸ªä¼šè¯ç›¸å…³è”</p><p><strong>ä¼šè¯</strong>ï¼šSSL ä¼šè¯æ˜¯æŒ‡åœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„ä¸€ç§è™šæ‹Ÿçš„å…³è”å…³ç³»ï¼Œç”±ä¸€ç»„è¿æ¥ç»„æˆ</p><blockquote><p>ä¼šè¯ç”±æ¡æ‰‹åè®®åˆ›å»ºï¼›å®šä¹‰äº†ä¸€ç»„å¯ä»¥è¢«å¤šä¸ªè¿æ¥å…±ç”¨çš„å¯†ç å®‰å…¨å‚æ•°ï¼ˆåå•†ï¼‰ï¼›å¯¹äºæ¯ä¸ªè¿æ¥ï¼Œå¯ä»¥åˆ©ç”¨ä¼šè¯æ¥é¿å…å¯¹æ–°çš„å®‰å…¨å‚æ•°è¿›è¡Œä»£ä»·æ˜‚è´µçš„åå•†ï¼ˆ<strong>ä¼šè¯é‡ç”¨</strong>ï¼‰</p></blockquote><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20211126105635371.png" alt="image-20211126105635371" /></p><h3 id="çŠ¶æ€"><a class="markdownIt-Anchor" href="#çŠ¶æ€"></a> çŠ¶æ€</h3><p>æ¯ä¸€ä¸ªä¼šè¯æˆ–è¿æ¥éƒ½ä¸è‹¥å¹²ä¸ªä¼šè¯æˆ–è¿æ¥çŠ¶æ€ç›¸å…³è”</p><blockquote><p>ä¸€æ—¦å»ºç«‹èµ·ä¸€ä¸ªä¼šè¯æˆ–è¿æ¥ï¼Œå¯¹äºå‘é€å’Œæ¥æ”¶å°±å­˜åœ¨ä¸€ä¸ªå½“å‰æ“ä½œçŠ¶æ€</p><p>åœ¨æ¡æ‰‹åè®®ä¸­è¿˜ä¼šåˆ›å»ºå‘é€æŒ‚èµ·å’Œæ¥å—æŒ‚èµ·çŠ¶æ€ï¼Œç­‰æ¡æ‰‹åè®®ç»“æŸååˆå›åˆ°å½“å‰çŠ¶æ€</p><p>ä¼šè¯æˆ–è¿æ¥çŠ¶æ€ç”±ä¼šè¯æˆ–è¿æ¥çŠ¶æ€å‚æ•°å®šä¹‰</p></blockquote><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20211126110715060.png" alt="image-20211126110715060" /></p><h3 id="å·¥ä½œåŸç†"><a class="markdownIt-Anchor" href="#å·¥ä½œåŸç†"></a> å·¥ä½œåŸç†</h3><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20211118140429315.png" alt="image-20211118140429315" /></p><p>1ã€é‡‡ç”¨æ¡æ‰‹åè®®å»ºç«‹å®¢æˆ·ä¸æœåŠ¡å™¨ä¹‹é—´çš„å®‰å…¨é€šé“ï¼Œè¯¥åè®®åŒ…æ‹¬ï¼šåŒæ–¹çš„ç›¸äº’è®¤è¯ï¼Œäº¤æ¢å¯†é’¥å‚æ•°ï¼ˆå¯†ç åå•†ï¼‰</p><p>2ã€é‡‡ç”¨å‘Šè­¦åè®®å‘å¯¹ç«¯æŒ‡ç¤ºå…¶å®‰å…¨é”™è¯¯</p><p>3ã€é‡‡ç”¨å˜æ›´å¯†ç è§„æ ¼åè®®å‘ŠçŸ¥æ”¹å˜å¯†ç å‚æ•°</p><p>4ã€é‡‡ç”¨è®°å½•åè®®å°è£…ä»¥ä¸Šä¸‰ç§åè®®æˆ–åº”ç”¨å±‚æ•°æ®ï¼ˆæ¯”å¦‚HTTPï¼‰</p><h2 id="ssl-æ¡æ‰‹åè®®"><a class="markdownIt-Anchor" href="#ssl-æ¡æ‰‹åè®®"></a> SSL æ¡æ‰‹åè®®</h2><h3 id="åŸºæœ¬åŠŸèƒ½"><a class="markdownIt-Anchor" href="#åŸºæœ¬åŠŸèƒ½"></a> åŸºæœ¬åŠŸèƒ½</h3><p>1ã€å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´ç›¸äº’è®¤è¯</p><p>2ã€å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´åå•†åŠ å¯†ç®—æ³•å’Œ MAC ç®—æ³•</p><p>3ã€å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´åå•†ç”¨äºåŠ å¯† SSL è½½è·çš„å…±äº«å¯†é’¥ï¼šæœºå¯†å‹ç§˜é’¥</p><p>4ã€å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´åå•†ç”¨äºäº§ç”Ÿ MAC çš„å…±äº«å¯†é’¥ï¼šå®Œæ•´å‹ç§˜é’¥</p><blockquote><p>æ¡æ‰‹åè®®åœ¨ä»»ä½•åº”ç”¨æ•°æ®è¢«ä¼ è¾“ä¹‹å‰ä½¿ç”¨</p></blockquote><h3 id="æŠ¥æ–‡æ ¼å¼"><a class="markdownIt-Anchor" href="#æŠ¥æ–‡æ ¼å¼"></a> æŠ¥æ–‡æ ¼å¼</h3><p>å…¸å‹çš„ TLV æ ¼å¼ï¼Œç±»å‹ + é•¿åº¦ + å†…å®¹</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20211118141706256.png" alt="image-20211118141706256" /></p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20211126112239897.png" alt="image-20211126112239897" /></p><p>0ã€hello_requestï¼ˆå¯é€‰ï¼‰ï¼Œæ— å‚æ•°ï¼ŒæœåŠ¡å™¨å‘ŠçŸ¥å®¢æˆ·ç«¯éœ€è¦å¯åŠ¨æ¡æ‰‹åè®®</p><blockquote><p>Tips ï¼šSSL çš„æ¡æ‰‹éƒ½æ˜¯ç”±å®¢æˆ·ç«¯å…ˆå‘èµ·çš„ï¼Œå¦‚æœæœåŠ¡å™¨ä¸»åŠ¨éœ€è¦å»ºç«‹ SSLï¼Œä¹Ÿä¼šç”¨ hello_request å‘ŠçŸ¥å®¢æˆ·ç«¯ï¼Œè®©å…¶ä¸»åŠ¨æ¡æ‰‹ï¼ˆå‚²å¨‡ï¼‰</p></blockquote><p><strong>1ã€å»ºç«‹å®‰å…¨èƒ½åŠ›</strong></p><p>client_helloï¼Œå‚æ•°æœ‰ç‰ˆæœ¬ã€éšæœºæ•°ã€ä¼šè¯ idã€å¯†ç å‚æ•°ã€å‹ç¼©æ–¹æ³•ï¼Œå®¢æˆ·ç«¯å‘å‡º c_h å¯åŠ¨ SSL ä¼šè¯</p><p>server_helloï¼Œå‚æ•°æœ‰ç‰ˆæœ¬ã€éšæœºæ•°ã€ä¼šè¯ idã€å¯†ç å‚æ•°ã€å‹ç¼©æ–¹æ³•ï¼ŒæœåŠ¡å™¨å“åº”å®¢æˆ·ç«¯çš„ c_h</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20211126111750083.png" alt="image-20211126111750083" /></p><p><strong>2ã€æœåŠ¡å™¨è®¤è¯ä¸ç§˜é’¥äº¤æ¢</strong></p><p>certificateï¼ŒX.509 v3 è¯ä¹¦é“¾ï¼ŒæœåŠ¡å™¨å‘å‡ºçš„å‘å®¢æˆ·ç«¯éªŒè¯è‡ªå·±èº«ä»½çš„æ¶ˆæ¯</p><p>server_key_exchangeï¼Œå‚æ•°ä¸ºç­¾åä¿¡æ¯ï¼Œç”±æœåŠ¡ç«¯å‘èµ·çš„ç§˜é’¥äº¤æ¢</p><p>certificate_requestï¼Œå‚æ•°ä¸º CAsï¼ŒæœåŠ¡å™¨è¦æ±‚è¿›è¡Œå®¢æˆ·ç«¯è®¤è¯ï¼ˆå¯é€‰ï¼‰</p><p>server_doneï¼Œæ— å‚æ•°ï¼ŒæŒ‡ç¤ºæœåŠ¡å™¨çš„ Hello æ¶ˆæ¯å‘é€å®Œæ¯•</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/20211204184156.png" alt="æœåŠ¡å™¨è®¤è¯ä¸ç§˜é’¥äº¤æ¢" /></p><p><strong>3ã€å®¢æˆ·ç«¯è®¤è¯ä¸ç§˜é’¥äº¤æ¢</strong>ï¼šå¾—åˆ°äº†åŸŸä¸»ç§˜é’¥</p><p>certificate_verifyï¼Œå‚æ•°ä¸ºç­¾åä¿¡æ¯ï¼Œå¯¹å®¢æˆ·è¯ä¹¦è¿›è¡ŒéªŒè¯</p><p>client_key_exchangeï¼Œå‚æ•°ä¸ºç­¾åä¿¡æ¯ï¼Œè¡¨ç¤ºç§˜é’¥äº¤æ¢</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20211126112603353.png" alt="" /></p><p><strong>4ã€å˜æ›´å¯†ç è§„æ ¼å¹¶ç»“æŸæ¡æ‰‹</strong></p><p>finishedï¼Œå‚æ•°ä¸º hash å€¼ï¼ŒéªŒè¯ç§˜é’¥äº¤æ¢å’Œé‰´åˆ«è¿‡ç¨‹æ˜¯æˆåŠŸçš„</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20211126112201222.png" alt="image-20211126112201222" /></p><h3 id="åè®®æµç¨‹"><a class="markdownIt-Anchor" href="#åè®®æµç¨‹"></a> åè®®æµç¨‹</h3><p><strong>0x01 å»ºç«‹å®‰å…¨èƒ½åŠ›</strong></p><p>1ã€Client Helloï¼šå®¢æˆ·ç«¯æ˜æ–‡å‘é€ï¼ŒåŒ…å«ï¼šç‰ˆæœ¬ï¼ˆå®¢æˆ·ç«¯ SSL æœ€é«˜ç‰ˆæœ¬ï¼‰ï¼Œéšæœºæ•°ï¼ˆ32ä½æ—¶é—´æˆ³+28å­—èŠ‚éšæœºåºåˆ—ï¼Œç”¨äºç§˜é’¥ç”Ÿæˆï¼‰ï¼Œä¼šè¯ ID ï¼ˆ0ï¼Œåœ¨æ–°ä¼šè¯ä¸Šå»ºç«‹ä¸€æ¡æ–°è¿æ¥ï¼›é0ï¼Œä¸ºç°æœ‰ä¼šè¯åˆ›å»ºä¸€ä¸ªæ–°è¿æ¥æˆ–æ›´æ–°ç°æœ‰è¿æ¥å‚æ•°ï¼‰ï¼Œå®¢æˆ·æ”¯æŒçš„å¯†ç ç®—æ³•åˆ—è¡¨ï¼ˆCipherSuiteï¼Œä¹Ÿè¢«ç§°ä½œå¯†ç å¥—ä»¶ï¼‰ï¼Œå®¢æˆ·æ”¯æŒçš„å‹ç¼©æ–¹æ³•åˆ—è¡¨</p><blockquote><p>æ¯ä¸ªåŠ å¯†å¥—ä»¶å¯¹åº”å‰é¢ TLS åŸç†ä¸­çš„å››ä¸ªåŠŸèƒ½çš„ç»„åˆï¼šè®¤è¯ç®—æ³• Au (èº«ä»½éªŒè¯)ã€å¯†é’¥äº¤æ¢ç®—æ³• KeyExchange(å¯†é’¥åå•†)ã€å¯¹ç§°åŠ å¯†ç®—æ³• Enc (ä¿¡æ¯åŠ å¯†)å’Œä¿¡æ¯æ‘˜è¦ Mac(å®Œæ•´æ€§æ ¡éªŒ);</p></blockquote><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20211126113459835.png" alt="image-20211126113459835" /></p><p>2ã€Server Helloï¼šæœåŠ¡å™¨å‘é€ï¼ŒåŒ…å«ï¼šç‰ˆæœ¬ï¼ˆå®¢æˆ·ç«¯å»ºè®®çš„è¾ƒä½ç‰ˆæœ¬ä»¥åŠæœåŠ¡å™¨æ”¯æŒçš„æœ€é«˜æœ¬ï¼‰ï¼Œä¼šè¯ IDï¼ˆè‹¥å®¢æˆ·ç«¯ä¼šè¯ ID é0ï¼Œé‡‡ç”¨ç›¸åŒå€¼ï¼›å¦åˆ™åº”ä¸ºä¸€ä¸ªæ–°ä¼šè¯IDï¼‰ï¼Œéšæœºæ•°ï¼ˆç‹¬ç«‹äºå®¢æˆ·ç«¯éšæœºæ•°ï¼ŒåŒæ ·å‚ä¸å¯†é’¥ç”Ÿæˆï¼‰ï¼ŒæœåŠ¡å™¨ä»å®¢æˆ·ç«¯å»ºè®®çš„å¯†ç å¥—ä»¶ä¸­æŒ‘å‡ºä¸€ç»„ï¼ŒæœåŠ¡å™¨ä»å®¢æˆ·ç«¯å»ºè®®çš„å‹ç¼©æ–¹æ³•ä¸­æŒ‘å‡ºä¸€ç§</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20211126113510948.png" alt="image-20211126113510948" /></p><p><strong>0x02 æœåŠ¡å™¨è®¤è¯ä¸ç§˜é’¥äº¤æ¢</strong></p><p>3ã€certificateï¼šæœåŠ¡å™¨å‘é€ï¼ŒåŒ…å«ä¸€ä¸ª X.509 è¯ä¹¦æˆ–è€…ä¸€æ¡ X.509 è¯ä¹¦é“¾ï¼›</p><p>4ã€ï¼ˆå¯é€‰ï¼‰server_key_exchangeï¼šè‹¥ä½¿ç”¨ RSA å¯†é’¥äº¤æ¢æ–¹æ³•æˆ–æœåŠ¡å™¨å·²å‘é€äº†åŒ…å« DH ç®—æ³•å‚æ•°çš„è¯ä¹¦ï¼Œåˆ™æ— é¡»å‘é€è¯¥æ¶ˆæ¯ï¼ˆå›ºæ€ DHï¼‰</p><blockquote><p>Tipsï¼šå¦‚æœæ˜¯æš‚æ€æˆ–åŒ¿å DHï¼Œåˆ™è¦å‘é€ server_key_exchange æ¶ˆæ¯</p></blockquote><p>5ã€ï¼ˆå¯é€‰ï¼‰Client Certificate Requestï¼šæœåŠ¡å™¨å‘é€ï¼Œè¡¨ç¤ºå‘å®¢æˆ·è¯·æ±‚ä¸€ä¸ªè¯ä¹¦ï¼Œè¯·æ±‚å†…å®¹åŒ…å«è¯ä¹¦ç±»å‹å’Œè¯ä¹¦æœºæ„ï¼ˆCAsï¼‰</p><blockquote><p>ä½¿ç”¨ HTTPS æµè§ˆç½‘ç«™é€šå¸¸ä¸éœ€è¦å®¢æˆ·ç«¯æä¾›è¯ä¹¦ï¼Œä½†æ˜¯æŸäº›æƒ…å†µä¸‹ï¼Œå®¢æˆ·ç«¯åœ¨æµè§ˆè¿‡ç¨‹ä¸­çš„æŸäº›æ“ä½œå¯èƒ½ä¼šè§¦å‘æœåŠ¡å™¨è¦æ±‚éªŒè¯å®¢æˆ·ç«¯è¯ä¹¦ï¼Œæ¯”å¦‚ç½‘é“¶è½¬è´¦</p></blockquote><p>6ã€Server Doneï¼ŒæœåŠ¡å™¨å‘é€ï¼Œè¡¨ç¤ºæœåŠ¡å™¨çš„ hello åŠç›¸å…³æ¶ˆæ¯å·²ç»ç»“æŸï¼Œç­‰å¾…å®¢æˆ·ç«¯å“åº”ï¼ˆåå•†çš„å¯†ç å¥—ä»¶ç‰ˆæœ¬ç­‰å®¢æˆ·ç«¯æ˜¯å¦æ¥æ”¶ï¼‰</p><p><strong>0x03 å®¢æˆ·ç«¯è®¤è¯ä¸ç§˜é’¥äº¤æ¢</strong></p><p>7ã€Server Doneï¼Œå®¢æˆ·ç«¯æ¥æ”¶åˆ°ï¼Œæ ¹æ®éœ€è¦éªŒè¯æœåŠ¡å™¨æä¾›çš„è¯ä¹¦æ˜¯å¦æœ‰æ•ˆï¼›åˆ¤æ–­ server_hello çš„å‚æ•°æ˜¯å¦å¯ä»¥æ¥å—ï¼›å¦‚æœéƒ½æ²¡æœ‰é—®é¢˜çš„è¯ï¼Œå‘é€ä¸€ä¸ªæˆ–å¤šä¸ªæ¶ˆæ¯ç»™æœåŠ¡å™¨</p><blockquote><p>éªŒè¯è¯ä¹¦é“¾çš„å¯ä¿¡æ€§ï¼›è¯ä¹¦æ˜¯å¦åŠé”€ï¼›è¯ä¹¦æ˜¯å¦åœ¨æœ‰æ•ˆæœŸå†…ï¼›è¯ä¹¦ä¸­çš„åŸŸåæ˜¯å¦ä¸å½“å‰è®¿é—®çš„åŸŸååŒ¹é…ï¼›</p></blockquote><p>8ã€ï¼ˆå¯é€‰ï¼‰Client Certificateï¼Œå®¢æˆ·ç«¯å‘é€ï¼Œå¦‚æœæœåŠ¡å™¨è¯·æ±‚è¯ä¹¦ï¼Œåˆ™å®¢æˆ·ç«¯é¦–å…ˆå‘é€ä¸€ä¸ªcertificate æ¶ˆæ¯ï¼Œä½œä¸ºè¯¥é˜¶æ®µçš„å¼€å§‹ï¼›è‹¥å®¢æˆ·æ²¡æœ‰è¯ä¹¦ï¼Œåˆ™å‘é€ä¸€ä¸ª no_certificate è­¦å‘Š</p><p>9ã€Client Key Exchangeï¼Œå®¢æˆ·ç«¯å‘é€ï¼Œå®¢æˆ·ç«¯è®¡ç®—äº§ç”Ÿéšæœºæ•°å­— Pre-masterï¼Œå¹¶ç”¨è¯ä¹¦å…¬é’¥åŠ å¯†ï¼Œå‘é€ç»™æœåŠ¡å™¨ï¼›</p><blockquote><p>æ¶ˆæ¯å…·ä½“å†…å®¹å–å†³äºå¯†é’¥äº¤æ¢çš„ç±»å‹</p><p>RSAï¼šå®¢æˆ·ç«¯äº§ç”Ÿä¸€ä¸ª 48 å­—èŠ‚çš„ pre_master_secretï¼Œå¹¶ç”¨æœåŠ¡å™¨å…¬é’¥åŠ å¯†</p><p>å›ºæ€ DHï¼šä»¥ certificate æ¶ˆæ¯çš„å½¢å¼å‘é€å®¢æˆ·ç«¯ DH å…¬é’¥å‚æ•°ï¼Œè¯¥æ¶ˆæ¯ä¸ºç©º</p><p>æš‚æ€æˆ–åŒ¿å DHï¼šå‘é€å®¢æˆ·ç«¯çš„ DH å…¬é’¥å‚æ•° Cè¿™ä¸€æ­¥å®Œæˆåå®¢æˆ·ç«¯å·²ç»è·å–å…¨éƒ¨çš„è®¡ç®—åå•†å¯†é’¥éœ€è¦çš„ä¿¡æ¯ï¼Œä»¥ RSA ä¸ºä¾‹ï¼šä¸¤ä¸ªæ˜æ–‡éšæœºæ•° random_C å’Œ random_S ä¸è‡ªå·±è®¡ç®—äº§ç”Ÿçš„ pre_master_secretï¼Œå¹¶ç”¨æœåŠ¡å™¨å…¬é’¥åŠ å¯†ï¼Œè®¡ç®—å¾—åˆ°åå•†å¯†é’¥</p></blockquote><p>10ã€ï¼ˆå¯é€‰ï¼‰Certificate Verifyï¼Œå®¢æˆ·ç«¯å‘é€ï¼Œå‘é€ä¸€ä¸ª certificate_verify æ¶ˆæ¯éªŒè¯å®¢æˆ·ç«¯è¯ä¹¦</p><blockquote><p>è¯¥æ¶ˆæ¯æ˜¯å¯¹ä¸€ä¸ª HMAC çš„ç­¾åï¼Œè¯¥ HMAC åŸºäºä¹‹å‰çš„æ¡æ‰‹æ¶ˆæ¯</p></blockquote><p>11ã€Change Cipher Specï¼Œå®¢æˆ·ç«¯å‘é€ change_cipher_spec æ¶ˆæ¯ï¼Œé€šçŸ¥æœåŠ¡å™¨åç»­çš„é€šä¿¡éƒ½é‡‡ç”¨åå•†çš„é€šä¿¡å¯†é’¥å’ŒåŠ å¯†ç®—æ³•è¿›è¡ŒåŠ å¯†é€šä¿¡ï¼Œå¹¶ä¸”æŠŠåå•†å¾—åˆ°çš„å¯†ç å¥—ä»¶æ‹·è´åˆ°å½“å‰è¿æ¥çš„çŠ¶æ€ä¹‹ä¸­ï¼›</p><p><strong>0x04 å˜æ›´å¯†ç è§„æ ¼å¹¶ç»“æŸæ¡æ‰‹</strong></p><p>12ã€Client Finishedï¼Œéšåå®¢æˆ·ç«¯ç”¨æœ¬æ¬¡è¿æ¥åå•†çš„ç®—æ³•å’Œå¯†é’¥å‚æ•°åŠ å¯†å‘é€ä¸€ä¸ª finished æ¶ˆæ¯</p><blockquote><p>è¿™æ¡æ¶ˆæ¯ç”¨äºéªŒè¯å¯†é’¥äº¤æ¢å’Œé‰´åˆ«è¿‡ç¨‹æ˜¯å¦æˆåŠŸï¼šå…¶ä¸­åŒ…æ‹¬ä¸€ä¸ªæ ¡éªŒå€¼ï¼ˆverify_dataï¼‰ï¼Œå¯¹æ‰€æœ‰ä»¥æ¥çš„æ¶ˆæ¯è¿›è¡Œæ ¡éªŒ</p></blockquote><p>13ã€Change Cipher Specï¼ŒServer Finishedï¼ŒæœåŠ¡å™¨è®¡ç®—å‡ºåå•†ç§˜é’¥ååŒæ ·å‘é€ change_cipher_spec æ¶ˆæ¯å’Œ finished ï¼ˆåŠ å¯†ï¼Œå¹¶ä¸”åŒ…å«ç›¸åŒçš„ verify_dataï¼‰æ¶ˆæ¯</p><p>å®¢æˆ·ç«¯è®¡ç®—æ‰€æœ‰æ¥æ”¶ä¿¡æ¯çš„ hash å€¼ï¼Œå¹¶é‡‡ç”¨åå•†å¯†é’¥è§£å¯† encrypted_handshake_messageï¼ŒéªŒè¯æœåŠ¡å™¨å‘é€çš„æ•°æ®å’Œå¯†é’¥ï¼ŒéªŒè¯é€šè¿‡åˆ™æ¡æ‰‹å®Œæˆæ¡æ‰‹è¿‡ç¨‹å®Œæˆï¼Œå®¢æˆ·å’ŒæœåŠ¡å™¨å¯ä»¥ä¼ é€åº”ç”¨å±‚æ•°æ®</p><p><strong>0x05 åº”ç”¨æ•°æ®ä¼ è¾“</strong></p><h2 id="è®°å½•åè®®"><a class="markdownIt-Anchor" href="#è®°å½•åè®®"></a> è®°å½•åè®®</h2><p>ä¸»è¦åŠŸèƒ½ï¼šå°è£…æ¡æ‰‹åè®®ã€å‘Šè­¦åè®®ã€å˜æ›´å¯†ç è§„æ ¼åè®®æˆ–åº”ç”¨å±‚åè®®çš„æ•°æ®</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/20211204185938.png" alt="è®°å½•åè®®" /></p><p>åŠ å¯†æ—¶è¦æ³¨æ„ï¼šåŠ å¯†å†…å®¹ä¸ºæ¶ˆæ¯æ•°æ®åŸŸ MACï¼›åŠ å¯†å¢åŠ é•¿åº¦ä¸è¶…è¿‡ 1024 å­—èŠ‚ï¼›æ€»é•¿åº¦ä¸è¶…è¿‡214 + 2048 å­—èŠ‚ï¼›å¯¹äºæµåŠ å¯†ç®—æ³•ï¼Œä¸éœ€è¦å¡«å……æ•°æ®ï¼Œæ¶ˆæ¯å’Œ MAC ä¸€èµ·è¢«ç›´æ¥åŠ å¯†ï¼›å¯¹äº CBC æ¨¡å¼çš„åˆ†ç»„åŠ å¯†ç®—æ³•ï¼Œéœ€è¦å¡«å……æ•°æ®ï¼ŒåŠ å¯†ç®—æ³•ç”± Cipher Spec æŒ‡å®šï¼Œå¹¶ä¸”éœ€è¦æŒ‡å®šåˆå§‹åŒ–å‘é‡ IV</p><p>æ·»åŠ  SSL è®°å½•å¤´ï¼šä¸»è¦æœ‰å››éƒ¨åˆ†å†…å®¹ï¼š</p><p>å†…å®¹ç±»å‹ï¼ˆ1å­—èŠ‚ï¼‰ï¼šä¸Šå±‚åè®®ç±»å‹ï¼ŒåŒ…å«æ¡æ‰‹åè®®ã€å‘Šè­¦åè®®ã€å˜æ›´å¯†ç è§„æ ¼åè®®å’Œåº”ç”¨æ•°æ®å››ç§</p><p>ä¸»ç‰ˆæœ¬å·ï¼ˆ1å­—èŠ‚ï¼‰ï¼šSSL åè®®çš„ä¸»ç‰ˆæœ¬å·ï¼Œå¯¹äº SSL v3.0 è¯¥å€¼ä¸º 3</p><p>å‰¯ç‰ˆæœ¬å·ï¼ˆ1å­—èŠ‚ï¼‰ï¼šSSL åè®®çš„å‰¯ç‰ˆæœ¬å·ï¼Œå¯¹äº SSL v3.0 è¯¥å€¼ä¸º 0</p><p>å‹ç¼©åçš„é•¿åº¦ï¼ˆ1å­—èŠ‚ï¼‰ï¼šåŠ å¯†åçš„æ•°æ®é•¿åº¦ï¼Œæœ€å¤§å€¼ä¸º 214 + 2048 å­—èŠ‚</p><h2 id="å¯†é’¥äº¤æ¢æ–¹æ³•"><a class="markdownIt-Anchor" href="#å¯†é’¥äº¤æ¢æ–¹æ³•"></a> å¯†é’¥äº¤æ¢æ–¹æ³•</h2><p>å¯†é’¥äº¤æ¢çš„ç›®çš„æ˜¯è®©åŒæ–¹è·å¾—ç›¸åŒçš„ pre_master_secretï¼Œé¢„å¤‡ä¸»å¯†é’¥ï¼Œåç»­å°†ç”± pre_master_secret ç”Ÿæˆ master_secretï¼ˆä¸»å¯†é’¥ï¼‰</p><h3 id="rsa"><a class="markdownIt-Anchor" href="#rsa"></a> RSA</h3><p>1ã€å®¢æˆ·ç«¯ç”Ÿæˆä¸€ä¸ª 48 å­—èŠ‚çš„éšæœºæ•° k ä½œä¸º pre_master_secret</p><p>2ã€<strong>æ•°å­—ä¿¡å°</strong>ï¼šå®¢æˆ·ç«¯ç”¨æœåŠ¡å™¨å…¬é’¥åŠ å¯† k å¾—åˆ° k' å¹¶å‘é€ç»™å®¢æˆ·ç«¯ï¼ŒæœåŠ¡å™¨æ”¶åˆ° k' åç”¨è‡ªå·±çš„ç§é’¥è§£å¯†å¾—åˆ° k</p><p>3ã€æ­¤æ—¶åŒæ–¹éƒ½å¾—åˆ°äº† k å³ pre_master_secretï¼Œå¯†é’¥äº¤æ¢å®Œæˆ</p><h3 id="dh"><a class="markdownIt-Anchor" href="#dh"></a> DH</h3><p>å…±æœ‰ 6 ä¸ªå‚æ•°ï¼Œåˆ†åˆ«æ˜¯ DH ç®—æ³•å‚æ•°ï¼ˆPï¼ŒGï¼‰ã€æœåŠ¡å™¨ç§é’¥å‚æ•° s å’Œå…¬é’¥å‚æ•° Sã€å®¢æˆ·ç«¯ç§é’¥å‚æ•° c å’Œå…¬é’¥å‚æ•° C</p><p>1ã€æœåŠ¡å™¨é€‰å®š DH ç®—æ³•å‚æ•°ï¼ˆPï¼ŒGï¼‰ï¼Œå¯åŒ…å«åœ¨è¯ä¹¦ä¸­ï¼ˆå›ºæ€ DHï¼‰ï¼Œæˆ–é€šè¿‡server_key_exchange æ¶ˆæ¯å‘é€ç»™å®¢æˆ·ç«¯ï¼ˆæš‚æ€æˆ–åŒ¿å DHï¼‰</p><p>2ã€å®¢æˆ·ç«¯ç”Ÿæˆä¸€ä¸ªéšæœºæ•° cï¼Œæ ¹æ®ï¼ˆPï¼ŒGï¼‰è®¡ç®—å‡º Cï¼ŒC å¯é€šè¿‡è¯ä¹¦ï¼ˆå›ºæ€ DHï¼‰æˆ–è€…client_key_exchange æ¶ˆæ¯å‘é€ç»™æœåŠ¡å™¨ï¼ˆæš‚æ€æˆ–åŒ¿åDHï¼‰</p><p>3ã€åŒæ—¶æœåŠ¡å™¨ç”Ÿæˆä¸€ä¸ªéšæœºæ•° sï¼Œæ ¹æ®ï¼ˆPï¼ŒGï¼‰è®¡ç®—å‡º Sï¼ŒS å¯é€šè¿‡è¯ä¹¦ï¼ˆå›ºæ€ DHï¼‰æˆ–è€…é€šè¿‡server_key_exchange æ¶ˆæ¯å‘é€ç»™å®¢æˆ·ç«¯ï¼ˆæš‚æ€æˆ–åŒ¿åDHï¼‰</p><p>4ã€å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨å„è‡ªæ ¹æ®ï¼ˆcï¼ŒSï¼‰å’Œï¼ˆsï¼ŒCï¼‰è®¡ç®—å‡ºç›¸åŒçš„ pre_master_secretï¼ˆDH ç®—æ³•ä¿è¯è¯¥å€¼ç›¸åŒï¼‰</p><h2 id="å¯†é’¥ç”Ÿæˆ"><a class="markdownIt-Anchor" href="#å¯†é’¥ç”Ÿæˆ"></a> å¯†é’¥ç”Ÿæˆ</h2><p>é€šè¿‡ç§˜é’¥äº¤æ¢ç®—æ³•å¾—åˆ°çš„ç§˜é’¥ä¸ºé¢„å¤‡ä¸»å¯†é’¥ï¼Œéšåå°†é€šè¿‡é¢„å¤‡ä¸»å¯†é’¥ç”Ÿæˆä¸»å¯†é’¥</p><h3 id="ä¸»å¯†é’¥ç”Ÿæˆ"><a class="markdownIt-Anchor" href="#ä¸»å¯†é’¥ç”Ÿæˆ"></a> ä¸»å¯†é’¥ç”Ÿæˆ</h3><p>Master Secretï¼ŒæœåŠ¡å™¨å’Œå®¢æˆ·ç«¯éƒ½æœ‰ä¸€ä»½ç›¸åŒçš„ Pre_Master_Secret å’Œ éšæœºæ•°ï¼Œè¿™ä¸ªéšæœºæ•°å°†ä½œä¸ºäº§ç”Ÿ Master_Secret çš„ç§å­</p><blockquote><p>ç”Ÿæˆæ–¹æ³•å¯ä»¥å¤šæ ·</p></blockquote><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20211126163441460.png" alt="image-20211126163441460" /></p><h3 id="å¯†ç å‚æ•°ç”Ÿæˆ"><a class="markdownIt-Anchor" href="#å¯†ç å‚æ•°ç”Ÿæˆ"></a> å¯†ç å‚æ•°ç”Ÿæˆ</h3><p>å¯†ç è§„æ ¼è¦æ±‚çš„å®¢æˆ·ç«¯å†™ MAC å¯†é’¥ã€æœåŠ¡å™¨å†™ MAC å¯†é’¥(ç”¨äºæ•°æ®å®Œæ•´æ€§æ ¡éªŒ)ã€å®¢æˆ·ç«¯å†™å¯†é’¥ã€æœåŠ¡å™¨å†™å¯†é’¥ï¼ˆç”¨äºå¯¹ç§°åŠ å¯†æ•°æ®ï¼‰ã€å®¢æˆ·ç«¯å†™åˆå§‹å‘é‡ IVã€æœåŠ¡å™¨å†™åˆå§‹å‘é‡ IVï¼ˆä½œä¸ºå¾ˆå¤šåŠ å¯†ç®—æ³•çš„åˆå§‹åŒ–å‘é‡ä½¿ç”¨ï¼Œå…·ä½“å¯ä»¥ç ”ç©¶å¯¹ç§°åŠ å¯†ç®—æ³•ï¼‰ï¼Œè¿™äº›éƒ½æ˜¯æŒ‰é¡ºåºç”±ä¸»å¯†é’¥ç”Ÿæˆ</p><p>ç”Ÿæˆçš„æ–¹æ³•æ˜¯ï¼šä¸»å¯†é’¥åˆ©ç”¨æ•£åˆ—å‡½æ•°äº§ç”Ÿå®‰å…¨å­—èŠ‚åºåˆ—ï¼ˆkey_blockï¼‰ï¼Œåºåˆ—è¶³å¤Ÿé•¿ä»¥ä¾¿ç”Ÿæˆæ‰€æœ‰éœ€è¦çš„å‚æ•°ï¼›å…·ä½“çš„éœ€è¦è¿›è¡Œ 12 æ¬¡è¿­ä»£ï¼Œå¾—åˆ° 12 ä¸ª hash å€¼ï¼Œåˆ†ç»„æˆ 6 ä¸ªå…ƒç´ ï¼šclient / server mac keyï¼Œencryption keyï¼ŒIVï¼šå…±ä¸¤ç»„åŠ å¯†å…ƒç´ ï¼Œåˆ†åˆ«è¢«å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä½¿ç”¨ï¼Œè¿™ä¸¤ç»„å…ƒç´ éƒ½è¢«ä¸¤è¾¹åŒæ—¶è·å–</p><p>å®¢æˆ·ç«¯ä½¿ç”¨ client ç»„å…ƒç´ åŠ å¯†æ•°æ®ï¼ŒæœåŠ¡å™¨ä½¿ç”¨ client å…ƒç´ è§£å¯†;æœåŠ¡å™¨ä½¿ç”¨ server å…ƒç´ åŠ å¯†ï¼Œclient ä½¿ç”¨ server å…ƒç´ è§£å¯†;</p><blockquote><p>åŒå‘é€šä¿¡çš„ä¸åŒæ–¹å‘ä½¿ç”¨çš„å¯†é’¥ä¸åŒï¼Œç ´è§£é€šä¿¡è‡³å°‘éœ€è¦ç ´è§£ä¸¤æ¬¡</p></blockquote><h2 id="ä¼šè¯é‡ç”¨"><a class="markdownIt-Anchor" href="#ä¼šè¯é‡ç”¨"></a> ä¼šè¯é‡ç”¨</h2><p>SSL è®¤ä¸ºä¼šè¯é€šå¸¸æ˜¯å…·æœ‰è¾ƒé•¿çš„ç”Ÿå‘½æœŸï¼Œåœ¨ä¸€ä¸ªä¼šè¯åŸºç¡€ä¸Šå¯æ´¾ç”Ÿå‡ºå¤šä¸ªè¿æ¥ï¼›æœ¬è´¨æ˜¯åŸºäº session_id çš„å¤ç”¨</p><p>1ã€å¯¹äºå·²ç»å»ºç«‹çš„ SSL ä¼šè¯ï¼Œä½¿ç”¨ session_id ä¸º keyï¼Œmaster_secret ä¸º value ç»„æˆä¸€å¯¹é”®å€¼ï¼Œä¿å­˜åœ¨æœ¬åœ°ï¼ŒæœåŠ¡å™¨å’Œå®¢æˆ·ç«¯éƒ½ä¿å­˜ä¸€ä»½</p><p>2ã€å½“ç¬¬äºŒæ¬¡æ¡æ‰‹ï¼ˆå‘èµ·æ–°çš„è¿æ¥ï¼‰æ—¶ï¼Œå®¢æˆ·ç«¯è‹¥æƒ³ä½¿ç”¨ä¼šè¯å¤ç”¨ï¼Œåˆ™å°† client hello æ¶ˆæ¯ä¸­ session id è®¾ä¸ºç›¸åº”çš„å€¼</p><p>3ã€æœåŠ¡å™¨æ”¶åˆ°è¿™ä¸ª client helloï¼ŒæŸ¥æ‰¾æœ¬åœ°æ˜¯å¦æœ‰è¯¥ session_idï¼Œå¦‚æœæœ‰ï¼Œåˆ¤æ–­å½“å‰çš„åŠ å¯†å¥—ä»¶å’Œä¸Šä¸ªä¼šè¯çš„åŠ å¯†å¥—ä»¶æ˜¯å¦ä¸€è‡´ï¼Œä¸€è‡´åˆ™å…è®¸ä½¿ç”¨ä¼šè¯å¤ç”¨ï¼Œå°† server hello ä¸­ session_id ä¹Ÿè®¾ä¸ºç›¸åŒçš„å€¼ï¼Œç„¶åè®¡ç®—å¯¹ç§°ç§˜é’¥ï¼Œæ‰§è¡Œåç»­æ“ä½œ</p><p>4ã€å¦‚æœæœåŠ¡å™¨æœªæŸ¥åˆ°å®¢æˆ·ç«¯çš„ session_idï¼ˆå¯èƒ½æ˜¯ä¼šè¯å·²ç»è€åŒ–ï¼‰ï¼Œåˆ™ä¼šé‡æ–°æ¡æ‰‹ï¼Œsession id è¦ä¹ˆé‡æ–°è®¡ç®—ï¼ˆå’Œ client hello ä¸­çš„ä¸ä¸€æ ·ï¼‰ï¼Œè¦ä¹ˆç½®æˆ 0ï¼Œè¿™ä¸¤ä¸ªæ–¹å¼éƒ½ä¼šå‘Šè¯‰å®¢æˆ·ç«¯è¿™æ¬¡ä¼šè¯ä¸è¿›è¡Œä¼šè¯å¤ç”¨</p><h2 id="tls-ä¸-ssl-çš„å·®å¼‚"><a class="markdownIt-Anchor" href="#tls-ä¸-ssl-çš„å·®å¼‚"></a> TLS ä¸ SSL çš„å·®å¼‚</h2><p>1ã€ç‰ˆæœ¬å·ï¼šTLS è®°å½•æ ¼å¼ä¸ SSL è®°å½•æ ¼å¼ç›¸åŒï¼Œä½†ç‰ˆæœ¬å·çš„å€¼ä¸åŒï¼ŒTLSv1.0 ä½¿ç”¨çš„ç‰ˆæœ¬å·ä¸ºSSLv3.1</p><p>2ã€SSLv3.0 å’Œ TLS çš„ MAC ç®—æ³•åŠ MAC è®¡ç®—çš„èŒƒå›´ä¸åŒï¼šTLS ä½¿ç”¨äº† RFC 2104 å®šä¹‰çš„ HMAC ç®—æ³•ï¼›SSLv3.0 ä½¿ç”¨äº†ç›¸ä¼¼çš„ç®—æ³•ï¼Œä¸¤è€…å·®åˆ«åœ¨äº SSLv3.0 ä¸­ï¼Œå¡«å……å­—èŠ‚ä¸å¯†é’¥ä¹‹é—´é‡‡ç”¨çš„æ˜¯è¿æ¥è¿ç®—ï¼Œè€Œ HMAC ç®—æ³•é‡‡ç”¨çš„æ˜¯å¼‚æˆ–è¿ç®—</p><blockquote><p>ä½†æ˜¯ä¸¤è€…çš„å®‰å…¨ç¨‹åº¦æ˜¯ç›¸åŒçš„</p></blockquote><p>3ã€ä¼ªéšæœºå‡½æ•°ï¼šTLS ä½¿ç”¨ç§°ä¸º PRF çš„ä¼ªéšæœºå‡½æ•°æ¥å°†å¯†é’¥æ‰©å±•æˆæ•°æ®å—ï¼Œæ˜¯æ›´å®‰å…¨çš„æ–¹å¼</p><p>4ã€å‘Šè­¦ä»£ç ï¼šTLS æ”¯æŒå‡ ä¹æ‰€æœ‰çš„ SSLv3.0 æŠ¥è­¦ä»£ç ï¼Œè€Œä¸” TLS è¿˜è¡¥å……å®šä¹‰äº†å¾ˆå¤šæŠ¥è­¦ä»£ç </p><p>5ã€å¯†ç å¥—ä»¶å’Œå®¢æˆ·è¯ä¹¦ï¼šSSLv3.0 å’Œ TLS å­˜åœ¨å°‘é‡å·®åˆ«ï¼Œå³ TLS ä¸æ”¯æŒ Fortezza å¯†é’¥äº¤æ¢ã€åŠ å¯†ç®—æ³•å’Œå®¢æˆ·è¯ä¹¦</p><p>6ã€Certificate Verify å’Œ Finished æ¶ˆæ¯ï¼šSSLv3.0 å’Œ TLS åœ¨ç”¨ MD5 å’Œ SHA-1 è®¡ç®— Certificate Verify å’Œ Finished æ¶ˆæ¯ä¸­çš„ HMAC æ—¶ï¼Œè®¡ç®—çš„è¾“å…¥æœ‰å°‘è®¸å·®åˆ«ï¼Œä½†å®‰å…¨æ€§ç›¸å½“</p><p>7ã€åŠ å¯†è®¡ç®—ï¼šTLS ä¸ SSLv3.0 åœ¨è®¡ç®—ä¸»å¯†é’¥ï¼ˆmaster_secretï¼‰æ—¶é‡‡ç”¨çš„æ–¹å¼ä¸åŒ</p><p>8ã€ç”¨æˆ·æ•°æ®åŠ å¯†ä¹‹å‰éœ€è¦å¢åŠ çš„å¡«å……å­—èŠ‚ï¼šåœ¨ SSL ä¸­ï¼Œå¡«å……åçš„æ•°æ®é•¿åº¦è¦è¾¾åˆ°å¯†æ–‡å—é•¿åº¦çš„<strong>æœ€å°</strong>æ•´æ•°å€ï¼›åœ¨ TLS ä¸­ï¼Œå¡«å……åçš„æ•°æ®é•¿åº¦å¯ä»¥æ˜¯å¯†æ–‡å—é•¿åº¦çš„ä»»æ„æ•´æ•°å€ï¼ˆä½†å¡«å……çš„æœ€å¤§é•¿åº¦ä¸º 255 å­—èŠ‚ï¼‰ï¼Œè¿™ç§æ–¹å¼å¯ä»¥<strong>é˜²æ­¢åŸºäºæŠ¥æ–‡é•¿åº¦åˆ†æçš„æ”»å‡»</strong></p><h1 id="ssltls-å®‰å…¨å¨èƒ"><a class="markdownIt-Anchor" href="#ssltls-å®‰å…¨å¨èƒ"></a> SSL/TLS å®‰å…¨å¨èƒ</h1><h2 id="strip-æ”»å‡»"><a class="markdownIt-Anchor" href="#strip-æ”»å‡»"></a> Strip æ”»å‡»</h2><p>åŸºäºç”¨æˆ·ä¹ æƒ¯çš„å®‰å…¨å¨èƒ</p><p>Principleï¼šå¤šæ•°ç”¨æˆ·ä¸ä¼šä¸»åŠ¨è¯·æ±‚ SSL åè®®æ¥ä¿æŠ¤é€šä¿¡å†…å®¹ï¼Œå³ä¸ä¼šä¸»åŠ¨åœ¨æµè§ˆå™¨ä¸­è¾“å…¥ https è®¿é—®åŸŸåï¼›ä¸€èˆ¬æƒ…å†µä¸‹éƒ½æ˜¯åˆ˜æµè§ˆå™¨å¸®æˆ‘ä»¬é‡å®šå‘åˆ°å®‰å…¨çš„ https äº†</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20211126172249577.png" alt="image-20211126172249577" /></p><p>ä½†æ˜¯å¦‚æœé€šä¿¡ä¸­é—´å­˜åœ¨ä¸­é—´äººï¼Œé‚£å°±ä¼šè¢«æ¬ºéª—ï¼š</p><p>1ã€æ”»å‡»è€…åˆ©ç”¨ ARP æ¬ºéª—ç­‰æ–¹å¼æˆåŠŸç›‘å¬å®¢æˆ·ç«¯</p><p>2ã€å®¢æˆ·ç«¯å‘æœåŠ¡å™¨ç«¯å‘é€ http è¯·æ±‚ï¼Œæ”»å‡»è€…å¦‚å®è½¬å‘è¯·æ±‚</p><p>3ã€æœåŠ¡å™¨ç«¯å›å¤ https é“¾æ¥ç»™å®¢æˆ·ç«¯ï¼Œæ”»å‡»è€…æ”¶åˆ°è¯·æ±‚å¹¶å°†è¯¥é“¾æ¥ç¯¡æ”¹ä¸º http é“¾æ¥å›å¤ç»™å®¢æˆ·ç«¯</p><p>4ã€å®¢æˆ·ç«¯å†æ¬¡å‘é€ http è¯·æ±‚ç»™æœåŠ¡å™¨ç«¯ï¼Œæ”»å‡»è€…å°†å…¶æ”¹ä¸º https å‘é€è‡³æœåŠ¡å™¨ç«¯</p><p>5ã€å®¢æˆ·ç«¯ä¸æ”»å‡»è€…æ­¤æ—¶å»ºç«‹ä¸€ä¸ª http æ˜æ–‡é“¾æ¥ï¼Œæ”»å‡»è€…ä¸æœåŠ¡å™¨ç«¯å»ºç«‹ https åŠ å¯†é“¾æ¥ï¼Œæ”»å‡»è€…å› æ­¤å¯ä»¥è·å–å®¢æˆ·ç«¯çš„æ‰€æœ‰ä¿¡æ¯</p><blockquote><p>ç”¨æˆ·åˆ°æ”»å‡»è€…çš„è¿æ¥æ˜¯ httpï¼Œè€Œæ”»å‡»è€…å´é€šè¿‡ https è¿æ¥åˆ°å®‰å…¨æœåŠ¡å™¨ï¼Œè¿™å°±æ„å‘³ç€æµè§ˆå™¨ä¸Šè­¦å‘Šæç¤ºå·²ç»è¢«é˜»æ­¢ï¼Œæµè§ˆå™¨çœ‹èµ·æ¥æ­£å¸¸å·¥ä½œï¼Œåœ¨æ­¤æœŸé—´æ‰€æœ‰çš„ç”¨æˆ·æ•æ„Ÿä¿¡æ¯éƒ½å¯ä»¥è½»æ˜“è¢«æˆªè·</p><p>Tipsï¼šå„å¤§ä¸»æµæµè§ˆå™¨å¯¹æœªéƒ¨ç½² SSL è¯ä¹¦çš„ HTTP ç½‘ç«™ä¼šå‘å‡º ä¸å®‰å…¨ çš„è­¦å‘Šï¼Œä½†æ˜¯ç›®æ ‡ç½‘ç«™æ˜¯åˆæ³•çš„ï¼Œæ‰€ä»¥æµè§ˆå™¨è­¦å‘Šä¼šè¢«é˜»æ­¢</p></blockquote><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20211126172341706.png" alt="image-20211126172341706" /></p><h2 id="é‡åå•†æ”»å‡»"><a class="markdownIt-Anchor" href="#é‡åå•†æ”»å‡»"></a> é‡åå•†æ”»å‡»</h2><p>åŸºäºåè®®æ¼æ´çš„å®‰å…¨å¨èƒ</p><p>é‡åå•†æŒ‡å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨åœ¨å·²ç»åå•†å¥½çš„ SSL/TLS è¿æ¥ä¸Šé‡æ–°åå•†ï¼Œç”¨ä»¥æ›´æ¢ç®—æ³•ã€æ›´æ¢æ•°å­—è¯ä¹¦ã€é‡æ–°éªŒè¯å¯¹æ–¹èº«ä»½ã€æ›´æ–°å…±äº«å¯†é’¥ç­‰ç­‰ï¼›SSL/TLS åè®®æœ¬èº«æ”¯æŒé‡åå•†ï¼Œä¸” RFC å»ºè®® SSL/TLS å®ç°ï¼ˆOpenSSL ç­‰ï¼‰ä¹Ÿåº”è¯¥é»˜è®¤æ”¯æŒé‡åå•†</p><p>ä¸¤ç§åå•†æ–¹å¼ï¼šé‡åå•†éƒ½æ˜¯å®¢æˆ·ç«¯ä¸»åŠ¨å‘èµ·ï¼Œå¦‚æœæœåŠ¡å™¨æƒ³å‘èµ·ï¼Œé‚£ä¹ˆéœ€è¦å‘å®¢æˆ·ç«¯é€šçŸ¥</p><p>å›¾Aï¼šClientHello1 è¡¨ç¤ºé¦–æ¬¡åå•†ï¼›ClientHello2 è¡¨ç¤ºå®¢æˆ·ä¸»åŠ¨æå‡ºé‡åå•†ï¼›</p><p>å›¾Bï¼šClientHello1 è¡¨ç¤ºé¦–æ¬¡åå•†ï¼›Hello Requestï¼ŒæœåŠ¡å™¨è¯·æ±‚å®¢æˆ·ç«¯å‘èµ·é‡åå•†ï¼›ClientHello2 è¡¨ç¤ºå®¢æˆ·ä¸»åŠ¨æå‡ºé‡åå•†ï¼›</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20211126175358531.png" alt="image-20211126175358531" /></p><p>1ã€å®¢æˆ·ç«¯å‘å‡º ClientHello1 è¿›è¡Œé¦–æ¬¡åå•†</p><p>2ã€ä¸­é—´äººç¼“å­˜ ClientHello1ï¼Œè‡ªå·±æ„é€  ClientHello2ï¼Œå¯¹æœåŠ¡å™¨å‘èµ·é¦–æ¬¡åå•†</p><p>3ã€åå•†å¥½åä¸­é—´äººå°†ç²¾å¿ƒä¼ªé€ çš„æ•°æ®ç»™æœåŠ¡å™¨ï¼ˆæœåŠ¡å™¨çš„ APP ç¨‹åºé€šå¸¸éœ€è¦å¤„ç†ç²˜åŒ…ï¼Œæ‰€ä»¥ä¸­é—´äººå¯ä»¥æ„é€ ä¸å®Œæ•´çš„æ•°æ®ï¼Œè®© APP ç¨‹åºè®¤ä¸ºå‘ç”Ÿç²˜åŒ…è€Œæš‚ç¼“å¤„ç†æ•°æ®ï¼‰</p><blockquote><p>ç²˜åŒ…ï¼šæ•…æ„æ„é€ çš„ä¸å®Œæ•´æ•°æ®ï¼Œè®©æœåŠ¡åº”ç”¨ç¨‹åºå› ä¸ºä¸å®Œæ•´è€Œæš‚ç¼“å¤„ç†</p></blockquote><p>4ã€ä¸­é—´äººå°† ClientHello1 å‘é€ç»™æœåŠ¡å™¨ï¼ˆåœ¨åŒä¸€ä¸ªè¿æ¥ä¸­ï¼‰ï¼ŒæœåŠ¡å™¨æ”¶åˆ°åä¼šè®¤ä¸ºè¿™æ˜¯ä¸€æ¬¡é‡åå•†è¯·æ±‚</p><p>5ã€é‡åå•†å¥½åå®¢æˆ·ç«¯å‘é€çœŸæ­£çš„æ•°æ®ç»™æœåŠ¡å™¨ï¼ˆæœåŠ¡å™¨çš„ APP ç¨‹åºæ”¶åˆ°åï¼Œå°†å…¶ä¸ä¹‹å‰ç¼“å­˜çš„ä¸­é—´äººç²¾å¿ƒæ„é€ çš„æ•°æ®ç²˜åˆèµ·æ¥ï¼Œè¿›è¡Œä¸šåŠ¡å¤„ç†ï¼‰</p><p>è‡³æ­¤ï¼Œä¸­é—´äººåœ¨ä¸éœ€è¦åŠ«æŒæˆ–è§£å¯† SSL/TLS è¿æ¥çš„æƒ…å†µä¸‹ï¼ŒæˆåŠŸåœ°å°†è‡ªå·±ä¼ªé€ çš„æ•°æ®æ’å…¥åˆ°ç”¨æˆ·çœŸæ­£æ•°æ®ä¹‹å‰ï¼ˆæ•°æ®æ³¨å…¥ï¼‰</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20211126180212571.png" alt="image-20211126180212571" /></p><p>å…³é”®ç‚¹ï¼šå®¢æˆ·ç«¯è®¤ä¸ºçš„é¦–æ¬¡åå•†å´è¢«æœåŠ¡å™¨è®¤ä¸ºæ˜¯é‡åå•†ï¼Œé¦–æ¬¡åå•†å’Œé‡åå•†ç›´æ¥ç¼ºå°‘å…³è”æ€§</p><p>é˜²å¾¡ï¼š</p><p>1ã€ç¦ç”¨é‡åå•†</p><p>2ã€ç¦ç”¨ä¸å®‰å…¨çš„é‡åå•†è€Œå…è®¸å®‰å…¨é‡åå•†ï¼ˆéœ€è¦åœ¨é¦–æ¬¡åå•†æ—¶æºå¸¦â€œæ”¯æŒå®‰å…¨é‡åå•†â€æ ‡è¯†ï¼‰</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20211126180538546.png" alt="image-20211126180538546" /></p><p>3ã€å…è®¸å®‰å…¨é‡åå•†ï¼Œä½†æ˜¯åªå…è®¸åœ¨é¦–æ¬¡åå•†æ—¶æºå¸¦â€œæ”¯æŒå®‰å…¨é‡åå•†â€æ ‡è¯†ï¼Œå¹¶ä¸”ä¼šéªŒè¯ä¸¤æ¬¡åå•†æ—¶Finish æ¶ˆæ¯ä¸­çš„ verify_data æ˜¯å¦ä¸€è‡´</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/20211204193125.png" alt="" /></p><h2 id="ä¸‰æ¬¡æ¡æ‰‹æ”»å‡»"><a class="markdownIt-Anchor" href="#ä¸‰æ¬¡æ¡æ‰‹æ”»å‡»"></a> ä¸‰æ¬¡æ¡æ‰‹æ”»å‡»</h2><p>åŸºäºåè®®æ¼æ´çš„å®‰å…¨å¨èƒ</p><h3 id="é˜¶æ®µä¸€æœªçŸ¥å¯†é’¥å…±äº«"><a class="markdownIt-Anchor" href="#é˜¶æ®µä¸€æœªçŸ¥å¯†é’¥å…±äº«"></a> é˜¶æ®µä¸€ï¼šæœªçŸ¥å¯†é’¥å…±äº«</h3><p>1ã€å®¢æˆ·ç«¯è®¿é—®æ”»å‡»è€…æ­å»ºçš„<strong>å¸¦æœ‰è¯ä¹¦</strong>çš„æ¶æ„ç½‘ç«™ï¼ˆæ¯”å¦‚é’“é±¼ç½‘ç«™ç­‰ï¼‰</p><p>2ã€å®¢æˆ·ç«¯ç”Ÿæˆä¸€ä¸ªé¢„å¤‡ä¸»å¯†é’¥ï¼ˆä½¿ç”¨æ”»å‡»è€…å…¬é’¥åŠ å¯†ï¼‰å’Œä¸€ä¸ªéšæœºæ•°ï¼Œå‘é€ç»™æ”»å‡»è€…</p><blockquote><p>è¿™é‡Œå¯ä»¥çœ‹åšæ˜¯å®¢æˆ·ç«¯å’Œæ”»å‡»è€…å»ºç«‹ TLS</p></blockquote><p>3ã€æ¶æ„ç½‘ç«™å‘ç›®æ ‡ç½‘ç«™æœåŠ¡å™¨å‘èµ·è¿æ¥ï¼Œå¤ç”¨å®¢æˆ·ç«¯çš„é¢„å¤‡ä¸»å¯†é’¥ï¼ˆä½¿ç”¨æœåŠ¡å™¨å…¬é’¥åŠ å¯†ï¼‰å’Œéšæœºæ•°</p><blockquote><p>è¿™é‡Œå¤ç”¨å®¢æˆ·ç«¯é¢„å¤‡ä¸»å¯†é’¥å’Œéšæœºæ•°ï¼Œä¹Ÿå°±æ˜¯æ”»å‡»è€…ç”¨ç›¸åŒçš„å‚æ•°ä¸ç›®æ ‡æœåŠ¡å™¨å»ºç«‹ TLS</p></blockquote><p>4ã€æ¶æ„ç½‘ç«™å°†ç›®æ ‡æœåŠ¡å™¨çš„éšæœºæ•°ä¼ ç»™å®¢æˆ·ç«¯</p><blockquote><p>å°†ç›®æ ‡æœåŠ¡å™¨çš„ç›¸å…³å‚æ•°ä¹Ÿå‘Šè¯‰å®¢æˆ·ç«¯ä¸€ä»½</p></blockquote><p>5ã€å®¢æˆ·ç«¯ä¸æ”»å‡»è€…ã€æ”»å‡»è€…ä¸æœåŠ¡å™¨åˆ†åˆ«è¿›è¡Œè¯ä¹¦éªŒè¯ä¸å¯†é’¥åå•†</p><p>6ã€å¯†é’¥åå•†ç»“æŸåï¼Œå°†ä¼šå½¢æˆä¸¤ä¸ª TLS è¿æ¥ï¼Œé€šä¿¡ä¸‰æ–¹æ‹¥æœ‰ç›¸åŒä¸»å¯†é’¥ï¼ˆç”±ç›¸åŒçš„é¢„å¤‡ä¸»å¯†é’¥å’Œéšæœºæ•°ç”Ÿæˆï¼‰ï¼Œå…±äº«ç›¸åŒçš„è¿æ¥å‚æ•°</p><blockquote><p>ä½†æ˜¯ç”±äºä¸¤ä¸ªè¿æ¥ä½¿ç”¨çš„è¯ä¹¦æ˜¯ä¸ä¸€æ ·çš„ï¼Œè€Œä¸”æ¯ä¸ªè¿æ¥éƒ½æ‹¥æœ‰ä¸åŒçš„ verify_data å€¼ï¼Œè¿™å°±éœ€è¦åˆ©ç”¨ä¼šè¯æ¢å¤çš„æœºåˆ¶æ¥è¿›è¡Œä¸‹ä¸€æ­¥çš„ç ´è§£</p></blockquote><h3 id="é˜¶æ®µäºŒå…¨åŒæ­¥"><a class="markdownIt-Anchor" href="#é˜¶æ®µäºŒå…¨åŒæ­¥"></a> é˜¶æ®µäºŒï¼šå…¨åŒæ­¥</h3><p>1ã€å®¢æˆ·ç«¯å†æ¬¡å‘æ¶æ„ç½‘ç«™å‘èµ·è¯·æ±‚æ—¶ï¼Œå®¢æˆ·ç«¯ä¸æ¶æ„ç½‘ç«™ä¹‹é—´é‡‡ç”¨ä¼šè¯é‡ç”¨æœºåˆ¶ï¼Œä¸»å¯†é’¥ä¸å˜ï¼›æ¶æ„ç½‘ç«™ç›´æ¥è½¬å‘è¯·æ±‚åˆ°ç›®æ ‡ç½‘ç«™ï¼ŒåŒæ ·é‡‡ç”¨ä¼šè¯é‡ç”¨æœºåˆ¶</p><p>2ã€ä¸¤ä¸ªè¿æ¥åˆ†åˆ«ä½¿ç”¨ç›¸åŒçš„ä¸»å¯†é’¥å®ç°ä¼šè¯é‡ç”¨ï¼ˆ<strong>ä¼šè¯é‡ç”¨ä¸éœ€è¦è¯ä¹¦ï¼Œä»…ä½¿ç”¨ä¸»å¯†é’¥å°±å¯å®ç°é€šä¿¡åŒæ–¹çš„èº«ä»½éªŒè¯</strong>ï¼‰ï¼Œå¹¶ä¸”åå•†å‡ºç›¸åŒçš„è¿æ¥å‚æ•°</p><blockquote><p>ä»…æ£€æŸ¥ session_id æ˜¯å¦å­˜åœ¨ï¼ŒåŠ å¯†å‚æ•°æ˜¯å¦ä¸€è‡´</p></blockquote><p>3ã€ä¼šè¯é‡ç”¨ç»“æŸï¼Œä¸¤ä¸ªè¿æ¥çš„ Finish æ¶ˆæ¯ä¸€è‡´ï¼Œverify_data ç›¸åŒ</p><blockquote><p>åœ¨ä¼šè¯é‡ç”¨çš„æ—¶å€™ï¼Œä¸è¦æ±‚è¿›è¡Œè¯ä¹¦çš„éªŒè¯ï¼Œä¹Ÿæ²¡æœ‰èº«ä»½çš„éªŒè¯ã€‚è€Œä»…ä»…é€šè¿‡ä¸»å¯†é’¥è¿›è¡Œé€šè®¯åŒæ–¹çš„èº«ä»½è®¤è¯ï¼Œä»è€Œå¯¼è‡´åœ¨æ¡æ‰‹ç»“æŸçš„æ—¶å€™ï¼ŒFinishedæ¶ˆæ¯å°†ä¸€è‡´ï¼Œverify_dataç›¸åŒ</p></blockquote><h3 id="é˜¶æ®µä¸‰èº«ä»½ä»¿å†’"><a class="markdownIt-Anchor" href="#é˜¶æ®µä¸‰èº«ä»½ä»¿å†’"></a> é˜¶æ®µä¸‰ï¼šèº«ä»½ä»¿å†’</h3><p>1ã€æ”»å‡»è€…æµè§ˆåˆ°ä¸€ä¸ªéœ€è¦è¿›è¡Œèº«ä»½éªŒè¯çš„èµ„æºï¼ˆæ¯”å¦‚è½¬è´¦ï¼‰ï¼Œæäº¤ HTTP è¯·æ±‚ï¼›å¯¹æ­¤ï¼Œç›®æ ‡æœåŠ¡å™¨å‘å‡ºé‡åå•†è¯·æ±‚å¹¶è¦æ±‚<strong>å®¢æˆ·ç«¯æä¾›è¯ä¹¦</strong>(æ–°çš„è¿æ¥éœ€è¦é‡åå•†ï¼›è½¬è´¦è¯·æ±‚éœ€è¦å®¢æˆ·ç«¯è¯ä¹¦éªŒè¯èº«ä»½)</p><p>2ã€å› ä¸ºå®‰å…¨è¿æ¥å‚æ•°åœ¨ä¸¤ä¸ªè¿æ¥ä¸Šå‡ç›¸åŒï¼Œæ”»å‡»è€…å°±å¯ä»¥å¤åˆ¶æ¶ˆæ¯ï¼Œè®©å—å®³è€…å’Œç›®æ ‡æœåŠ¡å™¨è¿›è¡Œé‡åå•†ï¼›ç”±äºä¸¤ä¸ªè¿æ¥ä¸Šä¸€æ¬¡åå•†çš„ verify_data ç›¸åŒï¼Œæ»¡è¶³å®‰å…¨é‡åå•†è¦æ±‚ï¼Œé‡åå•†èƒ½å¤Ÿå®Œæˆ</p><p>3ã€é‡åå•†ç»“æŸï¼Œå®¢æˆ·ç«¯è¯ä¹¦é€šè¿‡éªŒè¯ï¼Œæ”»å‡»è€…ä¹‹å‰æäº¤çš„ HTTP è¯·æ±‚ï¼ˆè½¬è´¦ï¼‰è¢«æ‰§è¡Œï¼Œæ”»å‡»å®Œæˆ</p><p>æˆ–è€…</p><p>æ”»å‡»è€…æå‰å‘å®¢æˆ·ç«¯æµè§ˆå™¨æ³¨å…¥æ¶æ„ä»£ç ï¼Œå®Œå…¨æ§åˆ¶å®¢æˆ·ç«¯æµè§ˆå™¨ï¼šåœ¨é‡åå•†å®Œæˆä¹‹åï¼Œæ”»å‡»è€…èƒ½å¤Ÿä»¥å®¢æˆ·ç«¯çš„èº«ä»½å‘æœåŠ¡å™¨æäº¤ä¸å—é™åˆ¶çš„ HTTP è¯·æ±‚å¹¶ä¸”å¯ä»¥éšæ„è·å–ç»“æœï¼ˆæ¯”å¦‚æ•æ„Ÿçš„ä¼ä¸šæˆ–ä¸ªäººæ•°æ®ç­‰ï¼‰</p><blockquote><p>æ”»å‡»è€…å†å‘èµ·é‡åå•†ï¼Œåˆ©ç”¨å®¢æˆ·ç«¯çš„è¯ä¹¦ä¼ªé€ è‡ªå·±çš„èº«ä»½ï¼Œä»è€Œæ§åˆ¶ä¸¤è¾¹çš„è¿æ¥ï¼Œå‘é€ä»»æ„ä¿®æ”¹çš„æ•°æ®å†…å®¹ã€‚ä»è€Œå®Œæˆæ”»å‡»</p></blockquote><p><strong>å…³é”®ç‚¹</strong>ï¼š</p><p>æ”»å‡»èƒ½å¤ŸæˆåŠŸçš„åŸå› åœ¨äºé‡åå•†ä¹‹å‰å‘å¾€ç›®æ ‡æœåŠ¡å™¨çš„æ•°æ®æ˜¯ç”±æ”»å‡»è€…å‘å‡ºçš„ï¼Œä¹‹åçš„æ•°æ®æ˜¯ç”±ç»è¿‡èº«ä»½éªŒè¯çš„å—å®³è€…å‘å‡ºçš„ï¼Œè€Œç›®æ ‡æœåŠ¡å™¨å´æ— æ³•è¿›è¡ŒåŒºåˆ†</p><p>é˜²å¾¡ï¼šæœ€ç®€å•çš„æ–¹æ³•å°±æ˜¯ç¦æ­¢é‡åå•†</p><h2 id="å¿ƒè„æ»´è¡€"><a class="markdownIt-Anchor" href="#å¿ƒè„æ»´è¡€"></a> å¿ƒè„æ»´è¡€</h2><p>åŸºäºåè®®å®ç°çš„å®‰å…¨å¨èƒ</p><h1 id="cookies"><a class="markdownIt-Anchor" href="#cookies"></a> Cookies</h1><p>Qï¼šTLS æ˜¯å¦å¯ä»¥ç©¿è¿‡ Net</p><p>Aï¼šTLS æ˜¯ä¸€ç§åœ¨ TCP åè®®ä¹‹ä¸Šä¸ºä¸¤ä¸ªåº”ç”¨å±‚ç«¯å®ä½“ï¼ˆEnd Entityï¼‰ä¹‹é—´æä¾›å®‰å…¨é€šé“çš„åè®®ï¼Œå¹¶æœªæ¶‰åŠåˆ° IP å’Œ ç«¯å£ï¼Œå¯ä»¥ç©¿è¶Š Netï¼Œ</p><h1 id="refs"><a class="markdownIt-Anchor" href="#refs"></a> Refs</h1><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/hherima/article/details/52469674">å‚è€ƒ - CSDN -hherima - HTTPSåè®®è¯¦è§£(å››)ï¼šTLS/SSLæ¡æ‰‹è¿‡ç¨‹</a></p><p><a target="_blank" rel="noopener" href="https://www.wosign.com/FAQ/faq2016-0309-04.htm">å‚è€ƒ - wosign - HTTPSåŠ å¯†åè®®è¯¦è§£(å››)ï¼šTLS/SSLæ¡æ‰‹è¿‡ç¨‹</a></p>]]></content>
      
      
      <categories>
          
          <category> Protocol Security </category>
          
      </categories>
      
      
        <tags>
            
            <tag> security </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>TCP and TCP Security</title>
      <link href="/Coming-blog/2021/12/03/tcp-and-tcp-security/"/>
      <url>/Coming-blog/2021/12/03/tcp-and-tcp-security/</url>
      
        <content type="html"><![CDATA[<h1 id="tcp"><a class="markdownIt-Anchor" href="#tcp"></a> TCP</h1><p>TCPï¼ŒTransmission Control Protocolï¼Œä¼ è¾“æ§åˆ¶åè®®ï¼Œæ˜¯ä¸€ç§é¢å‘è¿æ¥çš„ã€å¯é çš„ã€åŸºäºå­—èŠ‚æµçš„ä¼ è¾“å±‚é€šä¿¡åè®®</p><p>ç›®æ ‡ï¼šèƒ½å¤ŸåŠ¨æ€åœ°é€‚åº”äº’è”ç½‘ç»œçš„ç‰¹æ€§ï¼ˆäº’è”ç½‘ç»œä¸åŒéƒ¨åˆ†å¯èƒ½æœ‰æˆªç„¶ä¸åŒçš„æ‹“æ‰‘ç»“æ„ã€å¸¦å®½ã€å»¶è¿Ÿã€æ•°æ®åŒ…å¤§å°å’Œå…¶ä»–å‚æ•°ï¼‰ï¼Œè€Œä¸”å…·å¤‡é¢å¯¹å„ç§æ•…éšœæ—¶çš„å¥å£®æ€§</p><blockquote><p>TCP ä¸æä¾›å¹¿æ’­å’Œå¤šæ’­æœåŠ¡ï¼Œå®ç°å¯é çš„é¢å‘è¿æ¥çš„é€šä¿¡ï¼Œä¸ä»…ä½¿åè®®æ•°æ®å•å…ƒçš„é¦–éƒ¨å¢å¤§å¾ˆå¤šï¼Œè¿˜è¦å ç”¨è®¸å¤šçš„å¤„ç†èµ„æº</p></blockquote><p>TCP ä¸åŒç‰ˆæœ¬ä¹‹é—´çš„å·®å¼‚ä¸»è¦åœ¨äºæ‹¥å¡æ§åˆ¶æœºåˆ¶</p><p>TCP çš„æ€§èƒ½é€šå¸¸ç”¨ ååç‡ å’Œ å…¬å¹³æ€§ æ¥è¡¡é‡</p><h2 id="æŠ¥æ–‡æ ¼å¼"><a class="markdownIt-Anchor" href="#æŠ¥æ–‡æ ¼å¼"></a> æŠ¥æ–‡æ ¼å¼</h2><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20211124181402976.png" alt="image-20211124181402976" /></p><p>1ã€æºç«¯å£ä¸ç›®çš„ç«¯å£ï¼Œå„ 2 å­—èŠ‚ï¼ˆ16bitï¼‰</p><p>2ã€åºå·å­—æ®µï¼Œ4 å­—èŠ‚ï¼ˆ32bitï¼‰ï¼ŒTCP è¿æ¥ä¸­ä¼ é€çš„æ•°æ®æµä¸­çš„æ¯ä¸€ä¸ªå­—èŠ‚éƒ½ç¼–ä¸Šä¸€ä¸ªåºå·ï¼Œåºå·å­—æ®µçš„å€¼åˆ™æŒ‡çš„æ˜¯æœ¬æŠ¥æ–‡æ®µæ‰€å‘é€çš„æ•°æ®çš„<strong>ç¬¬ä¸€ä¸ªå­—èŠ‚</strong>çš„åºå·</p><p>3ã€ç¡®è®¤å·å­—æ®µï¼Œ4 å­—èŠ‚ï¼ˆ32bitï¼‰ï¼Œæ˜¯æœŸæœ›æ”¶åˆ°å¯¹æ–¹çš„ä¸‹ä¸€ä¸ªæŠ¥æ–‡æ®µçš„æ•°æ®çš„ç¬¬ä¸€ä¸ªå­—èŠ‚çš„åºå·</p><p>4ã€æ•°æ®åç§»å­—æ®µï¼Œ4 bitï¼ŒæŒ‡å‡º TCP æŠ¥æ–‡æ®µçš„æ•°æ®èµ·å§‹å¤„è·ç¦» TCP æŠ¥æ–‡æ®µçš„èµ·å§‹å¤„æœ‰å¤šè¿œï¼Œå•ä½è·ç¦»ä¸º 4 å­—èŠ‚ï¼ˆ32bitï¼‰</p><blockquote><p>å› ä¸º TCP é¦–éƒ¨é•¿åº¦ä¸å›ºå®šï¼Œå› æ­¤å®é™…æŒ‡ä»£çš„å°±æ˜¯ TCP é¦–éƒ¨é•¿åº¦</p></blockquote><p>5ã€ä¿ç•™å­—æ®µï¼Œ6bit</p><p>6ã€ç´§æ€¥æ¯”ç‰¹ URGï¼Œ1bitï¼Œé«˜ä¼˜å…ˆçº§ä¼ è¾“</p><p>7ã€ç¡®è®¤æ¯”ç‰¹ ACKï¼Œ1bitï¼Œå½“ ACK=1 æ—¶ç¡®è®¤å·å­—æ®µæ‰æœ‰æ•ˆï¼Œå½“ ACK=0 æ—¶ï¼Œç¡®è®¤å·æ— æ•ˆ</p><p>8ã€æ¨é€æ¯”ç‰¹ PSHï¼Œ1bitï¼Œæ¥æ”¶ç«¯æ”¶åˆ°æ¨é€æ¯”ç‰¹ç½® 1 çš„æŠ¥æ–‡æ®µï¼Œå°±å°½å¿«åœ°äº¤ä»˜ç»™æ¥æ”¶åº”ç”¨è¿›ç¨‹ï¼Œè€Œä¸å†ç­‰åˆ°æ•´ä¸ªç¼“å­˜éƒ½å¡«æ»¡äº†åå†å‘ä¸Šäº¤ä»˜</p><p>9ã€å¤ä½æ¯”ç‰¹ RSTï¼Œ1bitï¼Œç½® 1 æ—¶è¡¨æ˜ TCP è¿æ¥å‡ºç°ä¸¥é‡å·®é”™ï¼Œå¿…é¡»é‡Šæ”¾è¿æ¥ï¼Œç„¶åå†é‡æ–°å»ºç«‹è¿æ¥</p><blockquote><p>æˆ–è€…æ”¶åˆ°æ— æ•ˆè¿æ¥æ—¶å‘ŠçŸ¥å¤ä½æ¸…é›¶</p></blockquote><p>10ã€åŒæ­¥æ¯”ç‰¹ SYNï¼Œ1bitï¼Œç½® 1 æ—¶è¡¨æ˜è¿™æ˜¯ä¸€ä¸ªè¿æ¥è¯·æ±‚(ACK=0, ç¬¬ä¸€æ¬¡æ¡æ‰‹)æˆ–è¿æ¥æ¥å—æŠ¥æ–‡(ACK=1, å‘ŠçŸ¥è¯·æ±‚è¢«æ¥å—)</p><p>11ã€ç»ˆæ­¢æ¯”ç‰¹ FINï¼Œ1bitï¼Œç½® 1 æ—¶è¡¨æ˜æ­¤æŠ¥æ–‡æ®µçš„å‘é€ç«¯çš„æ•°æ®å·²å‘é€å®Œæ¯•ï¼Œå¹¶è¦æ±‚é‡Šæ”¾è¿æ¥</p><blockquote><p>å­—æ®µçš„ç‰¹æ®Šç»„åˆæ˜¯é€ æˆæ”»å‡»çš„å¸¸ç”¨æ‰‹æ®µ</p></blockquote><p>12ã€çª—å£å­—æ®µï¼Œ2 å­—èŠ‚ï¼ˆ16bitï¼‰ï¼Œç”¨æ¥æ§åˆ¶å¯¹æ–¹å‘é€çš„æ•°æ®é‡ï¼Œå•ä½ä¸ºå­—èŠ‚</p><blockquote><p>Example:  TCP è¿æ¥çš„ä¸€ç«¯æ ¹æ®è®¾ç½®çš„ç¼“å­˜ç©ºé—´å¤§å°ç¡®å®šè‡ªå·±çš„æ¥æ”¶çª—å£å¤§å°ï¼Œç„¶åé€šçŸ¥å¯¹æ–¹ä»¥ç¡®å®šå¯¹æ–¹çš„å‘é€çª—å£ä¸Šé™</p></blockquote><p>13ã€æ£€éªŒå’Œï¼Œ2 å­—èŠ‚ï¼ˆ16bitï¼‰ï¼Œæ£€éªŒçš„èŒƒå›´åŒ…æ‹¬é¦–éƒ¨å’Œæ•°æ®è¿™ä¸¤éƒ¨åˆ†ï¼Œè®¡ç®—æ£€éªŒå’Œæ—¶ï¼Œè¦åœ¨ TCP æŠ¥æ–‡æ®µçš„å‰é¢åŠ ä¸Š 12 å­—èŠ‚çš„ä¼ªé¦–éƒ¨ï¼ˆä¸ UDP ç±»ä¼¼ï¼‰</p><p>14ã€ç´§æ€¥æŒ‡é’ˆå­—æ®µï¼Œ2 å­—èŠ‚ï¼ˆ16bitï¼‰ï¼ŒæŒ‡å‡ºåœ¨æœ¬æŠ¥æ–‡æ®µä¸­çš„ç´§æ€¥æ•°æ®çš„æœ€åä¸€ä¸ªå­—èŠ‚çš„åºå·</p><p>16ã€é€‰é¡¹å­—æ®µï¼Œæœ€å¤§é•¿åº¦å¯ä»¥è¾¾åˆ° 40 å­—èŠ‚ï¼Œç”¨äºé€‚åº”å¤æ‚çš„ç½‘ç»œç¯å¢ƒå’Œæ›´å¥½çš„æœåŠ¡åº”ç”¨å±‚</p><blockquote><p>Example ï¼škindï¼ˆ1 å­—èŠ‚ï¼‰+ lengthï¼ˆ1å­—èŠ‚ï¼‰+ infoï¼ˆn å­—èŠ‚ï¼‰</p></blockquote><p>17ã€å¡«å……ï¼Œè¡¥å……å­—èŠ‚æ®µï¼Œä¸ºäº†ä½¿æ•´ä¸ªé¦–éƒ¨é•¿åº¦æ˜¯ 4 å­—èŠ‚çš„æ•´æ•°å€</p><h2 id="å¸¸è§é€‰é¡¹å­—æ®µ"><a class="markdownIt-Anchor" href="#å¸¸è§é€‰é¡¹å­—æ®µ"></a> å¸¸è§é€‰é¡¹å­—æ®µ</h2><h3 id="mss"><a class="markdownIt-Anchor" href="#mss"></a> MSS</h3><p><strong>æœ€å¤§æŠ¥æ–‡æ®µé•¿åº¦ï¼ˆMSSï¼‰</strong>ï¼Œkind = 2ï¼Œlength=4ï¼Œinfo é•¿åº¦ä¸º 2 å­—èŠ‚ï¼Œè¡¨ç¤ºæ¯ä¸€ä¸ª TCP æŠ¥æ–‡æ®µä¸­æ•°æ®å­—æ®µçš„æœ€å¤§é•¿åº¦</p><blockquote><p>TCP ä¼šå°†åº”ç”¨å±‚äº¤ä»˜ä¸‹æ¥çš„æ•°æ®åˆ†ä¸º TCP è®¤ä¸ºæœ€é€‚åˆå‘é€çš„æ•°æ®å—ï¼ŒMSS çš„åˆç†å€¼åº”ä¸ºä¿è¯æ•°æ®åŒ…ä¸åˆ†ç‰‡çš„æœ€å¤§å€¼æ¯ä¸ªè·¯ç”±å™¨çš„ MSS ä¸ä¸€è‡´, å› æ­¤å¤§çš„ MSS ä¼ å‘å°çš„ MSS è·¯ç”±å™¨æ—¶, å¤§çš„æ•°æ®åŒ…(å·²ç»æ—¶åˆ†ç»„åçš„äº†) å°±è¦è¿›è¡Œåˆ†ç‰‡ä¼—å¤šçš„åˆ†ç‰‡ä¼šåœ¨ç›®æ ‡æœºå™¨ä¸Šè¿›è¡Œé‡ç»„åˆ†ç‰‡ä¼šé€ æˆåŒ…å¤´çš„å†—ä½™, å¯¼è‡´çœŸå®ä¼ è¾“çš„æ•°æ®å¢å¤š, æ•ˆç‡é™ä½</p></blockquote><p>TCPåœ¨ä¸‰æ¬¡æ¡æ‰‹ä¸­ï¼Œæ¯ä¸€æ–¹éƒ½ä¼šé€šå‘Šå…¶æœŸæœ›æ”¶åˆ°çš„ MSS ( MSS åªå‡ºç°åœ¨ SYN æ•°æ®åŒ…ä¸­)ï¼Œå¦‚æœä¸€æ–¹ä¸æ¥å—å¦ä¸€æ–¹çš„ MSS å€¼åˆ™å®šä½é»˜è®¤å€¼ 536 = 576 - 20 - 20 ï¼ˆIPæ•°æ®æŠ¥é¦–éƒ¨ï¼ˆ20 byteï¼‰ï¼ŒTCP é¦–éƒ¨ï¼ˆ20 byteï¼‰ï¼‰</p><h3 id="windows-scaling"><a class="markdownIt-Anchor" href="#windows-scaling"></a> Windows Scaling</h3><p><strong>çª—å£æ‰©å¤§é€‰é¡¹ï¼ŒWindows Scaling</strong> ï¼Œkind = 3ï¼Œlength = 3ï¼Œinfo é•¿åº¦ä¸º 1 å­—èŠ‚ï¼Œå¤æ‚ç½‘ç»œéœ€è¦æ›´å¤§çš„çª—å£æ¥æ»¡è¶³æ€§èƒ½å’Œæé«˜ååç‡</p><p>Tipsï¼šçª—å£æ§åˆ¶æ€»æ•°æ®é‡ï¼ŒMSS æ§åˆ¶å¦‚ä½•åˆ†æ®µå‘é€</p><blockquote><p>é»˜è®¤æƒ…å†µä¸‹ TCP æœ€å¤§çš„çª—å£å¤§å°ä¸º 64 kbï¼Œçª—å£æ‰©å¤§é€‰é¡¹è¡¨ç¤ºæŠŠ TCP é¦–éƒ¨çš„çª—å£ä½æ•°ä» 16 å¢å¤§åˆ° ï¼ˆ16 + infoï¼‰</p><p>info å‡†è®¸ä½¿ç”¨çš„æœ€å¤§å€¼æ˜¯ 14ï¼Œç›¸å½“äºçª—å£æœ€å¤§å€¼å¢å¤§åˆ° 65535ï¼ˆ16ä½ï¼‰ * 2^14 ä¹Ÿå°±æ˜¯ 1 GB</p><p>çª—å£æ‰©å¤§é€‰é¡¹åœ¨ TCP å»ºç«‹ä¹‹åˆè¿›è¡Œåå•†ï¼Œå¦‚æœå·²ç»å®ç°äº†çª—å£æ‰©å¤§ï¼Œå½“ä¸å†éœ€è¦å…¶æ‰©å¤§çª—å£æ—¶ï¼Œå‘é€ info = 0 é€‰é¡¹å°±å¯ä»¥æ¢å¤åˆ°çª—å£ä½æ•°å¤§å° 16</p></blockquote><h3 id="sack"><a class="markdownIt-Anchor" href="#sack"></a> SACK</h3><p><strong>é€‰æ‹©ç¡®è®¤é€‰é¡¹ï¼ŒSACK</strong></p><p>1ã€kind = 4ï¼Œlength = 2ï¼Œç”¨äºæ ‡è¯†æ˜¯å¦æ”¯æŒ SACKï¼Œåœ¨ TCP å»ºç«‹è¿æ¥æ—¶å‘é€</p><p>2ã€kind = 5ï¼Œlength = N * 8 + 2ï¼Œæ—¶ï¼Œè¡¨ç¤ºå…·ä½“çš„ SACK ä¿¡æ¯</p><p>ç›®æ ‡ï¼šåªé‡ä¼ åºåˆ—å·ç¼ºå¤±çš„æŠ¥æ–‡æ®µï¼Œè€Œä¸æ˜¯é‡ä¼ æ‰€æœ‰æœªç¡®è®¤çš„æŠ¥æ–‡æ®µ</p><blockquote><p>é»˜è®¤æƒ…å†µ TCP é‡‡å–çš„æ˜¯ç´¯ç§¯ç¡®è®¤æœºåˆ¶ï¼ˆä¸å¯¹æ¯ä¸ªæ¥æ”¶åˆ°çš„åŒ…éƒ½ç¡®è®¤ï¼Œä¸€ä¸ªç¡®è®¤å¯ä»¥ç¡®è®¤å¤šä¸ªè¿ç»­æ¥æ”¶çš„åŒ…ï¼‰</p></blockquote><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20211124184833382.png" alt="image-20211124184833382" /></p><p>é€‰é¡¹å­—æ®µæœ€å¤§ä¸èƒ½è¶…è¿‡ 40ï¼Œä¸€ä¸ªè¾¹æ²¿çª—å£è¡¨ç¤ºéœ€è¦éœ€è¦ 4 å­—èŠ‚ï¼ˆè¡¨ç¤ºåºå·ï¼‰ï¼Œä¸€å¯¹å°±éœ€è¦ 8 å­—èŠ‚ï¼Œå› æ­¤æœ€å¤šæŒ‡ç¤º 4 ä¸ªç¼ºå¤±æŠ¥æ–‡æ®µï¼ˆ32 + 2ï¼ˆkeyï¼Œlengthï¼‰ï¼‰</p><h2 id="ç¡®è®¤ä¸é‡ä¼ æœºåˆ¶"><a class="markdownIt-Anchor" href="#ç¡®è®¤ä¸é‡ä¼ æœºåˆ¶"></a> ç¡®è®¤ä¸é‡ä¼ æœºåˆ¶</h2><p>è¿æ¥å»ºç«‹æ—¶åŒæ–¹ä¼šå®Œæˆåˆå§‹åºå·çš„åå•†ï¼ŒTCP æ¯æ¬¡å‘é€æŠ¥æ–‡æ®µä¸­é¦–éƒ¨åºå·è¡¨ç¤ºè¯¥æŠ¥æ–‡æ®µä¸­çš„æ•°æ®éƒ¨åˆ†çš„ç¬¬ä¸€ä¸ªå­—èŠ‚çš„åºå·ï¼›</p><p>TCP çš„ç¡®è®¤æ˜¯å¯¹æ¥æ”¶åˆ°çš„è¿ç»­æ•°æ®çš„æœ€é«˜åºå·ï¼ˆä¼ è¿‡å»è¦ + 1ï¼‰è¡¨ç¤ºç¡®è®¤ï¼ˆç´¯ç§¯ç¡®è®¤æœºåˆ¶ï¼‰</p><p>TCP æ¯å‘é€ä¸€ä¸ªæŠ¥æ–‡æ®µï¼Œå°±å¯¹è¿™ä¸ªæŠ¥æ–‡æ®µè®¾ç½®ä¸€æ¬¡è®¡æ—¶å™¨ï¼Œåªè¦è®¡æ—¶å™¨è®¾ç½®çš„è¶…æ—¶é‡ä¼ æ—¶é—´ï¼ˆRTOï¼‰è¿˜æ²¡æœ‰æ”¶åˆ°ç¡®è®¤ï¼Œå°±è¦é‡ä¼ è¿™ä¸€æŠ¥æ–‡æ®µ</p><blockquote><p>RTTï¼Œå¾€è¿”æ—¶å»¶RTOï¼Œè¶…æ—¶é‡ä¼ æ—¶é—´ï¼Œä¸èƒ½è¿‡å°ï¼ˆæ•ˆç‡ä½ï¼‰ä¹Ÿä¸èƒ½è¿‡å¤§ï¼ˆç½‘ç»œæ‹¥å¡ï¼‰ï¼Œå…¶è®¾ç½®è¦åŸºäº RTTï¼Œè‡³å°‘åº”ä¿è¯ RTO &gt; RTT</p></blockquote><h3 id="rtt-è‡ªé€‚åº”ç®—æ³•"><a class="markdownIt-Anchor" href="#rtt-è‡ªé€‚åº”ç®—æ³•"></a> RTT è‡ªé€‚åº”ç®—æ³•</h3><p>1ã€è®°å½•æ¯ä¸€ä¸ªæŠ¥æ–‡æ®µå‘å‡ºçš„æ—¶é—´ï¼Œä»¥åŠæ”¶åˆ°ç›¸åº”çš„ç¡®è®¤æŠ¥æ–‡æ®µçš„æ—¶é—´ï¼Œè¿™ä¸¤ä¸ªæ—¶é—´ä¹‹å·®å°±æ˜¯æŠ¥æ–‡æ®µçš„<strong>å¾€è¿”æ—¶å»¶ RTT</strong></p><p>2ã€å°†å„ä¸ªæŠ¥æ–‡æ®µçš„å¾€è¿”æ—¶å»¶æ ·æœ¬åŠ æƒå¹³å‡ï¼Œå°±å¾—å‡ºæŠ¥æ–‡æ®µçš„<strong>å¹³å‡å¾€è¿”æ—¶å»¶ RTT</strong>ï¼Œ<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>R</mi><mi>a</mi></msub></mrow><annotation encoding="application/x-tex">R_a</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.00773em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">a</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></p><p>3ã€æ¯æµ‹é‡åˆ°ä¸€ä¸ªæ–°çš„å¾€è¿”æ—¶å»¶æ ·æœ¬ï¼Œå…¶æ—¶å»¶ä¸º <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>R</mi><mi>n</mi></msub></mrow><annotation encoding="application/x-tex">R_n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.00773em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">n</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>ï¼Œå°±æŒ‰ä¸‹å¼é‡æ–°è®¡ç®—ä¸€æ¬¡<strong>å¹³å‡å¾€è¿”æ—¶å»¶ RTT</strong>ï¼Œ<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msubsup><mi>R</mi><mi>n</mi><mo mathvariant="normal">â€²</mo></msubsup></mrow><annotation encoding="application/x-tex">R_n&#x27;</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.998892em;vertical-align:-0.247em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-2.4530000000000003em;margin-left:-0.00773em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">n</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span></span></span></span></p><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msubsup><mi>R</mi><mi>a</mi><mo mathvariant="normal">â€²</mo></msubsup><mo>=</mo><mi>Î±</mi><msub><mi>R</mi><mi>a</mi></msub><mo>+</mo><mo stretchy="false">(</mo><mn>1</mn><mo>âˆ’</mo><mi>Î±</mi><mo stretchy="false">)</mo><msub><mi>R</mi><mi>n</mi></msub></mrow><annotation encoding="application/x-tex">R_a&#x27; = \alpha R_a + (1 - \alpha) R_n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.048892em;vertical-align:-0.247em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8018919999999999em;"><span style="top:-2.4530000000000003em;margin-left:-0.00773em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">a</span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord mathdefault" style="margin-right:0.0037em;">Î±</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.00773em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">a</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.0037em;">Î±</span><span class="mclose">)</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.00773em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">n</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span></p><blockquote><p>è‹¥ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>Î±</mi><mo>â†’</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">\alpha \rightarrow 1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.0037em;">Î±</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">â†’</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span> è¡¨ç¤ºæ–°çš„ RTT æ ·æœ¬å¯¹ RTT çš„å½±å“ä¸å¤§ï¼ŒRTT çš„å€¼æ›´æ–°å°±è¾ƒæ…¢</p><p>è‹¥ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>Î±</mi><mo>â†’</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">\alpha \rightarrow 0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.0037em;">Î±</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">â†’</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span></span></span></span> è¡¨ç¤ºæ–°çš„ RTT æ ·æœ¬å¯¹ RTT çš„å½±å“è¾ƒå¤§ï¼ŒRTT çš„å€¼æ›´æ–°å°±è¾ƒå¿«</p><p>å¸¸ç”¨çš„ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>Î±</mi><mo>=</mo><mfrac><mn>7</mn><mn>8</mn></mfrac></mrow><annotation encoding="application/x-tex">\alpha = \frac{7}{8}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.0037em;">Î±</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.190108em;vertical-align:-0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.845108em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">8</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">7</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span>IMA{ã€}</p></blockquote><p>Tips ï¼šKarn ç®—æ³•æŒ‡å‡ºï¼Œå¦‚æœæŠ¥æ–‡æ®µé‡ä¼ äº†å°±ä¸é‡‡ç”¨è¯¥æ ·æœ¬è®¡ç®—å¹³å‡å¾€è¿”ï¼Œå› ä¸ºæˆ‘æ”¶åˆ°çš„å“åº”ä¸çŸ¥é“æ˜¯ä¸€å¼€å§‹å‘è¿‡å»æŠ¥æ–‡çš„å“åº”è¿˜æ˜¯åˆšåˆšå‘è¿‡å»æŠ¥æ–‡çš„å“åº”</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/20211203181313.png" alt="Karn ç®—æ³•æ¥ç”±" /></p><p>ä½†æ˜¯å¦‚æœä¸ç®—é‡ä¼ çš„åŒ…ï¼Œå½“ç½‘ç»œçœŸçš„ç‰¹åˆ«æ‹¥å¡çš„æ—¶å€™å…¨æ˜¯é‡ä¼ çš„åŒ…æ€ä¹ˆåŠï¼Ÿ</p><p>Tips ï¼šä¿®æ­£åçš„ Karn ç®—æ³•ï¼ŒæŠ¥æ–‡æ®µæ¯é‡ä¼ ä¸€æ¬¡ï¼Œå°±å°† RTO å¢å¤§ä¸€äº›ï¼ˆå…¸å‹å€¼æ˜¯ç¿»å€ï¼‰ï¼›å½“ä¸å†å‘ç”Ÿé‡ä¼ æ—¶ï¼Œæ‰æ ¹æ® RTT æ›´æ–°å¹³å‡ RTT å’Œ RTO çš„å€¼ã€‚<strong>å®è·µè¯æ˜ï¼Œè¿™ç§ç­–ç•¥è¾ƒä¸ºåˆç†ã€‚</strong></p><h3 id="rto-çš„è®¾å®š"><a class="markdownIt-Anchor" href="#rto-çš„è®¾å®š"></a> RTO çš„è®¾å®š</h3><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>R</mi><mi>T</mi><mi>O</mi><mo>=</mo><mi>Î²</mi><mo>Ã—</mo><mi>R</mi><mi>T</mi><mi>T</mi><mtext>Â Â withÂ Â </mtext><mi>Î²</mi><mo>&gt;</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">RTO = \beta \times RTT\ \ \text{with}\ \ \beta &gt; 1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.00773em;">R</span><span class="mord mathdefault" style="margin-right:0.13889em;">T</span><span class="mord mathdefault" style="margin-right:0.02778em;">O</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.05278em;">Î²</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">Ã—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.00773em;">R</span><span class="mord mathdefault" style="margin-right:0.13889em;">T</span><span class="mord mathdefault" style="margin-right:0.13889em;">T</span><span class="mspace">Â </span><span class="mspace">Â </span><span class="mord text"><span class="mord">with</span></span><span class="mspace">Â </span><span class="mspace">Â </span><span class="mord mathdefault" style="margin-right:0.05278em;">Î²</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span></span></p><p>æ¨èå–å€¼ä¸º 2</p><h2 id="æµé‡æ§åˆ¶"><a class="markdownIt-Anchor" href="#æµé‡æ§åˆ¶"></a> æµé‡æ§åˆ¶</h2><p>å±äºæ¥æ”¶ç«¯ï¼šTCP é‡‡ç”¨å¤§å°å¯å˜çš„æ»‘åŠ¨çª—å£è¿›è¡Œæµé‡æ§åˆ¶ï¼Œçª—å£å¤§å°çš„å•ä½æ˜¯å­—èŠ‚ï¼Œå¯ä»¥åŠ¨æ€æ›´æ”¹çª—å£çš„å¤§å°</p><h2 id="æ‹¥å¡æ§åˆ¶"><a class="markdownIt-Anchor" href="#æ‹¥å¡æ§åˆ¶"></a> æ‹¥å¡æ§åˆ¶</h2><p>å±äºå‘é€ç«¯ï¼šæ…¢å¯åŠ¨ã€æ‹¥å¡é¿å…ã€è¶…æ—¶é‡ä¼ ã€å¿«é€Ÿé‡ä¼ å’Œå¿«é€Ÿæ¢å¤å…±åŒç»„æˆäº† TCP çš„æ‹¥å¡æ§åˆ¶æœºåˆ¶</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20211124202040056.png" alt="image-20211124202040056" /></p><p>å‘é€ç«¯åœ¨ç¡®è®¤æŠ¥æ–‡æ®µå‘é€é€Ÿç‡æ—¶ï¼Œæ—¢è¦è€ƒè™‘æ¥æ”¶ç«¯çš„æ¥æ”¶èƒ½åŠ›ï¼Œåˆè¦ä»å…¨å±€è€ƒè™‘ä¸è¦ä½¿ç½‘è·¯å‘ç”Ÿæ‹¥å¡ï¼Œå› æ­¤æ¯ä¸€ä¸ª TCP è¿æ¥éœ€è¦è€ƒè™‘æ¥æ”¶çª—å£ä¸æ‹¥å¡çª—å£çš„è®¾å®šå€¼</p><p>æ¥æ”¶çª—å£ï¼šrwndï¼Œreceiver windowï¼Œæ˜¯æ¥æ”¶ç«¯æ ¹æ®å…¶ç›®å‰çš„æ¥æ”¶ç¼“å­˜å¤§å°æ‰€å…è®¸çš„æœ€æ–°çš„çª—å£å€¼ï¼Œæ˜¯æ¥è‡ªæ¥æ”¶ç«¯çš„æµé‡æ§åˆ¶ã€‚æ¥æ”¶ç«¯å°†æ­¤çª—å£å€¼æ”¾åœ¨ TCPæŠ¥æ–‡çš„é¦–éƒ¨ä¸­çš„çª—å£å­—æ®µï¼Œä¼ é€ç»™å‘é€ç«¯</p><p>æ‹¥å¡çª—å£ï¼šcwndï¼Œæ˜¯å‘é€ç«¯æ ¹æ®è‡ªå·±ä¼°è®¡çš„ç½‘ç»œæ‹¥å¡ç¨‹åº¦è€Œè®¾ç½®çš„çª—å£å€¼ï¼Œæ˜¯æ¥è‡ªå‘é€ç«¯çš„æµé‡æ§åˆ¶</p><p>å‘é€çª—å£çš„ä¸Šé™å€¼ï¼šmin(rwnd, cwnd)ï¼Œå› æ­¤å½“ rwnd &lt; cwnd æ—¶ï¼Œæ˜¯æ¥æ”¶ç«¯çš„æ¥æ”¶èƒ½åŠ›é™åˆ¶å‘é€èƒ½åŠ›ï¼›å½“ cwnd &lt; rwnd æ—¶ï¼Œåˆ™æ˜¯ç½‘ç»œçš„æ‹¥å¡ç¨‹åº¦é™åˆ¶å‘é€èƒ½åŠ›</p><p>Qï¼šä¸ºä»€ä¹ˆ TCP è¦å»ä¸»åŠ¨è€ƒè™‘å…¨å±€ç½‘è·¯æ‹¥å¡çŠ¶å†µï¼Ÿ</p><p>Aï¼šäº’è”ç½‘å°±åƒæ˜¯æ²¡æœ‰çº¢ç»¿ç¯çš„äº¤å‰è·¯å£ï¼Œä¸ºäº†å®ç°ç½‘ç»œçš„æ­£å¸¸ä½¿ç”¨ï¼Œå¿…é¡»è¦æœ‰è´£ä»»æ„Ÿï¼Œå› æ­¤ TCP ä½œä¸ºäº’è”ç½‘ç«¯åˆ°ç«¯æ‹¥å¡æ§åˆ¶çš„å®ä½“ï¼Œå¯¹é¿å…äº’è”ç½‘å› æ‹¥å¡è€Œå´©æºƒæœ‰ç€ä¸å¯æ›¿ä»£çš„ä½œç”¨ï¼›</p><h3 id="æ…¢å¯åŠ¨ç®—æ³•"><a class="markdownIt-Anchor" href="#æ…¢å¯åŠ¨ç®—æ³•"></a> æ…¢å¯åŠ¨ç®—æ³•</h3><p>Slow Startï¼Œæ…¢å¯åŠ¨å¹¶ä¸æ…¢ï¼Œæ˜¯æŒ‡æ•°ä¸Šå‡çš„</p><p>1ã€åˆšå¼€å§‹å…ˆå°†æ‹¥å¡çª—å£ cwnd è®¾ç½®ä¸ºä¸€ä¸ªæœ€å¤§æŠ¥æ–‡æ®µ MSS çš„æ•°å€¼</p><p>2ã€æ¯æ”¶åˆ°ä¸€ä¸ªå¯¹æ–°çš„æŠ¥æ–‡æ®µçš„ç¡®è®¤åï¼Œå°†æ‹¥å¡çª—å£å¢åŠ è‡³å¤šä¸€ä¸ª MSS çš„æ•°å€¼</p><p>3ã€é€æ­¥å¢å¤§æ‹¥å¡çª—å£ cwndï¼Œä½¿æŠ¥æ–‡æ®µæ³¨å…¥ç½‘ç»œçš„é€Ÿç‡æ›´åŠ åˆç†</p><h3 id="æ‹¥å¡é¿å…ç®—æ³•"><a class="markdownIt-Anchor" href="#æ‹¥å¡é¿å…ç®—æ³•"></a> æ‹¥å¡é¿å…ç®—æ³•</h3><p>Congestion Avoidance</p><p>åŠ æ€§å¢åŠ ï¼šAdditive Increaceï¼Œå½“æ”¶åˆ°å¯¹å½“å‰å‘é€çª—å£ä¸­<strong>æ‰€æœ‰</strong>æŠ¥æ–‡æ®µçš„ç¡®è®¤æ—¶å°±å°† cwnd å¢åŠ ä¸€ä¸ªMSSå¤§å°ï¼Œä½¿æ‹¥å¡çª—å£ç¼“æ…¢å¢å¤§ï¼Œä»¥é˜²æ­¢ç½‘ç»œè¿‡æ—©å‡ºç°æ‹¥å¡</p><p>ä¹˜æ€§å‡å°‘ï¼šMultiplicative Decreaseï¼Œåªè¦å‡ºç°ä¸€æ¬¡è¶…æ—¶ï¼ˆå³å‡ºç°ä¸€æ¬¡ç½‘ç»œæ‹¥å¡ï¼‰ï¼Œå°±æŠŠæ…¢å¯åŠ¨é—¨é™å€¼ ssthresh è®¾ç½®ä¸ºå½“å‰ cwnd çš„ä¸€åŠã€‚å½“ç½‘ç»œé¢‘ç¹å‡ºç°æ‹¥å¡æ—¶ ssthresh å€¼ä¼šä¸‹é™å¾ˆå¿«ï¼Œä»¥å¤§å¤§å‡å°‘æ³¨å…¥ç½‘ç»œä¸­çš„æŠ¥æ–‡æ®µæ•°é‡</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20211124195558661.png" alt="image-20211124195558661" /></p><p>1ã€æ…¢å¯åŠ¨é—¨é™ ssthresh çš„åˆå§‹å€¼è®¾ä¸º16ä¸ªæŠ¥æ–‡æ®µï¼Œcwnd åˆå§‹åŒ–ä¸º 1ï¼ˆæ…¢å¯åŠ¨ï¼‰</p><p>2ã€å…ˆå‘é€ M1ï¼Œæ”¶åˆ° M1 çš„ç¡®è®¤åï¼Œcwnd å°†å¢å¤§åˆ° 2</p><p>3ã€éšåå‘é€ M2ï¼ŒM3ï¼Œæ”¶åˆ° M2 å’Œ M3 çš„ç¡®è®¤åï¼Œcwnd å°†å¢åŠ  2ï¼Œå› æ­¤å¢åŠ åˆ° 4</p><p>4ã€ä»¥æ­¤ç±»æ¨ï¼Œcwnd å°†æŒ‰æŒ‡æ•°å¢é•¿ï¼Œç›´åˆ° cwnd å¢åŠ åˆ° ssthresh ï¼Œæ”¹ä¸ºæ‹¥å¡é¿å…ç®—æ³•</p><p>5ã€æ”¶åˆ°å¯¹å½“å‰å‘é€çª—å£ä¸­æ‰€æœ‰æŠ¥æ–‡æ®µçš„ç¡®è®¤æ—¶æ‰ä¼šå¢åŠ ä¸€ä¸ª MSS å¤§å°</p><p>6ã€å¢åŠ åˆ° 24 æ—¶ï¼Œç½‘ç»œæ‹¥å¡äº†ï¼Œæ”¹ç”¨ä¹˜æ€§å‡å°‘</p><p>7ã€ssthresh å°†å˜ä¸ºå½“å‰ cwnd çš„ä¸€åŠï¼Œå³ ssthresh = 12ï¼Œç„¶åå°† cwnd ç½®ä¸º 1ï¼Œé‡æ–°å¼€å§‹æ…¢å¯åŠ¨</p><h3 id="å¿«é€Ÿé‡ä¼ ç®—æ³•"><a class="markdownIt-Anchor" href="#å¿«é€Ÿé‡ä¼ ç®—æ³•"></a> å¿«é€Ÿé‡ä¼ ç®—æ³•</h3><p>æ›¿ä»£è¶…æ—¶é‡ä¼ ï¼Œè¶…æ—¶é‡ä¼ éœ€è¦ç­‰å¾… RTOï¼Œå› æ­¤ä¼šé€ æˆä¸€å®šçš„æ—¶é—´æµªè´¹</p><p>å¿«é€Ÿé‡ä¼ ç®—æ³•ï¼šè¦æ±‚æœåŠ¡å™¨å¦‚æœæ”¶åˆ°ä¹±åºçš„åŒ…ï¼Œä¹Ÿç»™å®¢æˆ·ç«¯å›å¤ ACKï¼Œåªä¸è¿‡æ˜¯é‡å¤çš„ ACKï¼Œå½“å‘é€ç«¯æ”¶åˆ°ä¸‰ä¸ªé‡å¤ ACKï¼ˆduplicate ACKï¼‰æ—¶ï¼Œå³è®¤ä¸ºæœ‰æŠ¥æ–‡æ®µä¸¢å¤±ï¼Œå‘é€ç«¯ä¼šç«‹å³é‡ä¼ ä¸¢å¤±çš„æŠ¥æ–‡æ®µï¼ˆæ ¹æ® ACKï¼‰è€Œä¸å¿…ç»§ç»­ç­‰å¾…ä¸ºè¯¥æŠ¥æ–‡æ®µè®¾ç½®çš„é‡ä¼ è®¡æ—¶å™¨çš„è¶…æ—¶ï¼ŒåŒæ—¶å°† ssthresh è®¾ç½®ä¸ºå½“å‰ cwnd å€¼çš„ä¸€åŠï¼Œå¹¶ä¸”å°† cwnd å‡ä¸ºåŸå…ˆçš„ä¸€åŠ</p><blockquote><p>å¿«é‡ä¼ å¹¶éå–æ¶ˆé‡ä¼ è®¡æ—¶å™¨ï¼Œè€Œæ˜¯åœ¨æŸäº›æƒ…å†µä¸‹å¯æ›´æ—©åœ°é‡ä¼ ä¸¢å¤±çš„æŠ¥æ–‡æ®µ</p></blockquote><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20211124200423436.png" alt="image-20211124200423436" /></p><p>æ‰©å±•ï¼šèƒ½è¿›ä¸€æ­¥æ”¹è¿›çš„å°±æ˜¯å¹¶ä¸è¦å°† ACK æŒ‡ä»£çš„æ•°æ®æŠ¥åçš„æ‰€æœ‰æ•°æ®åŒ…å…¨éƒ¨é‡ä¼ ï¼Œæˆ‘é€‰æ‹©æ€§çš„é‡ä¼ ï¼Œä½¿ç”¨ SACK é€‰é¡¹å­—æ®µå³å¯</p><h3 id="å¿«é€Ÿæ¢å¤ç®—æ³•"><a class="markdownIt-Anchor" href="#å¿«é€Ÿæ¢å¤ç®—æ³•"></a> å¿«é€Ÿæ¢å¤ç®—æ³•</h3><p>å¿«é€Ÿé‡ä¼ çš„ä¸‹ä¸€é˜¶æ®µï¼ŒåŸºäº ç®¡é“æ¨¡å‹ çš„ æ•°æ®åŒ…å®ˆæ’åŸåˆ™ï¼Œå³åŒä¸€æ—¶åˆ»åœ¨ç½‘ç»œä¸­ä¼ è¾“çš„æŠ¥æ–‡æ®µæ•°é‡æ˜¯æ’å®šçš„ï¼Œåªæœ‰å½“æ—§æŠ¥æ–‡æ®µç¦»å¼€ç½‘ç»œåï¼Œæ‰èƒ½å‘é€æ–°æŠ¥æ–‡æ®µè¿›å…¥ç½‘ç»œ</p><blockquote><p>å°† TCP è¿æ¥çœ‹æˆä¸€ä¸ªç®¡é“ï¼Œæˆ‘å‘äº†ä¸€ä¸ªçª—å£çš„æ•°æ®å‡ºå»ï¼Œæ”¶åˆ°äº†ä¸€ä¸ªåŒ…çš„ ACK åˆ™è¡¨æ˜ä¸€ä¸ªåŒ…ç¦»å¼€äº†ç®¡é“ï¼Œå› æ­¤åˆ©ç”¨å¿«é€Ÿé‡ä¼ ä¸‰ä¸ªè¿ç»­ ACKï¼Œä¿æŒä¸€å®šçš„å¸¦å®½åˆ©ç”¨ç‡ï¼ˆå³ä½¿ä¹‹å‰ä¸¢äº†å‡ ä¸ªï¼Œä½†æ˜¯ç°åœ¨ç½‘ç»œè¿˜æ˜¯æŒºé€šçš„ï¼Œå› ä¸ºæˆ‘æ”¶åˆ°å›å¤äº†ï¼Œæ‰€ä»¥å¯ä»¥è¿›è¡Œå°å¹…åº¦æ‹¥å¡çª—å£æå‡ï¼‰</p></blockquote><p>ç®—æ³•ï¼šå¦‚æœå‘é€ç«¯æ”¶åˆ°ä¸€ä¸ªé‡å¤çš„ ACKï¼Œåˆ™è®¤ä¸ºå·²ç»æœ‰ä¸€ä¸ªæ•°æ®åŒ…ç¦»å¼€äº†ç½‘ç»œï¼Œäºæ˜¯å°† cwnd åŠ  1ï¼Œæ­¤æ—¶è‹¥å‘é€çª—å£å€¼è¿˜å®¹è®¸å‘é€æŠ¥æ–‡æ®µï¼Œå°±ç»§ç»­å‘é€æŠ¥æ–‡æ®µ</p><p>å› æ­¤ï¼ŒTCP åœ¨å¿«é€Ÿæ¢å¤é˜¶æ®µä¼šè¯•å›¾å‘é€æ–°çš„æ•°æ®åŒ…ä»¥ä¿æŒä¸€å®šçš„å¸¦å®½åˆ©ç”¨ç‡ã€‚å½“ TCP æ”¶åˆ°ä¸¢å¤±åŒ…çš„ ACK ä»¥åï¼ˆACK ä¸å†é‡å¤ï¼‰ï¼Œä¼šé€€å‡ºå¿«é€Ÿæ¢å¤é˜¶æ®µè€Œè¿›å…¥æ‹¥å¡é¿å…é˜¶æ®µ</p><h2 id="è¿æ¥ç®¡ç†"><a class="markdownIt-Anchor" href="#è¿æ¥ç®¡ç†"></a> è¿æ¥ç®¡ç†</h2><p>ä¼ è¾“è¿æ¥æœ‰ä¸‰ä¸ªé˜¶æ®µï¼šè¿æ¥å»ºç«‹ï¼Œæ•°æ®ä¼ é€ï¼Œè¿æ¥é‡Šæ”¾</p><p>TCP çš„è¿æ¥å’Œå»ºç«‹éƒ½æ˜¯é‡‡ç”¨å®¢æˆ·æœåŠ¡å™¨æ–¹å¼ï¼šä¸»åŠ¨å‘èµ·è¿æ¥å»ºç«‹çš„åº”ç”¨è¿›ç¨‹å«åšå®¢æˆ·ç«¯ ï¼ˆclientï¼‰ï¼›è¢«åŠ¨ç­‰å¾…è¿æ¥å»ºç«‹çš„åº”ç”¨è¿›ç¨‹å«åšæœåŠ¡å™¨ ï¼ˆserverï¼‰</p><h3 id="ä¸‰æ¬¡æ¡æ‰‹"><a class="markdownIt-Anchor" href="#ä¸‰æ¬¡æ¡æ‰‹"></a> ä¸‰æ¬¡æ¡æ‰‹</h3><p>è¿æ¥å»ºç«‹é˜¶æ®µï¼Œè¦ä½¿æ¯ä¸€æ–¹èƒ½å¤Ÿç¡®çŸ¥å¯¹æ–¹çš„å­˜åœ¨ï¼›è¦å…è®¸åŒæ–¹åå•†ä¸€äº›å‚æ•°ï¼ˆå¦‚æœ€å¤§æŠ¥æ–‡æ®µé•¿åº¦ï¼Œæœ€å¤§çª—å£å¤§å°ï¼ŒæœåŠ¡è´¨é‡ç­‰ï¼‰ï¼›èƒ½å¤Ÿå¯¹è¿è¾“å®ä½“èµ„æºï¼ˆå¦‚ç¼“å­˜å¤§å°ï¼Œè¿æ¥è¡¨ä¸­çš„é¡¹ç›®ç­‰ï¼‰è¿›è¡Œåˆ†é…ï¼›</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20211124200824286.png" alt="image-20211124200824286" /></p><p>ä¸¤æ¬¡æ¡æ‰‹å­˜åœ¨çš„é—®é¢˜ï¼šTCP æ˜¯å…¨åŒå·¥çš„ï¼Œéœ€è¦ç¡®è®¤åŒæ–¹çš„æ”¶å‘èƒ½åŠ›ï¼›ç¬¬ä¸€æ¬¡æ¡æ‰‹æ—¶ç¡®è®¤äº†å®¢æˆ·ç«¯çš„å‘é€èƒ½åŠ›ï¼›æœåŠ¡ç«¯æ”¶åˆ°åè¿”å›ç»™å®¢æˆ·ç«¯ï¼Œå®Œæˆç¬¬äºŒæ¬¡æ¡æ‰‹ç¡®è®¤äº†æœåŠ¡ç«¯çš„æ”¶å‘çš„èƒ½åŠ›ï¼›ä½†æ˜¯å®¢æˆ·ç«¯çš„æ¥æ”¶èƒ½åŠ›æœåŠ¡å™¨è¿˜ä¸çŸ¥æ™“ï¼Œå› æ­¤ä¸¤æ¬¡æ¡æ‰‹åªæœ‰åªæœ‰å®¢æˆ·ç«¯å¾—çŸ¥è¿æ¥æˆåŠŸå»ºç«‹äº†ï¼Œè¿™æ—¶åªæ˜¯åŠè¿æ¥çŠ¶æ€ï¼ŒæœåŠ¡ç«¯ä¸çŸ¥é“æ‰€å‘é€çš„ ACK æ˜¯å¦è¢«å®¢æˆ·ç«¯æ¥æ”¶ï¼Œå› æ­¤ä¸çŸ¥é“è¿æ¥æ˜¯å¦å»ºç«‹æˆåŠŸã€‚æ‰€ä»¥éœ€è¦ç¬¬ä¸‰æ¬¡æ¡æ‰‹ï¼Œè®©æœåŠ¡å™¨çŸ¥é“å®¢æˆ·ç«¯çš„æ¥æ”¶èƒ½åŠ›ï¼Œå…¨åŒå·¥ TCP æ‰å¾—ä»¥å»ºç«‹ï¼›</p><p>å››æ¬¡æ¡æ‰‹å­˜åœ¨çš„é—®é¢˜ï¼šå¤šä½™äº†</p><h3 id="å››æ¬¡æŒ¥æ‰‹"><a class="markdownIt-Anchor" href="#å››æ¬¡æŒ¥æ‰‹"></a> å››æ¬¡æŒ¥æ‰‹</h3><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20211124204840774.png" alt="image-20211124204840774" /></p><p>å‰ä¸¤æ¬¡å®Œæˆ å®¢æˆ·ç«¯ çš„é‡Šæ”¾ï¼Œå®¢æˆ·ç«¯ä¸å‘æœåŠ¡å™¨å¯èƒ½è¿˜æ²¡å‘å®Œï¼Œå› æ­¤è¿˜éœ€è¦åä¸¤æ¬¡å®Œæˆ æœåŠ¡å™¨ çš„é‡Šæ”¾</p><h1 id="tcp-å®‰å…¨å¨èƒ"><a class="markdownIt-Anchor" href="#tcp-å®‰å…¨å¨èƒ"></a> TCP å®‰å…¨å¨èƒ</h1><h2 id="æ³›æ´ªæ”»å‡»"><a class="markdownIt-Anchor" href="#æ³›æ´ªæ”»å‡»"></a> æ³›æ´ªæ”»å‡»</h2><h3 id="syn-flood-å‡è£…æˆ‘è¦æ¥"><a class="markdownIt-Anchor" href="#syn-flood-å‡è£…æˆ‘è¦æ¥"></a> SYN Flood å‡è£…æˆ‘è¦æ¥</h3><p>Principleï¼šServer ä¸€æ—¦æ¥æ”¶åˆ° Client å‘æ¥çš„ Syn æŠ¥æ–‡ï¼Œå°±éœ€è¦ä¸ºè¯¥è¯·æ±‚åˆ†é…ä¸€ä¸ªTCB å¹¶è¿”å›ä¸€ä¸ª SYN ACK å‘½ä»¤ï¼Œç«‹å³è½¬ä¸º SYN-RECEIVED å³åŠå¼€è¿æ¥çŠ¶æ€ï¼›å› æ­¤ï¼Œå¦‚æœæ”»å‡»è€…å‘æŸä¸ªæœåŠ¡å™¨ç«¯å£å‘é€å¤§é‡çš„ SYN åŒ…ï¼Œåˆ™å¯ä½¿æœåŠ¡å™¨æ‰“å¼€å¤§é‡çš„åŠå¼€è¿æ¥ï¼Œåˆ†é…å¤§é‡ TCBï¼Œä»è€Œæ¶ˆè€—å¤§é‡çš„æœåŠ¡å™¨èµ„æºï¼ŒåŒæ—¶ä¹Ÿä½¿å¾—æ­£å¸¸çš„è¿æ¥è¯·æ±‚æ— æ³•è¢«å“åº”ï¼Œè€Œæ”»å‡»å‘èµ·æ–¹çš„èµ„æºæ¶ˆè€—ç›¸æ¯”è¾ƒå¯å¿½ç•¥ä¸è®¡</p><p>æ”»å‡»è¿‡ç¨‹ï¼šæ”»å‡»è€…ä¼ªé€ æºåœ°å€å‘èµ· SYN åŒ…ï¼Œè¯·æ±‚å»ºç«‹è¿æ¥ï¼›æœåŠ¡å™¨å‘é€ ACK ç»™å®¢æˆ·ï¼Œä½†æ˜¯å®¢æˆ·æ²¡æœ‰å‘é€è¿‡å»ºç«‹è¿æ¥è¯·æ±‚ï¼Œå› æ­¤å°±ä¸ä¼šå“åº” ACKï¼Œé‚£æœåŠ¡å™¨å°±ä¼šé•¿æ—¶é—´å¤„äº SYN_RECV çŠ¶æ€ï¼Œä¹Ÿå°±æ˜¯åŠå¼€è¿æ¥ï¼ŒæœåŠ¡å™¨æœ‰ä¸€ä¸ªåŠå¼€è¿æ¥é˜Ÿåˆ—å¯¹å…¶è¿›è¡Œç»´æŠ¤ï¼Œéœ€è¦å®šæ—¶çš„éå†è¯¥é˜Ÿåˆ—çœ‹çœ‹æ˜¯å¦è¾¾åˆ°äº†é‡ä¼ æ—¶é—´ï¼Œçœ‹çœ‹æ˜¯å¦è¶…æ—¶ï¼ˆåŠå¼€è¿æ¥è¶…æ—¶éœ€è¦ 30s - 2minï¼‰ï¼Œè¿™å°†ä¼šæ¶ˆè€—æœåŠ¡å™¨ä¸€å®šçš„ CPU ä¸ å†…å­˜</p><p>å±å®³ï¼šæ¶ˆè€—å¤§é‡çš„æœåŠ¡å™¨èµ„æºï¼ŒåŒæ—¶ä¹Ÿä½¿å¾—æ­£å¸¸çš„è¿æ¥è¯·æ±‚æ— æ³•è¢«å“åº”</p><blockquote><p>TCBï¼ŒTransmission Control Blockï¼Œé€šå¸¸ä¸€ä¸ª TCB è‡³å°‘éœ€è¦ 280 ä¸ªå­—èŠ‚ï¼Œåœ¨æŸäº›æ“ä½œç³»ç»Ÿä¸­ç”šè‡³éœ€è¦ 1300 ä¸ªå­—èŠ‚ï¼›</p><p>æŸäº›æ“ä½œç³»ç»Ÿåœ¨ SOCK çš„å®ç°ä¸Šæœ€å¤šå¯å¼€å¯ 512 ä¸ªåŠå¼€è¿æ¥</p></blockquote><p><strong>é˜²å¾¡</strong>ï¼š</p><p>1ã€æ— æ•ˆè¿æ¥ç›‘è§†é‡Šæ”¾ï¼šå°†è¶…æ—¶æ— æ•ˆæ—¶é—´ç¼©çŸ­</p><p>2ã€å»¶ç¼“ TCB åˆ†é…</p><p>SYN Cache ç­–ç•¥ï¼Œåœ¨æ”¶åˆ° SYN æ•°æ®æŠ¥æ–‡æ—¶ä¸æ€¥äºå»åˆ†é… TCBï¼Œå…ˆå›åº”ä¸€ä¸ª SYN+ACK æŠ¥æ–‡ï¼Œå¹¶åœ¨ä¸€ä¸ªä¸“ç”¨ HASH è¡¨ï¼ˆCacheï¼‰ä¸­ä¿å­˜åŠå¼€è¿æ¥ä¿¡æ¯ï¼Œç›´åˆ°æ”¶åˆ°æ­£ç¡®çš„å›åº” ACK æŠ¥æ–‡å†åˆ†é…TCB</p><blockquote><p>åœ¨ FreeBSD ç³»ç»Ÿä¸­è¿™ç§ Cache æ¯ä¸ªåŠå¼€è¿æ¥åªéœ€ä½¿ç”¨ 160 å­—èŠ‚ï¼Œè¿œå°äº TCB æ‰€éœ€çš„ 736</p></blockquote><p>SYN Cookie ç­–ç•¥ï¼Œåœ¨æ”¶åˆ° SYN åŒ…å¹¶è¿”å› SYN + ACK åŒ…åä¸åˆ†é… TCBï¼Œè€Œæ˜¯æ ¹æ® SYN åŒ…è®¡ç®—å‡ºä¸€ä¸ª Cookie å€¼ä½œä¸ºåˆå§‹åºå·ï¼Œåœ¨æ”¶åˆ° ACK åŒ…æ—¶ï¼ŒæœåŠ¡å™¨æ ¹æ® Cookie å€¼æ£€æŸ¥è¿™ä¸ª ACK åŒ…çš„åˆæ³•æ€§ã€‚å¦‚æœåˆæ³•ï¼Œå†åˆ†é…ä¸“é—¨çš„æ•°æ®åŒºè¿›è¡Œå¤„ç†æœªæ¥çš„ TCP è¿æ¥ã€‚</p><blockquote><p>Cookie ç”±æºç›®åœ°å€ã€ç«¯å£ä»¥åŠæœåŠ¡å™¨è‡ªå·±çš„å›ºå®šä¿¡æ¯ç”Ÿæˆ</p></blockquote><p>3ã€SYN Proxy é˜²ç«å¢™ï¼šProxy é€šå¸¸ä½¿ç”¨ SYN Cache æˆ– Cookie</p><p>é˜²ç«å¢™å…ˆæ¨¡æ‹Ÿä¸‰æ¬¡æ¡æ‰‹è¿‡ç¨‹ï¼ŒæˆåŠŸååœ¨é€šçŸ¥å¢™å†…æœåŠ¡å™¨ï¼Œæ­£å¼å»ºç«‹è¿æ¥ï¼š</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20211125171322729.png" alt="image-20211125171322729" /></p><p>4ã€æºåˆæ³•æ€§éªŒè¯æŠ€æœ¯ï¼šé˜²æŠ¤è®¾å¤‡æ”¶åˆ° SYN æŠ¥æ–‡åï¼Œå›åº”ä¸€ä¸ªç»è¿‡æ„é€ çš„ SYN+ACK æŠ¥æ–‡ï¼Œé€šè¿‡ç”¨æˆ·çš„ååº”æ¥åˆ¤æ–­æ­¤ç”¨æˆ·æ˜¯å¦æ­£å¸¸</p><blockquote><p>æ•…æ„å›å¤ä¸€ä¸ªé”™è¯¯çš„å»æµ‹è¯•ç”¨æˆ·æ˜¯å¦æ­£å¸¸</p></blockquote><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20211125171545251.png" alt="image-20211125171545251" /></p><h3 id="ack-flood-å‡è£…æˆ‘æ¥è¿‡"><a class="markdownIt-Anchor" href="#ack-flood-å‡è£…æˆ‘æ¥è¿‡"></a> ACK Flood å‡è£…æˆ‘æ¥è¿‡</h3><p><strong>Principle</strong>ï¼šæ”»å‡»è€…ç›´æ¥å‘é€ ACK è¿‡å»ï¼ŒæœåŠ¡å™¨å¾—æ£€æŸ¥æ˜¯å¦å­˜åœ¨å“åº”çš„åŠå¼€è¿æ¥çŠ¶æ€ï¼Œå¦‚æœæ²¡æŸ¥åˆ°è¿˜éœ€è¦å›å¤ä¸€ä¸ª ACK / RST åŒ…ï¼Œå ç”¨äº†ä¸€å®šçš„èµ„æº</p><blockquote><p>èµ„æºçš„å ç”¨ç›¸å¯¹äº SYN Flood è¾ƒä½ï¼Œå› æ­¤å¤§æµé‡çš„ ACK Flood æ‰èƒ½å½±å“åˆ°æœåŠ¡å™¨</p></blockquote><p>å…±åˆ†ä¸ºä¸¤ç§æ”»å‡»åœºæ™¯ï¼šæ”»å‡»ç«¯å£æœªå¼€æ”¾ï¼›æ”»å‡»ç«¯å£å·²å¼€æ”¾</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20211125172041197.png" alt="image-20211125172041197" /></p><p>Tipsï¼šç”±äºå¯¹ç³»ç»Ÿçš„èµ„æºæ¶ˆè€—ä¸æ˜¯å¾ˆå¤§ï¼ŒACK Flood å¹¶æ²¡æœ‰æˆä¸ºä¸»æµæ”»å‡»æ‰‹æ®µï¼Œè€Œé€šå¸¸æ˜¯ä¸å…¶ä»–æ”»å‡»æ–¹å¼ç»„åˆåœ¨ä¸€èµ·ä½¿ç”¨ï¼Œæ¯”å¦‚ SYN + ACK Flood</p><p>é’ˆå¯¹ SYN Cookie ç­–ç•¥ï¼šå®ƒéœ€è¦æ ¡éªŒç¬¬ä¸‰æ¬¡æ¡æ‰‹çš„ ACK æ˜¯å¦ç¬¦åˆè®°å½•çš„ Cookieï¼Œè¿™æ ¡éªŒçš„è¿‡ç¨‹éœ€è¦æ¶‰åŠåˆ°å¤æ‚çš„ç®—æ³•ï¼›å› æ­¤å‰é¢æˆ‘å…ˆè¿›è¡Œ SYN Floodï¼Œè®© SYN Cookie æœºåˆ¶å­˜åœ¨å¤§é‡çš„ Cookie ç­‰å¾… ACKï¼Œç„¶åä½¿ç”¨ ACK Flood è¿™æ ·ä¸»æœºå’Œé˜²ç«å¢™éƒ½éœ€è¦æ¶ˆè€—å¤§é‡çš„èµ„æº</p><h3 id="connection-flood-æˆ‘æ¥äº†å°±åªå ä½"><a class="markdownIt-Anchor" href="#connection-flood-æˆ‘æ¥äº†å°±åªå ä½"></a> Connection Flood æˆ‘æ¥äº†å°±åªå ä½</h3><p>Principleï¼šåˆ©ç”¨çœŸå® IP åœ°å€ï¼ˆä»£ç†æœåŠ¡å™¨ï¼Œå¹¿å‘Šé¡µé¢ï¼‰åœ¨æœåŠ¡å™¨ä¸Šå»ºç«‹å¤§é‡è¿æ¥ï¼ŒæœåŠ¡å™¨ä¸Šæ®‹ä½™è¿æ¥ï¼ˆWAIT çŠ¶æ€ï¼‰è¿‡å¤šï¼Œåˆ™ä¼šå¯¼è‡´æ•ˆç‡é™ä½ï¼Œç”šè‡³èµ„æºè€—å°½</p><blockquote><p>é€šå¸¸éƒ½æœ‰æœ€å¤§è¿æ¥æ•°ï¼ˆä¸Šçº¿ï¼‰ï¼Œæ”»å‡»è€…å¦‚æœèƒ½å¤Ÿè¾¾åˆ°ä¸Šé™å€¼å³å¯å®ç°æ‹’ç»æœåŠ¡æ”»å‡»</p></blockquote><p>Targetï¼šæ¶ˆè€—éª¨å¹²è®¾å¤‡çš„èµ„æºï¼Œå¦‚ é˜²ç«å¢™</p><p>å¯ä»¥æœ‰å¾ˆå¤šç©æ³•ï¼Œæ•…æ„æ£ä¹±ï¼š</p><p>1ã€å»ºç«‹è¿æ¥åä¸å‘é€ä»»ä½•æŠ¥æ–‡ï¼Œä¸€ç›´ç»´æŒ TCP è¿æ¥</p><p>2ã€å»ºç«‹è¿æ¥åç«‹åˆ»å‘é€ FIN æˆ– RST æŠ¥æ–‡é‡Šæ”¾æœ¬ç«¯è¿æ¥ï¼ŒåŒæ—¶å¿«é€Ÿå‘èµ·æ–°çš„è¿æ¥</p><p>3ã€å»ºç«‹è¿æ¥åï¼Œç»™æœåŠ¡å™¨å‘é€å¾ˆå°çš„ awnd æ•°æ®ï¼ˆä½†æ˜¯å‘é€é€Ÿåº¦å¾ˆæ…¢ï¼‰å¯¼è‡´æœåŠ¡å™¨åè®®æ ˆèµ„æºè€—å°½</p><p>4ã€å»ºç«‹è¿æ¥åï¼Œå‘é€å¤§é‡é‡ä¼ è¯·æ±‚ï¼Œä»¥å¾ˆå°çš„æµé‡å³å¯å¯¼è‡´è¢«æ”»å‡»ç½‘ç»œä¸Šè¡Œé“¾è·¯æ‹¥å¡</p><blockquote><p>å‡è£…æ²¡æ”¶åˆ°æœåŠ¡å™¨çš„ ACKï¼Œä¸€ç›´é‡ä¼ </p></blockquote><p><strong>é˜²å¾¡</strong>ï¼š</p><p>1ã€æº IP åœ°å€æ–°å»ºè¿æ¥é€Ÿç‡æ£€æŸ¥</p><p>2ã€æº IP åœ°å€å¹¶å‘è¿æ¥æ•°æ£€æŸ¥</p><p>3ã€æ…¢é€Ÿè¿æ¥é€Ÿç‡æ£€æŸ¥ï¼šç»Ÿè®¡åŒä¸€æº IP åœ°å€å¯¹åŒä¸€ç›®çš„ IP åœ°å€çš„è¿æ¥æ¬¡æ•°ï¼Œåœ¨å„ç»Ÿè®¡æ—¶é—´é—´éš”å†…ï¼Œå¦‚æœè¿ç»­å¤šæ¬¡è¿æ¥æ•°ç›¸åŒï¼Œåˆ™åˆ¤å®šä¸º TCP æ…¢é€Ÿè¿æ¥æ”»å‡»ï¼Œå°æ‰ IP å³å¯</p><p>4ã€å¼‚å¸¸ä¼šè¯æ£€æŸ¥ï¼š</p><p>ç©ºè¿æ¥æ£€æŸ¥ï¼šå¦‚æœåœ¨æ£€æŸ¥å‘¨æœŸå†…ï¼Œåœ¨æŸæ¡ TCP è¿æ¥ä¸Šé€šè¿‡çš„æŠ¥æ–‡æ•°å°äºé˜ˆå€¼ï¼ˆç±»ä¼¼äºæœ€ä½æ¶ˆè´¹ï¼‰ï¼Œåˆ™åˆ¤å®šè¯¥è¿æ¥ä¸ºå¼‚å¸¸è¿æ¥</p><p>é‡ä¼ ä¼šè¯æ£€æŸ¥ï¼šå½“æŸæ¡ TCP è¿æ¥ä¸Šé‡ä¼ æŠ¥æ–‡æ•°é‡å¤§äºé˜ˆå€¼æ—¶ï¼Œåˆ™åˆ¤å®šè¯¥è¿æ¥ä¸ºå¼‚å¸¸è¿æ¥</p><p>æ…¢å¯åŠ¨è¿æ¥æ£€æŸ¥ï¼šå½“æŸæ¡ TCP è¿æ¥ä¸Šé€šè¿‡çš„æŠ¥æ–‡çª—å£å°äºé˜ˆå€¼æ—¶ï¼Œåˆ™åˆ¤å®šè¯¥è¿æ¥ä¸ºå¼‚å¸¸è¿æ¥</p><h2 id="land-æ”»å‡»"><a class="markdownIt-Anchor" href="#land-æ”»å‡»"></a> LAND æ”»å‡»</h2><p>å‘é€ SYN æŠ¥æ–‡å°†æºåœ°å€æ”¹ä¸ºæœåŠ¡å™¨è‡ªèº«çš„åœ°å€ï¼Œç³»ç»Ÿè¦ä¹ˆä¸çŸ¥é“æ€ä¹ˆåŠè¦ä¹ˆå°±å¾ªç¯å‘é€æ¶ˆè€—èµ„æº</p><p>é˜²å¾¡ï¼š</p><p>1ã€ç³»ç»Ÿè¡¥ä¸ï¼šå¾ˆå¤šæ¼æ´éƒ½æ˜¯ç³»ç»Ÿæ²¡è€ƒè™‘åˆ°ç‰¹æ®Šæƒ…å†µå¯¼è‡´çš„</p><p>2ã€é˜²ç«å¢™è¿‡æ»¤æ­¤ç±»æŠ¥æ–‡</p><h2 id="flag-è¯¯ç”¨æ”»å‡»"><a class="markdownIt-Anchor" href="#flag-è¯¯ç”¨æ”»å‡»"></a> FLAG è¯¯ç”¨æ”»å‡»</h2><p><strong>Principle</strong>ï¼šå‘ç›®æ ‡ä¸»æœºæˆ–ç½‘ç»œè®¾å¤‡å‘é€å¸¦æœ‰å¼‚å¸¸æ ‡è¯†ä½ï¼ˆç›¸äº’çŸ›ç›¾çš„æ ‡è¯†ä½ï¼‰çš„ TCP æŠ¥æ–‡ï¼Œå¯¼è‡´ç›®æ ‡ç³»ç»Ÿåè®®æ ˆæ— æ³•æ­£å¸¸å·¥ä½œä»è€Œè¾¾åˆ°æ”»å‡»æ•ˆæœ</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20211125175822330.png" alt="image-20211125175822330" /></p><p>Exampleï¼šè¿ç»­æ”¶åˆ° ACK &amp; RST æ ‡å¿—ä½å¼‚å¸¸æŠ¥æ–‡çš„æ”»å‡»ï¼Œå¯¼è‡´ç½‘å…³å®•æœºï¼›ç½‘å…³æ˜¯ä¸‰å±‚è½¬å‘è®¾å¤‡ï¼Œä¸ºä»€ä¹ˆTCPæ ‡å¿—ä½å¼‚å¸¸ï¼Œä¼šå¯¼è‡´ç½‘å…³å®•æœºï¼Ÿ</p><p>ç½‘å…³çš„ NAT æ¨¡å—ä¼šç»´æŠ¤åœ°å€æ˜ å°„è¡¨é¡¹ï¼Œä¼šæ ¹æ® TCP æ ‡å¿—ä½æ›´æ–°åœ°å€æ˜ å°„å¯¹çš„å®šæ—¶å™¨ã€‚ACK æŒ‡ç¤ºå»¶é•¿å®šæ—¶å™¨ï¼ŒRST åˆ™æ˜¯åˆ é™¤å®šæ—¶å™¨ï¼Œå› æ­¤å‡ºç° bug</p><h2 id="rst-æ”»å‡»"><a class="markdownIt-Anchor" href="#rst-æ”»å‡»"></a> RST æ”»å‡»</h2><p><strong>Principle</strong>ï¼šæ”»å‡»è€…å‘æœåŠ¡å™¨æˆ–è€…å®¢æˆ·ç«¯å‘é€ä¼ªé€ çš„ TCP RST æŠ¥æ–‡ï¼Œå¯¼è‡´æ­£åœ¨è¿›è¡Œé€šä¿¡çš„ TCP è¿æ¥æ–­æ‰ï¼Œä»è€Œè¾¾åˆ°æ‹’ç»æœåŠ¡çš„æ”»å‡»æ•ˆæœ</p><blockquote><p>TCP RST æŠ¥æ–‡å°†ç›´æ¥å…³é—­æ‰ä¸€ä¸ª TCP è¿æ¥</p></blockquote><p>å‰ææ¡ä»¶ï¼šé€šè®¯ç›®æ ‡æ–¹æ¥å— TCP æŠ¥æ–‡ï¼›æº IP åœ°å€ä¸ç«¯å£å·ä¸€è‡´ï¼›åºåˆ—å·ï¼ˆSeqï¼‰è½åœ¨ TCP çª—å£ä¹‹å†…</p><p>æ”»å‡»æ–¹æ³•ï¼šå—…æ¢ç›‘å¬é€šä¿¡åŒæ–¹çš„ TCP è¿æ¥ï¼Œè·å¾—æºç›® IP åœ°å€ã€ç«¯å£å’ŒæŠ¥æ–‡åºåˆ—å·ï¼›ç»“åˆ IP æºåœ°å€æ¬ºéª—æŠ€æœ¯ä¼ªè£…æˆé€šä¿¡ä¸€æ–¹ï¼Œå‘é€ TCP RST æŠ¥æ–‡ç»™å¦ä¸€æ–¹</p><p>äº’è”ç½‘ç¼“å­˜æœºåˆ¶ï¼šä¸€äº›éª¨å¹²ç½‘ç»œä¸­åœ¨ç”¨æˆ·çš„æ—¥å¸¸é€šä¿¡è·å–æ•°æ®æ—¶ä¼šåœ¨ç½‘å…³å¤„ï¼ˆæˆ–åˆ«çš„åœ°æ–¹ï¼‰ç•™ä¸‹ä¸€ä¸ªç¼“å­˜æ‹·è´ï¼Œå¦‚æœçŸ­æ—¶é—´å†…å…¶å®ƒç”¨æˆ·è¯·æ±‚ç›¸åŒçš„æ•°æ®åˆ™å¯ä»¥ä¸å¿…å‘å¤–è¯·æ±‚æµé‡ç›´æ¥å°†ç¼“å­˜å‘é€è¿‡å»</p><p>å…¶åŸç†å°±æ˜¯ RST ï¼šæ£€æµ‹åˆ°æˆ‘æ–¹å­˜åœ¨ç¼“å­˜ï¼Œå› æ­¤ä¼šå†’å……æ­£å¸¸ç”¨æˆ·æ–­å¼€ TCP è¿æ¥ï¼Œç„¶åå†’å……æ•°æ®æ®µå°†æ•°æ®å‘ç»™å®¢æˆ·</p><p>Applicationï¼š</p><p>1ã€æ¶æ„æ‹’ç»æœåŠ¡æ”»å‡»</p><p>2ã€ï¼ˆå¥½çš„æ–¹é¢ï¼‰é˜»æ–­å…¥ä¾µè¿æ¥ï¼šåœ¨å…¥ä¾µæ£€æµ‹ç³»ç»Ÿæ£€æµ‹åˆ°ç‰¹å®šçš„æ”»å‡»äº‹ä»¶åï¼Œé€šè¿‡é‡ç½®ï¼ˆå¤ä½ï¼‰æ”»å‡»è€…å’Œå—å®³è€…ä¹‹é—´çš„TCPè¿æ¥æ¥é˜»æ–­æ”»å‡»ï¼Œè¿™ç§é˜»æ–­è¿æ¥æœºåˆ¶æ˜¯ç›®å‰å…¥ä¾µæ£€æµ‹ç³»ç»Ÿä¸­ä½¿ç”¨æœ€å¤šçš„ä¸»åŠ¨å“åº”æœºåˆ¶</p><p>3ã€ä½œä¸ºä¼šè¯åŠ«æŒçš„å‰å¥</p><h2 id="ä¼šè¯åŠ«æŒ"><a class="markdownIt-Anchor" href="#ä¼šè¯åŠ«æŒ"></a> ä¼šè¯åŠ«æŒ</h2><p>ä¼šè¯ï¼šä¸¤å°ä¸»æœºä¹‹é—´çš„ä¸€æ¬¡é€šè®¯</p><p>Principleï¼šæ”»å‡»è€…é€šè¿‡å—…æ¢ä»¥åŠæ¬ºéª—ç­‰æ”»å‡»æ‰‹æ®µï¼Œä¼ªè£…æˆæœåŠ¡å™¨æˆ–è€…å®¢æˆ·ç«¯å‚ä¸åˆ°æ­£åœ¨è¿›è¡Œé€šä¿¡çš„ TCP è¿æ¥ä¸­æ¥ï¼Œåœ¨æ­£å¸¸æ•°æ®åŒ…ä¸­æ’å…¥æ¶æ„æ•°æ®ï¼ˆæ³¨å°„å¼æ”»å‡»ï¼‰ï¼›åœ¨åŒæ–¹çš„ä¼šè¯å½“ä¸­è¿›è¡Œç›‘å¬ï¼ˆä¸­é—´äººæ”»å‡»ï¼‰ï¼›ä»£æ›¿æŸä¸€æ–¹ä¸»æœºæ¥ç®¡ä¼šè¯ï¼ˆä¸­é—´äººæ”»å‡»ï¼ŒRST æ”»å‡»ï¼‰</p><p>æ”»å‡»æ¡ä»¶ï¼šåŒ RST æ”»å‡»</p><p>Qï¼šå¦‚æœä¸å…·å¤‡å—…æ¢ç›‘å¬æ¡ä»¶ï¼Œé‚£ä¹ˆè¿˜æœ‰ä»€ä¹ˆæ‰‹æ®µå¯ä»¥è·å–TCPè¿æ¥çš„IPã€ç«¯å£å’ŒæŠ¥æ–‡åºåˆ—å·ï¼Œä»¥è¿›è¡ŒRSTæ”»å‡»æˆ–è€…ä¼šè¯åŠ«æŒï¼Ÿ</p><p>Aï¼šæœåŠ¡å™¨çš„ IP å’Œç«¯å£é€šå¸¸æ˜¯å…¬å¼€çš„ï¼›åºåˆ—å·å¯ä»¥æš´åŠ›ç¢°æ’ï¼›</p><p>Qï¼šåºåˆ—å·ç¢°æ’å¦‚ä½•é¿å… ACK é£æš´ï¼Ÿè€Œä¸”ï¼Œå¦‚æœTCPæµæ—¶é—´å¾ˆçŸ­å‘¢ï¼Ÿå®¢æˆ·ç«¯çš„IPå’Œç«¯å£å¦‚ä½•è·å–ï¼Ÿ</p><p>Aï¼š</p><p>é˜²å¾¡æ–¹æ³•ï¼š</p><p>1ã€é¿å…æ”»å‡»è€…æˆä¸ºé€šä¿¡åŒæ–¹çš„ä¸­é—´äººï¼šéƒ¨ç½²äº¤æ¢å¼ç½‘ç»œï¼Œç”¨äº¤æ¢æœºä»£æ›¿é›†çº¿å™¨ï¼›ç¦ç”¨ä¸»æœºä¸Šçš„æºè·¯ç”±ï¼›é‡‡ç”¨é™æ€ç»‘å®š IP-MAC æ˜ å°„è¡¨ä»¥é¿å… ARP æ¬ºéª—ï¼›è¿‡æ»¤ ICMP é‡å®šå‘æŠ¥æ–‡</p><p>2ã€TCPè¿æ¥åŠ å¯†ï¼ˆIPsecåè®®ï¼‰ï¼šé¿å…äº†æ”»å‡»è€…åœ¨å¾—åˆ°ä¼ è¾“å±‚çš„ç«¯å£åŠåºåˆ—å·ç­‰å…³é”®ä¿¡æ¯</p><p>3ã€æ£€æµ‹ ACK é£æš´</p><h2 id="ä½é€Ÿç‡æ‹’ç»æœåŠ¡æ”»å‡»ldos"><a class="markdownIt-Anchor" href="#ä½é€Ÿç‡æ‹’ç»æœåŠ¡æ”»å‡»ldos"></a> ä½é€Ÿç‡æ‹’ç»æœåŠ¡æ”»å‡»ï¼ˆLDOSï¼‰</h2><p><strong>Principle</strong>ï¼šåˆ©ç”¨ç½‘ç»œåè®®æˆ–åº”ç”¨æœåŠ¡åè®®è‡ªé€‚åº”æœºåˆ¶ä¸­å­˜åœ¨çš„å®‰å…¨æ¼æ´ï¼Œå‘¨æœŸæ€§åœ°å‘é€é«˜é€Ÿè„‰å†²æ”»å‡»æ•°æ®åŒ…ï¼Œè¾¾åˆ°é™ä½å—å®³ç«¯æœåŠ¡æ€§èƒ½çš„ç›®çš„</p><blockquote><p>é’ˆå¯¹ TCP çš„æ‹¥å¡æ§åˆ¶æœºåˆ¶ï¼šæ”»å‡»è€…å‘¨æœŸæ€§åœ°å°†æ”»å‡»åŒ…æ³¨å…¥ç½‘ç»œï¼Œä½¿ç½‘ç»œå‘ç”Ÿå‘¨æœŸæ€§æ‹¥å¡ï¼Œç»è¿‡è¯¥ç½‘ç»œçš„æ‰€æœ‰TCPè¿æ¥éƒ½ä¼šå‘¨æœŸæ€§åœ°è¿›è¡Œæ‹¥å¡æ§åˆ¶ï¼Œä»è€ŒæŠ‘åˆ¶æµé‡ï¼Œè¾¾åˆ°DoSæ”»å‡»æ•ˆæœ</p></blockquote><p>ä¸ä¼ ç»Ÿ DOS åŒºåˆ«ï¼š</p><p>1ã€æ”»å‡»ç›®æ ‡æ˜¯è‡ªé€‚åº”çš„æ‹¥å¡æ§åˆ¶æœºåˆ¶ï¼Œæ”»å‡»å¼•èµ·çš„ååº”å’Œè°ƒæ•´æ˜¯åˆæ³•çš„ï¼Œä½¿å¾—å—å®³ç«¯å—åˆ°é•¿æœŸæ”»å‡»è€Œæ¯«æ— å¯Ÿè§‰ï¼›</p><p>2ã€æ”»å‡»æµé‡ä¸è®¸å¤šçœŸå®çš„æ•°æ®æµç‰¹å¾ç±»ä¼¼ï¼Œå¯¼è‡´æ”»å‡»éšè”½æ€§éå¸¸å¥½</p><p>3ã€æ”»å‡»æˆæœ¬ä½ï¼Œä¸€ä¸ªå•ä¸€çš„æ”»å‡»æºå°±å¯ä»¥å‘åŠ¨ä¸€æ¬¡æ”»å‡»ï¼Œéœ€è¦å‘é€çš„æ•°æ®é‡è¿œå°äºæ³›æ´ªæ”»å‡»</p><p>æ”»å‡»æ¨¡å‹ï¼š</p><p>å•æºæ”»å‡»ï¼š</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/20211203113337.png" alt="å•æºæ”»å‡»" /></p><p>åˆ†å¸ƒå¼åŒæ­¥æ”»å‡»ï¼šå®¹æ˜“è¢«å‘ç°</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20211125183107230.png" alt="image-20211125183107230" /></p><p>åˆ†å¸ƒå¼å¼‚æ­¥æ”»å‡»ï¼š</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20211125183126061.png" alt="image-20211125183126061" /></p><p>æ”»å‡»æ–¹æ³•ï¼š</p><p>1ã€åŸºäº RTO æœºåˆ¶çš„æ”»å‡»ï¼ˆShrewæ”»å‡»ï¼‰</p><p>ä½¿ TCP å‘é€æ–¹åœ¨æ¯ä¸ªå‘¨æœŸå†…è‡ªåŠ¨é‡‡å–è¶…æ—¶é‡ä¼ æ‹¥å¡æ§åˆ¶ï¼š</p><p>aã€å‘å‡ºä¸€ä¸ªæ”»å‡»è„‰å†²ï¼Œä½¿ TCP å‘é€ç«¯è¿›å…¥è¶…æ—¶é‡ä¼ çŠ¶æ€ï¼›</p><blockquote><p>æ”»å‡»è„‰å†²æ˜¯ä¸ºäº†å°†äº¤æ¢æœºé˜Ÿåˆ—æ‰“æ»¡ï¼Œä½¿å¾—ä¸¢åŒ…å‘ç”Ÿ</p></blockquote><p>bã€ç»è¿‡ min(RTO) + T_lag å‘¨æœŸå‘é€ä¸‹ä¸€ä¸ªæ”»å‡»è„‰å†²</p><blockquote><p>RTO è¶…æ—¶é‡ä¼ æ—¶é—´</p><p>T_lag å»¶è¿Ÿç›®çš„æ˜¯ä½¿å‘é€ç«¯åœ¨æ­¤æ—¶é—´æ®µå†…æˆåŠŸåœ°é‡ä¼ ï¼Œä»è¶…æ—¶é‡ä¼ ä¸­æ¢å¤è¿‡æ¥ï¼Œä»¥ä¿è¯æ”»å‡»å‘¨æœŸä¸å˜</p></blockquote><p>ç¼ºé™·ï¼šéœ€æ³¨å…¥å¤§é‡æ•°æ®åŒ…è®©ç“¶é¢ˆè·¯ç”±å™¨å‘ç”Ÿä¸¥é‡æ‹¥å¡ï¼Œæ˜“è¢«å‘ç°</p><p>2ã€åŸºäº AIMD æœºåˆ¶çš„æ”»å‡»ï¼ˆ RoQ é™è´¨æ”»å‡»ï¼‰</p><p>æ ¹æ® TCP å‘é€æ–¹åœ¨æ”¶åˆ° 3 ä¸ªé‡å¤çš„ ACK æŠ¥æ–‡ï¼ˆæ‹¥å¡ä¿¡å·ï¼‰æ—¶ cwnd å‡åŠæœºåˆ¶ï¼Œä½¿ç”¨æŒç»­æ—¶é—´çŸ­ã€å‘¨æœŸå°çš„è„‰å†²è¿›è¡Œæœ‰æ•ˆæ”»å‡»ï¼Œä½¿ cwnd è¿ç»­å‡åŠï¼Œæœ€ç»ˆå‡å°‘åˆ° 2</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/20211203113606.png" alt="" /></p><p><strong>å¯¹æ¯”</strong>ï¼š</p><p>å…±åŒç‚¹ï¼šé€šè¿‡æ”»å‡»ç“¶é¢ˆé“¾è·¯æˆ–è·¯ç”±å™¨ï¼Œåœ¨ç¬é—´äº§ç”Ÿæ‹¥å¡ï¼Œè¿«ä½¿ç½‘ç»œå‘å‡ºæ‹¥å¡ä¿¡å·ï¼ˆä¸¢åŒ…ï¼Œå¯¹ç«¯é‡ä¼ ACKï¼‰ï¼Œä½¿æºç«¯è¿›è¡Œè‡ªé€‚åº”è°ƒæ•´å‘é€çª—å£çš„å¤§å°ï¼›é€šè¿‡è„‰å†²æ€§æ•°æ®æµå‘¨æœŸæ€§åœ°è¿›è¡Œæ”»å‡»ï¼Œä¸æ˜¯æŒç»­çš„ Flood æ•°æ®æµï¼Œç›¸å¯¹æ•°æ®é‡å’Œé€Ÿåº¦éƒ½åå°ï¼Œç»“æœé€ æˆ TCP æ€§èƒ½çš„éœ‡è¡ï¼Œä¸¥é‡é™ä½ TCP çš„ååé‡</p><p>åŒºåˆ«ï¼š</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20211125183827887.png" alt="image-20211125183827887" /></p><p>æ£€æµ‹ï¼š</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20211125184036554.png" alt="image-20211125184036554" /></p><p>1ã€ç‰¹å¾æ£€æµ‹ï¼Œéœ€è¦æœ‰æ˜ç¡®çš„æ”»å‡»ç‰¹å¾ï¼Œé€šè¿‡ç‰¹å¾åŒ¹é…æ¥æ£€æµ‹æ”»å‡»è¡Œä¸º</p><p>2ã€å¼‚å¸¸æ£€æµ‹åˆ©ç”¨ç»Ÿè®¡çš„ç½‘ç»œæ•°æ®å»ºç«‹æ­£å¸¸ç½‘ç»œæµé‡æ¨¡å‹ï¼Œé€šè¿‡æ¨¡å‹åˆ¤æ–­å¾…æ£€æµ‹æµé‡æ˜¯å¦å¼‚å¸¸ï¼Œè‹¥å­˜åœ¨å¼‚å¸¸åˆ™åˆ¤å®šä¸ºæœ‰æ”»å‡»å‘ç”Ÿ</p><p>é˜²å¾¡ï¼š</p><p>1ã€æ”¹è¿› TCP åè®®ï¼šå¯¹åè®®è¿›è¡Œä¿®æ”¹ã€å¡«è¡¥æ¼æ´</p><p>2ã€æ”¹è¿›è·¯ç”±å™¨ AQMï¼ˆä¸»åŠ¨é˜Ÿåˆ—ç®¡ç†ï¼‰ç®—æ³•ï¼šä¸¢å¼ƒç¬¦åˆè®¾å®šæ”»å‡»ç‰¹å¾çš„æ•°æ®æµï¼›é‡æ–°è¿›è¡Œå¸¦å®½åˆ†é…ï¼Œå°½é‡ä¿æŠ¤TCPæ•°æ®æµï¼ŒæŠ‘åˆ¶ LDoS æ”»å‡»æµ</p><blockquote><p>RAD ç­–ç•¥ï¼Œéšæœºæ—©èµ·ä¸¢å¼ƒï¼Œé˜Ÿåˆ—è®¾ç½®ä¸¤ä¸ªé˜ˆå€¼ l1 ä¸ l2ï¼Œå½“åŒ…çš„æ•°ç›®ä½äº l1 æ—¶ä¸å¿…ä¸¢åŒ…ï¼›å½“åŒ…æ•°ç›®åœ¨ l1 ä¸ l2 ä¹‹é—´æ—¶éšæœºä¸¢åŒ…ï¼›è¶…è¿‡ l2 æ—¶å…¨éƒ¨ä¸¢</p></blockquote><p>3ã€è·¯ç”±å™¨é˜²å¾¡ï¼šç›‘è§†ç«¯å£ä¸¢åŒ…ç‡ï¼Œæ‰¾åˆ°æ½œåœ¨çš„å—å®³è€…ï¼Œä¼˜å…ˆå¤„ç†æ¥è‡ªå—å®³è€…çš„ TCP æ•°æ®åŒ…</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20211125184050317.png" alt="image-20211125184050317" /></p><h1 id="refs"><a class="markdownIt-Anchor" href="#refs"></a> Refs</h1><p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/tobe98/p/12058443.html">å…¬ä¼—å· - tobeçš„å‘“è¯­ - è¯¦è§£ TCP è¶…æ—¶ä¸é‡ä¼ æœºåˆ¶â€”â€”é•¿æ–‡é¢„è­¦</a></p>]]></content>
      
      
      <categories>
          
          <category> Protocol Security </category>
          
      </categories>
      
      
        <tags>
            
            <tag> security </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>IPSec</title>
      <link href="/Coming-blog/2021/12/02/ipsec/"/>
      <url>/Coming-blog/2021/12/02/ipsec/</url>
      
        <content type="html"><![CDATA[<h1 id="ipsec"><a class="markdownIt-Anchor" href="#ipsec"></a> IPSEC</h1><p>IPSecï¼ŒIP Securityï¼Œæ˜¯ IETF åˆ¶å®šçš„ä¸€ç³»åˆ—åè®®ï¼Œç«¯åˆ°ç«¯çš„ç¡®ä¿ IP å±‚é€šä¿¡å®‰å…¨çš„æœºåˆ¶/æ¡†æ¶ï¼Œç”¨äºä¿è¯åœ¨ Internet ä¸Šä¼ é€æ•°æ®çš„å®‰å…¨ä¿å¯†æ€§èƒ½</p><blockquote><p>å› ä¸º IPv4 ç¼ºä¹å¯¹é€šä¿¡åŒæ–¹èº«ä»½çœŸå®æ€§çš„é‰´åˆ«èƒ½åŠ›ï¼›ç¼ºä¹å¯¹ä¼ è¾“æ•°æ®çš„å®Œæ•´æ€§å’Œæœºå¯†æ€§ä¿æŠ¤çš„æœºåˆ¶ï¼›IP å±‚å­˜åœ¨ä¸šåŠ¡æµè¢«ç›‘å¬å’Œæ•è·ã€é‡æ”¾ã€IP åœ°å€æ¬ºéª—ã€ä¿¡æ¯æ³„éœ²å’Œæ•°æ®é¡¹ç¯¡æ”¹ç­‰æ”»å‡»</p></blockquote><p>Processï¼šç‰¹å®šçš„é€šä¿¡æ–¹ä¹‹é—´ï¼Œåœ¨ IP å±‚é€šè¿‡åŠ å¯†ä¸æ•°æ®æºéªŒè¯æ¥ä¿è¯æ•°æ®åŒ…åœ¨ Internet ä¸Šä¼ è¾“çš„<strong>æœºå¯†æ€§ã€å®Œæ•´æ€§å’ŒçœŸå®æ€§</strong></p><p>ç§æœ‰æ€§ / æœºå¯†æ€§ï¼šIPSec åœ¨ä¼ è¾“æ•°æ®åŒ…ä¹‹å‰ï¼Œå°†å…¶åŠ å¯†ä»¥ä¿è¯æ•°æ®çš„ç§æœ‰æ€§</p><p>å®Œæ•´æ€§ï¼šIPSec åœ¨ç›®çš„åœ°ä½¿ç”¨å•å‘æ•£åˆ—å‡½æ•°éªŒè¯æ•°æ®åŒ…çš„å®Œæ•´æ€§</p><p>èº«ä»½éªŒè¯ï¼šå•å‘æ•£åˆ—å‡½æ•°ã€æ•°å­—ç­¾åå’Œå…¬å¼€å¯†é’¥åŠ å¯†æ¥åˆ¤æ–­ä¸€ä»½æ•°æ®æ˜¯å¦æºäºæ­£ç¡®çš„åˆ›å»ºè€…</p><p>é˜²é‡æ”¾ï¼šé€šè¿‡æŸ¥é˜…åºåˆ—å·ï¼Œç›®çš„åœ°ä¼šæ‹’ç»è€çš„æˆ–é‡å¤çš„æ•°æ®åŒ…</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20211007150244277.png" alt="image-20211007150244277" /></p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20211007164204042.png" alt="image-20211007164204042" /></p><h2 id="åŠ å¯†ç®—æ³•"><a class="markdownIt-Anchor" href="#åŠ å¯†ç®—æ³•"></a> åŠ å¯†ç®—æ³•</h2><p>å¯¹ç§°åŠ å¯†ç®—æ³•ï¼šåŠ å¯†å¯†é’¥ä¸è§£å¯†å¯†é’¥ç›¸åŒï¼›ç”±äºå¯¹ç§°åŠ å¯†çš„è¿ç®—é€Ÿåº¦å¿«ï¼Œæ‰€ä»¥ IPSec ä½¿ç”¨å¯¹ç§°åŠ å¯†ç®—æ³•æ¥åŠ å¯†æ•°æ®ï¼›Example ï¼šDESï¼Œ3DESï¼ŒAES</p><p>éå¯¹ç§°åŠ å¯†ç®—æ³•ï¼šåŠ å¯†å¯†é’¥ä¸è§£å¯†å¯†é’¥ä¸åŒï¼›ç”±äºéå¯¹ç§°åŠ å¯†çš„è¿ç®—é€Ÿåº¦æ…¢ï¼Œæ‰€ä»¥ä¸»è¦ç”¨æ¥äº¤æ¢ç§˜é’¥å’Œèº«ä»½è®¤è¯ï¼›Example ï¼šRSAï¼ŒDH</p><h3 id="dh"><a class="markdownIt-Anchor" href="#dh"></a> DH</h3><p>Diffie-Hellman å¯†é’¥äº¤æ¢ç®—æ³•</p><p>1ã€ä¸»æœº1ï¼Œäº§ç”Ÿä¸€ä¸ªå¾ˆå¤§çš„æ•° <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>a</mi></mrow><annotation encoding="application/x-tex">a</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">a</span></span></span></span> ä¸€ä¸ªç´ æ•° <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>p</mi></mrow><annotation encoding="application/x-tex">p</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathdefault">p</span></span></span></span> å’Œä¸€ä¸ªæ•´æ•° <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>g</mi></mrow><annotation encoding="application/x-tex">g</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">g</span></span></span></span>ï¼Œè®¡ç®—å¾—åˆ° <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>A</mi><mo>=</mo><msup><mi>g</mi><mi>a</mi></msup><mspace></mspace><mspace width="0.6666666666666666em"/><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext>â€‰</mtext><mtext>â€‰</mtext><mi>p</mi></mrow><annotation encoding="application/x-tex">A=g^a \mod p</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault">A</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.858832em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.664392em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">a</span></span></span></span></span></span></span></span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:0.6666666666666666em;"></span></span><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">m</span><span class="mord mathrm">o</span><span class="mord mathrm">d</span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">p</span></span></span></span></p><blockquote><p>å…¬é’¥ï¼šAï¼Œç§é’¥ï¼ša</p></blockquote><p>2ã€å‘é€ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>A</mi><mo separator="true">,</mo><mi>p</mi><mo separator="true">,</mo><mi>g</mi></mrow><annotation encoding="application/x-tex">A, p, g</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8777699999999999em;vertical-align:-0.19444em;"></span><span class="mord mathdefault">A</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">p</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">g</span></span></span></span> ç»™ä¸»æœº2</p><p>3ã€ä¸»æœº2ï¼Œäº§ç”Ÿä¸€ä¸ªå¾ˆå¤§çš„æ•° bï¼Œè®¡ç®—å¾—åˆ° <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>B</mi><mo>=</mo><msup><mi>g</mi><mi>b</mi></msup><mspace></mspace><mspace width="0.6666666666666666em"/><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext>â€‰</mtext><mtext>â€‰</mtext><mi>p</mi></mrow><annotation encoding="application/x-tex">B=g^b \mod p</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.05017em;">B</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.043548em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.849108em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">b</span></span></span></span></span></span></span></span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:0.6666666666666666em;"></span></span><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">m</span><span class="mord mathrm">o</span><span class="mord mathrm">d</span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">p</span></span></span></span></p><blockquote><p>å…¬é’¥ï¼šBï¼Œç§é’¥ï¼šb</p></blockquote><p>4ã€å‘é€ B ç»™ä¸»æœº1</p><p>5ã€<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>K</mi><mi>B</mi></msub><mo>=</mo><msup><mi>A</mi><mi>b</mi></msup><mspace></mspace><mspace width="0.6666666666666666em"/><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext>â€‰</mtext><mtext>â€‰</mtext><mi>p</mi><mo>=</mo><msup><mi>g</mi><mrow><mi>a</mi><mi>b</mi></mrow></msup><mspace></mspace><mspace width="0.6666666666666666em"/><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext>â€‰</mtext><mtext>â€‰</mtext><mi>p</mi></mrow><annotation encoding="application/x-tex">K_B = A^b \mod p = g^{ab} \mod p</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07153em;">K</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.07153em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05017em;">B</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.849108em;vertical-align:0em;"></span><span class="mord"><span class="mord mathdefault">A</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.849108em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">b</span></span></span></span></span></span></span></span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:0.6666666666666666em;"></span></span><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">m</span><span class="mord mathrm">o</span><span class="mord mathrm">d</span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">p</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.043548em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.849108em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">a</span><span class="mord mathdefault mtight">b</span></span></span></span></span></span></span></span></span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:0.6666666666666666em;"></span></span><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">m</span><span class="mord mathrm">o</span><span class="mord mathrm">d</span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">p</span></span></span></span></p><p>6ã€<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>K</mi><mi>A</mi></msub><mo>=</mo><msup><mi>B</mi><mi>a</mi></msup><mspace></mspace><mspace width="0.6666666666666666em"/><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext>â€‰</mtext><mtext>â€‰</mtext><mi>p</mi><mo>=</mo><msup><mi>g</mi><mrow><mi>a</mi><mi>b</mi></mrow></msup><mspace></mspace><mspace width="0.6666666666666666em"/><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext>â€‰</mtext><mtext>â€‰</mtext><mi>p</mi></mrow><annotation encoding="application/x-tex">K_A = B^a \mod p = g^{ab} \mod p</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07153em;">K</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.07153em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">A</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.05017em;">B</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.664392em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">a</span></span></span></span></span></span></span></span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:0.6666666666666666em;"></span></span><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">m</span><span class="mord mathrm">o</span><span class="mord mathrm">d</span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">p</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.043548em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.849108em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">a</span><span class="mord mathdefault mtight">b</span></span></span></span></span></span></span></span></span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:0.6666666666666666em;"></span></span><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">m</span><span class="mord mathrm">o</span><span class="mord mathrm">d</span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">p</span></span></span></span></p><p>Endï¼šå¾—åˆ°å…±äº«å¯†é’¥ï¼Œ<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>K</mi><mi>e</mi><mi>y</mi><mo>=</mo><msup><mi>g</mi><mrow><mi>a</mi><mi>b</mi></mrow></msup><mspace></mspace><mspace width="0.6666666666666666em"/><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext>â€‰</mtext><mtext>â€‰</mtext><mi>p</mi></mrow><annotation encoding="application/x-tex">Key = g^{ab} \mod p</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8777699999999999em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.07153em;">K</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.043548em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.849108em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">a</span><span class="mord mathdefault mtight">b</span></span></span></span></span></span></span></span></span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:0.6666666666666666em;"></span></span><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">m</span><span class="mord mathrm">o</span><span class="mord mathrm">d</span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">p</span></span></span></span></p><h2 id="éªŒè¯ç®—æ³•"><a class="markdownIt-Anchor" href="#éªŒè¯ç®—æ³•"></a> éªŒè¯ç®—æ³•</h2><h3 id="hmac"><a class="markdownIt-Anchor" href="#hmac"></a> HMAC</h3><p>HMACï¼ŒHash-based Message Authentication Codeï¼Œä¸€ç§åŸºäºHashå‡½æ•°å’Œå¯†é’¥è¿›è¡Œæ¶ˆæ¯è®¤è¯çš„æ–¹æ³•ï¼Œå®ç°æ•°æ®å®Œæ•´æ€§éªŒè¯ä¸èº«ä»½éªŒè¯ï¼ŒExample ï¼šMD5ï¼ŒSHA</p><blockquote><p>å¯¹åŠ å¯†åçš„æ•°æ®è¿›è¡Œå“ˆå¸Œï¼ˆé€šå¸¸åŠ  saltï¼‰ï¼Œå¾—åˆ°æ•°å­—ç­¾åï¼›ç„¶åå°†åŠ å¯†åçš„æ•°æ®ä¸æ•°å­—ç­¾åä¸€èµ·å‘é€è¿‡å»ï¼Œä¾›æ¥æ”¶æ–¹è¿›è¡ŒéªŒè¯ã€‚</p></blockquote><h2 id="å¯†é’¥äº¤æ¢"><a class="markdownIt-Anchor" href="#å¯†é’¥äº¤æ¢"></a> å¯†é’¥äº¤æ¢</h2><p>é€šè¿‡éå¯¹ç§°åŠ å¯†ç®—æ³•åŠ å¯†å¯¹ç§°åŠ å¯†ç®—æ³•çš„å¯†é’¥å®Œæˆå¯†é’¥å…±äº«åå†ç”¨å¯¹ç§°åŠ å¯†ç®—æ³•åŠ å¯†å®é™…è¦ä¼ è¾“çš„æ•°æ®ï¼Œä½†æ˜¯å¦‚ä½•å¯¹æŠ—ä¸­é—´äººæ”»å‡»å‘¢ï¼Ÿ</p><blockquote><p>ä¸­é—´äººå®Œå…¨å¯ä»¥æ›´æ”¹éå¯¹ç§°åŠ å¯†ç®—æ³•çš„è¿‡ç¨‹ï¼Œéå¯¹ç§°åŠ å¯†ç®—æ³•å…±äº«å…¬é’¥çš„è¿‡ç¨‹</p></blockquote><p>1ã€é¢„å…±äº«å¯†é’¥ï¼ŒPSKï¼ŒPre-shared keyï¼ŒæŒ‡é€šä¿¡åŒæ–¹åœ¨é…ç½®æ—¶æ‰‹å·¥è¾“å…¥ç›¸åŒçš„å¯†é’¥</p><p>2ã€æ•°å­—è¯ä¹¦ï¼ŒCAï¼ŒCertificate authorityï¼Œå…¶å°†èº«ä»½æ ‡è¯†ä¸å…¬é’¥ç»‘å®šåœ¨ä¸€èµ·ï¼Œå¹¶ç”±å¯ä¿¡ä»»çš„ç¬¬ä¸‰æ–¹æƒå¨æœºæ„ç”¨å…¶ç§é’¥ç­¾åï¼Œè¿™æ ·å°±å¯éªŒè¯è¯ä¹¦è‡ªèº«çš„æœ‰æ•ˆæ€§</p><blockquote><p>ç”±äºä¸€ä¸ª CA ä¸èƒ½æ»¡è¶³æ‰€æœ‰çš„éœ€æ±‚ï¼Œå› æ­¤å½¢æˆäº†ä¸€ä¸ªç±»ä¼¼äº DNS çš„å±‚æ¬¡ CA ç»“æ„</p></blockquote><h1 id="ipsec-å·¥ä½œæ¨¡å¼"><a class="markdownIt-Anchor" href="#ipsec-å·¥ä½œæ¨¡å¼"></a> IPSec å·¥ä½œæ¨¡å¼</h1><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20211013181505022.png" alt="image-20211013181505022" /></p><h2 id="ä¼ è¾“æ¨¡å¼"><a class="markdownIt-Anchor" href="#ä¼ è¾“æ¨¡å¼"></a> ä¼ è¾“æ¨¡å¼</h2><p>å®ç°ç«¯åˆ°ç«¯çš„ä¿æŠ¤ï¼šå°è£…ç®€å•ï¼Œä¼ è¾“æ•ˆç‡ä¸é«˜ï¼Œåªå¯¹æœ‰æ•ˆè½½è·è¿›è¡Œäº†ä¿æŠ¤ï¼ŒIP å¤´æœªè¢«ä¿æŠ¤</p><p>Applicationï¼šè¾ƒé€‚ç”¨äºä¸¤å°ä¸»æœºä¹‹é—´çš„æ•°æ®ä¿æŠ¤</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20211013181231672.png" alt="image-20211013181231672" /></p><h2 id="éš§é“æ¨¡å¼"><a class="markdownIt-Anchor" href="#éš§é“æ¨¡å¼"></a> éš§é“æ¨¡å¼</h2><p>å®ç°ç«™ç‚¹åˆ°ç«™ç‚¹ä¿æŠ¤ï¼šå¯¹æ•´ä¸ªæŠ¥æ–‡è¿›è¡Œäº†å°è£…ï¼ŒIP å¤´è¢«ä¿æŠ¤ï¼ˆå®ç°äº†åŒ¿åï¼‰</p><p>Applicationï¼šè¾ƒé€‚ç”¨äºç«™ç‚¹é—´å»ºç«‹å®‰å…¨ VPN éš§é“ï¼Œä»¥ä¿æŠ¤å¤šå°ä¸»æœº</p><blockquote><p>ç«™ç‚¹å’Œç«™ç‚¹ä¹‹é—´ï¼ˆç½‘å…³ä¹‹ä¸Šï¼‰ï¼Œä¸€ä¸ªç«™ç‚¹çš„æ‰€æœ‰ä¸»æœºéƒ½æŒ‡ä»£åŒä¸€ä¸ªå…¬ç½‘ IP åœ°å€</p></blockquote><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20211013181308850.png" alt="image-20211013181308850" /></p><h2 id="å¯¹æ¯”"><a class="markdownIt-Anchor" href="#å¯¹æ¯”"></a> å¯¹æ¯”</h2><p>ä¼ è¾“æ¨¡å¼é€‚ç”¨äºä¸¤å°ä¸»æœºä¹‹é—´çš„æ•°æ®ä¿æŠ¤ï¼›éš§é“æ¨¡å¼é€‚å®œäºåœ¨ç«™ç‚¹é—´å»ºç«‹å®‰å…¨ VPN éš§é“ï¼šä¿æŠ¤å¤šå°ä¸»æœº</p><h1 id="ah"><a class="markdownIt-Anchor" href="#ah"></a> AH</h1><p>AH åè®®ï¼šAuthentication Headerï¼Œè®¤è¯å¤´åè®®ï¼Œåè®®å·ï¼š51</p><p>æçš„æœåŠ¡å¦‚ä¸‹ï¼šæ•°æ®å®Œæ•´æ€§æœåŠ¡ï¼ˆå“ˆå¸Œæ ¡éªŒï¼‰ï¼Œæ•°æ®æºèº«ä»½è®¤è¯ï¼ˆå…±äº«ç§˜é’¥ï¼‰ï¼Œé˜²æ­¢æ•°æ®é‡æ”¾æ”»å‡»ï¼ˆESP å¤´ä¸­åºåˆ—å·å­—æ®µï¼‰ï¼Œæ•°æ®æœºå¯†æ€§æœåŠ¡ï¼ˆåŠ å¯†ï¼‰</p><blockquote><p>æä¾›æŠ¥å¤´éªŒè¯å·¥èƒ½ï¼Œä½†æ˜¯ä¸èƒ½æä¾›æ•°æ®åŠ å¯†å·¥èƒ½ï¼Œä½¿å¾—æ•°æ®å¯ä»¥è¯»å–ä½†æ˜¯æ— æ³•ä¿®æ”¹</p></blockquote><h2 id="ah-å¤´"><a class="markdownIt-Anchor" href="#ah-å¤´"></a> AH å¤´</h2><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20211013181648238.png" alt="image-20211013181648238" /></p><p><strong>ä¸‹ä¸€å¤´éƒ¨</strong>ï¼ˆ8ä½ï¼‰ï¼šè¡¨ç¤ºç´§è·Ÿåœ¨ AH å¤´éƒ¨åé¢çš„åè®®ç±»å‹ï¼šä¼ è¾“æ¨¡å¼ä¸‹ï¼Œè¯¥å­—æ®µæ˜¯å¤„äºä¿æŠ¤ä¸­çš„ä¼ è¾“å±‚åè®®çš„å€¼ï¼Œå¦‚6ï¼ˆTCPï¼‰ï¼Œ17ï¼ˆUDPï¼‰æˆ– 50ï¼ˆESPï¼‰ï¼›åœ¨éš§é“æ¨¡å¼ä¸‹ï¼ŒAH ä¿æŠ¤æ•´ä¸ª IP åŒ…ï¼Œè¯¥å€¼æ˜¯4ï¼Œè¡¨ç¤ºæ˜¯ IP-in-IP åè®®</p><p><strong>æœ‰æ•ˆè½½è·é•¿åº¦</strong>ï¼ˆ8ä½ï¼‰ï¼šå…¶å€¼æ˜¯ä»¥ 32 ä½ä¸ºå•ä½çš„æ•´ä¸ª AH æ•°æ®ï¼ˆåŒ…æ‹¬å¤´éƒ¨å’Œå˜é•¿éªŒè¯æ•°æ®ï¼‰çš„é•¿åº¦å†å‡ 2ã€‚</p><p><strong>å®‰å…¨å‚æ•°ç´¢å¼•</strong>ï¼ŒSPIï¼Œè¡¨ç¤ºå¯¹å®‰å…¨ç­–ç•¥çš„ç´¢å¼•</p><blockquote><p>ç”¨äºæ ‡è¯†æœ‰ç›¸åŒ IP åœ°å€å’Œç›¸åŒå®‰å…¨åè®®çš„ä¸åŒ SAï¼ˆç”± SA çš„åˆ›å»ºè€…å®šä¹‰ï¼Œåªæœ‰é€»è¾‘æ„ä¹‰ï¼‰</p></blockquote><p><strong>åºåˆ—å·</strong>ï¼Œç”±å•å‘é€’å¢çš„è®¡æ•°å™¨è¿›è¡Œç»´æŠ¤ï¼Œç”¨äºé˜²é‡æ”¾æ”»å‡»</p><p><strong>éªŒè¯æ•°æ®</strong>ï¼šå¯å˜é•¿ï¼Œå–å†³äºé‡‡ç”¨ä½•ç§æ¶ˆæ¯éªŒè¯ç®—æ³•ã€‚åŒ…å«å®Œæ•´æ€§éªŒè¯ç ï¼Œä¹Ÿå°±æ˜¯ HMAC ç®—æ³•çš„ç»“æœï¼Œç§°ä¸º ICVï¼Œå®ƒçš„ç”Ÿæˆç®—æ³•ç”± SA æŒ‡å®šã€‚</p><h2 id="ä¼ è¾“æ¨¡å¼-2"><a class="markdownIt-Anchor" href="#ä¼ è¾“æ¨¡å¼-2"></a> ä¼ è¾“æ¨¡å¼</h2><p>ä¿æŠ¤æœ‰æ•ˆè½½è·ï¼ŒéªŒè¯æ—¶è¿˜éœ€è¦éªŒè¯ IP æŠ¥æ–‡çš„æ•°æ®éƒ¨åˆ†ï¼Œä»¥åŠ IP å¤´ä¸­çš„ä¸å˜éƒ¨åˆ†ï¼ˆ å¯å˜éƒ¨åˆ†é¢„å…ˆç½®0ï¼‰</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20211013181938033.png" alt="image-20211013181938033" /></p><h2 id="éš§é“æ¨¡å¼-2"><a class="markdownIt-Anchor" href="#éš§é“æ¨¡å¼-2"></a> éš§é“æ¨¡å¼</h2><p>éªŒè¯å…¨éƒ¨çš„å†…éƒ¨ IP æŠ¥æ–‡ï¼Œä»¥åŠå¤–éƒ¨æ–° IP å¤´ä¸­çš„ä¸å˜éƒ¨åˆ†ï¼Œå¯¹äºå¯å˜éƒ¨åˆ†å¦‚ TTL ç­‰åº”æå‰ç½®ä½ä¸º 0</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20211013182402554.png" alt="image-20211013182402554" /></p><h1 id="esp"><a class="markdownIt-Anchor" href="#esp"></a> ESP</h1><p>ESP åè®®ï¼šEncapsulating Security Payloadï¼Œå°è£…å®‰å…¨è½½è·å®‰å…¨åè®®ï¼Œåè®®å·ï¼š50</p><p>æçš„æœåŠ¡å¦‚ä¸‹ï¼šæ•°æ®å®Œæ•´æ€§æœåŠ¡ï¼ˆå“ˆå¸Œæ ¡éªŒï¼‰ï¼Œæ•°æ®æºèº«ä»½è®¤è¯ï¼ˆå…±äº«ç§˜é’¥ï¼‰ï¼Œé˜²æ­¢æ•°æ®é‡æ”¾æ”»å‡»ï¼ˆESP å¤´ä¸­åºåˆ—å·å­—æ®µï¼‰ï¼Œæ•°æ®æœºå¯†æ€§æœåŠ¡ï¼ˆåŠ å¯†ï¼‰</p><blockquote><p>æ•°æ®åŒ…ï¼ˆIPåŒ…ï¼‰åŠ å¯†ï¼Œï¼ˆè·¯ç”±å™¨ç«¯ï¼‰æ•°æ®æµåŠ å¯† â€”â€” éœ€è¦ä» SA å¤„è·å–ç§˜é’¥</p><p>ä½†æ˜¯ä¼ è¾“æ¨¡å¼ä¸­çš„ ESP ä¸å¯¹æ•´ä¸ªæ•°æ®åŒ…è¿›è¡Œç­¾åï¼Œä¸æä¾›æŠ¥å¤´éªŒè¯</p></blockquote><h2 id="esp-å¤´"><a class="markdownIt-Anchor" href="#esp-å¤´"></a> ESP å¤´</h2><p>å®‰å…¨å‚æ•°ç´¢å¼• SPI ä¸ åºåˆ—å·ä¸ AH å¤´ä½œç”¨ä¸€è‡´</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20211013183211644.png" alt="image-20211013183211644" /></p><h2 id="ä¼ è¾“æ¨¡å¼-3"><a class="markdownIt-Anchor" href="#ä¼ è¾“æ¨¡å¼-3"></a> ä¼ è¾“æ¨¡å¼</h2><p>ä¼ è¾“æ¨¡å¼ä¸‹å¯¹åŸå§‹ IP å¤´ä¸è¿›è¡Œä¿æŠ¤ï¼Œä»…å¯¹ IP æŠ¥æ–‡çš„æœ‰æ•ˆæ•°æ®éƒ¨åˆ†æä¾›åŠ å¯†</p><p>Tips ï¼šESP å¤´ä¸åŠ å¯†åªè®¤è¯ï¼›ESP å°¾éƒ¨åŠ å¯†ä¹Ÿè®¤è¯ï¼›åŸå§‹ IP å¤´ä¸åŠ å¯†ä¹Ÿä¸è®¤è¯ï¼›</p><blockquote><p>ESP å¤´ä¸­æœ‰å®‰å…¨å‚æ•°ç´¢å¼•ä¸åºåˆ—å·ï¼Œä¼ è¾“è¿‡ç¨‹ä¸­éœ€è¦çŸ¥é“ç´¢å¼•ä¸åºåˆ—å·å¾—çŸ¥å®‰å…¨åŠ å¯†ç­–ç•¥ä¸åºåˆ—å·ä¿¡æ¯</p></blockquote><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20211013183359384.png" alt="image-20211013183359384" /></p><h2 id="éš§é“æ¨¡å¼-3"><a class="markdownIt-Anchor" href="#éš§é“æ¨¡å¼-3"></a> éš§é“æ¨¡å¼</h2><p>å¯¹æ•´ä¸ªå†…éƒ¨ IP æŠ¥æ–‡è¿›è¡ŒåŠ å¯†ï¼Œæ–° IP å¤´ä¸åŠ å¯†ä¹Ÿä¸è®¤è¯</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20211013183443513.png" alt="image-20211013183443513" /></p><h1 id="ah-esp"><a class="markdownIt-Anchor" href="#ah-esp"></a> AH + ESP</h1><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20211127155954664.png" alt="image-20211127155954664" /></p><p>AH ç›¸è¾ƒäº ESP æä¾›äº† IP å¤´çš„è®¤è¯ï¼ŒESP ç›¸è¾ƒäº AH æä¾›äº†æ•°æ®åŠ å¯†</p><blockquote><p>æ‰€ä»¥éœ€è¦ç»“åˆä½¿ç”¨ AH å’Œ ESP æ‰èƒ½ä¿è¯ IP æŠ¥å¤´çš„æœºå¯†æ€§å’Œå®Œæ•´æ€§</p><p>AH ä¸º IP æŠ¥å¤´æä¾›å°½å¯èƒ½å¤šçš„éªŒè¯ä¿æŠ¤ï¼ŒéªŒè¯å¤±è´¥çš„åŒ…å°†è¢«ä¸¢å¼ƒï¼Œä¸äº¤ç»™ä¸Šå±‚åè®®è§£å¯†ï¼Œè¿™ç§æ“ä½œæ¨¡å¼å¯ä»¥å‡å°‘æ‹’ç»æœåŠ¡æ”»å‡»æˆåŠŸçš„æœºä¼šã€‚</p></blockquote><h2 id="ä¼ è¾“æ¨¡å¼ä¸‹"><a class="markdownIt-Anchor" href="#ä¼ è¾“æ¨¡å¼ä¸‹"></a> ä¼ è¾“æ¨¡å¼ä¸‹</h2><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20211013183714583.png" alt="image-20211013183714583" /></p><p>è¿™é‡ŒæŠŠ ESP å¤´ä¹ŸåŠ å¯†äº†ï¼Œæ˜¯å› ä¸º AH å¤´åœ¨å¤–é¢å‘¢ï¼Œåªéœ€è¦ç”¨ä¸€ä¸ªå¤´å³å¯</p><h2 id="éš§é“æ¨¡å¼ä¸‹"><a class="markdownIt-Anchor" href="#éš§é“æ¨¡å¼ä¸‹"></a> éš§é“æ¨¡å¼ä¸‹</h2><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20211013183817158.png" alt="image-20211013183817158" /></p><h2 id="nat-ç©¿è¶Šé—®é¢˜"><a class="markdownIt-Anchor" href="#nat-ç©¿è¶Šé—®é¢˜"></a> NAT ç©¿è¶Šé—®é¢˜</h2><p><strong>Qï¼šä½¿ç”¨ IPSec åœ¨è·¨åŸŸ NAT å‡ºç°ä»€ä¹ˆé—®é¢˜ï¼ŸNAT è¦å˜æ¢ IPï¼Œå¦‚ä½•ä¿è¯ IPSec è®¤è¯ä¾ç„¶æˆåŠŸï¼Ÿ</strong></p><p>NAT å®ç°äº†ç§æœ‰åœ°å€å‘å…¬æœ‰åœ°å€çš„æ˜ å°„ï¼Œä¼šå¯¹ IP å¤´è¿›è¡Œæ›´æ”¹ï¼Œå› æ­¤ä½¿ç”¨å¯¹ IP æŠ¥å¤´è¿›è¡ŒéªŒè¯çš„ AH åè®®çš„ IPsec æ˜¯ä¸èƒ½ç©¿è¶Š NAT çš„ï¼›</p><p>è€Œ ESP ä¸å¯¹å¤–éƒ¨çš„ IP å¤´è¿›è¡Œå®Œæ•´æ€§æ£€æŸ¥ï¼ŒIP åœ°å€è½¬æ¢ä¸ä¼šç ´å ESP çš„ Hash å€¼ã€‚ä½† ESP æŠ¥æ–‡ä¸­ TCP/UDP çš„ç«¯å£å·²ç»åŠ å¯†æ— æ³•ä¿®æ”¹ï¼Œæ‰€ä»¥å¯¹äºåŒæ—¶è½¬æ¢ç«¯å£åŠ IP åœ°å€çš„ NAT æ¥è¯´ï¼ŒESP æ— æ³•ç©¿è¶Š NATï¼ˆç«¯å£åœ°å€è½¬æ¢ï¼‰ã€‚å¦‚æœ NAT åªè½¬æ¢ IP åœ°å€ï¼Œé‚£ä¹ˆä¸ç®¡æ˜¯ä¼ è¾“æ¨¡å¼è¿˜æ˜¯éš§é“æ¨¡å¼ï¼ŒåŸºäº ESP çš„ IPSec å‡èƒ½ç©¿è¶Š NAT</p><p><strong>Qï¼šå¯¹äºåŒæ—¶è½¬æ¢IPåœ°å€åŠç«¯å£çš„NATè€Œè¨€ï¼ŒIPsecå¦‚ä½•ç©¿è¶Šï¼šNAT-Tï¼ˆNAT Traversalï¼‰</strong></p><p>å½“éœ€è¦ç©¿è¶Š NAT è®¾å¤‡æ—¶ï¼ŒESP æŠ¥æ–‡ä¼šè¢«å°è£…åœ¨ä¸€ä¸ª UDP å¤´ä¸­ï¼Œæºå’Œç›®çš„ç«¯å£å·å‡æ˜¯ 4500ï¼Œæœ‰äº†è¿™ä¸ª UDP å¤´å°±å¯ä»¥æ­£å¸¸è¿›è¡Œè½¬æ¢</p><p><strong>è¡¥å……ï¼šç©¿è¶Š NAT åå‡ºç°çš„é—®é¢˜ï¼š</strong></p><p>1ã€èº«ä»½ç¡®è®¤é—®é¢˜ï¼šåœ¨ IP ç½‘ç»œä¸­ IP åœ°å€æ˜¯æœ€å¥½çš„èº«ä»½æ ‡è¯†ï¼ŒIPsec VPN ä¸­æ ‡å‡†èº«ä»½æ ‡è¯†ä¹Ÿæ˜¯ IP åœ°å€ã€‚NAT å¤„ç†è¿‡ç¨‹ä¸­ä¼šæ”¹å˜ IP åœ°å€ï¼Œå› æ­¤ IPsec çš„èº«ä»½ç¡®è®¤æœºåˆ¶å¿…é¡»èƒ½å¤Ÿé€‚åº” IP åœ°å€å˜åŒ–ã€‚ç›®å‰è§£å†³æ­¤é—®é¢˜çš„æ–¹æ³•ä¸»è¦æœ‰ä¸¤ç§ï¼Œç¬¬ä¸€ç§æ˜¯ä½¿ç”¨æ•°å­—è¯ä¹¦æ›¿ä»£ IP åœ°å€ä½œä¸ºèº«ä»½æ ‡è¯†ï¼Œç¬¬äºŒç§æ˜¯ä½¿ç”¨å­—ç¬¦ä¸²å–ä»£ IP åœ°å€ä½œä¸ºèº«ä»½æ ‡è¯†</p><p>2ã€IP åœ°å€å¤ç”¨é—®é¢˜ï¼šESP çš„ IP åè®®å·æ˜¯ 50ï¼Œå¹¶ä¸æ˜¯åŸºäº UDP å’Œ TCP çš„åè®®ï¼ˆè™½ç„¶å…¶å°è£…çš„æ˜¯æ•´ä¸ª IP å±‚æ•°æ®ï¼ŒåŒ…å« TCP/UDP ç­‰ä¼ è¾“å±‚åè®®ï¼‰ï¼Œå› æ­¤å½“ NAT ç½‘å…³èƒŒåå­˜åœ¨å¤šä¸ª ESP åº”ç”¨ç«¯æ—¶ï¼Œæ— æ³•åªæ ¹æ®åè®®å·è¿›è¡Œåå‘æ˜ å°„ï¼Œä¸ºäº†ä½¿ ESP èƒ½å¤Ÿåœ¨ NAT ç¯å¢ƒä¸­è¿›è¡Œåœ°å€å¤ç”¨ï¼ŒESP å¿…é¡»åšå‡ºæ”¹å˜</p><p>refï¼š<a target="_blank" rel="noopener" href="https://blog.csdn.net/u014023993/article/details/86634339">https://blog.csdn.net/u014023993/article/details/86634339</a></p><h1 id="ike"><a class="markdownIt-Anchor" href="#ike"></a> IKE</h1><p>IKE åè®®ï¼šInternet Key Exchangeï¼Œå› ç‰¹ç½‘å¯†é’¥äº¤æ¢åè®®ï¼Œ<strong>ç”¨äºåŠ¨æ€å»ºç«‹ SA</strong> å®ç°ç§˜é’¥äº¤æ¢</p><h2 id="åŸºæœ¬æ¦‚å¿µ"><a class="markdownIt-Anchor" href="#åŸºæœ¬æ¦‚å¿µ"></a> åŸºæœ¬æ¦‚å¿µ</h2><h3 id="æ··åˆåè®®"><a class="markdownIt-Anchor" href="#æ··åˆåè®®"></a> æ··åˆåè®®</h3><p>IKE å±äºæ··åˆåè®®ï¼š</p><p>1ã€<strong>ISAKMP</strong>ï¼ˆåœ¨ä¸¤ä¸ªå®ä½“é—´è¿›è¡Œåˆ†ç»„æ ¼å¼åŠçŠ¶æ€è½¬æ¢çš„æ¶ˆæ¯äº¤æ¢çš„ä½“ç³»ç»“æ„ï¼‰</p><p>2ã€<strong>Oakley</strong>ï¼ˆåŸºäºåˆ°è¾¾ä¸¤ä¸ªå¯¹ç­‰ä½“é—´çš„åŠ å¯†å¯†é’¥çš„æœºåˆ¶ï¼‰</p><p>3ã€<strong>SKEME</strong>ï¼ˆå®ç°å…¬é’¥åŠ å¯†è®¤è¯çš„æœºåˆ¶ï¼‰</p><p>Strength: IPsec éœ€è¦çš„å¾ˆå¤šå‚æ•°ï¼ˆå¯†é’¥ï¼Œç®—æ³•ï¼‰éƒ½å¯ä»¥è‡ªåŠ¨åå•†å»ºç«‹ï¼Œé™ä½äº†æ‰‹å·¥é…ç½®çš„å¤æ‚åº¦ï¼Œè¿˜æä¾›äº†å¤±æ•ˆæ—¶é—´è¿™ä¸€æœºåˆ¶</p><h3 id="ike-çš„æ¥æº"><a class="markdownIt-Anchor" href="#ike-çš„æ¥æº"></a> IKE çš„æ¥æº</h3><p>IPSec SA è´Ÿè´£å…·ä½“çš„æ•°æ®æµåŠ å¯†ï¼Œèƒ½å¤Ÿä½¿å¾— IPSec åŒºåˆ†å¯¹ä¸åŒæ•°æ®æµæä¾›çš„å®‰å…¨æœåŠ¡ï¼Œå¹¶ä¸” IPSec èƒ½å¤Ÿå¯¹ä¸åŒçš„æ•°æ®æµæä¾›ä¸åŒçº§åˆ«çš„å®‰å…¨ä¿æŠ¤ï¼›å› æ­¤å»ºç«‹ IPSec ä¹‹å‰éœ€è¦å…ˆå»ºç«‹ç›¸å¯¹åº”çš„å®‰å…¨è”ç›Ÿï¼ˆSAï¼‰ï¼Œæ‰‹å·¥é…ç½®çš„æ–¹å¼éå¸¸ç¹çå›°éš¾ï¼Œå› æ­¤å¼•å…¥äº† IKEï¼Œå®ç°è‡ªåŠ¨è¿›è¡Œå®‰å…¨è”ç›Ÿå»ºç«‹ä¸å¯†é’¥äº¤æ¢çš„è¿‡ç¨‹</p><h3 id="ike-çš„ç”¨é€”"><a class="markdownIt-Anchor" href="#ike-çš„ç”¨é€”"></a> IKE çš„ç”¨é€”</h3><p>1ã€ä¸º IPSec åå•†ç”Ÿæˆå¯†é’¥ï¼Œä¾› AH/ESP åŠ è§£å¯†å’ŒéªŒè¯ä½¿ç”¨</p><blockquote><p>AH å’Œ ESP ä¸¤ä¸ªåè®®éƒ½ä½¿ç”¨ SA æ¥ä¿æŠ¤é€šä¿¡ï¼Œè€Œ IKE çš„ä¸»è¦åŠŸèƒ½å°±æ˜¯åœ¨é€šä¿¡åŒæ–¹åå•† SA</p></blockquote><p>2ã€åœ¨ IPSec é€šä¿¡åŒæ–¹ä¹‹é—´ï¼ŒåŠ¨æ€åœ°å»ºç«‹å®‰å…¨å…³è”ï¼ˆSAï¼šSecurity Associationï¼‰ï¼Œå¯¹ SA è¿›è¡Œç®¡ç†å’Œç»´æŠ¤</p><blockquote><p>IPSec éœ€è¦ SA æ¥å¯¹ä¸åŒæ•°æ®æµæä¾›ä¸åŒçº§åˆ«çš„å®‰å…¨ä¿æŠ¤</p></blockquote><h2 id="ä¸€å¥è¯è§£é‡Š"><a class="markdownIt-Anchor" href="#ä¸€å¥è¯è§£é‡Š"></a> ä¸€å¥è¯è§£é‡Š</h2><p>IPSecï¼šç«¯åˆ°ç«¯çš„ç¡®ä¿ IP å±‚é€šä¿¡å®‰å…¨çš„æœºåˆ¶/æ¡†æ¶</p><p>IKEï¼šç”¨äºåŠ¨æ€å»ºç«‹ SA å®ç°ç§˜é’¥äº¤æ¢ï¼Œè¾…åŠ© IPSec çš„å®æ–½æ‰§è¡Œ</p><p>ISAKMPï¼šå®šä¹‰äº†ä¸€ä¸ªé€šç”¨çš„å¯ä»¥è¢«ä»»ä½•å¯†é’¥äº¤æ¢åè®®ä½¿ç”¨çš„æ¡†æ¶ï¼ˆåå•†ã€å»ºç«‹ã€ä¿®æ”¹å’Œåˆ é™¤SAçš„è¿‡ç¨‹å’ŒåŒ…æ ¼å¼ï¼‰è¾…åŠ©äº† IKE çš„å®æ–½æ‰§è¡Œ</p><p>SAï¼šæ˜¯ä¸¤ä¸ª IPSec å®ä½“ä¹‹é—´ï¼Œç»è¿‡åå•†å»ºç«‹èµ·æ¥çš„ä¸€ç§åå®šï¼ˆå†…å®¹åŒ…æ‹¬å„ç§ IPSec ç”¨åˆ°çš„å‚æ•°ç®—å‘ç­‰ï¼‰</p><p>SADï¼šå°†æ‰€æœ‰çš„ SA ä»¥æŸç§æ•°æ®ç»“æ„é›†ä¸­å­˜å‚¨çš„ä¸€ä¸ªåˆ—è¡¨</p><p>SPï¼šå†³å®šå¯¹ IP æ•°æ®åŒ…æä¾›ä½•ç§ä¿æŠ¤ï¼Œå¹¶ä»¥ä½•ç§æ–¹å¼å®æ–½ä¿æŠ¤</p><p>SPDï¼šSP ä»¥æŸç§æ•°æ®ç»“æ„é›†ä¸­å­˜å‚¨çš„åˆ—è¡¨</p><h2 id="sa"><a class="markdownIt-Anchor" href="#sa"></a> SA</h2><p>SAï¼ŒSecurity Associationï¼Œå®‰å…¨è”ç›Ÿï¼Œè´Ÿè´£ IPSec SA çš„å»ºç«‹å’Œç»´æŠ¤ï¼Œèµ·æ§åˆ¶ä½œç”¨ï¼Œæ˜¯ä¸¤ä¸ª IPSec å®ä½“ï¼ˆä¸»æœºã€å®‰å…¨ç½‘å…³ï¼‰ä¹‹é—´ï¼Œç»è¿‡åå•†å»ºç«‹èµ·æ¥çš„ä¸€ç§åå®š</p><blockquote><p>å†…å®¹åŒ…æ‹¬ï¼šé‡‡ç”¨ä½•ç§ IPSec åè®®ï¼ˆAHï¼ŒESPï¼‰ï¼›è¿è¡Œæ¨¡å¼ï¼ˆä¼ è¾“æ¨¡å¼ã€éš§é“æ¨¡å¼ï¼‰ï¼›éªŒè¯ç®—æ³•ï¼›åŠ å¯†ç®—æ³•ï¼›åŠ å¯†å¯†é’¥ï¼›å¯†é’¥ç”Ÿå­˜æœŸï¼›æŠ—é‡æ”¾çª—å£ï¼›è®¡æ•°å™¨ç­‰ï¼›</p></blockquote><h3 id="å”¯ä¸€æ ‡è¯†"><a class="markdownIt-Anchor" href="#å”¯ä¸€æ ‡è¯†"></a> å”¯ä¸€æ ‡è¯†</h3><p>SA æ˜¯å•å‘çš„ï¼Œæ¯ä¸ªé€šä¿¡åŒæ–¹éƒ½è¦æœ‰ä¸¤ç§ SAï¼Œ<strong>ä¸‰å…ƒç»„å”¯ä¸€æ ‡è¯†</strong>ï¼ˆSPIï¼Œç›®çš„ IP åœ°å€ï¼ŒIPSec åè®®ï¼‰</p><p>1ã€SPIï¼ŒSecurity Parameter Indexï¼Œå®‰å…¨å‚æ•°ç´¢å¼•ï¼Œç”¨äºæ ‡è¯†å…·æœ‰ç›¸åŒ IP åœ°å€å’Œç›¸åŒå®‰å…¨åè®®çš„ä¸åŒçš„ SA</p><blockquote><p>ç»‘å®šç»Ÿä¸€ IP ä¸‹åŒä¸€å®‰å…¨åè®®ä¸‹çš„ä¸åŒå‚æ•°</p></blockquote><p>2ã€ç›®çš„ IP åœ°å€ï¼ŒSA çš„ç»ˆç«¯åœ°å€</p><p>3ã€IPSec åè®®ï¼Œé‡‡ç”¨ AH, ESP, AH-ESP</p><h3 id="sad"><a class="markdownIt-Anchor" href="#sad"></a> SAD</h3><p><strong>SAD</strong>ï¼šå­˜å‚¨ SA çš„æ•°æ®åº“ï¼ˆdatabaseï¼‰</p><p><strong>å¯¹äºå¤–å‡ºçš„æµé‡</strong>ï¼Œå¦‚æœéœ€è¦ä½¿ç”¨ IPSec å¤„ç†ï¼Œç„¶è€Œç›¸åº”çš„ SA ä¸å­˜åœ¨ï¼Œåˆ™ IPSec å°†å¯åŠ¨IKEæ¥åå•†å‡ºä¸€ä¸ª SAï¼Œå¹¶å­˜å‚¨åˆ° SAD ä¸­ã€‚</p><p><strong>å¯¹äºè¿›å…¥çš„æµé‡</strong>ï¼Œå¦‚æœéœ€è¦è¿›è¡Œ IPSec å¤„ç†ï¼ŒIPSec å°†ä» IP åŒ…ä¸­å¾—åˆ°ä¸‰å…ƒç»„ï¼ˆSPI,DST,Protocolï¼‰ï¼Œå¹¶åˆ©ç”¨è¿™ä¸ªä¸‰å…ƒç»„åœ¨ SAD ä¸­æŸ¥æ‰¾ä¸€ä¸ª SA</p><h2 id="sp"><a class="markdownIt-Anchor" href="#sp"></a> SP</h2><p>Security Policyï¼Œå®‰å…¨ç­–ç•¥ï¼Œå†³å®šå¯¹ IP æ•°æ®åŒ…æ˜¯å¦æä¾›ä¿æŠ¤ï¼Œæä¾›ä½•ç§ä¿æŠ¤ï¼Œä»¥ä½•ç§æ–¹å¼ä¿æŠ¤ï¼ˆæŒ‡å‘ SAï¼‰</p><blockquote><p>ä¸»è¦æ ¹æ®æºIPåœ°å€ã€ç›®çš„IPåœ°å€ã€å…¥æ•°æ®è¿˜æ˜¯å‡ºæ•°æ®ç­‰æ¥æ ‡è¯†</p></blockquote><h3 id="spd"><a class="markdownIt-Anchor" href="#spd"></a> SPD</h3><p>SPDï¼ŒSecurity Policy Databaseï¼Œå®‰å…¨ç­–ç•¥æ•°æ®åº“ï¼Œå°†æ‰€æœ‰çš„ SP ä»¥æŸç§æ•°æ®ç»“æ„é›†ä¸­å­˜å‚¨çš„åˆ—è¡¨</p><p>å½“æ¥æ”¶æˆ–å°†è¦å‘å‡ºIPåŒ…æ—¶ï¼Œé¦–å…ˆè¦æŸ¥æ‰¾SPDæ¥å†³å®šå¦‚ä½•è¿›è¡Œå¤„ç†</p><p>1ã€ä¸¢å¼ƒï¼šæµé‡ä¸èƒ½ç¦»å¼€ä¸»æœºæˆ–è€…å‘é€åˆ°åº”ç”¨ç¨‹åºï¼Œä¹Ÿä¸èƒ½è¿›è¡Œè½¬å‘</p><p>2ã€ä¸ç”¨ IPSecï¼šå¯¹æµé‡ä½œä¸ºæ™®é€šæµé‡å¤„ç†ï¼Œä¸éœ€è¦é¢å¤–çš„ IPSec ä¿æŠ¤</p><p>3ã€ä½¿ç”¨ IPSecï¼šå¯¹æµé‡åº”ç”¨ IPSec ä¿æŠ¤ï¼Œæ­¤æ—¶è¿™æ¡å®‰å…¨ç­–ç•¥è¦æŒ‡å‘ä¸€ä¸ª SAã€‚<strong>å¯¹äºå¤–å‡ºæµé‡</strong>ï¼Œå¦‚æœè¯¥ SA å°šä¸å­˜åœ¨ï¼Œåˆ™å¯åŠ¨ IKE è¿›è¡Œåå•†ï¼ŒæŠŠåå•†çš„ç»“æœè¿æ¥åˆ°è¯¥å®‰å…¨ç­–ç•¥ä¸Šï¼›</p><h2 id="isakmp"><a class="markdownIt-Anchor" href="#isakmp"></a> ISAKMP</h2><p>Internet Security Association Key Management Protocolï¼ŒInternet å®‰å…¨è”ç›Ÿå¯†é’¥ç®¡ç†åè®®ï¼Œå®šä¹‰äº†åå•†ã€å»ºç«‹ã€ä¿®æ”¹å’Œåˆ é™¤ SA çš„è¿‡ç¨‹å’ŒåŒ…æ ¼å¼</p><blockquote><p>IKE çœŸæ­£å®šä¹‰äº†ä¸€ä¸ªå¯†é’¥äº¤æ¢çš„è¿‡ç¨‹ï¼Œè€Œ ISAKMP åªæ˜¯å®šä¹‰äº†ä¸€ä¸ªé€šç”¨çš„å¯ä»¥è¢«ä»»ä½•å¯†é’¥äº¤æ¢åè®®ä½¿ç”¨çš„æ¡†æ¶</p></blockquote><h2 id="ikes-process"><a class="markdownIt-Anchor" href="#ikes-process"></a> IKEâ€™s Process</h2><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20211014090730684.png" alt="image-20211014090730684" /></p><p>1ã€å¯¹ç­‰ä½“ä¹‹é—´å»ºç«‹ä¸€ä¸ª IKE SA å®Œæˆèº«ä»½éªŒè¯å’Œå¯†é’¥ä¿¡æ¯äº¤æ¢åï¼Œ</p><p>2ã€åœ¨ IKE SA çš„ä¿æŠ¤ä¸‹ï¼Œæ ¹æ®é…ç½®çš„ AH/ESP å®‰å…¨åè®®ç­‰å‚æ•°åå•†å‡ºä¸€å¯¹ IPSec SA</p><p>æ­¤åï¼Œå¯¹ç­‰ä½“é—´çš„æ•°æ®å°†åœ¨IPSecéš§é“ä¸­åŠ å¯†ä¼ è¾“</p><h3 id="å®è§‚æµç¨‹"><a class="markdownIt-Anchor" href="#å®è§‚æµç¨‹"></a> å®è§‚æµç¨‹</h3><p>1ã€æµé‡è§¦å‘ IPSec VPN</p><blockquote><p>å¹¶éä¸»åŠ¨å»ºç«‹ï¼Œæœ‰æµé‡è¿‡æ¥èµ° VPN æ‰ä¼šè§¦å‘è¢«åŠ¨å»ºç«‹</p></blockquote><p>2ã€å»ºç«‹ç®¡ç†è¿æ¥</p><blockquote><p>å³è¿›è¡Œé˜¶æ®µ 1ï¼Œç”¨äºä¿è¯éš§é“çš„å®‰å…¨æ€§</p></blockquote><p>3ã€å»ºç«‹æ•°æ®è¿æ¥</p><blockquote><p>é˜¶æ®µ2ï¼Œä¿è¯æ•°æ®çš„å®‰å…¨</p></blockquote><h3 id="é˜¶æ®µ-1-ä¸»åŠ¨åå•†æ¨¡å¼"><a class="markdownIt-Anchor" href="#é˜¶æ®µ-1-ä¸»åŠ¨åå•†æ¨¡å¼"></a> é˜¶æ®µ 1 - ä¸»åŠ¨åå•†æ¨¡å¼</h3><p>é€šä¿¡åŒæ–¹åå•†å’Œå»ºç«‹ IKE åè®®æœ¬èº«ä½¿ç”¨çš„å®‰å…¨é€šé“ï¼Œå³å»ºç«‹ä¸€ä¸ªIKE SAï¼Œæ€»å…±æ˜¯ä¸‰æ¬¡äº¤æ¢è¿‡ç¨‹ï¼Œæ€»å…±æœ‰ 6 ä¸ªæ¶ˆæ¯äº¤äº’</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/20211202165713.png" alt="é˜¶æ®µ 1 ä¸»åŠ¨åå•†æ¨¡å¼" /></p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20211015090109438.png" alt="é˜¶æ®µ 1 ä¸»åŠ¨åå•†æ¨¡å¼2" /></p><p>1ã€åå•†å¯¹ç­‰ä½“é—´çš„ç®¡ç†è¿æ¥ä½¿ç”¨ä½•ç§å®‰å…¨ç­–ç•¥ï¼šA å‘é€ä¸€ä¸ªæˆ–å¤šä¸ª IKE å®‰å…¨æè®®ï¼›B æ”¶åˆ°åæŸ¥æ‰¾æœ€å…ˆåŒ¹é…çš„ IKE å®‰å…¨æè®®ï¼Œå¹¶è¿›è¡Œç¡®è®¤è¿”å›ï¼›A å°†æ¥æ”¶å¯¹ç«¯ç¡®è®¤çš„ç­–ç•¥</p><blockquote><p>äº¤æ¢ ISAKMP / IKE ä¼ è¾“é›†åŠ å¯†ç®—æ³•ã€HMAC åŠŸèƒ½ã€è®¾å¤‡éªŒè¯çš„ç±»å‹ã€DH å¯†é’¥ç»„ã€ç®¡ç†è¿æ¥çš„ç”Ÿå­˜å‘¨æœŸåŒ¹é…çš„åŸåˆ™ä¸ºåå•†åŒæ–¹å…·æœ‰ç›¸åŒçš„åŠ å¯†ç®—æ³•ã€è®¤è¯ç®—æ³•ã€è®¤è¯æ–¹æ³•å’Œ Diffie-Hellman ç»„æ ‡è¯†</p></blockquote><p>2ã€é€šè¿‡ DH ç®—æ³•äº§ç”Ÿå¹¶äº¤æ¢åŠ å¯†ç®—æ³•å’Œ HMAC åŠŸèƒ½æ‰€éœ€çš„å¯†é’¥ï¼šA å…ˆå‘é€æœ¬ç«¯ç§˜é’¥ç”Ÿæˆçš„ä¿¡æ¯ï¼›B æ”¶åˆ°åè¿›è¡Œç§˜é’¥ç”Ÿæˆï¼Œç„¶åè¿”å› B ç§˜é’¥ç”Ÿæˆä¿¡æ¯ï¼›A æ”¶åˆ°åå®Œæˆç§˜é’¥ç”Ÿæˆï¼›</p><blockquote><p>é€šå¸¸ä½¿ç”¨é¢„å…±äº«ç§˜é’¥é˜²æ­¢ä¸­é—´äººæ”»å‡»ï¼šå› ä¸ºæ˜¯ç½‘å…³ä¹‹é—´æ‰€ä»¥æ–¹ä¾¿å®ç°ï¼Œè¯ä¹¦å®ç°éº»çƒ¦æˆæœ¬è¾ƒé«˜</p></blockquote><pre class="line-numbers language-html" data-language="html"><code class="language-html">æ ¹æ®DHçš„å…¬å¼€ä¿¡æ¯éƒ½ç®—å‡ºäº†åŒæ–¹ç›¸ç­‰çš„ç§˜é’¥åï¼Œè¿é€šé¢„å…±äº«å¯†é’¥ç”Ÿæˆç¬¬ä¸€ä¸ªskey_IDSKEYID - è¡¨ç¤ºåŸºå‡†å¯†é’¥ï¼ŒHDRæ‹†è§£ä¸ºCiï¼ŒCrï¼Œåˆ†åˆ«ä»£è¡¨Initiator cookieå’ŒResponder Cookieã€‚ç¬¬ä¸€ä¸ªåŒ…Crä¸º0é€šè¿‡SKEYIDæ¨å¯¼ä¸‰ä¸ªå¯†é’¥SKEYID_d = prf(SKEYID, K | Ci | Cr | 0) -----------æ¨å¯¼å¯†é’¥ï¼Œè¡ç”Ÿå¯†é’¥SKEYID_a = prf(SKEYID, SKEYID_d | K | Ci | Cr | 1)---------éªŒè¯å¯†é’¥SKEYID_e = prf(SKEYID, SKEYID_a | K | Ci | Cr | 2)---------åŠ å¯†å¯†é’¥<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>3ã€ä½¿ç”¨é¢„å…±äº«ç§˜é’¥ç­‰æ–¹å¼æ‰§è¡Œå¯¹ç­‰ä½“é—´çš„èº«ä»½éªŒè¯ï¼šA å‘é€æœ¬ç«¯èº«ä»½å’ŒéªŒè¯ä¿¡æ¯ï¼›B ç«¯è¿›è¡Œèº«ä»½éªŒè¯å’Œäº¤æ¢è¿‡ç¨‹éªŒè¯ï¼Œéšåå‘é€ B çš„èº«ä»½å’ŒéªŒè¯ä¿¡æ¯ï¼›A æ”¶åˆ°åå®Œæˆèº«ä»½éªŒè¯å’Œäº¤æ¢è¿‡ç¨‹éªŒè¯ï¼›</p><blockquote><p>DH ç®—æ³•åï¼Œæ­¤æ¶ˆæ¯å°±ä½¿ç”¨ SKEYID_e åŠ å¯†ä¼ è¾“äº†ï¼šä½¿ç”¨å¯†é’¥åŠ å¯†ç”¨æˆ·èº«ä»½ä¿¡æ¯ï¼›ä½¿ç”¨å¯†é’¥å’Œç”¨æˆ·ä¿¡æ¯é€šè¿‡ hash ç®—æ³•è®¡ç®—æ•°å­—ç­¾å;å¯¹æ–¹æ¯”å¯¹æ•°å­—ç­¾åç¡®è®¤èº«ä»½</p></blockquote><p><strong>å‰å››ä¸ªæŠ¥æ–‡ä¸ºæ˜æ–‡ä¿¡æ¯ï¼Œåç»­æŠ¥æ–‡ä¸ºå¯†æ–‡ä¼ è¾“</strong></p><p>Qï¼šä¸ºä»€ä¹ˆæœ‰äº†é¢„å…±äº«ç§˜é’¥è¿˜è¦ç”¨ DH ç”Ÿæˆ skey_ID ç„¶ååœ¨ç”Ÿæˆä¸‰ä¸ªå­ç§˜é’¥å‘¢ï¼Ÿ</p><p>Aï¼šé¢„å…±äº«ç§˜é’¥æ˜¯é¢„è®¾å¹¶ä¸èƒ½ç»å¸¸æ”¹å˜ï¼Œè€Œå…¶å®ƒçš„ç§˜é’¥æ˜¯éœ€è¦ç»å¸¸æ”¹å˜æ¥ä¿è¯å®‰å…¨æ€§ï¼ˆéšæœºç”Ÿæˆï¼‰ï¼Œå› æ­¤ä½¿ç”¨é¢„å…±äº«ç§˜é’¥è´Ÿè´£èº«ä»½è®¤è¯ï¼Œåç»­çš„ç§˜é’¥éšæœºç”Ÿæˆä½¿ç”¨</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20211015090753216.png" alt="image-20211015090753216" /></p><h3 id="é˜¶æ®µ-1-é‡è›®æ¨¡å¼"><a class="markdownIt-Anchor" href="#é˜¶æ®µ-1-é‡è›®æ¨¡å¼"></a> é˜¶æ®µ 1 - é‡è›®æ¨¡å¼</h3><p>é‡è›®æ¨¡å¼äº¤äº’è¿‡ç¨‹å°‘ï¼Œæ‰€ä»¥åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­ï¼Œå…¶ä¼ è¾“çš„æ•°æ®æ¯”è¾ƒå¤šï¼Œå¹¶ä¸”å‰ä¸¤ä¸ªæ•°æ®ä¸ºæ˜æ–‡ä¼ è¾“ï¼Œä»…æ¶ˆæ¯3ä¸ºåŠ å¯†ä¼ è¾“ã€‚</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/20211202170905.png" alt="é˜¶æ®µ 1 - é‡è›®æ¨¡å¼" /></p><p>1ã€å‘èµ·æ–¹å»ºè®®SAï¼Œå‘èµ·DHäº¤æ¢ï¼šå‘èµ·è€…å‘é€ 5 å…ƒç»„ï¼ˆIKE SAçš„å„é¡¹å‚æ•°ï¼‰ï¼ŒDH å…¬å…±å€¼ï¼Œè¾…åŠ©éšæœºæ•° nonce ä»¥åŠèº«ä»½èµ„æ–™ã€‚å“åº”è€…å¯ä»¥é€‰æ‹©æ¥å—æˆ–è€…æ‹’ç»è¯¥å»ºè®®</p><p>2ã€æ¥æ”¶æ–¹æ¥å—SA, è®¤è¯æ¥æ”¶æ–¹ï¼šå›åº”ä¸€ä¸ªé€‰å®šçš„ 5 å…ƒç»„ï¼ŒDH å…¬å…±å€¼ï¼Œè¾…åŠ©éšæœºæ•°nonceï¼Œèº«ä»½ææ–™ä»¥åŠä¸€ä¸ªâ€œè®¤è¯æ•£åˆ—å€¼â€ã€‚</p><blockquote><p>Tips: åŒ…å«èº«ä»½ä¿¡æ¯çš„æ¶ˆæ¯æœªè¢«åŠ å¯†, æ‰€ä»¥å’Œä¸»æ¨¡å¼ä¸åŒï¼Œé‡è›®æ¨¡å¼ä¸æä¾›èº«ä»½ä¿æŠ¤</p></blockquote><p>3ã€å‘èµ·æ–¹è®¤è¯æ¥å—æ–¹ï¼šå‘èµ·è€…å‘é€ä¸€ä¸ªâ€œè®¤è¯æ•£åˆ—å€¼â€ï¼Œè¯¥æ¶ˆæ¯è¢«éªŒè¯ï¼Œè®©åº”ç­”æ–¹èƒ½å¤Ÿç¡®å®šå…¶ä¸­çš„æ•£åˆ—å€¼æ˜¯å¦ä¸è®¡ç®—å¾—åˆ°çš„æ•£åˆ—å€¼ç›¸åŒï¼Œè¿›è€Œç¡®å®šæ¶ˆæ¯æ˜¯å¦æœ‰é—®é¢˜ã€‚å®é™…ä¸Šï¼Œè¿™ä¸ªæ¶ˆæ¯è®¤è¯å‘èµ·è€…å¹¶ä¸”è¯æ˜å®ƒæ˜¯äº¤æ¢çš„å‚ä¸è€…ã€‚è¿™ä¸ªæ¶ˆæ¯ä½¿ç”¨å‰ä¸¤ä¸ªæ¶ˆæ¯äº¤æ¢çš„å¯†é’¥ä¿¡æ¯ç”Ÿæˆçš„å¯†é’¥è¿›è¡ŒåŠ å¯†ã€‚</p><h3 id="é˜¶æ®µ-1-å¯¹æ¯”"><a class="markdownIt-Anchor" href="#é˜¶æ®µ-1-å¯¹æ¯”"></a> é˜¶æ®µ 1 - å¯¹æ¯”</h3><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/20211202171632.png" alt="" /></p><h3 id="é˜¶æ®µ-2"><a class="markdownIt-Anchor" href="#é˜¶æ®µ-2"></a> é˜¶æ®µ 2</h3><p>åŒæ–¹åå•† IPSec SA å®‰å…¨å‚æ•°ï¼Œç§°ä¸ºå˜æ¢é›† transform setï¼ŒåŒ…æ‹¬ï¼šåŠ å¯†ç®—æ³•ã€Hashç®—æ³•ã€å®‰å…¨åè®®ã€å°è£…æ¨¡å¼ã€å­˜æ´»æ—¶é—´ï¼›å…¶æ¬¡è¿˜éœ€è¦å‘¨æœŸæ€§çš„å¯¹æ•°æ®è¿æ¥æ›´æ–°å¯†é’¥ä¿¡æ¯ï¼›</p><p>1ã€A å‘ B è®¤è¯è‡ªå·±ã€å»ºè®®å®‰å…¨å…³è”ã€äº¤æ¢å…¬å¼€å€¼ã€é€‰æ‹© nonce ç­‰</p><p>2ã€B å‘ A è®¤è¯è‡ªå·±ã€å»ºè®®å®‰å…¨å…³è”ã€äº¤æ¢å…¬å¼€å€¼ã€é€‰æ‹© nonce ç­‰</p><p>3ã€A å‘ B å‘é€ä¸€ä¸ªæ¶ˆæ¯æ¥è¯æ˜è‡ªå·±çš„æ´»æ€§ï¼Œè¯¥æ¶ˆæ¯åªåŒ…å«ä¸€ä¸ª Hash å€¼</p><blockquote><p>å¿«é€Ÿæ¨¡å¼çš„åå•†æ˜¯å— IKE SA ä¿æŠ¤çš„ï¼Œæ‰€ä»¥åå•†é£å¿«å½“ç¬¬äºŒé˜¶æ®µåå•†å®Œæ¯•ä¹‹åï¼Œç¬¬ä¸€é˜¶æ®µçš„ç­–ç•¥å°†æš‚æ—¶ä¸ä¼šè¢«ä½¿ç”¨ï¼Œç›´åˆ°æœ‰æ–°çš„VPNè¿æ¥å»ºç«‹æ—¶æˆ–IPSEC SAåŠ å¯†å¯†é’¥è¶…æ—¶æ—¶ï¼Œæ‰ä¼šç”¨ç¬¬ä¸€é˜¶æ®µçš„ç­–ç•¥é‡æ–°ç”Ÿæˆå¹¶ä¼ é€’æ–°çš„åŠ å¯†æ•°æ®å’Œè®¤è¯çš„å¯†é’¥ã€‚</p></blockquote><p>Qï¼šä¸ºä»€ä¹ˆåˆè¦åå•† IPSec çš„å‚æ•°ï¼Ÿ</p><p>Aï¼šä¸€ä¸ª IKE ä¸‹å¯ä»¥æ‰¿è½½å¤šä¸ª IPSecï¼ˆquick æ¨¡å¼ï¼‰ï¼Œä½¿å¾— IKE å¯ä»¥å¤ç”¨ï¼›ç¬¬ä¸€ä¸ª SA ä½œç”¨ä¸ IKE ä¿è¯äº†é€šé“å®‰å…¨ï¼›éšåçš„ IPSec SA ä½¿å¾— IKE å¯ä»¥å¤ç”¨ï¼›</p><h2 id="demo-åˆ†æ"><a class="markdownIt-Anchor" href="#demo-åˆ†æ"></a> Demo åˆ†æ</h2><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/20211202172856.png" alt="Demo åˆ†æ" /></p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20211014134933959.png" alt="image-20211014134933959" /></p><p>1ã€æ•°æ®ä¼ è¾“</p><p>2ã€åˆ° SPD ä¸­æŸ¥æ‰¾å®‰å…¨ç­–ç•¥ï¼šå‘ç°æºåœ°å€ä¸º <code>1.25</code> ç›®çš„åœ°å€ä¸º <code>2.34</code> çš„éœ€è¦ä½¿ç”¨å®‰å…¨ç­–ç•¥</p><p>3ã€éœ€è¦å»ºç«‹ç›¸åº”çš„ IKE SAï¼ˆå®‰å…¨å…³è”ï¼‰ï¼šæŸ¥æ‰¾ç­–ç•¥è¡¨ä¸­æ˜¯å¦å­˜åœ¨ SA</p><blockquote><p>å¦‚æœæ²¡æœ‰ï¼Œéœ€è¦è¿›è¡Œé˜¶æ®µ 1 å…­æ­¥çš„å…³è”</p><p>å¦‚æœæœ‰ï¼Œåªéœ€è¦è¿›è¡Œé˜¶æ®µ 2</p></blockquote><p>4ã€å»ºç«‹å…³è”åå»ºç«‹äº†ç›¸åº”çš„ SA</p><p>5ã€åœ¨ SAD ä¸­æŸ¥æ‰¾å¯¹åº” SA çš„å‚æ•°</p><p>6ã€åŸºäº SPD ä¸ SAD åå•†å»ºç«‹ IPSec SA</p><p>7ã€å¯¹åŸæœ‰æ•°æ®æŠ¥è¿›è¡Œç›¸åº”çš„å®‰å…¨å¤„ç†</p><h1 id="refs"><a class="markdownIt-Anchor" href="#refs"></a> Refs</h1><p>[1] <a target="_blank" rel="noopener" href="https://blog.csdn.net/NEUChords/article/details/92968314">CSDN - NEUChords - IPSecä»‹ç»</a></p><p>[2] <a target="_blank" rel="noopener" href="https://blog.csdn.net/s2603898260/article/details/105831370">CSDN - å¨é™ªé²¤ - IPSec ä¸“æ ç›®å½•é”¦é›†(openswan)</a></p>]]></content>
      
      
      <categories>
          
          <category> Protocol Security </category>
          
      </categories>
      
      
        <tags>
            
            <tag> security </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Same Origin Policy</title>
      <link href="/Coming-blog/2021/10/29/same-origin-policy/"/>
      <url>/Coming-blog/2021/10/29/same-origin-policy/</url>
      
        <content type="html"><![CDATA[<h1 id="same-origin-policy"><a class="markdownIt-Anchor" href="#same-origin-policy"></a> Same-Origin Policy</h1><p>refsï¼š<a target="_blank" rel="noopener" href="https://www.cnblogs.com/gyrgyr/p/10571616.html">https://www.cnblogs.com/gyrgyr/p/10571616.html</a></p><p><strong>Definition</strong>: ä¸€ç§å®‰å…¨æœºåˆ¶ï¼Œç”¨äºé™åˆ¶ä¸åŒæºçš„ document æˆ– script ç›¸äº’è®¿é—®</p><p><strong>Target</strong>ï¼šç›®æ ‡æ˜¯é™åˆ¶ scriptsï¼šå¦‚æœä¸åŠ è¿™ä¸ªé™åˆ¶ï¼Œé‚£ä¹ˆæ¶æ„ç½‘é¡µä¸‹çš„ scripts å°†èƒ½å¤Ÿè·å–åˆ«çš„ç½‘é¡µä¸‹çš„ Cookie ç­‰ï¼Œç„¶ååœ¨æœ¬åœ°ç½‘é¡µå¼€å¯äº†ä¸€ä¸ª iframeï¼Œç™»å½•åè¿›è¡Œæ¶æ„æ€§æ“ä½œï¼Œä½†æ˜¯åŒæºç­–ç•¥çš„å­˜åœ¨ï¼Œå…ˆä¸è¯´ Cookie ç­‰ç§å¯†ä¿¡æ¯è·å–ä¸åˆ°ï¼Œå³ä½¿å¼€èµ·äº† iframe ä¹Ÿå°†å’Œæ¶æ„ script ä¸åŒæº</p><p><strong>Example</strong>ï¼šæ¶æ„é’“é±¼ç½‘ç«™ï¼Œå¼•å…¥ç¬¬ä¸‰æ–¹é‚®ä»¶æœåŠ¡åï¼Œå› ä¸ºä¸åŒæºï¼Œä¸€æ¬¡ä½ ä¸èƒ½ç”¨è„šæœ¬è®¿é—®æˆ–æ“ä½œå…¶æ•°æ®</p><h1 id="origin"><a class="markdownIt-Anchor" href="#origin"></a> Origin</h1><p>ä»€ä¹ˆæ˜¯åŒæºçš„å‘¢ï¼Œå®ƒå°†ç”± URL å†³å®šï¼Œä»–çš„ åè®®ï¼ˆhttp, httpsï¼‰ï¼Œç«¯å£å·ï¼ˆ80,8080ï¼‰ï¼Œä¸»æœºåï¼ˆ<a target="_blank" rel="noopener" href="http://baidu.com">baidu.com</a>, <a target="_blank" rel="noopener" href="http://sina.com">sina.com</a>) éƒ½è¦ä¸€è‡´æ‰èƒ½è§†ä¸ºåŒæº</p><p>ä¸ <code>http://store.company.com/dir/page.html</code> ç›¸æ¯”</p><table><thead><tr><th>URL</th><th>Accessible</th><th>Reason</th></tr></thead><tbody><tr><td><a target="_blank" rel="noopener" href="http://store.company.com/dir2/other.html">http://store.company.com/dir2/other.html</a></td><td>True</td><td>ä¸»æœºåä¸€è‡´ åç»­çš„å­ç›®å½•è·¯å¾„å¯ä¸åŒ</td></tr><tr><td><a target="_blank" rel="noopener" href="https://store.company.com/page.html">https://store.company.com/page.html</a></td><td>False</td><td>åè®®ä¸åŒ</td></tr><tr><td><a target="_blank" rel="noopener" href="http://store.company.com:81/dir/page.html">http://store.company.com:81/dir/page.html</a></td><td>False</td><td>ç«¯å£å·ä¸åŒï¼Œhttp é»˜è®¤ 80</td></tr><tr><td><a target="_blank" rel="noopener" href="http://news.company.com/dir/page.html">http://news.company.com/dir/page.html</a></td><td>False</td><td>ä¸»æœºåä¸åŒ</td></tr></tbody></table><p>Tipsï¼šIE æµè§ˆå™¨çš„åŒæºç­–ç•¥æ˜¯ä¸è€ƒè™‘ç«¯å£çš„</p><h2 id="cookie-same-origin-policy"><a class="markdownIt-Anchor" href="#cookie-same-origin-policy"></a> Cookie Same-Origin Policy</h2><p>Cookie åªæœ‰åŒæºç½‘é¡µæ‰èƒ½å…±äº«ï¼ˆProtocolï¼ŒPortï¼Œhostï¼‰</p><h2 id="dom-same-origin-policy"><a class="markdownIt-Anchor" href="#dom-same-origin-policy"></a> DOM Same-Origin Policy</h2><p>DOMï¼Œæ–‡æ¡£å¯¹è±¡æ¨¡å‹ï¼ŒDocument Object Modelï¼šåœ¨ç½‘é¡µä¸Šç»„ç»‡é¡µé¢æˆ–æ–‡æ¡£çš„å¯¹è±¡è¢«ç»„ç»‡åœ¨ä¸€ä¸ªæ ‘å½¢ç»“æ„ä¸­ï¼Œç”¨æ¥è¡¨ç¤ºæ–‡æ¡£ä¸­å¯¹è±¡çš„æ ‡å‡†æ¨¡å‹å³ä¸º DOM</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20210920152526889.png" alt="image-20210920152526889" /></p><p>1ã€<code>&lt;script&gt;, &lt;img&gt;, &lt;iframe&gt;, &lt;link&gt;</code> çš„è·¨åŸŸè¯·æ±‚ï¼Œä¸å—åŒæºç­–ç•¥çš„çº¦æŸï¼Œä½†ä¸èƒ½é€šè¿‡ ajax æ¥è·å–</p><blockquote><p>å°±æ˜¯æˆ‘ä»¬å¯ä»¥å¼•å…¥å¤–éƒ¨ç½‘ç«™çš„ script, img, iframe, linkï¼Œæˆ‘ä»¬æ‰€é™åˆ¶çš„æ˜¯å¼•å…¥çš„å†…å®¹çš„æ“ä½œ</p></blockquote><p>2ã€å¼•å…¥å¤–éƒ¨ script æ–‡ä»¶åï¼Œè¯¥æ–‡ä»¶çš„æºä¸ºå½“å‰é¡µé¢ï¼ˆè°å¼•å…¥çš„ JS é‚£ä¹ˆ JS å°±å±äºå“ªä¸ªåŸŸï¼‰</p><blockquote><p><code>&lt;iframe&gt;</code> å¼•å…¥åæºä¸å˜</p></blockquote><p>3ã€script ä¸èƒ½éšæ„è·¨åŸŸæ“ä½œå…¶å®ƒé¡µé¢çš„ DOM</p><p>4ã€script ä¸èƒ½è·å– <code>&lt;script&gt;, &lt;img&gt;, &lt;iframe&gt;, &lt;link&gt;</code> è·¨åŸŸè¯·æ±‚å¾—åˆ°çš„å†…å®¹ï¼ˆå¯ä»¥è·å–ä¸€äº›ä¸æ¶‰åŠç”¨æˆ·éšç§çš„å…¬å…±ä¿¡æ¯ï¼‰</p><blockquote><p>æ³¨æ„è¯·æ±‚å¯ä»¥é€è¾¾ï¼Œä½†æ˜¯å“åº”å°†è¢«æ‹¦æˆª</p><p>ä¸åŒæº JavaScript å—é™ï¼ŒåŒæºä¸å—é™</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20210920152846907.png" alt="image-20210920152846907" /></p></blockquote><p>5ã€<code>&lt;iframe&gt;</code> çˆ¶å­é¡µé¢ï¼ˆç‚¹å‡»è¿›å…¥çš„ä¸‹ä¸€é¡µé¢ï¼‰äº¤äº’å—åŒæºç­–ç•¥çº¦æŸ</p><h2 id="ajax-same-origin-policy"><a class="markdownIt-Anchor" href="#ajax-same-origin-policy"></a> Ajax Same-Origin Policy</h2><p>Tipsï¼šé˜»æ­¢çš„æ˜¯è·¨åŸŸèµ„æºçš„è·å–ï¼Œè€Œä¸æ˜¯é˜»æ­¢è·¨åŸŸçš„è¯·æ±‚ï¼›è·¨åŸŸè¯·æ±‚å¯ä»¥æ­£å¸¸å‘å‡ºï¼Œä½†æ˜¯æµè§ˆå™¨é˜»æ­¢è„šæœ¬è·å–è¿”å›çš„å†…å®¹ã€‚</p><h2 id="web-storage-same-origin-policy"><a class="markdownIt-Anchor" href="#web-storage-same-origin-policy"></a> Web Storage Same-Origin Policy</h2><p>å…‹æœ Cookie çš„é™åˆ¶ï¼šå¦‚æœä½ çš„æ•°æ®ä¸éœ€è¦æœåŠ¡ç«¯å¤„ç†ï¼Œåªéœ€è¦å­˜å‚¨åœ¨å®¢æˆ·ç«¯å³å¯ï¼Œä½†æ˜¯ä¹Ÿå­˜åœ¨åŒæºè®¿é—®çš„é™åˆ¶</p><p><strong>Target</strong>ï¼š1ã€æä¾›ä¸€ç§åœ¨ Cookie ä¹‹å¤–å­˜å‚¨ä¼šè¯æ•°æ®çš„é€”å¾„ï¼›2ã€æä¾›ä¸€ç§å­˜å‚¨å¤§é‡å¯ä»¥è·¨ä¼šè¯å­˜åœ¨çš„æ•°æ®çš„æœºåˆ¶</p><p><strong>localStorage</strong>ï¼šä¸ç«™ç‚¹æºï¼ˆoriginï¼‰ç»‘å®šï¼Œå…³é—­æµè§ˆå™¨åä»ç„¶æœ‰æ•ˆ</p><p><strong>sessionStorage</strong>ï¼šç»‘å®šå½“å‰æµè§ˆå™¨ç«¯å£ï¼Œæµè§ˆå™¨ä¼šè¯ç»“æŸåæ¸…ç†</p><h2 id="è„šæœ¬å‹-url-çš„åŒæºç­–ç•¥"><a class="markdownIt-Anchor" href="#è„šæœ¬å‹-url-çš„åŒæºç­–ç•¥"></a> è„šæœ¬å‹ URL çš„åŒæºç­–ç•¥</h2><p>ä¼ª URL çš„æºå¦‚ä½•åˆ¤å®šï¼Ÿ</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20210920154445387.png" alt="image-20210920154445387" /></p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20210920154552671.png" alt="image-20210920154552671" /></p><p><strong>Tips</strong>ï¼šåœ¨è„šæœ¬å‹ URL åŠ è½½çš„é¡µé¢é‡Œï¼Œä»¥çˆ¶é¡µé¢çš„ä¸Šä¸‹æ–‡æƒé™æ‰§è¡Œç›¸åº”çš„è„šæœ¬ä»£ç â€”â€”ä¸çˆ¶é¡µé¢åŒæº</p><blockquote><p>é€šè¿‡ bank æ‰§è¡Œçš„è„šæœ¬å‹ js ä»£ç ï¼Œå³ä¸ bank åŒæºï¼Œå³å¯æ“ä½œ iframe å†…çš„å†…å®¹</p></blockquote><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20211028222503110.png" alt="image-20211028222503110" /></p><h1 id="cross-origin"><a class="markdownIt-Anchor" href="#cross-origin"></a> Cross Origin</h1><h2 id="server-proxy"><a class="markdownIt-Anchor" href="#server-proxy"></a> Server Proxy</h2><p>åŒæºç­–ç•¥çš„ä½œç”¨åŸŸæ˜¯<strong>æµè§ˆå™¨</strong>ï¼Œå› æ­¤å¯ä»¥åˆ©ç”¨æœåŠ¡å™¨å®ç°è·¨åŸŸé€šä¿¡ï¼Œå³ä½¿ç”¨ç¬¬ä¸‰æ–¹æœåŠ¡å™¨è·å–ç›®æ ‡ä¿¡æ¯åœ¨è¿”å›ç»™è‡ªå·±ï¼ˆä¹Ÿå°±æ˜¯æˆ‘ä»¬å¸¸è¯´çš„ä»£ç†æœåŠ¡å™¨ï¼‰</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20210920155214194.png" alt="image-20210920155214194" /></p><p>React Scaffolding ä¸­åœ¨ package.json è¿½åŠ å¦‚ä¸‹é…ç½®ï¼Œå½“ç”¨ ajax è¯·æ±‚äº†æœ¬åœ°ä¸å­˜åœ¨çš„èµ„æºï¼Œå°†ä¼šè½¬å‘ç»™ç›®æ ‡ä»£ç†ï¼ˆä½†æ˜¯ä¸æ”¯æŒé…ç½®å¤šä¸ªä»£ç†ï¼‰</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">&quot;proxy&quot;:&quot;http:&#x2F;&#x2F;localhost:5000&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="documentdomain"><a class="markdownIt-Anchor" href="#documentdomain"></a> document.domain</h2><p>script çˆ¶å­é¡µé¢ä¸­è®¾ç½® <code>document.domain</code> ä¸ºå…±åŒç¥–å…ˆåŸŸå³å¯ï¼Œå¦‚æœéå½“å‰  url çš„ç¥–å…ˆåŸŸï¼Œåˆ™ä¸ä¼šç”Ÿæ•ˆ</p><blockquote><p>è¿™æ ·åšä½¿å¾—ä¸»ç«™å’Œå­ç«™ï¼Œä»¥åŠå­ç«™ä¹‹é—´å¯ä»¥è·¨åŸŸè®¿é—®ï¼Œä¸é€‚ç”¨äºè·¨åŸºç¡€åŸŸçš„ç«™ç‚¹é—´å…±äº«æ•°æ®</p></blockquote><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20211028215714174.png" alt="image-20211028215714174" /></p><p>Tipsï¼šAjax è¯·æ±‚è¯¥è·¨åŸŸæ–¹æ³•æ— æ•ˆï¼›<strong>Ajaxè·¨åŸŸå¿…é¡» Protocolï¼Œportï¼Œhost ä¸€è‡´</strong></p><h2 id="jsonp"><a class="markdownIt-Anchor" href="#jsonp"></a> JSONP</h2><p>JSON with Paddingï¼Œåˆ©ç”¨ <code>&lt;script&gt;</code> æ ‡ç­¾å¯ä»¥è·¨åŸŸ <code>get</code> å¼•å…¥ js è„šæœ¬è¿™ä¸€ç‚¹ï¼Œéœ€è¦æœåŠ¡å™¨ç«¯é…åˆæ¥å£ï¼Œç”¨è„šæœ¬åŠ¨æ€ç”Ÿæˆ <code>js</code> å°†æ•°æ®å°è£…åœ¨è¿”å›çš„ <code>js</code> è„šæœ¬é‡Œï¼Œä¾›å®¢æˆ·ç«¯æå‰å®šä¹‰å¥½çš„å›è°ƒå‡½æ•°ä½¿ç”¨</p><p><strong>Tips</strong>ï¼šä»…èƒ½åº”ç”¨äº GET è¯·æ±‚</p><p>1ã€get æ–¹å¼è¯·æ±‚æ•°æ®ï¼Œè¿”å› JavaScript è„šæœ¬</p><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text/javascript<span class="token punctuation">"</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://example.com/     ?some-variable=some-data&amp;jsonp=parseResponse<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript"></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>2ã€æœåŠ¡ç«¯å°è£…æ•°æ®ä¸ callback å‡½æ•°</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Student</span><span class="token punctuation">></span></span> studentList <span class="token operator">=</span> <span class="token function">getStudentList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">JSONArray</span> jsonArray <span class="token operator">=</span> <span class="token class-name">JSONArray</span><span class="token punctuation">.</span><span class="token function">fromObject</span><span class="token punctuation">(</span>studentList<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">String</span> result <span class="token operator">=</span> jsonArray<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//å‰ç«¯ä¼ è¿‡æ¥çš„å›è°ƒå‡½æ•°åç§°</span><span class="token class-name">String</span> callback <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">"jsonp"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//ç”¨å›è°ƒå‡½æ•°åç§°åŒ…è£¹è¿”å›æ•°æ®ï¼Œè¿™æ ·ï¼Œè¿”å›æ•°æ®å°±ä½œä¸ºå›è°ƒå‡½æ•°çš„å‚æ•°ä¼ å›å»äº†</span>result <span class="token operator">=</span> callback <span class="token operator">+</span> <span class="token string">"("</span> <span class="token operator">+</span> result <span class="token operator">+</span> <span class="token string">")"</span><span class="token punctuation">;</span>response<span class="token punctuation">.</span><span class="token function">getWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>3ã€å› ä¸ºæ˜¯è„šæœ¬ï¼Œå¹¶ä¸”è¿”å›åˆ°æœ¬åœ°å·²ç»é¢„å®šä¹‰äº†å›è°ƒå‡½æ•°ï¼Œå› æ­¤å°†ç›´æ¥è‡ªåŠ¨æ‰§è¡Œï¼Œè¯»å‡ºè¿”å›çš„ç›®æ ‡å†…å®¹</p><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>test/javascript<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript"><span class="token comment">// parseResponse(&#123;"variable": "value", "variable2": "value2"&#125;)</span><span class="token keyword">function</span> <span class="token function">parseResponse</span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token keyword">do</span> sth<span class="token punctuation">&#125;</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="windowname"><a class="markdownIt-Anchor" href="#windowname"></a> <a target="_blank" rel="noopener" href="http://Window.name">Window.name</a></h2><p><a target="_blank" rel="noopener" href="http://window.name">window.name</a> æ˜¯å…¨å±€å˜é‡ï¼Œåœ¨çª—å£ï¼ˆwindowï¼‰çš„ç”Ÿå‘½å‘¨æœŸå†…ï¼Œçª—å£é‡å®šå‘åè½½å…¥çš„é¡µé¢å…±äº« <a target="_blank" rel="noopener" href="http://window.name">window.name</a>ï¼›åŒç†åœ¨ iframe ä¸­å³ä½¿ url å‘ç”Ÿäº†å˜åŒ– iframe ä¸­çš„ <a target="_blank" rel="noopener" href="http://window.name">window.name</a> ä¹Ÿå°†ä¸ä¼šæ”¹å˜</p><p>Exampleï¼š</p><p>ç®€å•çš„ï¼ŒA é¡µé¢å’Œ B é¡µé¢ä¸åŒæºï¼ŒB é¡µé¢å¸Œæœ›è·å– A é¡µé¢çš„æ•°æ®ï¼Œåˆ™ A é¡µé¢å°†æ•°æ®å­˜å‚¨åˆ° <a target="_blank" rel="noopener" href="http://window.name">window.name</a> åè·³è½¬åˆ° B é¡µé¢ï¼ŒBé¡µé¢å³å¯è·å–Aé¡µé¢è®¾ç½®çš„å€¼</p><p>ç®€å•çš„æ–¹æ¡ˆä¸­æ˜¯ A é¡µé¢ä¸»åŠ¨å°†æ•°æ®ç»™ Bï¼Œå¦‚ä½•è®© B ä¸»åŠ¨ä» A é‚£é‡Œæ‹¿æ•°æ®å‘¢ï¼Ÿ</p><p>1ã€A é¡µé¢æ—¶æ•°æ®é¡µé¢ï¼Œæˆ‘ä»¬å°†æ ¼å¼åŒ–å¥½çš„æ•°æ®å­˜åˆ° <code>window.name</code> ä¸­</p><pre class="line-numbers language-html" data-language="html"><code class="language-html">ref: https://blog.csdn.net/weixin_33991727/article/details/86248998<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">></span></span> A <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">    <span class="token keyword">var</span> person <span class="token operator">=</span> <span class="token punctuation">&#123;</span>      name<span class="token operator">:</span> <span class="token string">'Coming98'</span><span class="token punctuation">,</span>      age<span class="token operator">:</span> <span class="token number">22</span><span class="token punctuation">,</span>    <span class="token punctuation">&#125;</span>    window<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>person<span class="token punctuation">)</span>  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>2ã€B é¡µé¢æƒ³è¦è·å– A é¡µé¢çš„æ•°æ®ï¼Œé¦–å…ˆåˆ›å»ºä¸€ä¸ª iframe è·å– <a target="_blank" rel="noopener" href="http://window.name">window.name</a> çš„å†…å®¹ï¼Œä½†æ˜¯æ­¤æ—¶ B é¡µé¢å’Œ iframe ä¸­çš„ A é¡µé¢ä¸åŒæºï¼ˆport ä¸ä¸€è‡´ï¼‰ï¼Œå› æ­¤è®© iframe é‡å®šå‘åˆ°ä¸ B é¡µé¢åŒæºçš„é¡µé¢ï¼Œè¿™æ—¶ <a target="_blank" rel="noopener" href="http://window.name">window.name</a> ä¸­çš„æ•°æ®ä¹Ÿè¢«å¸¦è¿‡å»äº†ï¼ŒB é¡µé¢æ­¤æ—¶å°±èƒ½å¤Ÿè®¿é—® iframe ä¸­çš„ <a target="_blank" rel="noopener" href="http://window.name">window.name</a> çš„å†…å®¹äº†</p><pre class="line-numbers language-html" data-language="html"><code class="language-html">B é¡µé¢ urlï¼š"http://localhost:8081/B.html"<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>iframe</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://localhost:8088/A.html<span class="token punctuation">"</span></span> <span class="token attr-name">frameborder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>iframe</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">    <span class="token keyword">var</span> ifr <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'iframe'</span><span class="token punctuation">)</span>    ifr<span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> <span class="token string">'none'</span>    <span class="token keyword">var</span> flag <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    ifr<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>flag <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'è·¨åŸŸè·å–æ•°æ®'</span><span class="token punctuation">,</span> ifr<span class="token punctuation">.</span>contentWindow<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>            ifr<span class="token punctuation">.</span>contentWindow<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>flag <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            flag <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>            ifr<span class="token punctuation">.</span>contentWindow<span class="token punctuation">.</span>location <span class="token operator">=</span> <span class="token string">'http://localhost:8081/proxy.html'</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="cors"><a class="markdownIt-Anchor" href="#cors"></a> CORS</h2><p>HTML5æ–°ç‰¹æ€§ï¼Œåªéœ€è¦è®©æœåŠ¡å™¨ç«¯åœ¨å“åº”å¤´ä¸­æ˜ç¡®çš„æˆæƒå®¢æˆ·ç«¯æœ‰æƒè¯»å–å…¶è¿”å›çš„æ•°æ®å³å¯</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token function">header</span><span class="token punctuation">(</span><span class="token string">"Access-Control-Allow-Origin: *"</span><span class="token punctuation">)</span><span class="token function">header</span><span class="token punctuation">(</span><span class="token string">"Access-Control-Allow-Origin: http://server.net"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>Tipsï¼šå­˜åœ¨é¢„æ£€æœºåˆ¶ï¼Œæ”¯æŒæµè§ˆå™¨å…ˆè¯¢é—®æœåŠ¡å™¨ï¼ˆå³å°†è¯·æ±‚çš„åŸŸåã€æ–¹æ³•å’Œå¤´ä¿¡æ¯æ˜¯å¦è®¸å¯ï¼Œå¦‚æœå¾—åˆ°è‚¯å®šç­”å¤ï¼Œæ‰å‘å‡ºæ­£å¼è¯·æ±‚ï¼Œå¦åˆ™æŠ¥é”™ï¼‰</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20211029115407916.png" alt="image-20211029115407916" /></p><h2 id="windowpostmessage"><a class="markdownIt-Anchor" href="#windowpostmessage"></a> window.postMessage</h2><p>å…è®¸ä¸åŒæºçš„è„šæœ¬é‡‡ç”¨å¼‚æ­¥æ–¹å¼è¿›è¡Œæœ‰é™çš„é€šä¿¡</p><p><strong>ä¿¡æ¯å‘é€</strong></p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">otherWindow<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span>message<span class="token punctuation">,</span> targetOrigin<span class="token punctuation">,</span> <span class="token punctuation">[</span>transfer<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>otherWindow - è¡¨ç¤ºå…¶å®ƒçª—å£çš„ä¸€ä¸ªå¼•ç”¨ï¼Œæ¯”å¦‚ iframe çš„ contentWindow å±æ€§ã€æ‰§è¡Œ<code>window.open</code> è¿”å›çš„çª—å£å¯¹è±¡</p><p>message - å‘é€çš„æ•°æ®ä¿¡æ¯</p><p>targetOrigin - æŒ‡å®šè¯¥æ¶ˆæ¯çš„å‘é€ç›®æ ‡çª—å£ï¼Œå¯ä»¥æ˜¯ <code>URI</code> æˆ– <code>*</code></p><p><strong>äº‹ä»¶ç›‘å¬</strong>ï¼šç›®æ ‡æ¥æ”¶æ–¹åº”å½“æ·»åŠ äº‹ä»¶å¤„ç†å‡½æ•°ï¼Œæ¥æ”¶å¹¶å¤„ç†å‘é€è¿‡æ¥çš„ä¿¡æ¯</p><p>event.origin - å‘é€ä¿¡æ¯çš„ window æ‰€åœ¨çš„æºï¼Œå¦‚æœä¸åœ¨ç™½åå•é‡Œï¼Œä¸äºˆå¤„ç†</p><p>event.source - å‘é€æ¶ˆæ¯çš„çª—å£å¯¹è±¡çš„å¼•ç”¨</p><p>event.data - æ˜¯ä¼ è¿‡æ¥çš„ message</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// å½“ä¿¡æ¯è¢« postMessage é€æ¥åè°ƒç”¨çš„å¤„ç†å‡½æ•°</span><span class="token keyword">function</span> <span class="token function">receiveMessage</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>event<span class="token punctuation">.</span>origin <span class="token operator">!==</span> <span class="token string">"http://white.com:8080"</span><span class="token punctuation">)</span>    <span class="token keyword">return</span><span class="token punctuation">;</span>   <span class="token comment">// äº‹ä»¶é€»è¾‘å¤„ç†ï¼Œå¯ä»¥å›ä¸€æ¡æ¶ˆæ¯è¿‡å»</span>  event<span class="token punctuation">.</span>source<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span><span class="token string">"hi"</span><span class="token punctuation">,</span> event<span class="token punctuation">.</span>origin<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span>window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"message"</span><span class="token punctuation">,</span> receiveMessage<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä¸»åŠ¨è·å–ä¿¡æ¯æ­¥éª¤ï¼šA æƒ³è¦è·å– B çš„ä¿¡æ¯ï¼ŒA é€šè¿‡ iframe æˆ– window.open åµŒå…¥ Bï¼Œéšå A postMessage(message, B) å‘Šè¯‰ B æƒ³è¦ä»€ä¹ˆä¿¡æ¯ï¼ŒB æ£€æŸ¥ origin å postMessage(data, A) å°†æ•°æ®è¿”å›è¿‡å»</p><p>è¢«åŠ¨è·å–ä¿¡æ¯æ­¥éª¤ï¼šA å°†æ•°æ®å‡†å¤‡å®Œæ¯•é€šè¿‡ postMessage å°†ä¿¡æ¯ä¼ ç»™ Bï¼ŒB é€šè¿‡äº‹ä»¶ç›‘å¬å’Œå¤„ç†è·å–æ•°æ®</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20210920162051524.png" alt="image-20210920162051524" /></p><p>æ¥æ”¶æ–¹ï¼šæ·»åŠ ç›¸å…³äº‹ä»¶å¤„ç†ï¼Œå®ç°è·¨åŸŸçš„æ•°æ®ä¼ è¾“</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20210920162105671.png" alt="image-20210920162105671" /></p><h1 id=""><a class="markdownIt-Anchor" href="#"></a> </h1>]]></content>
      
      
      <categories>
          
          <category> Web Security </category>
          
      </categories>
      
      
        <tags>
            
            <tag> security </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>torch.scatter</title>
      <link href="/Coming-blog/2021/10/28/torch-scatter/"/>
      <url>/Coming-blog/2021/10/28/torch-scatter/</url>
      
        <content type="html"><![CDATA[<h1 id="tips"><a class="markdownIt-Anchor" href="#tips"></a> Tips</h1><p><code>var.item()</code> - å¦‚æœå¼ é‡ var ä¸­åªæœ‰ä¸€ä¸ªå…ƒç´ ï¼Œä½¿ç”¨è¯¥æ–¹æ³•å–å‡ºè¯¥å…ƒç´ </p><h1 id="å±æ€§"><a class="markdownIt-Anchor" href="#å±æ€§"></a> å±æ€§</h1><p><code>tensor.size</code> - shapes</p><h1 id="tensorçš„æ‹¼æ¥"><a class="markdownIt-Anchor" href="#tensorçš„æ‹¼æ¥"></a> tensorçš„æ‹¼æ¥</h1><p>tensorçš„æ‹¼æ¥æ“ä½œç»å¸¸ç”¨åˆ°ã€ç‰¹åœ°å°†å…¶æ•´ç†å¦‚ä¸‹</p><ul><li>cat - dim=all</li><li>stack - dim=new_dim</li><li>dstack - dim=2</li><li>hstack - dim=1</li><li>vstack- dim=0</li></ul><h2 id="cat"><a class="markdownIt-Anchor" href="#cat"></a> cat</h2><p><strong>åŠŸèƒ½</strong>ï¼šå°†ç»™å®šçš„ tensors åœ¨ç»™å®šçš„ç»´åº¦ä¸Šæ‹¼æ¥</p><p><strong>æ³¨æ„</strong>ï¼šé™¤äº†æ‹¼æ¥çš„ç»´åº¦å…¶ä½™ç»´åº¦å¤§å°åº”ä¸€è‡´</p><p><strong>å‚æ•°</strong>ï¼š</p><ul><li><p>tensors - å¤šä¸ªtensorç»„æˆçš„å…ƒç»„ï¼ˆåºåˆ—ï¼‰</p></li><li><p>dim - æƒ³è¦æ‹¼æ¥çš„ç»´åº¦</p></li></ul><p><strong>Test</strong></p><pre class="line-numbers language-python" data-language="python"><code class="language-python">x <span class="token operator">=</span> torch<span class="token punctuation">.</span>randn<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>y <span class="token operator">=</span> torch<span class="token punctuation">.</span>cat<span class="token punctuation">(</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> x<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">,</span> dim<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>y_1 <span class="token operator">=</span> torch<span class="token punctuation">.</span>cat<span class="token punctuation">(</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> x<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">,</span> dim<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>y_2 <span class="token operator">=</span> torch<span class="token punctuation">.</span>cat<span class="token punctuation">(</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> x<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">,</span> dim<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>Output</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">x<span class="token punctuation">.</span>size<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> torch<span class="token punctuation">.</span>Size<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span>y<span class="token punctuation">.</span>size<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> torch<span class="token punctuation">.</span>Size<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span>y_1<span class="token punctuation">.</span>size<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> torch<span class="token punctuation">.</span>Size<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span>y_2<span class="token punctuation">.</span>size<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> torch<span class="token punctuation">.</span>Size<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><hr /><h2 id="stack"><a class="markdownIt-Anchor" href="#stack"></a> stack</h2><p><strong>åŠŸèƒ½</strong>ï¼šå°†ç»™å®šçš„ tensors åœ¨æ–°çš„ç»´åº¦è¿›è¡Œæ‹¼æ¥</p><p><strong>æ³¨æ„</strong>ï¼šæ¯ä¸€ä¸ª tensor çš„å¤§å°éƒ½åº”ä¸€è‡´</p><p><strong>å‚æ•°</strong>ï¼štensors</p><ul><li>dim - æ‰€è¦æ’å…¥çš„ç»´åº¦ï¼Œæœ€å°ä¸º 0 ï¼Œæœ€å¤§ä¸ºè¾“å…¥æ•°æ®çš„ç»´åº¦å€¼</li></ul><p><strong>Test</strong></p><pre class="line-numbers language-python" data-language="python"><code class="language-python">a <span class="token operator">=</span> torch<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span>b <span class="token operator">=</span> torch<span class="token punctuation">.</span>ones<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span>c <span class="token operator">=</span> torch<span class="token punctuation">.</span>stack<span class="token punctuation">(</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">)</span>d <span class="token operator">=</span> torch<span class="token punctuation">.</span>stack<span class="token punctuation">(</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">,</span> dim<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>e <span class="token operator">=</span> torch<span class="token punctuation">.</span>stack<span class="token punctuation">(</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">,</span> dim<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>f <span class="token operator">=</span> torch<span class="token punctuation">.</span>stack<span class="token punctuation">(</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">,</span> dim<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>Output</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">c<span class="token punctuation">.</span>size<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> torch<span class="token punctuation">.</span>Size<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span>d<span class="token punctuation">.</span>size<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> torch<span class="token punctuation">.</span>Size<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span>e<span class="token punctuation">.</span>size<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> torch<span class="token punctuation">.</span>Size<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span>f<span class="token punctuation">.</span>size<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> torch<span class="token punctuation">.</span>Size<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><hr /><h2 id="dstack"><a class="markdownIt-Anchor" href="#dstack"></a> dstack</h2><p><strong>åŠŸèƒ½</strong>ï¼šå°†ç»™å®šçš„ tensors æ²¿ç€æ·±åº¦ï¼ˆdepthï¼‰æ–¹å‘ (dim=2) å åŠ </p><p>æ³¨æ„ï¼šå…¶ä½™ç»´åº¦å¤§å°ä¸€è‡´</p><p><strong>å‚æ•°</strong>ï¼štensors</p><p><strong>Test 1</strong></p><pre class="line-numbers language-python" data-language="python"><code class="language-python">a <span class="token operator">=</span> torch<span class="token punctuation">.</span>randn<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>b <span class="token operator">=</span> torch<span class="token punctuation">.</span>randn<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>c <span class="token operator">=</span> torch<span class="token punctuation">.</span>dstack<span class="token punctuation">(</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>Output 1</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">c<span class="token punctuation">.</span>size<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> torch<span class="token punctuation">.</span>Size<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>Test 2 å¦‚æœè¾“å…¥æ•°æ®å°äºä¸‰ç»´å‘¢ï¼Ÿ</strong></p><pre class="line-numbers language-python" data-language="python"><code class="language-python">a <span class="token operator">=</span> torch<span class="token punctuation">.</span>randn<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>b <span class="token operator">=</span> torch<span class="token punctuation">.</span>randn<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>c <span class="token operator">=</span> torch<span class="token punctuation">.</span>dstack<span class="token punctuation">(</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>Output 2 ä¼šæ‰©å¢ç»´åº¦</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">c<span class="token punctuation">.</span>size<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> torch<span class="token punctuation">.</span>Size<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><hr /><h2 id="hstack"><a class="markdownIt-Anchor" href="#hstack"></a> hstack</h2><p><strong>åŠŸèƒ½</strong>ï¼šå°†ç»™å®šçš„ tensors æ²¿ç€æ°´å¹³ï¼ˆhorizontalï¼‰æ–¹å‘ (dim=1) å åŠ </p><p><strong>æ³¨æ„</strong>ï¼šå…¶ä½™ç»´åº¦å¤§å°ä¸€è‡´</p><p><strong>å‚æ•°</strong>ï¼štensors</p><p><strong>Test</strong></p><pre class="line-numbers language-python" data-language="python"><code class="language-python">a <span class="token operator">=</span> torch<span class="token punctuation">.</span>randn<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span>b <span class="token operator">=</span> torch<span class="token punctuation">.</span>randn<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span>c <span class="token operator">=</span> torch<span class="token punctuation">.</span>hstack<span class="token punctuation">(</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">)</span>d <span class="token operator">=</span> torch<span class="token punctuation">.</span>cat<span class="token punctuation">(</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">,</span> dim<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>Output</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">c<span class="token punctuation">.</span>size<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> torch<span class="token punctuation">.</span>Size<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span>d<span class="token punctuation">.</span>size<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> torch<span class="token punctuation">.</span>Size<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><hr /><h2 id="vstack"><a class="markdownIt-Anchor" href="#vstack"></a> vstack</h2><p><strong>åŠŸèƒ½</strong>ï¼šå°†ç»™å®šçš„ tensors æ²¿ç€ç«–ç›´ï¼ˆverticalï¼‰æ–¹å‘ (dim=0) å åŠ </p><p><strong>æ³¨æ„</strong>ï¼šå…¶ä½™ç»´åº¦å¤§å°ä¸€è‡´</p><p><strong>å‚æ•°</strong>ï¼štensors</p><p><strong>Test</strong></p><pre class="line-numbers language-python" data-language="python"><code class="language-python">a <span class="token operator">=</span> torch<span class="token punctuation">.</span>randn<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span>b <span class="token operator">=</span> torch<span class="token punctuation">.</span>randn<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span>c <span class="token operator">=</span> torch<span class="token punctuation">.</span>vstack<span class="token punctuation">(</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">)</span>d <span class="token operator">=</span> torch<span class="token punctuation">.</span>cat<span class="token punctuation">(</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">,</span> dim<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>Output</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">c<span class="token punctuation">.</span>size<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> torch<span class="token punctuation">.</span>Size<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span>d<span class="token punctuation">.</span>size<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> torch<span class="token punctuation">.</span>Size<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h1 id="tensorçš„åˆ‡åˆ†"><a class="markdownIt-Anchor" href="#tensorçš„åˆ‡åˆ†"></a> tensorçš„åˆ‡åˆ†</h1><p>æ•°æ®çš„é¢„å¤„ç†ä»¥åŠæ•°æ®é›†çš„æ„å»ºä¼šç»å¸¸ä½¿ç”¨åˆ°tensorçš„åˆ‡åˆ†æ“ä½œï¼Œç°æ•´ç†å¦‚ä¸‹ï¼š</p><ul><li>chunk</li><li>split</li><li>numpyä¸­çš„åˆ‡ç‰‡(slice)æ“ä½œ</li><li>unbind</li></ul><hr /><h2 id="chunk"><a class="markdownIt-Anchor" href="#chunk"></a> chunk</h2><p><strong>åŠŸèƒ½</strong>ï¼šè¾“å…¥æ•°æ®ä¸æƒ³è¦åˆ‡åˆ†çš„å—æ•° chunks ï¼Œå°†æ•°æ®å°½å¯èƒ½ (å¦‚æœæ•°æ®ä¸ªæ•°ä¸å—æ•°èƒ½æ•´é™¤çš„è¯) å¹³å‡çš„åˆ‡åˆ†ä¸º chunks å—</p><p><strong>æ³¨æ„</strong>ï¼šæ²¡æœ‰è¿›è¡Œæ•°æ®çš„æ‹·è´</p><p><strong>å‚æ•°</strong></p><ul><li>input - tensor</li><li>chunks - åˆ‡åˆ†çš„å—æ•°</li><li>dim - int - åˆ‡åˆ†çš„ç»´åº¦</li></ul><p><strong>Test</strong></p><pre class="line-numbers language-Python" data-language="Python"><code class="language-Python">x &#x3D; torch.randn(33, 16)y &#x3D; torch.chunk(x, 4, dim&#x3D;0)y_1 &#x3D; torch.chunk(x, 2, dim&#x3D;1)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>Output</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># å°½å¯èƒ½å¹³å‡çš„åˆ‡åˆ†ä¸ºäº†å››å—</span>y<span class="token punctuation">.</span>size<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">(</span>torch<span class="token punctuation">.</span>Size<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>torch<span class="token punctuation">.</span>Size<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>torch<span class="token punctuation">.</span>Size<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>torch<span class="token punctuation">.</span>Size<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>y_1<span class="token punctuation">.</span>size<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">(</span>torch<span class="token punctuation">.</span>Size<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">33</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  torch<span class="token punctuation">.</span>Size<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">33</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr /><h2 id="split"><a class="markdownIt-Anchor" href="#split"></a> split</h2><p><strong>åŠŸèƒ½</strong>ï¼š</p><ul><li>å¯ä»¥è¾“å…¥æ•´å‹æ•°æ® size è¡¨ç¤ºå°†æ•°æ®å°½å¯èƒ½ æŒ‰ç…§å¤§å° size è¿›è¡Œåˆ†å‰²ï¼Œè‡ªè¡Œè®¡ç®—åˆ†å‰²çš„å—æ•°</li><li>å¯ä»¥è¾“å…¥åºåˆ—æ•°æ® list å°†æ•°æ®åˆ†å‰²ä¸º len(list) å—ï¼Œæ¯å—çš„å¤§å°å¯¹åº”äºlistä¸­çš„å€¼</li></ul><p><strong>æ³¨æ„</strong>ï¼šæ²¡æœ‰å¯¹è¾“å…¥æ•°æ®è¿›è¡Œæ‹·è´</p><p><strong>å‚æ•°</strong>ï¼š</p><ul><li>input - tensor</li><li>split_size_or_sections - int or (ints) - è¯¦è§åŠŸèƒ½ä»‹ç»</li><li>dim - int - åˆ‡åˆ†çš„ç»´åº¦</li></ul><p><strong>Test 1 è¾“å…¥æ•´å‹æ•°æ®</strong></p><pre class="line-numbers language-python" data-language="python"><code class="language-python">a <span class="token operator">=</span> torch<span class="token punctuation">.</span>arange<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">.</span>view<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token comment"># åœ¨ç»´åº¦ 1 ä¸Šè¿›è¡Œåˆ‡åˆ†ï¼Œä½¿å¾—æ¯ä¸€å—å¤§å°å°½å¯èƒ½ä¸º 2</span>b <span class="token operator">=</span> torch<span class="token punctuation">.</span>split<span class="token punctuation">(</span>a<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> dim<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>Output 1</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">a <span class="token operator">=</span> tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span>            <span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>b <span class="token operator">=</span> <span class="token punctuation">(</span>tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>            <span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>      tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span>            <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>      tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span>             <span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># æœ€åå‰©ä½™ - æ— æ³•æŒ‰ç…§sizeå¤§å°è¿›è¡Œåˆ†é…</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>Test 2 è¾“å…¥ä¸ºæ•´å‹åºåˆ—</strong></p><pre class="line-numbers language-python" data-language="python"><code class="language-python">a <span class="token operator">=</span> torch<span class="token punctuation">.</span>arange<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">.</span>view<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token comment"># åœ¨ç»´åº¦ 0 ä¸Šè¿›è¡Œåˆ‡åˆ†ï¼Œç›®æ ‡åˆ‡åˆ†ä¸º 2 å—ï¼Œç¬¬ä¸€å—ç»´åº¦å¤§å°ä¸º 1ï¼Œç¬¬äºŒå—ç»´åº¦å¤§å°ä¸º 1</span>b <span class="token operator">=</span> torch<span class="token punctuation">.</span>split<span class="token punctuation">(</span>a<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> dim<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>Output</p><pre class="line-numbers language-pyhon" data-language="pyhon"><code class="language-pyhon">a &#x3D; tensor([[0, 1, 2, 3, 4],            [5, 6, 7, 8, 9]])b &#x3D; (tensor([[0, 1, 2, 3, 4]]),      tensor([[5, 6, 7, 8, 9]]))<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><hr /><h2 id="slice"><a class="markdownIt-Anchor" href="#slice"></a> slice</h2><p><strong>åŠŸèƒ½</strong>ï¼štorchæ”¯æŒnumpyä¸­å¯¹æ•°æ®çš„åˆ‡ç‰‡æ“ä½œ</p><p><strong>Test</strong></p><pre class="line-numbers language-Python" data-language="Python"><code class="language-Python">x &#x3D; torch.randn(3, 2)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>Output</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">x <span class="token operator">=</span> tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">0.2893</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.1715</span><span class="token punctuation">]</span><span class="token punctuation">,</span>            <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">0.2477</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">2.7052</span><span class="token punctuation">]</span><span class="token punctuation">,</span>            <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">0.2827</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.2669</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>x<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1.1715</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">2.7052</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.2669</span><span class="token punctuation">]</span><span class="token punctuation">)</span>x<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">]</span> <span class="token operator">=</span> tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">0.2893</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.1715</span><span class="token punctuation">]</span><span class="token punctuation">)</span>x<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">2.7052</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.2669</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr /><h2 id="unbind"><a class="markdownIt-Anchor" href="#unbind"></a> unbind</h2><p><strong>åŠŸèƒ½</strong>ï¼šåˆ é™¤tensorçš„ä¸€ä¸ªç»´åº¦ï¼Œè¿”å›å„ä¸ªå­å—ç»„æˆçš„ tuple</p><p><strong>å‚æ•°</strong>ï¼š</p><ul><li>input - tensor</li><li>dim - int - æƒ³è¦åˆ é™¤çš„ç»´åº¦</li></ul><p><strong>Test</strong></p><pre class="line-numbers language-python" data-language="python"><code class="language-python">a <span class="token operator">=</span> torch<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span>b <span class="token operator">=</span> torch<span class="token punctuation">.</span>unbind<span class="token punctuation">(</span>a<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>Output</p><pre class="line-numbers language-Python" data-language="Python"><code class="language-Python"># atensor([[[ 2, -5, -5,  4],         [ 4, -4,  4, -5],         [-4, -4,  1, -4]],        [[ 1, -2,  2, -4],         [-2, -3, -2,  1],         [ 1, -2,  2, -2]]])# btensor([[ 2, -5, -5,  4],        [ 1, -2,  2, -4]])tensor([[ 4, -4,  4, -5],        [-2, -3, -2,  1]])tensor([[-4, -4,  1, -4],        [ 1, -2,  2, -2]])<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr /><h1 id="tensorçš„ç´¢å¼•"><a class="markdownIt-Anchor" href="#tensorçš„ç´¢å¼•"></a> tensorçš„ç´¢å¼•</h1><p>æ ¹æ®ç´¢å¼•è·å–æ•°æ®ä¸­ç‰¹å®šä½ç½®çš„å€¼</p><ul><li>gather</li><li>index_select</li><li>masked_select</li><li>narrow</li><li>nonzero</li><li>where</li><li>take</li></ul><hr /><h2 id="gather"><a class="markdownIt-Anchor" href="#gather"></a> gather</h2><p><strong>åŠŸèƒ½</strong>ï¼šæ²¿æŒ‡å®šçš„ç»´åº¦æ”¶é›†å€¼</p><p><strong>æ³¨æ„</strong>ï¼šé™¤äº†æŒ‡å®šçš„ç»´åº¦ã€å…¶ä½™ç»´åº¦éƒ½éå†ä¸€é</p><p><strong>å‚æ•°</strong>ï¼š</p><ul><li>input - tensor</li><li>dim - int - æ”¶é›†çš„ç»´åº¦</li><li>index - LongTensor - è¦æ”¶é›†çš„å…ƒç´ çš„ç´¢å¼•ï¼Œç»´åº¦æ•°å’Œ input ä¸€è‡´</li><li>sparse_grad - bool - å¦‚æœ input ä¸º sparse tensor é‚£ä¹ˆè®¾å®šä¸º true</li></ul><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>o</mi><mi>u</mi><mi>t</mi><mo stretchy="false">[</mo><mi>i</mi><mo stretchy="false">]</mo><mo stretchy="false">[</mo><mi>j</mi><mo stretchy="false">]</mo><mo stretchy="false">[</mo><mi>k</mi><mo stretchy="false">]</mo><mo>=</mo><mi>i</mi><mi>n</mi><mi>p</mi><mi>u</mi><mi>t</mi><mo stretchy="false">[</mo><mtext>Â </mtext><mi>i</mi><mi>n</mi><mi>d</mi><mi>e</mi><mi>x</mi><mo stretchy="false">[</mo><mi>i</mi><mo stretchy="false">]</mo><mo stretchy="false">[</mo><mi>j</mi><mo stretchy="false">]</mo><mo stretchy="false">[</mo><mi>k</mi><mo stretchy="false">]</mo><mtext>Â </mtext><mo stretchy="false">]</mo><mo stretchy="false">[</mo><mi>j</mi><mo stretchy="false">]</mo><mo stretchy="false">[</mo><mi>k</mi><mo stretchy="false">]</mo><mtext>Â </mtext><mi>w</mi><mi>i</mi><mi>t</mi><mi>h</mi><mtext>Â </mtext><mi>d</mi><mi>i</mi><mi>m</mi><mo>=</mo><mn>0</mn><mspace linebreak="newline"></mspace><mi>o</mi><mi>u</mi><mi>t</mi><mo stretchy="false">[</mo><mi>i</mi><mo stretchy="false">]</mo><mo stretchy="false">[</mo><mi>j</mi><mo stretchy="false">]</mo><mo stretchy="false">[</mo><mi>k</mi><mo stretchy="false">]</mo><mo>=</mo><mi>i</mi><mi>n</mi><mi>p</mi><mi>u</mi><mi>t</mi><mo stretchy="false">[</mo><mi>i</mi><mo stretchy="false">]</mo><mo stretchy="false">[</mo><mtext>Â </mtext><mi>i</mi><mi>n</mi><mi>d</mi><mi>e</mi><mi>x</mi><mo stretchy="false">[</mo><mi>i</mi><mo stretchy="false">]</mo><mo stretchy="false">[</mo><mi>j</mi><mo stretchy="false">]</mo><mo stretchy="false">[</mo><mi>k</mi><mo stretchy="false">]</mo><mtext>Â </mtext><mo stretchy="false">]</mo><mo stretchy="false">[</mo><mi>k</mi><mo stretchy="false">]</mo><mtext>Â </mtext><mi>w</mi><mi>i</mi><mi>t</mi><mi>h</mi><mtext>Â </mtext><mi>d</mi><mi>i</mi><mi>m</mi><mo>=</mo><mn>1</mn><mspace linebreak="newline"></mspace><mi>o</mi><mi>u</mi><mi>t</mi><mo stretchy="false">[</mo><mi>i</mi><mo stretchy="false">]</mo><mo stretchy="false">[</mo><mi>j</mi><mo stretchy="false">]</mo><mo stretchy="false">[</mo><mi>k</mi><mo stretchy="false">]</mo><mo>=</mo><mi>i</mi><mi>n</mi><mi>p</mi><mi>u</mi><mi>t</mi><mo stretchy="false">[</mo><mi>i</mi><mo stretchy="false">]</mo><mo stretchy="false">[</mo><mi>j</mi><mo stretchy="false">]</mo><mo stretchy="false">[</mo><mtext>Â </mtext><mi>i</mi><mi>n</mi><mi>d</mi><mi>e</mi><mi>x</mi><mo stretchy="false">[</mo><mi>i</mi><mo stretchy="false">]</mo><mo stretchy="false">[</mo><mi>j</mi><mo stretchy="false">]</mo><mo stretchy="false">[</mo><mi>k</mi><mo stretchy="false">]</mo><mtext>Â </mtext><mo stretchy="false">]</mo><mtext>Â </mtext><mi>w</mi><mi>i</mi><mi>t</mi><mi>h</mi><mtext>Â </mtext><mi>d</mi><mi>i</mi><mi>m</mi><mo>=</mo><mn>2</mn><mspace linebreak="newline"></mspace></mrow><annotation encoding="application/x-tex">out[i][j][k] = input[\ index[i][j][k]\ ][j][k]\ with\ dim=0 \\out[i][j][k] = input[i][\ index[i][j][k]\ ][k]\ with\ dim=1 \\out[i][j][k] = input[i][j][\ index[i][j][k]\ ]\ with\ dim=2 \\</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault">o</span><span class="mord mathdefault">u</span><span class="mord mathdefault">t</span><span class="mopen">[</span><span class="mord mathdefault">i</span><span class="mclose">]</span><span class="mopen">[</span><span class="mord mathdefault" style="margin-right:0.05724em;">j</span><span class="mclose">]</span><span class="mopen">[</span><span class="mord mathdefault" style="margin-right:0.03148em;">k</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault">i</span><span class="mord mathdefault">n</span><span class="mord mathdefault">p</span><span class="mord mathdefault">u</span><span class="mord mathdefault">t</span><span class="mopen">[</span><span class="mspace">Â </span><span class="mord mathdefault">i</span><span class="mord mathdefault">n</span><span class="mord mathdefault">d</span><span class="mord mathdefault">e</span><span class="mord mathdefault">x</span><span class="mopen">[</span><span class="mord mathdefault">i</span><span class="mclose">]</span><span class="mopen">[</span><span class="mord mathdefault" style="margin-right:0.05724em;">j</span><span class="mclose">]</span><span class="mopen">[</span><span class="mord mathdefault" style="margin-right:0.03148em;">k</span><span class="mclose">]</span><span class="mspace">Â </span><span class="mclose">]</span><span class="mopen">[</span><span class="mord mathdefault" style="margin-right:0.05724em;">j</span><span class="mclose">]</span><span class="mopen">[</span><span class="mord mathdefault" style="margin-right:0.03148em;">k</span><span class="mclose">]</span><span class="mspace">Â </span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="mord mathdefault">i</span><span class="mord mathdefault">t</span><span class="mord mathdefault">h</span><span class="mspace">Â </span><span class="mord mathdefault">d</span><span class="mord mathdefault">i</span><span class="mord mathdefault">m</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault">o</span><span class="mord mathdefault">u</span><span class="mord mathdefault">t</span><span class="mopen">[</span><span class="mord mathdefault">i</span><span class="mclose">]</span><span class="mopen">[</span><span class="mord mathdefault" style="margin-right:0.05724em;">j</span><span class="mclose">]</span><span class="mopen">[</span><span class="mord mathdefault" style="margin-right:0.03148em;">k</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault">i</span><span class="mord mathdefault">n</span><span class="mord mathdefault">p</span><span class="mord mathdefault">u</span><span class="mord mathdefault">t</span><span class="mopen">[</span><span class="mord mathdefault">i</span><span class="mclose">]</span><span class="mopen">[</span><span class="mspace">Â </span><span class="mord mathdefault">i</span><span class="mord mathdefault">n</span><span class="mord mathdefault">d</span><span class="mord mathdefault">e</span><span class="mord mathdefault">x</span><span class="mopen">[</span><span class="mord mathdefault">i</span><span class="mclose">]</span><span class="mopen">[</span><span class="mord mathdefault" style="margin-right:0.05724em;">j</span><span class="mclose">]</span><span class="mopen">[</span><span class="mord mathdefault" style="margin-right:0.03148em;">k</span><span class="mclose">]</span><span class="mspace">Â </span><span class="mclose">]</span><span class="mopen">[</span><span class="mord mathdefault" style="margin-right:0.03148em;">k</span><span class="mclose">]</span><span class="mspace">Â </span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="mord mathdefault">i</span><span class="mord mathdefault">t</span><span class="mord mathdefault">h</span><span class="mspace">Â </span><span class="mord mathdefault">d</span><span class="mord mathdefault">i</span><span class="mord mathdefault">m</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault">o</span><span class="mord mathdefault">u</span><span class="mord mathdefault">t</span><span class="mopen">[</span><span class="mord mathdefault">i</span><span class="mclose">]</span><span class="mopen">[</span><span class="mord mathdefault" style="margin-right:0.05724em;">j</span><span class="mclose">]</span><span class="mopen">[</span><span class="mord mathdefault" style="margin-right:0.03148em;">k</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault">i</span><span class="mord mathdefault">n</span><span class="mord mathdefault">p</span><span class="mord mathdefault">u</span><span class="mord mathdefault">t</span><span class="mopen">[</span><span class="mord mathdefault">i</span><span class="mclose">]</span><span class="mopen">[</span><span class="mord mathdefault" style="margin-right:0.05724em;">j</span><span class="mclose">]</span><span class="mopen">[</span><span class="mspace">Â </span><span class="mord mathdefault">i</span><span class="mord mathdefault">n</span><span class="mord mathdefault">d</span><span class="mord mathdefault">e</span><span class="mord mathdefault">x</span><span class="mopen">[</span><span class="mord mathdefault">i</span><span class="mclose">]</span><span class="mopen">[</span><span class="mord mathdefault" style="margin-right:0.05724em;">j</span><span class="mclose">]</span><span class="mopen">[</span><span class="mord mathdefault" style="margin-right:0.03148em;">k</span><span class="mclose">]</span><span class="mspace">Â </span><span class="mclose">]</span><span class="mspace">Â </span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="mord mathdefault">i</span><span class="mord mathdefault">t</span><span class="mord mathdefault">h</span><span class="mspace">Â </span><span class="mord mathdefault">d</span><span class="mord mathdefault">i</span><span class="mord mathdefault">m</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">2</span></span><span class="mspace newline"></span></span></span></span></p><p>**Test 1 **</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">a <span class="token operator">=</span> torch<span class="token punctuation">.</span>arange<span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">.</span>view<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>b <span class="token operator">=</span> torch<span class="token punctuation">.</span>gather<span class="token punctuation">(</span>a<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> torch<span class="token punctuation">.</span>tensor<span class="token punctuation">(</span><span class="token punctuation">[</span>    <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span> <span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># ç¡®å®šç»´åº¦åçº¿æ€§ç´¢å¼•å³å¯</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>Output</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">a <span class="token operator">=</span> tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span>            <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>b <span class="token operator">=</span> tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span>            <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h2 id="index_select"><a class="markdownIt-Anchor" href="#index_select"></a> index_select</h2><p><strong>åŠŸèƒ½</strong>ï¼šåœ¨æŒ‡å®šçš„ç»´åº¦ä¸Šæ ¹æ®ç´¢å¼•å–å€¼</p><p><strong>æ³¨æ„</strong>ï¼šè¿›è¡Œäº†æ‹·è´</p><p><strong>å‚æ•°</strong>ï¼š</p><ul><li>input - tensor</li><li>dim - int</li><li>index - LongTensor - ä¸€ç»´ tensor æŒ‡å®šç´¢å¼•</li></ul><p><strong>Test</strong></p><pre class="line-numbers language-python" data-language="python"><code class="language-python">a <span class="token operator">=</span> torch<span class="token punctuation">.</span>arange<span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">.</span>view<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>b <span class="token operator">=</span> torch<span class="token punctuation">.</span>index_select<span class="token punctuation">(</span>a<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> torch<span class="token punctuation">.</span>tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>Output</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">a <span class="token operator">=</span> tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span>            <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>b <span class="token operator">=</span> tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span>            <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h2 id="masked_select"><a class="markdownIt-Anchor" href="#masked_select"></a> masked_select</h2><p><strong>åŠŸèƒ½</strong>ï¼šæ ¹æ® booltensor è¿›è¡Œç´¢å¼•ï¼Œå°†ç´¢å¼•åˆ°çš„å€¼ä»¥ä¸€ç»´ tensor çš„å½¢å¼è¿”å›</p><p><strong>æ³¨æ„</strong>ï¼šboolTensor æ”¯æŒå¹¿æ’­</p><p><strong>å‚æ•°</strong>ï¼š</p><ul><li>input - tensor</li><li>mask - boolTensor</li></ul><p><strong>Test 1</strong></p><pre class="line-numbers language-python" data-language="python"><code class="language-python">a <span class="token operator">=</span> torch<span class="token punctuation">.</span>arange<span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">.</span>view<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token comment"># ge - great_equal</span>mask <span class="token operator">=</span> a<span class="token punctuation">.</span>ge<span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span> b <span class="token operator">=</span> torch<span class="token punctuation">.</span>masked_select<span class="token punctuation">(</span>a<span class="token punctuation">,</span> mask<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>Output</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">a <span class="token operator">=</span> tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">]</span><span class="token punctuation">,</span>            <span class="token punctuation">[</span><span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">,</span>  <span class="token boolean">True</span><span class="token punctuation">,</span>  <span class="token boolean">True</span><span class="token punctuation">]</span><span class="token punctuation">,</span>            <span class="token punctuation">[</span> <span class="token boolean">True</span><span class="token punctuation">,</span>  <span class="token boolean">True</span><span class="token punctuation">,</span>  <span class="token boolean">True</span><span class="token punctuation">,</span>  <span class="token boolean">True</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>tensor<span class="token punctuation">(</span><span class="token punctuation">[</span> <span class="token number">6</span><span class="token punctuation">,</span>  <span class="token number">7</span><span class="token punctuation">,</span>  <span class="token number">8</span><span class="token punctuation">,</span>  <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p><strong>Test 2 å¹¿æ’­æµ‹è¯•</strong></p><pre class="line-numbers language-python" data-language="python"><code class="language-python">a <span class="token operator">=</span> torch<span class="token punctuation">.</span>arange<span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">.</span>view<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span>b <span class="token operator">=</span> torch<span class="token punctuation">.</span>masked_select<span class="token punctuation">(</span>a<span class="token punctuation">,</span> torch<span class="token punctuation">.</span>tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token boolean">True</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token boolean">False</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token boolean">False</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># å¯ä»¥å¹¿æ’­</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>Output 2</p><pre class="line-numbers language-Python" data-language="Python"><code class="language-Python">a &#x3D; tensor([[ 0,  1,  2,  3],            [ 4,  5,  6,  7],            [ 8,  9, 10, 11]])b &#x3D; tensor([0, 1, 2, 3])<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h2 id="narrow"><a class="markdownIt-Anchor" href="#narrow"></a> narrow</h2><p><strong>åŠŸèƒ½</strong>ï¼šç±»ä¼¼äº numpyä¸­çš„åˆ‡ç‰‡æ“ä½œï¼Œé’ˆå¯¹æŸä¸€ç»´åº¦è¿›è¡Œç´¢å¼•ï¼Œï¼ˆè¿ç»­ï¼‰å–å€¼</p><p><strong>å‚æ•°</strong>ï¼š</p><ul><li><p>input - tensor</p></li><li><p>dim - int - æ‰€è¦æ“ä½œçš„ç»´åº¦</p></li><li><p>start - int - å¼€å§‹çš„ç´¢å¼•</p></li><li><p>length - ä¿ç•™é•¿åº¦</p></li></ul><p><strong>ç®€å•ç†è§£ï¼š</strong></p><pre class="line-numbers language-python" data-language="python"><code class="language-python">torch<span class="token punctuation">.</span>narrow<span class="token punctuation">(</span><span class="token builtin">input</span><span class="token punctuation">,</span> dim<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> start<span class="token punctuation">,</span> length<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span>start<span class="token punctuation">:</span>start<span class="token operator">+</span>length<span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>Test</strong></p><pre class="line-numbers language-python" data-language="python"><code class="language-python">x <span class="token operator">=</span> torch<span class="token punctuation">.</span>arange<span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">.</span>view<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>y <span class="token operator">=</span> torch<span class="token punctuation">.</span>narrow<span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>z <span class="token operator">=</span> x<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>Output</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">x <span class="token operator">=</span> tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token number">0</span><span class="token punctuation">,</span>  <span class="token number">1</span><span class="token punctuation">,</span>  <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span>             <span class="token punctuation">[</span> <span class="token number">3</span><span class="token punctuation">,</span>  <span class="token number">4</span><span class="token punctuation">,</span>  <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>             <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token number">6</span><span class="token punctuation">,</span>  <span class="token number">7</span><span class="token punctuation">,</span>  <span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">,</span>             <span class="token punctuation">[</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>y <span class="token operator">=</span> tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token number">1</span><span class="token punctuation">,</span>  <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span>             <span class="token punctuation">[</span> <span class="token number">4</span><span class="token punctuation">,</span>  <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>            <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token number">7</span><span class="token punctuation">,</span>  <span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">,</span>             <span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>z <span class="token operator">=</span> tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token number">1</span><span class="token punctuation">,</span>  <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span>             <span class="token punctuation">[</span> <span class="token number">4</span><span class="token punctuation">,</span>  <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>            <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token number">7</span><span class="token punctuation">,</span>  <span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">,</span>             <span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="nonzero"><a class="markdownIt-Anchor" href="#nonzero"></a> nonzero</h2><p><strong>åŠŸèƒ½</strong>ï¼šæ‰¾å‡ºç»™å®š tensor ä¸­éé›¶å…ƒç´ çš„ç´¢å¼•</p><p><strong>æ³¨æ„</strong>ï¼šas_tuple å‚æ•°ä¸è¾“å‡ºæ ·å¼æœ‰å…³</p><ul><li>True - è¿”å›ä¸€ä¸ªäºŒç»´ tensorï¼Œæ¯ä¸€è¡Œè¡¨ç¤ºä¸€ä¸ªéé›¶å€¼çš„ç´¢å¼•</li><li>False - è¿”å› n ä¸ªå¤§å°ä¸º z çš„ä¸€ç»´ tensor - n è¡¨ç¤ºè¾“å…¥æ•°æ®çš„ç»´åº¦ - zè¡¨ç¤ºéé›¶å…ƒç´ çš„ä¸ªæ•°</li></ul><p><strong>å‚æ•°</strong></p><ul><li>input - tensor</li><li>as_tuple - default (False)</li></ul><p><strong>Test 1</strong></p><pre class="line-numbers language-python" data-language="python"><code class="language-python">a <span class="token operator">=</span> torch<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>i_2D <span class="token operator">=</span> torch<span class="token punctuation">.</span>nonzero<span class="token punctuation">(</span>a<span class="token punctuation">)</span>i_1D <span class="token operator">=</span> torch<span class="token punctuation">.</span>nonzero<span class="token punctuation">(</span>a<span class="token punctuation">,</span> as_tuple<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>Output 1</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">a <span class="token operator">=</span> tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>            <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>            <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>i_2D <span class="token operator">=</span> tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span>               <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>i_1D <span class="token operator">=</span> <span class="token punctuation">(</span>tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>æ‰©å±•</strong>ï¼š</p><p>ç»“åˆ torch ä¸­ç±»ä¼¼ numpy çš„ boolç´¢å¼•ï¼Œæˆ‘ä»¬å¯ä»¥æ„é€ æ¡ä»¶ç´¢å¼•çš„å½¢å¼</p><ul><li>é€šè¿‡æ¡ä»¶è¯­å¥ç”Ÿæˆ bool tensor</li><li>Trueä¸º1ï¼ŒFalseä¸º0ï¼Œå³nonzeroä¼šæ‰¾åˆ°æ‰€æœ‰Tureå€¼çš„ç´¢å¼•ï¼ˆæ¡ä»¶ç­›é€‰å‡ºæ¥çš„å…ƒç´ ï¼‰</li></ul><p><strong>Test 2 åˆ©ç”¨æ¡ä»¶è¯­å¥å®ç°é€† nonzero</strong></p><pre class="line-numbers language-Python" data-language="Python"><code class="language-Python">a &#x3D; torch.randint(0, 2, (3, 3))bool_tensor &#x3D; (a &#x3D;&#x3D; 0)index_nonzero &#x3D; torch.nonzero(bool_type)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>Output 2</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># a</span>tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>        <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>        <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token comment"># bool_tensor</span>tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token boolean">False</span><span class="token punctuation">,</span>  <span class="token boolean">True</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">]</span><span class="token punctuation">,</span>        <span class="token punctuation">[</span><span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">]</span><span class="token punctuation">,</span>        <span class="token punctuation">[</span><span class="token boolean">False</span><span class="token punctuation">,</span>  <span class="token boolean">True</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token comment"># index_nonzero</span>tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>        <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>Test 3 å¦‚ä½•åˆå¹¶å¤šä¸ªæ¡ä»¶å‘¢</strong></p><p>åˆ©ç”¨é›†åˆæ“ä½œå³å¯</p><ul><li><p>æ ¹æ®åŸå­æ¡ä»¶åˆ†åˆ«ç”Ÿæˆå¤šä¸ª booltensor</p></li><li><p>æ ¹æ®éœ€æ±‚é‡‡ç”¨äº¤æˆ–å¹¶ç­‰çš„æ–¹å¼åˆå¹¶å¤šä¸ª booltensor</p></li></ul><pre class="line-numbers language-Python" data-language="Python"><code class="language-Python">a &#x3D; torch.randint(0, 8, (2, 5)) # 1 &lt; a &lt; 4: a &#x3D; 2 or 3bool_tensor_1 &#x3D; a &gt; 1bool_tensor_2 &#x3D; a &lt; 4bool_tensor &#x3D; bool_tensor_1 &amp; bool_tensor_2 # äº¤é›†index &#x3D; torch.nonzero(bool_tensor)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>Output 3</p><pre class="line-numbers language-Python" data-language="Python"><code class="language-Python"># atensor([[1, 4, 2, 6, 0],        [5, 3, 1, 2, 6]])# bool tensor 1tensor([[False,  True,  True,  True, False],        [ True,  True, False,  True,  True]])# bool tensor 2tensor([[ True, False,  True, False,  True],        [False,  True,  True,  True, False]])# bool tensortensor([[False, False,  True, False, False],        [False,  True, False,  True, False]])# indextensor([[0, 2],        [1, 1],        [1, 3]])<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="where"><a class="markdownIt-Anchor" href="#where"></a> where</h2><p><strong>åŠŸèƒ½ 1</strong>ï¼šæ ¹æ® booltensor è¿”å›ç›®æ ‡å€¼çš„ç´¢å¼•</p><p><strong>ç®€å•ç†è§£</strong></p><pre class="line-numbers language-python" data-language="python"><code class="language-python">torch<span class="token punctuation">.</span>where<span class="token punctuation">(</span>condition<span class="token punctuation">)</span> <span class="token operator">==</span> torch<span class="token punctuation">.</span>nonzero<span class="token punctuation">(</span>condition<span class="token punctuation">,</span> as_tuple<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>å‚æ•°</strong>ï¼šcondition - booltensor</p><p><strong>Test 1</strong></p><pre class="line-numbers language-python" data-language="python"><code class="language-python">x <span class="token operator">=</span> torch<span class="token punctuation">.</span>randn<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>y <span class="token operator">=</span> torch<span class="token punctuation">.</span>where<span class="token punctuation">(</span>x <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>Output</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">x <span class="token operator">=</span> tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token number">1.2484</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.4649</span><span class="token punctuation">]</span><span class="token punctuation">,</span>            <span class="token punctuation">[</span> <span class="token number">1.7428</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.3610</span><span class="token punctuation">]</span><span class="token punctuation">,</span>            <span class="token punctuation">[</span> <span class="token number">0.3865</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.1223</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>y <span class="token operator">=</span> <span class="token punctuation">(</span>tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p><strong>åŠŸèƒ½ 2</strong>ï¼šæ ¹æ® booltensor å®šä½åˆ°ç›®æ ‡å€¼ï¼Œé€‰æ‹©æ€§è¿›è¡Œ å€¼æ›¿æ¢</p><p><strong>æ³¨æ„</strong>ï¼šæ”¯æŒå¹¿æ’­</p><p><strong>ç®€å•ç†è§£</strong></p><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>o</mi><mi>u</mi><msub><mi>t</mi><mi>i</mi></msub><mo>=</mo><mrow><mo fence="true">{</mo><mtable rowspacing="0.3599999999999999em" columnalign="left left" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><msub><mi>x</mi><mi>i</mi></msub><mtext>Â </mtext></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>i</mi><mi>f</mi><mtext>Â </mtext><mi>c</mi><mi>o</mi><mi>n</mi><mi>d</mi><mi>i</mi><mi>t</mi><mi>i</mi><mi>o</mi><msub><mi>n</mi><mi>i</mi></msub></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><msub><mi>y</mi><mi>i</mi></msub><mtext>Â </mtext></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>o</mi><mi>t</mi><mi>h</mi><mi>e</mi><mi>r</mi><mi>w</mi><mi>i</mi><mi>s</mi><mi>e</mi></mrow></mstyle></mtd></mtr></mtable></mrow></mrow><annotation encoding="application/x-tex">out_i = \begin{cases}x_i \ &amp;if\ condition_i \\y_i \ &amp;otherwise\end{cases}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.76508em;vertical-align:-0.15em;"></span><span class="mord mathdefault">o</span><span class="mord mathdefault">u</span><span class="mord"><span class="mord mathdefault">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:3.0000299999999998em;vertical-align:-1.25003em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size4">{</span></span><span class="mord"><span class="mtable"><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.69em;"><span style="top:-3.69em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace">Â </span></span></span><span style="top:-2.25em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace">Â </span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.19em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:1em;"></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.69em;"><span style="top:-3.69em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord mathdefault">i</span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="mspace">Â </span><span class="mord mathdefault">c</span><span class="mord mathdefault">o</span><span class="mord mathdefault">n</span><span class="mord mathdefault">d</span><span class="mord mathdefault">i</span><span class="mord mathdefault">t</span><span class="mord mathdefault">i</span><span class="mord mathdefault">o</span><span class="mord"><span class="mord mathdefault">n</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.25em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord mathdefault">o</span><span class="mord mathdefault">t</span><span class="mord mathdefault">h</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="mord mathdefault">i</span><span class="mord mathdefault">s</span><span class="mord mathdefault">e</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.19em;"><span></span></span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p><p><strong>å‚æ•°</strong>ï¼š</p><ul><li>condition - booltensor</li><li>x - tensor</li><li>y - tensor</li></ul><p><strong>Test 2 å¤§äº0ä¸å˜ å°äºç­‰äº0æ”¹å˜</strong></p><pre class="line-numbers language-python" data-language="python"><code class="language-python">x <span class="token operator">=</span> torch<span class="token punctuation">.</span>randn<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>y <span class="token operator">=</span> torch<span class="token punctuation">.</span>ones<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>z <span class="token operator">=</span> torch<span class="token punctuation">.</span>where<span class="token punctuation">(</span>x <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">)</span>z_1 <span class="token operator">=</span> torch<span class="token punctuation">.</span>where<span class="token punctuation">(</span>x <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">,</span> x<span class="token punctuation">,</span> torch<span class="token punctuation">.</span>tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">,</span>                                           <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">,</span>                                           <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># æ”¯æŒå¹¿æ’­</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>Output</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">x <span class="token operator">=</span> tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1.9040</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.3891</span><span class="token punctuation">]</span><span class="token punctuation">,</span>            <span class="token punctuation">[</span> <span class="token number">1.0645</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.0039</span><span class="token punctuation">]</span><span class="token punctuation">,</span>            <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">0.1270</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.2566</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>z <span class="token operator">=</span> tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1.0000</span><span class="token punctuation">,</span> <span class="token number">1.0000</span><span class="token punctuation">]</span><span class="token punctuation">,</span>            <span class="token punctuation">[</span><span class="token number">1.0645</span><span class="token punctuation">,</span> <span class="token number">1.0000</span><span class="token punctuation">]</span><span class="token punctuation">,</span>            <span class="token punctuation">[</span><span class="token number">1.0000</span><span class="token punctuation">,</span> <span class="token number">1.0000</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token comment"># z_1</span>tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1.0000</span><span class="token punctuation">,</span> <span class="token number">1.0000</span><span class="token punctuation">]</span><span class="token punctuation">,</span>        <span class="token punctuation">[</span><span class="token number">1.0645</span><span class="token punctuation">,</span> <span class="token number">2.0000</span><span class="token punctuation">]</span><span class="token punctuation">,</span>        <span class="token punctuation">[</span><span class="token number">3.0000</span><span class="token punctuation">,</span> <span class="token number">3.0000</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="take"><a class="markdownIt-Anchor" href="#take"></a> take</h2><p><strong>åŠŸèƒ½</strong>ï¼šæ ¹æ®ä¸€ç»´ç´¢å¼•è¿›è¡Œå–å€¼ï¼Œè¿”å›ä¸€ç»´tensor ï¼ˆå†…éƒ¨å°†è¾“å…¥çš„tensoré“ºå¹³åè¿›è¡Œç´¢å¼•ï¼‰</p><p><strong>åŠŸèƒ½</strong>ï¼šæ ¹æ®ä¸€ç»´ç´¢å¼•è¿›è¡Œå–å€¼ï¼Œè¿”å›ä¸€ç»´tensor ï¼ˆå†…éƒ¨å°†è¾“å…¥çš„tensoré“ºå¹³åè¿›è¡Œç´¢å¼•ï¼‰</p><p><strong>æ³¨æ„</strong>ï¼šè¿›è¡Œäº†æ•°æ®æ‹·è´</p><p><strong>å‚æ•°</strong></p><ul><li>input</li><li>indices - ä¸€ç»´ç´¢å¼•</li></ul><p><strong>Test</strong></p><pre class="line-numbers language-python" data-language="python"><code class="language-python">x <span class="token operator">=</span> torch<span class="token punctuation">.</span>arange<span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">.</span>view<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>indices <span class="token operator">=</span> torch<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token punctuation">)</span><span class="token punctuation">)</span>y <span class="token operator">=</span> torch<span class="token punctuation">.</span>take<span class="token punctuation">(</span>x<span class="token punctuation">,</span> indices<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>Output</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">x <span class="token operator">=</span> tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span>            <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>indices <span class="token operator">=</span> tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>y <span class="token operator">=</span> tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h1 id="tensor-çš„å¡«å……"><a class="markdownIt-Anchor" href="#tensor-çš„å¡«å……"></a> tensor çš„å¡«å……</h1><p>refï¼š<a target="_blank" rel="noopener" href="https://pytorch.org/docs/stable/tensors.html#torch.Tensor.scatter_">https://pytorch.org/docs/stable/tensors.html#torch.Tensor.scatter_</a></p><h2 id="scatter"><a class="markdownIt-Anchor" href="#scatter"></a> scatter</h2><p>scatter æ˜¯æ’’æ’­çš„æ„æ€ï¼Œå¸Œæœ›èƒ½å…ˆå…¥ä¸ºä¸»çš„ç†è§£ä¸€ä¸‹è¿™ä¸ªå‡½æ•°çš„åŠŸèƒ½ï¼Œå°±æ˜¯å¾€ç›®æ ‡çŸ©é˜µæ’’ä¸€äº›æ•°å€¼è¿›å»ï¼Œå¾€å“ªæ’’ï¼ˆdimï¼Ÿindexï¼Ÿï¼‰ä¸æ’’ä»€ä¹ˆå€¼ï¼ˆsrcï¼‰å°†ç”±æˆ‘ä»¬è¾“å…¥çš„å‚æ•°å†³å®š</p><p>å®˜æ–¹ä¸€äº›çš„è¯´æ˜ï¼šå°† src ä¸­æ•°æ®æ ¹æ® index ä¸­çš„ç´¢å¼•æŒ‰ç…§ dim çš„æ–¹å‘å¡«è¿› input ä¸­</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">tensor<span class="token punctuation">.</span>scatter<span class="token punctuation">(</span>dim<span class="token punctuation">,</span> index<span class="token punctuation">,</span> src<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ä»æ•°å­¦å…¬å¼ä¸Šæ¥çœ‹æ‰§è¡Œæµç¨‹ï¼š</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">self<span class="token punctuation">[</span>index<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> src<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">[</span>k<span class="token punctuation">]</span>  <span class="token comment"># if dim == 0</span>self<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>index<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> src<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">[</span>k<span class="token punctuation">]</span>  <span class="token comment"># if dim == 1</span>self<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">[</span>index<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> src<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">[</span>k<span class="token punctuation">]</span>  <span class="token comment"># if dim == 2</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>1ã€åŸå§‹çš„å¯¹åº”å¡«å……æ–¹å¼ <code>self[i][j][k] = src[i][j][k]</code> å°†è¢« <code>index</code> ç´¢å¼•å¼ é‡å½±å“ï¼Œå› æ­¤æ‰èƒ½ä½“ç°å‡ºæ’’ï¼ˆscatterï¼‰çš„æ„Ÿè§‰</p><p>2ã€dim å†³å®šå½±å“çš„ç»´åº¦ï¼Œå…¶ä½™ç»´åº¦ä¸å˜</p><p>3ã€æˆ‘ä»¬å¯¹ index è¿›è¡Œéå†æ—¶ï¼Œdim å½±å“çš„é‚£ä¸€ä¸ªç»´åº¦ä¼šç”± index å†…éƒ¨çš„å€¼å†³å®šï¼Œå…¶ä½™ç»´åº¦ç´¢å¼•ä¿æŒä¸€è‡´</p><p>å¸Œæœ›ä»¥ä¸Šä¸‰ç‚¹èƒ½åŠ æ·±å¯¹ä¸‹é¢ä¾‹å­çš„ç†è§£</p><blockquote><p>ä¸ºäº†ä¿è¯ç´¢å¼•å¯¹åº” index ç´¢å¼•å¼ é‡çš„ç»´åº¦åº”ä¸ src å¼ é‡çš„ç»´åº¦ä¸€è‡´ï¼Œä½†æ˜¯ shape å¯ä»¥ä¸ä¸€è‡´</p></blockquote><p>è®©æˆ‘ä»¬ä»¥ä¸€ä¸ªäºŒç»´çš„æƒ…å½¢ä¸ºä¾‹ï¼š</p><p><img src="https://gitee.com/Butterflier/pictures/raw/master/image-20211028195119040.png" alt="image-20211028195119040" /></p><p>ä» index å‡ºå‘ï¼Œå› ä¸º dim = 1ï¼Œæ‰€ä»¥æˆ‘ä»¬èƒ½å¤Ÿå¾—çŸ¥ç›®æ ‡å¡«å……ç´¢å¼•ä¸º (0, 3)</p><blockquote><p>å¯ä»¥è®¤ä¸ºå…ˆä» (i = 0, j=0) æ‰¾åˆ°äº† index å’Œ value çš„å€¼ï¼ˆ3, 9ï¼‰ï¼Œåˆå› ä¸º dim = 1ï¼Œå› æ­¤ index çš„å€¼å°†ä½œç”¨äºåˆ—ç´¢å¼•æ‰€ä»¥å¾—åˆ°æœ€ç»ˆç´¢å¼•ä¸º (i=0, j=3)</p></blockquote><p>å…¶å®å†æ¬¡çœ‹è¿™å¥è¯</p><blockquote><p>æˆ‘ä»¬å¯¹ index è¿›è¡Œéå†æ—¶ï¼Œdim å½±å“çš„é‚£ä¸€ä¸ªç»´åº¦ä¼šç”± index å†…éƒ¨çš„å€¼å†³å®šï¼Œå…¶ä½™ç»´åº¦ç´¢å¼•ä¿æŒä¸€è‡´</p></blockquote><p>é‚£æˆ‘ä»¬çœ‹ value ä¸­çš„ 5ï¼Œå®ƒçš„è¡Œç´¢å¼•æ˜¯ 1ï¼Œå› æ­¤å®ƒå¿…ç„¶æ’’åˆ° dest ä¸­çš„ç¬¬ä¸€è¡Œï¼ˆdim=1ï¼‰ï¼Œä½†æ˜¯æ’’åœ¨ç¬¬å‡ åˆ—å°†ç”± index å†³å®šï¼Œindex è¯´æ’’åœ¨ç¬¬ 4 åˆ—ï¼Œdoneï¼</p><p><img src="https://gitee.com/Butterflier/pictures/raw/master/image-20211028195554262.png" alt="image-20211028195554262" /></p><p><strong>Exampleï¼š Lable è½¬ one-hot</strong></p><p>Label é€šå¸¸æ˜¯ä¸€ç»´çš„ <code>shape=(N,)</code>ï¼Œè€Œæ¨¡å‹çš„ output é€šå¸¸æ˜¯ softmax ä¹‹åçš„äºŒç»´ç»“æœ<code>shape=(N, dim)</code>ï¼Œå› æ­¤å°† label å˜ä¸º äºŒç»´çš„ one-hot å½¢å¼éå¸¸å¸¸è§</p><p>é¦–å…ˆæŒ‡å®š dim = 1ï¼Œæ˜¯å› ä¸ºæˆ‘ä»¬å¡«å……å€¼è¦ä¿®æ”¹çš„ç»´åº¦ç´¢å¼•æ˜¯åˆ—å‘ç»´åº¦ï¼Œè¡Œç´¢å¼•å€¼å°†ä¸ Label çš„ç´¢å¼•å€¼å¯¹åº”ï¼Œå³é€šè¿‡æ§åˆ¶åˆ—å‘ç»´åº¦ä¿è¯å“ªä¸ªåœ°æ–¹å€¼æ˜¯ 1</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># ref: https://www.cnblogs.com/dogecheng/p/11938009.html</span>class_num <span class="token operator">=</span> <span class="token number">10</span>batch_size <span class="token operator">=</span> <span class="token number">4</span>label <span class="token operator">=</span> torch<span class="token punctuation">.</span>LongTensor<span class="token punctuation">(</span>batch_size<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>random_<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">%</span> class_num<span class="token comment">#tensor([[6],</span><span class="token comment">#        [0],</span><span class="token comment">#        [3],</span><span class="token comment">#        [2]])</span>torch<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span>batch_size<span class="token punctuation">,</span> class_num<span class="token punctuation">)</span><span class="token punctuation">.</span>scatter_<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> label<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token comment">#tensor([[0., 0., 0., 0., 0., 0., 1., 0., 0., 0.],</span><span class="token comment">#        [1., 0., 0., 0., 0., 0., 0., 0., 0., 0.],</span><span class="token comment">#        [0., 0., 0., 1., 0., 0., 0., 0., 0., 0.],</span><span class="token comment">#        [0., 0., 1., 0., 0., 0., 0., 0., 0., 0.]])</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>label å³æ˜¯æˆ‘ä»¬è¦ç´¢å¼•çš„åˆ—ï¼Œæˆ‘ä»¬éœ€è¦å®Œæˆå¯¹ label çš„éå†</p><p>1ã€ç¬¬ä¸€ä¸ªå€¼ä¸º <code>6</code> å‘ŠçŸ¥ç¬¬ä¸€è¡Œç¬¬ <code>6</code> åˆ—</p><p>1ã€ç¬¬äºŒä¸ªå€¼ä¸º <code>0</code> å‘ŠçŸ¥ç¬¬äºŒè¡Œç¬¬ <code>0</code> åˆ—</p><p>..</p><h1 id="tensorçš„å˜æ¢"><a class="markdownIt-Anchor" href="#tensorçš„å˜æ¢"></a> tensorçš„å˜æ¢</h1><ul><li>movedim</li><li>reshape</li><li>view</li><li>squeeze</li><li>unsqueeze</li><li>t</li><li>transpose</li></ul><h2 id="movedim"><a class="markdownIt-Anchor" href="#movedim"></a> movedim</h2><p><strong>åŠŸèƒ½</strong>ï¼šè¿›è¡Œï¼ˆå¤šä¸ªï¼‰ç»´åº¦çš„ç§»åŠ¨</p><p><strong>æ³¨æ„</strong>ï¼šå…¶ä½™ç»´åº¦ä¿æŒåŸæœ‰ä¸å˜ï¼Œå¹¶æŒ‰ç…§åŸé¡ºåºä¾æ¬¡è½ä½</p><p><strong>å‚æ•°</strong></p><ul><li>input</li><li>source - int or tuple - ç»´åº¦ç§»åŠ¨å‰çš„ç´¢å¼•</li><li>destination - int or tuple - ç»´åº¦ç§»åŠ¨åçš„ç´¢å¼•</li></ul><p><strong>Test 1 å…¶ä½™ç»´åº¦ä¿æŒåŸæœ‰ä¸å˜ï¼Œå¹¶æŒ‰ç…§åŸé¡ºåºä¾æ¬¡è½ä½</strong></p><pre class="line-numbers language-Python" data-language="Python"><code class="language-Python">a &#x3D; torch.randn(2, 3, 4, 5)b &#x3D; torch.movedim(a, 0, 3)c &#x3D; torch.movedim(a, 0, 2)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>Output</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">a <span class="token operator">=</span> torch<span class="token punctuation">.</span>Size<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span>b <span class="token operator">=</span> torch<span class="token punctuation">.</span>Size<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>c <span class="token operator">=</span> torch<span class="token punctuation">.</span>Size<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><strong>Test 2 è¾“å…¥ä¸ºtuple</strong></p><pre class="line-numbers language-python" data-language="python"><code class="language-python">a <span class="token operator">=</span> torch<span class="token punctuation">.</span>randn<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span>b <span class="token operator">=</span> torch<span class="token punctuation">.</span>movedim<span class="token punctuation">(</span>a<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>Output</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">a <span class="token operator">=</span> torch<span class="token punctuation">.</span>Size<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span>b <span class="token operator">=</span> torch<span class="token punctuation">.</span>Size<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="reshape"><a class="markdownIt-Anchor" href="#reshape"></a> reshape</h2><p><strong>åŠŸèƒ½</strong>ï¼šæ”¹å˜è¾“å…¥ tensor çš„ç»´åº¦åˆ†é…</p><p><strong>æ³¨æ„</strong>ï¼šåº”é»˜è®¤è¯¥å‡½æ•°ä¸ä¼šå¯¹æºæ•°æ®è¿›è¡Œæ‹·è´</p><p><strong>å‚æ•°</strong></p><ul><li>input</li><li>shape - int of tuple - å…¶ä½™ç»´åº¦ç¡®å®šçš„æƒ…å†µä¸‹ï¼Œå¯ä»¥ä½¿ç”¨ -1 ç”¨äºæ¨ç®—æŸä¸€ç»´åº¦çš„å¤§å°</li></ul><p><strong>Test</strong></p><pre class="line-numbers language-python" data-language="python"><code class="language-python">a <span class="token operator">=</span> torch<span class="token punctuation">.</span>randn<span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span>b <span class="token operator">=</span> torch<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span>a<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>Output</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">a <span class="token operator">=</span> torch<span class="token punctuation">.</span>Size<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">]</span><span class="token punctuation">)</span>b <span class="token operator">=</span> torch<span class="token punctuation">.</span>Size<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="view"><a class="markdownIt-Anchor" href="#view"></a> view</h2><h2 id="squeeze"><a class="markdownIt-Anchor" href="#squeeze"></a> squeeze</h2><p><strong>åŠŸèƒ½</strong>ï¼šé»˜è®¤ç§»é™¤ tensor ä¸­ç»´åº¦å¤§å°ä¸º 1 çš„ç»´åº¦ - ç»™å®š dim ååªè€ƒè™‘ç»™å®šçš„ dim æ˜¯å¦ç§»é™¤</p><p><strong>æ³¨æ„</strong>ï¼šè¾“å…¥ dim å¿…é¡»ä¸ºæ•´å‹ï¼Œä¸èƒ½ä¸ºæ•´å‹åºåˆ—</p><p><strong>å‚æ•°</strong>ï¼š</p><ul><li>input - tensor</li><li>dim - default(None) - int</li></ul><p><strong>Test</strong></p><pre class="line-numbers language-python" data-language="python"><code class="language-python">a <span class="token operator">=</span> torch<span class="token punctuation">.</span>randn<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>b <span class="token operator">=</span> torch<span class="token punctuation">.</span>squeeze<span class="token punctuation">(</span>a<span class="token punctuation">)</span>c <span class="token operator">=</span> torch<span class="token punctuation">.</span>squeeze<span class="token punctuation">(</span>a<span class="token punctuation">,</span> dim<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>d <span class="token operator">=</span> torch<span class="token punctuation">.</span>squeeze<span class="token punctuation">(</span>a<span class="token punctuation">,</span> dim<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>Output</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">torch<span class="token punctuation">.</span>Size<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span>torch<span class="token punctuation">.</span>Size<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span>torch<span class="token punctuation">.</span>Size<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span>torch<span class="token punctuation">.</span>Size<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h2 id="unsqueeze"><a class="markdownIt-Anchor" href="#unsqueeze"></a> unsqueeze</h2><p><strong>åŠŸèƒ½</strong>ï¼šä¸ squeeze æ–¹æ³•æƒ³åï¼Œå¢åŠ ä¸€ä¸ªå¤§å°ä¸º1çš„ç»´åº¦</p><p><strong>å‚æ•°</strong></p><ul><li>input - tensor</li><li>dim - int</li></ul><p><strong>Test</strong></p><pre class="line-numbers language-python" data-language="python"><code class="language-python">x <span class="token operator">=</span> torch<span class="token punctuation">.</span>tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span>y <span class="token operator">=</span> torch<span class="token punctuation">.</span>unsqueeze<span class="token punctuation">(</span>x<span class="token punctuation">,</span> dim<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>z <span class="token operator">=</span> torch<span class="token punctuation">.</span>unsqueeze<span class="token punctuation">(</span>x<span class="token punctuation">,</span> dim<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>Output</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">x <span class="token operator">=</span> torch<span class="token punctuation">.</span>Size<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span>y <span class="token operator">=</span> torch<span class="token punctuation">.</span>Size<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span>z <span class="token operator">=</span> torch<span class="token punctuation">.</span>Size<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h2 id="t"><a class="markdownIt-Anchor" href="#t"></a> t</h2><p><strong>åŠŸèƒ½</strong>ï¼šå¯¹äºŒç»´å¼ é‡è¿›è¡Œè½¬ç½®å¤„ç†</p><p><strong>æ³¨æ„</strong>ï¼šå¯¹äºä¸€ç»´ tensor è¿”å›çš„æ˜¯å®ƒæœ¬èº«</p><p><strong>å‚æ•°</strong>ï¼šinput - tensro</p><p><strong>Test</strong></p><pre class="line-numbers language-python" data-language="python"><code class="language-python">a <span class="token operator">=</span> torch<span class="token punctuation">.</span>randn<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>a_t <span class="token operator">=</span> torch<span class="token punctuation">.</span>t<span class="token punctuation">(</span>a<span class="token punctuation">)</span>b <span class="token operator">=</span> torch<span class="token punctuation">.</span>randn<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>b_t <span class="token operator">=</span> b<span class="token punctuation">.</span>t<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>Output</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">  a <span class="token operator">=</span> torch<span class="token punctuation">.</span>Size<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>a_t <span class="token operator">=</span> torch<span class="token punctuation">.</span>Size<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>  b <span class="token operator">=</span> torch<span class="token punctuation">.</span>Size<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span>b_t <span class="token operator">=</span> torch<span class="token punctuation">.</span>Size<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h2 id="transpose"><a class="markdownIt-Anchor" href="#transpose"></a> transpose</h2><p><strong>åŠŸèƒ½</strong>ï¼šå°†ç»™å®šçš„ä¸¤ä¸ªç»´åº¦è¿›è¡Œäº¤æ¢</p><p><strong>å‚æ•°</strong>ï¼š</p><ul><li>input - tensor</li><li>dim0 - int</li><li>dim1 - int</li></ul><p><strong>Test</strong></p><pre class="line-numbers language-Python" data-language="Python"><code class="language-Python">a &#x3D; torch.randn(2, 3, 4, 5)b &#x3D; torch.transpose(a, 1, 2)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>Output</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">a <span class="token operator">=</span> torch<span class="token punctuation">.</span>Size<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span>b <span class="token operator">=</span> torch<span class="token punctuation">.</span>Size<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h1 id="ä¸numpyè½¬æ¢"><a class="markdownIt-Anchor" href="#ä¸numpyè½¬æ¢"></a> ä¸Numpyè½¬æ¢</h1><p>Tipsï¼šTorch Tensor ä¸ Numpy array å…±äº«åº•å±‚çš„å†…å­˜ç©ºé—´</p><p>Tipsï¼šæ‰€æœ‰åœ¨ CPU ä¸Šçš„ tensor ï¼ˆexcept CharTensorï¼‰éƒ½å¯ä¸ Numpy array äº’è½¬æ¢</p><p><code>to numpy</code>ï¼š<code>tensor.numpy()</code></p><p><code>to tensor</code> ï¼š<code>torch.from_numpy(array)</code></p><h1 id="ä¸è®¾å¤‡äº¤äº’"><a class="markdownIt-Anchor" href="#ä¸è®¾å¤‡äº¤äº’"></a> ä¸è®¾å¤‡äº¤äº’</h1><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">if</span> torch<span class="token punctuation">.</span>cuda<span class="token punctuation">.</span>is_available<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    device <span class="token operator">=</span> torch<span class="token punctuation">.</span>device<span class="token punctuation">(</span><span class="token string">"cuda"</span><span class="token punctuation">)</span>gpu_tensor <span class="token operator">=</span> torch<span class="token punctuation">.</span>ones_like<span class="token punctuation">(</span>x<span class="token punctuation">,</span> device<span class="token operator">=</span>device<span class="token punctuation">)</span>gpu_tensor <span class="token operator">=</span> cpu_tensor<span class="token punctuation">.</span>to<span class="token punctuation">(</span>device<span class="token punctuation">)</span>cpu_tensor <span class="token operator">=</span> gpu_tensor<span class="token punctuation">.</span>to<span class="token punctuation">(</span><span class="token string">"cpu"</span><span class="token punctuation">,</span> torch<span class="token punctuation">.</span>double<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="è‡ªåŠ¨æ±‚å¯¼"><a class="markdownIt-Anchor" href="#è‡ªåŠ¨æ±‚å¯¼"></a> è‡ªåŠ¨æ±‚å¯¼</h1><p>å®šä¹‰å˜é‡æ—¶è®¾å®šï¼š<code>torch.tensor([1, 2, 3], requires_grad=True)</code></p><p>åç»­æ›´æ”¹è®¾å®šï¼š<code>tensor.requires_grad_(True)</code></p><p>ç»ˆæ­¢æŸTensoråœ¨è®¡ç®—å›¾ä¸­çš„è¿½è¸ªå›æº¯ï¼š<code>tensor.detach()</code></p><p>ç»ˆæ­¢æ•´ä¸ªæµç¨‹çš„åå‘ä¼ æ’­ï¼š<code>with torch.no_grad():</code></p><h2 id="ç›¸å…³å±æ€§"><a class="markdownIt-Anchor" href="#ç›¸å…³å±æ€§"></a> ç›¸å…³å±æ€§</h2><p><code>.grad_fn</code> - ä»£è¡¨å¼•ç”¨äº†é‚£ä¸ª Function åˆ›å»ºäº†è¯¥ Tensorï¼Œè‡ªå®šä¹‰åˆ™å€¼ä¸º None</p><p><code>.grad</code> - åœ¨è¯¥ Tensor ä¸Šçš„æ‰€æœ‰æ¢¯åº¦å°†è¢«ç´¯åŠ è¿›è¯¥å±æ€§</p><h1 id="end"><a class="markdownIt-Anchor" href="#end"></a> END</h1>]]></content>
      
      
      <categories>
          
          <category> Pytorch </category>
          
      </categories>
      
      
        <tags>
            
            <tag> DL </tag>
            
            <tag> pytorch </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>éš§é“ä¸IPsec VPN</title>
      <link href="/Coming-blog/2021/10/26/sui-dao-yu-ipsec-vpn/"/>
      <url>/Coming-blog/2021/10/26/sui-dao-yu-ipsec-vpn/</url>
      
        <content type="html"><![CDATA[<h1 id="prepare"><a class="markdownIt-Anchor" href="#prepare"></a> Prepare</h1><p>è™šæ‹Ÿä¸“ç”¨ç½‘ç»œï¼ŒVirtual Private Networkï¼ŒVPN</p><p>1ã€åœ¨å†…éƒ¨ç½‘ç»œå„ä¸ªå­ç½‘ä¹‹é—´å»ºç«‹ç‚¹å¯¹ç‚¹ IP éš§é“ï¼Œè§£å†³ç”±äº’è”ç½‘äº’è”çš„å†…éƒ¨ç½‘ç»œå„ä¸ªå­ç½‘ä¹‹é—´çš„é€šä¿¡é—®é¢˜</p><p>2ã€é€šè¿‡åœ¨ç‚¹å¯¹ç‚¹ IP éš§é“ä¸¤ç«¯ä¹‹é—´å»ºç«‹å®‰å…¨å…³è”ï¼Œè§£å†³å†…éƒ¨ç½‘ç»œå„ä¸ªå­ç½‘ä¹‹é—´çš„å®‰å…¨é€šä¿¡é—®é¢˜</p><p>3ã€é€šè¿‡ VPN æ¥å…¥æŠ€æœ¯è§£å†³è¿œç¨‹ç»ˆç«¯è®¿é—®å†…éƒ¨ç½‘ç»œèµ„æºçš„é—®é¢˜</p><h1 id="ç‚¹å¯¹ç‚¹-ip-éš§é“å®éªŒ"><a class="markdownIt-Anchor" href="#ç‚¹å¯¹ç‚¹-ip-éš§é“å®éªŒ"></a> ç‚¹å¯¹ç‚¹ IP éš§é“å®éªŒ</h1><h2 id="1-è·¯ç”±å™¨æ·»åŠ æ¥å£å¡"><a class="markdownIt-Anchor" href="#1-è·¯ç”±å™¨æ·»åŠ æ¥å£å¡"></a> 1ã€è·¯ç”±å™¨æ·»åŠ æ¥å£å¡</h2><p><strong>éœ€è¦å¯¹å…¬ç½‘è·¯ç”±å™¨ R4ï¼ŒR5ï¼ŒR6 æ·»åŠ é¢å¤–çš„æ¥å£å¡</strong></p><p>aã€ç‚¹å¼€è·¯ç”±å™¨çš„é…ç½®ç•Œé¢ï¼Œå…ˆå…³é—­è·¯ç”±å™¨</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20211017173557977.png" alt="image-20211017173557977" /></p><p>bã€å·¦ä¾§é€‰æ‹© NM - 2FE2W å°†å…¶æ‹–åŠ¨è¿›æŒ‡å®šçš„æ’æ§½</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20211017173647869.png" alt="image-20211017173647869" /></p><p>cã€å†æ¬¡å¯åŠ¨è·¯ç”±å™¨</p><h2 id="2-é…ç½®å¤–ç½‘è·¯ç”±å™¨"><a class="markdownIt-Anchor" href="#2-é…ç½®å¤–ç½‘è·¯ç”±å™¨"></a> 2ã€é…ç½®å¤–ç½‘è·¯ç”±å™¨</h2><p>ä¸»è¦é…ç½® R4ï¼ŒR5ï¼ŒR6 è·¯ç”±å™¨å…¨çƒ IP åœ°å€ä¸å­ç½‘æ©ç </p><p>Tipsï¼šé…ç½®æ—¶æ¨èæ‰“å¼€æ¥å£ï¼š<code>no shut</code></p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20211017184925520.png" alt="image-20211017184925520" /></p><p>æœ€ç»ˆé…ç½®ç»“æœå¦‚å›¾æ‰€ç¤ºï¼š</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20211017194622660.png" alt="image-20211017194622660" /></p><h2 id="3-é…ç½®å†…ç½‘è·¯ç”±å™¨"><a class="markdownIt-Anchor" href="#3-é…ç½®å†…ç½‘è·¯ç”±å™¨"></a> 3ã€é…ç½®å†…ç½‘è·¯ç”±å™¨</h2><p>ä¸»è¦é…ç½® R1ï¼ŒR2ï¼ŒR3 è·¯ç”±å™¨è¿æ¥å…¬å…±ç½‘ç»œæ¥å£ä¸å†…ç½‘æ¥å£çš„ IP ä¸ å­ç½‘æ©ç </p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20211017190327310.png" alt="image-20211017190327310" /></p><h2 id="4-ospf-é…ç½®"><a class="markdownIt-Anchor" href="#4-ospf-é…ç½®"></a> 4ã€OSPF é…ç½®</h2><blockquote><p>OSPFï¼Œå¼€æ”¾æœ€çŸ­è·¯å¾„ä¼˜å…ˆï¼Œå…¶è·¯ç”±è¿‡ç¨‹å¦‚ä¸‹ï¼š</p><p>1ã€å¯»æ‰¾é‚»å±…</p><p>2ã€å»ºç«‹é‚»æ¥å…³ç³»</p><p>3ã€é“¾è·¯çŠ¶æ€ä¿¡æ¯ä¼ é€’</p><p>4ã€è®¡ç®—è·¯ç”±</p><p>å› æ­¤å¯¹ R1-6 è·¯ç”±å™¨é…ç½® OSPF åï¼Œèƒ½å¤Ÿè‡ªåŠ¨å¯»æ‰¾é‚»å±…ï¼ˆè·¯ç”±å™¨ï¼‰ï¼Œäº¤æ¢è·¯ç”±ä¿¡æ¯ï¼Œä¿è¯è·¯ç”±å™¨ä¹‹é—´çš„è¿é€šæ€§</p></blockquote><p>ä»¥ R2 ä¸ºä¾‹ï¼Œé…ç½®è¿‡ç¨‹å¦‚ä¸‹ï¼šå°† 192.1.2.0 / 24 é…ç½®ä¸ºä¸€ä¸ª OSPF åŒºåŸŸï¼ˆæˆ–è€…æ˜¯è‡ªæ²»ç³»ç»Ÿ ASï¼‰</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20211017192234046.png" alt="image-20211017192234046" /></p><p>æœ€ç»ˆæ•´ä½“çš„åˆå§‹æ¶æ„å¦‚ä¸‹ï¼š</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20211017194711614.png" alt="image-20211017194711614" /></p><p>ä»¥ R4 çš„è·¯ç”±è¡¨ä¸ºä¾‹ï¼Œæˆ‘ä»¬æŸ¥çœ‹ä¸€ä¸‹æ˜¯å¦é…ç½®æ­£ç¡®ï¼šå…¶ä¸­ O è¡¨ç¤º OSPF</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20211017194746959.png" alt="image-20211017194746959" /></p><h2 id="5-éš§é“é…ç½®"><a class="markdownIt-Anchor" href="#5-éš§é“é…ç½®"></a> 5ã€éš§é“é…ç½®</h2><p>å¯¹ R1ï¼ŒR2 ä¸ R3 é…ç½®éš§é“</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">interface tunnel 1 # åˆ›å»ºç¼–å·ä¸º 1 çš„ IP éš§é“æ¥å£å¹¶è¿›å…¥é…ç½®æ¨¡å¼# ä¸ºéš§é“æ¥å£é…ç½®ç§æœ‰ IP åœ°å€ 192.168.4.1 å’Œå­ç½‘æ©ç  255.255.255.0# å› ä¸ºæˆ‘ä»¬å‘é€çš„ip address 192.168.4.1 255.255.255.0 # æŒ‡å®šéš§é“æºç«¯çš„å…¬ç½‘ IP ï¼ˆä¸è·¯ç”±å™¨æ¥å£ç»‘å®šï¼‰tunnel source FastEthernet 0&#x2F;1# æŒ‡å®šéš§é“ç›®çš„ç«¯çš„å…¬ç½‘ IPtunnel destination 192.1.2.1<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20211017202015250.png" alt="image-20211017202015250" /></p><h2 id="6-rip-é…ç½®"><a class="markdownIt-Anchor" href="#6-rip-é…ç½®"></a> 6ã€RIP é…ç½®</h2><p>ä¸ºä»€ä¹ˆè¦è¿›è¡Œ RIP é…ç½®ï¼Œä¸ºäº†èƒ½ä½¿å¾— R1-3 å‘ç°ï¼ˆç›´è¿ï¼‰éš§é“çš„ç§æœ‰ IP åœ°å€</p><blockquote><p>RIPï¼ŒRouting Information Protocolï¼Œæ˜¯ä¸€ç§è·ç¦»å‘é‡åè®®</p></blockquote><p>ä»¥ R1 ä¸ºä¾‹</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">router rip# ä¸‹æ–¹è¡¨ç¤ºè¯¥è·¯ç”±å™¨ç›´è¿çš„ç½‘æ®µnetwork 192.168.1.0 # è‡ªèº«å†…ç½‘ç§æœ‰åœ°å€network 192.168.4.0 # Tunnel 1 çš„ç§æœ‰åœ°å€network 192.168.5.0 # Tunnel 2 çš„ç§æœ‰åœ°å€<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="7-è·¯ç”±è¡¨åˆ†æ"><a class="markdownIt-Anchor" href="#7-è·¯ç”±è¡¨åˆ†æ"></a> 7ã€è·¯ç”±è¡¨åˆ†æ</h2><p>ä»¥ R1 ä¸ºä¾‹</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20211017202946682.png" alt="image-20211017202946682" /></p><p>C ç±»è·¯ç”±è¡¨é¡¹ï¼Œè¡¨ç¤ºç›´æ¥è¿æ¥çš„ç½‘ç»œè·¯é‚®é¡¹ç›®ï¼Œæœ‰ å¤–éƒ¨ç½‘æ®µ <code>192.1.1.0</code> èµ°æ¥å£ <code>0/1</code>ï¼Œæœ‰å†…éƒ¨ç½‘æ®µ <code>192.168.1.0</code> èµ°æ¥å£ <code>0/0</code> ï¼Œè¿˜æœ‰éš§é“ 1 çš„ <code>192.168.4.0</code> éš§é“æºç«¯ï¼Œéš§é“ 2 çš„ <code>192.168.5.0</code> éš§é“æºç«¯ï¼›</p><p>O ç±»è·¯ç”±è¡¨é¡¹ï¼Œè¡¨ç¤ºé€šå¾€å…¬å…±å­ç½‘çš„ä¼ è¾“è·¯å¾„ï¼ˆéç›´è¿ï¼‰ï¼Œå¯¹äº R1 é™¤äº† <code>192.1.1.0</code> ç½‘æ®µç›´è¿å¤– <code>2.0, 3.0, 4.0, 5.0, 6.0</code> å‡æ˜¯é€šè¿‡OSPF é…ç½®å¾—åˆ°çš„åŠ¨æ€è·¯ç”±é¡¹</p><p>R ç±»è·¯ç”±è¡¨é¡¹ï¼Œè¡¨ç¤ºé€šå¾€å†…éƒ¨å­ç½‘çš„ä¼ è¾“è·¯å¾„ï¼ˆéç›´è¿ï¼‰ï¼Œæœ‰ RIP åŠ¨æ€è·¯ç”±ä¹ å¾—ï¼Œå¯¹äº R1 é™¤äº† <code>192.1.1.0</code> è¿™ä¸€å†…éƒ¨å­ç½‘ç›´è¿å¤–ï¼Œè¿˜èƒ½ä¹ å¾— <code>192.168.2.0, 192.168.2.0</code> è¿™ä¸¤ä¸ªï¼Œè¿™æ˜¯é€šè¿‡ RIP é…ç½®çš„ <code>192.168.4.0, 192.168.5.0</code>  éš§é“ç›´è¿å¾—åˆ°ï¼›çœ‹åˆ°åº•éƒ¨è¿˜æœ‰ä¸€ä¸ª <code>192.168.6.0</code> è¿™æ˜¯ R3 é‚£è¾¹é…ç½®éš§é“å’Œ RIP åï¼ŒR1 ä¹ å¾—çš„ç»“æœã€‚</p><h2 id="8-é…ç½®-pc-ä¸-server"><a class="markdownIt-Anchor" href="#8-é…ç½®-pc-ä¸-server"></a> 8ã€é…ç½® PC ä¸ Server</h2><table><thead><tr><th>HOST</th><th>IP</th><th>Gateway</th></tr></thead><tbody><tr><td>PC0</td><td>192.168.1.1</td><td>192.168.1.254</td></tr><tr><td>PC1</td><td>192.168.1.2</td><td>192.168.1.254</td></tr><tr><td>PC2</td><td>192.168.2.1</td><td>192.168.2.254</td></tr><tr><td>PC3</td><td>192.168.2.2</td><td>192.168.2.254</td></tr><tr><td>PC4</td><td>192.168.3.1</td><td>192.168.3.254</td></tr><tr><td>PC5</td><td>192.168.3.2</td><td>192.168.3.254</td></tr><tr><td>Server0</td><td>192.168.1.3</td><td>192.168.1.254</td></tr><tr><td>Server1</td><td>192.168.2.3</td><td>192.168.2.254</td></tr><tr><td>Server2</td><td>192.168.3.3</td><td>192.168.3.254</td></tr></tbody></table><h2 id="9-éš§é“æµ‹è¯•"><a class="markdownIt-Anchor" href="#9-éš§é“æµ‹è¯•"></a> 9ã€éš§é“æµ‹è¯•</h2><p>ä½¿ç”¨ PC0 ping PC4 <code>192.168.3.1</code></p><p>åœ¨å†…ç½‘ä¸­ å…ˆç»™äº¤æ¢æœºï¼Œäº¤æ¢æœºç»™ç½‘å…³ï¼Œæ²¡æœ‰é—®é¢˜</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20211017205508453.png" alt="image-20211017205508453" /></p><p>è¿›å…¥å…¬ç½‘ï¼Œéœ€è¦éš§é“ 2 é…åˆæ¢ä¸Šå…¬ç½‘ IP <code>192.1.1.1</code></p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20211017223314685.png" alt="image-20211017223314685" /></p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20211018085748762.png" alt="image-20211018085748762" /></p><p>çœŸå®çš„è¡ŒåŠ¨è½¨è¿¹</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20211017223418362.png" alt="image-20211017223418362" /></p><p>åˆ°äº† Router 3 åï¼š</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20211017223512176.png" alt="image-20211017223512176" /></p><p>Tipsï¼šå¦‚æœæ²¡æœ‰è¿™æ¡ Tunnel2 ç§æœ‰åœ°å€ï¼ˆ<code>192.168.1.1 - 192.168.3.1</code>ï¼‰æ˜¯æ— æ³•åœ¨å…¬ç½‘ä¸Šè·¯ç”±çš„ï¼Œä½†æ˜¯ä»–åº”è¯¥èƒ½æ‰¾å¯»åˆ° Tunnel1 -&gt; Tunnel3 -&gt; PC3 è¿™æ ·ä¸€æ¡è·¯å¾„ï¼Œæˆ‘ä»¬æ¥å°è¯•ä¸‹ï¼š</p><h2 id="10-æ™ºèƒ½è·¯ç”±æµ‹è¯•"><a class="markdownIt-Anchor" href="#10-æ™ºèƒ½è·¯ç”±æµ‹è¯•"></a> 10ã€æ™ºèƒ½è·¯ç”±æµ‹è¯•</h2><p>å…³é—­ Tunnel2 å¾ˆç®€å•ï¼šåœ¨ R1 ä¸ R3 ä¸­è¾“å…¥å¦‚ä¸‹å‘½ä»¤ï¼Œé‡å¯ Packet Tracer åï¼ŒR1 å’Œ R3 å°±æ— æ³•å‘ç°Tunnel 2 äº†ã€‚</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">router ripno network 192.168.5.0<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>éšåæˆ‘ä»¬å°è¯• PC0 Ping PC3ï¼Œç¬¬ä¸€ä¸ªå…³é”®èŠ‚ç‚¹æ˜¯ R1 è¾“å‡ºçš„ IP åŒ…ï¼šå¯ä»¥çœ‹å‡ºä»–çš„ç¡®æ²¡æœ‰è¯†åˆ«åˆ° Tunnel 2ï¼Œä½†æ˜¯é€šè¿‡è·¯ç”±å™¨ä¹‹é—´äº’å­¦ä¹ ï¼ˆè·¯ç”±è¡¨äº¤æ¢ï¼‰ï¼ŒR1 èƒ½å¤Ÿå­¦ä¹ åˆ°é€šå¾€ 192.168.3.0/24 çš„è·¯ç”±é¡¹ã€‚</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20211018091036921.png" alt="image-20211018091036921" /></p><p>R1 çš„éƒ¨åˆ†è·¯ç”±è¡¨ï¼Œ192.168.3.0 /24 èµ° Tunnel1 å³å¯</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20211018091244762.png" alt="image-20211018091244762" /></p><p>éšåèƒ½åœ¨å…¬ç½‘ä¸Šé¡ºåˆ©åˆ°è¾¾ 192.1.2.1 ï¼ˆR2ï¼‰ï¼ŒR2 èƒ½å¤Ÿé€šè¿‡ Tunnel 3ï¼Œä¼ ç»™ R3ï¼Œè¿›è€Œåˆ°è¾¾ PC3</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20211018091415881.png" alt="image-20211018091415881" /></p><h1 id="ipsec"><a class="markdownIt-Anchor" href="#ipsec"></a> IPSec</h1><p>Targetï¼šé€šè¿‡ IPSec å®ç°ç»è¿‡ç‚¹å¯¹ç‚¹ IP éš§é“ä¼ è¾“å†…å®¹çš„ä¿å¯†æ€§ä»¥åŠå®Œæ•´æ€§ï¼Œåˆ†ä¸¤ä¸ªé˜¶æ®µå®Œæˆï¼Œç¬¬ä¸€ä¸ªé˜¶æ®µå»ºç«‹ç‚¹å¯¹ç‚¹ IP éš§é“ä¸¤ç«¯ä¹‹é—´çš„å®‰å…¨ä¼ è¾“é€šé“ï¼›ç¬¬äºŒé˜¶æ®µæ˜¯å»ºç«‹ç‚¹å¯¹ç‚¹ IP éš§é“ä¸¤ç«¯ä¹‹é—´çš„åŒå‘å®‰å…¨å…³è”ã€‚</p><p>å…·ä½“åŒ…æ‹¬ï¼š</p><p>aã€å»ºç«‹å®‰å…¨ä¼ è¾“é€šé“ï¼šå®Œæˆèº«ä»½é‰´åˆ«åè®®ã€å¯†é’¥äº¤æ¢ç®—æ³•å’ŒåŠ å¯†/è§£å¯†ç®—æ³•ç­‰åå•†è¿‡ç¨‹</p><p>bã€å»ºç«‹å®‰å…¨å…³è”ï¼šç¡®è®¤å®‰å…¨åè®®ã€åŠ å¯†ç®—æ³•ã€HMAC ç®—æ³•ç­‰</p><blockquote><p>é€‰æ‹© AH ä¸ºå®‰å…¨åè®®æ—¶ä¸éœ€è¦é€‰æ‹©åŠ å¯†ç®—æ³•</p></blockquote><p>cã€é…ç½®åˆ†ç»„è¿‡æ»¤å™¨ï¼šç­›é€‰å‡ºéœ€è¦ç»è¿‡ IPSec å®‰å…¨å…³è”ä¼ è¾“çš„ä¸€ç»„ IP åˆ†ç»„ï¼Œåªæœ‰ä¸å®ç°å†…éƒ¨å­ç½‘ä¹‹é—´é€šä¿¡ç›¸å…³çš„ IP åˆ†ç»„æ‰éœ€è¦ç»è¿‡ IPSec å®‰å…¨å…³è”è¿›è¡Œä¼ è¾“</p><h2 id="ç›¸å…³å‘½ä»¤è§£é‡Š"><a class="markdownIt-Anchor" href="#ç›¸å…³å‘½ä»¤è§£é‡Š"></a> ç›¸å…³å‘½ä»¤è§£é‡Š</h2><h3 id="å®‰å…¨ç­–ç•¥"><a class="markdownIt-Anchor" href="#å®‰å…¨ç­–ç•¥"></a> å®‰å…¨ç­–ç•¥</h3><p>åå•†å®‰å…¨ä¼ è¾“é€šé“æ‰€éœ€çš„å®‰å…¨ç­–ç•¥ï¼Œç„¶ååå•†å®‰å…¨ç­–ç•¥ä¸­çš„èº«ä»½é‰´åˆ«æœºåˆ¶ï¼ŒåŠ å¯†ç®—æ³•ï¼Œhash ç®—æ³•</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"># ä¸¤ç«¯å¯å®šä¹‰å¤šä¸ªå®‰å…¨ç­–ç•¥ç¼–å·è¶Šå°è¡¨ç¤ºçš„ä¼˜å…ˆçº§è¶Šé«˜crypto isakmp policy 1  # å®šä¹‰ç¼–å·å’Œä¼˜å…ˆçº§ä¸º 1 çš„å®‰å…¨ç­–ç•¥å¹¶è¿›å…¥å…¶é…ç½®æ¨¡å¼# å¯é€‰çš„é‰´åˆ«æœºåˆ¶æœ‰å¾ˆå¤šï¼šåŸºäº RSA çš„æ•°å€¼ç­¾åç­‰authentication pre-share # æŒ‡å®šèº«ä»½é‰´åˆ«æœºåˆ¶ pre-share è¡¨ç¤ºå…±äº«å¯†é’¥é‰´åˆ«æœºåˆ¶# æ”¯æŒçš„åŠ å¯†ç®—æ³•æœ‰å¾ˆå¤šï¼š3DESã€AESã€DESencryption 3des # æŒ‡å®šåŠ å¯†ç®—æ³•# å¯é€‰ MD5 SHA ç­‰hash md5 # æŒ‡å®šæŠ¥æ–‡æ‘˜è¦ç®—æ³• MD5# é¢„å®šä¹‰äº† 1 2 5 å·ç»„æ ‡è¯†ç¬¦group 2 # æŒ‡å®š Diffie-Hellman ç»„è¡¨ç¤ºç¬¦ï¼Œåœ¨ DH ç®—æ³•åŒæ­¥å¯†é’¥æ—¶ï¼Œä½¿ç”¨ç»„æ ‡è¯†ç¬¦ 2 å¯¹åº”çš„å‚æ•°# è¶…æ—¶åéœ€è¦é‡æ–°å»ºç«‹å®‰å…¨ä¼ è¾“é€šé“ï¼ˆå®‰å…¨å…³è”ï¼‰lifetime 3600 # æŒ‡å®šè¯¥å®‰å…¨ç­–ç•¥çš„å¤±æ•ˆæ—¶é—´ 3600s# ä¸ºéœ€è¦å»ºç«‹å®‰å…¨ä¼ è¾“é€šé“ ä¸” é‡‡ç”¨å…±äº«ç§˜é’¥é‰´åˆ«æœºåˆ¶çš„éš§é“ä¸¤ç«¯é…ç½®å…±äº«ç§˜é’¥ 1234# 0.0.0.0&#x2F;0.0.0.0 è¡¨ç¤ºå¦ä¸€ç«¯ IP ä»»æ„crypto isakmap key 1234 address 0.0.0.0 0.0.0.0 <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="ipsec-å˜æ¢é›†"><a class="markdownIt-Anchor" href="#ipsec-å˜æ¢é›†"></a> IPSec å˜æ¢é›†</h3><p>æŒ‡å®šå®‰å…¨åè®®ï¼Œä»¥åŠä½¿ç”¨çš„åŠ å¯†ç®—æ³•å’Œ HMAC ç®—æ³•</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">crypto ipsec transform-set tunnel esp-3des esp-md5-hmac# transform-set è¡¨ç¤ºå˜æ¢é›†# tunnel ä¸ºå˜æ¢é›†çš„åç§°# é€‰æ‹© ESP ä½œä¸ºå®‰å…¨åè®®ï¼Œå¯é€‰çš„åŠ å¯†ç®—æ³•æœ‰ï¼šesp-3des, esp-des, esp-aes å¯é€‰çš„ HMAC ç®—æ³•æœ‰ï¼šesp-md5-hmac, esp-sha-hmac# é€‰æ‹© AH ä½œä¸ºå®‰å…¨åè®®ï¼Œå¯é€‰çš„ HMAC ç®—æ³•æœ‰ï¼šesp-md5-hmac, esp-sha-hmac<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="åˆ†ç»„è¿‡æ»¤å™¨"><a class="markdownIt-Anchor" href="#åˆ†ç»„è¿‡æ»¤å™¨"></a> åˆ†ç»„è¿‡æ»¤å™¨</h3><p>æŒ‡å®šéœ€è¦ç»è¿‡å®‰å…¨å…³è”ä¼ è¾“çš„ IP åˆ†ç»„é›†ï¼Œåªæœ‰ä¸å®ç°å†…éƒ¨å­ç½‘ä¹‹é—´é€šä¿¡ç›¸å…³çš„ IP åˆ†ç»„æ‰éœ€è¦ç»è¿‡ IPSec å®‰å…¨å…³è”è¿›è¡Œä¼ è¾“</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">access-list 101 permit gre host 192.1.1.1 host 192.1.2.1access-list 101 deny ip any any# 101 ç»„è¿‡æ»¤ï¼ŒæŒ‡å®šæº IP ä¸º 192.1.1.1 ç›®çš„ IP ä¸º 192.1.2.1# gre è¡¨ç¤º ä»¥ GRE æ ¼å¼å°è£…å†…å±‚ IPåˆ†ç»„<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h3 id="åŠ å¯†æ˜ å°„"><a class="markdownIt-Anchor" href="#åŠ å¯†æ˜ å°„"></a> åŠ å¯†æ˜ å°„</h3><p>æŒ‡å®šå®‰å…¨å…³è”æ‰€ ä½¿ç”¨çš„å®‰å…¨åè®®å’Œç›¸å…³ç®—æ³•çš„ IPSec å˜æ¢é›†ä¸è¿‡æ»¤å IP åˆ†ç»„çš„ç»‘å®š</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"># åˆ›å»ºåä¸º tunnel åºå·ä¸º 10 çš„ ipsec-isakmp ç¯å¢ƒä¸‹çš„åŠ å¯†æ˜ å°„å¹¶è¿›å…¥å…¶é…ç½®æ¨¡å¼crypto map tunnel 10 ipsec-isakmpset peer 192.1.2.1 # æŒ‡å®šå®‰å…¨å…³è”çš„å¦ä¸€ç«¯ ä¸º 192.1.2.1set pfs group2 # æŒ‡å®š DH ç®—æ³•å’Œç»„æ ‡è¯†ç¬¦ 2 å¯¹åº”çš„å‚æ•°, é‡æ–°å»ºç«‹å®‰å…¨å…³è”æ—¶ä½¿ç”¨ DH ç®—æ³•äº¤æ¢åŒæ­¥å¯†é’¥ï¼Œå¹¶ä½¿ç”¨ç»„æ ‡è¯†ç¬¦ 2 å¯¹åº”çš„å‚æ•°é‡æ–°å»ºç«‹å®‰å…¨å…³è”# æŒ‡å®šå®‰å…¨å…³è”çš„å¤±æ•ˆæ—¶é—´set security-association lifetime seconds 900# æŒ‡å®šå®‰å…¨å…³è”ä½¿ç”¨çš„å®‰å…¨åè®®åŠåŠ å¯†ï¼ŒHMACç®—æ³•çš„å˜æ¢é›†ä¸º tunnelset transform-set tunnel# æŒ‡å®šç»è¿‡å®‰å…¨å…³è”ä¼ è¾“çš„ IP åˆ†ç»„é›†ä¸º 101 åˆ†ç»„è¿‡æ»¤å™¨match address 101<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="1-å®‰å…¨ç­–ç•¥é…ç½®"><a class="markdownIt-Anchor" href="#1-å®‰å…¨ç­–ç•¥é…ç½®"></a> 1ã€å®‰å…¨ç­–ç•¥é…ç½®</h2><p>éš§é“ä¸¤ç«¯éƒ½éœ€è¦å®Œæˆç›¸åº”çš„ ISAKMP å®‰å…¨ç­–ç•¥é…ç½®è¿‡ç¨‹ï¼ŒåŒ…æ‹¬å®‰å…¨é€šé“ä¼ è¾“æ‰€ä½¿ç”¨çš„åŠ å¯†ç®—æ³•ï¼ŒæŠ¥æ–‡æ‘˜è¦ç®—æ³•ï¼Œå…±äº«ç§˜é’¥é‰´åˆ«æœºåˆ¶å’Œ DH ç»„å·ã€‚</p><p>éš§é“æ¯ä¸€ç«¯å¯ä»¥é…ç½®å¤šä¸ªå®‰å…¨ ç­–ç•¥ï¼Œä½†ä¸¤ç«¯å¿…é¡»å­˜åœ¨åŒ¹é…çš„å®‰å…¨ç­–ç•¥</p><p><strong>Router 1</strong>ï¼šR1 ä¸Šå®šä¹‰ç¼–å·ä¸º 1 ä¼˜å…ˆçº§æœ€é«˜çš„å®‰å…¨ç­–ç•¥ï¼Œèº«ä»½é‰´åˆ«æœºåˆ¶é‡‡ç”¨å…±äº«ç§˜é’¥é‰´åˆ«æœºåˆ¶ï¼ŒåŠ å¯†ç®—æ³•é‡‡ç”¨ 3desï¼Œhash é‡‡ç”¨ md5ï¼ŒDH ç§˜é’¥äº¤æ¢ç®—æ³•</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20211020083237656.png" alt="image-20211020083237656" /></p><p><strong>Route 2</strong>ï¼šåŒ¹é… Tunnel 1 çš„ R1 ç«¯ï¼Œé‡‡ç”¨ç›¸åŒçš„å®‰å…¨ç­–ç•¥å³å¯</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20211020084427570.png" alt="image-20211020084427570" /></p><p><strong>Route 3</strong>ï¼šåŒ¹é… Tunnel 2 çš„ R1 ç«¯ï¼Œä¸ Tunnel 3 çš„ R2 ç«¯ï¼Œé‡‡ç”¨ç›¸åŒçš„å®‰å…¨ç­–ç•¥å³å¯</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20211020084337530.png" alt="image-20211020084337530" /></p><h2 id="2-å˜æ¢é›†é…ç½®"><a class="markdownIt-Anchor" href="#2-å˜æ¢é›†é…ç½®"></a> 2ã€å˜æ¢é›†é…ç½®</h2><p>IPSec å‚æ•°é…ç½®ï¼šè¿™å±äºé˜¶æ®µäºŒä¸­å®‰å…¨å…³è”ç›¸å…³é…ç½®è¿‡ç¨‹</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">crypto ipsec transform-set tunnel esp-3des esp-md5-hmac<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="3-åˆ†ç»„è¿‡æ»¤å™¨é…ç½®"><a class="markdownIt-Anchor" href="#3-åˆ†ç»„è¿‡æ»¤å™¨é…ç½®"></a> 3ã€åˆ†ç»„è¿‡æ»¤å™¨é…ç½®</h2><p>æŒ‡å®šä¸¤ç«¯éœ€è¦è¿›è¡Œå®‰å…¨ä¼ è¾“çš„ IP åˆ†ç»„èŒƒå›´</p><p>R1ï¼šé…ç½® Tunnel 1 ä¸ Tunnel 2 çš„æºç«¯ IP ä¸ ç›®çš„ç«¯ IP</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"># tunnel 1access-list 101 permit gre host 192.1.1.1 host 192.1.2.1access-list 101 deny ip any any# tunnel 2access-list 102 permit gre host 192.1.1.1 host 192.1.3.1access-list 102 deny ip any any<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>R2ï¼šé…ç½® Tunnel 1 ä¸ Tunnel 3 çš„æºç«¯ IP ä¸ ç›®çš„ç«¯ IP</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"># tunnel 1access-list 101 permit gre host 192.1.2.1 host 192.1.1.1access-list 101 deny ip any any# tunnel 3access-list 102 permit gre host 192.1.2.1 host 192.1.3.1access-list 102 deny ip any any<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>R3ï¼šé…ç½® Tunnel 2 ä¸ Tunnel 3 çš„æºç«¯ IP ä¸ ç›®çš„ç«¯ IP</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"># tunnel 2access-list 101 permit gre host 192.1.3.1 host 192.1.1.1access-list 101 deny ip any any# tunnel 3access-list 102 permit gre host 192.1.3.1 host 192.1.2.1access-list 102 deny ip any any<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="4-åŠ å¯†æ˜ å°„é…ç½®"><a class="markdownIt-Anchor" href="#4-åŠ å¯†æ˜ å°„é…ç½®"></a> 4ã€åŠ å¯†æ˜ å°„é…ç½®</h2><p>å°†åˆ†ç»„è¿‡æ»¤å™¨ä¸å˜æ¢é›†é…ç½®é€‰é¡¹ç»‘å®šè‡³åŠ å¯†æ˜ å°„ä¸­</p><p>R1ï¼šéœ€è¦é…ç½® Tunnel 1 ä¸ Tunnel 2 çš„åŠ å¯†æ˜ å°„</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20211020091651843.png" alt="image-20211020091651843" /></p><p>R2ï¼šéœ€è¦é…ç½® Tunnel 1 ä¸ Tunnel 3 çš„åŠ å¯†æ˜ å°„</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20211020091911504.png" alt="image-20211020091911504" /></p><p>R3ï¼šéœ€è¦é…ç½® Tunnel 2 ä¸ Tunnel 3 çš„åŠ å¯†æ˜ å°„</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20211020092049086.png" alt="image-20211020092049086" /></p><h2 id="5-ç»‘å®šæ¥å£"><a class="markdownIt-Anchor" href="#5-ç»‘å®šæ¥å£"></a> 5ã€ç»‘å®šæ¥å£</h2><p>å°†é…ç½®å¥½çš„åŠ å¯†æ˜ å°„ä½œç”¨åˆ°è·¯ç”±å™¨ç›®æ ‡æ¥å£ä¸Š</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">interface FastEthernet 0&#x2F;1crypto map tunnel <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="6-æµ‹è¯•"><a class="markdownIt-Anchor" href="#6-æµ‹è¯•"></a> 6ã€æµ‹è¯•</h2><p>ä½¿ç”¨ PC0 ping PC4 <code>192.168.3.1</code></p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20211020093157410.png" alt="image-20211020093157410" /></p><p>é¦–å…ˆèƒ½å¤Ÿçœ‹åˆ°åˆå§‹çš„å†…å±‚ IP åˆ†ç»„ï¼š</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20211020092955818.png" alt="image-20211020092955818" /></p><p>éšåèƒ½å¤Ÿçœ‹åˆ° R1 å°†åŸå§‹ IP åˆ†ç»„å°è£…åçš„æŠ¥æ–‡ï¼šå†…éƒ¨çš„ä¿¡æ¯ï¼ˆç§æœ‰åœ°å€ï¼‰å·²ç„¶çœ‹ä¸åˆ°äº†</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20211020093116200.png" alt="image-20211020093116200" /></p><p>ç„¶åè¯¥æŠ¥æ–‡åœ¨å…¬ç½‘ä¸Šå®‰å…¨åŠ å¯†ä¼ è¾“ï¼š</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20211020093245915.png" alt="image-20211020093245915" /></p><p>ç›´åˆ° R3 å¼€å§‹è§£å¼€å¤–éƒ¨ IP æŠ¥æ–‡ï¼Œè§£å¯†è·å–äº†å†…éƒ¨ IP åˆ†ç»„ï¼Œæ•…è€Œç»§ç»­åœ¨ç§ç½‘ä¸Šä¼ è¾“</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20211020093419574.png" alt="image-20211020093419574" /></p>]]></content>
      
      
      <categories>
          
          <category> Protocol Security </category>
          
      </categories>
      
      
        <tags>
            
            <tag> security </tag>
            
            <tag> experiment </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MAC Spoofing and Vlan Defense</title>
      <link href="/Coming-blog/2021/10/10/mac-spoofing-and-vlan-defense/"/>
      <url>/Coming-blog/2021/10/10/mac-spoofing-and-vlan-defense/</url>
      
        <content type="html"><![CDATA[<h1 id="prepare"><a class="markdownIt-Anchor" href="#prepare"></a> Prepare</h1><p><strong>Packet Tracer</strong>ï¼š<a target="_blank" rel="noopener" href="https://www.netacad.com/courses/packet-tracer/introduction-packet-tracer">å®˜ç½‘</a>å®Œæˆæ³¨å†Œåä¸‹è½½å³å¯</p><h1 id="mac-æ¬ºéª—"><a class="markdownIt-Anchor" href="#mac-æ¬ºéª—"></a> MAC æ¬ºéª—</h1><h2 id="1-æ­å»ºç½‘ç»œç»“æ„"><a class="markdownIt-Anchor" href="#1-æ­å»ºç½‘ç»œç»“æ„"></a> 1ã€æ­å»ºç½‘ç»œç»“æ„</h2><p>éœ€è¦æ³¨æ„ PC ä¸äº¤æ¢æœºä¹‹é—´é‡‡ç”¨<strong>ç›´é€šçº¿</strong>äº’è¿ï¼Œäº¤æ¢æœºä¸äº¤æ¢æœºä¹‹é—´é‡‡ç”¨<strong>äº¤å‰çº¿</strong>äº’è¿</p><blockquote><p>ç›´é€šçº¿ï¼šä¸€èˆ¬è¿æ¥ä¸åŒçš„è®¾å¤‡</p><p>äº¤å‰çº¿ï¼šä¸€èˆ¬ç”¨äºç›¸åŒè®¾å¤‡çš„è¿æ¥</p></blockquote><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20211009160503527.png" alt="image-20211009160503527" /></p><h2 id="2-é…ç½®-ip"><a class="markdownIt-Anchor" href="#2-é…ç½®-ip"></a> 2ã€é…ç½® IP</h2><p>ç‚¹å‡»ç›®æ ‡ PC ï¼Œåœ¨ Config - FastEthernet0 ä¸­é…ç½®é™æ€ IP åœ°å€</p><table><thead><tr><th>Host</th><th>IP</th><th>MAC</th></tr></thead><tbody><tr><td>PC0</td><td>192.168.1.10</td><td>0090.0CB0.55B6</td></tr><tr><td>PC1</td><td>192.168.1.11</td><td>0002.1625.5207</td></tr><tr><td>PC2</td><td>192.168.1.12</td><td>0006.2A16.0A3C</td></tr></tbody></table><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20211009160855791.png" alt="image-20211009160855791" /></p><h2 id="3-æµ‹è¯•"><a class="markdownIt-Anchor" href="#3-æµ‹è¯•"></a> 3ã€æµ‹è¯•</h2><p>ä½¿ç”¨ ICMP æŠ¥æ–‡ï¼ˆpingï¼‰å®Œæˆ PC0,1,2 ä¹‹é—´çš„é€šä¿¡æµ‹è¯•</p><p>ç‚¹å‡» PC0 åœ¨ Desktop - Command Prompt ä¸­è¾“å…¥ ping å‘½ä»¤å³å¯</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20211009161413510.png" alt="image-20211009161413510" /></p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20211009161841196.png" alt="image-20211009161841196" /></p><h2 id="4-æŸ¥çœ‹æ­£ç¡®çš„è½¬å‘è¡¨"><a class="markdownIt-Anchor" href="#4-æŸ¥çœ‹æ­£ç¡®çš„è½¬å‘è¡¨"></a> 4ã€æŸ¥çœ‹æ­£ç¡®çš„è½¬å‘è¡¨</h2><p>Tipsï¼šæ¯å° PC éƒ½è¦å¯¹å…¶å®ƒ PC è¿›è¡Œä¸€æ¬¡æˆåŠŸçš„ ping æ“ä½œæ‰èƒ½å¾—åˆ°å®Œæ•´çš„è½¬å‘è¡¨ï¼›</p><p>äº¤æ¢æœºè½¬å‘è¡¨æŸ¥çœ‹æ–¹å¼ï¼š</p><p>aã€ç‚¹å‡»ç›®æ ‡äº¤æ¢æœºè¿›å…¥ CLI çª—å£</p><p>bã€çª—å£ä¸­ä¸€ç›´è¾“å…¥ <code>exit</code> å‘½ä»¤ï¼ˆå°ç™½åšæ³•ï¼‰ç›´åˆ°åˆ°è¾¾ç”¨æˆ·æ¨¡å¼ï¼ˆ<code>Swtich&gt;</code>ï¼‰</p><p>cã€è¾“å…¥ <code>enable</code> è¿›å…¥ç‰¹æƒæ¨¡å¼</p><p>dã€è¾“å…¥ <code>show mac-address-table</code></p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20211009162900224.png" alt="image-20211009162900224" /></p><h2 id="5-æ¨¡æ‹Ÿæ“ä½œæ¨¡å¼æŸ¥çœ‹æ­£å¸¸é€šä¿¡è¿‡ç¨‹"><a class="markdownIt-Anchor" href="#5-æ¨¡æ‹Ÿæ“ä½œæ¨¡å¼æŸ¥çœ‹æ­£å¸¸é€šä¿¡è¿‡ç¨‹"></a> 5ã€æ¨¡æ‹Ÿæ“ä½œæ¨¡å¼æŸ¥çœ‹æ­£å¸¸é€šä¿¡è¿‡ç¨‹</h2><p>aã€ç‚¹å‡»å³ä¸‹è§’çš„ simulation è¿›å…¥æ¨¡æ‹Ÿæ“ä½œæ¨¡å¼</p><p>bã€ç‚¹å‡» Edit Filters é…ç½®å¥½è¿‡æ»¤å™¨ï¼Œä½¿å¾—èƒ½å¤Ÿæ£€æµ‹åˆ° ICMP æŠ¥æ–‡çš„è½¬å‘è¿‡ç¨‹</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20211009164036277.png" alt="image-20211009164036277" /></p><p>cã€ä½¿ç”¨ PC1 ping PC0 æŸ¥çœ‹è¿‡ç¨‹åŠ¨ç”»</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20211009164047994.png" alt="image-20211009164047994" /></p><h2 id="6-mac-æ¬ºéª—"><a class="markdownIt-Anchor" href="#6-mac-æ¬ºéª—"></a> 6ã€MAC æ¬ºéª—</h2><p>åˆ‡æ¢å›å®æ—¶æ“ä½œæ¨¡å¼ï¼Œå°† PC2 çš„ MAC åœ°å€æ›´æ”¹ä¸º PC0 çš„ MAC åœ°å€</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20211009165759568.png" alt="image-20211009165759568" /></p><h2 id="7-é€šä¿¡æ¬ºéª—"><a class="markdownIt-Anchor" href="#7-é€šä¿¡æ¬ºéª—"></a> 7ã€é€šä¿¡æ¬ºéª—</h2><p>ä½¿ç”¨ PC2 å¯¹ PC1é€šä¿¡åæŸ¥çœ‹è½¬å‘è¡¨ä¿¡æ¯ï¼šå¯ä»¥çœ‹åˆ° PC2 æˆåŠŸä¼ªé€ äº† PC0 çš„èº«ä»½ï¼Œæ¬ºéª—äº†å„ä¸ªäº¤æ¢æœºï¼šSwitch0 è®¤ä¸º 0090â€¦. åº”è¯¥èµ°ç«¯å£ 3 å»æ‰¾ Switch 1ï¼ŒSwitch 1 è®¤ä¸º 0090 åº”è¯¥èµ°ç«¯å£ 2 å»æ‰¾ Switch 2ï¼ŒSwitch 2 è®¤ä¸º 0090â€¦. åº”è¯¥èµ°ç«¯å£ 1 ï¼Œå³æ‰¾ PC2</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20211009170222140.png" alt="image-20211009170222140" /></p><h2 id="8-æ¨¡æ‹Ÿ-pc1-ä¸-pc0-çš„é€šä¿¡"><a class="markdownIt-Anchor" href="#8-æ¨¡æ‹Ÿ-pc1-ä¸-pc0-çš„é€šä¿¡"></a> 8ã€æ¨¡æ‹Ÿ PC1 ä¸ PC0 çš„é€šä¿¡</h2><p>åˆ‡æ¢åˆ°æ¨¡æ‹Ÿæ“ä½œæ¨¡å¼ï¼š</p><p>aã€PC1 ping PC0 çš„ IP åœ°å€</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20211009170655929.png" alt="image-20211009170655929" /></p><p>bã€æŸ¥çœ‹åŠ¨ç”»ï¼Œå‘ç° PC2 æ¬ºéª—æˆåŠŸ</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20211009170826102.png" alt="image-20211009170826102" /></p><h1 id="vlan-é˜²-mac-æ¬ºéª—"><a class="markdownIt-Anchor" href="#vlan-é˜²-mac-æ¬ºéª—"></a> VLAN é˜² MAC æ¬ºéª—</h1><p>Targetï¼šé€šè¿‡ VLAN çš„åˆ’åˆ†ï¼Œéš”ç¦»æ”»å‡»è€… PC2 ä¸ PC1ï¼Œä½¿å¾— PC2 æ— æ³•å†’å……â€å‹å†›â€œ</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20211009171601483.png" alt="image-20211009171601483" /></p><h2 id="1-æ·»åŠ -vlan"><a class="markdownIt-Anchor" href="#1-æ·»åŠ -vlan"></a> 1ã€æ·»åŠ  VLAN</h2><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">Switch&gt;enable# è¿›å…¥ç‰¹æƒæ¨¡å¼Switch\# configure terminal # è¿›å…¥å…¨å±€é…ç½®æ¨¡å¼Enter configuration commands, one per line.  End with CNTL&#x2F;Z.Switch(config)\#vlan 2# åˆ›å»ºvlanï¼ˆid&#x3D;2ï¼‰å¹¶è¿›å…¥å…¶é…ç½®æ¨¡å¼Switch(config-vlan)\#name vlan2 # å¯¹è¯¥ vlan å®šä¹‰ä¸€ä¸ªåç§°<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="2-åˆ†é…æ¥å…¥ç«¯å£"><a class="markdownIt-Anchor" href="#2-åˆ†é…æ¥å…¥ç«¯å£"></a> 2ã€åˆ†é…æ¥å…¥ç«¯å£</h2><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">Switch\#configure terminal Enter configuration commands, one per line.  End with CNTL&#x2F;Z.# è¿›å…¥ 1 å·ç«¯å£çš„é…ç½®æ¨¡å¼Switch(config)\#interface FastEthernet 0&#x2F;1# å°†è¯¥ç«¯å£æŒ‡å®šä¸ºæ¥å…¥ç«¯å£Switch(config-if)\#switchport mode access # å°†è¯¥æ¥å…¥ç«¯å£åˆ†é…ç»™ vlan 2Switch(config-if)\#switchport access vlan 2Switch(config-if)\#exit# å›åˆ°å…¨å±€é…ç½®æ¨¡å¼# åŒç†é…ç½® 2 å·ç«¯å£ï¼Œå¹¶åˆ†ç»™ç»™ vlan 2Switch(config)\#interface FastEthernet 0&#x2F;2Switch(config-if)\#switchport mode access Switch(config-if)\#switchport access vlan 2<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="3-æŸ¥çœ‹é…ç½®ç»“æœ"><a class="markdownIt-Anchor" href="#3-æŸ¥çœ‹é…ç½®ç»“æœ"></a> 3ã€æŸ¥çœ‹é…ç½®ç»“æœ</h2><p>åœ¨ç‰¹æƒæ¨¡å¼ä¸‹è¾“å…¥å‘½ä»¤ <code>show running-config</code></p><p>å¯ä»¥æŸ¥çœ‹åˆ° 1 å·ç«¯å£å’Œ 2 å·ç«¯å£å‡åˆ†é…ç»™äº† VLAN 2</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20211009172655898.png" alt="image-20211009172655898" /></p><h2 id="4-æ£€éªŒç»“æœ"><a class="markdownIt-Anchor" href="#4-æ£€éªŒç»“æœ"></a> 4ã€æ£€éªŒç»“æœ</h2><p>aã€å½“å‰çŠ¶æ€ Switch è½¬å‘è¡¨ é—å¿˜äº†ä¹‹å‰çš„ä¿¡æ¯ï¼Œæ”»å‡»è€… PC2 æœ‰æœºå¯ä¹˜</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20211009172940185.png" alt="image-20211009172940185" /></p><blockquote><p>è¯¥ mac-address æ˜¯ Switch 0 ä¸ Switch 1 ä¹‹é—´çš„</p></blockquote><p>bã€PC2 ä½¿ç”¨ PC0 çš„ MAC åœ°å€ï¼Œping PC1ï¼Œå¯ä»¥çœ‹å‡ºåˆ°è¾¾ Switch 0 åï¼Œå› ä¸ºä¸å±äºä¸€ä¸ª VLAN åŒ…å°±è¢«ä¸¢å¼ƒäº†ã€‚æ¬ºéª—å¤±è´¥ï¼</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20211009173426989.png" alt="image-20211009173426989" /></p><p>cã€åœ¨æ£€æµ‹ä¸‹ PC0 èƒ½å¦ä¸ PC1 æ­£å¸¸é€šä¿¡ï¼šé€šä¿¡æˆåŠŸ</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20211009173638696.png" alt="image-20211009173638696" /></p>]]></content>
      
      
      <categories>
          
          <category> Protocol Security </category>
          
      </categories>
      
      
        <tags>
            
            <tag> security </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ARP Attack Experiment</title>
      <link href="/Coming-blog/2021/09/25/arp-attack-experiment/"/>
      <url>/Coming-blog/2021/09/25/arp-attack-experiment/</url>
      
        <content type="html"><![CDATA[<h1 id="tools"><a class="markdownIt-Anchor" href="#tools"></a> Tools</h1><h2 id="cain-winpcap"><a class="markdownIt-Anchor" href="#cain-winpcap"></a> Cain &amp; WinPcap</h2><p><strong>Version</strong>: 4.9</p><p><strong>Download</strong>: <a target="_blank" rel="noopener" href="http://www.pc0359.cn/downinfo/79463.html">http://www.pc0359.cn/downinfo/79463.html</a></p><p><strong>Tips</strong>: Cain å·¥å…·ä¾èµ–äº WinPcapï¼Œä½¿ç”¨ Cain æ—¶éœ€è¦ç»™ä¸ç®¡ç†å‘˜æƒé™</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20210924193818343.png" alt="image-20210924193818343" /></p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20210924193834801.png" alt="image-20210924193834801" style="zoom:50%;" /><h2 id="wireshark"><a class="markdownIt-Anchor" href="#wireshark"></a> Wireshark</h2><p>å®˜ç½‘ä¸‹è½½å³å¯ <a target="_blank" rel="noopener" href="http://www.wireshark.org/">http://www.wireshark.org</a></p><h1 id="iåŒä¸€å±€åŸŸç½‘å†…çš„-arp-æ¬ºéª—"><a class="markdownIt-Anchor" href="#iåŒä¸€å±€åŸŸç½‘å†…çš„-arp-æ¬ºéª—"></a> â… åŒä¸€å±€åŸŸç½‘å†…çš„ ARP æ¬ºéª—</h1><h2 id="0-prepare"><a class="markdownIt-Anchor" href="#0-prepare"></a> 0 Prepare</h2><table><thead><tr><th>ä¸»æœº</th><th>OS</th><th>MAC</th></tr></thead><tbody><tr><td>Perpetrator A</td><td>Windows_7_sp1_x64</td><td>00-0C-29-30-A8-BD</td></tr><tr><td>User B</td><td>Windows_xp_professional_x86</td><td>00-0C-29-F0-B1-3A</td></tr><tr><td>Server C</td><td>Windows_2008_r2</td><td>00-0C-29-6B-91-F5</td></tr></tbody></table><h2 id="1-åˆå§‹åŒ–å„ä¸ªä¸»æœº"><a class="markdownIt-Anchor" href="#1-åˆå§‹åŒ–å„ä¸ªä¸»æœº"></a> 1 åˆå§‹åŒ–å„ä¸ªä¸»æœº</h2><p>å°† Aï¼ŒBï¼ŒC ä¸‰å°ä¸»æœºæ”¾åˆ° VMnet 3 äº¤æ¢æœºä¸­ï¼ˆç½‘å…³ç»Ÿä¸€è®¾ç½®ä¸º 10.1.1.1ï¼‰,æœ€åä½¿ç”¨ ping å‘½ä»¤ä¿è¯ A ä¸ B ä¸ C ä¹‹é—´çš„äº’ç›¸è¿é€š</p><table><thead><tr><th>ä¸»æœº</th><th>IP</th></tr></thead><tbody><tr><td>A</td><td>10.1.1.10</td></tr><tr><td>B</td><td>10.1.1.11</td></tr><tr><td>C</td><td>10.1.1.12</td></tr></tbody></table><h2 id="2-åˆå§‹åŒ–-cain-å—…æ¢å™¨"><a class="markdownIt-Anchor" href="#2-åˆå§‹åŒ–-cain-å—…æ¢å™¨"></a> 2 åˆå§‹åŒ– Cain å—…æ¢å™¨</h2><p>æ‰“å¼€ Cain å·¥å…·ï¼Œå•å‡»å·¥å…·æ ä¸­çš„é…ç½®ï¼Œå¯¹å—…æ¢å™¨è¿›è¡Œé…ç½®ï¼Œé€‰æ‹© IP åœ°å€ä¸ç½‘å…³ IP å¯¹åº”çš„é€‚é…å™¨å³å¯</p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20210924202538785.png" alt="image-20210924202538785" style="zoom:50%;" /><h2 id="3-å¼€å§‹å—…æ¢-æ‰«æ-mac"><a class="markdownIt-Anchor" href="#3-å¼€å§‹å—…æ¢-æ‰«æ-mac"></a> 3 å¼€å§‹å—…æ¢ - æ‰«æ MAC</h2><p>åœ¨ä¸»ç•Œé¢ - å—…æ¢å™¨ - ä¸»æœºä¸­ï¼Œç‚¹å‡»å·¦ä¾§ç¬¬äºŒä¸ªæŒ‰é’® å¼€å§‹/åœæ­¢å—…æ¢åï¼Œåœ¨ç©ºç™½å¤„å³å‡»å³å¯é€‰æ‹©å¼€å§‹æ‰«æ MAC</p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20210924202746250.png" alt="image-20210924202746250" style="zoom:50%;" /><p>å¯ä»¥çœ‹å‡ºï¼Œæˆ‘ä»¬æ‰«åˆ°äº† User B ä¸ Service C ï¼</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20210924202830077.png" alt="image-20210924202830077" /></p><h2 id="4-å‡†å¤‡æ”»å‡»"><a class="markdownIt-Anchor" href="#4-å‡†å¤‡æ”»å‡»"></a> 4 å‡†å¤‡æ”»å‡»</h2><p>åœ¨ä¸»ç•Œé¢ - å—…æ¢å™¨ - ARP å¤„ï¼Œå•å‡»å·¥å…·æ ä¸­çš„ åŠ å·æŒ‰é’®ï¼Œæ·»åŠ  User B åˆ° Service C çš„ ARP æ¬ºéª—</p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20210924203217137.png" alt="image-20210924203217137" style="zoom:50%;" /><p>æ”»å‡»å‰å…ˆæŸ¥çœ‹ User B ä¸ Service C çš„ ARP ç¼“å­˜ä¿¡æ¯ï¼ˆä¹‹å‰ ping å‘½ä»¤è·å–çš„ï¼‰</p><p>User B çš„ ARP ç¼“å­˜ä¿¡æ¯ï¼šå¯ä»¥çœ‹å‡ºå…¶æ­£ç¡®çš„è®°å½•äº† Service C çš„ MAC åœ°å€</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20210924203404086.png" alt="image-20210924203404086" /></p><p>Service C çš„ ARP ç¼“å­˜ä¿¡æ¯ï¼šå¯ä»¥çœ‹å‡ºå…¶æ­£ç¡®çš„è®°å½•äº† User B çš„ MAC åœ°å€</p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20210924203459563.png" alt="image-20210924203459563" style="zoom:50%;" /><h2 id="5-å¼€å¯æ”»å‡»"><a class="markdownIt-Anchor" href="#5-å¼€å¯æ”»å‡»"></a> 5 å¼€å¯æ”»å‡»</h2><p>å¼€å§‹æ”»å‡»ï¼ç‚¹å‡»å¼€å§‹/åœæ­¢ ARP æ”»å‡»æŒ‰é’®</p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20210924203559237.png" alt="image-20210924203559237" style="zoom:50%;" /><h2 id="6-æ”»å‡»æˆåŠŸ"><a class="markdownIt-Anchor" href="#6-æ”»å‡»æˆåŠŸ"></a> 6 æ”»å‡»æˆåŠŸ</h2><p>å†æ¬¡æŸ¥çœ‹ User B ä¸ Service C çš„ ARP ç¼“å­˜ä¿¡æ¯</p><p>User B çš„ ARP ç¼“å­˜ä¿¡æ¯ï¼šå¯ä»¥çœ‹å‡º Perpetrator A æˆåŠŸæ¬ºéª—äº† User B å°† Service C çš„ MAC åœ°å€æ”¹ä¸ºäº†è‡ªèº«çš„ MAC åœ°å€</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20210924204046638.png" alt="image-20210924204046638" /></p><p>Service C çš„ ARP ç¼“å­˜ä¿¡æ¯ï¼šå¯ä»¥çœ‹å‡º Perpetrator A æˆåŠŸæ¬ºéª—äº† Service C å°† User B çš„ MAC åœ°å€æ”¹ä¸ºäº†è‡ªèº«çš„ MAC åœ°å€</p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20210924204103319.png" alt="image-20210924204103319" style="zoom:50%;" /><h1 id="iiæ¬ºéª—åç›‘å¬é€šä¿¡"><a class="markdownIt-Anchor" href="#iiæ¬ºéª—åç›‘å¬é€šä¿¡"></a> â…¡æ¬ºéª—åç›‘å¬é€šä¿¡</h1><h2 id="0-prepare-2"><a class="markdownIt-Anchor" href="#0-prepare-2"></a> 0 Prepare</h2><table><thead><tr><th>ä¸»æœº</th><th>OS</th><th>MAC</th><th>IP</th></tr></thead><tbody><tr><td>Perpetrator A</td><td>Windows_7_sp1_x64</td><td>00-0C-29-30-A8-BD</td><td>10.1.1.10</td></tr><tr><td>User B</td><td>Windows_xp_professional_x86</td><td>00-0C-29-F0-B1-3A</td><td>10.1.1.11</td></tr><tr><td>Server C</td><td>Windows_2008_r2</td><td>00-0C-29-6B-91-F5</td><td>10.1.1.12</td></tr></tbody></table><p>ä¸ºäº†æ–¹ä¾¿ç›‘å¬ï¼Œåœ¨ Service C ä¸Šå¼€å¯ IIS ä¸ DNS æœåŠ¡ï¼Œå¼€å¯ç½‘ç«™ <a target="_blank" rel="noopener" href="http://www.flower.com">www.flower.com</a></p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20210924210219293.png" alt="image-20210924210219293" /></p><p>è®¾å®šå¥½ DNSï¼Œå¹¶å°† User B çš„ é»˜è®¤ DNS æŒ‡å‘ä¸º Service C</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20210924210358844.png" alt="image-20210924210358844" /></p><p>éªŒè¯</p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20210924210523600.png" alt="image-20210924210523600" style="zoom:50%;" /><h2 id="1-åˆå§‹åŒ–-wireshark"><a class="markdownIt-Anchor" href="#1-åˆå§‹åŒ–-wireshark"></a> 1 åˆå§‹åŒ– Wireshark</h2><p>æŒ‰ç…§åŒä¸€å±€åŸŸç½‘å†…çš„ ARP æ¬ºéª—æ­¥éª¤å®Œæˆ ARP æ¬ºéª—åï¼Œå¼€å¯ Wiresharkï¼Œç›‘å¬æºIP ä¸º User B æˆ– Service C çš„åŒ…</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20210924210724905.png" alt="image-20210924210724905" /></p><h2 id="2-æŸ¥çœ‹ç›‘å¬ç»“æœ"><a class="markdownIt-Anchor" href="#2-æŸ¥çœ‹ç›‘å¬ç»“æœ"></a> 2 æŸ¥çœ‹ç›‘å¬ç»“æœ</h2><p>ä½¿ç”¨ User B è®¿é—® <a target="_blank" rel="noopener" href="http://www.flower.com">www.flower.com</a>ï¼Œé¦–å…ˆåº”è¯¥çœ‹åˆ°çš„æ˜¯ 10.1.1.11 ä¸ 10.1.1.12 çš„ DNS ç›¸å…³è¯·æ±‚ï¼Œå¯ä»¥è·å– User B çš„è®¿é—®åŸŸåï¼š</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20210924211232666.png" alt="image-20210924211232666" /></p><p>Tipsï¼šå¯ä»¥çœ‹åˆ°ä¸­é—´äººå°†æ”¶åˆ°çš„åŒ…çœ‹äº†ä¸€çœ¼åè½¬å‘åˆ°äº†æ­£ç¡®çš„åœ°å€ï¼Œä½¿å¾— User B æ­£å¸¸è®¿é—® <a target="_blank" rel="noopener" href="http://www.flower.com">www.flower.com</a></p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20210924211330279.png" alt="image-20210924211330279" style="zoom:50%;" /><p>éšåå°±æ˜¯ TCP ä¸‰æ¬¡æ¡æ‰‹ï¼š</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20210924211425093.png" alt="image-20210924211425093" /></p><p>ç„¶åæ˜¯ HTTPï¼š</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20210924211559686.png" alt="image-20210924211559686" /></p><h2 id="3-å°è¯•è·å–é‡è¦ä¿¡æ¯"><a class="markdownIt-Anchor" href="#3-å°è¯•è·å–é‡è¦ä¿¡æ¯"></a> 3 å°è¯•è·å–é‡è¦ä¿¡æ¯</h2><p>æ¥ä¸‹æ¥æˆ‘å°è¯•ä½¿ç”¨ GET ä¼ é€ä¸€äº›å‚æ•°è¿›å»ï¼Œçœ‹çœ‹æ˜¯å¦èƒ½å¤Ÿè·å–åˆ°å‘¢ï¼Ÿ</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20210924211753656.png" alt="image-20210924211753656" /></p><p>æŸ¥çœ‹æŠ“åŒ…è¯¦ç»†ç»“æœï¼šå› ä¸º DNS ç¼“å­˜çš„åŸå› ï¼Œè¿™æ¬¡æ²¡æœ‰ DNS çš„ç›¸å…³æŠ“åŒ…ä¿¡æ¯</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20210924211857375.png" alt="image-20210924211857375" /></p><p>å¯ä»¥çœ‹å‡ºï¼ŒGET è¯·æ±‚ä¸­çš„å‚æ•°å°†ä¼šè¢«å®Œå…¨è½»æ¾çš„è·å–åˆ°ï¼š</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20210924212025745.png" alt="image-20210924212025745" /></p><h1 id="iii-æ¬ºéª—ç½‘å…³ä¹‹ä¸åŒå±€åŸŸç½‘çš„æ¬ºéª—"><a class="markdownIt-Anchor" href="#iii-æ¬ºéª—ç½‘å…³ä¹‹ä¸åŒå±€åŸŸç½‘çš„æ¬ºéª—"></a> â…¢ æ¬ºéª—ç½‘å…³ä¹‹ä¸åŒå±€åŸŸç½‘çš„æ¬ºéª—</h1><table><thead><tr><th>ä¸»æœº</th><th>OS</th><th>MAC åœ°å€</th><th>IP</th></tr></thead><tbody><tr><td>Perpetrator A</td><td>Kail Linux 2021.2</td><td>00-0c-29-0c-b9-d0</td><td>192.168.1.111</td></tr><tr><td>User B</td><td>Windows_xp_professional_x86</td><td>00-0C-29-F0-B1-3A</td><td>192.168.1.109</td></tr><tr><td>è·¯ç”±å™¨ (ç½‘å…³) C</td><td>-</td><td>88-25-93-27-8B-EE</td><td>192.168.1.1</td></tr></tbody></table><p><strong>Target</strong>ï¼šä½¿ç”¨ Perpetrator A æ¬ºéª— User B ä¸ è·¯ç”±å™¨</p><p><strong>Tips</strong>ï¼š</p><p>&amp; ä¸ºäº†æ–¹ä¾¿å®éªŒï¼Œæ­¤æ—¶å°† Perpetrator A ç³»ç»Ÿæ›´ä¸º Kail Linux 2021.2</p><p>&amp; æ‰€æœ‰è®¾å¤‡éƒ½å¤„äºæ¡¥æ¥çŠ¶æ€ï¼Œæ¡¥æ¥æ¨¡å¼ä¸­ VMWare è™šæ‹Ÿå‡ºæ¥çš„æ“ä½œç³»ç»Ÿå°±åƒæ˜¯å±€åŸŸç½‘ä¸­çš„ä¸€å°ç‹¬ç«‹çš„ä¸»æœºï¼ˆä¸»æœºå’Œè™šæ‹Ÿæœºå¤„äºå¯¹ç­‰åœ°ä½ï¼‰</p><h2 id="1-åˆå§‹åŒ–å„ä¸ªä¸»æœº-2"><a class="markdownIt-Anchor" href="#1-åˆå§‹åŒ–å„ä¸ªä¸»æœº-2"></a> 1 åˆå§‹åŒ–å„ä¸ªä¸»æœº</h2><p>å°† Perpetrator A ä¸ User B æ¡¥æ¥è‡³è·¯ç”±å™¨ä¸­</p><p>å¾—åˆ° Perpetrator A IP ä¸º 192.168.1.111ï¼Œç½‘å…³ä¸º 192.168.1.1</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20210925194951365.png" alt="image-20210925194951365" /></p><p>å¾—åˆ° User B çš„ IP ä¸º 192.168.1.109ï¼Œç½‘å…³ä¸º 192.168.1.1</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20210925131922146.png" alt="image-20210925131922146" /></p><h2 id="2-æŸ¥çœ‹æ”»å‡»å‰çŠ¶æ€"><a class="markdownIt-Anchor" href="#2-æŸ¥çœ‹æ”»å‡»å‰çŠ¶æ€"></a> 2 æŸ¥çœ‹æ”»å‡»å‰çŠ¶æ€</h2><p>ä½¿ç”¨ User B è®¿é—® <a target="_blank" rel="noopener" href="http://www.baidu.com">www.baidu.com</a> åæŸ¥çœ‹ User B å’Œ è·¯ç”±å™¨çš„ ARP æ˜ å°„è¡¨</p><p>User B çš„ ARP æ˜ å°„è¡¨ï¼š</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20210925132622087.png" alt="image-20210925132622087" /></p><p>è·¯ç”±å™¨ æœ‰å…³ User B çš„ ARP æ˜ å°„è¡¨ï¼š</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20210925132710815.png" alt="image-20210925132710815" /></p><h2 id="3-ä¸»æœºæ‰«æ"><a class="markdownIt-Anchor" href="#3-ä¸»æœºæ‰«æ"></a> 3 ä¸»æœºæ‰«æ</h2><p>A å…ˆä½¿ç”¨ nmap æ‰«æä¸€ä¸‹æœ¬å±€åŸŸç½‘ï¼Œå¯ä»¥æ‰«å‡ºç½‘å…³ 192.168.1.1ï¼Œç”¨æˆ·æœº 192.168.1.109</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">nmap -sP 192.168.1.0&#x2F;24<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="C:%5CUsers%5CButterflier%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210925195305365.png" alt="image-20210925195305365" /></p><h2 id="4-å¼€å§‹æ”»å‡»"><a class="markdownIt-Anchor" href="#4-å¼€å§‹æ”»å‡»"></a> 4 å¼€å§‹æ”»å‡»</h2><p>ä½¿ç”¨ arpspoof å‘½ä»¤å¼€å§‹ ARP æ¬ºéª—</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"># arpspoof -i eth0 -t ç›®æ ‡ip ä¸»æœºipï¼ˆè·¯ç”±å™¨ï¼‰arpspoof -i eth0 -t 192.168.1.109 192.168.1.1 # å°† 109 å‘å¾€ ç½‘å…³çš„åŒ…ç›‘å¬æ‹¦æˆª<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>æ­¤æ—¶æŸ¥çœ‹ç”¨æˆ· B çš„ç½‘ç»œçŠ¶æ€ï¼Œå‘ç°å·²ç»æ— æ³•ä¸Šç½‘ï¼šæŸ¥çœ‹ B çš„ ARP ç¼“å­˜ä¿¡æ¯ï¼Œå¯è§ A æˆåŠŸæ¬ºéª—äº† Bï¼Œæ”¹å†™äº†ç½‘å…³ MAC ä¸º A è‡ªå·±ï¼š</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20210925200125750.png" alt="image-20210925200125750" /></p><p>æŸ¥çœ‹è·¯ç”±å™¨ C çš„ ARP ç¼“å­˜ä¿¡æ¯ï¼Œå¹¶æ²¡æœ‰å‘ç°å¯¹ B MAC çš„æ›´æ”¹ï¼šæ˜¯å› ä¸ºæˆ‘ä»¬å€¼æ”»å‡»å¹¶ç›‘å¬äº† 192.168.1.109 -&gt; 192.168.1.1 è¿™ä¸€æ¡ä¿¡é“ï¼Œå…¶å®è¿™å·²ç„¶å¯ä»¥å®ç°æˆ‘ä»¬æƒ³è¦çš„åŠŸèƒ½ï¼Œåªæ˜¯å¾ˆå®¹æ˜“è¢« B å‘ç°</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20210925202212149.png" alt="image-20210925202212149" /></p><p>å¦‚æœè¦åŒå‘ç›‘å¬ï¼Œåˆ™åœ¨æ–°å¼€ä¸€ä¸ªå‘½ä»¤è¡Œçª—å£æ‰§è¡Œä¸‹æ–¹å‘½ä»¤å³å¯ï¼š</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">arpspoof -i eth0 -t 192.168.1.1 192.168.1.109<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å†æ¬¡æŸ¥çœ‹ï¼Œå‘ç°è·¯ç”±å™¨ä¹Ÿè¢«æ¬ºéª—å•¦</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20210925202228390.png" alt="image-20210925202228390" /></p><h2 id="5-æµé‡è½¬å‘"><a class="markdownIt-Anchor" href="#5-æµé‡è½¬å‘"></a> 5 æµé‡è½¬å‘</h2><p>å› ä¸º Linux ä¸­é»˜è®¤ç¦æ­¢æµé‡è½¬å‘åŠŸèƒ½ï¼Œå› æ­¤ arpspoof æ‹¦æˆªäº†æµé‡ï¼Œå®¢æˆ·æœºä¼šç«‹åˆ»å‘ç°æ— æ³•ä¸Šç½‘ï¼Œä¸ºäº†æ›´åŠ éšè”½ï¼Œéœ€è¦å¼€å¯æµé‡è½¬å‘åŠŸèƒ½</p><blockquote><p>æµé‡è½¬å‘åŠŸèƒ½ï¼šå½“ä¸»æœºæ‹¥æœ‰å¤šäºä¸€å—çš„ç½‘å¡æ—¶ï¼Œå…¶ä¸­ä¸€å—æ”¶åˆ°æ•°æ®åŒ…ï¼Œæ ¹æ®æ•°æ®åŒ…çš„ç›®çš„ ip åœ°å€å°†åŒ…å‘å¾€æœ¬æœºå¦ä¸€ç½‘å¡ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬ç›‘å¬æ‹¦æˆªåˆ°æ•°æ®æŠ¥åï¼Œçœ‹ä¸€çœ¼ï¼Œç„¶å copy ä¸€ä»½ï¼Œä»¥å¦ä¸€ä¸ªç½‘å¡å‘ç»™ç›®çš„åœ°å€</p></blockquote><p>æ‰§è¡Œä¸‹æ–¹å‘½ä»¤ï¼Œå¼€å¯æµé‡è½¬å‘ï¼Œå†æ¬¡å¼€å¯ ARP åŒå‘æ¬ºéª—åï¼Œè¿™æ—¶ User B æ˜¯æ­£å¸¸ä¸Šç½‘çŠ¶æ€ï¼š</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">echo 1 | sudo tee &#x2F;proc&#x2F;sys&#x2F;net&#x2F;ipv4&#x2F;ip_forward<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><img src="C:\Users\Butterflier\AppData\Roaming\Typora\typora-user-images\image-20210925203541401.png" alt="image-20210925203541401" style="zoom:50%;" /><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20210925203527816.png" alt="image-20210925203527816" style="zoom:50%;" /><h2 id="6-æµé‡å—…æ¢"><a class="markdownIt-Anchor" href="#6-æµé‡å—…æ¢"></a> 6 æµé‡å—…æ¢</h2><p>æˆ‘ä»¬æ‹¦æˆªäº†è¯·æ±‚ä¸å“åº”åŒ…ï¼Œåº”å½“å¾—æŸ¥çœ‹ä¸€çœ¼é‡Œé¢æœ‰æ²¡æœ‰ä»€ä¹ˆé‡è¦ä¿¡æ¯å§~</p><p>ä½¿ç”¨ <code>ettercap</code> è¿›è¡Œå—…æ¢ï¼šå°è¯•è·å–ç™»å½• <a target="_blank" rel="noopener" href="http://sep.ucas.ac.cn">sep.ucas.ac.cn</a> çš„ç”¨æˆ·åä¸å¯†ç ä¿¡æ¯</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">ettercap -Tq -i eth0<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20210925203914868.png" alt="image-20210925203914868" /></p><p>å¼€å¯æˆåŠŸåï¼Œå½“ç”¨æˆ·è¿›è¡Œæ­£å¸¸çš„è¯·æ±‚æ—¶ï¼Œ<code>ettercap</code> å°±èƒ½å¸®åŠ©æˆ‘ä»¬å—…æ¢åˆ°ä¿¡æ¯</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20210925204100160.png" alt="image-20210925204100160" /></p><h1 id="end"><a class="markdownIt-Anchor" href="#end"></a> END</h1><p>å®è·µä¸‹æ¥çœŸçš„ååˆ†çš„æœ‰æ„æ€ï¼Œç‰¹åˆ«æ˜¯ Kail Linux ä¸­æ‹¥æœ‰ä¸°å¯Œçš„å·¥å…·ï¼Œå¯ä»¥ç®€å•çš„è®©å°ç™½å¿«é€Ÿä¸Šæ‰‹ï¼Œå®è·µæ‰€å­¦ï¼Œç‚¹èµï¼</p>]]></content>
      
      
      <categories>
          
          <category> Protocol Security </category>
          
      </categories>
      
      
        <tags>
            
            <tag> security </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>KNNä¸kdTree</title>
      <link href="/Coming-blog/2021/07/24/knn-yu-kdtree/"/>
      <url>/Coming-blog/2021/07/24/knn-yu-kdtree/</url>
      
        <content type="html"><![CDATA[<h1 id="k-è¿‘é‚»æ³•"><a class="markdownIt-Anchor" href="#k-è¿‘é‚»æ³•"></a> K è¿‘é‚»æ³•</h1><p>K è¿‘é‚» - K Nearest Neighbor - KNN</p><p><strong>ä¸€å¥è¯æè¿°</strong>ï¼šç»™å®šä¸€ä¸ªè®­ç»ƒæ•°æ®é›†ï¼Œå¯¹äºæ–°è¾“å…¥çš„å®ä¾‹ï¼Œåœ¨è®­ç»ƒæ•°æ®é›†ä¸­æ‰¾åˆ°ä¸ä¹‹æœ€é‚»è¿‘çš„kä¸ªå®ä¾‹ï¼ŒæŠ•ç¥¨å†³å®šè¾“å…¥å®ä¾‹çš„ç±»åˆ«</p><p>1ã€è¾“å…¥æ•°æ®é›† <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>T</mi><mo>=</mo><mo stretchy="false">{</mo><mo stretchy="false">(</mo><msub><mi mathvariant="bold">x</mi><mn mathvariant="bold">1</mn></msub><mo separator="true">,</mo><msub><mi>y</mi><mn>1</mn></msub><mo stretchy="false">)</mo><mo separator="true">,</mo><mo stretchy="false">(</mo><msub><mi mathvariant="bold">x</mi><mn mathvariant="bold">2</mn></msub><mo separator="true">,</mo><msub><mi>y</mi><mn>2</mn></msub><mo stretchy="false">)</mo><mo separator="true">,</mo><mo>â€¦</mo><mo separator="true">,</mo><mo stretchy="false">(</mo><msub><mi mathvariant="bold">x</mi><mi mathvariant="bold">n</mi></msub><mo separator="true">,</mo><msub><mi>y</mi><mi>n</mi></msub><mo stretchy="false">)</mo><mo stretchy="false">}</mo></mrow><annotation encoding="application/x-tex">T = \{ (\mathbf{x_1}, y_1), (\mathbf{x_2}, y_2), \dots, (\mathbf{x_n}, y_n) \}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.13889em;">T</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">{</span><span class="mopen">(</span><span class="mord"><span class="mord"><span class="mord mathbf">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathbf mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mopen">(</span><span class="mord"><span class="mord"><span class="mord mathbf">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathbf mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner">â€¦</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mopen">(</span><span class="mord"><span class="mord"><span class="mord mathbf">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.161108em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathbf mtight">n</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">n</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mclose">}</span></span></span></span> ï¼›å…¶ä¸­ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi mathvariant="bold">x</mi><mi mathvariant="bold">i</mi></msub></mrow><annotation encoding="application/x-tex">\mathbf{x_i}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.59444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord"><span class="mord mathbf">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathbf mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span> ä¸ºç¬¬ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.65952em;vertical-align:0em;"></span><span class="mord mathdefault">i</span></span></span></span> ä¸ªæ•°æ®çš„ç‰¹å¾å‘é‡ï¼›<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>y</mi><mi>i</mi></msub><mo>âˆˆ</mo><mi mathvariant="script">Y</mi><mo>=</mo><mo stretchy="false">{</mo><msub><mi>c</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>c</mi><mn>2</mn></msub><mo separator="true">,</mo><mo>â€¦</mo><mo separator="true">,</mo><msub><mi>c</mi><mi>K</mi></msub><mo stretchy="false">}</mo></mrow><annotation encoding="application/x-tex">y_i \in \mathcal{Y} = \{ c_1, c_2, \dots, c_K \}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7335400000000001em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">âˆˆ</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.78055em;vertical-align:-0.09722em;"></span><span class="mord"><span class="mord mathcal" style="margin-right:0.08222em;">Y</span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">{</span><span class="mord"><span class="mord mathdefault">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner">â€¦</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.07153em;">K</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">}</span></span></span></span> ä¸ºç¬¬ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.65952em;vertical-align:0em;"></span><span class="mord mathdefault">i</span></span></span></span> ä¸ªæ•°æ®çš„ç±»åˆ«ï¼Œå…± <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>K</mi></mrow><annotation encoding="application/x-tex">K</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.07153em;">K</span></span></span></span> ä¸ªç±»åˆ«ã€‚</p><p>2ã€æ ¹æ®ç»™å®šçš„è·ç¦»åº¦é‡ï¼Œåœ¨è®­ç»ƒæ•°æ®é›† <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>T</mi></mrow><annotation encoding="application/x-tex">T</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.13889em;">T</span></span></span></span> ä¸­æ‰¾å‡ºä¸æ–°è¾“å…¥å®ä¾‹ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="bold">z</mi></mrow><annotation encoding="application/x-tex">\mathbf{z}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.44444em;vertical-align:0em;"></span><span class="mord"><span class="mord mathbf">z</span></span></span></span></span> æœ€é‚»è¿‘çš„ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.03148em;">k</span></span></span></span> ä¸ªç‚¹ï¼Œæ¶µç›–è¿™ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.03148em;">k</span></span></span></span> ä¸ªç‚¹çš„ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="bold">z</mi></mrow><annotation encoding="application/x-tex">\mathbf{z}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.44444em;vertical-align:0em;"></span><span class="mord"><span class="mord mathbf">z</span></span></span></span></span> çš„é‚»åŸŸè®°ä½œï¼š<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>N</mi><mi>k</mi></msub><mo stretchy="false">(</mo><mi mathvariant="bold">z</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">N_k(\mathbf{z})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10903em;">N</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.10903em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathbf">z</span></span><span class="mclose">)</span></span></span></span></p><p>3ã€æ ¹æ®åˆ†ç±»å†³ç­–è§„åˆ™ï¼Œåœ¨ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>N</mi><mi>k</mi></msub><mo stretchy="false">(</mo><mi mathvariant="bold">z</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">N_k(\mathbf{z})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10903em;">N</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.10903em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathbf">z</span></span><span class="mclose">)</span></span></span></span> ä¸­å†³å®šè¾“å…¥å®ä¾‹çš„ç±»åˆ«ï¼š<span class="katex"><span class="katex-mathml"><math><semantics><mrow><munder><mo><mi>arg</mi><mo>â¡</mo><mi>max</mi><mo>â¡</mo></mo><msub><mi>c</mi><mi>j</mi></msub></munder><munder><mo>âˆ‘</mo><mrow><msub><mi>x</mi><mi>i</mi></msub><mo>âˆˆ</mo><msub><mi>N</mi><mi>k</mi></msub><mo stretchy="false">(</mo><mi mathvariant="bold">z</mi><mo stretchy="false">)</mo></mrow></munder><mi>I</mi><mo stretchy="false">(</mo><msub><mi>y</mi><mi>i</mi></msub><mo>=</mo><msub><mi>c</mi><mi>j</mi></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\mathop{\arg\max}\limits_{c_j} \sum\limits_{x_i \in N_k(\mathbf{z})} I(y_i = c_j)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.9660100000000003em;vertical-align:-1.216005em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.4305599999999999em;"><span style="top:-1.90556em;margin-left:0em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3280857142857143em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2818857142857143em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-2.7em;"><span class="pstrut" style="height:2.7em;"></span><span><span class="mop"><span class="mop">ar<span style="margin-right:0.01389em;">g</span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop">max</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.09176em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7500050000000001em;"><span style="top:-2.058995em;margin-left:0em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3280857142857143em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span><span class="mrel mtight">âˆˆ</span><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.10903em;">N</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3487714285714287em;margin-left:-0.10903em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathdefault mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15122857142857138em;"><span></span></span></span></span></span></span><span class="mopen mtight">(</span><span class="mord mtight"><span class="mord mathbf mtight">z</span></span><span class="mclose mtight">)</span></span></span></span><span style="top:-3.0000050000000003em;"><span class="pstrut" style="height:3em;"></span><span><span class="mop op-symbol small-op">âˆ‘</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.216005em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.07847em;">I</span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.036108em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span> ï¼›å…¶ä¸­ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>I</mi></mrow><annotation encoding="application/x-tex">I</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.07847em;">I</span></span></span></span> ä¸ºæŒ‡ç¤ºå‡½æ•°ï¼Œ<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>y</mi><mi>i</mi></msub><mo>=</mo><msub><mi>c</mi><mi>j</mi></msub></mrow><annotation encoding="application/x-tex">y_i=c_j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.716668em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span> æ—¶å€¼ä¸º 1 å¦åˆ™ä¸º 0ã€‚</p><p>æ ¹æ®ä¸Šè¿°çš„è¿‡ç¨‹ï¼Œæˆ‘ä»¬è¿˜éœ€è¦äº†è§£ä¸‹ï¼šè·ç¦»åº¦é‡ï¼Œk å€¼çš„é€‰æ‹©ï¼Œåˆ†ç±»å†³ç­–è§„åˆ™ã€‚æ­¤å¤–å½“è®­ç»ƒæ•°æ®é›† <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>T</mi></mrow><annotation encoding="application/x-tex">T</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.13889em;">T</span></span></span></span> ä¸­èŠ‚ç‚¹è¿‡å¤šæ—¶ï¼Œè®¡ç®—å¾—åˆ° <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>N</mi><mi>k</mi></msub><mo stretchy="false">(</mo><mi mathvariant="bold">z</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">N_k(\mathbf{z})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10903em;">N</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.10903em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathbf">z</span></span><span class="mclose">)</span></span></span></span> å°†è€—è´¹å¤§é‡ç®—åŠ›ï¼Œå› æ­¤éœ€è¦å¼•å…¥ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>k</mi><mi>d</mi><mtext>Â </mtext><mi>T</mi><mi>r</mi><mi>e</mi><mi>e</mi></mrow><annotation encoding="application/x-tex">kd\ Tree</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.03148em;">k</span><span class="mord mathdefault">d</span><span class="mspace">Â </span><span class="mord mathdefault" style="margin-right:0.13889em;">T</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault">e</span><span class="mord mathdefault">e</span></span></span></span> è¿™ä¸€æ•°æ®ç»“æ„æ¥è§£å†³é—®é¢˜ã€‚</p><h1 id="è·ç¦»åº¦é‡"><a class="markdownIt-Anchor" href="#è·ç¦»åº¦é‡"></a> è·ç¦»åº¦é‡</h1><p>KNN ä¸­å°†ä¸¤ä¸ªå®ä¾‹ç‚¹é—´çš„è·ç¦»ä½œä¸ºå…¶ç›¸ä¼¼ç¨‹åº¦çš„åº¦é‡ï¼Œä¸€èˆ¬çš„è·ç¦»åº¦é‡éƒ½é€‰ç”¨ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>L</mi><mi>p</mi></msub></mrow><annotation encoding="application/x-tex">L_p</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.969438em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault">L</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">p</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span> è·ç¦»</p><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>L</mi><mi>p</mi></msub><mo stretchy="false">(</mo><msub><mi mathvariant="bold">x</mi><mi>i</mi></msub><mo separator="true">,</mo><msub><mi mathvariant="bold">x</mi><mi>j</mi></msub><mo stretchy="false">)</mo><mo>=</mo><msup><mrow><mo fence="true">(</mo><munderover><mo>âˆ‘</mo><mrow><mi>l</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></munderover><msup><mrow><mo fence="true">âˆ£</mo><msubsup><mi>x</mi><mi>i</mi><mrow><mo stretchy="false">(</mo><mi>l</mi><mo stretchy="false">)</mo></mrow></msubsup><mo>âˆ’</mo><msubsup><mi>x</mi><mi>j</mi><mrow><mo stretchy="false">(</mo><mi>l</mi><mo stretchy="false">)</mo></mrow></msubsup><mo fence="true">âˆ£</mo></mrow><mi>p</mi></msup><mo fence="true">)</mo></mrow><mfrac><mn>1</mn><mi>p</mi></mfrac></msup></mrow><annotation encoding="application/x-tex">L_p(\mathbf{x}_i, \mathbf{x}_j) = \left( \sum_{l=1}^{n} \left| x_i^{(l)} - x_j^{(l)} \right|^p \right) ^{\frac{1}{p}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.036108em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault">L</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">p</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord"><span class="mord mathbf">x</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord"><span class="mord mathbf">x</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:3.396033em;vertical-align:-1.302113em;"></span><span class="minner"><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size4">(</span></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.6513970000000002em;"><span style="top:-1.8478869999999998em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.01968em;">l</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.0500049999999996em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">âˆ‘</span></span></span><span style="top:-4.300005em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">n</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.302113em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.167985em;"><span style="top:-1.955985em;"><span class="pstrut" style="height:2.606em;"></span><span class="delimsizinginner delim-size1"><span>âˆ£</span></span></span><span style="top:-2.561985em;"><span class="pstrut" style="height:2.606em;"></span><span class="delimsizinginner delim-size1"><span>âˆ£</span></span></span><span style="top:-3.167985em;"><span class="pstrut" style="height:2.606em;"></span><span class="delimsizinginner delim-size1"><span>âˆ£</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.6500149999999999em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0448em;"><span style="top:-2.4231360000000004em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span><span style="top:-3.2198em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathdefault mtight" style="margin-right:0.01968em;">l</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.276864em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0448em;"><span style="top:-2.4231360000000004em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span><span style="top:-3.2198em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathdefault mtight" style="margin-right:0.01968em;">l</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.412972em;"><span></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.167985em;"><span style="top:-1.955985em;"><span class="pstrut" style="height:2.606em;"></span><span class="delimsizinginner delim-size1"><span>âˆ£</span></span></span><span style="top:-2.561985em;"><span class="pstrut" style="height:2.606em;"></span><span class="delimsizinginner delim-size1"><span>âˆ£</span></span></span><span style="top:-3.167985em;"><span class="pstrut" style="height:2.606em;"></span><span class="delimsizinginner delim-size1"><span>âˆ£</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.6500149999999999em;"><span></span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:1.222277em;"><span style="top:-3.6208850000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">p</span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size4">)</span></span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:2.09392em;"><span style="top:-4.5029em;margin-right:0.05em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mopen nulldelimiter sizing reset-size3 size6"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8443142857142858em;"><span style="top:-2.656em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">p</span></span></span></span><span style="top:-3.2255000000000003em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line mtight" style="border-bottom-width:0.049em;"></span></span><span style="top:-3.384em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.48288571428571425em;"><span></span></span></span></span></span><span class="mclose nulldelimiter sizing reset-size3 size6"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p><p>æ¯”å¦‚å½“ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>p</mi><mo>=</mo><mn>2</mn></mrow><annotation encoding="application/x-tex">p=2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathdefault">p</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">2</span></span></span></span> æ—¶ä¸ºæˆ‘ä»¬å¸¸è§çš„æ¬§å¼è·ç¦»ï¼Œ<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>p</mi><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">p=1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathdefault">p</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span> æ—¶ä¸ºæ›¼å“ˆé¡¿è·ç¦»</p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20210724113727757.png" alt="image-20210724113727757" style="zoom:50%;" /><p>ç‰¹åˆ«çš„è¿˜åº”æ³¨æ„å½“ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>p</mi><mo>â†’</mo><mo>+</mo><mi mathvariant="normal">âˆ</mi></mrow><annotation encoding="application/x-tex">p \rightarrow +\infty</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathdefault">p</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">â†’</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.66666em;vertical-align:-0.08333em;"></span><span class="mord">+</span><span class="mord">âˆ</span></span></span></span>  å…¶è·ç¦»åº¦é‡æ˜¯å„ä¸ªç»´åº¦è·ç¦»çš„æœ€å¤§å€¼ï¼ŒåŒæ ·çš„å½“ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>p</mi><mo>â†’</mo><mo>âˆ’</mo><mi mathvariant="normal">âˆ</mi></mrow><annotation encoding="application/x-tex">p \rightarrow -\infty</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathdefault">p</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">â†’</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.66666em;vertical-align:-0.08333em;"></span><span class="mord">âˆ’</span><span class="mord">âˆ</span></span></span></span> å…¶è·ç¦»åº¦é‡æ˜¯å„ä¸ªç»´åº¦è·ç¦»çš„æœ€å°å€¼</p><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>L</mi><mrow><mo>+</mo><mi mathvariant="normal">âˆ</mi></mrow></msub><mo stretchy="false">(</mo><msub><mi mathvariant="bold">x</mi><mi>i</mi></msub><mo separator="true">,</mo><msub><mi mathvariant="bold">x</mi><mi>j</mi></msub><mo stretchy="false">)</mo><mo>=</mo><munder><mo><mi>max</mi><mo>â¡</mo></mo><mi>l</mi></munder><mrow><mo fence="true">âˆ£</mo><msubsup><mi>x</mi><mi>i</mi><mrow><mo stretchy="false">(</mo><mi>l</mi><mo stretchy="false">)</mo></mrow></msubsup><mo>âˆ’</mo><msubsup><mi>x</mi><mi>j</mi><mrow><mo stretchy="false">(</mo><mi>l</mi><mo stretchy="false">)</mo></mrow></msubsup><mo fence="true">âˆ£</mo></mrow></mrow><annotation encoding="application/x-tex">L_{+\infty}(\mathbf{x}_i, \mathbf{x}_j) = \max_l \left| x_i^{(l)} - x_j^{(l)} \right|</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.036108em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault">L</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.25833100000000003em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">+</span><span class="mord mtight">âˆ</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord"><span class="mord mathbf">x</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord"><span class="mord mathbf">x</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.920093em;vertical-align:-0.752108em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.43055999999999994em;"><span style="top:-2.047892em;margin-left:0em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.01968em;">l</span></span></span><span style="top:-2.7em;"><span class="pstrut" style="height:2.7em;"></span><span><span class="mop">max</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.752108em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.167985em;"><span style="top:-1.955985em;"><span class="pstrut" style="height:2.606em;"></span><span class="delimsizinginner delim-size1"><span>âˆ£</span></span></span><span style="top:-2.561985em;"><span class="pstrut" style="height:2.606em;"></span><span class="delimsizinginner delim-size1"><span>âˆ£</span></span></span><span style="top:-3.167985em;"><span class="pstrut" style="height:2.606em;"></span><span class="delimsizinginner delim-size1"><span>âˆ£</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.6500149999999999em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0448em;"><span style="top:-2.4231360000000004em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span><span style="top:-3.2198em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathdefault mtight" style="margin-right:0.01968em;">l</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.276864em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0448em;"><span style="top:-2.4231360000000004em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span><span style="top:-3.2198em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathdefault mtight" style="margin-right:0.01968em;">l</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.412972em;"><span></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.167985em;"><span style="top:-1.955985em;"><span class="pstrut" style="height:2.606em;"></span><span class="delimsizinginner delim-size1"><span>âˆ£</span></span></span><span style="top:-2.561985em;"><span class="pstrut" style="height:2.606em;"></span><span class="delimsizinginner delim-size1"><span>âˆ£</span></span></span><span style="top:-3.167985em;"><span class="pstrut" style="height:2.606em;"></span><span class="delimsizinginner delim-size1"><span>âˆ£</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.6500149999999999em;"><span></span></span></span></span></span></span></span></span></span></span></span></p><p>æœ‰å…³è·ç¦»åº¦é‡çš„é€‰æ‹©å¯ä»¥æ ¹æ®ä»»åŠ¡éœ€æ±‚è¿›è¡Œåˆ¤æ–­ï¼Œåœ¨ KNN ä¸­é€šå¸¸ä½¿ç”¨æ¬§å¼è·ç¦»ä½œä¸ºå…¶è·ç¦»åº¦é‡ã€‚</p><p>Tipsï¼šä¸ºäº†é¿å…å„ä¸ªç»´åº¦æ•°é‡çº§ä¸åŒå¯¼è‡´è·ç¦»å¤§å°åªå–å†³äºå•ä¸€ç‰¹å¾çš„é—®é¢˜å‡ºç°ï¼Œé€šå¸¸éœ€è¦è¿›è¡Œç‰¹å¾å½’ä¸€åŒ– / æ ‡å‡†åŒ–ã€‚ä¾‹å¦‚æˆ¿ä»·è¿™ä¸€ç‰¹å¾åœ¨ [5000, 10000] èŒƒå›´ä¸­å˜åŒ–ï¼Œè€Œæˆ¿é—´å¤§å°å´åœ¨ [90, 120] ä¹‹é—´å˜åŒ–ï¼Œé‚£ä¹ˆè®¡ç®—è·ç¦»æ—¶ï¼Œæˆ¿é—´å¤§å°è¿™ä¸€ç‰¹å¾åœ¨æˆ¿ä»·ç‰¹å¾å‰å°±æ— æ³•å……åˆ†è¡¨è¾¾ã€‚</p><h1 id="k-å€¼çš„é€‰æ‹©"><a class="markdownIt-Anchor" href="#k-å€¼çš„é€‰æ‹©"></a> k å€¼çš„é€‰æ‹©</h1><p><strong>è¾ƒå°çš„ k å€¼</strong>ï¼šè¿‘ä¼¼è¯¯å·®ä¼šå‡å°ï¼ˆåªæœ‰ä¸è¾“å…¥å®ä¾‹è¾ƒåŠ²çš„è®­ç»ƒå®ä¾‹æ‰èƒ½èµ·ä½œç”¨ï¼‰ï¼Œä¼°è®¡è¯¯å·®ä¼šå¢å¤§ï¼ˆé¢„æµ‹ç»“æœä¼šå¯¹è¿‘é‚»çš„å®ä¾‹ç‚¹éå¸¸æ•æ„Ÿï¼‰ã€‚<strong>è¾ƒå¤§çš„ k å€¼</strong>ï¼šä¸ä¹‹ç›¸åã€‚ä¸è¾“å…¥å®ä¾‹ä¸ç›¸ä¼¼çš„ç‚¹ä¹Ÿèƒ½èµ·åˆ°é¢„æµ‹ä½œç”¨ï¼Œä½¿å¾—é¢„æµ‹å¯èƒ½å‘ç”Ÿé”™è¯¯ã€‚k å€¼çš„å¢å¤§ä½¿å¾—æ¨¡å‹ç®€å•ã€‚<strong>é€šå¸¸å†³ç­–</strong>ï¼šå…ˆé€‰å–è¾ƒå°çš„ k å€¼ï¼Œåç”¨äº¤å‰éªŒè¯çš„æ–¹æ³•ç¡®å®šæœ€ä¼˜ k å€¼ã€‚</p><h1 id="åˆ†ç±»å†³ç­–è§„åˆ™"><a class="markdownIt-Anchor" href="#åˆ†ç±»å†³ç­–è§„åˆ™"></a> åˆ†ç±»å†³ç­–è§„åˆ™</h1><p>åœ¨è¿™é‡Œ KNN é‡‡ç”¨å¤šæ•°è¡¨å†³ï¼ˆVoteï¼‰ï¼Œä¸ºä»€ä¹ˆå¤šæ•°è¡¨å†³åˆç†å‘¢ï¼Ÿæ˜¯å› ä¸ºå¤šæ•°è¡¨å†³è§„åˆ™ç­‰ä»·äºç»éªŒé£é™©æœ€å°åŒ–ï¼Œè¯æ˜å¦‚ä¸‹ï¼š</p><p>å‡è®¾æˆ‘ä»¬çš„æŸå¤±å‡½æ•°ä¸º 0,1æŸå¤±å‡½æ•° - åˆ†ç±»é”™è¯¯ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>l</mi><mi>o</mi><mi>s</mi><mi>s</mi><mo>+</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">loss + 1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.77777em;vertical-align:-0.08333em;"></span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault">o</span><span class="mord mathdefault">s</span><span class="mord mathdefault">s</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span>ï¼Œåˆ†ç±»å‡½æ•°ä¸º <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>f</mi><mo stretchy="false">(</mo><mi mathvariant="bold">z</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">f(\mathbf{z})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord"><span class="mord mathbf">z</span></span><span class="mclose">)</span></span></span></span></p><p>è¯¯åˆ†ç±»æ¦‚ç‡ï¼š<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>P</mi><mo stretchy="false">(</mo><mi>y</mi><mi mathvariant="normal">â‰ </mi><mi>f</mi><mo stretchy="false">(</mo><mi mathvariant="bold">z</mi><mo stretchy="false">)</mo><mo stretchy="false">)</mo><mo>=</mo><mn>1</mn><mo>âˆ’</mo><mi>P</mi><mo stretchy="false">(</mo><mi>y</mi><mo>=</mo><mi>f</mi><mo stretchy="false">(</mo><mi mathvariant="bold">z</mi><mo stretchy="false">)</mo><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">P(y \neq f(\mathbf{z})) = 1 - P(y=f(\mathbf{z}))</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel"><span class="mrel"><span class="mord"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.69444em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="rlap"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="inner"><span class="mrel">î€ </span></span><span class="fix"></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.19444em;"><span></span></span></span></span></span></span><span class="mrel">=</span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord"><span class="mord mathbf">z</span></span><span class="mclose">)</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord"><span class="mord mathbf">z</span></span><span class="mclose">)</span><span class="mclose">)</span></span></span></span></p><p>è¯¯åˆ†ç±»ç‡ï¼š<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mfrac><mn>1</mn><mi>k</mi></mfrac><munder><mo>âˆ‘</mo><mrow><msub><mi>x</mi><mi>i</mi></msub><mo>âˆˆ</mo><msub><mi>N</mi><mi>k</mi></msub><mo stretchy="false">(</mo><mi mathvariant="bold">z</mi><mo stretchy="false">)</mo></mrow></munder><mi>I</mi><mo stretchy="false">(</mo><msub><mi>y</mi><mi>i</mi></msub><mi mathvariant="normal">â‰ </mi><msub><mi>c</mi><mi>j</mi></msub><mo stretchy="false">)</mo><mo>=</mo><mn>1</mn><mo>âˆ’</mo><mfrac><mn>1</mn><mi>k</mi></mfrac><munder><mo>âˆ‘</mo><mrow><msub><mi>x</mi><mi>i</mi></msub><mo>âˆˆ</mo><msub><mi>N</mi><mi>k</mi></msub><mo stretchy="false">(</mo><mi mathvariant="bold">z</mi><mo stretchy="false">)</mo></mrow></munder><mi>I</mi><mo stretchy="false">(</mo><msub><mi>y</mi><mi>i</mi></msub><mo>=</mo><msub><mi>c</mi><mi>j</mi></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\frac{1}{k} \sum\limits_{x_i \in N_k(\mathbf{z})} I(y_i \ne c_j) = 1 - \frac{1}{k} \sum\limits_{x_i \in N_k(\mathbf{z})} I(y_i = c_j)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:2.0611129999999998em;vertical-align:-1.216005em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.845108em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.03148em;">k</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7500050000000001em;"><span style="top:-2.058995em;margin-left:0em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3280857142857143em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span><span class="mrel mtight">âˆˆ</span><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.10903em;">N</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3487714285714287em;margin-left:-0.10903em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathdefault mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15122857142857138em;"><span></span></span></span></span></span></span><span class="mopen mtight">(</span><span class="mord mtight"><span class="mord mathbf mtight">z</span></span><span class="mclose mtight">)</span></span></span></span><span style="top:-3.0000050000000003em;"><span class="pstrut" style="height:3em;"></span><span><span class="mop op-symbol small-op">âˆ‘</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.216005em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.07847em;">I</span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel"><span class="mrel"><span class="mord"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.69444em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="rlap"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="inner"><span class="mrel">î€ </span></span><span class="fix"></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.19444em;"><span></span></span></span></span></span></span><span class="mrel">=</span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.036108em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:2.0611129999999998em;vertical-align:-1.216005em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.845108em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.03148em;">k</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7500050000000001em;"><span style="top:-2.058995em;margin-left:0em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3280857142857143em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span><span class="mrel mtight">âˆˆ</span><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.10903em;">N</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3487714285714287em;margin-left:-0.10903em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathdefault mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15122857142857138em;"><span></span></span></span></span></span></span><span class="mopen mtight">(</span><span class="mord mtight"><span class="mord mathbf mtight">z</span></span><span class="mclose mtight">)</span></span></span></span><span style="top:-3.0000050000000003em;"><span class="pstrut" style="height:3em;"></span><span><span class="mop op-symbol small-op">âˆ‘</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.216005em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.07847em;">I</span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.036108em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></p><p>å› æ­¤ä¸ºäº†ä½¿è¯¯åˆ†ç±»ç‡æœ€å°ï¼Œå°±è¦æœ€å¤§åŒ–ï¼š<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mfrac><mn>1</mn><mi>k</mi></mfrac><munder><mo>âˆ‘</mo><mrow><msub><mi>x</mi><mi>i</mi></msub><mo>âˆˆ</mo><msub><mi>N</mi><mi>k</mi></msub><mo stretchy="false">(</mo><mi mathvariant="bold">z</mi><mo stretchy="false">)</mo></mrow></munder><mi>I</mi><mo stretchy="false">(</mo><msub><mi>y</mi><mi>i</mi></msub><mo>=</mo><msub><mi>c</mi><mi>j</mi></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\frac{1}{k} \sum\limits_{x_i \in N_k(\mathbf{z})} I(y_i = c_j)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:2.0611129999999998em;vertical-align:-1.216005em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.845108em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.03148em;">k</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7500050000000001em;"><span style="top:-2.058995em;margin-left:0em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3280857142857143em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span><span class="mrel mtight">âˆˆ</span><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.10903em;">N</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3487714285714287em;margin-left:-0.10903em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathdefault mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15122857142857138em;"><span></span></span></span></span></span></span><span class="mopen mtight">(</span><span class="mord mtight"><span class="mord mathbf mtight">z</span></span><span class="mclose mtight">)</span></span></span></span><span style="top:-3.0000050000000003em;"><span class="pstrut" style="height:3em;"></span><span><span class="mop op-symbol small-op">âˆ‘</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.216005em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.07847em;">I</span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.036108em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></p><p>è€Œä½¿ä¹‹æœ€å¤§åŒ–ï¼Œåˆ™å°±åº”ä½¿å¾— <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>c</mi><mi>j</mi></msub></mrow><annotation encoding="application/x-tex">c_j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.716668em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span> ä¸º <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>N</mi><mi>k</mi></msub><mo stretchy="false">(</mo><mi mathvariant="bold">z</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">N_k(\mathbf{z})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10903em;">N</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.10903em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathbf">z</span></span><span class="mclose">)</span></span></span></span>  ä¸­çš„å¤§å¤šæ•°è¡¨è¾¾ï¼Œå³ä¸ºå¤šæ•°è¡¨å†³è§„åˆ™(Vote)</p><p>Tipsï¼šå¤šæ•°è¡¨å†³å¹¶ä¸å’Œ 0,1 æŸå¤±æŒ‚é’©ï¼Œåœ¨è¿™é‡Œä»…ä»…æ˜¯ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ï¼Œé‡‡ç”¨åˆ«çš„æŸå¤±å‡½æ•°ï¼Œä¹Ÿèƒ½å¾—åˆ°åŒæ ·çš„ç»“è®ºã€‚</p><h1 id="kd-tree"><a class="markdownIt-Anchor" href="#kd-tree"></a> kd Tree</h1><p>è¿™æ‰æ˜¯ KNN ä¸­çš„é‡å¤´æˆå•Š~</p><p>é’ˆå¯¹ç‰¹å¾ç©ºé—´ç»´åº¦è¾ƒå¤§ä»¥åŠæ•°æ®å®¹é‡è¾ƒå¤§çš„æƒ…å†µï¼Œä½¿ç”¨ kd Tree å¯ä»¥åŠ é€Ÿæ£€ç´¢è¿‡ç¨‹ã€‚</p><p>kd Tree æ˜¯ä¸€ä¸ªäºŒå‰æ ‘ï¼Œç›®çš„æ˜¯å®ç°å¯¹ k ç»´ç©ºé—´çš„åˆ’åˆ†ã€‚</p><h2 id="æ„é€ æ–¹æ³•"><a class="markdownIt-Anchor" href="#æ„é€ æ–¹æ³•"></a> æ„é€ æ–¹æ³•</h2><p>åŸºæœ¬æ€è·¯ï¼šé¡ºåºé€‰å®šä¸€ä¸ªè½´ï¼ˆç»´åº¦ï¼‰åˆ‡ä¸‹å»ï¼Œè¿™æ ·å®åŠ›å°±ä¼šè¢«åˆ’åˆ†ä¸ºï¼ˆå·¦å³ï¼‰ä¸¤ä¸ªåŒºåŸŸï¼›ä¸ºäº†ä¿è¯æ ‘çš„å¹³è¡¡ï¼Œé€‰æ‹©è¯¥è½´çš„ä¸­ä½æ•°ä¸ºåˆ‡åˆ†ç‚¹ã€‚</p><p>ç›´åˆ°åˆ’åˆ†çš„å­åŒºåŸŸä¸­æ²¡æœ‰å®ä¾‹ä¸ºæ­¢ã€‚</p><p>æ ·ä¾‹ï¼š<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>T</mi><mo>=</mo><mo stretchy="false">{</mo><mo stretchy="false">(</mo><mn>2</mn><mo separator="true">,</mo><mn>3</mn><msup><mo stretchy="false">)</mo><mi>T</mi></msup><mo separator="true">,</mo><mo stretchy="false">(</mo><mn>5</mn><mo separator="true">,</mo><mn>4</mn><msup><mo stretchy="false">)</mo><mi>T</mi></msup><mo separator="true">,</mo><mo stretchy="false">(</mo><mn>9</mn><mo separator="true">,</mo><mn>6</mn><msup><mo stretchy="false">)</mo><mi>T</mi></msup><mo separator="true">,</mo><mo stretchy="false">(</mo><mn>4</mn><mo separator="true">,</mo><mn>7</mn><msup><mo stretchy="false">)</mo><mi>T</mi></msup><mo separator="true">,</mo><mo stretchy="false">(</mo><mn>8</mn><mo separator="true">,</mo><mn>1</mn><msup><mo stretchy="false">)</mo><mi>T</mi></msup><mo separator="true">,</mo><mo stretchy="false">(</mo><mn>7</mn><mo separator="true">,</mo><mn>2</mn><msup><mo stretchy="false">)</mo><mi>T</mi></msup><mo stretchy="false">}</mo></mrow><annotation encoding="application/x-tex">T = \{(2,3)^T, (5,4)^T, (9,6)^T, (4,7)^T, (8,1)^T, (7,2)^T\}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.13889em;">T</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.0913309999999998em;vertical-align:-0.25em;"></span><span class="mopen">{</span><span class="mopen">(</span><span class="mord">2</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">3</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8413309999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mopen">(</span><span class="mord">5</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">4</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8413309999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mopen">(</span><span class="mord">9</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">6</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8413309999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mopen">(</span><span class="mord">4</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">7</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8413309999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mopen">(</span><span class="mord">8</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">1</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8413309999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mopen">(</span><span class="mord">7</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">2</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8413309999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span><span class="mclose">}</span></span></span></span></p><p>1ã€é€‰æ‹©ç¬¬ä¸€ä¸ªç»´åº¦å‡†å¤‡ä¸‹åˆ€ï¼Œé€‰æ‹©ä¸­ä½æ•°ï¼ˆ2, 4, 5, 7, 8, 9)ï¼Œï¼ˆä¸­ä½æ•°åº”ä¸º 6ï¼Œä½†æ˜¯ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mi>x</mi><mrow><mo stretchy="false">(</mo><mn>1</mn><mo stretchy="false">)</mo></mrow></msup><mo>=</mo><mn>6</mn></mrow><annotation encoding="application/x-tex">x^{(1)}=6</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8879999999999999em;vertical-align:0em;"></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8879999999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mtight">1</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">6</span></span></span></span> å¹¶æ²¡æœ‰å¯¹åº”æ•°æ®ç‚¹ï¼Œå‘ä¸Šå‘ä¸‹é€‰æ‹©éƒ½å¯ä»¥ï¼Œè¿™é‡ŒæŒ‰ç…§ä¹¦ä¸Šå‘ä¸Šé€‰å–ï¼‰ï¼Œé€‰æ‹© <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo stretchy="false">(</mo><mn>7</mn><mo separator="true">,</mo><mn>2</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(7, 2)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">7</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">2</span><span class="mclose">)</span></span></span></span> ä¸ºåˆ‡åˆ†ç‚¹ã€‚</p><p>2ã€å·¦ä¾§åŒºåŸŸä¸º (2, 3) (5, 4) (4, 7)ï¼Œé€‰æ‹©ç¬¬äºŒä¸ªç»´åº¦ä¸‹åˆ€ï¼Œé€‰æ‹©ä¸­å¿ƒç‚¹ (5, 4) å¼€åˆ‡</p><p>2ã€å·¦ä¾§åŒºåŸŸä¸º (8, 1) (9, 6)ï¼Œé€‰æ‹©ç¬¬äºŒä¸ªç»´åº¦ä¸‹åˆ€ï¼Œé€‰æ‹©ä¸­å¿ƒç‚¹ (9, 6) å¼€åˆ‡</p><p>3ã€(5, 4) å·¦ä¾§åŒºåŸŸä¸º (2, 3)ï¼Œé€‰æ‹©ç¬¬ä¸€ä¸ªç»´åº¦ä¸‹åˆ€ï¼Œé€‰æ‹©ä¸­å¿ƒç‚¹ (2, 3) å¼€åˆ‡ â€”â€” END</p><p>3ã€(5, 4) å³ä¾§åŒºåŸŸä¸º (4, 7)ï¼Œé€‰æ‹©ç¬¬ä¸€ä¸ªç»´åº¦ä¸‹åˆ€ï¼Œé€‰æ‹©ä¸­å¿ƒç‚¹ (4, 7) å¼€åˆ‡ â€”â€” END</p><p>3ã€(9, 6) å·¦ä¾§åŒºåŸŸä¸º (8, 1)ï¼Œé€‰æ‹©ç¬¬ä¸€ä¸ªç»´åº¦ä¸‹åˆ€ï¼Œé€‰æ‹©ä¸­å¿ƒç‚¹ (8, 1) å¼€åˆ‡ â€”â€” END</p><p>3ã€(9, 6) å³ä¾§ â€”â€” END</p><p>ä¸‹å›¾ 3.3 ä¸ºåˆ’åˆ†ç»“æœï¼Œå¯ä»¥ç®€å•æƒ³ä¸‹ï¼Œåœ¨æˆ‘ä»¬æ±‚æœ€è¿‘é‚»æ—¶ï¼Œå‘å·¦æˆ–å‘å³å†³ç­–å°±å¯ä»¥èˆå»å‰©ä½™èŠ‚ç‚¹ä¸€åŠçš„ç‚¹ï¼Œç¡®å®å¯ä»¥åŠ é€Ÿâ”—|ï½€Oâ€²|â”› å—·~~</p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20210724135524379.png" alt="image-20210724135524379" style="zoom:50%;" /><h2 id="æœç´¢æ–¹æ³•"><a class="markdownIt-Anchor" href="#æœç´¢æ–¹æ³•"></a> æœç´¢æ–¹æ³•</h2><p>å¯¹äºç›®æ ‡å®ä¾‹ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="bold">z</mi></mrow><annotation encoding="application/x-tex">\mathbf{z}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.44444em;vertical-align:0em;"></span><span class="mord"><span class="mord mathbf">z</span></span></span></span></span> ï¼Œæˆ‘ä»¬çš„ç›®æ ‡æ˜¯åˆ©ç”¨ kd Tree æœå¯»å…¶ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.03148em;">k</span></span></span></span> è¿‘é‚»ç‚¹</p><p>1ã€å®šä½ç›®æ ‡å®ä¾‹åˆ°æœ€å°å­ç©ºé—´ï¼šæ ¹æ®æ¯å±‚çš„åˆ’åˆ†ç»´åº¦ï¼Œå¯¹ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="bold">z</mi></mrow><annotation encoding="application/x-tex">\mathbf{z}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.44444em;vertical-align:0em;"></span><span class="mord"><span class="mord mathbf">z</span></span></span></span></span> è¿›è¡Œå­ç©ºé—´å®šä½ï¼Œä¸€ç›´å®šä½åˆ°åŸå­ç©ºé—´ â€”â€” å°äºè¯¥å±‚çš„çº¬åº¦å€¼åˆ™å‘å·¦ï¼Œå¤§äºå‘å³ã€‚</p><p>2ã€é€’å½’å‘ä¸Šæ‰§è¡Œï¼Œç»´æŠ¤ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.03148em;">k</span></span></span></span> è¿‘é‚»èŠ‚ç‚¹é›†åˆ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>S</mi></mrow><annotation encoding="application/x-tex">S</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.05764em;">S</span></span></span></span></p><p>2.1ã€å¦‚æœ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>S</mi></mrow><annotation encoding="application/x-tex">S</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.05764em;">S</span></span></span></span> æœªæ»¡ï¼Œç›´æ¥æ·»åŠ å½“å‰å­ç©ºé—´èŠ‚ç‚¹</p><p>2.2ã€å¦‚æœè¿‘é‚»é›†åˆæ»¡ï¼Œæ¯”è¾ƒè·ç¦»åˆ¤æ–­æ˜¯å¦æ›¿æ¢</p><p>3ã€æŸ¥çœ‹å½“å‰èŠ‚ç‚¹çš„å¦ä¸€ä¾§å­åŒºåŸŸï¼šåˆ¤æ–­å½“å‰è¿‘é‚»é›†åˆä¸­è·ç¦» <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="bold">z</mi></mrow><annotation encoding="application/x-tex">\mathbf{z}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.44444em;vertical-align:0em;"></span><span class="mord"><span class="mord mathbf">z</span></span></span></span></span> çš„æœ€å¤§è·ç¦»æ˜¯å¦èƒ½è·¨åŸŸ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="bold">z</mi></mrow><annotation encoding="application/x-tex">\mathbf{z}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.44444em;vertical-align:0em;"></span><span class="mord"><span class="mord mathbf">z</span></span></span></span></span> æ‰€å±çš„å­åŒºåŸŸï¼ˆä¹Ÿå°±æ˜¯ä¸‹å›¾æ‰€ç¤ºçš„æƒ…å†µï¼‰ï¼Œæˆ‘ä»¬éœ€è¦æœç´¢ A çš„å³ä¾§ç©ºé—´ï¼Œé€šè¿‡æœç´¢ C æ‰¾åˆ° E</p><blockquote><p>éœ€è¦é’ˆå¯¹å½“å‰æ‰€åœ¨ç»´åº¦çœ‹ï¼Œä»…ä»…çœ‹ä¸€ä¸ªç»´åº¦ï¼Œå› æ­¤æ¯”è¾ƒè·ç¦»å°±ç›¸å½“äºåœ¨ä¸€ä¸ªè½´ä¸Šæ¯”è¾ƒ</p><p>å¦‚æœè·ç¦»è¶…å‡ºï¼Œåˆ¤æ–­èŠ‚ç‚¹ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="bold">z</mi></mrow><annotation encoding="application/x-tex">\mathbf{z}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.44444em;vertical-align:0em;"></span><span class="mord"><span class="mord mathbf">z</span></span></span></span></span> åœ¨å½“å‰ç©ºé—´çš„å·¦ä¾§è¿˜æ˜¯å³ä¾§</p><p>å¦‚æœåœ¨å·¦ä¾§ï¼šåˆ™å‘å³å¯»æ‰¾ï¼›å¦‚æœåœ¨å³ä¾§ï¼šåˆ™å‘å·¦å¯»æ‰¾ï¼›</p></blockquote><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20210724145306684.png" alt="image-20210724145306684" /></p><h2 id="python-å®ç°"><a class="markdownIt-Anchor" href="#python-å®ç°"></a> Python å®ç°</h2><h3 id="èŠ‚ç‚¹ç±»"><a class="markdownIt-Anchor" href="#èŠ‚ç‚¹ç±»"></a> èŠ‚ç‚¹ç±»</h3><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># kd-treeæ¯ä¸ªç»“ç‚¹ä¸­ä¸»è¦åŒ…å«çš„æ•°æ®ç»“æ„å¦‚ä¸‹</span><span class="token comment"># data - èŠ‚ç‚¹çš„ç‰¹å¾å‘é‡ï¼Œlabel - èŠ‚ç‚¹çš„æ ‡ç­¾ï¼Œdepth - èŠ‚ç‚¹çš„æ·±åº¦ï¼ˆç”¨äºåˆ¤æ–­åˆ‡åˆ†ç»´åº¦ï¼‰ï¼Œlchildï¼Œrchild - èŠ‚ç‚¹æŒ‡å‘çš„å·¦å³ç©ºé—´èŠ‚ç‚¹</span><span class="token keyword">class</span> <span class="token class-name">Node</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> data<span class="token punctuation">,</span> label<span class="token punctuation">,</span> depth<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> lchild<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> rchild<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        self<span class="token punctuation">.</span>data<span class="token punctuation">,</span> self<span class="token punctuation">.</span>label<span class="token punctuation">,</span> self<span class="token punctuation">.</span>depth<span class="token punctuation">,</span> self<span class="token punctuation">.</span>lchild<span class="token punctuation">,</span> self<span class="token punctuation">.</span>rchild <span class="token operator">=</span> \            <span class="token punctuation">(</span>data<span class="token punctuation">,</span> label<span class="token punctuation">,</span> depth<span class="token punctuation">,</span> lchild<span class="token punctuation">,</span> rchild<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="åˆå§‹åŒ–"><a class="markdownIt-Anchor" href="#åˆå§‹åŒ–"></a> åˆå§‹åŒ–</h3><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> X<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token comment"># æ‹¼æ¥æ•°æ®ä¿¡æ¯</span>    y <span class="token operator">=</span> y<span class="token punctuation">[</span>np<span class="token punctuation">.</span>newaxis<span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">]</span>    self<span class="token punctuation">.</span>data <span class="token operator">=</span> np<span class="token punctuation">.</span>hstack<span class="token punctuation">(</span><span class="token punctuation">[</span>X<span class="token punctuation">,</span> y<span class="token punctuation">.</span>T<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token comment"># é€’å½’æ„å»º</span>    self<span class="token punctuation">.</span>rootNode <span class="token operator">=</span> self<span class="token punctuation">.</span>buildTree<span class="token punctuation">(</span>self<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="æ„å»º"><a class="markdownIt-Anchor" href="#æ„å»º"></a> æ„å»º</h3><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># data - æ€»ä½“æ•°æ®ä¿¡æ¯ï¼Œ depth - å½“å‰æ„å»ºçš„æ·±åº¦ï¼Œç”¨äºåˆ¤æ–­å½“å‰åˆ’åˆ†çš„ç»´åº¦</span><span class="token keyword">def</span> <span class="token function">buildTree</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> data<span class="token punctuation">,</span> depth<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>1ã€é€‰æ‹©åˆ’åˆ†ç»´åº¦</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># depth ä¸ºé€’å½’æ—¶è®°å½•çš„æ·±åº¦å€¼ï¼Œåˆå§‹ä¸º 0</span>m<span class="token punctuation">,</span> self<span class="token punctuation">.</span>n <span class="token operator">=</span> np<span class="token punctuation">.</span>shape<span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token comment"># m æ¡æ•°æ®ï¼Œn ä¸ªç»´åº¦</span>aim_axis <span class="token operator">=</span> depth <span class="token operator">%</span> <span class="token punctuation">(</span>self<span class="token punctuation">.</span>n<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment"># é€‰æ‹©åˆ‡åˆ†çš„ç»´åº¦</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>2ã€é€‰æ‹©ç›®æ ‡ç»´åº¦çš„ä¸­ä½æ•°</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># æ’åºå¯»æ‰¾ä¸­ä½æ•°</span>sorted_data <span class="token operator">=</span> <span class="token builtin">sorted</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> key<span class="token operator">=</span><span class="token keyword">lambda</span> item<span class="token punctuation">:</span> item<span class="token punctuation">[</span>aim_axis<span class="token punctuation">]</span><span class="token punctuation">)</span>mid <span class="token operator">=</span> m <span class="token operator">//</span> <span class="token number">2</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>3ã€ç¡®è®¤å½“å‰è¶…ç©ºé—´èŠ‚ç‚¹</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># è®°å½•è¯¥ç©ºé—´å¯¹åº”çš„èŠ‚ç‚¹</span>node <span class="token operator">=</span> Node<span class="token punctuation">(</span>sorted_data<span class="token punctuation">[</span>mid<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> sorted_data<span class="token punctuation">[</span>mid<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> depth<span class="token operator">=</span>depth<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>4ã€è¿›è¡Œå·¦å³ç©ºé—´çš„åˆ’åˆ†</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">node<span class="token punctuation">.</span>lchild <span class="token operator">=</span> self<span class="token punctuation">.</span>buildTree<span class="token punctuation">(</span>sorted_data<span class="token punctuation">[</span><span class="token punctuation">:</span>mid<span class="token punctuation">]</span><span class="token punctuation">,</span> depth<span class="token operator">=</span>depth<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span>node<span class="token punctuation">.</span>rchild <span class="token operator">=</span> self<span class="token punctuation">.</span>buildTree<span class="token punctuation">(</span>sorted_data<span class="token punctuation">[</span>mid<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">,</span> depth<span class="token operator">=</span>depth<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>5ã€é€’å½’å®Œæˆåï¼Œå‘ä¸Šè¿”å›å½“å‰æ ¹èŠ‚ç‚¹</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">return</span> node<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>æ•´ä½“ä»£ç </strong></p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">buildTree</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> data<span class="token punctuation">,</span> depth<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token boolean">None</span>    <span class="token comment"># m æ¡æ•°æ®ï¼Œn ä¸ªç»´åº¦</span>    m<span class="token punctuation">,</span> self<span class="token punctuation">.</span>n <span class="token operator">=</span> np<span class="token punctuation">.</span>shape<span class="token punctuation">(</span>data<span class="token punctuation">)</span>    <span class="token comment"># é€‰æ‹©åˆ‡åˆ†çš„ç»´åº¦</span>    aim_axis <span class="token operator">=</span> depth <span class="token operator">%</span> <span class="token punctuation">(</span>self<span class="token punctuation">.</span>n<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>    <span class="token comment"># æ’åºå¯»æ‰¾ä¸­ä½æ•°</span>    sorted_data <span class="token operator">=</span> <span class="token builtin">sorted</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> key<span class="token operator">=</span><span class="token keyword">lambda</span> item<span class="token punctuation">:</span> item<span class="token punctuation">[</span>aim_axis<span class="token punctuation">]</span><span class="token punctuation">)</span>    mid <span class="token operator">=</span> m <span class="token operator">//</span> <span class="token number">2</span>    <span class="token comment"># åˆ‡åˆ†ï¼Œå¹¶è®°å½•è¯¥ç©ºé—´å¯¹åº”çš„èŠ‚ç‚¹</span>    node <span class="token operator">=</span> Node<span class="token punctuation">(</span>sorted_data<span class="token punctuation">[</span>mid<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> sorted_data<span class="token punctuation">[</span>mid<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> depth<span class="token operator">=</span>depth<span class="token punctuation">)</span>    <span class="token comment"># è®°å½•æ ¹èŠ‚ç‚¹</span>    <span class="token keyword">if</span><span class="token punctuation">(</span>depth <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        self<span class="token punctuation">.</span>kdTree <span class="token operator">=</span> node    node<span class="token punctuation">.</span>lchild <span class="token operator">=</span> self<span class="token punctuation">.</span>buildTree<span class="token punctuation">(</span>sorted_data<span class="token punctuation">[</span><span class="token punctuation">:</span>mid<span class="token punctuation">]</span><span class="token punctuation">,</span> depth<span class="token operator">=</span>depth<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span>    node<span class="token punctuation">.</span>rchild <span class="token operator">=</span> self<span class="token punctuation">.</span>buildTree<span class="token punctuation">(</span>sorted_data<span class="token punctuation">[</span>mid<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">,</span> depth<span class="token operator">=</span>depth<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> node<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="æœç´¢"><a class="markdownIt-Anchor" href="#æœç´¢"></a> æœç´¢</h3><p>å‘ä¸Šé€’å½’è¿›è¡Œæœç´¢ï¼Œå…¨ç¨‹ç»´æŠ¤ nearest - k è¿‘é‚»èŠ‚ç‚¹é›†åˆ</p><p>ä¸»è¦å†…å®¹ä¸º <code>recurve(node)</code> æ–¹æ³•ï¼Œnode è¡¨ç¤ºå½“å‰å­ç©ºé—´çš„ç®¡ç†èŠ‚ç‚¹ä¿¡æ¯</p><p>1ã€é¦–å…ˆè·å–åˆ’åˆ†ç»´åº¦ï¼Œä¸€å±‚ä¸€å±‚çš„åˆ’åˆ†åˆ°å¶å­èŠ‚ç‚¹ å³ åŸå­ç©ºé—´</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># è·å–å½“å‰æ·±åº¦æ‰€åˆ’åˆ†çš„ç»´åº¦</span>now_axis <span class="token operator">=</span> node<span class="token punctuation">.</span>depth <span class="token operator">%</span> <span class="token punctuation">(</span>self<span class="token punctuation">.</span>n <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token keyword">if</span><span class="token punctuation">(</span>x<span class="token punctuation">[</span>now_axis<span class="token punctuation">]</span> <span class="token operator">&lt;</span> node<span class="token punctuation">.</span>data<span class="token punctuation">[</span>now_axis<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    recurve<span class="token punctuation">(</span>node<span class="token punctuation">.</span>lchild<span class="token punctuation">)</span><span class="token keyword">else</span><span class="token punctuation">:</span>    recurve<span class="token punctuation">(</span>node<span class="token punctuation">.</span>rchild<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>2ã€åˆ°è¾¾å¶å­èŠ‚ç‚¹ï¼Œæ›´æ–° k è¿‘é‚»èŠ‚ç‚¹é›†åˆ</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># åˆ°è¾¾äº†å¶å­èŠ‚ç‚¹ï¼Œæˆ–è€…å­èŠ‚ç‚¹åˆ¤æ–­å®Œæ¯•</span>dist <span class="token operator">=</span> np<span class="token punctuation">.</span>linalg<span class="token punctuation">.</span>norm<span class="token punctuation">(</span>x <span class="token operator">-</span> node<span class="token punctuation">.</span>data<span class="token punctuation">,</span> <span class="token builtin">ord</span><span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token comment"># æ›´æ–°è¿‘é‚»ä¿¡æ¯</span><span class="token comment"># è¿‘é‚»èŠ‚ç‚¹ç»“åˆæ²¡æœ‰æ»¡ï¼Œåˆ™ç›´æ¥åŠ å…¥</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>nearest<span class="token punctuation">)</span> <span class="token operator">&lt;</span> count<span class="token punctuation">)</span><span class="token punctuation">:</span>    self<span class="token punctuation">.</span>nearest<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">[</span>dist<span class="token punctuation">,</span> node<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">else</span><span class="token punctuation">:</span>    <span class="token comment"># é›†åˆæ»¡äº†æŒ‰ç…§è·ç¦»å¤§å°è¿›è¡Œæ›¿æ¢</span>    aim_index <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span>    <span class="token keyword">for</span> i<span class="token punctuation">,</span> d <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>nearest<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>d<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token keyword">or</span> dist <span class="token operator">&lt;</span> d<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            aim_index <span class="token operator">=</span> i    <span class="token keyword">if</span><span class="token punctuation">(</span>aim_index <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        self<span class="token punctuation">.</span>nearest<span class="token punctuation">[</span>aim_index<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>dist<span class="token punctuation">,</span> node<span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>3ã€åˆ¤æ–­ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.03148em;">k</span></span></span></span> è¿‘èŠ‚ç‚¹æ˜¯å¦å¯èƒ½å‡ºç°åœ¨å¦ä¸€ä¾§ï¼Œå³ä¸‹å›¾ç‚¹ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>E</mi></mrow><annotation encoding="application/x-tex">E</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.05764em;">E</span></span></span></span></p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20210724145306684.png" alt="" /></p><p>æ³¨æ„å½“ node ä¸º D èŠ‚ç‚¹çš„æ—¶å€™å¯å®šä¸ä¼šæ¶‰åŠåˆ° D çš„å·¦ä¾§ç©ºé—´ (ä¸‹ä¾§)ï¼Œä½†æ˜¯å½“é€’å½’åˆ° A èŠ‚ç‚¹è¿›è¡Œåˆ¤æ–­æ—¶ï¼Œä¼šå‘ç° A çš„å³ä¾§ï¼ˆä¸Šä¾§ï¼‰ç©ºé—´ä¸­å¯èƒ½å­˜åœ¨æ›´ä¼˜èŠ‚ç‚¹ï¼Œå› æ­¤å°†ä¼šå¯¹ç›®æ ‡ç©ºé—´è¿›ä¸€æ­¥æœç´¢ã€‚</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># è·å–å½“å‰è¿‘é‚»ç‚¹ä¸­è·ç¦»æœ€å¤§å€¼çš„ç´¢å¼•</span>max_index <span class="token operator">=</span> np<span class="token punctuation">.</span>argmax<span class="token punctuation">(</span>np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>self<span class="token punctuation">.</span>nearest<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token comment"># è¡¨ç¤ºè¿™ä¸ªè¿‘é‚»ç‚¹çš„è·ç¦»è·¨åŸŸäº†å½“å‰èŠ‚ç‚¹æ‰€è¡¨ç¤ºçš„å­åŒºåŸŸï¼Œæ‰€ä»¥éœ€è¦è°ƒæŸ¥å¦ä¸€å­æ ‘</span><span class="token keyword">if</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>nearest<span class="token punctuation">[</span>max_index<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">></span> <span class="token builtin">abs</span><span class="token punctuation">(</span>x<span class="token punctuation">[</span>now_axis<span class="token punctuation">]</span> <span class="token operator">-</span> node<span class="token punctuation">.</span>data<span class="token punctuation">[</span>now_axis<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token keyword">if</span><span class="token punctuation">(</span>x<span class="token punctuation">[</span>now_axis<span class="token punctuation">]</span> <span class="token operator">-</span> node<span class="token punctuation">.</span>data<span class="token punctuation">[</span>now_axis<span class="token punctuation">]</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">:</span>recurve<span class="token punctuation">(</span>node<span class="token punctuation">.</span>rchild<span class="token punctuation">)</span><span class="token keyword">else</span><span class="token punctuation">:</span>recurve<span class="token punctuation">(</span>node<span class="token punctuation">.</span>lchild<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>æ•´ä½“ä»£ç </strong></p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">search</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> x<span class="token punctuation">,</span> count<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    nearest <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>    <span class="token keyword">assert</span> count <span class="token operator">>=</span> <span class="token number">1</span> <span class="token keyword">and</span> count <span class="token operator">&lt;=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'é”™è¯¯çš„kè¿‘é‚»å€¼'</span>    self<span class="token punctuation">.</span>nearest <span class="token operator">=</span> nearest    <span class="token keyword">def</span> <span class="token function">recurve</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">if</span> node <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>            <span class="token keyword">return</span>        <span class="token comment"># è·å–å½“å‰æ·±åº¦æ‰€åˆ’åˆ†çš„ç»´åº¦</span>        now_axis <span class="token operator">=</span> node<span class="token punctuation">.</span>depth <span class="token operator">%</span> <span class="token punctuation">(</span>self<span class="token punctuation">.</span>n <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>x<span class="token punctuation">[</span>now_axis<span class="token punctuation">]</span> <span class="token operator">&lt;</span> node<span class="token punctuation">.</span>data<span class="token punctuation">[</span>now_axis<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            recurve<span class="token punctuation">(</span>node<span class="token punctuation">.</span>lchild<span class="token punctuation">)</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            recurve<span class="token punctuation">(</span>node<span class="token punctuation">.</span>rchild<span class="token punctuation">)</span>        <span class="token comment"># åˆ°è¾¾äº†å¶å­èŠ‚ç‚¹ï¼Œæˆ–è€…å­èŠ‚ç‚¹åˆ¤æ–­å®Œæ¯•</span>        dist <span class="token operator">=</span> np<span class="token punctuation">.</span>linalg<span class="token punctuation">.</span>norm<span class="token punctuation">(</span>x <span class="token operator">-</span> node<span class="token punctuation">.</span>data<span class="token punctuation">,</span> <span class="token builtin">ord</span><span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>        <span class="token comment"># æ›´æ–°è¿‘é‚»ä¿¡æ¯</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>nearest<span class="token punctuation">)</span> <span class="token operator">&lt;</span> count<span class="token punctuation">)</span><span class="token punctuation">:</span>            self<span class="token punctuation">.</span>nearest<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">[</span>dist<span class="token punctuation">,</span> node<span class="token punctuation">]</span><span class="token punctuation">)</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            aim_index <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span>            <span class="token keyword">for</span> i<span class="token punctuation">,</span> d <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>nearest<span class="token punctuation">)</span><span class="token punctuation">:</span>                <span class="token keyword">if</span><span class="token punctuation">(</span>d<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token keyword">or</span> dist <span class="token operator">&lt;</span> d<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                    aim_index <span class="token operator">=</span> i            <span class="token keyword">if</span><span class="token punctuation">(</span>aim_index <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                self<span class="token punctuation">.</span>nearest<span class="token punctuation">[</span>aim_index<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>dist<span class="token punctuation">,</span> node<span class="token punctuation">]</span>        <span class="token comment"># è·å–å½“å‰è¿‘é‚»ç‚¹ä¸­è·ç¦»æœ€å¤§å€¼çš„ç´¢å¼•</span>        max_index <span class="token operator">=</span> np<span class="token punctuation">.</span>argmax<span class="token punctuation">(</span>np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>self<span class="token punctuation">.</span>nearest<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>        <span class="token comment"># è¡¨ç¤ºè¿™ä¸ªè¿‘é‚»ç‚¹çš„è·ç¦»è·¨åŸŸäº†å½“å‰èŠ‚ç‚¹æ‰€è¡¨ç¤ºçš„å­åŒºåŸŸï¼Œæ‰€ä»¥éœ€è¦è°ƒæŸ¥å¦ä¸€å­æ ‘</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>nearest<span class="token punctuation">[</span>max_index<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">></span> <span class="token builtin">abs</span><span class="token punctuation">(</span>x<span class="token punctuation">[</span>now_axis<span class="token punctuation">]</span> <span class="token operator">-</span> node<span class="token punctuation">.</span>data<span class="token punctuation">[</span>now_axis<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">if</span><span class="token punctuation">(</span>x<span class="token punctuation">[</span>now_axis<span class="token punctuation">]</span> <span class="token operator">-</span> node<span class="token punctuation">.</span>data<span class="token punctuation">[</span>now_axis<span class="token punctuation">]</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                recurve<span class="token punctuation">(</span>node<span class="token punctuation">.</span>rchild<span class="token punctuation">)</span>            <span class="token keyword">else</span><span class="token punctuation">:</span>                recurve<span class="token punctuation">(</span>node<span class="token punctuation">.</span>lchild<span class="token punctuation">)</span>    recurve<span class="token punctuation">(</span>self<span class="token punctuation">.</span>rootNode<span class="token punctuation">)</span>    poll <span class="token operator">=</span> <span class="token punctuation">[</span>item<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>label <span class="token keyword">for</span> item <span class="token keyword">in</span> self<span class="token punctuation">.</span>nearest<span class="token punctuation">]</span>    <span class="token keyword">return</span> self<span class="token punctuation">.</span>nearest<span class="token punctuation">,</span> Counter<span class="token punctuation">(</span>poll<span class="token punctuation">)</span><span class="token punctuation">.</span>most_common<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="end"><a class="markdownIt-Anchor" href="#end"></a> END</h1><p>æºç åœ°å€ï¼š<a target="_blank" rel="noopener" href="https://github.com/Coming98/kNN-kdTree">https://github.com/Coming98/kNN-kdTree</a></p>]]></content>
      
      
      <categories>
          
          <category> ç»Ÿè®¡å­¦ä¹ æ–¹æ³• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ML </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç†µæƒæ³•</title>
      <link href="/Coming-blog/2021/07/24/shang-quan-fa/"/>
      <url>/Coming-blog/2021/07/24/shang-quan-fa/</url>
      
        <content type="html"><![CDATA[<h1 id="ä¿¡æ¯é‡"><a class="markdownIt-Anchor" href="#ä¿¡æ¯é‡"></a> ä¿¡æ¯é‡</h1><p>äº‹ä»¶Aï¼šå°æ˜ç©¿ç€è¥¿è£…å‡ºé—¨å‚åŠ æ´»åŠ¨ã€‚</p><p>äº‹ä»¶Bï¼šå°æ˜ç©¿ç€å¥³è£…å‡ºé—¨å‚åŠ æ´»åŠ¨ã€‚</p><p>ä»…å‡­ç›´è§‰æ¥è¯´ï¼Œæ˜¾è€Œæ˜“è§äº‹ä»¶Bçš„ä¿¡æ¯é‡æ¯”äº‹ä»¶Açš„ä¿¡æ¯é‡è¦å¤§ã€‚ç©¶å…¶åŸå› ï¼Œæ˜¯å› ä¸ºäº‹ä»¶Aå‘ç”Ÿçš„æ¦‚ç‡å¾ˆå¤§ï¼Œäº‹ä»¶Bå‘ç”Ÿçš„æ¦‚ç‡å¾ˆå°ã€‚æ‰€ä»¥å½“è¶Šä¸å¯èƒ½çš„äº‹ä»¶å‘ç”Ÿäº†ï¼Œæˆ‘ä»¬è·å–åˆ°çš„ä¿¡æ¯é‡å°±è¶Šå¤§ã€‚è¶Šå¯èƒ½å‘ç”Ÿçš„äº‹ä»¶å‘ç”Ÿäº†ï¼Œæˆ‘ä»¬è·å–åˆ°çš„ä¿¡æ¯é‡å°±è¶Šå°ã€‚</p><p>å› æ­¤ï¼šå¯¹äºä¸€ä¸ªäº‹ä»¶ï¼Œå…¶å‘ç”Ÿæ¦‚ç‡è¶Šå°é‚£ä¹ˆå…¶æ‰€åŒ…å«çš„ä¿¡æ¯é‡è¶Šå¤§ã€‚</p><p>è¿›ä¸€æ­¥çš„ç»™ä¸Šè¿°çš„ç°è±¡è¿›è¡Œå»ºæ¨¡ï¼Œè¡¨è¾¾ä¸€ç±»é—®é¢˜ï¼Œå®šä¹‰ä¿¡æ¯é‡å¦‚ä¸‹ï¼š</p><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>I</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mo>=</mo><mo>âˆ’</mo><mi>l</mi><mi>o</mi><mi>g</mi><mo stretchy="false">(</mo><mi>p</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">I(x) = - log(p(x))</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.07847em;">I</span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">âˆ’</span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault">o</span><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="mopen">(</span><span class="mord mathdefault">p</span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mclose">)</span><span class="mclose">)</span></span></span></span></span></p><p><strong>Q</strong>ï¼šè¶Šå°è¶Šå¤§çš„ç°è±¡ä¸ºä»€ä¹ˆä¸ç”¨ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>I</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mo>=</mo><mfrac><mn>1</mn><mrow><mi>p</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></mrow></mfrac></mrow><annotation encoding="application/x-tex">I(x) = \frac{1}{p(x)}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.07847em;">I</span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.365108em;vertical-align:-0.52em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.845108em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">p</span><span class="mopen mtight">(</span><span class="mord mathdefault mtight">x</span><span class="mclose mtight">)</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.52em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span> ï¼Ÿ</p><p><strong>A</strong>ï¼šè™½ç„¶è¿™ä¸ªå»ºæ¨¡èƒ½å¤Ÿè¡¨è¾¾ä¸Šè¿°çš„ç°è±¡ï¼Œä½†æ˜¯æˆ‘ä»¬æœ€å¸¸å¤„ç†çš„è‚¯å®šæ˜¯å¤šä¸ªäº‹ä»¶ä¹‹é—´ä¿¡æ¯é‡çš„å…³ç³»ï¼Œé’ˆå¯¹å¤šä¸ªäº‹ä»¶ï¼Œè¿™ä¸ªæ­£ä¸‰è§’è¡¨è¾¾å¼ï¼ˆä¸Šç®€ä¸‹ç¹ï¼‰è®¡ç®—å°±è¾ƒä¸ºå¤æ‚ï¼Œä¸æ˜“åŒ–ç®€ï¼Œå› æ­¤é€‰æ‹©äº†æ›´æ˜“äºè®¡ç®—çš„å¯¹æ•°å½¢å¼ã€‚</p><h1 id="ç†µ"><a class="markdownIt-Anchor" href="#ç†µ"></a> ç†µ</h1><p>ç†µæ˜¯å¯¹ä¸€ä¸ªéšæœºå˜é‡ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>X</mi></mrow><annotation encoding="application/x-tex">X</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.07847em;">X</span></span></span></span>ï¼ˆå¯èƒ½æœ‰ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">n</span></span></span></span> ç§äº‹ä»¶ï¼‰ä¿¡æ¯é‡çš„æœŸæœ› <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>H</mi><mo stretchy="false">(</mo><mi>X</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">H(X)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.08125em;">H</span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.07847em;">X</span><span class="mclose">)</span></span></span></span>ï¼Œè¡¨ç¤ºå¯¹ä¿¡æ¯ä¸ç¡®å®šæ€§çš„åº¦é‡ã€‚</p><p>ä¿¡æ¯é‡è¶Šå¤§ï¼ˆè¯¥äº‹ä»¶çš„å¤šç§æƒ…å†µå‘ç”Ÿçš„å¯èƒ½æ€§ä¸¤çº§åˆ†åŒ–å°±è¶Šä¸¥é‡ï¼‰ä»£è¡¨è¯¥äº‹ä»¶çš„ä¸ç¡®å®šæ€§è¶Šå°ï¼Œå› æ­¤ä¿¡æ¯ç†µè¶Šå°ã€‚</p><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>H</mi><mo stretchy="false">(</mo><mi>X</mi><mo stretchy="false">)</mo><mo>=</mo><mo>âˆ’</mo><munderover><mo>âˆ‘</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></munderover><mi>p</mi><mo stretchy="false">(</mo><msub><mi>x</mi><mi>i</mi></msub><mo stretchy="false">)</mo><mi>l</mi><mi>o</mi><mi>g</mi><mo stretchy="false">(</mo><mi>p</mi><mo stretchy="false">(</mo><msub><mi>x</mi><mi>i</mi></msub><mo stretchy="false">)</mo><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">H(X) = - \sum_{i=1}^{n} p(x_i) log (p(x_i))</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.08125em;">H</span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.07847em;">X</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.929066em;vertical-align:-1.277669em;"></span><span class="mord">âˆ’</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.6513970000000002em;"><span style="top:-1.872331em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.050005em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">âˆ‘</span></span></span><span style="top:-4.3000050000000005em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">n</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.277669em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">p</span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault">o</span><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="mopen">(</span><span class="mord mathdefault">p</span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mclose">)</span></span></span></span></span></p><p>é’ˆå¯¹ä¸å¯èƒ½äº‹ä»¶ï¼Œæˆ‘ä»¬å®šä¹‰å…¶ä¸ç¡®å®šæ€§ä¸º 0</p><p>å› æ­¤å¯ä»¥ç¡®å®šå…¶å–å€¼èŒƒå›´ï¼š<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo stretchy="false">[</mo><mn>0</mn><mo separator="true">,</mo><mi>l</mi><mi>o</mi><mi>g</mi><mi>n</mi><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">[0, logn]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault">o</span><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="mord mathdefault">n</span><span class="mclose">]</span></span></span></span>ï¼Œå‡ºç°å¿…ç„¶äº‹ä»¶æ—¶è¾¾åˆ°æœ€å°å€¼ï¼Œæ‰€æœ‰äº‹ä»¶å‘ç”Ÿæ¦‚ç‡ä¸€è‡´æ—¶è¾¾åˆ°æœ€å¤§å€¼ã€‚</p><p>ä¾‹å¦‚ï¼šä¼¯åŠªåˆ©åˆ†å¸ƒä¸‹ç†µä¸æ¦‚ç‡çš„å…³ç³»å±•ç¤ºï¼š</p><p><img src="https://gitee.com/Butterflier/pictures/raw/master/image-20210722125918351.png" alt="image-20210722125918351" /></p><h1 id="ç†µæƒæ³•"><a class="markdownIt-Anchor" href="#ç†µæƒæ³•"></a> ç†µæƒæ³•</h1><p>ä½¿ç”¨ç†µæƒæ³•è®¡ç®—å„ä¸ª<strong>æŒ‡æ ‡çš„æƒé‡</strong>ï¼šç†µæƒæ³•çš„æ—¨åœ¨æ ¹æ®æ ·æœ¬ä¸­å•ä¸€æŒ‡æ ‡ä¿¡æ¯ç†µçš„å¤§å°æ¥ç¡®å®šæƒé‡</p><p>åæ–‡ä¸­æˆ‘ä»¬ä½¿ç”¨ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo stretchy="false">{</mo><mn>1</mn><mo separator="true">,</mo><mo>â€¦</mo><mo separator="true">,</mo><mi>i</mi><mo separator="true">,</mo><mo>â€¦</mo><mi>n</mi><mo stretchy="false">}</mo></mrow><annotation encoding="application/x-tex">\{1, \dots, i,\dots n\}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">{</span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner">â€¦</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">i</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner">â€¦</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">n</span><span class="mclose">}</span></span></span></span> è¡¨ç¤ºæ ·æœ¬ï¼Œä½¿ç”¨ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo stretchy="false">{</mo><mn>1</mn><mo separator="true">,</mo><mo>â€¦</mo><mo separator="true">,</mo><mi>j</mi><mo separator="true">,</mo><mo>â€¦</mo><mi>n</mi><mo stretchy="false">}</mo></mrow><annotation encoding="application/x-tex">\{1, \dots, j,\dots n\}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">{</span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner">â€¦</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.05724em;">j</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner">â€¦</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">n</span><span class="mclose">}</span></span></span></span> è¡¨ç¤ºæŒ‡æ ‡</p><ul><li>è‹¥æŸä¸ªæŒ‡æ ‡çš„ä¿¡æ¯ç†µ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>H</mi><mo stretchy="false">(</mo><mi>j</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">H(j)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.08125em;">H</span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.05724em;">j</span><span class="mclose">)</span></span></span></span> è¶Šå°ï¼Œè¡¨æ˜æŒ‡æ ‡å€¼å¾—ä¸ç¡®å®šæ€§è¶Šå°ï¼Œå› è€Œæä¾›çš„ä¿¡æ¯é‡è¶Šå¤šï¼ˆå¯èƒ½å‘ç”Ÿéå¸¸æ­£å¸¸ï¼Œä½†æ˜¯ä¸å‘ç”Ÿå¸¦æ¥çš„ä¿¡æ¯é‡æ˜¯å·¨å¤§çš„ï¼‰ï¼Œåœ¨ç»¼åˆè¯„ä»·ä¸­æ‰€èƒ½èµ·åˆ°çš„ä½œç”¨ä¹Ÿè¶Šå¤§ï¼Œå…¶æƒé‡ä¹Ÿå°±è¶Šå¤§ã€‚</li><li>è‹¥æŸä¸ªæŒ‡æ ‡çš„ä¿¡æ¯ç†µ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>H</mi><mo stretchy="false">(</mo><mi>j</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">H(j)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.08125em;">H</span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.05724em;">j</span><span class="mclose">)</span></span></span></span> è¶Šå¤§ï¼Œè¡¨æ˜æŒ‡æ ‡å€¼å¾—ä¸ç¡®å®šæ€§è¶Šå¤§ï¼Œå› è€Œæä¾›çš„ä¿¡æ¯é‡è¶Šå°‘ï¼ˆæ— è®ºå‘ä¸å‘ç”Ÿæ„Ÿè§‰éƒ½æ­£å¸¸ï¼‰ï¼Œåœ¨ç»¼åˆè¯„ä»·ä¸­æ‰€èµ·åˆ°çš„ä½œç”¨ä¹Ÿè¶Šå°ï¼Œå…¶æƒé‡ä¹Ÿå°±è¶Šå°ã€‚</li></ul><p>æ¥ä¸‹æ¥å¼€å§‹è¿›è¡Œæƒé‡è®¡ç®—</p><h2 id="i-æ•°æ®æ ‡å‡†åŒ–"><a class="markdownIt-Anchor" href="#i-æ•°æ®æ ‡å‡†åŒ–"></a> â…  æ•°æ®æ ‡å‡†åŒ–</h2><p>é¦–å…ˆå°†å„ä¸ªæŒ‡æ ‡å¯¹åº”çš„æ•°æ®åˆ—è¿›è¡Œæ ‡å‡†åŒ–å¤„ç†ï¼Œæ•´ä½“æ•°æ®æˆ‘ä»¬ä½¿ç”¨ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>X</mi></mrow><annotation encoding="application/x-tex">X</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.07847em;">X</span></span></span></span> è¡¨ç¤ºï¼Œ<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>X</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub></mrow><annotation encoding="application/x-tex">X_{ij}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.969438em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.07847em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span> è¡¨ç¤ºç¬¬ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.65952em;vertical-align:0em;"></span><span class="mord mathdefault">i</span></span></span></span> ä¸ªæ ·æœ¬çš„  ç¬¬ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>j</mi></mrow><annotation encoding="application/x-tex">j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.85396em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.05724em;">j</span></span></span></span> ä¸ªæŒ‡æ ‡å¯¹åº”çš„å€¼</p><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>X</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo>=</mo><mfrac><mrow><msub><mi>X</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo>âˆ’</mo><mi>min</mi><mo>â¡</mo><mo stretchy="false">(</mo><msub><mi>X</mi><mi>j</mi></msub><mo stretchy="false">)</mo></mrow><mrow><mi>max</mi><mo>â¡</mo><mo stretchy="false">(</mo><msub><mi>x</mi><mi>j</mi></msub><mo stretchy="false">)</mo><mo>âˆ’</mo><mi>min</mi><mo>â¡</mo><mo stretchy="false">(</mo><msub><mi>x</mi><mi>j</mi></msub><mo stretchy="false">)</mo></mrow></mfrac></mrow><annotation encoding="application/x-tex">X_{ij}=\dfrac{X_{ij} - \min(X_j)}{\max(x_j) - \min(x_j)}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.969438em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.07847em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.399108em;vertical-align:-0.972108em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.427em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mop">max</span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mop">min</span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.07847em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mop">min</span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.07847em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.972108em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p><h2 id="ii-è®¡ç®—ä¿¡æ¯ç†µ"><a class="markdownIt-Anchor" href="#ii-è®¡ç®—ä¿¡æ¯ç†µ"></a> â…¡ è®¡ç®—ä¿¡æ¯ç†µ</h2><p>ç”±å‰æ–‡æ‰€è¿°ï¼Œç¬¬ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>j</mi></mrow><annotation encoding="application/x-tex">j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.85396em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.05724em;">j</span></span></span></span> ä¸ªæŒ‡æ ‡çš„ä¿¡æ¯ç†µ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>H</mi><mo stretchy="false">(</mo><mi>j</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">H(j)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.08125em;">H</span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.05724em;">j</span><span class="mclose">)</span></span></span></span> ä¸ºï¼š</p><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>H</mi><mo stretchy="false">(</mo><mi>j</mi><mo stretchy="false">)</mo><mo>=</mo><mo>âˆ’</mo><munderover><mo>âˆ‘</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></munderover><mi>p</mi><mo stretchy="false">(</mo><mi>i</mi><mo separator="true">,</mo><mi>j</mi><mo stretchy="false">)</mo><mo>â‹…</mo><mi>l</mi><mi>o</mi><mi>g</mi><mo stretchy="false">(</mo><mi>p</mi><mo stretchy="false">(</mo><mi>i</mi><mo separator="true">,</mo><mi>j</mi><mo stretchy="false">)</mo><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">H(j) = - \sum_{i=1}^{n} p(i,j) \cdot log(p(i,j))</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.08125em;">H</span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.05724em;">j</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.929066em;vertical-align:-1.277669em;"></span><span class="mord">âˆ’</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.6513970000000002em;"><span style="top:-1.872331em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.050005em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">âˆ‘</span></span></span><span style="top:-4.3000050000000005em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">n</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.277669em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">p</span><span class="mopen">(</span><span class="mord mathdefault">i</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.05724em;">j</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">â‹…</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault">o</span><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="mopen">(</span><span class="mord mathdefault">p</span><span class="mopen">(</span><span class="mord mathdefault">i</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.05724em;">j</span><span class="mclose">)</span><span class="mclose">)</span></span></span></span></span></p><p>å…¶ä¸­ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>p</mi><mo stretchy="false">(</mo><mi>i</mi><mo separator="true">,</mo><mi>j</mi><mo stretchy="false">)</mo><mo>=</mo><msub><mi>X</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mi mathvariant="normal">/</mi><msubsup><mo>âˆ‘</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></msubsup><msub><mi>X</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub></mrow><annotation encoding="application/x-tex">p(i,j) = X_{ij} / \sum_{i=1}^{n}X_{ij}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault">p</span><span class="mopen">(</span><span class="mord mathdefault">i</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.05724em;">j</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.104002em;vertical-align:-0.29971000000000003em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.07847em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mord">/</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:-0.0000050000000000050004em;">âˆ‘</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.804292em;"><span style="top:-2.40029em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.2029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">n</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.29971000000000003em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.07847em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span></p><p>ä¸ºäº†åç»­åˆ†é…æƒé‡ï¼Œæˆ‘ä»¬è¿›ä¸€æ­¥å°†ä¿¡æ¯ç†µæ˜ å°„åˆ° <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo stretchy="false">[</mo><mn>0</mn><mo separator="true">,</mo><mn>1</mn><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">[0,1]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">1</span><span class="mclose">]</span></span></span></span> çš„èŒƒå›´ï¼Œç”±å‰æ–‡æ‰€è¿°ä¿¡æ¯ç†µ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>H</mi><mo stretchy="false">(</mo><mi>j</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">H(j)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.08125em;">H</span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.05724em;">j</span><span class="mclose">)</span></span></span></span> çš„å–å€¼èŒƒå›´ä¸º<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo stretchy="false">[</mo><mn>0</mn><mo separator="true">,</mo><mi>l</mi><mi>o</mi><mi>g</mi><mi>n</mi><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">[0, logn]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault">o</span><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="mord mathdefault">n</span><span class="mclose">]</span></span></span></span>ï¼Œå› æ­¤ï¼š</p><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>H</mi><mo stretchy="false">(</mo><mi>j</mi><mo stretchy="false">)</mo><mo>=</mo><mo>âˆ’</mo><mfrac><mn>1</mn><mrow><mi>l</mi><mi>o</mi><mi>g</mi><mi>n</mi></mrow></mfrac><munderover><mo>âˆ‘</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></munderover><mi>p</mi><mo stretchy="false">(</mo><mi>i</mi><mo separator="true">,</mo><mi>j</mi><mo stretchy="false">)</mo><mo>â‹…</mo><mi>l</mi><mi>o</mi><mi>g</mi><mo stretchy="false">(</mo><mi>p</mi><mo stretchy="false">(</mo><mi>i</mi><mo separator="true">,</mo><mi>j</mi><mo stretchy="false">)</mo><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">H(j) = - \frac{1}{logn} \sum_{i=1}^{n} p(i,j) \cdot log(p(i,j))</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.08125em;">H</span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.05724em;">j</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.929066em;vertical-align:-1.277669em;"></span><span class="mord">âˆ’</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.32144em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault">o</span><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="mord mathdefault">n</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.8804400000000001em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.6513970000000002em;"><span style="top:-1.872331em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.050005em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">âˆ‘</span></span></span><span style="top:-4.3000050000000005em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">n</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.277669em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">p</span><span class="mopen">(</span><span class="mord mathdefault">i</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.05724em;">j</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">â‹…</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault">o</span><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="mopen">(</span><span class="mord mathdefault">p</span><span class="mopen">(</span><span class="mord mathdefault">i</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.05724em;">j</span><span class="mclose">)</span><span class="mclose">)</span></span></span></span></span></p><h2 id="iii-ç¡®å®šå„æŒ‡æ ‡æƒé‡"><a class="markdownIt-Anchor" href="#iii-ç¡®å®šå„æŒ‡æ ‡æƒé‡"></a> â…¢ ç¡®å®šå„æŒ‡æ ‡æƒé‡</h2><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>W</mi><mi>j</mi></msub><mo>=</mo><mfrac><mrow><mn>1</mn><mo>âˆ’</mo><msub><mi>E</mi><mi>j</mi></msub></mrow><mrow><mi>J</mi><mo>âˆ’</mo><munderover><mo>âˆ‘</mo><mrow><mi>j</mi><mo>=</mo><mn>1</mn></mrow><mi>J</mi></munderover><msub><mi>E</mi><mi>j</mi></msub></mrow></mfrac></mrow><annotation encoding="application/x-tex">W_j = \dfrac{1-E_j}{J-\sum_{j=1}^{J} E_j}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.969438em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.6673790000000004em;vertical-align:-1.3070490000000001em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.36033em;"><span style="top:-2.128769em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.09618em;">J</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:-0.0000050000000000050004em;">âˆ‘</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.981231em;"><span style="top:-2.40029em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.2029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.09618em;">J</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.43581800000000004em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.05764em;">E</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.05764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.05764em;">E</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.05764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.3070490000000001em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p><p>ç”±å‰æ–‡æ‰€è¿°ï¼Œä¿¡æ¯ç†µ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>H</mi><mo stretchy="false">(</mo><mi>j</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">H(j)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.08125em;">H</span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.05724em;">j</span><span class="mclose">)</span></span></span></span> è¶Šå°ï¼Œå…¶åˆ†é…çš„æƒé‡åº”è¶Šå¤§ï¼Œ<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>E</mi><mi>j</mi></msub><mo>âˆˆ</mo><mo stretchy="false">[</mo><mn>0</mn><mo separator="true">,</mo><mn>1</mn><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">E_j \in [0,1]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.969438em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.05764em;">E</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.05764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">âˆˆ</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">1</span><span class="mclose">]</span></span></span></span> å› æ­¤ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>1</mn><mo>âˆ’</mo><msub><mi>E</mi><mi>j</mi></msub></mrow><annotation encoding="application/x-tex">1 - E_j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.969438em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.05764em;">E</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.05764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span> è¡¨æ˜ç¬¬ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>j</mi></mrow><annotation encoding="application/x-tex">j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.85396em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.05724em;">j</span></span></span></span> ä¸ªæŒ‡æ ‡çš„æƒé‡åº¦é‡ï¼Œ<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>J</mi><mo>âˆ’</mo><msubsup><mo>âˆ‘</mo><mrow><mi>j</mi><mo>=</mo><mn>1</mn></mrow><mi>J</mi></msubsup><msub><mi>E</mi><mi>j</mi></msub></mrow><annotation encoding="application/x-tex">J-\sum_{j=1}^{J} E_j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.76666em;vertical-align:-0.08333em;"></span><span class="mord mathdefault" style="margin-right:0.09618em;">J</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.417049em;vertical-align:-0.43581800000000004em;"></span><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:-0.0000050000000000050004em;">âˆ‘</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.981231em;"><span style="top:-2.40029em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.2029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.09618em;">J</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.43581800000000004em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.05764em;">E</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.05764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span> è¡¨æ˜æ‰€æœ‰æŒ‡æ ‡çš„æƒé‡åº¦é‡å’Œï¼Œåˆ™ç¬¬ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>j</mi></mrow><annotation encoding="application/x-tex">j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.85396em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.05724em;">j</span></span></span></span> ä¸ªæŒ‡æ ‡çš„æƒé‡å€¼ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>W</mi><mi>j</mi></msub></mrow><annotation encoding="application/x-tex">W_j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.969438em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span> å³ä¸ºå…¶æƒé‡åº¦é‡çš„å æ¯”ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Math </category>
          
      </categories>
      
      
        <tags>
            
            <tag> weight </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ–°é—»ä¸»é¢˜åˆ†ç±»ä»»åŠ¡</title>
      <link href="/Coming-blog/2021/07/24/xin-wen-zhu-ti-fen-lei-ren-wu/"/>
      <url>/Coming-blog/2021/07/24/xin-wen-zhu-ti-fen-lei-ren-wu/</url>
      
        <content type="html"><![CDATA[<h1 id="æ–°é—»ä¸»é¢˜åˆ†ç±»ä»»åŠ¡"><a class="markdownIt-Anchor" href="#æ–°é—»ä¸»é¢˜åˆ†ç±»ä»»åŠ¡"></a> æ–°é—»ä¸»é¢˜åˆ†ç±»ä»»åŠ¡</h1><p>æœ¬ä»»åŠ¡æ¥è‡ªäº <code>é»‘é©¬NLPä¸­é—´çš„å®è·µé¡¹ç›®</code> ï¼Œä½†æ˜¯åœ¨å®è·µè¿‡ç¨‹ä¸­å‘ç°ï¼Œè¯¾ç¨‹ç»™å‡ºçš„å®è·µä»£ç ä¸å®Œå–„ï¼Œä»£ç ç‰ˆæœ¬è¾ƒè€ç­‰é—®é¢˜ï¼Œå› æ­¤å€¼å¾—è®°å½•è¿™ä¸€å®è·µè¿‡ç¨‹ã€‚</p><p>æºç åœ°å€ï¼š<a target="_blank" rel="noopener" href="https://github.com/Coming98/NewsSubjectClassification">https://github.com/Coming98/NewsSubjectClassification</a></p><h1 id="1-åŠ è½½æ•°æ®é›†"><a class="markdownIt-Anchor" href="#1-åŠ è½½æ•°æ®é›†"></a> 1 åŠ è½½æ•°æ®é›†</h1><p>æ•°æ®é›†ä¸ºï¼š<code>AG_NEWS</code>ï¼Œæ–°é—»ä¸»é¢˜åˆ†ç±»æ•°æ®é›†</p><p>æ•°æ®é›†åœ¨çº¿ä¸‹è½½åœ°å€ - <a target="_blank" rel="noopener" href="https://pan.baidu.com/s/1AjMmYy7YmshAKBG3-CfskA">HERE</a> - æå–ç ï¼šk0hsï¼Œä¸‹è½½å®Œæˆåæ”¾åˆ° <code>DATA_DIR</code> ä¸­å³å¯ç»•è¿‡ä¸‹è½½ï¼Œç›´æ¥ä½¿ç”¨</p><p>è®­ç»ƒæ•°æ®å…± 12w æ¡ï¼Œæµ‹è¯•æ•°æ®å…± 0.76w æ¡</p><p>Tipsï¼šæ•°æ®é›†è¿”å›ç»“æœæ˜¯è¿­ä»£å™¨ï¼Œä½¿ç”¨ä¸€æ¬¡åä¼šå¤±æ•ˆå“¦~</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> torchtext<span class="token punctuation">.</span>datasets <span class="token keyword">import</span> AG_NEWStrain_datasets<span class="token punctuation">,</span> test_datasets <span class="token operator">=</span> AG_NEWS<span class="token punctuation">(</span>root<span class="token operator">=</span>DATA_DIR<span class="token punctuation">,</span> split<span class="token operator">=</span><span class="token punctuation">(</span><span class="token string">'train'</span><span class="token punctuation">,</span> <span class="token string">'test'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>ä¸€æ¡æ•°æ®é›†ç”± <code>label</code> å’Œ <code>content</code> ç»„æˆ</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">(&quot;3&quot;,&quot;Wall St. Bears Claw Back Into the Black (Reuters)&quot;,&quot;Reuters - Short-sellers, Wall Street&#39;s dwindling\band of ultra-cynics, are seeing green again.&quot;)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h1 id="2-å¤„ç†æ•°æ®é›†"><a class="markdownIt-Anchor" href="#2-å¤„ç†æ•°æ®é›†"></a> 2 å¤„ç†æ•°æ®é›†</h1><p>ä½¿ç”¨ <code>keras.preprocessing.text.Tokenizer</code> å·¥å…·å®Œæˆä»¥ä¸‹ä»»åŠ¡ï¼š</p><ol><li>è¯­æ–™çš„åºåˆ—åŒ–ï¼šå°†è¯è½¬ä¸ºå­—å…¸ä¸­çš„ç´¢å¼•å€¼</li><li>å¯¹åºåˆ—åŒ–åçš„è¯­æ–™è¿›è¡Œæˆªæ–­æˆ–è¡¥é½ï¼šä½¿ç”¨<code>keras.preprocessing.sequence</code></li><li>è¿”å›åºåˆ—åŒ–åçš„è®­ç»ƒæ•°æ®é›† <code>train_datasets</code></li><li>è¿”å›åºåˆ—åŒ–åçš„æµ‹è¯•æ•°æ®é›† <code>test_datasets</code></li><li>è¿”å›å­—å…¸ä¸­è¯çš„æ€»ä¸ªæ•° <code>vocab_size</code></li><li>è¿”å›æ€»ç±»åˆ«æ•° <code>num_class</code></li></ol><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">process_datasets_by_Tokenizer</span><span class="token punctuation">(</span>train_datasets<span class="token punctuation">,</span> test_datasets<span class="token punctuation">,</span> cutlen<span class="token operator">=</span><span class="token number">256</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    tokenizer <span class="token operator">=</span> Tokenizer<span class="token punctuation">(</span><span class="token punctuation">)</span>    train_datasets_texts <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>    train_datasets_labels <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>    test_datasets_taxts <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>    test_datasets_labels <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>    <span class="token keyword">for</span> item <span class="token keyword">in</span> train_datasets<span class="token punctuation">:</span>        train_datasets_labels<span class="token punctuation">.</span>append<span class="token punctuation">(</span>item<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment"># æ³¨æ„å°†æ ‡ç­¾æ˜ å°„åˆ° [0, 3]</span>        train_datasets_texts<span class="token punctuation">.</span>append<span class="token punctuation">(</span>item<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token keyword">for</span> item <span class="token keyword">in</span> test_datasets<span class="token punctuation">:</span>        test_datasets_labels<span class="token punctuation">.</span>append<span class="token punctuation">(</span>item<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>        test_datasets_taxts<span class="token punctuation">.</span>append<span class="token punctuation">(</span>item<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    all_datasets_texts <span class="token operator">=</span> train_datasets_texts <span class="token operator">+</span> test_datasets_taxts    all_datasets_labels <span class="token operator">=</span> train_datasets_labels <span class="token operator">+</span> test_datasets_labels    tokenizer<span class="token punctuation">.</span>fit_on_texts<span class="token punctuation">(</span>all_datasets_texts<span class="token punctuation">)</span>    train_datasets_seqs <span class="token operator">=</span> tokenizer<span class="token punctuation">.</span>texts_to_sequences<span class="token punctuation">(</span>train_datasets_texts<span class="token punctuation">)</span>    test_datasets_seqs <span class="token operator">=</span> tokenizer<span class="token punctuation">.</span>texts_to_sequences<span class="token punctuation">(</span>test_datasets_taxts<span class="token punctuation">)</span>    <span class="token comment"># å°†åºåˆ—åŒ–åçš„è¯­æ–™è¿›è¡Œæˆªæ–­æˆ–è¡¥é½ï¼Œä½¿å®ƒä»¬é•¿åº¦ä¸€è‡´</span>    train_datasets_seqs <span class="token operator">=</span> sequence<span class="token punctuation">.</span>pad_sequences<span class="token punctuation">(</span>train_datasets_seqs<span class="token punctuation">,</span> cutlen<span class="token punctuation">)</span>    test_datasets_seqs <span class="token operator">=</span> sequence<span class="token punctuation">.</span>pad_sequences<span class="token punctuation">(</span>test_datasets_seqs<span class="token punctuation">,</span> cutlen<span class="token punctuation">)</span>    train_datasets <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span><span class="token builtin">zip</span><span class="token punctuation">(</span>train_datasets_seqs<span class="token punctuation">,</span> train_datasets_labels<span class="token punctuation">)</span><span class="token punctuation">)</span>    test_datasets <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span><span class="token builtin">zip</span><span class="token punctuation">(</span>test_datasets_seqs<span class="token punctuation">,</span> test_datasets_labels<span class="token punctuation">)</span><span class="token punctuation">)</span>    vocab_size <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>tokenizer<span class="token punctuation">.</span>index_word<span class="token punctuation">.</span>keys<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    num_class <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span><span class="token builtin">set</span><span class="token punctuation">(</span>all_datasets_labels<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> train_datasets<span class="token punctuation">,</span> test_datasets<span class="token punctuation">,</span> vocab_size<span class="token punctuation">,</span> num_class<span class="token triple-quoted-string string">""" æœ€åè¿”å›æ•°æ®æ ¼å¼å¦‚ä¸‹ï¼šarray([    0,     0,     0,     0,     0,     0,     0,     0,     0,           ...        3938,  2289,    15,  6459,     7,   209,   368,     4,     1,         129]), 2)vocab_size = 72002, num_class = 4"""</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="3-æ„å»ºæ¨¡å‹"><a class="markdownIt-Anchor" href="#3-æ„å»ºæ¨¡å‹"></a> 3 æ„å»ºæ¨¡å‹</h1><p>ååˆ†ç®€å•çš„æ¨¡å‹ï¼šä¸€å±‚è¯åµŒå…¥ï¼Œä¸€å±‚å…¨è¿æ¥ï¼Œ<code>softmax</code> æ¿€æ´»</p><p>Tipsï¼šåˆå§‹åŒ–æƒé‡è¿™ä¸€ç‚¹æˆ‘ä¹‹å‰æ²¡æœ‰å¾ˆå¥½çš„æ¶‰åŠåˆ°â€¦</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">model <span class="token operator">=</span> TextSentiment<span class="token punctuation">(</span>vocab_size<span class="token punctuation">,</span> embed_dim<span class="token punctuation">,</span> num_class<span class="token punctuation">,</span> batch_size<span class="token punctuation">,</span> cutlen<span class="token punctuation">)</span><span class="token keyword">import</span> torch<span class="token punctuation">.</span>nn <span class="token keyword">as</span> nn<span class="token keyword">import</span> torch<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>functional <span class="token keyword">as</span> F<span class="token keyword">class</span> <span class="token class-name">TextSentiment</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> vocab_size<span class="token punctuation">,</span> embed_dim<span class="token punctuation">,</span> num_class<span class="token punctuation">,</span> batch_size<span class="token punctuation">,</span> cutlen<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token triple-quoted-string string">"""        :param vocab_size: æ•´ä¸ªè¯­æ–™åŒ…å«çš„ä¸åŒè¯æ±‡æ€»æ•°        :param embed_dim: æŒ‡å®šè¯åµŒå…¥çš„ç»´åº¦        :param num_class: æ–‡æœ¬åˆ†ç±»çš„ç±»åˆ«æ€»æ•°        """</span>        <span class="token comment"># super(TextSentiment, self).__init__()</span>        <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>vocab_size <span class="token operator">=</span> vocab_size        self<span class="token punctuation">.</span>embed_dim <span class="token operator">=</span> embed_dim        self<span class="token punctuation">.</span>num_class <span class="token operator">=</span> num_class        self<span class="token punctuation">.</span>batch_size <span class="token operator">=</span> batch_size        self<span class="token punctuation">.</span>cutlen <span class="token operator">=</span> cutlen        <span class="token comment"># sparse=True ä»£è¡¨æ¯æ¬¡å¯¹è¯¥å±‚æ›´æ–°æ—¶åªæ›´æ–°éƒ¨åˆ†æƒé‡</span>        self<span class="token punctuation">.</span>embedding <span class="token operator">=</span> nn<span class="token punctuation">.</span>Embedding<span class="token punctuation">(</span>vocab_size<span class="token punctuation">,</span> embed_dim<span class="token punctuation">,</span> sparse<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>fc <span class="token operator">=</span> nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span>embed_dim<span class="token punctuation">,</span> num_class<span class="token punctuation">)</span>        self<span class="token punctuation">.</span>init_weights<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">init_weights</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token comment"># æŒ‡å®šåˆå§‹åŒ–æƒé‡çš„å–å€¼èŒƒå›´ - ä¸€èˆ¬å°äº1</span>        initrange <span class="token operator">=</span> <span class="token number">0.5</span>        <span class="token comment"># Tips: åˆå§‹åŒ–ä¸ºå…¨ 0 çš„ç½‘ç»œååˆ†éš¾ä»¥è®­ç»ƒ</span>        <span class="token comment"># uniform - å‡åŒ€åˆ†å¸ƒ</span>        self<span class="token punctuation">.</span>embedding<span class="token punctuation">.</span>weight<span class="token punctuation">.</span>data<span class="token punctuation">.</span>uniform_<span class="token punctuation">(</span><span class="token operator">-</span>initrange<span class="token punctuation">,</span> initrange<span class="token punctuation">)</span>        <span class="token comment"># åç½®æ ¹æ®å…¶å«ä¹‰åˆå§‹åŒ–ä¸º 0 åˆ™æ²¡æœ‰å¤ªå¤§å½±å“</span>        self<span class="token punctuation">.</span>fc<span class="token punctuation">.</span>bias<span class="token punctuation">.</span>data<span class="token punctuation">.</span>zero_<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> text<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token triple-quoted-string string">"""        :param text: æ–‡æœ¬æ•°å€¼æ˜ å°„åçš„ç»“æ„        :return: ä¸ç±»åˆ«æ•°å°ºå¯¸ç›¸åŒçš„å¼ é‡        """</span>        <span class="token comment"># input: (batch * cutlen) - cutlen è¡¨ç¤ºå¥å­é•¿åº¦ - å°† batch æ¨ªå‘æ‹¼æ¥äº†, å¤šä¸ªè¯­å¥æ‹¼æ¥å¤„ç†ä¸ºäº†ä¸€ä¸ªè¯­å¥</span>        <span class="token comment"># label: (batch * 1)</span>        <span class="token comment"># example cutlen=4 : input = [ 1 2 3 4 1 2 3 4 1 2 3 4 ...], [ 1 2 1 ...]</span>        embedded <span class="token operator">=</span> self<span class="token punctuation">.</span>embedding<span class="token punctuation">(</span>text<span class="token punctuation">)</span>  <span class="token comment"># ((batch * cutlen), embed_dim)</span>        embedded <span class="token operator">=</span> embedded<span class="token punctuation">.</span>transpose<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span>unsqueeze<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>  <span class="token comment"># (1, embed_dim, (batch * cutlen))</span>        <span class="token comment"># avg pool - ä½œç”¨åœ¨è¡Œä¸Šï¼Œéœ€æ±‚ä¸‰ç»´</span>        embedded <span class="token operator">=</span> F<span class="token punctuation">.</span>avg_pool1d<span class="token punctuation">(</span>embedded<span class="token punctuation">,</span> kernel_size<span class="token operator">=</span>self<span class="token punctuation">.</span>cutlen<span class="token punctuation">)</span>  <span class="token comment"># å°†åŒä¸€ä¸ªè¯­å¥ä¸­ï¼Œä¸åŒè¯çš„åµŒå…¥å–å¹³å‡</span>        <span class="token keyword">return</span> F<span class="token punctuation">.</span>softmax<span class="token punctuation">(</span>self<span class="token punctuation">.</span>fc<span class="token punctuation">(</span>embedded<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>transpose<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> dim<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="4-trainvalid"><a class="markdownIt-Anchor" href="#4-trainvalid"></a> 4 train&amp;valid</h1><ul><li>ä¿ç•™æœ€ä¼˜æ¨¡å‹ min_valid_loss</li><li>ç®€å•çš„ <code>SGD</code> ä¼˜åŒ–å™¨ä½†æ˜¯è£…å¤‡äº†åŠ¨æ€å­¦ä¹ ç‡è°ƒèŠ‚ scheduler</li></ul><pre class="line-numbers language-python" data-language="python"><code class="language-python">scheduler <span class="token operator">=</span> StepLR<span class="token punctuation">(</span>optimizer<span class="token punctuation">,</span> step_size<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> gamma<span class="token operator">=</span><span class="token number">0.9</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>æ›´æ–°ç­–ç•¥</strong>ï¼šstep_size æ§åˆ¶ç€æ›´æ–°é¢‘ç‡ï¼Œç›¸å½“äºæ¯ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>s</mi><mi>t</mi><mi>e</mi><mi>p</mi><mi mathvariant="normal">_</mi><mi>s</mi><mi>i</mi><mi>z</mi><mi>e</mi></mrow><annotation encoding="application/x-tex">step\_size</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9695199999999999em;vertical-align:-0.31em;"></span><span class="mord mathdefault">s</span><span class="mord mathdefault">t</span><span class="mord mathdefault">e</span><span class="mord mathdefault">p</span><span class="mord" style="margin-right:0.02778em;">_</span><span class="mord mathdefault">s</span><span class="mord mathdefault">i</span><span class="mord mathdefault" style="margin-right:0.04398em;">z</span><span class="mord mathdefault">e</span></span></span></span> æ¬¡è¿›è¡Œä¸€æ¬¡ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>Î³</mi></mrow><annotation encoding="application/x-tex">\gamma</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.05556em;">Î³</span></span></span></span> çš„æ›´æ–°ï¼Œæ›´æ–°çŠ¶æ€æ˜¯å åŠ çš„</p><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>l</mi><msup><mi>r</mi><mrow><mo stretchy="false">(</mo><mi>n</mi><mi>e</mi><mi>w</mi><mo stretchy="false">)</mo></mrow></msup><mo>=</mo><mi>l</mi><msup><mi>r</mi><mn>0</mn></msup><mo>Ã—</mo><msup><mi>Î³</mi><mrow><mi>e</mi><mi>p</mi><mi>o</mi><mi>c</mi><mi>h</mi><mi mathvariant="normal">/</mi><mi mathvariant="normal">/</mi><mi>s</mi><mi>t</mi><mi>e</mi><mi>p</mi><mi mathvariant="normal">_</mi><mi>s</mi><mi>i</mi><mi>z</mi><mi>e</mi></mrow></msup></mrow><annotation encoding="application/x-tex">lr^{(new)} = lr^0 \times \gamma^{epoch//step\_size}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.938em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.938em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathdefault mtight">n</span><span class="mord mathdefault mtight">e</span><span class="mord mathdefault mtight" style="margin-right:0.02691em;">w</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.9474379999999999em;vertical-align:-0.08333em;"></span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">Ã—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.13244em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.05556em;">Î³</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9379999999999998em;"><span style="top:-3.1130000000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">e</span><span class="mord mathdefault mtight">p</span><span class="mord mathdefault mtight">o</span><span class="mord mathdefault mtight">c</span><span class="mord mathdefault mtight">h</span><span class="mord mtight">/</span><span class="mord mtight">/</span><span class="mord mathdefault mtight">s</span><span class="mord mathdefault mtight">t</span><span class="mord mathdefault mtight">e</span><span class="mord mathdefault mtight">p</span><span class="mord mtight" style="margin-right:0.02778em;">_</span><span class="mord mathdefault mtight">s</span><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight" style="margin-right:0.04398em;">z</span><span class="mord mathdefault mtight">e</span></span></span></span></span></span></span></span></span></span></span></span></span></p><h2 id="main"><a class="markdownIt-Anchor" href="#main"></a> main</h2><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># è¶…å‚æ•°</span>embed_dim <span class="token operator">=</span> <span class="token number">128</span>batch_size <span class="token operator">=</span> <span class="token number">64</span>n_epochs <span class="token operator">=</span> <span class="token number">10</span>cutlen <span class="token operator">=</span> <span class="token number">64</span>model <span class="token operator">=</span> TextSentiment<span class="token punctuation">(</span>vocab_size<span class="token punctuation">,</span> embed_dim<span class="token punctuation">,</span> num_class<span class="token punctuation">,</span> batch_size<span class="token punctuation">,</span> cutlen<span class="token punctuation">)</span><span class="token comment"># å­˜å‚¨éªŒè¯é›†æ•ˆæœæœ€å¥½çš„æ¨¡å‹</span>min_valid_loss <span class="token operator">=</span> <span class="token builtin">float</span><span class="token punctuation">(</span><span class="token string">"inf"</span><span class="token punctuation">)</span>model_save_path <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>MODEL_DIR<span class="token punctuation">,</span> <span class="token string">"emb(&#123;&#125;)_batch(&#123;&#125;)_epoch(&#123;&#125;)_cutlen(&#123;&#125;).pth"</span><span class="token punctuation">)</span>criterion <span class="token operator">=</span> torch<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>CrossEntropyLoss<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">(</span>device<span class="token punctuation">)</span> <span class="token comment"># æŸå¤±å‡½æ•°</span>optimizer <span class="token operator">=</span> torch<span class="token punctuation">.</span>optim<span class="token punctuation">.</span>SGD<span class="token punctuation">(</span>model<span class="token punctuation">.</span>parameters<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> lr<span class="token operator">=</span><span class="token number">4.0</span><span class="token punctuation">)</span> <span class="token comment"># ä¼˜åŒ–å™¨</span>scheduler <span class="token operator">=</span> torch<span class="token punctuation">.</span>optim<span class="token punctuation">.</span>lr_scheduler<span class="token punctuation">.</span>StepLR<span class="token punctuation">(</span>optimizer<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> gamma<span class="token operator">=</span><span class="token number">0.9</span><span class="token punctuation">)</span> <span class="token comment"># å­¦ä¹ ç‡åŠ¨æ€è°ƒèŠ‚</span>train_len <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>train_datasets<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">0.95</span><span class="token punctuation">)</span>sub_train_<span class="token punctuation">,</span> sub_valid_ <span class="token operator">=</span> random_split<span class="token punctuation">(</span>    train_datasets<span class="token punctuation">,</span> <span class="token punctuation">[</span>train_len<span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>train_datasets<span class="token punctuation">)</span> <span class="token operator">-</span> train_len<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">for</span> epoch <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>n_epochs<span class="token punctuation">)</span><span class="token punctuation">:</span>    start_time <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>    train_loss<span class="token punctuation">,</span> train_acc <span class="token operator">=</span> fit<span class="token punctuation">(</span>sub_train_<span class="token punctuation">,</span>                                batch_size<span class="token punctuation">,</span>                                model<span class="token punctuation">,</span>                                criterion<span class="token punctuation">,</span>                                optimizer<span class="token operator">=</span>optimizer<span class="token punctuation">,</span>                                scheduler<span class="token operator">=</span>scheduler<span class="token punctuation">)</span>    valid_loss<span class="token punctuation">,</span> valid_acc <span class="token operator">=</span> fit<span class="token punctuation">(</span>sub_valid_<span class="token punctuation">,</span>                                batch_size<span class="token punctuation">,</span>                                model<span class="token punctuation">,</span>                                criterion<span class="token punctuation">,</span>                                optimizer<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>                                scheduler<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span>    <span class="token keyword">if</span><span class="token punctuation">(</span>valid_loss <span class="token operator">&lt;</span> min_valid_loss<span class="token punctuation">)</span><span class="token punctuation">:</span>        min_valid_loss <span class="token operator">=</span> valid_loss        torch<span class="token punctuation">.</span>save<span class="token punctuation">(</span>model<span class="token punctuation">.</span>state_dict<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> model_save_path<span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>embed_dim<span class="token punctuation">,</span> batch_size<span class="token punctuation">,</span> n_epochs<span class="token punctuation">,</span> cutlen<span class="token punctuation">)</span><span class="token punctuation">)</span>    secs <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> start_time<span class="token punctuation">)</span>    mins <span class="token operator">=</span> secs <span class="token operator">/</span> <span class="token number">60</span>    secs <span class="token operator">=</span> secs <span class="token operator">%</span> <span class="token number">60</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Epoch: %d"</span> <span class="token operator">%</span> <span class="token punctuation">(</span>epoch <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>          <span class="token string">" | time in %d minutes, %d seconds"</span> <span class="token operator">%</span> <span class="token punctuation">(</span>mins<span class="token punctuation">,</span> secs<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>        <span class="token string-interpolation"><span class="token string">f"\tLoss: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>train_loss<span class="token punctuation">:</span><span class="token format-spec">.4f</span><span class="token punctuation">&#125;</span></span><span class="token string">(train)\t|\tAcc: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>train_acc <span class="token operator">*</span> <span class="token number">100</span><span class="token punctuation">:</span><span class="token format-spec">.1f</span><span class="token punctuation">&#125;</span></span><span class="token string">%(train)"</span></span>    <span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>        <span class="token string-interpolation"><span class="token string">f"\tLoss: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>valid_loss<span class="token punctuation">:</span><span class="token format-spec">.4f</span><span class="token punctuation">&#125;</span></span><span class="token string">(valid)\t|\tAcc: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>valid_acc <span class="token operator">*</span> <span class="token number">100</span><span class="token punctuation">:</span><span class="token format-spec">.1f</span><span class="token punctuation">&#125;</span></span><span class="token string">%(valid)"</span></span>    <span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="fit"><a class="markdownIt-Anchor" href="#fit"></a> fit</h2><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">generate_batch</span><span class="token punctuation">(</span>batch<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""[summary]    Args:        batch ([type]): [description] ç”±æ ·æœ¬å¼ é‡å’Œå¯¹åº”æ ‡ç­¾çš„å…ƒç¥– ç»„æˆçš„ batch_size å¤§å°çš„åˆ—è¡¨            [(sample1, label1), (sample2, label2), ..., (samplen, labeln)]    :return æ ·æœ¬å¼ é‡å’Œæ ‡ç­¾å„è‡ªçš„åˆ—è¡¨å½¢å¼(Tensor)    """</span>    text <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>    label <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>    <span class="token keyword">for</span> item <span class="token keyword">in</span> batch<span class="token punctuation">:</span>        text<span class="token punctuation">.</span>extend<span class="token punctuation">(</span>item<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>        label<span class="token punctuation">.</span>append<span class="token punctuation">(</span>item<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> torch<span class="token punctuation">.</span>tensor<span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">,</span> torch<span class="token punctuation">.</span>tensor<span class="token punctuation">(</span>label<span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">fit</span><span class="token punctuation">(</span>        data<span class="token punctuation">,</span>        batch_size<span class="token punctuation">,</span>        model<span class="token punctuation">,</span>        criterion<span class="token punctuation">,</span>        optimizer<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>  <span class="token comment"># optimizer = None åˆ™è¡¨ç¤ºå½“å‰ä¸º test / validation</span>        scheduler<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""æ¨¡å‹è®­ç»ƒå‡½æ•°"""</span>    total_loss <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">.</span>    total_acc <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">.</span>    data <span class="token operator">=</span> DataLoader<span class="token punctuation">(</span>data<span class="token punctuation">,</span>                      batch_size<span class="token operator">=</span>batch_size<span class="token punctuation">,</span>                      shuffle<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>                      collate_fn<span class="token operator">=</span>generate_batch<span class="token punctuation">)</span>    <span class="token keyword">for</span> i<span class="token punctuation">,</span> <span class="token punctuation">(</span>text<span class="token punctuation">,</span> cls<span class="token punctuation">)</span> <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>optimizer<span class="token punctuation">)</span><span class="token punctuation">:</span>            optimizer<span class="token punctuation">.</span>zero_grad<span class="token punctuation">(</span><span class="token punctuation">)</span>            output <span class="token operator">=</span> model<span class="token punctuation">(</span>text<span class="token punctuation">)</span>            loss <span class="token operator">=</span> criterion<span class="token punctuation">(</span>output<span class="token punctuation">,</span> cls<span class="token punctuation">)</span>            total_loss <span class="token operator">+=</span> loss<span class="token punctuation">.</span>item<span class="token punctuation">(</span><span class="token punctuation">)</span>            loss<span class="token punctuation">.</span>backward<span class="token punctuation">(</span><span class="token punctuation">)</span>            optimizer<span class="token punctuation">.</span>step<span class="token punctuation">(</span><span class="token punctuation">)</span>            total_acc <span class="token operator">+=</span> <span class="token punctuation">(</span>output<span class="token punctuation">.</span>argmax<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">==</span> cls<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>item<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token builtin">len</span><span class="token punctuation">(</span>cls<span class="token punctuation">)</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            <span class="token keyword">with</span> torch<span class="token punctuation">.</span>no_grad<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                output <span class="token operator">=</span> model<span class="token punctuation">(</span>text<span class="token punctuation">)</span>                loss <span class="token operator">=</span> criterion<span class="token punctuation">(</span>output<span class="token punctuation">,</span> cls<span class="token punctuation">)</span>                total_loss <span class="token operator">+=</span> loss<span class="token punctuation">.</span>item<span class="token punctuation">(</span><span class="token punctuation">)</span>                total_acc <span class="token operator">+=</span> <span class="token punctuation">(</span>output<span class="token punctuation">.</span>argmax<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">==</span> cls<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>item<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token builtin">len</span><span class="token punctuation">(</span>cls<span class="token punctuation">)</span>    <span class="token comment"># è°ƒæ•´ä¼˜åŒ–å™¨å­¦ä¹ ç‡</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>scheduler<span class="token punctuation">)</span><span class="token punctuation">:</span>        scheduler<span class="token punctuation">.</span>step<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> total_loss <span class="token operator">/</span> <span class="token builtin">len</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">,</span> total_acc <span class="token operator">/</span> <span class="token builtin">len</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="5-test"><a class="markdownIt-Anchor" href="#5-test"></a> 5 test</h1><p>åç»­æˆ‘è‡ªå·±åšäº†ç®€å•çš„ <code>king - woman + man =? queen</code> çš„æµ‹è¯•ï¼Œæµ‹è¯•ç»“æœå¹¶ä¸ç†æƒ³ï¼Œä½†æ˜¯æ–°é—»ä¸»é¢˜åˆ†ç±»çš„å‡†ç¡®ç‡ç¡®å®ä¸ä½ï¼Œå¯èƒ½è¿˜æ˜¯ä»»åŠ¡ä¾§é‡ç‚¹ä¸åŒ~</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"test..."</span><span class="token punctuation">)</span>model<span class="token punctuation">.</span>load_state_dict<span class="token punctuation">(</span>    torch<span class="token punctuation">.</span>load<span class="token punctuation">(</span>model_save_path<span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>embed_dim<span class="token punctuation">,</span> batch_size<span class="token punctuation">,</span> n_epochs<span class="token punctuation">,</span>                                      cutlen<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>test_loss<span class="token punctuation">,</span> test_acc <span class="token operator">=</span> fit<span class="token punctuation">(</span>test_datasets<span class="token punctuation">,</span>                          batch_size<span class="token punctuation">,</span>                          model<span class="token punctuation">,</span>                          criterion<span class="token punctuation">,</span>                          optimizer<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>                          scheduler<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>    <span class="token string-interpolation"><span class="token string">f"\tLoss: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>test_loss<span class="token punctuation">:</span><span class="token format-spec">.4f</span><span class="token punctuation">&#125;</span></span><span class="token string">(test)\t|\tAcc: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>test_acc <span class="token operator">*</span> <span class="token number">100</span><span class="token punctuation">:</span><span class="token format-spec">.1f</span><span class="token punctuation">&#125;</span></span><span class="token string">%(test)"</span></span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> NLP </category>
          
      </categories>
      
      
        <tags>
            
            <tag> DL </tag>
            
            <tag> pytorch </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Word2Vecç†è®ºä»‹ç»ä¸æ¨å¯¼</title>
      <link href="/Coming-blog/2021/07/12/word2vec-li-lun-jie-shao-yu-tui-dao/"/>
      <url>/Coming-blog/2021/07/12/word2vec-li-lun-jie-shao-yu-tui-dao/</url>
      
        <content type="html"><![CDATA[<p>æœ¬æ–‡ä¸»è¦æ ¹æ®è®ºæ–‡ã€Šword2vec Parameter Learning Explainedã€‹è¿›è¡Œä»‹ç»ï¼Œéƒ¨åˆ†å†…å®¹æ·»åŠ äº†è‡ªå·±çš„ç†è§£ä¸æ€è€ƒï¼Œè¿˜æœ›å¤§å®¶æ‰¹è¯„æŒ‡æ­£ã€‚</p><h1 id="æ¦‚å¿µ"><a class="markdownIt-Anchor" href="#æ¦‚å¿µ"></a> æ¦‚å¿µ</h1><h2 id="åå‘ä¼ æ’­åŸºç¡€"><a class="markdownIt-Anchor" href="#åå‘ä¼ æ’­åŸºç¡€"></a> åå‘ä¼ æ’­åŸºç¡€</h2><p><strong>Back Propagation Basics</strong></p><h3 id="å•ä¸€ç¥ç»å…ƒ"><a class="markdownIt-Anchor" href="#å•ä¸€ç¥ç»å…ƒ"></a> å•ä¸€ç¥ç»å…ƒ</h3><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20210711175018396.png" alt="image-20210711175018396" /></p><p>å¦‚å›¾ä¸ºäººå·¥ç¥ç»å…ƒï¼ˆartificial  neuron unitï¼‰ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo stretchy="false">{</mo><msub><mi>x</mi><mn>1</mn></msub><mo separator="true">,</mo><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mo separator="true">,</mo><msub><mi>x</mi><mi>k</mi></msub><mo stretchy="false">}</mo></mrow><annotation encoding="application/x-tex">\{x_1,...,x_k\}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">{</span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">.</span><span class="mord">.</span><span class="mord">.</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">}</span></span></span></span> ä¸ºè¾“å…¥å‘é‡ï¼Œ<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo stretchy="false">{</mo><msub><mi>w</mi><mn>1</mn></msub><mo separator="true">,</mo><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mo separator="true">,</mo><msub><mi>w</mi><mi>k</mi></msub><mo stretchy="false">}</mo></mrow><annotation encoding="application/x-tex">\{w_1,...,w_k\}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">{</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">.</span><span class="mord">.</span><span class="mord">.</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">}</span></span></span></span> ä¸ºå¯¹åº”çš„æƒé‡ï¼Œ<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>f</mi></mrow><annotation encoding="application/x-tex">f</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span></span></span></span> ä¸ºæ¿€æ´»ï¼ˆéçº¿æ€§ï¼‰å‡½æ•°ï¼Œ<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>y</mi></mrow><annotation encoding="application/x-tex">y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">y</span></span></span></span> æ˜¯è¾“å‡ºç»“æœ</p><ol><li>è¾“å…¥å‘é‡ä¸æƒé‡å‘é‡è¿›è¡Œå†…ç§¯æ“ä½œï¼Œå…¶ç»“æœæˆ‘ä»¬èµ‹å€¼ç»™<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>u</mi></mrow><annotation encoding="application/x-tex">u</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">u</span></span></span></span>ï¼š</li></ol><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><munderover><mo>âˆ‘</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>K</mi></munderover><msub><mi>x</mi><mi>i</mi></msub><msub><mi>w</mi><mi>i</mi></msub><mo>=</mo><msup><mi mathvariant="bold">w</mi><mi>T</mi></msup><mi mathvariant="bold">x</mi><mo>:</mo><mo>=</mo><mi>u</mi></mrow><annotation encoding="application/x-tex">\sum_{i=1}^{K}x_iw_i = \mathbf{w}^T\mathbf{x}:= u</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:3.106005em;vertical-align:-1.277669em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.8283360000000002em;"><span style="top:-1.872331em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.050005em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">âˆ‘</span></span></span><span style="top:-4.3000050000000005em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.07153em;">K</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.277669em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.8913309999999999em;vertical-align:0em;"></span><span class="mord"><span class="mord"><span class="mord mathbf" style="margin-right:0.01597em;">w</span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8913309999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span><span class="mord"><span class="mord mathbf">x</span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">:</span></span><span class="base"><span class="strut" style="height:0.36687em;vertical-align:0em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">u</span></span></span></span></span></p><ol start="2"><li><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>u</mi></mrow><annotation encoding="application/x-tex">u</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">u</span></span></span></span> è¾“å…¥åˆ°ç¥ç»å…ƒä¸­ï¼Œè¿›è¡Œæ¿€æ´»ï¼š</li></ol><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>y</mi><mo>=</mo><mi>f</mi><mo stretchy="false">(</mo><mi>u</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">y = f(u)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord mathdefault">u</span><span class="mclose">)</span></span></span></span></span></p><ol start="3"><li>æ±‚å¯¼æ›´æ–°æƒé‡ï¼Œå…¶ä¸­ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>t</mi></mrow><annotation encoding="application/x-tex">t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.61508em;vertical-align:0em;"></span><span class="mord mathdefault">t</span></span></span></span> ä¸ºçœŸå®æ ‡ç­¾ï¼Œ<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>y</mi></mrow><annotation encoding="application/x-tex">y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">y</span></span></span></span> è¡¨ç¤ºé¢„æµ‹çš„æ ‡ç­¾å€¼ï¼Œ<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>y</mi></mrow><annotation encoding="application/x-tex">y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">y</span></span></span></span> å¯¹ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="bold">w</mi></mrow><annotation encoding="application/x-tex">\mathbf{w}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.44444em;vertical-align:0em;"></span><span class="mord"><span class="mord mathbf" style="margin-right:0.01597em;">w</span></span></span></span></span> æ±‚åå¯¼ä¸º <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="bold">x</mi></mrow><annotation encoding="application/x-tex">\mathbf{x}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.44444em;vertical-align:0em;"></span><span class="mord"><span class="mord mathbf">x</span></span></span></span></span></li></ol><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mi mathvariant="bold">w</mi><mrow><mi>n</mi><mi>e</mi><mi>w</mi></mrow></msup><mo>=</mo><msup><mi mathvariant="bold">w</mi><mrow><mi>o</mi><mi>l</mi><mi>d</mi></mrow></msup><mo>âˆ’</mo><mi>Î·</mi><mo>â‹…</mo><mo stretchy="false">(</mo><mi>y</mi><mo>âˆ’</mo><mi>t</mi><mo stretchy="false">)</mo><mo>â‹…</mo><mi mathvariant="bold">x</mi></mrow><annotation encoding="application/x-tex">\mathbf{w}^{new} = \mathbf{w}^{old}-\eta \cdot (y-t) \cdot \mathbf{x}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7143919999999999em;vertical-align:0em;"></span><span class="mord"><span class="mord"><span class="mord mathbf" style="margin-right:0.01597em;">w</span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7143919999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">n</span><span class="mord mathdefault mtight">e</span><span class="mord mathdefault mtight" style="margin-right:0.02691em;">w</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.9824379999999999em;vertical-align:-0.08333em;"></span><span class="mord"><span class="mord"><span class="mord mathbf" style="margin-right:0.01597em;">w</span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8991079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">o</span><span class="mord mathdefault mtight" style="margin-right:0.01968em;">l</span><span class="mord mathdefault mtight">d</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.63889em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">Î·</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">â‹…</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault">t</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">â‹…</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.44444em;vertical-align:0em;"></span><span class="mord"><span class="mord mathbf">x</span></span></span></span></span></span></p><p>è¿™é‡Œæˆ‘ä»¬æ²¡æœ‰è€ƒè™‘åˆ°æ¿€æ´»å‡½æ•°å’ŒæŸå¤±å‡½æ•°ï¼Œåªç®€å•çš„è®©è¯¯åˆ†ç±»æ ·æœ¬ä½œåå‘ä¼ æ’­ã€‚å¦‚æœæ¿€æ´»å‡½æ•°è¿ç»­å¯å¯¼æˆ–æœ‰å…·ä½“çš„æŸå¤±å‡½æ•°ï¼Œè¿˜æ˜¯éœ€è¦è€ƒè™‘è¿›æ¥çš„ã€‚</p><p>ä¾‹å¦‚æˆ‘ä»¬å¼•å…¥æ¿€æ´»å‡½æ•° Sigmoid æ¿€æ´»å‡½æ•°ï¼š<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>Ïƒ</mi><mo stretchy="false">(</mo><mi>u</mi><mo stretchy="false">)</mo><mo>=</mo><mstyle displaystyle="true" scriptlevel="0"><mfrac><mn>1</mn><mrow><mn>1</mn><mo>+</mo><msup><mi>e</mi><mrow><mo>âˆ’</mo><mi>u</mi></mrow></msup></mrow></mfrac></mstyle></mrow><annotation encoding="application/x-tex">\sigma (u) = \dfrac{1}{1+e^{-u} }</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">Ïƒ</span><span class="mopen">(</span><span class="mord mathdefault">u</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.09077em;vertical-align:-0.7693300000000001em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.32144em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.697331em;"><span style="top:-2.989em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">âˆ’</span><span class="mord mathdefault mtight">u</span></span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.7693300000000001em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span> ï¼Œå…¶å‡½æ•°å›¾åƒä¸ºï¼š</p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20210711181646466.png" alt="image-20210711181646466" style="zoom:50%;" /><p>å•ä»å‡½æ•°å›¾åƒå¯ä»¥çœ‹å‡ºï¼šå…¶å¤„å¤„è¿ç»­å¯å¯¼ï¼Œå€¼åŸŸ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>y</mi><mo>âˆˆ</mo><mo stretchy="false">[</mo><mn>0</mn><mo separator="true">,</mo><mn>1</mn><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">y \in [0,1]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7335400000000001em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">âˆˆ</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">1</span><span class="mclose">]</span></span></span></span></p><p>åœ¨å¼•å…¥ç®€å•çš„å¹³æ–¹å·®æŸå¤±å‡½æ•°ï¼š<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>E</mi><mo>=</mo><mfrac><mn>1</mn><mn>2</mn></mfrac><mo stretchy="false">(</mo><mi>t</mi><mo>âˆ’</mo><mi>y</mi><msup><mo stretchy="false">)</mo><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">E = \frac{1}{2}(t-y)^2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.05764em;">E</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.190108em;vertical-align:-0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.845108em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mopen">(</span><span class="mord mathdefault">t</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.064108em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span></p><blockquote><p>ä¸ºä»€ä¹ˆæœ‰ä¸ª <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mfrac><mn>1</mn><mn>2</mn></mfrac></mrow><annotation encoding="application/x-tex">\frac{1}{2}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.190108em;vertical-align:-0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.845108em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span> å‘¢ï¼Ÿæ˜¯ä¸ºäº†åç»­åå‘ä¼ æ’­æ±‚å¯¼æ–¹ä¾¿è€Œæ·»åŠ çš„ï¼Œå¯¹ç»“æœæ˜¾ç„¶æ²¡æœ‰è¾ƒå¤§å½±å“</p></blockquote><ol start="3"><li>æ±‚å¯¼æ›´æ–°æƒé‡ï¼Œå…¶ä¸­ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>t</mi></mrow><annotation encoding="application/x-tex">t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.61508em;vertical-align:0em;"></span><span class="mord mathdefault">t</span></span></span></span> ä¸ºçœŸå®æ ‡ç­¾ï¼Œ<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>y</mi></mrow><annotation encoding="application/x-tex">y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">y</span></span></span></span> è¡¨ç¤ºé¢„æµ‹çš„æ ‡ç­¾å€¼ï¼Œ<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>y</mi></mrow><annotation encoding="application/x-tex">y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">y</span></span></span></span> å¯¹ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="bold">w</mi></mrow><annotation encoding="application/x-tex">\mathbf{w}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.44444em;vertical-align:0em;"></span><span class="mord"><span class="mord mathbf" style="margin-right:0.01597em;">w</span></span></span></span></span> æ±‚åå¯¼ä¸º <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="bold">x</mi></mrow><annotation encoding="application/x-tex">\mathbf{x}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.44444em;vertical-align:0em;"></span><span class="mord"><span class="mord mathbf">x</span></span></span></span></span></li></ol><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mfrac><mrow><mi mathvariant="normal">âˆ‚</mi><mi>E</mi></mrow><mrow><mi mathvariant="normal">âˆ‚</mi><msub><mi>w</mi><mi>i</mi></msub></mrow></mfrac><mo>=</mo><mfrac><mrow><mi mathvariant="normal">âˆ‚</mi><mi>E</mi></mrow><mrow><mi mathvariant="normal">âˆ‚</mi><mi>y</mi></mrow></mfrac><mo>â‹…</mo><mfrac><mrow><mi mathvariant="normal">âˆ‚</mi><mi>y</mi></mrow><mrow><mi mathvariant="normal">âˆ‚</mi><mi>u</mi></mrow></mfrac><mo>â‹…</mo><mfrac><mrow><mi mathvariant="normal">âˆ‚</mi><mi>u</mi></mrow><mrow><mi mathvariant="normal">âˆ‚</mi><msub><mi>w</mi><mi>i</mi></msub></mrow></mfrac><mo>=</mo><mo stretchy="false">(</mo><mi>y</mi><mo>âˆ’</mo><mi>t</mi><mo stretchy="false">)</mo><mo>â‹…</mo><mi>y</mi><mo stretchy="false">(</mo><mn>1</mn><mo>âˆ’</mo><mi>y</mi><mo stretchy="false">)</mo><mo>â‹…</mo><msub><mi>x</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">\dfrac{\partial{E} }{\partial{w_i} } = \dfrac{\partial{E} }{\partial{y} } \cdot \dfrac{\partial{y} }{\partial{u} } \cdot \dfrac{\partial{u} }{\partial{w_i} } = (y-t) \cdot y(1-y) \cdot x_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:2.20744em;vertical-align:-0.8360000000000001em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.37144em;"><span style="top:-2.3139999999999996em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">âˆ‚</span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">âˆ‚</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.05764em;">E</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.8360000000000001em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.25188em;vertical-align:-0.8804400000000001em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.37144em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">âˆ‚</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">y</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">âˆ‚</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.05764em;">E</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.8804400000000001em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">â‹…</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:2.0574399999999997em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3714399999999998em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">âˆ‚</span><span class="mord"><span class="mord mathdefault">u</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">âˆ‚</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">y</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">â‹…</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:2.20744em;vertical-align:-0.8360000000000001em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.37144em;"><span style="top:-2.3139999999999996em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">âˆ‚</span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">âˆ‚</span><span class="mord"><span class="mord mathdefault">u</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.8360000000000001em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault">t</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">â‹…</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">â‹…</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span></p><blockquote><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mfrac><mrow><mi mathvariant="normal">âˆ‚</mi><mi>y</mi></mrow><mrow><mi mathvariant="normal">âˆ‚</mi><mi>u</mi></mrow></mfrac><mo>=</mo><mo stretchy="false">[</mo><mo stretchy="false">(</mo><mn>1</mn><mo>+</mo><msup><mi>e</mi><mrow><mo>âˆ’</mo><mi>u</mi></mrow></msup><msup><mo stretchy="false">)</mo><mrow><mo>âˆ’</mo><mn>1</mn></mrow></msup><msup><mo stretchy="false">]</mo><mo mathvariant="normal">â€²</mo></msup><mo>=</mo><mo>âˆ’</mo><mo stretchy="false">(</mo><mn>1</mn><mo>+</mo><msup><mi>e</mi><mrow><mo>âˆ’</mo><mi>u</mi></mrow></msup><msup><mo stretchy="false">)</mo><mrow><mo>âˆ’</mo><mn>2</mn></mrow></msup><mo>Ã—</mo><mo stretchy="false">(</mo><mo>âˆ’</mo><msup><mi>e</mi><mrow><mo>âˆ’</mo><mi>u</mi></mrow></msup><mo stretchy="false">)</mo><mspace linebreak="newline"></mspace><mo>=</mo><mfrac><mn>1</mn><mrow><mn>1</mn><mo>+</mo><msup><mi>e</mi><mrow><mo>âˆ’</mo><mi>u</mi></mrow></msup></mrow></mfrac><mo>Ã—</mo><mfrac><mrow><mo stretchy="false">(</mo><mn>1</mn><mo>+</mo><msup><mi>e</mi><mrow><mo>âˆ’</mo><mi>u</mi></mrow></msup><mo stretchy="false">)</mo><mo>âˆ’</mo><mn>1</mn></mrow><mrow><mn>1</mn><mo>+</mo><msup><mi>e</mi><mrow><mo>âˆ’</mo><mi>u</mi></mrow></msup></mrow></mfrac><mo>=</mo><mi>y</mi><mo>â‹…</mo><mo stretchy="false">(</mo><mn>1</mn><mo>âˆ’</mo><mi>y</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\dfrac{\partial{y} }{\partial{u} }= [(1+e^{-u})^{-1}]&#x27; = -(1+e^{-u})^{-2} \times (-e^{-u}) \\= \dfrac{1}{1+e^{-u} } \times \dfrac{(1 + e^{-u}) - 1}{1+e^{-u} } = y \cdot (1-y)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:2.0574399999999997em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3714399999999998em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">âˆ‚</span><span class="mord"><span class="mord mathdefault">u</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">âˆ‚</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">y</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.1141079999999999em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathdefault">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.821331em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">âˆ’</span><span class="mord mathdefault mtight">u</span></span></span></span></span></span></span></span></span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.864108em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">âˆ’</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mclose"><span class="mclose">]</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.801892em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">âˆ’</span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.1141079999999999em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathdefault">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.821331em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">âˆ’</span><span class="mord mathdefault mtight">u</span></span></span></span></span></span></span></span></span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.864108em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">âˆ’</span><span class="mord mtight">2</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">Ã—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.071331em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">âˆ’</span><span class="mord"><span class="mord mathdefault">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.821331em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">âˆ’</span><span class="mord mathdefault mtight">u</span></span></span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:0.36687em;vertical-align:0em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.09077em;vertical-align:-0.7693300000000001em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.32144em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.697331em;"><span style="top:-2.989em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">âˆ’</span><span class="mord mathdefault mtight">u</span></span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.7693300000000001em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">Ã—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:2.217661em;vertical-align:-0.7693300000000001em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.448331em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.697331em;"><span style="top:-2.989em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">âˆ’</span><span class="mord mathdefault mtight">u</span></span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.771331em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">âˆ’</span><span class="mord mathdefault mtight">u</span></span></span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.7693300000000001em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.63889em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">â‹…</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="mclose">)</span></span></span></span></span></p></blockquote><p>ä¹Ÿå°±å¾—åˆ°äº†æƒé‡çš„æ›´æ–°ç­–ç•¥ï¼š</p><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mi mathvariant="bold">w</mi><mrow><mi>n</mi><mi>e</mi><mi>w</mi></mrow></msup><mo>=</mo><msup><mi mathvariant="bold">w</mi><mrow><mi>o</mi><mi>l</mi><mi>d</mi></mrow></msup><mo>âˆ’</mo><mi>Î·</mi><mo>â‹…</mo><mo stretchy="false">(</mo><mi>y</mi><mo>âˆ’</mo><mi>t</mi><mo stretchy="false">)</mo><mo>â‹…</mo><mi>y</mi><mo stretchy="false">(</mo><mn>1</mn><mo>âˆ’</mo><mi>y</mi><mo stretchy="false">)</mo><mo>â‹…</mo><mi mathvariant="bold">x</mi></mrow><annotation encoding="application/x-tex">\mathbf{w}^{new} = \mathbf{w}^{old} - \eta \cdot (y-t) \cdot y(1-y) \cdot \mathbf{x}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7143919999999999em;vertical-align:0em;"></span><span class="mord"><span class="mord"><span class="mord mathbf" style="margin-right:0.01597em;">w</span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7143919999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">n</span><span class="mord mathdefault mtight">e</span><span class="mord mathdefault mtight" style="margin-right:0.02691em;">w</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.9824379999999999em;vertical-align:-0.08333em;"></span><span class="mord"><span class="mord"><span class="mord mathbf" style="margin-right:0.01597em;">w</span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8991079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">o</span><span class="mord mathdefault mtight" style="margin-right:0.01968em;">l</span><span class="mord mathdefault mtight">d</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.63889em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">Î·</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">â‹…</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault">t</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">â‹…</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">â‹…</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.44444em;vertical-align:0em;"></span><span class="mord"><span class="mord mathbf">x</span></span></span></span></span></span></p><h3 id="å¤šå±‚ç¥ç»ç½‘ç»œ"><a class="markdownIt-Anchor" href="#å¤šå±‚ç¥ç»ç½‘ç»œ"></a> å¤šå±‚ç¥ç»ç½‘ç»œ</h3><p>å•ä¸€ç¥ç»å…ƒä¸‹çš„åå‘ä¼ æ’­æ±‚å¯¼å¤§è‡´æ˜ç™½å•¦ï¼Œé‚£æ¥ä¸‹æ¥æ¨å¹¿åˆ°å¤šç¥ç»å…ƒå¤šå±‚ç½‘ç»œçš„æƒ…å†µï¼š</p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20210711190544339.png" alt="image-20210711190544339" style="zoom: 80%;" /><p>æˆ‘ä»¬çš„è¾“å…¥ä¸º <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>x</mi><mi>k</mi></msub><mo>=</mo><mo stretchy="false">{</mo><msub><mi>x</mi><mn>1</mn></msub><mo separator="true">,</mo><mo>â€¦</mo><mo separator="true">,</mo><msub><mi>x</mi><mi>K</mi></msub><mo stretchy="false">}</mo></mrow><annotation encoding="application/x-tex">{x_k} = \{x_1,\dots,x_K\}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">{</span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner">â€¦</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.07153em;">K</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">}</span></span></span></span> ï¼Œéšè—å±‚ç¥ç»å…ƒä¸ºï¼š<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>h</mi><mi>i</mi></msub><mo>=</mo><mo stretchy="false">{</mo><msub><mi>h</mi><mn>1</mn></msub><mo separator="true">,</mo><mo>â€¦</mo><mo separator="true">,</mo><msub><mi>h</mi><mi>N</mi></msub><mo stretchy="false">}</mo></mrow><annotation encoding="application/x-tex">{h_i} = \{h_1,\dots,h_N\}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.84444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">{</span><span class="mord"><span class="mord mathdefault">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner">â€¦</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.10903em;">N</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">}</span></span></span></span>ï¼Œè¾“å‡ºå±‚ä¸º <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>y</mi><mi>j</mi></msub><mo>=</mo><mo stretchy="false">{</mo><msub><mi>y</mi><mn>1</mn></msub><mo separator="true">,</mo><mo>â€¦</mo><msub><mi>y</mi><mi>M</mi></msub><mo stretchy="false">}</mo></mrow><annotation encoding="application/x-tex">{y_j}=\{y_1,\dots y_M\}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.716668em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">{</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner">â€¦</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.10903em;">M</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">}</span></span></span></span></p><blockquote><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç°åœ¨çš„æ“ä½œéƒ½è¿˜æ²¡æœ‰çŸ©é˜µåŒ–ï¼Œä¸€æ¬¡ä»…å¤„ç†ä¸€ä¸ªè¾“å…¥ï¼Œå¾—åˆ°ä¸€ä¸ª <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>M</mi></mrow><annotation encoding="application/x-tex">M</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.10903em;">M</span></span></span></span> ç»´çš„è¾“å‡ºï¼Œä»¥æ­¤å®Œæˆä¸€æ¬¡ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>M</mi></mrow><annotation encoding="application/x-tex">M</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.10903em;">M</span></span></span></span> åˆ†ç±»ä»»åŠ¡</p></blockquote><p>ä¸å•ä¸€ç¥ç»å…ƒç±»ä¼¼</p><ol><li>å¯¹è¾“å…¥å±‚è¿›è¡ŒåŠ æƒæ±‚å’Œå¹¶æ¿€æ´»å¾—åˆ°éšè—å±‚çš„ç»“æœ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>h</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">h_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.84444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></li></ol><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>h</mi><mi>i</mi></msub><mo>=</mo><mi>Ïƒ</mi><mo stretchy="false">(</mo><msub><mi>u</mi><mi>i</mi></msub><mo stretchy="false">)</mo><mo>=</mo><mi>Ïƒ</mi><mo stretchy="false">(</mo><munderover><mo>âˆ‘</mo><mrow><mi>k</mi><mo>=</mo><mn>1</mn></mrow><mi>K</mi></munderover><msub><mi>w</mi><mrow><mi>k</mi><mi>i</mi></mrow></msub><msub><mi>x</mi><mi>k</mi></msub><mo stretchy="false">)</mo><mo>=</mo><mi>Ïƒ</mi><mo stretchy="false">(</mo><mi mathvariant="bold">W</mi><mi mathvariant="bold">x</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">h_i = \sigma(u_i) = \sigma(\sum_{k=1}^{K} w_{ki}x_k) = \sigma(\mathbf{W}\mathbf{x})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.84444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">Ïƒ</span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">u</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:3.1304490000000005em;vertical-align:-1.302113em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">Ïƒ</span><span class="mopen">(</span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.8283360000000002em;"><span style="top:-1.8478869999999998em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.03148em;">k</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.0500049999999996em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">âˆ‘</span></span></span><span style="top:-4.300005em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.07153em;">K</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.302113em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.03148em;">k</span><span class="mord mathdefault mtight">i</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">Ïƒ</span><span class="mopen">(</span><span class="mord"><span class="mord mathbf" style="margin-right:0.01597em;">W</span></span><span class="mord"><span class="mord mathbf">x</span></span><span class="mclose">)</span></span></span></span></span></p><ol start="2"><li>å†æ¬¡å‰å‘ä¼ æ’­ï¼Œå¾—åˆ°è¾“å‡ºå±‚çš„ç»“æœ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>y</mi><mi>j</mi></msub></mrow><annotation encoding="application/x-tex">y_j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.716668em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span></li></ol><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>y</mi><mi>j</mi></msub><mo>=</mo><mi>Ïƒ</mi><mo stretchy="false">(</mo><msubsup><mi>u</mi><mi>j</mi><msup><mrow></mrow><mo mathvariant="normal">â€²</mo></msup></msubsup><mo stretchy="false">)</mo><mo>=</mo><mi>Ïƒ</mi><mrow><mo fence="true">(</mo><munderover><mo>âˆ‘</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>N</mi></munderover><msub><mi>w</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><msub><mi>h</mi><mi>i</mi></msub><mo fence="true">)</mo></mrow><mo>=</mo><mi>Ïƒ</mi><mo stretchy="false">(</mo><msup><mi mathvariant="bold">W</mi><mo mathvariant="bold">â€²</mo></msup><mi mathvariant="bold">h</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">y_j = \sigma(u_j^{&#x27;}) = \sigma\left(\sum_{i=1}^{N} w_{ij}h_i\right) = \sigma(\mathbf{W&#x27;}\mathbf{h})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.716668em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.375588em;vertical-align:-0.383108em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">Ïƒ</span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">u</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.99248em;"><span style="top:-2.4530000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span><span style="top:-3.1130000000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8278285714285715em;"><span style="top:-2.931em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.383108em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:3.106005em;vertical-align:-1.277669em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">Ïƒ</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size4">(</span></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.8283360000000002em;"><span style="top:-1.872331em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.050005em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">âˆ‘</span></span></span><span style="top:-4.3000050000000005em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.10903em;">N</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.277669em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathdefault">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size4">)</span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.051892em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">Ïƒ</span><span class="mopen">(</span><span class="mord"><span class="mord"><span class="mord mathbf" style="margin-right:0.01597em;">W</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.801892em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathbf mtight">â€²</span></span></span></span></span></span></span></span></span></span><span class="mord"><span class="mord mathbf">h</span></span><span class="mclose">)</span></span></span></span></span></p><ol start="3"><li>ä½¿ç”¨å¹³æ–¹å·®æŸå¤±å‡½æ•°ï¼š</li></ol><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>E</mi><mo stretchy="false">(</mo><mi mathvariant="bold">x</mi><mo separator="true">,</mo><mi mathvariant="bold">t</mi><mo separator="true">,</mo><mi mathvariant="bold">W</mi><mo separator="true">,</mo><msup><mi mathvariant="bold">W</mi><mo mathvariant="bold">â€²</mo></msup><mo stretchy="false">)</mo><mo>=</mo><mfrac><mn>1</mn><mn>2</mn></mfrac><munderover><mo>âˆ‘</mo><mrow><mi>j</mi><mo>=</mo><mn>1</mn></mrow><mi>M</mi></munderover><mo stretchy="false">(</mo><msub><mi>y</mi><mi>j</mi></msub><mo>âˆ’</mo><msub><mi>t</mi><mi>j</mi></msub><msup><mo stretchy="false">)</mo><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">E(\mathbf{x},\mathbf{t},\mathbf{W},\mathbf{W&#x27;})= \frac{1}{2}\sum_{j=1}^{M}(y_j - t_j) ^2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.051892em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.05764em;">E</span><span class="mopen">(</span><span class="mord"><span class="mord mathbf">x</span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathbf">t</span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathbf" style="margin-right:0.01597em;">W</span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord"><span class="mord mathbf" style="margin-right:0.01597em;">W</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.801892em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathbf mtight">â€²</span></span></span></span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:3.2421130000000007em;vertical-align:-1.4137769999999998em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.32144em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">2</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.8283360000000006em;"><span style="top:-1.872331em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.050005em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">âˆ‘</span></span></span><span style="top:-4.3000050000000005em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.10903em;">M</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.4137769999999998em;"><span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.150216em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span></span></p><ol start="4"><li>åå‘ä¼ æ’­ï¼Œè¾“å‡ºå±‚åˆ°éšè—å±‚ï¼š</li></ol><p>4.1é¦–å…ˆæ˜¯æŸå¤±å‡½æ•°å¯¹è¾“å‡ºå±‚çš„åå‘ä¼ æ’­æ±‚å¯¼ï¼š</p><blockquote><p>æ³¨æ„è¿™é‡Œå¯¹ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>y</mi><mi>j</mi></msub></mrow><annotation encoding="application/x-tex">y_j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.716668em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span> æ±‚åå¯¼ï¼Œç›¸å½“äº <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>j</mi></mrow><annotation encoding="application/x-tex">j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.85396em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.05724em;">j</span></span></span></span> å·²çŸ¥ï¼Œå› æ­¤å¯ä»¥æ¶ˆé™¤æ±‚å’Œç¬¦å·</p></blockquote><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mfrac><mrow><mi mathvariant="normal">âˆ‚</mi><mi>E</mi></mrow><mrow><mi mathvariant="normal">âˆ‚</mi><msub><mi>y</mi><mi>j</mi></msub></mrow></mfrac><mo>=</mo><msub><mi>y</mi><mi>j</mi></msub><mo>âˆ’</mo><msub><mi>t</mi><mi>j</mi></msub></mrow><annotation encoding="application/x-tex">\dfrac{\partial{E} }{\partial{y_j} } = y_j - t_j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:2.343548em;vertical-align:-0.972108em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.37144em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">âˆ‚</span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">âˆ‚</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.05764em;">E</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.972108em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.8694379999999999em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.9011879999999999em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span></span></p><p>4.2 ç»§ç»­å‘ä¸‹ï¼Œåå‘ä¼ æ’­åˆ°æ¿€æ´»å‡½æ•°å±‚ï¼ˆå’Œä¸Šè¿°å•ä¸€ç¥ç»å…ƒä¸€è‡´å—·ï¼‰ï¼Œç»“æœè®°ä¸º<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>E</mi><msubsup><mi>I</mi><mi>j</mi><msup><mrow></mrow><mo mathvariant="normal">â€²</mo></msup></msubsup></mrow><annotation encoding="application/x-tex">EI^{&#x27;}_{j}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.3372519999999999em;vertical-align:-0.394772em;"></span><span class="mord mathdefault" style="margin-right:0.05764em;">E</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07847em;">I</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.94248em;"><span style="top:-2.441336em;margin-left:-0.07847em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8278285714285715em;"><span style="top:-2.931em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.394772em;"><span></span></span></span></span></span></span></span></span></span>ï¼š</p><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mfrac><mrow><mi mathvariant="normal">âˆ‚</mi><mi>E</mi></mrow><mrow><mi mathvariant="normal">âˆ‚</mi><msubsup><mi>u</mi><mi>j</mi><msup><mrow></mrow><mo mathvariant="normal">â€²</mo></msup></msubsup></mrow></mfrac><mo>=</mo><mfrac><mrow><mi mathvariant="normal">âˆ‚</mi><mi>E</mi></mrow><mrow><mi mathvariant="normal">âˆ‚</mi><msub><mi>y</mi><mi>j</mi></msub></mrow></mfrac><mo>â‹…</mo><mfrac><mrow><mi mathvariant="normal">âˆ‚</mi><msub><mi>y</mi><mi>j</mi></msub></mrow><mrow><mi mathvariant="normal">âˆ‚</mi><msubsup><mi>u</mi><mi>j</mi><msup><mrow></mrow><mo mathvariant="normal">â€²</mo></msup></msubsup></mrow></mfrac><mo>=</mo><mo stretchy="false">(</mo><msub><mi>y</mi><mi>j</mi></msub><mo>âˆ’</mo><msub><mi>t</mi><mi>j</mi></msub><mo stretchy="false">)</mo><mo>â‹…</mo><msub><mi>y</mi><mi>j</mi></msub><mo stretchy="false">(</mo><mn>1</mn><mo>âˆ’</mo><msub><mi>y</mi><mi>j</mi></msub><mo stretchy="false">)</mo><mo>:</mo><mo>=</mo><mi>E</mi><msubsup><mi>I</mi><mi>j</mi><msup><mrow></mrow><mo mathvariant="normal">â€²</mo></msup></msubsup></mrow><annotation encoding="application/x-tex">\dfrac{\partial{E} }{\partial{u_j^{&#x27;} } } = \dfrac{\partial{E} }{\partial{y_j} } \cdot \dfrac{\partial{y_j} }{\partial{u_j^{&#x27;} } } = (y_j - t_j) \cdot y_j(1-y_j) := EI^{&#x27;}_j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:2.497192em;vertical-align:-1.1257519999999999em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.37144em;"><span style="top:-2.28722em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">âˆ‚</span><span class="mord"><span class="mord"><span class="mord mathdefault">u</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.82278em;"><span style="top:-2.4231360000000004em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span><span style="top:-3.0448000000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6828285714285715em;"><span style="top:-2.786em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.4129719999999999em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">âˆ‚</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.05764em;">E</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.1257519999999999em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.343548em;vertical-align:-0.972108em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.37144em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">âˆ‚</span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">âˆ‚</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.05764em;">E</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.972108em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">â‹…</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:2.497192em;vertical-align:-1.1257519999999999em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.37144em;"><span style="top:-2.28722em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">âˆ‚</span><span class="mord"><span class="mord"><span class="mord mathdefault">u</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.82278em;"><span style="top:-2.4231360000000004em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span><span style="top:-3.0448000000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6828285714285715em;"><span style="top:-2.786em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.4129719999999999em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">âˆ‚</span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.1257519999999999em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.036108em;vertical-align:-0.286108em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.036108em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">â‹…</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.036108em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.036108em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">:</span></span><span class="base"><span class="strut" style="height:0.36687em;vertical-align:0em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.375588em;vertical-align:-0.383108em;"></span><span class="mord mathdefault" style="margin-right:0.05764em;">E</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07847em;">I</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.99248em;"><span style="top:-2.4530000000000003em;margin-left:-0.07847em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span><span style="top:-3.1130000000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8278285714285715em;"><span style="top:-2.931em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.383108em;"><span></span></span></span></span></span></span></span></span></span></span></p><p>4.3 ç»§ç»­å‘ä¸‹ï¼Œåˆ°è¾¾äº†éšè—å±‚å’Œè¾“å‡ºå±‚ä¹‹é—´çš„æƒå€¼çŸ©é˜µï¼ˆå’Œä¸Šè¿°å•ä¸€ç¥ç»å…ƒä¸€è‡´å—·ï¼‰ï¼š</p><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mfrac><mrow><mi mathvariant="normal">âˆ‚</mi><mi>E</mi></mrow><mrow><mi mathvariant="normal">âˆ‚</mi><msubsup><mi>w</mi><mrow><mi>i</mi><mi>j</mi></mrow><msup><mrow></mrow><mo mathvariant="normal">â€²</mo></msup></msubsup></mrow></mfrac><mo>=</mo><mfrac><mrow><mi mathvariant="normal">âˆ‚</mi><mi>E</mi></mrow><mrow><mi mathvariant="normal">âˆ‚</mi><msubsup><mi>u</mi><mi>j</mi><msup><mrow></mrow><mo mathvariant="normal">â€²</mo></msup></msubsup></mrow></mfrac><mo>â‹…</mo><mfrac><mrow><mi mathvariant="normal">âˆ‚</mi><msubsup><mi>u</mi><mi>j</mi><msup><mrow></mrow><mo mathvariant="normal">â€²</mo></msup></msubsup></mrow><mrow><mi mathvariant="normal">âˆ‚</mi><msubsup><mi>w</mi><mrow><mi>i</mi><mi>j</mi></mrow><msup><mrow></mrow><mo mathvariant="normal">â€²</mo></msup></msubsup></mrow></mfrac><mo>=</mo><mi>E</mi><msubsup><mi>I</mi><mi>j</mi><msup><mrow></mrow><mo mathvariant="normal">â€²</mo></msup></msubsup><mo>â‹…</mo><msub><mi>h</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">\dfrac{\partial{E} }{\partial{w_{ij}^{&#x27;} } } = \dfrac{\partial{E} }{\partial{u_j^{&#x27;} } } \cdot \dfrac{\partial{u_j^{&#x27;} } }{\partial{w_{ij}^{&#x27;} } } = EI^{&#x27;}_j \cdot h_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:2.497192em;vertical-align:-1.1257519999999999em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.37144em;"><span style="top:-2.28722em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">âˆ‚</span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.82278em;"><span style="top:-2.4231360000000004em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span style="top:-3.0448000000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6828285714285715em;"><span style="top:-2.786em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.4129719999999999em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">âˆ‚</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.05764em;">E</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.1257519999999999em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.497192em;vertical-align:-1.1257519999999999em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.37144em;"><span style="top:-2.28722em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">âˆ‚</span><span class="mord"><span class="mord"><span class="mord mathdefault">u</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.82278em;"><span style="top:-2.4231360000000004em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span><span style="top:-3.0448000000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6828285714285715em;"><span style="top:-2.786em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.4129719999999999em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">âˆ‚</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.05764em;">E</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.1257519999999999em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">â‹…</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:2.853004em;vertical-align:-1.1257519999999999em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.727252em;"><span style="top:-2.28722em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">âˆ‚</span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.82278em;"><span style="top:-2.4231360000000004em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span style="top:-3.0448000000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6828285714285715em;"><span style="top:-2.786em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.4129719999999999em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.7847720000000002em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">âˆ‚</span><span class="mord"><span class="mord"><span class="mord mathdefault">u</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.94248em;"><span style="top:-2.441336em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8278285714285715em;"><span style="top:-2.931em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.394772em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.1257519999999999em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.375588em;vertical-align:-0.383108em;"></span><span class="mord mathdefault" style="margin-right:0.05764em;">E</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07847em;">I</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.99248em;"><span style="top:-2.4530000000000003em;margin-left:-0.07847em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span><span style="top:-3.1130000000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8278285714285715em;"><span style="top:-2.931em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.383108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">â‹…</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.84444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span></p><ol start="5"><li>åˆ°è¿™é‡Œå³å¯å®Œæˆå¯¹ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mi>W</mi><msup><mrow></mrow><mo mathvariant="normal">â€²</mo></msup></msup></mrow><annotation encoding="application/x-tex">W^{&#x27;}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.94248em;vertical-align:0em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.94248em;"><span style="top:-2.94248em;margin-right:0.05em;"><span class="pstrut" style="height:2.57948em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8278285714285715em;"><span style="top:-2.931em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> çš„æ›´æ–°</li></ol><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msubsup><msup><mi>w</mi><mo mathvariant="normal">â€²</mo></msup><mrow><mi>i</mi><mi>j</mi></mrow><mrow><mo stretchy="false">(</mo><mi>n</mi><mi>e</mi><mi>w</mi><mo stretchy="false">)</mo></mrow></msubsup><mo>=</mo><msubsup><msup><mi>w</mi><mo mathvariant="normal">â€²</mo></msup><mrow><mi>i</mi><mi>j</mi></mrow><mrow><mo stretchy="false">(</mo><mi>o</mi><mi>l</mi><mi>d</mi><mo stretchy="false">)</mo></mrow></msubsup><mo>âˆ’</mo><mi>Î·</mi><mo>â‹…</mo><mi>E</mi><msubsup><mi>I</mi><mi>j</mi><msup><mrow></mrow><mo mathvariant="normal">â€²</mo></msup></msubsup><mo>â‹…</mo><msub><mi>h</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">{w&#x27;}_{ij}^{(new)} = {w&#x27;}_{ij}^{(old)} - \eta \cdot EI^{&#x27;}_j \cdot h_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.4629em;vertical-align:-0.383108em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.801892em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.079792em;"><span style="top:-2.4530000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span style="top:-3.254792em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathdefault mtight">n</span><span class="mord mathdefault mtight">e</span><span class="mord mathdefault mtight" style="margin-right:0.02691em;">w</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.383108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.4629em;vertical-align:-0.383108em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.801892em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.079792em;"><span style="top:-2.4530000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span style="top:-3.254792em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathdefault mtight">o</span><span class="mord mathdefault mtight" style="margin-right:0.01968em;">l</span><span class="mord mathdefault mtight">d</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.383108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.63889em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">Î·</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">â‹…</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.375588em;vertical-align:-0.383108em;"></span><span class="mord mathdefault" style="margin-right:0.05764em;">E</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07847em;">I</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.99248em;"><span style="top:-2.4530000000000003em;margin-left:-0.07847em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span><span style="top:-3.1130000000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8278285714285715em;"><span style="top:-2.931em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.383108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">â‹…</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.84444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span></p><ol start="6"><li>ç»§ç»­å‘ä¸‹ï¼Œæˆ‘ä»¬ä»¥ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>h</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">h_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.84444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> ä¸ºè¿æ¥ç‚¹ï¼Œå°è¯•åå‘ä¼ æ’­åˆ°è¾“å…¥å±‚</li></ol><p>6.1 é¦–å…ˆå®Œæˆå¯¹ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>h</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">h_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.84444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> çš„åå‘ä¼ æ’­</p><blockquote><p>æ³¨æ„è¿™é‡Œå¯¹ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>h</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">h_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.84444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> æ±‚åå¯¼ï¼Œç›¸å½“äº <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.65952em;vertical-align:0em;"></span><span class="mord mathdefault">i</span></span></span></span> å·²çŸ¥ï¼Œä½†æ˜¯ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>j</mi></mrow><annotation encoding="application/x-tex">j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.85396em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.05724em;">j</span></span></span></span> æœªçŸ¥ï¼Œå› æ­¤å…¶åå¯¼æ•°æ¥æºäºæ‰€æœ‰é“¾æ¥çš„è¾“å‡ºå±‚</p></blockquote><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mfrac><mrow><mi mathvariant="normal">âˆ‚</mi><mi>E</mi></mrow><mrow><mi mathvariant="normal">âˆ‚</mi><msub><mi>h</mi><mi>i</mi></msub></mrow></mfrac><mo>=</mo><munderover><mo>âˆ‘</mo><mrow><mi>j</mi><mo>=</mo><mn>1</mn></mrow><mi>M</mi></munderover><mfrac><mrow><mi mathvariant="normal">âˆ‚</mi><mi>E</mi></mrow><mrow><mi mathvariant="normal">âˆ‚</mi><msubsup><mi>u</mi><mi>j</mi><msup><mrow></mrow><mo mathvariant="normal">â€²</mo></msup></msubsup></mrow></mfrac><mo>â‹…</mo><mfrac><mrow><mi mathvariant="normal">âˆ‚</mi><msubsup><mi>u</mi><mi>j</mi><msup><mrow></mrow><mo mathvariant="normal">â€²</mo></msup></msubsup></mrow><mrow><mi mathvariant="normal">âˆ‚</mi><msub><mi>h</mi><mi>i</mi></msub></mrow></mfrac><mo>=</mo><munderover><mo>âˆ‘</mo><mrow><mi>j</mi><mo>=</mo><mn>1</mn></mrow><mi>M</mi></munderover><mi>E</mi><msubsup><mi>I</mi><mi>j</mi><msup><mrow></mrow><mo mathvariant="normal">â€²</mo></msup></msubsup><mo>â‹…</mo><msubsup><mi>w</mi><mrow><mi>i</mi><mi>j</mi></mrow><msup><mrow></mrow><mo mathvariant="normal">â€²</mo></msup></msubsup></mrow><annotation encoding="application/x-tex">\dfrac{\partial{E} }{\partial{h_{i} } } = \sum_{j=1}^{M}\dfrac{\partial{E} }{\partial{u_j^{&#x27;} } } \cdot \dfrac{\partial{u_j^{&#x27;} } }{\partial{h_{i} } } = \sum_{j=1}^{M}EI^{&#x27;}_j \cdot w_{ij}^{&#x27;}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:2.20744em;vertical-align:-0.8360000000000001em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.37144em;"><span style="top:-2.3139999999999996em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">âˆ‚</span><span class="mord"><span class="mord"><span class="mord mathdefault">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">âˆ‚</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.05764em;">E</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.8360000000000001em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:3.2421130000000007em;vertical-align:-1.4137769999999998em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.8283360000000006em;"><span style="top:-1.872331em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.050005em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">âˆ‘</span></span></span><span style="top:-4.3000050000000005em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.10903em;">M</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.4137769999999998em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.37144em;"><span style="top:-2.28722em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">âˆ‚</span><span class="mord"><span class="mord"><span class="mord mathdefault">u</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.82278em;"><span style="top:-2.4231360000000004em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span><span style="top:-3.0448000000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6828285714285715em;"><span style="top:-2.786em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.4129719999999999em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">âˆ‚</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.05764em;">E</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.1257519999999999em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">â‹…</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:2.5632520000000003em;vertical-align:-0.8360000000000001em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.727252em;"><span style="top:-2.3139999999999996em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">âˆ‚</span><span class="mord"><span class="mord"><span class="mord mathdefault">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.7847720000000002em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">âˆ‚</span><span class="mord"><span class="mord"><span class="mord mathdefault">u</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.94248em;"><span style="top:-2.441336em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8278285714285715em;"><span style="top:-2.931em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.394772em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.8360000000000001em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:3.2421130000000007em;vertical-align:-1.4137769999999998em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.8283360000000006em;"><span style="top:-1.872331em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.050005em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">âˆ‘</span></span></span><span style="top:-4.3000050000000005em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.10903em;">M</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.4137769999999998em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.05764em;">E</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07847em;">I</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.99248em;"><span style="top:-2.4530000000000003em;margin-left:-0.07847em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span><span style="top:-3.1130000000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8278285714285715em;"><span style="top:-2.931em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.383108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">â‹…</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.375588em;vertical-align:-0.383108em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.99248em;"><span style="top:-2.4530000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span style="top:-3.1130000000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8278285714285715em;"><span style="top:-2.931em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.383108em;"><span></span></span></span></span></span></span></span></span></span></span></p><p>6.2 æ‰“é€šäº† <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>h</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">h_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.84444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> ï¼Œç„¶åèµ°åˆ°è¾“å…¥å±‚ä¸éšå±‚ä¹‹é—´çš„æ¿€æ´»å‡½æ•°ï¼Œç»“æœè®°ä¸º<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>E</mi><msubsup><mi>I</mi><mi>i</mi><msup><mrow></mrow><mo mathvariant="normal">â€²</mo></msup></msubsup></mrow><annotation encoding="application/x-tex">EI^{&#x27;}_{i}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.201144em;vertical-align:-0.258664em;"></span><span class="mord mathdefault" style="margin-right:0.05764em;">E</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07847em;">I</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.94248em;"><span style="top:-2.441336em;margin-left:-0.07847em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8278285714285715em;"><span style="top:-2.931em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.258664em;"><span></span></span></span></span></span></span></span></span></span>ï¼š</p><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mfrac><mrow><mi mathvariant="normal">âˆ‚</mi><mi>E</mi></mrow><mrow><mi mathvariant="normal">âˆ‚</mi><msub><mi>u</mi><mi>i</mi></msub></mrow></mfrac><mo>=</mo><mfrac><mrow><mi mathvariant="normal">âˆ‚</mi><mi>E</mi></mrow><mrow><mi mathvariant="normal">âˆ‚</mi><msub><mi>h</mi><mi>i</mi></msub></mrow></mfrac><mo>â‹…</mo><mfrac><mrow><mi mathvariant="normal">âˆ‚</mi><msub><mi>h</mi><mi>i</mi></msub></mrow><mrow><mi mathvariant="normal">âˆ‚</mi><msub><mi>u</mi><mi>i</mi></msub></mrow></mfrac><mo>=</mo><munderover><mo>âˆ‘</mo><mrow><mi>j</mi><mo>=</mo><mn>1</mn></mrow><mi>M</mi></munderover><mi>E</mi><msubsup><mi>I</mi><mi>j</mi><msup><mrow></mrow><mo mathvariant="normal">â€²</mo></msup></msubsup><mo>â‹…</mo><msub><mi>h</mi><mi>i</mi></msub><mo stretchy="false">(</mo><mn>1</mn><mo>âˆ’</mo><msub><mi>h</mi><mi>i</mi></msub><mo stretchy="false">)</mo><mo>:</mo><mo>=</mo><mi>E</mi><msub><mi>I</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">\dfrac{\partial{E} }{\partial{u_{i} } } = \dfrac{\partial{E} }{\partial{h_i} } \cdot \dfrac{\partial{h_i} }{\partial{u_{i} } } = \sum_{j=1}^{M}EI^{&#x27;}_j \cdot h_i(1-h_i) := EI_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:2.20744em;vertical-align:-0.8360000000000001em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.37144em;"><span style="top:-2.3139999999999996em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">âˆ‚</span><span class="mord"><span class="mord"><span class="mord mathdefault">u</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">âˆ‚</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.05764em;">E</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.8360000000000001em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.20744em;vertical-align:-0.8360000000000001em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.37144em;"><span style="top:-2.3139999999999996em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">âˆ‚</span><span class="mord"><span class="mord"><span class="mord mathdefault">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">âˆ‚</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.05764em;">E</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.8360000000000001em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">â‹…</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:2.20744em;vertical-align:-0.8360000000000001em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.37144em;"><span style="top:-2.3139999999999996em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">âˆ‚</span><span class="mord"><span class="mord"><span class="mord mathdefault">u</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">âˆ‚</span><span class="mord"><span class="mord"><span class="mord mathdefault">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.8360000000000001em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:3.2421130000000007em;vertical-align:-1.4137769999999998em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.8283360000000006em;"><span style="top:-1.872331em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.050005em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">âˆ‘</span></span></span><span style="top:-4.3000050000000005em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.10903em;">M</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.4137769999999998em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.05764em;">E</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07847em;">I</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.99248em;"><span style="top:-2.4530000000000003em;margin-left:-0.07847em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span><span style="top:-3.1130000000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8278285714285715em;"><span style="top:-2.931em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.383108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">â‹…</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathdefault">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathdefault">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">:</span></span><span class="base"><span class="strut" style="height:0.36687em;vertical-align:0em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord mathdefault" style="margin-right:0.05764em;">E</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07847em;">I</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.07847em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span></p><p>6.3 ç„¶åå°±è§¦ç¢°åˆ°äº†è¾“å…¥å±‚ä¸éšå±‚ä¹‹é—´çš„æƒå€¼çŸ©é˜µ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>w</mi><mrow><mi>k</mi><mi>i</mi></mrow></msub></mrow><annotation encoding="application/x-tex">w_{ki}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.03148em;">k</span><span class="mord mathdefault mtight">i</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> ï¼š</p><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mfrac><mrow><mi mathvariant="normal">âˆ‚</mi><mi>E</mi></mrow><mrow><mi mathvariant="normal">âˆ‚</mi><msub><mi>w</mi><mrow><mi>k</mi><mi>i</mi></mrow></msub></mrow></mfrac><mo>=</mo><mfrac><mrow><mi mathvariant="normal">âˆ‚</mi><mi>E</mi></mrow><mrow><mi mathvariant="normal">âˆ‚</mi><msub><mi>u</mi><mi>i</mi></msub></mrow></mfrac><mo>â‹…</mo><mfrac><mrow><mi mathvariant="normal">âˆ‚</mi><msub><mi>u</mi><mi>i</mi></msub></mrow><mrow><mi mathvariant="normal">âˆ‚</mi><msub><mi>w</mi><mrow><mi>k</mi><mi>i</mi></mrow></msub></mrow></mfrac><mo>=</mo><mi>E</mi><msub><mi>I</mi><mi>i</mi></msub><mo>â‹…</mo><msub><mi>x</mi><mi>k</mi></msub></mrow><annotation encoding="application/x-tex">\dfrac{\partial{E} }{\partial{w_{ki} } } = \dfrac{\partial{E} }{\partial{u_i} } \cdot \dfrac{\partial{u_i} }{\partial{w_{ki} } } = EI_i \cdot x_k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:2.20744em;vertical-align:-0.8360000000000001em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.37144em;"><span style="top:-2.3139999999999996em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">âˆ‚</span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.03148em;">k</span><span class="mord mathdefault mtight">i</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">âˆ‚</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.05764em;">E</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.8360000000000001em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.20744em;vertical-align:-0.8360000000000001em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.37144em;"><span style="top:-2.3139999999999996em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">âˆ‚</span><span class="mord"><span class="mord"><span class="mord mathdefault">u</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">âˆ‚</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.05764em;">E</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.8360000000000001em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">â‹…</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:2.20744em;vertical-align:-0.8360000000000001em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.37144em;"><span style="top:-2.3139999999999996em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">âˆ‚</span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.03148em;">k</span><span class="mord mathdefault mtight">i</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">âˆ‚</span><span class="mord"><span class="mord"><span class="mord mathdefault">u</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.8360000000000001em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord mathdefault" style="margin-right:0.05764em;">E</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07847em;">I</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.07847em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">â‹…</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span></p><ol start="7"><li>è‡³æ­¤å³å¯å®Œæˆè¾“å…¥å±‚ä¸éšå±‚ä¹‹é—´æƒå€¼çŸ©é˜µçš„æ›´æ–°ï¼š</li></ol><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msubsup><msup><mi>w</mi><mo mathvariant="normal">â€²</mo></msup><mrow><mi>k</mi><mi>i</mi></mrow><mrow><mo stretchy="false">(</mo><mi>n</mi><mi>e</mi><mi>w</mi><mo stretchy="false">)</mo></mrow></msubsup><mo>=</mo><msubsup><msup><mi>w</mi><mo mathvariant="normal">â€²</mo></msup><mrow><mi>k</mi><mi>i</mi></mrow><mrow><mo stretchy="false">(</mo><mi>o</mi><mi>l</mi><mi>d</mi><mo stretchy="false">)</mo></mrow></msubsup><mo>âˆ’</mo><mi>Î·</mi><mo>â‹…</mo><mi>E</mi><msubsup><mi>I</mi><mi>i</mi><msup><mrow></mrow><mo mathvariant="normal">â€²</mo></msup></msubsup><mo>â‹…</mo><msub><mi>x</mi><mi>k</mi></msub></mrow><annotation encoding="application/x-tex">{w&#x27;}_{ki}^{(new)} = {w&#x27;}_{ki}^{(old)} - \eta \cdot EI^{&#x27;}_i \cdot x_k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.3461079999999996em;vertical-align:-0.2663159999999999em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.801892em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0797919999999999em;"><span style="top:-2.4336840000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.03148em;">k</span><span class="mord mathdefault mtight">i</span></span></span></span><span style="top:-3.254792em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathdefault mtight">n</span><span class="mord mathdefault mtight">e</span><span class="mord mathdefault mtight" style="margin-right:0.02691em;">w</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2663159999999999em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.3461079999999996em;vertical-align:-0.2663159999999999em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.801892em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0797919999999999em;"><span style="top:-2.4336840000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.03148em;">k</span><span class="mord mathdefault mtight">i</span></span></span></span><span style="top:-3.254792em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathdefault mtight">o</span><span class="mord mathdefault mtight" style="margin-right:0.01968em;">l</span><span class="mord mathdefault mtight">d</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2663159999999999em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.63889em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">Î·</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">â‹…</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.23948em;vertical-align:-0.247em;"></span><span class="mord mathdefault" style="margin-right:0.05764em;">E</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07847em;">I</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9924799999999999em;"><span style="top:-2.4530000000000003em;margin-left:-0.07847em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8278285714285715em;"><span style="top:-2.931em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">â‹…</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span></p><h1 id="èƒŒæ™¯"><a class="markdownIt-Anchor" href="#èƒŒæ™¯"></a> èƒŒæ™¯</h1><p>word2vec æ¨¡å‹è¢«è¶Šæ¥è¶Šå¤šçš„ç§‘ç ”å·¥ä½œè€…è§£é™¤å’Œä½¿ç”¨ï¼Œå¹¶ä¸”æ•ˆæœååˆ†ä¸é”™ï¼šèƒ½å¤Ÿæ•è·åˆ°è¯­ä¹‰ä¿¡æ¯</p><h1 id="æŒ‘æˆ˜"><a class="markdownIt-Anchor" href="#æŒ‘æˆ˜"></a> æŒ‘æˆ˜</h1><p>æ¨¡å‹è™½ç„¶ä¼˜ç§€ï¼Œä½†æ˜¯æˆªè‡³ç›®å‰å´ç¼ºå°‘å¯¹â€œè¯åµŒå…¥æ¨¡å‹â€å‚æ•°å­¦ä¹ è¿‡ç¨‹çš„å…¨é¢è§£é‡Šï¼Œä»è€Œä½¿éç¥ç»ç½‘ç»œä¸“å®¶æ— æ³•ç†è§£è¿™ç§æ¨¡å‹çš„å·¥ä½œæœºåˆ¶ã€‚</p><blockquote><p>I notice that there lacks a material that comprehensively explains the parameter learning process of word embedding models in details, thus preventing researchers that are non-experts in neural networks from understanding the working mechanism of such models.</p></blockquote><h1 id="æ–¹æ¡ˆ"><a class="markdownIt-Anchor" href="#æ–¹æ¡ˆ"></a> æ–¹æ¡ˆ</h1><h2 id="continuous-bag-of-word-model"><a class="markdownIt-Anchor" href="#continuous-bag-of-word-model"></a> Continuous Bag-of-Word Model</h2><h3 id="one-word-context"><a class="markdownIt-Anchor" href="#one-word-context"></a> One-word Context</h3><p>ä¾æ—§æ˜¯ç”±ç®€å…¥ç¹ï¼Œé¦–å…ˆæ¨¡å‹çš„è¾“å…¥ä¹Ÿå°±æ˜¯ç›®æ ‡å•è¯çš„ä¸Šä¸‹æ–‡ä»…ä¸€ä¸ªå•è¯</p><blockquote><p>We assume that there is only one word considered per context, which means the model will predict one target word given one context word, which is like a bigram model.</p></blockquote><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20210711195544139.png" alt="image-20210711195544139" style="zoom:67%;" /><p>æ¨¡å‹å›¾å¦‚ä¸Šæ‰€ç¤ºï¼Œå…¶ä¸­ï¼š<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="bold">x</mi><mo>=</mo><mo stretchy="false">{</mo><msub><mi>x</mi><mn>1</mn></msub><mo separator="true">,</mo><mo>â€¦</mo><mo separator="true">,</mo><msub><mi>x</mi><mi>V</mi></msub><mo stretchy="false">}</mo></mrow><annotation encoding="application/x-tex">\mathbf{x} = \{x_1,\dots,x_V\}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.44444em;vertical-align:0em;"></span><span class="mord"><span class="mord mathbf">x</span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">{</span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner">â€¦</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.22222em;">V</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">}</span></span></span></span> ä¸ºè¾“å…¥çš„è¯å‘é‡ï¼ˆone-hotï¼‰ï¼ŒåµŒå…¥ç»´åº¦ä¸º <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>V</mi></mrow><annotation encoding="application/x-tex">V</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.22222em;">V</span></span></span></span> (è¯å…¸çš„é•¿åº¦)ï¼›<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>h</mi><mo>=</mo><mo stretchy="false">{</mo><msub><mi>h</mi><mn>1</mn></msub><mo separator="true">,</mo><mo>â€¦</mo><mo separator="true">,</mo><msub><mi>h</mi><mi>n</mi></msub><mo stretchy="false">}</mo></mrow><annotation encoding="application/x-tex">h=\{h_1,\dots, h_n\}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault">h</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">{</span><span class="mord"><span class="mord mathdefault">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner">â€¦</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">n</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">}</span></span></span></span> ä¸ºéšå±‚ç¥ç»å…ƒ</p><ol><li>é¦–å…ˆå®Œæˆè¾“å…¥åˆ°éšå±‚çš„å‰å‘ä¼ æ’­ï¼šè¯å‘é‡ä¸æƒå€¼çŸ©é˜µç›¸ä¹˜ï¼Œå› ä¸ºæ˜¯ one-hotç¼–ç ï¼Œä¸å¦¨ä»¤è¯å‘é‡ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.03148em;">k</span></span></span></span> ä½ä¸º <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span> å…¶ä½™ä½ä¸º <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>0</mn></mrow><annotation encoding="application/x-tex">0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span></span></span></span> é‚£ä¹ˆç»“æœå°±æ˜¯æƒå€¼çŸ©é˜µçš„ç¬¬ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.03148em;">k</span></span></span></span> è¡Œå‘é‡ï¼ˆ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msubsup><mi mathvariant="bold">W</mi><mrow><mo stretchy="false">(</mo><mi>k</mi><mo separator="true">,</mo><mo separator="true">â‹…</mo><mo stretchy="false">)</mo></mrow><mi>T</mi></msubsup></mrow><annotation encoding="application/x-tex">\mathbf{W}^T_{(k,Â·)}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.3383309999999997em;vertical-align:-0.49699999999999994em;"></span><span class="mord"><span class="mord"><span class="mord mathbf" style="margin-right:0.01597em;">W</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8413309999999998em;"><span style="top:-2.378em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathdefault mtight" style="margin-right:0.03148em;">k</span><span class="mpunct mtight">,</span><span class="mpunct mtight">â‹…</span><span class="mclose mtight">)</span></span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.13889em;">T</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.49699999999999994em;"><span></span></span></span></span></span></span></span></span></span> æˆ‘ç†è§£çš„æ˜¯è¡¨ç¤º <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>W</mi></mrow><annotation encoding="application/x-tex">W</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.13889em;">W</span></span></span></span> çŸ©é˜µçš„ç¬¬ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.03148em;">k</span></span></span></span> è¡Œè¡Œå‘é‡ï¼‰å¹¶å°†ç»“æœè®°ä½œ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msubsup><mi>v</mi><msub><mi>W</mi><mi>I</mi></msub><mi>T</mi></msubsup></mrow><annotation encoding="application/x-tex">v_{W_I}^T</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.216967em;vertical-align:-0.37563599999999997em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8413309999999999em;"><span style="top:-2.424669em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3567071428571427em;margin-left:-0.13889em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathdefault mtight" style="margin-right:0.07847em;">I</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.14329285714285717em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.13889em;">T</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.37563599999999997em;"><span></span></span></span></span></span></span></span></span></span></li></ol><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="bold">h</mi><mo>=</mo><msup><mi mathvariant="bold">W</mi><mi>T</mi></msup><mi mathvariant="bold">x</mi><mo>=</mo><msubsup><mi mathvariant="bold">W</mi><mrow><mo stretchy="false">(</mo><mi>k</mi><mo separator="true">,</mo><mo separator="true">â‹…</mo><mo stretchy="false">)</mo></mrow><mi>T</mi></msubsup><mo>:</mo><mo>=</mo><msubsup><mi>v</mi><msub><mi>w</mi><mi>I</mi></msub><mi>T</mi></msubsup></mrow><annotation encoding="application/x-tex">\mathbf{h} = \mathbf{W}^T\mathbf{x}  = \mathbf{W}^T_{(k,Â·)} := v_{w_I}^T</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord"><span class="mord mathbf">h</span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.8913309999999999em;vertical-align:0em;"></span><span class="mord"><span class="mord"><span class="mord mathbf" style="margin-right:0.01597em;">W</span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8913309999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span><span class="mord"><span class="mord mathbf">x</span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.3383309999999997em;vertical-align:-0.4469999999999999em;"></span><span class="mord"><span class="mord"><span class="mord mathbf" style="margin-right:0.01597em;">W</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8913309999999999em;"><span style="top:-2.428em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathdefault mtight" style="margin-right:0.03148em;">k</span><span class="mpunct mtight">,</span><span class="mpunct mtight">â‹…</span><span class="mclose mtight">)</span></span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.13889em;">T</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.4469999999999999em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">:</span></span><span class="base"><span class="strut" style="height:0.36687em;vertical-align:0em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.238636em;vertical-align:-0.347305em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.891331em;"><span style="top:-2.4530000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3567071428571427em;margin-left:-0.02691em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathdefault mtight" style="margin-right:0.07847em;">I</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.14329285714285717em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.1130000000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.13889em;">T</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.347305em;"><span></span></span></span></span></span></span></span></span></span></span></p><ol start="2"><li><p>ç„¶åå®Œæˆéšå±‚åˆ°è¾“å‡ºå±‚çš„å‰å‘ä¼ æ’­</p><ol><li><p>å…ˆä¸æƒå€¼çŸ©é˜µ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>W</mi><mi mathvariant="normal">â€™</mi></mrow><annotation encoding="application/x-tex">Wâ€™</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.13889em;">W</span><span class="mord">â€™</span></span></span></span> è¿›è¡ŒçŸ©é˜µä¹˜æ³•ï¼šä¸€ä¸ªç»´åº¦æ˜¯ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo stretchy="false">(</mo><mi>N</mi><mo separator="true">,</mo><mn>1</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(N, 1)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.10903em;">N</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">1</span><span class="mclose">)</span></span></span></span> ä¸€ä¸ªç»´åº¦æ˜¯ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo stretchy="false">(</mo><mi>N</mi><mo separator="true">,</mo><mi>V</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(N, V)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.10903em;">N</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.22222em;">V</span><span class="mclose">)</span></span></span></span>ï¼Œæˆ‘ä»¬è®°ç¬¬ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>j</mi></mrow><annotation encoding="application/x-tex">j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.85396em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.05724em;">j</span></span></span></span> ä¸ªè¾“å‡ºä¸º <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>u</mi><mi>j</mi></msub></mrow><annotation encoding="application/x-tex">u_j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.716668em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault">u</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span> (æ˜¯ä¸€ä¸ªæ ‡é‡å“¦ï¼Œæ¿€æ´»åå¯¹åº” <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>y</mi><mi>j</mi></msub></mrow><annotation encoding="application/x-tex">y_j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.716668em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span>ï¼Œè¡¨ç¤ºç¬¬ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>j</mi></mrow><annotation encoding="application/x-tex">j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.85396em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.05724em;">j</span></span></span></span> ä¸ªè¯æ˜¯ç›®æ ‡è¯çš„æ¦‚ç‡å¤§å°ï¼‰</p><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>u</mi><mi>j</mi></msub><mo>=</mo><msubsup><msup><mi>v</mi><mo mathvariant="normal">â€²</mo></msup><msub><mi>w</mi><mi>j</mi></msub><mi>T</mi></msubsup><mi mathvariant="bold">h</mi></mrow><annotation encoding="application/x-tex">u_j = {v&#x27;}_{w_j}^T\mathbf{h}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.716668em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault">u</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.4774429999999998em;vertical-align:-0.44432em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.801892em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0331229999999998em;"><span style="top:-2.4530000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3280857142857143em;"><span style="top:-2.357em;margin-left:-0.02691em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2818857142857143em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.254792em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.13889em;">T</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.44432em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathbf">h</span></span></span></span></span></span></p><p>å…¶ä¸­ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><msup><mi>v</mi><mo mathvariant="normal">â€²</mo></msup><msub><mi>w</mi><mi>j</mi></msub></msub></mrow><annotation encoding="application/x-tex">{v&#x27;}_{w_j}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.099212em;vertical-align:-0.34731999999999996em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3280857142857143em;"><span style="top:-2.357em;margin-left:-0.02691em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2818857142857143em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.34731999999999996em;"><span></span></span></span></span></span></span></span></span></span> æ˜¯ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>W</mi><mi mathvariant="normal">â€™</mi></mrow><annotation encoding="application/x-tex">Wâ€™</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.13889em;">W</span><span class="mord">â€™</span></span></span></span> çš„ç¬¬ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>j</mi></mrow><annotation encoding="application/x-tex">j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.85396em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.05724em;">j</span></span></span></span> åˆ—</p></li><li><p>ç„¶åæˆ‘ä»¬å¯¹ç¬¬ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>j</mi></mrow><annotation encoding="application/x-tex">j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.85396em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.05724em;">j</span></span></span></span> ä¸ªè¾“å‡ºè¿›è¡Œæ¿€æ´» (Softmax å‡½æ•°)ï¼šï¼ˆè¿™é‡Œé¢çš„ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>w</mi></mrow><annotation encoding="application/x-tex">w</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span></span></span></span> è¡¨ç¤º word ï¼‰</p><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>p</mi><mo stretchy="false">(</mo><msub><mi>w</mi><mi>j</mi></msub><mi mathvariant="normal">âˆ£</mi><msub><mi>w</mi><mi>I</mi></msub><mo stretchy="false">)</mo><mo>=</mo><msub><mi>y</mi><mi>j</mi></msub><mo>=</mo><mfrac><mrow><mi>e</mi><mi>x</mi><mi>p</mi><mo stretchy="false">(</mo><msub><mi>u</mi><mi>j</mi></msub><mo stretchy="false">)</mo></mrow><mrow><munderover><mo>âˆ‘</mo><mrow><msup><mi>j</mi><mo mathvariant="normal">â€²</mo></msup><mo>=</mo><mn>1</mn></mrow><mi>V</mi></munderover><mi>e</mi><mi>x</mi><mi>p</mi><mo stretchy="false">(</mo><msub><mi>u</mi><msup><mi>j</mi><mo mathvariant="normal">â€²</mo></msup></msub><mo stretchy="false">)</mo></mrow></mfrac></mrow><annotation encoding="application/x-tex">p(w_j|w_I) = y_j = \dfrac{exp(u_j)}{\sum_{j&#x27;=1}^{V}exp(u_{j&#x27;})}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.036108em;vertical-align:-0.286108em;"></span><span class="mord mathdefault">p</span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mord">âˆ£</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.07847em;">I</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.716668em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.734049em;vertical-align:-1.3070490000000001em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.427em;"><span style="top:-2.128769em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:-0.0000050000000000050004em;">âˆ‘</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.981231em;"><span style="top:-2.40029em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6828285714285715em;"><span style="top:-2.786em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.2029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.22222em;">V</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.43581800000000004em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">e</span><span class="mord mathdefault">x</span><span class="mord mathdefault">p</span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">u</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32798em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6828285714285715em;"><span style="top:-2.786em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault">e</span><span class="mord mathdefault">x</span><span class="mord mathdefault">p</span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">u</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.3070490000000001em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p></li></ol></li><li><p>å°†ä¸­é—´å˜é‡ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>u</mi><mi>j</mi></msub><mo separator="true">,</mo><msub><mi>u</mi><mi>j</mi></msub><mi mathvariant="normal">â€™</mi></mrow><annotation encoding="application/x-tex">u_j, u_jâ€™</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.980548em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault">u</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault">u</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mord">â€™</span></span></span></span> ä½œä¸€ä¸‹æ›¿æ¢å¾—åˆ°è¯¦ç»†å½¢å¼ï¼š</p></li></ol><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>p</mi><mo stretchy="false">(</mo><msub><mi>w</mi><mi>j</mi></msub><mi mathvariant="normal">âˆ£</mi><msub><mi>w</mi><mi>I</mi></msub><mo stretchy="false">)</mo><mo>=</mo><mfrac><mrow><mi>e</mi><mi>x</mi><mi>p</mi><mo stretchy="false">(</mo><msubsup><msup><mi>v</mi><mo mathvariant="normal">â€²</mo></msup><msub><mi>w</mi><mi>j</mi></msub><mi>T</mi></msubsup><msub><mi>v</mi><msub><mi>w</mi><mi>I</mi></msub></msub><mo stretchy="false">)</mo></mrow><mrow><munderover><mo>âˆ‘</mo><mrow><msup><mi>j</mi><mo mathvariant="normal">â€²</mo></msup><mo>=</mo><mn>1</mn></mrow><mi>V</mi></munderover><mi>e</mi><mi>x</mi><mi>p</mi><mo stretchy="false">(</mo><msubsup><msup><mi>v</mi><mo mathvariant="normal">â€²</mo></msup><msub><mi>w</mi><msup><mi>j</mi><mo mathvariant="normal">â€²</mo></msup></msub><mi>T</mi></msubsup><msubsup><mi>v</mi><msub><mi>w</mi><mi>I</mi></msub><mi>T</mi></msubsup><mo stretchy="false">)</mo></mrow></mfrac></mrow><annotation encoding="application/x-tex">p(w_j|w_I) = \dfrac{exp({v&#x27;}_{w_j}^T v_{w_I})}{\sum_{j&#x27;=1}^{V}exp({v&#x27;}_{w_{j&#x27;} }^T v_{w_I}^T)}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.036108em;vertical-align:-0.286108em;"></span><span class="mord mathdefault">p</span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mord">âˆ£</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.07847em;">I</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:3.2163139999999997em;vertical-align:-1.398871em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.8174429999999997em;"><span style="top:-2.128769em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:-0.0000050000000000050004em;">âˆ‘</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.981231em;"><span style="top:-2.40029em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6828285714285715em;"><span style="top:-2.786em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.2029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.22222em;">V</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.43581800000000004em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">e</span><span class="mord mathdefault">x</span><span class="mord mathdefault">p</span><span class="mopen">(</span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6778919999999999em;"><span style="top:-2.9890000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9091229999999999em;"><span style="top:-2.4530000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3447999999999998em;margin-left:-0.02691em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.6068285714285713em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8495600000000001em;"><span style="top:-2.84956em;margin-right:0.1em;"><span class="pstrut" style="height:2.55556em;"></span><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.4009142857142858em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.130792em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.13889em;">T</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.52764em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7673309999999999em;"><span style="top:-2.4530000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3567071428571427em;margin-left:-0.02691em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathdefault mtight" style="margin-right:0.07847em;">I</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.14329285714285717em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-2.989em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.13889em;">T</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.347305em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.8343199999999995em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault">e</span><span class="mord mathdefault">x</span><span class="mord mathdefault">p</span><span class="mopen">(</span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9831229999999999em;"><span style="top:-2.4530000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3280857142857143em;"><span style="top:-2.357em;margin-left:-0.02691em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2818857142857143em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.2047920000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.13889em;">T</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.44432em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139199999999997em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3567071428571427em;margin-left:-0.02691em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathdefault mtight" style="margin-right:0.07847em;">I</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.14329285714285717em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.250305em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.398871em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p><ol start="4"><li><p>é€‰æ‹©æœ€ä¼˜åŒ–ç›®æ ‡ï¼Œå¾—åˆ°æŸå¤±å‡½æ•°ï¼š</p><p>ä»¤ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>w</mi><mi>O</mi></msub></mrow><annotation encoding="application/x-tex">w_O</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.02778em;">O</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> è¡¨ç¤ºç›®æ ‡å•è¯ï¼Œå…¶ç´¢å¼•è®°ä¸º <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mi>j</mi><mo>âˆ—</mo></msup></mrow><annotation encoding="application/x-tex">j^*</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8831359999999999em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.05724em;">j</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.688696em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mbin mtight">âˆ—</span></span></span></span></span></span></span></span></span></span></span> ï¼Œå› æ­¤æˆ‘ä»¬è¦æœ€å¤§åŒ–å¦‚ä¸‹è¿™ä¸€æ¦‚ç‡å€¼ï¼š</p><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo><mi>m</mi><mi>a</mi><mi>x</mi></mo><mi>p</mi><mo stretchy="false">(</mo><msub><mi>w</mi><mi>O</mi></msub><mi mathvariant="normal">âˆ£</mi><msub><mi>w</mi><mi>I</mi></msub><mo stretchy="false">)</mo><mo>=</mo><mo><mi>m</mi><mi>a</mi><mi>x</mi></mo><msub><mi>y</mi><msup><mi>j</mi><mo>âˆ—</mo></msup></msub></mrow><annotation encoding="application/x-tex">\mathop{max} p(w_O|w_I) = \mathop{max}y_{j^*}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mop"><span class="mord mathdefault">ma</span><span class="mord mathdefault">x</span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">p</span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.02778em;">O</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord">âˆ£</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.07847em;">I</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.716668em;vertical-align:-0.286108em;"></span><span class="mop"><span class="mord mathdefault">ma</span><span class="mord mathdefault">x</span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6183428571428571em;"><span style="top:-2.786em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mbin mtight">âˆ—</span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span></span></p><p>ä¸ºäº†ç®€åŒ–è¿ç®—ï¼Œæˆ‘ä»¬å¼•å…¥çš„å¯¹æ•°å‡½æ•°æ¶ˆé™¤äº†é™¤æ³•ï¼Œåœ¨è¿™é‡Œé»˜è®¤ä»¥ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>e</mi></mrow><annotation encoding="application/x-tex">e</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">e</span></span></span></span> ä¸ºåº•ï¼Œæ–¹ä¾¿æ±‚å¯¼</p><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo>=</mo><mo><mi>m</mi><mi>a</mi><mi>x</mi></mo><mo><mi>l</mi><mi>o</mi><mi>g</mi></mo><msub><mi>y</mi><mrow><mi>j</mi><mo>âˆ—</mo></mrow></msub><mo>=</mo><msub><mi>u</mi><mrow><mi>j</mi><mo>âˆ—</mo></mrow></msub><mo>âˆ’</mo><mo><mi>l</mi><mi>o</mi><mi>g</mi></mo><munderover><mo>âˆ‘</mo><mrow><msup><mi>j</mi><mo mathvariant="normal">â€²</mo></msup><mo>=</mo><mn>1</mn></mrow><mi>V</mi></munderover><mi>e</mi><mi>x</mi><mi>p</mi><mo stretchy="false">(</mo><msub><mi>u</mi><msup><mi>j</mi><mo mathvariant="normal">â€²</mo></msup></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">= \mathop{max} \mathop{log} y_{j*} = u_{j*} - \mathop{log} \sum_{j&#x27;=1}^{V}exp(u_{j&#x27;})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.36687em;vertical-align:0em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.980548em;vertical-align:-0.286108em;"></span><span class="mop"><span class="mord mathdefault">ma</span><span class="mord mathdefault">x</span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop"><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault">o</span><span class="mord mathdefault" style="margin-right:0.03588em;">g</span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span><span class="mord mtight">âˆ—</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.8694379999999999em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault">u</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span><span class="mord mtight">âˆ—</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:3.2584290000000005em;vertical-align:-1.430093em;"></span><span class="mop"><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault">o</span><span class="mord mathdefault" style="margin-right:0.03588em;">g</span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.8283360000000002em;"><span style="top:-1.8560149999999997em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6828285714285715em;"><span style="top:-2.786em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.0500049999999996em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">âˆ‘</span></span></span><span style="top:-4.300005em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.22222em;">V</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.430093em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">e</span><span class="mord mathdefault">x</span><span class="mord mathdefault">p</span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">u</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32798em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6828285714285715em;"><span style="top:-2.786em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></span></p><p>æœ€åï¼Œæœ€å¤§åŒ–è½¬ä¸ºæœ€å°åŒ–å¾—åˆ°æŸå¤±å‡½æ•°ï¼š</p><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>E</mi><mo>=</mo><mo>âˆ’</mo><mo><mi>l</mi><mi>o</mi><mi>g</mi></mo><mi>p</mi><mo stretchy="false">(</mo><msub><mi>w</mi><mi>O</mi></msub><mi mathvariant="normal">âˆ£</mi><msub><mi>w</mi><mi>I</mi></msub><mo stretchy="false">)</mo><mo>=</mo><mo><mi>l</mi><mi>o</mi><mi>g</mi></mo><munderover><mo>âˆ‘</mo><mrow><msup><mi>j</mi><mo mathvariant="normal">â€²</mo></msup><mo>=</mo><mn>1</mn></mrow><mi>V</mi></munderover><mi>e</mi><mi>x</mi><mi>p</mi><mo stretchy="false">(</mo><msub><mi>u</mi><msup><mi>j</mi><mo mathvariant="normal">â€²</mo></msup></msub><mo stretchy="false">)</mo><mo>âˆ’</mo><msub><mi>u</mi><mrow><mi>j</mi><mo>âˆ—</mo></mrow></msub></mrow><annotation encoding="application/x-tex">E = -\mathop{log}p(w_O|w_I) = \mathop{log} \sum_{j&#x27;=1}^{V}exp(u_{j&#x27;}) - u_{j*}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.05764em;">E</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">âˆ’</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop"><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault">o</span><span class="mord mathdefault" style="margin-right:0.03588em;">g</span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">p</span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.02778em;">O</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord">âˆ£</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.07847em;">I</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:3.2584290000000005em;vertical-align:-1.430093em;"></span><span class="mop"><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault">o</span><span class="mord mathdefault" style="margin-right:0.03588em;">g</span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.8283360000000002em;"><span style="top:-1.8560149999999997em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6828285714285715em;"><span style="top:-2.786em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.0500049999999996em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">âˆ‘</span></span></span><span style="top:-4.300005em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.22222em;">V</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.430093em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">e</span><span class="mord mathdefault">x</span><span class="mord mathdefault">p</span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">u</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32798em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6828285714285715em;"><span style="top:-2.786em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.716668em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault">u</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span><span class="mord mtight">âˆ—</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span></span></p></li><li><p>æ‰§è¡Œåå‘ä¼ æ’­ï¼Œè¾“å‡ºå±‚åˆ°æ¿€æ´»å‡½æ•°ï¼Œå°†å…¶ç»“æœè®°ä¸º <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>e</mi><mi>j</mi></msub></mrow><annotation encoding="application/x-tex">e_j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.716668em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span></p><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mfrac><mrow><mi mathvariant="normal">âˆ‚</mi><mi>E</mi></mrow><mrow><mi mathvariant="normal">âˆ‚</mi><msub><mi>u</mi><mi>j</mi></msub></mrow></mfrac><mo>=</mo><msub><mi>y</mi><mi>j</mi></msub><mo>âˆ’</mo><msub><mi>t</mi><mi>j</mi></msub><mo>:</mo><mo>=</mo><msub><mi>e</mi><mi>j</mi></msub></mrow><annotation encoding="application/x-tex">\dfrac{\partial{E} }{\partial{u_j} } = y_j - t_j := e_j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:2.343548em;vertical-align:-0.972108em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.37144em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">âˆ‚</span><span class="mord"><span class="mord"><span class="mord mathdefault">u</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">âˆ‚</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.05764em;">E</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.972108em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.8694379999999999em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.9011879999999999em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">:</span></span><span class="base"><span class="strut" style="height:0.36687em;vertical-align:0em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.716668em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span></span></p><p>è¿™é‡Œ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>t</mi><mi>j</mi></msub><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">t_j = 1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9011879999999999em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span> å½“ä¸”ä»…å½“ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>j</mi><mo>=</mo><mi>j</mi><mo>âˆ—</mo></mrow><annotation encoding="application/x-tex">j = j*</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.85396em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.05724em;">j</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.85396em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.05724em;">j</span><span class="mord">âˆ—</span></span></span></span> å¦åˆ™ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>t</mi><mi>j</mi></msub><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">t_j = 0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9011879999999999em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span></span></span></span></p><blockquote><p>è¿™é‡Œå¯¹ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>u</mi><mi>j</mi></msub></mrow><annotation encoding="application/x-tex">u_j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.716668em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault">u</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span> æ±‚åå¯¼ï¼Œå¯¹äº <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>j</mi><mi mathvariant="normal">â€™</mi><mi mathvariant="normal">â‰ </mi><mi>j</mi></mrow><annotation encoding="application/x-tex">jâ€™ \neq j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.05724em;">j</span><span class="mord">â€™</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel"><span class="mrel"><span class="mord"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.69444em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="rlap"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="inner"><span class="mrel">î€ </span></span><span class="fix"></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.19444em;"><span></span></span></span></span></span></span><span class="mrel">=</span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.85396em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.05724em;">j</span></span></span></span> çš„ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>u</mi><mrow><mi>j</mi><mi mathvariant="normal">â€™</mi></mrow></msub></mrow><annotation encoding="application/x-tex">u_{jâ€™}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.716668em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault">u</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361079999999999em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span><span class="mord mtight">â€™</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span> éƒ½çœ‹åšå¸¸æ•°</p><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mfrac><mrow><mi mathvariant="normal">âˆ‚</mi><mrow><mo stretchy="false">(</mo><mo><mi>l</mi><mi>o</mi><mi>g</mi></mo><munderover><mo>âˆ‘</mo><mrow><msup><mi>j</mi><mo mathvariant="normal">â€²</mo></msup><mo>=</mo><mn>1</mn></mrow><mi>V</mi></munderover><mi>e</mi><mi>x</mi><mi>p</mi><mo stretchy="false">(</mo><msub><mi>u</mi><msup><mi>j</mi><mo mathvariant="normal">â€²</mo></msup></msub><mo stretchy="false">)</mo><mo stretchy="false">)</mo></mrow></mrow><mrow><mi mathvariant="normal">âˆ‚</mi><msub><mi>u</mi><mi>j</mi></msub></mrow></mfrac><mo>=</mo><mfrac><mn>1</mn><mrow><munderover><mo>âˆ‘</mo><mrow><msup><mi>j</mi><mo mathvariant="normal">â€²</mo></msup><mo>=</mo><mn>1</mn></mrow><mi>V</mi></munderover><mi>e</mi><mi>x</mi><mi>p</mi><mo stretchy="false">(</mo><msub><mi>u</mi><msup><mi>j</mi><mo mathvariant="normal">â€²</mo></msup></msub><mo stretchy="false">)</mo></mrow></mfrac><mo>Ã—</mo><mo stretchy="false">(</mo><mi>C</mi><mo>+</mo><mi>e</mi><mi>x</mi><mi>p</mi><mo stretchy="false">(</mo><msub><mi>u</mi><mi>j</mi></msub><mo stretchy="false">)</mo><msup><mo stretchy="false">)</mo><mo mathvariant="normal">â€²</mo></msup><mspace linebreak="newline"></mspace><mo>=</mo><mfrac><mrow><mi>e</mi><mi>x</mi><mi>p</mi><mo stretchy="false">(</mo><msub><mi>u</mi><mi>j</mi></msub><mo stretchy="false">)</mo></mrow><mrow><munderover><mo>âˆ‘</mo><mrow><msup><mi>j</mi><mo mathvariant="normal">â€²</mo></msup><mo>=</mo><mn>1</mn></mrow><mi>V</mi></munderover><mi>e</mi><mi>x</mi><mi>p</mi><mo stretchy="false">(</mo><msub><mi>u</mi><msup><mi>j</mi><mo mathvariant="normal">â€²</mo></msup></msub><mo stretchy="false">)</mo></mrow></mfrac><mo>=</mo><msub><mi>y</mi><mi>j</mi></msub></mrow><annotation encoding="application/x-tex">\dfrac{\partial{(\mathop{log} \sum_{j&#x27;=1}^{V}exp(u_{j&#x27;}))} }{\partial{u_j} } = \dfrac{1}{\sum_{j&#x27;=1}^{V}exp(u_{j&#x27;})} \times (C + exp(u_j))&#x27; \\ =  \dfrac{exp(u_j)}{\sum_{j&#x27;=1}^{V}exp(u_{j&#x27;})} = y_j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:2.779157em;vertical-align:-0.972108em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.8070490000000001em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">âˆ‚</span><span class="mord"><span class="mord"><span class="mord mathdefault">u</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.825818em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">âˆ‚</span><span class="mord"><span class="mopen">(</span><span class="mop"><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault">o</span><span class="mord mathdefault" style="margin-right:0.03588em;">g</span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:-0.0000050000000000050004em;">âˆ‘</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.981231em;"><span style="top:-2.40029em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6828285714285715em;"><span style="top:-2.786em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.2029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.22222em;">V</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.43581800000000004em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">e</span><span class="mord mathdefault">x</span><span class="mord mathdefault">p</span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">u</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32798em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6828285714285715em;"><span style="top:-2.786em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mclose">)</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.972108em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.628489em;vertical-align:-1.3070490000000001em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.32144em;"><span style="top:-2.128769em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:-0.0000050000000000050004em;">âˆ‘</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.981231em;"><span style="top:-2.40029em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6828285714285715em;"><span style="top:-2.786em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.2029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.22222em;">V</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.43581800000000004em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">e</span><span class="mord mathdefault">x</span><span class="mord mathdefault">p</span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">u</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32798em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6828285714285715em;"><span style="top:-2.786em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.3070490000000001em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">Ã—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.07153em;">C</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.088em;vertical-align:-0.286108em;"></span><span class="mord mathdefault">e</span><span class="mord mathdefault">x</span><span class="mord mathdefault">p</span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">u</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.801892em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:0.36687em;vertical-align:0em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.734049em;vertical-align:-1.3070490000000001em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.427em;"><span style="top:-2.128769em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:-0.0000050000000000050004em;">âˆ‘</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.981231em;"><span style="top:-2.40029em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6828285714285715em;"><span style="top:-2.786em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.2029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.22222em;">V</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.43581800000000004em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">e</span><span class="mord mathdefault">x</span><span class="mord mathdefault">p</span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">u</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32798em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6828285714285715em;"><span style="top:-2.786em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault">e</span><span class="mord mathdefault">x</span><span class="mord mathdefault">p</span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">u</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.3070490000000001em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.716668em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span></span></p></blockquote></li><li><p>æ‰§è¡Œåå‘ä¼ æ’­ï¼Œæ¿€æ´»å‡½æ•°åˆ°æƒå€¼çŸ©é˜µ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mi>W</mi><mo mathvariant="normal">â€²</mo></msup></mrow><annotation encoding="application/x-tex">W&#x27;</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.751892em;vertical-align:0em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span></span></span></span></p></li></ol><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mfrac><mrow><mi mathvariant="normal">âˆ‚</mi><mi>E</mi></mrow><mrow><mi mathvariant="normal">âˆ‚</mi><msub><msup><mi>v</mi><mo mathvariant="normal">â€²</mo></msup><msub><mi>w</mi><mi>j</mi></msub></msub></mrow></mfrac><mo>=</mo><mfrac><mrow><mi mathvariant="normal">âˆ‚</mi><mi>E</mi></mrow><mrow><mi mathvariant="normal">âˆ‚</mi><msub><mi>u</mi><mi>j</mi></msub></mrow></mfrac><mo>â‹…</mo><mfrac><mrow><mi mathvariant="normal">âˆ‚</mi><msub><mi>u</mi><mi>j</mi></msub></mrow><mrow><mi mathvariant="normal">âˆ‚</mi><msub><msup><mi>v</mi><mo mathvariant="normal">â€²</mo></msup><msub><mi>w</mi><mi>j</mi></msub></msub></mrow></mfrac><mo>=</mo><msub><mi>e</mi><mi>j</mi></msub><mo>â‹…</mo><mi mathvariant="bold">h</mi></mrow><annotation encoding="application/x-tex">\dfrac{\partial{E} }{\partial{ {v&#x27;}_{w_j} } } = \dfrac{\partial{E} }{\partial{u_j} } \cdot \dfrac{\partial{u_j} }{\partial{ {v&#x27;}_{w_j} } }= e_j \cdot \mathbf{h}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:2.40476em;vertical-align:-1.03332em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.37144em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">âˆ‚</span><span class="mord"><span class="mord"><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6778919999999999em;"><span style="top:-2.9890000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3280857142857143em;"><span style="top:-2.357em;margin-left:-0.02691em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2818857142857143em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.34731999999999996em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">âˆ‚</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.05764em;">E</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.03332em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.343548em;vertical-align:-0.972108em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.37144em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">âˆ‚</span><span class="mord"><span class="mord"><span class="mord mathdefault">u</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">âˆ‚</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.05764em;">E</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.972108em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">â‹…</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:2.40476em;vertical-align:-1.03332em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.37144em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">âˆ‚</span><span class="mord"><span class="mord"><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6778919999999999em;"><span style="top:-2.9890000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3280857142857143em;"><span style="top:-2.357em;margin-left:-0.02691em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2818857142857143em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.34731999999999996em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">âˆ‚</span><span class="mord"><span class="mord"><span class="mord mathdefault">u</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.03332em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.730558em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">â‹…</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord"><span class="mord mathbf">h</span></span></span></span></span></span></p><ol start="7"><li>è‡³æ­¤æˆ‘ä»¬å°±å¯ä»¥å®Œæˆå¯¹æƒå€¼çŸ©é˜µ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mi>W</mi><mo mathvariant="normal">â€²</mo></msup></mrow><annotation encoding="application/x-tex">W&#x27;</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.751892em;vertical-align:0em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span></span></span></span> çš„æ›´æ–°äº†</li></ol><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msubsup><msup><mi>v</mi><mo mathvariant="normal">â€²</mo></msup><msub><mi>w</mi><mi>j</mi></msub><mrow><mo stretchy="false">(</mo><mi>n</mi><mi>e</mi><mi>w</mi><mo stretchy="false">)</mo></mrow></msubsup><mo>=</mo><msubsup><msup><mi>v</mi><mo mathvariant="normal">â€²</mo></msup><msub><mi>w</mi><mi>j</mi></msub><mrow><mo stretchy="false">(</mo><mi>o</mi><mi>l</mi><mi>d</mi><mo stretchy="false">)</mo></mrow></msubsup><mo>âˆ’</mo><mi>Î·</mi><mo>â‹…</mo><msub><mi>e</mi><mi>j</mi></msub><mo>â‹…</mo><mi mathvariant="bold">h</mi><mtext>Â Â </mtext><mo stretchy="false">(</mo><mo><mi>f</mi><mi>o</mi><mi>r</mi></mo><mtext>Â </mtext><mi>j</mi><mtext>Â </mtext><mo><mi>i</mi><mi>n</mi></mo><mtext>Â </mtext><mo stretchy="false">{</mo><mn>1</mn><mo separator="true">,</mo><mn>2</mn><mo separator="true">,</mo><mo>â€¦</mo><mo separator="true">,</mo><mi>V</mi><mo stretchy="false">}</mo><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">{v&#x27;}_{w_j}^{(new)} = {v&#x27;}_{w_j}^{(old)} - \eta \cdot e_j \cdot \mathbf{h} \ \ (\mathop{for}\ j\ \mathop{in}\ \{1, 2, \dots, V\})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.524112em;vertical-align:-0.44432em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.801892em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0797919999999999em;"><span style="top:-2.4530000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3280857142857143em;"><span style="top:-2.357em;margin-left:-0.02691em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2818857142857143em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.254792em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathdefault mtight">n</span><span class="mord mathdefault mtight">e</span><span class="mord mathdefault mtight" style="margin-right:0.02691em;">w</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.44432em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.524112em;vertical-align:-0.44432em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.801892em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0797919999999999em;"><span style="top:-2.4530000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3280857142857143em;"><span style="top:-2.357em;margin-left:-0.02691em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2818857142857143em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.254792em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathdefault mtight">o</span><span class="mord mathdefault mtight" style="margin-right:0.01968em;">l</span><span class="mord mathdefault mtight">d</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.44432em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.63889em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">Î·</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">â‹…</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.730558em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">â‹…</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathbf">h</span></span><span class="mspace">Â </span><span class="mspace">Â </span><span class="mopen">(</span><span class="mop"><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="mord mathdefault" style="margin-right:0.02778em;">or</span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mspace">Â </span><span class="mord mathdefault" style="margin-right:0.05724em;">j</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mspace">Â </span><span class="mop"><span class="mord mathdefault">in</span></span><span class="mspace">Â </span><span class="mopen">{</span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">2</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner">â€¦</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.22222em;">V</span><span class="mclose">}</span><span class="mclose">)</span></span></span></span></span></p><blockquote><p>ä»è¿™é‡Œæˆ‘ä»¬ä¹Ÿèƒ½çœ‹å‡ºï¼Œç¬¬ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>j</mi></mrow><annotation encoding="application/x-tex">j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.85396em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.05724em;">j</span></span></span></span> åˆ—çš„æƒå€¼è·Ÿæ–°ä¸»è¦æ¥æºäºå…¶è¾“å…¥å‘é‡ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>h</mi></mrow><annotation encoding="application/x-tex">h</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault">h</span></span></span></span> ,è€Œå…¶ç³»æ•° <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>y</mi><mi>j</mi></msub><mo>âˆ’</mo><msub><mi>t</mi><mi>j</mi></msub></mrow><annotation encoding="application/x-tex">y_j - t_j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8694379999999999em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.9011879999999999em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span> åˆ™åˆ¤æ–­å…¶æ›´æ–°æ–¹å‘ï¼ˆ<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>y</mi><mi>j</mi></msub><mo>âˆˆ</mo><mo stretchy="false">[</mo><mn>0</mn><mo separator="true">,</mo><mn>1</mn><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">y_j \in [0, 1]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8252079999999999em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">âˆˆ</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">1</span><span class="mclose">]</span></span></span></span>ï¼‰</p><ol><li>å½“ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>t</mi><mi>j</mi></msub><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">t_j = 1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9011879999999999em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span> æ—¶ï¼Œå¦‚æœ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>y</mi><mi>j</mi></msub><mo>â†’</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">y_j \rightarrow 1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.716668em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">â†’</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span> é‚£ä¹ˆæ•ˆæœå¾ˆå¥½ï¼Œå¯¹è¯¥æƒå€¼çš„æ›´æ–°ä¹Ÿå°±å¾ˆå°</li><li>å½“ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>t</mi><mi>j</mi></msub><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">t_j = 1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9011879999999999em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span> æ—¶ï¼Œå¦‚æœ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>y</mi><mi>j</mi></msub></mrow><annotation encoding="application/x-tex">y_j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.716668em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span> ä¸è¶‹è¿‘äº1ï¼Œè¡¨ç¤º <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>y</mi><mi>j</mi></msub></mrow><annotation encoding="application/x-tex">y_j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.716668em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span> æœ‰ç‚¹åå°ï¼Œåˆ™ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>u</mi><mi>j</mi></msub></mrow><annotation encoding="application/x-tex">u_j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.716668em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault">u</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span> åå°ï¼Œè€Œ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>u</mi><mi>j</mi></msub><mo>=</mo><msubsup><msup><mi>v</mi><mo mathvariant="normal">â€²</mo></msup><msub><mi>w</mi><mi>j</mi></msub><mi>T</mi></msubsup><mi mathvariant="bold">h</mi></mrow><annotation encoding="application/x-tex">u_j = {v&#x27;}_{w_j}^T\mathbf{h}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.716668em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault">u</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.4274429999999998em;vertical-align:-0.44432em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9831229999999999em;"><span style="top:-2.4530000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3280857142857143em;"><span style="top:-2.357em;margin-left:-0.02691em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2818857142857143em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.2047920000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.13889em;">T</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.44432em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathbf">h</span></span></span></span></span> å› æ­¤è¦é€‚åº¦å¢åŠ  <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><msup><mi>v</mi><mo mathvariant="normal">â€²</mo></msup><msub><mi>w</mi><mi>j</mi></msub></msub></mrow><annotation encoding="application/x-tex">{v&#x27;}_{w_j}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.099212em;vertical-align:-0.34731999999999996em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3280857142857143em;"><span style="top:-2.357em;margin-left:-0.02691em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2818857142857143em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.34731999999999996em;"><span></span></span></span></span></span></span></span></span></span></li><li>å½“ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>t</mi><mi>j</mi></msub><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">t_j = 0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9011879999999999em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span></span></span></span> æ—¶ï¼Œ<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>y</mi><mi>j</mi></msub><mo>âˆ’</mo><msub><mi>t</mi><mi>j</mi></msub></mrow><annotation encoding="application/x-tex">y_j - t_j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8694379999999999em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.9011879999999999em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span> å¿…å®šä¸ºæ­£ï¼Œåªä¸å¤šå°†è§†ç¨‹åº¦å‡å° <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><msup><mi>v</mi><mo mathvariant="normal">â€²</mo></msup><msub><mi>w</mi><mi>j</mi></msub></msub></mrow><annotation encoding="application/x-tex">{v&#x27;}_{w_j}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.099212em;vertical-align:-0.34731999999999996em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3280857142857143em;"><span style="top:-2.357em;margin-left:-0.02691em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2818857142857143em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.34731999999999996em;"><span></span></span></span></span></span></span></span></span></span></li></ol></blockquote><ol start="8"><li><p>æ‰§è¡Œåå‘ä¼ æ’­ï¼Œæ¿€æ´»å‡½æ•°åˆ°éšå±‚ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="bold">h</mi></mrow><annotation encoding="application/x-tex">\mathbf{h}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord"><span class="mord mathbf">h</span></span></span></span></span> , ç»“æœè®°ä¸º <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>E</mi><mi>H</mi></mrow><annotation encoding="application/x-tex">EH</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.05764em;">E</span><span class="mord mathdefault" style="margin-right:0.08125em;">H</span></span></span></span></p><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mfrac><mrow><mi mathvariant="normal">âˆ‚</mi><mi>E</mi></mrow><mrow><mi mathvariant="normal">âˆ‚</mi><mi mathvariant="bold">h</mi></mrow></mfrac><mo>=</mo><munderover><mo>âˆ‘</mo><mrow><mi>j</mi><mo>=</mo><mn>1</mn></mrow><mi>V</mi></munderover><mfrac><mrow><mi mathvariant="normal">âˆ‚</mi><mi>E</mi></mrow><mrow><mi mathvariant="normal">âˆ‚</mi><msub><mi>u</mi><mi>j</mi></msub></mrow></mfrac><mo>â‹…</mo><mfrac><mrow><mi mathvariant="normal">âˆ‚</mi><msub><mi>u</mi><mi>j</mi></msub></mrow><mrow><mi mathvariant="normal">âˆ‚</mi><mi mathvariant="bold">h</mi></mrow></mfrac><mo>=</mo><munderover><mo>âˆ‘</mo><mrow><mi>j</mi><mo>=</mo><mn>1</mn></mrow><mi>V</mi></munderover><msub><mi>e</mi><mi>j</mi></msub><mo>â‹…</mo><msub><msup><mi>v</mi><mo mathvariant="normal">â€²</mo></msup><msub><mi>w</mi><mi>j</mi></msub></msub><mo>:</mo><mo>=</mo><mi>E</mi><mi>H</mi></mrow><annotation encoding="application/x-tex">\dfrac{\partial{E} }{\partial{\mathbf{h} } } = \sum_{j=1}^{V}\dfrac{\partial{E} }{\partial{u_j} } \cdot \dfrac{\partial{u_j} }{\partial{\mathbf{h} } }= \sum_{j=1}^{V}e_j \cdot {v&#x27;}_{w_j} := EH</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:2.05744em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.37144em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">âˆ‚</span><span class="mord"><span class="mord"><span class="mord mathbf">h</span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">âˆ‚</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.05764em;">E</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:3.2421130000000007em;vertical-align:-1.4137769999999998em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.8283360000000006em;"><span style="top:-1.872331em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.050005em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">âˆ‘</span></span></span><span style="top:-4.3000050000000005em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.22222em;">V</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.4137769999999998em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.37144em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">âˆ‚</span><span class="mord"><span class="mord"><span class="mord mathdefault">u</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">âˆ‚</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.05764em;">E</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.972108em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">â‹…</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:2.05744em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.37144em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">âˆ‚</span><span class="mord"><span class="mord"><span class="mord mathbf">h</span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">âˆ‚</span><span class="mord"><span class="mord"><span class="mord mathdefault">u</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:3.2421130000000007em;vertical-align:-1.4137769999999998em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.8283360000000006em;"><span style="top:-1.872331em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.050005em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">âˆ‘</span></span></span><span style="top:-4.3000050000000005em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.22222em;">V</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.4137769999999998em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">â‹…</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.149212em;vertical-align:-0.34731999999999996em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.801892em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3280857142857143em;"><span style="top:-2.357em;margin-left:-0.02691em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2818857142857143em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.34731999999999996em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">:</span></span><span class="base"><span class="strut" style="height:0.36687em;vertical-align:0em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.05764em;">E</span><span class="mord mathdefault" style="margin-right:0.08125em;">H</span></span></span></span></span></p></li><li><p>éšå±‚åˆ°æƒå€¼çŸ©é˜µ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="bold">W</mi></mrow><annotation encoding="application/x-tex">\mathbf{W}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68611em;vertical-align:0em;"></span><span class="mord"><span class="mord mathbf" style="margin-right:0.01597em;">W</span></span></span></span></span></p><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mfrac><mrow><mi mathvariant="normal">âˆ‚</mi><mi>E</mi></mrow><mrow><mi mathvariant="normal">âˆ‚</mi><msubsup><mi>v</mi><msub><mi>w</mi><mi>I</mi></msub><mi>T</mi></msubsup></mrow></mfrac><mo>=</mo><mfrac><mrow><mi mathvariant="normal">âˆ‚</mi><mi>E</mi></mrow><mrow><mi mathvariant="normal">âˆ‚</mi><mi mathvariant="bold">h</mi></mrow></mfrac><mo>â‹…</mo><mfrac><mrow><mi mathvariant="normal">âˆ‚</mi><mi mathvariant="bold">h</mi></mrow><mrow><mi mathvariant="normal">âˆ‚</mi><msubsup><mi>v</mi><msub><mi>w</mi><mi>I</mi></msub><mi>T</mi></msubsup></mrow></mfrac><mo>=</mo><munderover><mo>âˆ‘</mo><mrow><mi>j</mi><mo>=</mo><mn>1</mn></mrow><mi>V</mi></munderover><msub><mi>e</mi><mi>j</mi></msub><mo>â‹…</mo><msub><msup><mi>v</mi><mo mathvariant="normal">â€²</mo></msup><msub><mi>w</mi><mi>j</mi></msub></msub><mo>:</mo><mo>=</mo><mi>E</mi><mi>H</mi></mrow><annotation encoding="application/x-tex">\dfrac{\partial{E} }{\partial{v_{w_I}^T} } = \dfrac{\partial{E} }{\partial{\mathbf{h} } } \cdot \dfrac{\partial{\mathbf{h} } }{\partial{v_{w_I}^T} }= \sum_{j=1}^{V}e_j \cdot {v&#x27;}_{w_j} := EH</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:2.404745em;vertical-align:-1.033305em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.37144em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">âˆ‚</span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7673309999999999em;"><span style="top:-2.4530000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3567071428571427em;margin-left:-0.02691em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathdefault mtight" style="margin-right:0.07847em;">I</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.14329285714285717em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-2.989em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.13889em;">T</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.347305em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">âˆ‚</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.05764em;">E</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.033305em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.05744em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.37144em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">âˆ‚</span><span class="mord"><span class="mord"><span class="mord mathbf">h</span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">âˆ‚</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.05764em;">E</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">â‹…</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:2.404745em;vertical-align:-1.033305em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.37144em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">âˆ‚</span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7673309999999999em;"><span style="top:-2.4530000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3567071428571427em;margin-left:-0.02691em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathdefault mtight" style="margin-right:0.07847em;">I</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.14329285714285717em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-2.989em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.13889em;">T</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.347305em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">âˆ‚</span><span class="mord"><span class="mord"><span class="mord mathbf">h</span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.033305em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:3.2421130000000007em;vertical-align:-1.4137769999999998em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.8283360000000006em;"><span style="top:-1.872331em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.050005em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">âˆ‘</span></span></span><span style="top:-4.3000050000000005em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.22222em;">V</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.4137769999999998em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">â‹…</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.149212em;vertical-align:-0.34731999999999996em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.801892em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3280857142857143em;"><span style="top:-2.357em;margin-left:-0.02691em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2818857142857143em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.34731999999999996em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">:</span></span><span class="base"><span class="strut" style="height:0.36687em;vertical-align:0em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.05764em;">E</span><span class="mord mathdefault" style="margin-right:0.08125em;">H</span></span></span></span></span></p></li><li><p>è‡³æ­¤æˆ‘ä»¬å°±å¯ä»¥å®Œæˆå¯¹æƒå€¼çŸ©é˜µ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="bold">W</mi></mrow><annotation encoding="application/x-tex">\mathbf{W}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68611em;vertical-align:0em;"></span><span class="mord"><span class="mord mathbf" style="margin-right:0.01597em;">W</span></span></span></span></span> çš„æ›´æ–°äº†ï¼š</p><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msubsup><mi>v</mi><msub><mi>w</mi><mi>I</mi></msub><mrow><mo stretchy="false">(</mo><mi>n</mi><mi>e</mi><mi>w</mi><mo stretchy="false">)</mo></mrow></msubsup><mo>=</mo><msubsup><mi>v</mi><msub><mi>w</mi><mi>I</mi></msub><mrow><mo stretchy="false">(</mo><mi>o</mi><mi>l</mi><mi>d</mi><mo stretchy="false">)</mo></mrow></msubsup><mo>âˆ’</mo><mi>Î·</mi><mi>E</mi><msup><mi>H</mi><mi>T</mi></msup><mo>=</mo><msubsup><mi>v</mi><msub><mi>w</mi><mi>I</mi></msub><mrow><mo stretchy="false">(</mo><mi>o</mi><mi>l</mi><mi>d</mi><mo stretchy="false">)</mo></mrow></msubsup><mo>âˆ’</mo><mi>Î·</mi><mo stretchy="false">(</mo><munderover><mo>âˆ‘</mo><mrow><mi>j</mi><mo>=</mo><mn>1</mn></mrow><mi>V</mi></munderover><msub><mi>e</mi><mi>j</mi></msub><mo>â‹…</mo><msub><msup><mi>v</mi><mo mathvariant="normal">â€²</mo></msup><msub><mi>w</mi><mi>j</mi></msub></msub><msup><mo stretchy="false">)</mo><mi>T</mi></msup></mrow><annotation encoding="application/x-tex">{v}_{w_I}^{(new)} = {v}_{w_I}^{(old)} - \eta EH^T = {v}_{w_I}^{(old)} - \eta(\sum_{j=1}^{V}e_j \cdot {v&#x27;}_{w_j})^T</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.285305em;vertical-align:-0.347305em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">v</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.938em;"><span style="top:-2.4530000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3567071428571427em;margin-left:-0.02691em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathdefault mtight" style="margin-right:0.07847em;">I</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.14329285714285717em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathdefault mtight">n</span><span class="mord mathdefault mtight">e</span><span class="mord mathdefault mtight" style="margin-right:0.02691em;">w</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.347305em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.285305em;vertical-align:-0.347305em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">v</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.938em;"><span style="top:-2.4530000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3567071428571427em;margin-left:-0.02691em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathdefault mtight" style="margin-right:0.07847em;">I</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.14329285714285717em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathdefault mtight">o</span><span class="mord mathdefault mtight" style="margin-right:0.01968em;">l</span><span class="mord mathdefault mtight">d</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.347305em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.0857709999999998em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">Î·</span><span class="mord mathdefault" style="margin-right:0.05764em;">E</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8913309999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.285305em;vertical-align:-0.347305em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">v</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.938em;"><span style="top:-2.4530000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3567071428571427em;margin-left:-0.02691em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathdefault mtight" style="margin-right:0.07847em;">I</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.14329285714285717em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathdefault mtight">o</span><span class="mord mathdefault mtight" style="margin-right:0.01968em;">l</span><span class="mord mathdefault mtight">d</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.347305em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:3.2421130000000007em;vertical-align:-1.4137769999999998em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">Î·</span><span class="mopen">(</span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.8283360000000006em;"><span style="top:-1.872331em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.050005em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">âˆ‘</span></span></span><span style="top:-4.3000050000000005em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.22222em;">V</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.4137769999999998em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">â‹…</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.238651em;vertical-align:-0.34731999999999996em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.801892em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3280857142857143em;"><span style="top:-2.357em;margin-left:-0.02691em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2818857142857143em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.34731999999999996em;"><span></span></span></span></span></span></span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8913309999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span></span></span></span></span></p><blockquote><p>è™½ç„¶æœ‰ä¸ªæ±‚å’Œç¬¦å·ï¼Œè¿™æ—¶ç¬¬ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>I</mi></mrow><annotation encoding="application/x-tex">I</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.07847em;">I</span></span></span></span> åˆ—çš„æƒå€¼çš„æ›´æ–°ä¾æ—§å–å†³äº <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>y</mi><mrow><mi>j</mi><mo>âˆ—</mo></mrow></msub></mrow><annotation encoding="application/x-tex">y_{j*}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.716668em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span><span class="mord mtight">âˆ—</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span>,</p><ol><li>å½“ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>y</mi><mrow><mi>j</mi><mo>âˆ—</mo></mrow></msub><mo>â†’</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">y_{j*} \rightarrow 1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.716668em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span><span class="mord mtight">âˆ—</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">â†’</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span> é‚£ä¹ˆå…¶ä½™ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>y</mi><mi>j</mi></msub><mo>â†’</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">y_j \rightarrow 0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.716668em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">â†’</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span></span></span></span>, ä»è€Œ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>y</mi><mi>j</mi></msub><mo>âˆ’</mo><msub><mi>t</mi><mi>j</mi></msub><mo>â†’</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">y_j - t_j \rightarrow 0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8694379999999999em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.9011879999999999em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">â†’</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span></span></span></span> é‚£ä¹ˆæ›´æ–°å¹…åº¦å¾ˆä½</li><li>å½“ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>y</mi><mrow><mi>j</mi><mo>âˆ—</mo></mrow></msub></mrow><annotation encoding="application/x-tex">y_{j*}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.716668em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span><span class="mord mtight">âˆ—</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span> ä¸è¶‹è¿‘äº1æ—¶ï¼Œå…¶ä¼šäº§ç”Ÿä¸€ä¸ª ï¼ˆ<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>y</mi><mrow><mi>j</mi><mo>âˆ—</mo></mrow></msub><mo>âˆ’</mo><msub><mi>t</mi><mrow><mi>j</mi><mo>âˆ—</mo></mrow></msub></mrow><annotation encoding="application/x-tex">y_{j*} - t_{j*}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8694379999999999em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span><span class="mord mtight">âˆ—</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.9011879999999999em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span><span class="mord mtight">âˆ—</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span> ï¼‰å°äº 0 çš„æ›´æ–°å¹…åº¦ï¼Œè€Œå¯¹äºå…¶ä½™ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>y</mi><mi>j</mi></msub></mrow><annotation encoding="application/x-tex">y_j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.716668em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span> å¿…ç„¶äº§ç”Ÿè¾ƒå¤§çš„å¤§äº 0 çš„æ›´æ–°å¹…åº¦ï¼Œæ ¹æ®è¿™ä¸¤ä¸ªå¹…åº¦ä»¥åŠéšå±‚ä¸è¾“å‡ºå±‚é—´æƒå€¼çŸ©é˜µçš„ä¿¡æ¯ï¼ŒåŠ¨æ€è°ƒèŠ‚æƒå€¼ä¿¡æ¯</li></ol></blockquote></li></ol><h3 id="multi-word-context"><a class="markdownIt-Anchor" href="#multi-word-context"></a> Multi-word context</h3><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20210711232406495.png" alt="image-20210711232406495" style="zoom: 67%;" /><p>ä¸Šå›¾å³ä¸º CBOW çš„æ¨¡å‹å›¾ï¼Œå¯ä»¥çœ‹å‡ºä¸»è¦å˜åŒ–å°±æ˜¯å¤šä¸ªè¯å‘é‡çš„è¾“å…¥</p><ol><li>å‰å‘ä¼ æ’­ï¼Œè¾“å…¥å±‚åˆ°éšå±‚ï¼Œå°†è¾“å…¥çš„å¤šä¸ªè¯å‘é‡ç»Ÿä¸€åŠ æƒæ±‚å’Œæ±‚å¹³å‡åå¾—åˆ°éšå±‚ç»“æœï¼š</li></ol><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="bold">h</mi><mo>=</mo><mfrac><mn>1</mn><mi>C</mi></mfrac><mi mathvariant="bold">W</mi><mo stretchy="false">(</mo><mrow><msub><mi mathvariant="bold">x</mi><mn mathvariant="bold">1</mn></msub><mo>+</mo><msub><mi mathvariant="bold">x</mi><mn mathvariant="bold">2</mn></msub><mo>+</mo><mo>â€¦</mo><msub><mi mathvariant="bold">x</mi><mi mathvariant="bold">C</mi></msub></mrow><mo stretchy="false">)</mo><mspace linebreak="newline"></mspace><mo>=</mo><mfrac><mn>1</mn><mi>C</mi></mfrac><mo stretchy="false">(</mo><mrow><msub><mi mathvariant="bold">v</mi><msub><mi mathvariant="bold">w</mi><mn mathvariant="bold">1</mn></msub></msub><mo>+</mo><msub><mi mathvariant="bold">v</mi><msub><mi mathvariant="bold">w</mi><mn mathvariant="bold">2</mn></msub></msub><mo>+</mo><mo>â€¦</mo><msub><mi mathvariant="bold">v</mi><msub><mi mathvariant="bold">w</mi><mi mathvariant="bold">C</mi></msub></msub></mrow><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\mathbf{h} = \frac{1}{C} \mathbf{W}(\mathbf{x_1+x_2+\dots x_C}) \\ = \frac{1}{C} (\mathbf{v_{w_1}+v_{w_2}+\dots v_{w_C} })</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord"><span class="mord mathbf">h</span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.00744em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.32144em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07153em;">C</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mord"><span class="mord mathbf" style="margin-right:0.01597em;">W</span></span><span class="mopen">(</span><span class="mord"><span class="mord"><span class="mord mathbf">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathbf mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathbf">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathbf mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="minner">â€¦</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathbf">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33027699999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathbf mtight">C</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:0.36687em;vertical-align:0em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.00744em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.32144em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07153em;">C</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mopen">(</span><span class="mord"><span class="mord"><span class="mord mathbf" style="margin-right:0.01597em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.16110799999999997em;"><span style="top:-2.5500000000000003em;margin-left:-0.01597em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathbf mtight" style="margin-right:0.01597em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31731428571428577em;"><span style="top:-2.357em;margin-left:-0.01597em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathbf mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2501em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathbf" style="margin-right:0.01597em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.16110799999999997em;"><span style="top:-2.5500000000000003em;margin-left:-0.01597em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathbf mtight" style="margin-right:0.01597em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31731428571428577em;"><span style="top:-2.357em;margin-left:-0.01597em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathbf mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2501em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="minner">â€¦</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathbf" style="margin-right:0.01597em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.16110799999999997em;"><span style="top:-2.5500000000000003em;margin-left:-0.01597em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathbf mtight" style="margin-right:0.01597em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3547214285714286em;margin-left:-0.01597em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathbf mtight">C</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.14527857142857142em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.251695em;"><span></span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></span></p><p>â€‹å…¶ä¸­ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>C</mi></mrow><annotation encoding="application/x-tex">C</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.07153em;">C</span></span></span></span> è¡¨ç¤ºä¸ç›®æ ‡è¯ç›¸å…³çš„ä¸Šä¸‹æ–‡å•è¯ä¸ªæ•°</p><ol start="2"><li>ç„¶åå®Œæˆéšå±‚åˆ°æ¿€æ´»å±‚çš„ä¼ æ’­ï¼š<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>u</mi><mi>j</mi></msub><mo>=</mo><msubsup><msup><mi>v</mi><mo mathvariant="normal">â€²</mo></msup><msub><mi>w</mi><mi>j</mi></msub><mi>T</mi></msubsup><mi mathvariant="bold">h</mi></mrow><annotation encoding="application/x-tex">u_j = {v&#x27;}_{w_j}^T\mathbf{h}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.716668em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault">u</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.4274429999999998em;vertical-align:-0.44432em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9831229999999999em;"><span style="top:-2.4530000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3280857142857143em;"><span style="top:-2.357em;margin-left:-0.02691em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2818857142857143em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.2047920000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.13889em;">T</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.44432em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathbf">h</span></span></span></span></span></li><li>ç„¶åè¿›è¡Œæ¿€æ´»ï¼š<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>p</mi><mo stretchy="false">(</mo><msub><mi>w</mi><mi>O</mi></msub><mi mathvariant="normal">âˆ£</mi><msub><mi>w</mi><mrow><mi>I</mi><mo separator="true">,</mo><mn>1</mn></mrow></msub><mo separator="true">,</mo><mo>â€¦</mo><mo separator="true">,</mo><msub><mi>w</mi><mrow><mi>I</mi><mo separator="true">,</mo><mi>C</mi></mrow></msub><mo stretchy="false">)</mo><mo>=</mo><msub><mi>y</mi><mi>j</mi></msub><mo>=</mo><mstyle displaystyle="true" scriptlevel="0"><mfrac><mrow><mi>e</mi><mi>x</mi><mi>p</mi><mo stretchy="false">(</mo><msub><mi>u</mi><mi>j</mi></msub><mo stretchy="false">)</mo></mrow><mrow><msubsup><mo>âˆ‘</mo><mrow><msup><mi>j</mi><mo mathvariant="normal">â€²</mo></msup><mo>=</mo><mn>1</mn></mrow><mi>V</mi></msubsup><mi>e</mi><mi>x</mi><mi>p</mi><mo stretchy="false">(</mo><msub><mi>u</mi><msup><mi>j</mi><mo mathvariant="normal">â€²</mo></msup></msub><mo stretchy="false">)</mo></mrow></mfrac></mstyle></mrow><annotation encoding="application/x-tex">p(w_O|w_{I,1},\dots,w_{I,C}) = y_j = \dfrac{exp(u_j)}{\sum_{j&#x27;=1}^{V}exp(u_{j&#x27;})}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.036108em;vertical-align:-0.286108em;"></span><span class="mord mathdefault">p</span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.02778em;">O</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord">âˆ£</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.328331em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.07847em;">I</span><span class="mpunct mtight">,</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner">â€¦</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.328331em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.07847em;">I</span><span class="mpunct mtight">,</span><span class="mord mathdefault mtight" style="margin-right:0.07153em;">C</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.716668em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.734049em;vertical-align:-1.3070490000000001em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.427em;"><span style="top:-2.128769em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:-0.0000050000000000050004em;">âˆ‘</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.981231em;"><span style="top:-2.40029em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6828285714285715em;"><span style="top:-2.786em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.2029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.22222em;">V</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.43581800000000004em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">e</span><span class="mord mathdefault">x</span><span class="mord mathdefault">p</span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">u</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32798em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6828285714285715em;"><span style="top:-2.786em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault">e</span><span class="mord mathdefault">x</span><span class="mord mathdefault">p</span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">u</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.3070490000000001em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></li><li>å±•å¼€ï¼Œçœ‹ä¸‹æœ€ç»ˆçš„å‰å‘ä¼ æ’­ç»“æœï¼š</li></ol><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>p</mi><mo stretchy="false">(</mo><msub><mi>w</mi><mi>O</mi></msub><mi mathvariant="normal">âˆ£</mi><msub><mi>w</mi><mrow><mi>I</mi><mo separator="true">,</mo><mn>1</mn></mrow></msub><mo separator="true">,</mo><mo>â€¦</mo><mo separator="true">,</mo><msub><mi>w</mi><mrow><mi>I</mi><mo separator="true">,</mo><mi>C</mi></mrow></msub><mo stretchy="false">)</mo><mo>=</mo><mfrac><mrow><mi>e</mi><mi>x</mi><mi>p</mi><mo stretchy="false">(</mo><msubsup><msup><mi>v</mi><mo mathvariant="normal">â€²</mo></msup><msub><mi>w</mi><mi>j</mi></msub><mi>T</mi></msubsup><mfrac><mn>1</mn><mi>C</mi></mfrac><mo stretchy="false">(</mo><mrow><msub><mi mathvariant="bold">v</mi><msub><mi mathvariant="bold">w</mi><mn mathvariant="bold">1</mn></msub></msub><mo>+</mo><msub><mi mathvariant="bold">v</mi><msub><mi mathvariant="bold">w</mi><mn mathvariant="bold">2</mn></msub></msub><mo>+</mo><mo>â€¦</mo><msub><mi mathvariant="bold">v</mi><msub><mi mathvariant="bold">w</mi><mi mathvariant="bold">C</mi></msub></msub></mrow><mo stretchy="false">)</mo><mo stretchy="false">)</mo></mrow><mrow><munderover><mo>âˆ‘</mo><mrow><msup><mi>j</mi><mo mathvariant="normal">â€²</mo></msup><mo>=</mo><mn>1</mn></mrow><mi>V</mi></munderover><mi>e</mi><mi>x</mi><mi>p</mi><mo stretchy="false">(</mo><msubsup><msup><mi>v</mi><mo mathvariant="normal">â€²</mo></msup><msub><mi>w</mi><msup><mi>j</mi><mo mathvariant="normal">â€²</mo></msup></msub><mi>T</mi></msubsup><mfrac><mn>1</mn><mi>C</mi></mfrac><mo stretchy="false">(</mo><mrow><msub><mi mathvariant="bold">v</mi><msub><mi mathvariant="bold">w</mi><mn mathvariant="bold">1</mn></msub></msub><mo>+</mo><msub><mi mathvariant="bold">v</mi><msub><mi mathvariant="bold">w</mi><mn mathvariant="bold">2</mn></msub></msub><mo>+</mo><mo>â€¦</mo><msub><mi mathvariant="bold">v</mi><msub><mi mathvariant="bold">w</mi><mi mathvariant="bold">C</mi></msub></msub></mrow><msup><mo stretchy="false">)</mo><mi>T</mi></msup><mo stretchy="false">)</mo></mrow></mfrac></mrow><annotation encoding="application/x-tex">p(w_O|w_{I,1},\dots,w_{I,C}) = \dfrac{exp({v&#x27;}_{w_j}^T \frac{1}{C} (\mathbf{v_{w_1}+v_{w_2}+\dots v_{w_C} }))}{\sum_{j&#x27;=1}^{V}exp({v&#x27;}_{w_{j&#x27;} }^T \frac{1}{C} (\mathbf{v_{w_1}+v_{w_2}+\dots v_{w_C} })^T)}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.036108em;vertical-align:-0.286108em;"></span><span class="mord mathdefault">p</span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.02778em;">O</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord">âˆ£</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.328331em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.07847em;">I</span><span class="mpunct mtight">,</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner">â€¦</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.328331em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.07847em;">I</span><span class="mpunct mtight">,</span><span class="mord mathdefault mtight" style="margin-right:0.07153em;">C</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:3.2163139999999997em;vertical-align:-1.398871em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.8174429999999997em;"><span style="top:-2.128769em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:-0.0000050000000000050004em;">âˆ‘</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.981231em;"><span style="top:-2.40029em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6828285714285715em;"><span style="top:-2.786em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.2029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.22222em;">V</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.43581800000000004em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">e</span><span class="mord mathdefault">x</span><span class="mord mathdefault">p</span><span class="mopen">(</span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6778919999999999em;"><span style="top:-2.9890000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9091229999999999em;"><span style="top:-2.4530000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3447999999999998em;margin-left:-0.02691em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.6068285714285713em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8495600000000001em;"><span style="top:-2.84956em;margin-right:0.1em;"><span class="pstrut" style="height:2.55556em;"></span><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.4009142857142858em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.130792em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.13889em;">T</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.52764em;"><span></span></span></span></span></span></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.845108em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.07153em;">C</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mopen">(</span><span class="mord"><span class="mord"><span class="mord mathbf" style="margin-right:0.01597em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.16110799999999997em;"><span style="top:-2.5500000000000003em;margin-left:-0.01597em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathbf mtight" style="margin-right:0.01597em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31731428571428577em;"><span style="top:-2.357em;margin-left:-0.01597em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathbf mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2501em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathbf" style="margin-right:0.01597em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.16110799999999997em;"><span style="top:-2.5500000000000003em;margin-left:-0.01597em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathbf mtight" style="margin-right:0.01597em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31731428571428577em;"><span style="top:-2.357em;margin-left:-0.01597em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathbf mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2501em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="minner">â€¦</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathbf" style="margin-right:0.01597em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.16110799999999997em;"><span style="top:-2.5500000000000003em;margin-left:-0.01597em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathbf mtight" style="margin-right:0.01597em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3547214285714286em;margin-left:-0.01597em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathbf mtight">C</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.14527857142857142em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.251695em;"><span></span></span></span></span></span></span></span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.767331em;"><span style="top:-2.9890000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span><span class="mclose">)</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.8343199999999995em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault">e</span><span class="mord mathdefault">x</span><span class="mord mathdefault">p</span><span class="mopen">(</span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9831229999999999em;"><span style="top:-2.4530000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3280857142857143em;"><span style="top:-2.357em;margin-left:-0.02691em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2818857142857143em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.2047920000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.13889em;">T</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.44432em;"><span></span></span></span></span></span></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.845108em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.07153em;">C</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mopen">(</span><span class="mord"><span class="mord"><span class="mord mathbf" style="margin-right:0.01597em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.16110799999999997em;"><span style="top:-2.5500000000000003em;margin-left:-0.01597em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathbf mtight" style="margin-right:0.01597em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31731428571428577em;"><span style="top:-2.357em;margin-left:-0.01597em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathbf mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2501em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathbf" style="margin-right:0.01597em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.16110799999999997em;"><span style="top:-2.5500000000000003em;margin-left:-0.01597em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathbf mtight" style="margin-right:0.01597em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31731428571428577em;"><span style="top:-2.357em;margin-left:-0.01597em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathbf mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2501em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="minner">â€¦</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathbf" style="margin-right:0.01597em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.16110799999999997em;"><span style="top:-2.5500000000000003em;margin-left:-0.01597em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathbf mtight" style="margin-right:0.01597em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3547214285714286em;margin-left:-0.01597em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathbf mtight">C</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.14527857142857142em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.251695em;"><span></span></span></span></span></span></span></span><span class="mclose">)</span><span class="mclose">)</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.398871em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p><ol start="5"><li>å¾—åˆ°æˆ‘ä»¬çš„æŸå¤±å‡½æ•°ï¼š</li></ol><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>E</mi><mo>=</mo><mo><mi>l</mi><mi>o</mi><mi>g</mi></mo><munderover><mo>âˆ‘</mo><mrow><msup><mi>j</mi><mo mathvariant="normal">â€²</mo></msup><mo>=</mo><mn>1</mn></mrow><mi>V</mi></munderover><mi>e</mi><mi>x</mi><mi>p</mi><mo stretchy="false">(</mo><msub><mi>u</mi><msup><mi>j</mi><mo mathvariant="normal">â€²</mo></msup></msub><mo stretchy="false">)</mo><mo>âˆ’</mo><msub><mi>u</mi><mrow><mi>j</mi><mo>âˆ—</mo></mrow></msub><mo>=</mo><mo><mi>l</mi><mi>o</mi><mi>g</mi></mo><munderover><mo>âˆ‘</mo><mrow><msup><mi>j</mi><mo mathvariant="normal">â€²</mo></msup><mo>=</mo><mn>1</mn></mrow><mi>V</mi></munderover><mi>e</mi><mi>x</mi><mi>p</mi><mo stretchy="false">(</mo><msubsup><msup><mi>v</mi><mo mathvariant="normal">â€²</mo></msup><msub><mi>w</mi><msup><mi>j</mi><mo mathvariant="normal">â€²</mo></msup></msub><mi>T</mi></msubsup><mi mathvariant="bold">h</mi><mo stretchy="false">)</mo><mo>âˆ’</mo><msubsup><msup><mi>v</mi><mo mathvariant="normal">â€²</mo></msup><msub><mi>w</mi><mi>O</mi></msub><mi>T</mi></msubsup><mi mathvariant="bold">h</mi></mrow><annotation encoding="application/x-tex">E = \mathop{log} \sum_{j&#x27;=1}^{V}exp(u_{j&#x27;}) - u_{j*} = \mathop{log} \sum_{j&#x27;=1}^{V}exp({v&#x27;}_{w_{j&#x27;} }^T\mathbf{h}) - {v&#x27;}_{w_{O} }^T\mathbf{h}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.05764em;">E</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:3.2584290000000005em;vertical-align:-1.430093em;"></span><span class="mop"><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault">o</span><span class="mord mathdefault" style="margin-right:0.03588em;">g</span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.8283360000000002em;"><span style="top:-1.8560149999999997em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6828285714285715em;"><span style="top:-2.786em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.0500049999999996em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">âˆ‘</span></span></span><span style="top:-4.300005em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.22222em;">V</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.430093em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">e</span><span class="mord mathdefault">x</span><span class="mord mathdefault">p</span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">u</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32798em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6828285714285715em;"><span style="top:-2.786em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.716668em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault">u</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span><span class="mord mtight">âˆ—</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:3.2584290000000005em;vertical-align:-1.430093em;"></span><span class="mop"><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault">o</span><span class="mord mathdefault" style="margin-right:0.03588em;">g</span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.8283360000000002em;"><span style="top:-1.8560149999999997em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6828285714285715em;"><span style="top:-2.786em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.0500049999999996em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">âˆ‘</span></span></span><span style="top:-4.300005em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.22222em;">V</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.430093em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">e</span><span class="mord mathdefault">x</span><span class="mord mathdefault">p</span><span class="mopen">(</span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.801892em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.033123em;"><span style="top:-2.4530000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3447999999999998em;margin-left:-0.02691em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.6068285714285713em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8495600000000001em;"><span style="top:-2.84956em;margin-right:0.1em;"><span class="pstrut" style="height:2.55556em;"></span><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.4009142857142858em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.254792em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.13889em;">T</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.52764em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathbf">h</span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.380428em;vertical-align:-0.347305em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.801892em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.033123em;"><span style="top:-2.4530000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3567071428571427em;margin-left:-0.02691em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02778em;">O</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.14329285714285717em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.254792em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.13889em;">T</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.347305em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathbf">h</span></span></span></span></span></span></p><ol start="6"><li><p>æ‰§è¡Œåå‘ä¼ æ’­ï¼Œè¾“å‡ºå±‚åˆ°æ¿€æ´»å‡½æ•°ï¼Œå°†å…¶ç»“æœè®°ä¸º <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>e</mi><mi>j</mi></msub></mrow><annotation encoding="application/x-tex">e_j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.716668em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span></p><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mfrac><mrow><mi mathvariant="normal">âˆ‚</mi><mi>E</mi></mrow><mrow><mi mathvariant="normal">âˆ‚</mi><msub><mi>u</mi><mi>j</mi></msub></mrow></mfrac><mo>=</mo><msub><mi>y</mi><mi>j</mi></msub><mo>âˆ’</mo><msub><mi>t</mi><mi>j</mi></msub><mo>:</mo><mo>=</mo><msub><mi>e</mi><mi>j</mi></msub></mrow><annotation encoding="application/x-tex">\dfrac{\partial{E} }{\partial{u_j} } = y_j - t_j := e_j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:2.343548em;vertical-align:-0.972108em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.37144em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">âˆ‚</span><span class="mord"><span class="mord"><span class="mord mathdefault">u</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">âˆ‚</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.05764em;">E</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.972108em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.8694379999999999em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.9011879999999999em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">:</span></span><span class="base"><span class="strut" style="height:0.36687em;vertical-align:0em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.716668em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span></span></p></li><li><p>æ‰§è¡Œåå‘ä¼ æ’­ï¼Œæ¿€æ´»å‡½æ•°åˆ°æƒå€¼çŸ©é˜µ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mi>W</mi><mo mathvariant="normal">â€²</mo></msup></mrow><annotation encoding="application/x-tex">W&#x27;</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.751892em;vertical-align:0em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span></span></span></span></p></li></ol><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mfrac><mrow><mi mathvariant="normal">âˆ‚</mi><mi>E</mi></mrow><mrow><mi mathvariant="normal">âˆ‚</mi><msub><msup><mi>v</mi><mo mathvariant="normal">â€²</mo></msup><msub><mi>w</mi><mi>j</mi></msub></msub></mrow></mfrac><mo>=</mo><mfrac><mrow><mi mathvariant="normal">âˆ‚</mi><mi>E</mi></mrow><mrow><mi mathvariant="normal">âˆ‚</mi><msub><mi>u</mi><mi>j</mi></msub></mrow></mfrac><mo>â‹…</mo><mfrac><mrow><mi mathvariant="normal">âˆ‚</mi><msub><mi>u</mi><mi>j</mi></msub></mrow><mrow><mi mathvariant="normal">âˆ‚</mi><msub><msup><mi>v</mi><mo mathvariant="normal">â€²</mo></msup><msub><mi>w</mi><mi>j</mi></msub></msub></mrow></mfrac><mo>=</mo><msub><mi>e</mi><mi>j</mi></msub><mo>â‹…</mo><mi mathvariant="bold">h</mi></mrow><annotation encoding="application/x-tex">\dfrac{\partial{E} }{\partial{ {v&#x27;}_{w_j} } } = \dfrac{\partial{E} }{\partial{u_j} } \cdot \dfrac{\partial{u_j} }{\partial{ {v&#x27;}_{w_j} } }= e_j \cdot \mathbf{h}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:2.40476em;vertical-align:-1.03332em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.37144em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">âˆ‚</span><span class="mord"><span class="mord"><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6778919999999999em;"><span style="top:-2.9890000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3280857142857143em;"><span style="top:-2.357em;margin-left:-0.02691em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2818857142857143em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.34731999999999996em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">âˆ‚</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.05764em;">E</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.03332em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.343548em;vertical-align:-0.972108em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.37144em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">âˆ‚</span><span class="mord"><span class="mord"><span class="mord mathdefault">u</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">âˆ‚</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.05764em;">E</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.972108em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">â‹…</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:2.40476em;vertical-align:-1.03332em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.37144em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">âˆ‚</span><span class="mord"><span class="mord"><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6778919999999999em;"><span style="top:-2.9890000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3280857142857143em;"><span style="top:-2.357em;margin-left:-0.02691em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2818857142857143em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.34731999999999996em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">âˆ‚</span><span class="mord"><span class="mord"><span class="mord mathdefault">u</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.03332em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.730558em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">â‹…</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord"><span class="mord mathbf">h</span></span></span></span></span></span></p><ol start="8"><li>è‡³æ­¤æˆ‘ä»¬å°±å¯ä»¥å®Œæˆå¯¹æƒå€¼çŸ©é˜µ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mi>W</mi><mo mathvariant="normal">â€²</mo></msup></mrow><annotation encoding="application/x-tex">W&#x27;</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.751892em;vertical-align:0em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span></span></span></span> çš„æ›´æ–°äº†</li></ol><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msubsup><msup><mi>v</mi><mo mathvariant="normal">â€²</mo></msup><msub><mi>w</mi><mi>j</mi></msub><mrow><mo stretchy="false">(</mo><mi>n</mi><mi>e</mi><mi>w</mi><mo stretchy="false">)</mo></mrow></msubsup><mo>=</mo><msubsup><msup><mi>v</mi><mo mathvariant="normal">â€²</mo></msup><msub><mi>w</mi><mi>j</mi></msub><mrow><mo stretchy="false">(</mo><mi>o</mi><mi>l</mi><mi>d</mi><mo stretchy="false">)</mo></mrow></msubsup><mo>âˆ’</mo><mi>Î·</mi><mo>â‹…</mo><msub><mi>e</mi><mi>j</mi></msub><mo>â‹…</mo><mi mathvariant="bold">h</mi><mtext>Â Â </mtext><mo stretchy="false">(</mo><mo><mi>f</mi><mi>o</mi><mi>r</mi></mo><mtext>Â </mtext><mi>j</mi><mtext>Â </mtext><mo><mi>i</mi><mi>n</mi></mo><mtext>Â </mtext><mo stretchy="false">{</mo><mn>1</mn><mo separator="true">,</mo><mn>2</mn><mo separator="true">,</mo><mo>â€¦</mo><mo separator="true">,</mo><mi>V</mi><mo stretchy="false">}</mo><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">{v&#x27;}_{w_j}^{(new)} = {v&#x27;}_{w_j}^{(old)} - \eta \cdot e_j \cdot \mathbf{h} \ \ (\mathop{for}\ j\ \mathop{in}\ \{1, 2, \dots, V\})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.524112em;vertical-align:-0.44432em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.801892em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0797919999999999em;"><span style="top:-2.4530000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3280857142857143em;"><span style="top:-2.357em;margin-left:-0.02691em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2818857142857143em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.254792em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathdefault mtight">n</span><span class="mord mathdefault mtight">e</span><span class="mord mathdefault mtight" style="margin-right:0.02691em;">w</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.44432em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.524112em;vertical-align:-0.44432em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.801892em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0797919999999999em;"><span style="top:-2.4530000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3280857142857143em;"><span style="top:-2.357em;margin-left:-0.02691em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2818857142857143em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.254792em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathdefault mtight">o</span><span class="mord mathdefault mtight" style="margin-right:0.01968em;">l</span><span class="mord mathdefault mtight">d</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.44432em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.63889em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">Î·</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">â‹…</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.730558em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">â‹…</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathbf">h</span></span><span class="mspace">Â </span><span class="mspace">Â </span><span class="mopen">(</span><span class="mop"><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="mord mathdefault" style="margin-right:0.02778em;">or</span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mspace">Â </span><span class="mord mathdefault" style="margin-right:0.05724em;">j</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mspace">Â </span><span class="mop"><span class="mord mathdefault">in</span></span><span class="mspace">Â </span><span class="mopen">{</span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">2</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner">â€¦</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.22222em;">V</span><span class="mclose">}</span><span class="mclose">)</span></span></span></span></span></p><ol start="9"><li>æ‰§è¡Œåå‘ä¼ æ’­ï¼Œæ¿€æ´»å‡½æ•°åˆ°éšå±‚ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="bold">h</mi></mrow><annotation encoding="application/x-tex">\mathbf{h}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord"><span class="mord mathbf">h</span></span></span></span></span> , ç»“æœè®°ä¸º <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>E</mi><mi>H</mi></mrow><annotation encoding="application/x-tex">EH</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.05764em;">E</span><span class="mord mathdefault" style="margin-right:0.08125em;">H</span></span></span></span></li></ol><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mfrac><mrow><mi mathvariant="normal">âˆ‚</mi><mi>E</mi></mrow><mrow><mi mathvariant="normal">âˆ‚</mi><mi mathvariant="bold">h</mi></mrow></mfrac><mo>=</mo><munderover><mo>âˆ‘</mo><mrow><mi>j</mi><mo>=</mo><mn>1</mn></mrow><mi>V</mi></munderover><mfrac><mrow><mi mathvariant="normal">âˆ‚</mi><mi>E</mi></mrow><mrow><mi mathvariant="normal">âˆ‚</mi><msub><mi>u</mi><mi>j</mi></msub></mrow></mfrac><mo>â‹…</mo><mfrac><mrow><mi mathvariant="normal">âˆ‚</mi><msub><mi>u</mi><mi>j</mi></msub></mrow><mrow><mi mathvariant="normal">âˆ‚</mi><mi mathvariant="bold">h</mi></mrow></mfrac><mo>=</mo><munderover><mo>âˆ‘</mo><mrow><mi>j</mi><mo>=</mo><mn>1</mn></mrow><mi>V</mi></munderover><msub><mi>e</mi><mi>j</mi></msub><mo>â‹…</mo><msub><msup><mi>v</mi><mo mathvariant="normal">â€²</mo></msup><msub><mi>w</mi><mi>j</mi></msub></msub><mo>:</mo><mo>=</mo><mi>E</mi><mi>H</mi></mrow><annotation encoding="application/x-tex">\dfrac{\partial{E} }{\partial{\mathbf{h} } } = \sum_{j=1}^{V}\dfrac{\partial{E} }{\partial{u_j} } \cdot \dfrac{\partial{u_j} }{\partial{\mathbf{h} } }= \sum_{j=1}^{V}e_j \cdot {v&#x27;}_{w_j} := EH</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:2.05744em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.37144em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">âˆ‚</span><span class="mord"><span class="mord"><span class="mord mathbf">h</span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">âˆ‚</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.05764em;">E</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:3.2421130000000007em;vertical-align:-1.4137769999999998em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.8283360000000006em;"><span style="top:-1.872331em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.050005em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">âˆ‘</span></span></span><span style="top:-4.3000050000000005em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.22222em;">V</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.4137769999999998em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.37144em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">âˆ‚</span><span class="mord"><span class="mord"><span class="mord mathdefault">u</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">âˆ‚</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.05764em;">E</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.972108em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">â‹…</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:2.05744em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.37144em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">âˆ‚</span><span class="mord"><span class="mord"><span class="mord mathbf">h</span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">âˆ‚</span><span class="mord"><span class="mord"><span class="mord mathdefault">u</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:3.2421130000000007em;vertical-align:-1.4137769999999998em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.8283360000000006em;"><span style="top:-1.872331em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.050005em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">âˆ‘</span></span></span><span style="top:-4.3000050000000005em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.22222em;">V</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.4137769999999998em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">â‹…</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.149212em;vertical-align:-0.34731999999999996em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.801892em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3280857142857143em;"><span style="top:-2.357em;margin-left:-0.02691em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2818857142857143em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.34731999999999996em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">:</span></span><span class="base"><span class="strut" style="height:0.36687em;vertical-align:0em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.05764em;">E</span><span class="mord mathdefault" style="margin-right:0.08125em;">H</span></span></span></span></span></p><ol start="10"><li><p>éšå±‚åˆ°æƒå€¼çŸ©é˜µ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="bold">W</mi></mrow><annotation encoding="application/x-tex">\mathbf{W}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68611em;vertical-align:0em;"></span><span class="mord"><span class="mord mathbf" style="margin-right:0.01597em;">W</span></span></span></span></span></p><p>æ³¨æ„è¿™é‡Œå¯¹æƒå€¼çŸ©é˜µ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>W</mi></mrow><annotation encoding="application/x-tex">W</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.13889em;">W</span></span></span></span> é’ˆå¯¹å•è¯ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>w</mi><mi>I</mi></msub></mrow><annotation encoding="application/x-tex">w_I</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.07847em;">I</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> æ‰€ä½œç”¨çš„åˆ—æ±‚åå¯¼ï¼Œé‚£ä¹ˆä»¥å®ƒåˆ—ç›¸å½“äºå¸¸æ•°ï¼Œå› æ­¤ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mstyle displaystyle="true" scriptlevel="0"><mfrac><mrow><mi mathvariant="normal">âˆ‚</mi><mi mathvariant="bold">h</mi></mrow><mrow><mi mathvariant="normal">âˆ‚</mi><msubsup><mi>v</mi><msub><mi>w</mi><mi>I</mi></msub><mi>T</mi></msubsup></mrow></mfrac></mstyle><mo>=</mo><mfrac><mn>1</mn><mi>C</mi></mfrac></mrow><annotation encoding="application/x-tex">\dfrac{\partial{\mathbf{h} } }{\partial{v_{w_I}^T} } = \frac{1}{C}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:2.404745em;vertical-align:-1.033305em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.37144em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">âˆ‚</span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7673309999999999em;"><span style="top:-2.4530000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3567071428571427em;margin-left:-0.02691em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathdefault mtight" style="margin-right:0.07847em;">I</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.14329285714285717em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-2.989em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.13889em;">T</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.347305em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">âˆ‚</span><span class="mord"><span class="mord"><span class="mord mathbf">h</span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.033305em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.190108em;vertical-align:-0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.845108em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.07153em;">C</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></p></li></ol><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mfrac><mrow><mi mathvariant="normal">âˆ‚</mi><mi>E</mi></mrow><mrow><mi mathvariant="normal">âˆ‚</mi><msubsup><mi>v</mi><msub><mi>w</mi><mi>I</mi></msub><mi>T</mi></msubsup></mrow></mfrac><mo>=</mo><mfrac><mrow><mi mathvariant="normal">âˆ‚</mi><mi>E</mi></mrow><mrow><mi mathvariant="normal">âˆ‚</mi><mi mathvariant="bold">h</mi></mrow></mfrac><mo>â‹…</mo><mfrac><mrow><mi mathvariant="normal">âˆ‚</mi><mi mathvariant="bold">h</mi></mrow><mrow><mi mathvariant="normal">âˆ‚</mi><msubsup><mi>v</mi><msub><mi>w</mi><mi>I</mi></msub><mi>T</mi></msubsup></mrow></mfrac><mo>=</mo><mi>E</mi><mi>H</mi><mo>â‹…</mo><mfrac><mn>1</mn><mi>C</mi></mfrac></mrow><annotation encoding="application/x-tex">\dfrac{\partial{E} }{\partial{v_{w_I}^T} } = \dfrac{\partial{E} }{\partial{\mathbf{h} } } \cdot \dfrac{\partial{\mathbf{h} } }{\partial{v_{w_I}^T} }= EH \cdot \dfrac{1}{C}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:2.404745em;vertical-align:-1.033305em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.37144em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">âˆ‚</span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7673309999999999em;"><span style="top:-2.4530000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3567071428571427em;margin-left:-0.02691em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathdefault mtight" style="margin-right:0.07847em;">I</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.14329285714285717em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-2.989em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.13889em;">T</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.347305em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">âˆ‚</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.05764em;">E</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.033305em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.05744em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.37144em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">âˆ‚</span><span class="mord"><span class="mord"><span class="mord mathbf">h</span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">âˆ‚</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.05764em;">E</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">â‹…</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:2.404745em;vertical-align:-1.033305em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.37144em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">âˆ‚</span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7673309999999999em;"><span style="top:-2.4530000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3567071428571427em;margin-left:-0.02691em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathdefault mtight" style="margin-right:0.07847em;">I</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.14329285714285717em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-2.989em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.13889em;">T</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.347305em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">âˆ‚</span><span class="mord"><span class="mord"><span class="mord mathbf">h</span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.033305em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.05764em;">E</span><span class="mord mathdefault" style="margin-right:0.08125em;">H</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">â‹…</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:2.00744em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.32144em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07153em;">C</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p><ol start="11"><li>è‡³æ­¤æˆ‘ä»¬å°±å¯ä»¥å®Œæˆå¯¹æƒå€¼çŸ©é˜µ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="bold">W</mi></mrow><annotation encoding="application/x-tex">\mathbf{W}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68611em;vertical-align:0em;"></span><span class="mord"><span class="mord mathbf" style="margin-right:0.01597em;">W</span></span></span></span></span> çš„æ›´æ–°äº†ï¼š</li></ol><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msubsup><mi>v</mi><msub><mi>w</mi><mrow><mi>I</mi><mo separator="true">,</mo><mi>c</mi></mrow></msub><mrow><mo stretchy="false">(</mo><mi>n</mi><mi>e</mi><mi>w</mi><mo stretchy="false">)</mo></mrow></msubsup><mo>=</mo><msubsup><mi>v</mi><msub><mi>w</mi><mrow><mi>I</mi><mo separator="true">,</mo><mi>c</mi></mrow></msub><mrow><mo stretchy="false">(</mo><mi>o</mi><mi>l</mi><mi>d</mi><mo stretchy="false">)</mo></mrow></msubsup><mo>âˆ’</mo><mi>Î·</mi><mo>â‹…</mo><mfrac><mn>1</mn><mi>C</mi></mfrac><mi>E</mi><msup><mi>H</mi><mi>T</mi></msup><mo>=</mo><msubsup><mi>v</mi><msub><mi>w</mi><mrow><mi>I</mi><mo separator="true">,</mo><mi>c</mi></mrow></msub><mrow><mo stretchy="false">(</mo><mi>o</mi><mi>l</mi><mi>d</mi><mo stretchy="false">)</mo></mrow></msubsup><mo>âˆ’</mo><mi>Î·</mi><mo>â‹…</mo><mfrac><mn>1</mn><mi>C</mi></mfrac><mo stretchy="false">(</mo><munderover><mo>âˆ‘</mo><mrow><mi>j</mi><mo>=</mo><mn>1</mn></mrow><mi>V</mi></munderover><msub><mi>e</mi><mi>j</mi></msub><mo>â‹…</mo><msub><msup><mi>v</mi><mo mathvariant="normal">â€²</mo></msup><msub><mi>w</mi><mi>j</mi></msub></msub><msup><mo stretchy="false">)</mo><mi>T</mi></msup></mrow><annotation encoding="application/x-tex">{v}_{w_{I,c} }^{(new)} = {v}_{w_{I,c} }^{(old)} - \eta \cdot \frac{1}{C} EH^T = {v}_{w_{I,c} }^{(old)} - \eta \cdot \frac{1}{C} (\sum_{j=1}^{V}e_j \cdot {v&#x27;}_{w_j})^T</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.382525em;vertical-align:-0.444525em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">v</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.938em;"><span style="top:-2.4530000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.34479999999999994em;"><span style="top:-2.3567071428571427em;margin-left:-0.02691em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.07847em;">I</span><span class="mpunct mtight">,</span><span class="mord mathdefault mtight">c</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.28217857142857145em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathdefault mtight">n</span><span class="mord mathdefault mtight">e</span><span class="mord mathdefault mtight" style="margin-right:0.02691em;">w</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.444525em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.382525em;vertical-align:-0.444525em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">v</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.938em;"><span style="top:-2.4530000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.34479999999999994em;"><span style="top:-2.3567071428571427em;margin-left:-0.02691em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.07847em;">I</span><span class="mpunct mtight">,</span><span class="mord mathdefault mtight">c</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.28217857142857145em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathdefault mtight">o</span><span class="mord mathdefault mtight" style="margin-right:0.01968em;">l</span><span class="mord mathdefault mtight">d</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.444525em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.63889em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">Î·</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">â‹…</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:2.00744em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.32144em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07153em;">C</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mord mathdefault" style="margin-right:0.05764em;">E</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8913309999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.382525em;vertical-align:-0.444525em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">v</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.938em;"><span style="top:-2.4530000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.34479999999999994em;"><span style="top:-2.3567071428571427em;margin-left:-0.02691em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.07847em;">I</span><span class="mpunct mtight">,</span><span class="mord mathdefault mtight">c</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.28217857142857145em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathdefault mtight">o</span><span class="mord mathdefault mtight" style="margin-right:0.01968em;">l</span><span class="mord mathdefault mtight">d</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.444525em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.63889em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">Î·</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">â‹…</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:3.2421130000000007em;vertical-align:-1.4137769999999998em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.32144em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07153em;">C</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mopen">(</span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.8283360000000006em;"><span style="top:-1.872331em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.050005em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">âˆ‘</span></span></span><span style="top:-4.3000050000000005em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.22222em;">V</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.4137769999999998em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">â‹…</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.238651em;vertical-align:-0.34731999999999996em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.801892em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3280857142857143em;"><span style="top:-2.357em;margin-left:-0.02691em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2818857142857143em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.34731999999999996em;"><span></span></span></span></span></span></span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8913309999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span></span></span></span></span></p><p>å¯ä»¥çœ‹å‡ºæ¥å¤šä¸ªå•è¯çš„è¾“å…¥å¯¹æœ€ç»ˆè¯å‘é‡çš„å½±å“ä¸ä»…ä»…åœ¨äº <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mfrac><mn>1</mn><mi>C</mi></mfrac></mrow><annotation encoding="application/x-tex">\frac{1}{C}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.190108em;vertical-align:-0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.845108em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.07153em;">C</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span> è€Œä¸”è¿˜æœ‰ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><msup><mi>v</mi><mo mathvariant="normal">â€²</mo></msup><msub><mi>w</mi><mi>j</mi></msub></msub></mrow><annotation encoding="application/x-tex">{v&#x27;}_{w_j}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.099212em;vertical-align:-0.34731999999999996em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3280857142857143em;"><span style="top:-2.357em;margin-left:-0.02691em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2818857142857143em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.34731999999999996em;"><span></span></span></span></span></span></span></span></span></span> , å³æƒå€¼çŸ©é˜µ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>W</mi><mi mathvariant="normal">â€™</mi></mrow><annotation encoding="application/x-tex">Wâ€™</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.13889em;">W</span><span class="mord">â€™</span></span></span></span>, å…¶åå‘ä¼ æ’­ä¸­ä¹Ÿå°†ä»¥ä¼—å¤šè¾“å…¥å‘é‡çš„éšè—è¡¨è¾¾ä¸ºæŒ‡å¯¼ï¼Œé…ä»¥ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>e</mi><mi>j</mi></msub><mo>=</mo><msub><mi>y</mi><mi>j</mi></msub><mo>âˆ’</mo><msub><mi>t</mi><mi>j</mi></msub></mrow><annotation encoding="application/x-tex">e_j = y_j - t_j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.716668em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.8694379999999999em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.9011879999999999em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span> è¿™ä¸€ â€œç¨‹åº¦ç¨€ç–â€ æ¥æ›´æ–°æƒé‡ï¼Œè¿›è€Œå½±å“åˆ°æƒå€¼çŸ©é˜µ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>W</mi></mrow><annotation encoding="application/x-tex">W</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.13889em;">W</span></span></span></span>ã€‚è¿™ä¸€ç°è±¡ä¹Ÿç¬¦åˆæˆ‘å¯¹ word2vec æ¨¡å‹çš„å‡è±¡é€»è¾‘ã€‚æ¨ç†è‡³æ­¤åº”è¯¥æ˜¯æˆåŠŸçš„ã€‚</p><h2 id="skip-gram-model"><a class="markdownIt-Anchor" href="#skip-gram-model"></a> Skip-Gram Model</h2><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20210712094615755.png" alt="image-20210712094615755" /></p><p>Skip-Gram æ¨¡å‹å›¾å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œå¯ä»¥çœ‹å‡ºå®ƒå’Œ CBOW æ­£å¥½ç›¸åï¼Œä»¥ä¸­é—´è¯ï¼ˆä¸€ä¸ªè¯ï¼‰ä½œä¸ºè¾“å…¥ï¼Œè¾“å‡ºç¡®å®ä¸­é—´è¯çš„ä¸Šä¸‹æ–‡å•è¯ï¼ˆå¤šä¸ªè¯ï¼‰ã€‚</p><blockquote><p>It is the opposite of the CBOW model. The target word is now at the input layer, and the context words are on the output layer.</p></blockquote><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ¨¡å‹å›¾ä¸­éšå±‚ä¸è¾“å‡ºå±‚ä¹‹é—´çš„æƒå€¼çŸ©é˜µ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>W</mi><mi mathvariant="normal">â€™</mi></mrow><annotation encoding="application/x-tex">Wâ€™</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.13889em;">W</span><span class="mord">â€™</span></span></span></span> ä»…æœ‰ä¸€ä¸ªï¼Œå› æ­¤æˆ‘ä»¬æœ‰ç€ç›¸åŒçš„è¾“å…¥ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="bold">x</mi></mrow><annotation encoding="application/x-tex">\mathbf{x}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.44444em;vertical-align:0em;"></span><span class="mord"><span class="mord mathbf">x</span></span></span></span></span> è¿›è¡ŒåŠ æƒæ±‚å’Œåæœ‰ç€ç›¸åŒçš„éšå±‚è¡¨è¾¾ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="bold">h</mi></mrow><annotation encoding="application/x-tex">\mathbf{h}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord"><span class="mord mathbf">h</span></span></span></span></span>ï¼Œå†åŠ æƒæ±‚å’Œæ¿€æ´»æˆ–å°±æœ‰ç€ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>C</mi></mrow><annotation encoding="application/x-tex">C</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.07153em;">C</span></span></span></span> ä¸ªç›¸åŒçš„è¾“å‡º <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="bold">y</mi></mrow><annotation encoding="application/x-tex">\mathbf{y}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.63888em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathbf" style="margin-right:0.01597em;">y</span></span></span></span></span> ,ä¸ºä»€ä¹ˆè¦è¿™ä¹ˆè®¾è®¡å‘¢ï¼Ÿ</p><p>æˆ‘è®¤ä¸ºçš„æ˜¯ï¼Œæˆ‘ä»¬æœ€ç»ˆçš„è¾“å‡ºä¸æ˜¯å°½å¯èƒ½å»å®Œæ•´çš„åŒ¹é…åˆ°å…·ä½“çš„ä¸€ä¸ªè¯å‘é‡ï¼Œè€Œæ˜¯å»å­¦ä¹ åˆ°è¾“å…¥è¯ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>w</mi><mi>I</mi></msub></mrow><annotation encoding="application/x-tex">w_I</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.07847em;">I</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> çš„ä¸€ä¸ªä¸Šä¸‹æ–‡è¯­å¢ƒçš„è¡¨è¾¾ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="bold">y</mi></mrow><annotation encoding="application/x-tex">\mathbf{y}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.63888em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathbf" style="margin-right:0.01597em;">y</span></span></span></span></span>ï¼ˆä¸€ä¸ªè¯å¯¹åº”ä¸€ä¸ªè¯­å¢ƒè¡¨è¾¾ï¼‰ï¼Œè€Œè®©è¿™ä¸ª <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="bold">y</mi></mrow><annotation encoding="application/x-tex">\mathbf{y}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.63888em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathbf" style="margin-right:0.01597em;">y</span></span></span></span></span> å°½å¯èƒ½çš„å’Œä¸Šä¸‹æ–‡å•è¯è¡¨è¾¾å·®è·æœ€å°ï¼Œè¿™æ ·åå¤è¿­ä»£ï¼Œå³å¯è¾¾åˆ°è¯å‘é‡é—´è¯­ä¹‰çš„æŠ“å–ã€‚</p><p>é‚£è¿™æ ·å°±å’ŒContinuous Bag-of-Word Modelã€One-word Contextã€‘çš„å‰åå‘ä¼ æ’­ä¸€è‡´äº†</p><ol><li>è¾“å…¥åˆ°éšå±‚çš„å‰å‘ä¼ æ’­ï¼š</li></ol><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="bold">h</mi><mo>=</mo><msup><mi mathvariant="bold">W</mi><mi>T</mi></msup><mi mathvariant="bold">x</mi><mo>=</mo><msubsup><mi mathvariant="bold">W</mi><mrow><mo stretchy="false">(</mo><mi>k</mi><mo separator="true">,</mo><mo separator="true">â‹…</mo><mo stretchy="false">)</mo></mrow><mi>T</mi></msubsup><mo>:</mo><mo>=</mo><msubsup><mi>v</mi><msub><mi>w</mi><mi>I</mi></msub><mi>T</mi></msubsup></mrow><annotation encoding="application/x-tex">\mathbf{h} = \mathbf{W}^T\mathbf{x}  = \mathbf{W}^T_{(k,Â·)} := v_{w_I}^T</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord"><span class="mord mathbf">h</span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.8913309999999999em;vertical-align:0em;"></span><span class="mord"><span class="mord"><span class="mord mathbf" style="margin-right:0.01597em;">W</span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8913309999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span><span class="mord"><span class="mord mathbf">x</span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.3383309999999997em;vertical-align:-0.4469999999999999em;"></span><span class="mord"><span class="mord"><span class="mord mathbf" style="margin-right:0.01597em;">W</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8913309999999999em;"><span style="top:-2.428em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathdefault mtight" style="margin-right:0.03148em;">k</span><span class="mpunct mtight">,</span><span class="mpunct mtight">â‹…</span><span class="mclose mtight">)</span></span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.13889em;">T</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.4469999999999999em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">:</span></span><span class="base"><span class="strut" style="height:0.36687em;vertical-align:0em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.238636em;vertical-align:-0.347305em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.891331em;"><span style="top:-2.4530000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3567071428571427em;margin-left:-0.02691em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathdefault mtight" style="margin-right:0.07847em;">I</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.14329285714285717em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.1130000000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.13889em;">T</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.347305em;"><span></span></span></span></span></span></span></span></span></span></span></p><ol start="2"><li><p>ç„¶åå®Œæˆéšå±‚åˆ°è¾“å‡ºå±‚çš„å‰å‘ä¼ æ’­</p><ol><li><p>ç¬¬ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>c</mi></mrow><annotation encoding="application/x-tex">c</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">c</span></span></span></span> ä¸ªè¾“å‡ºå±‚è¡¨è¾¾ï¼š</p><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>u</mi><mrow><mi>c</mi><mo separator="true">,</mo><mi>j</mi></mrow></msub><mo>=</mo><msub><mi>u</mi><mi>j</mi></msub><mo>=</mo><msubsup><msup><mi>v</mi><mo mathvariant="normal">â€²</mo></msup><msub><mi>w</mi><mi>j</mi></msub><mi>T</mi></msubsup><mi mathvariant="bold">h</mi></mrow><annotation encoding="application/x-tex">u_{c,j} = u_j = {v&#x27;}_{w_j}^T\mathbf{h}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.716668em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault">u</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">c</span><span class="mpunct mtight">,</span><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.716668em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault">u</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.4774429999999998em;vertical-align:-0.44432em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.801892em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0331229999999998em;"><span style="top:-2.4530000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3280857142857143em;"><span style="top:-2.357em;margin-left:-0.02691em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2818857142857143em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.254792em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.13889em;">T</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.44432em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathbf">h</span></span></span></span></span></span></p></li><li><p>å¯¹ç¬¬ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>c</mi></mrow><annotation encoding="application/x-tex">c</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">c</span></span></span></span> ä¸ªè¾“å‡ºè¿›è¡Œæ¿€æ´» (Softmax å‡½æ•°)ï¼š</p><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>p</mi><mo stretchy="false">(</mo><msub><mi>w</mi><mrow><mi>c</mi><mo separator="true">,</mo><mi>j</mi></mrow></msub><mi mathvariant="normal">âˆ£</mi><msub><mi>w</mi><mi>I</mi></msub><mo stretchy="false">)</mo><mo>=</mo><msub><mi>y</mi><mrow><mi>c</mi><mo separator="true">,</mo><mi>j</mi></mrow></msub><mo>=</mo><mfrac><mrow><mi>e</mi><mi>x</mi><mi>p</mi><mo stretchy="false">(</mo><msub><mi>u</mi><mi>j</mi></msub><mo stretchy="false">)</mo></mrow><mrow><munderover><mo>âˆ‘</mo><mrow><msup><mi>j</mi><mo mathvariant="normal">â€²</mo></msup><mo>=</mo><mn>1</mn></mrow><mi>V</mi></munderover><mi>e</mi><mi>x</mi><mi>p</mi><mo stretchy="false">(</mo><msub><mi>u</mi><msup><mi>j</mi><mo mathvariant="normal">â€²</mo></msup></msub><mo stretchy="false">)</mo></mrow></mfrac></mrow><annotation encoding="application/x-tex">p(w_{c,j}| w_{I}) = y_{c,j} = \dfrac{exp(u_{j})}{\sum_{j&#x27;=1}^{V}exp(u_{j&#x27;})}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.036108em;vertical-align:-0.286108em;"></span><span class="mord mathdefault">p</span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">c</span><span class="mpunct mtight">,</span><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mord">âˆ£</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.07847em;">I</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.716668em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">c</span><span class="mpunct mtight">,</span><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.734049em;vertical-align:-1.3070490000000001em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.427em;"><span style="top:-2.128769em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:-0.0000050000000000050004em;">âˆ‘</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.981231em;"><span style="top:-2.40029em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6828285714285715em;"><span style="top:-2.786em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.2029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.22222em;">V</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.43581800000000004em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">e</span><span class="mord mathdefault">x</span><span class="mord mathdefault">p</span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">u</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32798em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6828285714285715em;"><span style="top:-2.786em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault">e</span><span class="mord mathdefault">x</span><span class="mord mathdefault">p</span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">u</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.3070490000000001em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p><p>è¿™é‡Œå˜é‡æœ‰äº›è¿‡å¤šäº†ï¼šè¾“å‡ºå±‚ä¸€å…±æœ‰ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>C</mi></mrow><annotation encoding="application/x-tex">C</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.07153em;">C</span></span></span></span> ä¸ªï¼Œæˆ‘ä»¬ç°åœ¨è€ƒè™‘ç¬¬ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>c</mi></mrow><annotation encoding="application/x-tex">c</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">c</span></span></span></span>  ä¸ªè¾“å‡ºå±‚ï¼Œä¸€å…±æœ‰ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>V</mi></mrow><annotation encoding="application/x-tex">V</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.22222em;">V</span></span></span></span> ä¸ªå•è¯ï¼Œæˆ‘ä»¬ç°åœ¨è€ƒè™‘ç¬¬ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>c</mi></mrow><annotation encoding="application/x-tex">c</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">c</span></span></span></span>  ä¸ªè¾“å‡ºå±‚çš„è¡¨è¾¾æ˜¯ç¬¬ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>j</mi></mrow><annotation encoding="application/x-tex">j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.85396em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.05724em;">j</span></span></span></span> ä¸ªå•è¯çš„æ¦‚ç‡</p></li></ol></li><li><p>æ¥ä¸‹æ¥ç›´æ¥è¿›å…¥åˆ°æŸå¤±å‡½æ•°ç¯èŠ‚ï¼š</p></li></ol><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>E</mi><mo>=</mo><mo>âˆ’</mo><mo><mi>l</mi><mi>o</mi><mi>g</mi></mo><mi>p</mi><mo stretchy="false">(</mo><msub><mi>w</mi><mrow><mi>O</mi><mo separator="true">,</mo><mn>1</mn></mrow></msub><mo separator="true">,</mo><msub><mi>w</mi><mrow><mi>O</mi><mo separator="true">,</mo><mn>2</mn></mrow></msub><mo separator="true">,</mo><mo>â€¦</mo><mo separator="true">,</mo><msub><mi>w</mi><mrow><mi>O</mi><mo separator="true">,</mo><mi>C</mi></mrow></msub><mi mathvariant="normal">âˆ£</mi><msub><mi>w</mi><mi>I</mi></msub><mo stretchy="false">)</mo><mo>=</mo><mo>âˆ’</mo><mi>l</mi><mi>o</mi><mi>g</mi><munderover><mo>âˆ</mo><mrow><mi>c</mi><mo>=</mo><mn>1</mn></mrow><mi>C</mi></munderover><mfrac><mrow><mi>e</mi><mi>x</mi><mi>p</mi><mo stretchy="false">(</mo><msub><mi>u</mi><mrow><mi>c</mi><mo separator="true">,</mo><msubsup><mi>j</mi><mi>c</mi><mo>âˆ—</mo></msubsup></mrow></msub><mo stretchy="false">)</mo></mrow><mrow><munderover><mo>âˆ‘</mo><mrow><msup><mi>j</mi><mo mathvariant="normal">â€²</mo></msup><mo>=</mo><mn>1</mn></mrow><mi>V</mi></munderover><mi>e</mi><mi>x</mi><mi>p</mi><mo stretchy="false">(</mo><msub><mi>u</mi><msup><mi>j</mi><mo mathvariant="normal">â€²</mo></msup></msub><mo stretchy="false">)</mo></mrow></mfrac><mspace linebreak="newline"></mspace><mo>=</mo><mi>C</mi><mo>â‹…</mo><mo><mi>l</mi><mi>o</mi><mi>g</mi></mo><munderover><mo>âˆ‘</mo><mrow><msup><mi>j</mi><mo mathvariant="normal">â€²</mo></msup><mo>=</mo><mn>1</mn></mrow><mi>V</mi></munderover><mi>e</mi><mi>x</mi><mi>p</mi><mo stretchy="false">(</mo><msub><mi>u</mi><msup><mi>j</mi><mo mathvariant="normal">â€²</mo></msup></msub><mo stretchy="false">)</mo><mo>âˆ’</mo><munderover><mo>âˆ‘</mo><mrow><mi>c</mi><mo>=</mo><mn>1</mn></mrow><mi>C</mi></munderover><msub><mi>u</mi><mrow><mi>c</mi><mo separator="true">,</mo><msubsup><mi>j</mi><mi>c</mi><mo>âˆ—</mo></msubsup></mrow></msub></mrow><annotation encoding="application/x-tex">E = -\mathop{log} p(w_{O,1},w_{O,2},\dots,w_{O,C}|w_I) = -log \prod_{c=1}^{C} \dfrac{exp(u_{c,j_c^*})}{\sum_{j&#x27;=1}^{V}exp(u_{j&#x27;})} \\ = C \cdot \mathop{log}\sum_{j&#x27;=1}^{V}exp(u_{j&#x27;}) - \sum_{c=1}^{C} u_{c,j_c^*}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.05764em;">E</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.036108em;vertical-align:-0.286108em;"></span><span class="mord">âˆ’</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop"><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault">o</span><span class="mord mathdefault" style="margin-right:0.03588em;">g</span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">p</span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.328331em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02778em;">O</span><span class="mpunct mtight">,</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.328331em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02778em;">O</span><span class="mpunct mtight">,</span><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner">â€¦</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.328331em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02778em;">O</span><span class="mpunct mtight">,</span><span class="mord mathdefault mtight" style="margin-right:0.07153em;">C</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mord">âˆ£</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.07847em;">I</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:3.1353850000000003em;vertical-align:-1.3070490000000001em;"></span><span class="mord">âˆ’</span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault">o</span><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.8283360000000002em;"><span style="top:-1.882887em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">c</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.050005em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">âˆ</span></span></span><span style="top:-4.3000050000000005em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.07153em;">C</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.267113em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.4902000000000002em;"><span style="top:-2.128769em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:-0.0000050000000000050004em;">âˆ‘</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.981231em;"><span style="top:-2.40029em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6828285714285715em;"><span style="top:-2.786em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.2029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.22222em;">V</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.43581800000000004em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">e</span><span class="mord mathdefault">x</span><span class="mord mathdefault">p</span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">u</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32798em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6828285714285715em;"><span style="top:-2.786em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.7402em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault">e</span><span class="mord mathdefault">x</span><span class="mord mathdefault">p</span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">u</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">c</span><span class="mpunct mtight">,</span><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.6183428571428571em;"><span style="top:-2.214em;margin-left:-0.05724em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathdefault mtight">c</span></span></span><span style="top:-2.786em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mbin mtight">âˆ—</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.35019999999999996em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.3070490000000001em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:0.36687em;vertical-align:0em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.07153em;">C</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">â‹…</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:3.2584290000000005em;vertical-align:-1.430093em;"></span><span class="mop"><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault">o</span><span class="mord mathdefault" style="margin-right:0.03588em;">g</span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.8283360000000002em;"><span style="top:-1.8560149999999997em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6828285714285715em;"><span style="top:-2.786em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.0500049999999996em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">âˆ‘</span></span></span><span style="top:-4.300005em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.22222em;">V</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.430093em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">e</span><span class="mord mathdefault">x</span><span class="mord mathdefault">p</span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">u</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32798em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6828285714285715em;"><span style="top:-2.786em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:3.0954490000000003em;vertical-align:-1.267113em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.8283360000000002em;"><span style="top:-1.882887em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">c</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.050005em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">âˆ‘</span></span></span><span style="top:-4.3000050000000005em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.07153em;">C</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.267113em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault">u</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">c</span><span class="mpunct mtight">,</span><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.6183428571428571em;"><span style="top:-2.214em;margin-left:-0.05724em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathdefault mtight">c</span></span></span><span style="top:-2.786em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mbin mtight">âˆ—</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.35019999999999996em;"><span></span></span></span></span></span></span></span></span></span></span></p><ol start="4"><li><p>æ‰§è¡Œåå‘ä¼ æ’­ï¼Œè¾“å‡ºå±‚åˆ°æ¿€æ´»å‡½æ•°ï¼Œå°†å…¶ç»“æœè®°ä¸º <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>e</mi><mrow><mi>c</mi><mo separator="true">,</mo><mi>j</mi></mrow></msub></mrow><annotation encoding="application/x-tex">e_{c,j}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.716668em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">c</span><span class="mpunct mtight">,</span><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span></p><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mfrac><mrow><mi mathvariant="normal">âˆ‚</mi><mi>E</mi></mrow><mrow><mi mathvariant="normal">âˆ‚</mi><msub><mi>u</mi><mrow><mi>c</mi><mo separator="true">,</mo><mi>j</mi></mrow></msub></mrow></mfrac><mo>=</mo><msub><mi>y</mi><mrow><mi>c</mi><mo separator="true">,</mo><mi>j</mi></mrow></msub><mo>âˆ’</mo><msub><mi>t</mi><mrow><mi>c</mi><mo separator="true">,</mo><mi>j</mi></mrow></msub><mo>:</mo><mo>=</mo><msub><mi>e</mi><mrow><mi>c</mi><mo separator="true">,</mo><mi>j</mi></mrow></msub></mrow><annotation encoding="application/x-tex">\dfrac{\partial{E} }{\partial{u_{c,j} } } = y_{c,j} - t_{c,j} := e_{c,j}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:2.343548em;vertical-align:-0.972108em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.37144em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">âˆ‚</span><span class="mord"><span class="mord"><span class="mord mathdefault">u</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">c</span><span class="mpunct mtight">,</span><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">âˆ‚</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.05764em;">E</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.972108em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.8694379999999999em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">c</span><span class="mpunct mtight">,</span><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.9011879999999999em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">c</span><span class="mpunct mtight">,</span><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">:</span></span><span class="base"><span class="strut" style="height:0.36687em;vertical-align:0em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.716668em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">c</span><span class="mpunct mtight">,</span><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span></span></p></li><li><p>åˆå¹¶å„ä¸ªè¾“å‡ºå±‚ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>c</mi></mrow><annotation encoding="application/x-tex">c</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">c</span></span></span></span> çš„åå‘ä¼ æ’­ç»“æœï¼š</p><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>E</mi><msub><mi>I</mi><mi>j</mi></msub><mo>=</mo><munderover><mo>âˆ‘</mo><mrow><mi>c</mi><mo>=</mo><mn>1</mn></mrow><mi>C</mi></munderover><msub><mi>e</mi><mrow><mi>c</mi><mo separator="true">,</mo><mi>j</mi></mrow></msub><mo>=</mo><mfrac><mrow><mi mathvariant="normal">âˆ‚</mi><mi>E</mi></mrow><mrow><mi mathvariant="normal">âˆ‚</mi><msub><mi>u</mi><mi>j</mi></msub></mrow></mfrac></mrow><annotation encoding="application/x-tex">EI_j = \sum_{c=1}^{C}e_{c,j} = \dfrac{\partial{E} }{\partial{u_j} }</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.969438em;vertical-align:-0.286108em;"></span><span class="mord mathdefault" style="margin-right:0.05764em;">E</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07847em;">I</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.07847em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:3.0954490000000003em;vertical-align:-1.267113em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.8283360000000002em;"><span style="top:-1.882887em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">c</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.050005em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">âˆ‘</span></span></span><span style="top:-4.3000050000000005em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.07153em;">C</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.267113em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">c</span><span class="mpunct mtight">,</span><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.343548em;vertical-align:-0.972108em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.37144em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">âˆ‚</span><span class="mord"><span class="mord"><span class="mord mathdefault">u</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">âˆ‚</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.05764em;">E</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.972108em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p></li><li><p>æ‰§è¡Œåå‘ä¼ æ’­ï¼Œæ¿€æ´»å‡½æ•°åˆ°æƒå€¼çŸ©é˜µ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mi>W</mi><mo mathvariant="normal">â€²</mo></msup></mrow><annotation encoding="application/x-tex">W&#x27;</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.751892em;vertical-align:0em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span></span></span></span></p><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mfrac><mrow><mi mathvariant="normal">âˆ‚</mi><mi>E</mi></mrow><mrow><mi mathvariant="normal">âˆ‚</mi><msub><msup><mi>v</mi><mo mathvariant="normal">â€²</mo></msup><msub><mi>w</mi><mi>j</mi></msub></msub></mrow></mfrac><mo>=</mo><mfrac><mrow><mi mathvariant="normal">âˆ‚</mi><mi>E</mi></mrow><mrow><mi mathvariant="normal">âˆ‚</mi><msub><mi>u</mi><mi>j</mi></msub></mrow></mfrac><mo>â‹…</mo><mfrac><mrow><mi mathvariant="normal">âˆ‚</mi><msub><mi>u</mi><mi>j</mi></msub></mrow><mrow><mi mathvariant="normal">âˆ‚</mi><msub><msup><mi>v</mi><mo mathvariant="normal">â€²</mo></msup><msub><mi>w</mi><mi>j</mi></msub></msub></mrow></mfrac><mo>=</mo><mi>E</mi><msub><mi>I</mi><mi>j</mi></msub><mo>â‹…</mo><mi mathvariant="bold">h</mi></mrow><annotation encoding="application/x-tex">\dfrac{\partial{E} }{\partial{ {v&#x27;}_{w_j} } } = \dfrac{\partial{E} }{\partial{u_j} } \cdot \dfrac{\partial{u_j} }{\partial{ {v&#x27;}_{w_j} } }= EI_j \cdot \mathbf{h}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:2.40476em;vertical-align:-1.03332em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.37144em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">âˆ‚</span><span class="mord"><span class="mord"><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6778919999999999em;"><span style="top:-2.9890000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3280857142857143em;"><span style="top:-2.357em;margin-left:-0.02691em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2818857142857143em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.34731999999999996em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">âˆ‚</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.05764em;">E</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.03332em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.343548em;vertical-align:-0.972108em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.37144em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">âˆ‚</span><span class="mord"><span class="mord"><span class="mord mathdefault">u</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">âˆ‚</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.05764em;">E</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.972108em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">â‹…</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:2.40476em;vertical-align:-1.03332em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.37144em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">âˆ‚</span><span class="mord"><span class="mord"><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6778919999999999em;"><span style="top:-2.9890000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3280857142857143em;"><span style="top:-2.357em;margin-left:-0.02691em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2818857142857143em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.34731999999999996em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">âˆ‚</span><span class="mord"><span class="mord"><span class="mord mathdefault">u</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.03332em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.969438em;vertical-align:-0.286108em;"></span><span class="mord mathdefault" style="margin-right:0.05764em;">E</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07847em;">I</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.07847em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">â‹…</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord"><span class="mord mathbf">h</span></span></span></span></span></span></p></li><li><p>è‡³æ­¤æˆ‘ä»¬å°±å¯ä»¥å®Œæˆå¯¹æƒå€¼çŸ©é˜µ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mi>W</mi><mo mathvariant="normal">â€²</mo></msup></mrow><annotation encoding="application/x-tex">W&#x27;</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.751892em;vertical-align:0em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span></span></span></span> çš„æ›´æ–°äº†</p></li></ol><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msubsup><msup><mi>v</mi><mo mathvariant="normal">â€²</mo></msup><msub><mi>w</mi><mi>j</mi></msub><mrow><mo stretchy="false">(</mo><mi>n</mi><mi>e</mi><mi>w</mi><mo stretchy="false">)</mo></mrow></msubsup><mo>=</mo><msubsup><msup><mi>v</mi><mo mathvariant="normal">â€²</mo></msup><msub><mi>w</mi><mi>j</mi></msub><mrow><mo stretchy="false">(</mo><mi>o</mi><mi>l</mi><mi>d</mi><mo stretchy="false">)</mo></mrow></msubsup><mo>âˆ’</mo><mi>Î·</mi><mo>â‹…</mo><mi>E</mi><msub><mi>I</mi><mi>j</mi></msub><mo>â‹…</mo><mi mathvariant="bold">h</mi><mtext>Â Â </mtext><mo stretchy="false">(</mo><mo><mi>f</mi><mi>o</mi><mi>r</mi></mo><mtext>Â </mtext><mi>j</mi><mtext>Â </mtext><mo><mi>i</mi><mi>n</mi></mo><mtext>Â </mtext><mo stretchy="false">{</mo><mn>1</mn><mo separator="true">,</mo><mn>2</mn><mo separator="true">,</mo><mo>â€¦</mo><mo separator="true">,</mo><mi>V</mi><mo stretchy="false">}</mo><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">{v&#x27;}_{w_j}^{(new)} = {v&#x27;}_{w_j}^{(old)} - \eta \cdot EI_j \cdot \mathbf{h} \ \ (\mathop{for}\ j\ \mathop{in}\ \{1, 2, \dots, V\})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.524112em;vertical-align:-0.44432em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.801892em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0797919999999999em;"><span style="top:-2.4530000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3280857142857143em;"><span style="top:-2.357em;margin-left:-0.02691em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2818857142857143em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.254792em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathdefault mtight">n</span><span class="mord mathdefault mtight">e</span><span class="mord mathdefault mtight" style="margin-right:0.02691em;">w</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.44432em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.524112em;vertical-align:-0.44432em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.801892em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0797919999999999em;"><span style="top:-2.4530000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3280857142857143em;"><span style="top:-2.357em;margin-left:-0.02691em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2818857142857143em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.254792em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathdefault mtight">o</span><span class="mord mathdefault mtight" style="margin-right:0.01968em;">l</span><span class="mord mathdefault mtight">d</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.44432em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.63889em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">Î·</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">â‹…</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.969438em;vertical-align:-0.286108em;"></span><span class="mord mathdefault" style="margin-right:0.05764em;">E</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07847em;">I</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.07847em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">â‹…</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathbf">h</span></span><span class="mspace">Â </span><span class="mspace">Â </span><span class="mopen">(</span><span class="mop"><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="mord mathdefault" style="margin-right:0.02778em;">or</span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mspace">Â </span><span class="mord mathdefault" style="margin-right:0.05724em;">j</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mspace">Â </span><span class="mop"><span class="mord mathdefault">in</span></span><span class="mspace">Â </span><span class="mopen">{</span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">2</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner">â€¦</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.22222em;">V</span><span class="mclose">}</span><span class="mclose">)</span></span></span></span></span></p><ol start="8"><li>æ‰§è¡Œåå‘ä¼ æ’­ï¼Œæ¿€æ´»å‡½æ•°åˆ°éšå±‚ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="bold">h</mi></mrow><annotation encoding="application/x-tex">\mathbf{h}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord"><span class="mord mathbf">h</span></span></span></span></span> , ç»“æœè®°ä¸º <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>E</mi><mi>H</mi></mrow><annotation encoding="application/x-tex">EH</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.05764em;">E</span><span class="mord mathdefault" style="margin-right:0.08125em;">H</span></span></span></span></li></ol><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mfrac><mrow><mi mathvariant="normal">âˆ‚</mi><mi>E</mi></mrow><mrow><mi mathvariant="normal">âˆ‚</mi><mi mathvariant="bold">h</mi></mrow></mfrac><mo>=</mo><munderover><mo>âˆ‘</mo><mrow><mi>j</mi><mo>=</mo><mn>1</mn></mrow><mi>V</mi></munderover><mfrac><mrow><mi mathvariant="normal">âˆ‚</mi><mi>E</mi></mrow><mrow><mi mathvariant="normal">âˆ‚</mi><msub><mi>u</mi><mi>j</mi></msub></mrow></mfrac><mo>â‹…</mo><mfrac><mrow><mi mathvariant="normal">âˆ‚</mi><msub><mi>u</mi><mi>j</mi></msub></mrow><mrow><mi mathvariant="normal">âˆ‚</mi><mi mathvariant="bold">h</mi></mrow></mfrac><mo>=</mo><munderover><mo>âˆ‘</mo><mrow><mi>j</mi><mo>=</mo><mn>1</mn></mrow><mi>V</mi></munderover><mi>E</mi><msub><mi>I</mi><mi>j</mi></msub><mo>â‹…</mo><msub><msup><mi>v</mi><mo mathvariant="normal">â€²</mo></msup><msub><mi>w</mi><mi>j</mi></msub></msub><mo>:</mo><mo>=</mo><mi>E</mi><mi>H</mi></mrow><annotation encoding="application/x-tex">\dfrac{\partial{E} }{\partial{\mathbf{h} } } = \sum_{j=1}^{V}\dfrac{\partial{E} }{\partial{u_j} } \cdot \dfrac{\partial{u_j} }{\partial{\mathbf{h} } }= \sum_{j=1}^{V}EI_j \cdot {v&#x27;}_{w_j} := EH</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:2.05744em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.37144em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">âˆ‚</span><span class="mord"><span class="mord"><span class="mord mathbf">h</span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">âˆ‚</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.05764em;">E</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:3.2421130000000007em;vertical-align:-1.4137769999999998em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.8283360000000006em;"><span style="top:-1.872331em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.050005em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">âˆ‘</span></span></span><span style="top:-4.3000050000000005em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.22222em;">V</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.4137769999999998em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.37144em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">âˆ‚</span><span class="mord"><span class="mord"><span class="mord mathdefault">u</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">âˆ‚</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.05764em;">E</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.972108em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">â‹…</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:2.05744em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.37144em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">âˆ‚</span><span class="mord"><span class="mord"><span class="mord mathbf">h</span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">âˆ‚</span><span class="mord"><span class="mord"><span class="mord mathdefault">u</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:3.2421130000000007em;vertical-align:-1.4137769999999998em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.8283360000000006em;"><span style="top:-1.872331em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.050005em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">âˆ‘</span></span></span><span style="top:-4.3000050000000005em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.22222em;">V</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.4137769999999998em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.05764em;">E</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07847em;">I</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.07847em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">â‹…</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.149212em;vertical-align:-0.34731999999999996em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.801892em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3280857142857143em;"><span style="top:-2.357em;margin-left:-0.02691em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2818857142857143em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.34731999999999996em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">:</span></span><span class="base"><span class="strut" style="height:0.36687em;vertical-align:0em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.05764em;">E</span><span class="mord mathdefault" style="margin-right:0.08125em;">H</span></span></span></span></span></p><ol start="9"><li>éšå±‚åˆ°æƒå€¼çŸ©é˜µ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="bold">W</mi></mrow><annotation encoding="application/x-tex">\mathbf{W}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68611em;vertical-align:0em;"></span><span class="mord"><span class="mord mathbf" style="margin-right:0.01597em;">W</span></span></span></span></span></li></ol><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mfrac><mrow><mi mathvariant="normal">âˆ‚</mi><mi>E</mi></mrow><mrow><mi mathvariant="normal">âˆ‚</mi><msub><mi>v</mi><msub><mi>w</mi><mi>I</mi></msub></msub></mrow></mfrac><mo>=</mo><mfrac><mrow><mi mathvariant="normal">âˆ‚</mi><mi>E</mi></mrow><mrow><mi mathvariant="normal">âˆ‚</mi><mi mathvariant="bold">h</mi></mrow></mfrac><mo>â‹…</mo><mfrac><mrow><mi mathvariant="normal">âˆ‚</mi><mi mathvariant="bold">h</mi></mrow><mrow><mi mathvariant="normal">âˆ‚</mi><msub><mi>v</mi><msub><mi>w</mi><mi>I</mi></msub></msub></mrow></mfrac><mo>=</mo><mi>E</mi><mi>H</mi></mrow><annotation encoding="application/x-tex">\dfrac{\partial{E} }{\partial{v_{w_I} } } = \dfrac{\partial{E} }{\partial{\mathbf{h} } } \cdot \dfrac{\partial{\mathbf{h} } }{\partial{v_{w_I} } }= EH</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:2.307745em;vertical-align:-0.936305em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.37144em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">âˆ‚</span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139199999999997em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3567071428571427em;margin-left:-0.02691em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathdefault mtight" style="margin-right:0.07847em;">I</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.14329285714285717em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.250305em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">âˆ‚</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.05764em;">E</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.936305em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.05744em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.37144em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">âˆ‚</span><span class="mord"><span class="mord"><span class="mord mathbf">h</span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">âˆ‚</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.05764em;">E</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">â‹…</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:2.307745em;vertical-align:-0.936305em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.37144em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">âˆ‚</span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139199999999997em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3567071428571427em;margin-left:-0.02691em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathdefault mtight" style="margin-right:0.07847em;">I</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.14329285714285717em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.250305em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">âˆ‚</span><span class="mord"><span class="mord"><span class="mord mathbf">h</span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.936305em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.05764em;">E</span><span class="mord mathdefault" style="margin-right:0.08125em;">H</span></span></span></span></span></p><ol start="10"><li>è‡³æ­¤æˆ‘ä»¬å°±å¯ä»¥å®Œæˆå¯¹æƒå€¼çŸ©é˜µ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="bold">W</mi></mrow><annotation encoding="application/x-tex">\mathbf{W}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68611em;vertical-align:0em;"></span><span class="mord"><span class="mord mathbf" style="margin-right:0.01597em;">W</span></span></span></span></span> çš„æ›´æ–°äº†ï¼š</li></ol><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msubsup><mi>v</mi><msub><mi>w</mi><mi>I</mi></msub><mrow><mo stretchy="false">(</mo><mi>n</mi><mi>e</mi><mi>w</mi><mo stretchy="false">)</mo></mrow></msubsup><mo>=</mo><msubsup><mi>v</mi><msub><mi>w</mi><mi>I</mi></msub><mrow><mo stretchy="false">(</mo><mi>o</mi><mi>l</mi><mi>d</mi><mo stretchy="false">)</mo></mrow></msubsup><mo>âˆ’</mo><mi>Î·</mi><mi>E</mi><msup><mi>H</mi><mi>T</mi></msup><mo>=</mo><msubsup><mi>v</mi><msub><mi>w</mi><mi>I</mi></msub><mrow><mo stretchy="false">(</mo><mi>o</mi><mi>l</mi><mi>d</mi><mo stretchy="false">)</mo></mrow></msubsup><mo>âˆ’</mo><mi>Î·</mi><mo stretchy="false">(</mo><munderover><mo>âˆ‘</mo><mrow><mi>j</mi><mo>=</mo><mn>1</mn></mrow><mi>V</mi></munderover><mi>E</mi><msub><mi>I</mi><mi>j</mi></msub><mo>â‹…</mo><msub><msup><mi>v</mi><mo mathvariant="normal">â€²</mo></msup><msub><mi>w</mi><mi>j</mi></msub></msub><msup><mo stretchy="false">)</mo><mi>T</mi></msup></mrow><annotation encoding="application/x-tex">{v}_{w_I}^{(new)} = {v}_{w_I}^{(old)} - \eta EH^T = {v}_{w_I}^{(old)} - \eta(\sum_{j=1}^{V}EI_j \cdot {v&#x27;}_{w_j})^T</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.285305em;vertical-align:-0.347305em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">v</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.938em;"><span style="top:-2.4530000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3567071428571427em;margin-left:-0.02691em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathdefault mtight" style="margin-right:0.07847em;">I</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.14329285714285717em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathdefault mtight">n</span><span class="mord mathdefault mtight">e</span><span class="mord mathdefault mtight" style="margin-right:0.02691em;">w</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.347305em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.285305em;vertical-align:-0.347305em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">v</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.938em;"><span style="top:-2.4530000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3567071428571427em;margin-left:-0.02691em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathdefault mtight" style="margin-right:0.07847em;">I</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.14329285714285717em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathdefault mtight">o</span><span class="mord mathdefault mtight" style="margin-right:0.01968em;">l</span><span class="mord mathdefault mtight">d</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.347305em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.0857709999999998em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">Î·</span><span class="mord mathdefault" style="margin-right:0.05764em;">E</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8913309999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.285305em;vertical-align:-0.347305em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">v</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.938em;"><span style="top:-2.4530000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3567071428571427em;margin-left:-0.02691em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathdefault mtight" style="margin-right:0.07847em;">I</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.14329285714285717em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathdefault mtight">o</span><span class="mord mathdefault mtight" style="margin-right:0.01968em;">l</span><span class="mord mathdefault mtight">d</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.347305em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:3.2421130000000007em;vertical-align:-1.4137769999999998em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">Î·</span><span class="mopen">(</span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.8283360000000006em;"><span style="top:-1.872331em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.050005em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">âˆ‘</span></span></span><span style="top:-4.3000050000000005em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.22222em;">V</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.4137769999999998em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.05764em;">E</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07847em;">I</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.07847em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">â‹…</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.238651em;vertical-align:-0.34731999999999996em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.801892em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3280857142857143em;"><span style="top:-2.357em;margin-left:-0.02691em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2818857142857143em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.34731999999999996em;"><span></span></span></span></span></span></span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8913309999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span></span></span></span></span></p><blockquote><p>å¯ä»¥çœ‹å‡º â€œç¨‹åº¦ç³»æ•°â€œ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>E</mi><msub><mi>I</mi><mi>j</mi></msub></mrow><annotation encoding="application/x-tex">EI_j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.969438em;vertical-align:-0.286108em;"></span><span class="mord mathdefault" style="margin-right:0.05764em;">E</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07847em;">I</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.07847em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span> å°†è€ƒè™‘åˆ°è¾“å…¥è¯çš„ä¸Šä¸‹æ–‡è¡¨è¾¾ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="bold">y</mi></mrow><annotation encoding="application/x-tex">\mathbf{y}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.63888em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathbf" style="margin-right:0.01597em;">y</span></span></span></span></span> ä¸çœŸå®ä¸Šä¸‹æ–‡å•è¯ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msubsup><mi>j</mi><mi>c</mi><mo>âˆ—</mo></msubsup></mrow><annotation encoding="application/x-tex">j_{c}^*</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.935696em;vertical-align:-0.247em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.05724em;">j</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.688696em;"><span style="top:-2.4530000000000003em;margin-left:-0.05724em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">c</span></span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mbin mtight">âˆ—</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span></span></span></span> çš„ç›¸å·®ç¨‹åº¦ï¼Œæ¥åˆ©ç”¨ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>v</mi><msub><mi mathvariant="normal">â€™</mi><msub><mi>w</mi><mi>j</mi></msub></msub></mrow><annotation encoding="application/x-tex">vâ€™_{w_j}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.04176em;vertical-align:-0.34731999999999996em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">v</span><span class="mord"><span class="mord">â€™</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3280857142857143em;"><span style="top:-2.357em;margin-left:-0.02691em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2818857142857143em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.34731999999999996em;"><span></span></span></span></span></span></span></span></span></span> æ›´æ–°æƒå€¼çŸ©é˜µ</p></blockquote><h1 id="ä¼˜åŒ–è®¡ç®—æ•ˆç‡"><a class="markdownIt-Anchor" href="#ä¼˜åŒ–è®¡ç®—æ•ˆç‡"></a> ä¼˜åŒ–è®¡ç®—æ•ˆç‡</h1><p>Optimizing Computational Efficiency</p><p>åœ¨å‰é¢çš„å­¦ä¹ è¿‡ç¨‹ä¸­ï¼Œå°±å¯ä»¥çœ‹å‡ºæˆ‘ä»¬æ¨¡å‹å¯¹ç¬¬ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>j</mi></mrow><annotation encoding="application/x-tex">j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.85396em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.05724em;">j</span></span></span></span> ä¸ªå•è¯çš„é¢„æµ‹æ¦‚ç‡éœ€è¦å»è®¡ç®—å…¶ä½™æ‰€æœ‰å•è¯çš„æ¦‚ç‡å’Œ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mstyle displaystyle="true" scriptlevel="0"><mfrac><mrow><mi>e</mi><mi>x</mi><mi>p</mi><mo stretchy="false">(</mo><msub><mi>u</mi><mi>j</mi></msub><mo stretchy="false">)</mo></mrow><mrow><msubsup><mo>âˆ‘</mo><mrow><msup><mi>j</mi><mo mathvariant="normal">â€²</mo></msup><mo>=</mo><mn>1</mn></mrow><mi>V</mi></msubsup><mi>e</mi><mi>x</mi><mi>p</mi><mo stretchy="false">(</mo><msub><mi>u</mi><msup><mi>j</mi><mo mathvariant="normal">â€²</mo></msup></msub><mo stretchy="false">)</mo></mrow></mfrac></mstyle></mrow><annotation encoding="application/x-tex">\dfrac{exp(u_{j})}{\sum_{j&#x27;=1}^{V}exp(u_{j&#x27;})}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:2.734049em;vertical-align:-1.3070490000000001em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.427em;"><span style="top:-2.128769em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:-0.0000050000000000050004em;">âˆ‘</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.981231em;"><span style="top:-2.40029em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6828285714285715em;"><span style="top:-2.786em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.2029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.22222em;">V</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.43581800000000004em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">e</span><span class="mord mathdefault">x</span><span class="mord mathdefault">p</span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">u</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32798em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6828285714285715em;"><span style="top:-2.786em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault">e</span><span class="mord mathdefault">x</span><span class="mord mathdefault">p</span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">u</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.3070490000000001em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span>ï¼Œè™½ç„¶éƒ½é€šè¿‡çŸ©é˜µè¿ç®—ä¸€æ¬¡æ€§è®¡ç®—å‡ºæ¥äº†ï¼Œä½†æ˜¯å­—å…¸ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>V</mi></mrow><annotation encoding="application/x-tex">V</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.22222em;">V</span></span></span></span> é€šå¸¸æ˜¯ million çº§åˆ«çš„åº”ç”¨ï¼Œå› æ­¤è¿˜æ˜¯ä¼šå¤§å¤§å½±å“äº†è®¡ç®—æ•ˆç‡</p><h2 id="hierarchical-softmax"><a class="markdownIt-Anchor" href="#hierarchical-softmax"></a> Hierarchical Softmax</h2><p>è¿™æ˜¯è§£å†³æ–¹æ¡ˆä¹‹ä¸€ï¼Œçœ‹åå­—èƒ½å¤ŸçŸ¥é“æ˜¯è¦åœ¨ softmax ä¸Šåšæ–‡ç« ï¼Œæœ€ç»ˆå®ç° softmax çš„é«˜æ•ˆè®¡ç®—</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20210712113315199.png" alt="image-20210712113315199" /></p><p>æ•°æ®ç»“æ„ä¸ºäºŒå‰æ ‘ï¼Œå¶å­èŠ‚ç‚¹ä¸ºè¯å…¸ä¸­çš„è¯ï¼Œä¸€å…±æœ‰ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>V</mi></mrow><annotation encoding="application/x-tex">V</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.22222em;">V</span></span></span></span> ä¸ªè¯ï¼Œå› æ­¤äºŒå‰æ ‘å†…éƒ¨èŠ‚ç‚¹ä¸ªæ•°ä¸º <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>V</mi><mo>âˆ’</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">V-1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.76666em;vertical-align:-0.08333em;"></span><span class="mord mathdefault" style="margin-right:0.22222em;">V</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span></p><blockquote><p>è¯æ˜ï¼š</p><p>è®¾èŠ‚ç‚¹æ€»æ•°ä¸º <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">n</span></span></span></span>ï¼Œå¶å­èŠ‚ç‚¹ä¸ªæ•°ä¸ºï¼š<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>n</mi><mn>0</mn></msub></mrow><annotation encoding="application/x-tex">n_0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">n</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>ï¼Œåº¦ä¸º 1 çš„èŠ‚ç‚¹ä¸ªæ•°ä¸ºï¼š<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>n</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">n_1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">n</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>ï¼Œåº¦ä¸º 2 çš„èŠ‚ç‚¹ä¸ªæ•°ä¸º <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>n</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">n_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">n</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>ï¼Œè¾¹çš„ä¸ªæ•°ä¸º <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>b</mi></mrow><annotation encoding="application/x-tex">b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault">b</span></span></span></span>ï¼Œåº¦ä¸º 1 çš„èŠ‚ç‚¹ç”Ÿå‡ºä¸€æ¡è¾¹ï¼Œåº¦ä¸º 2 çš„èŠ‚ç‚¹ç”Ÿå‡ºä¸¤æ¡è¾¹</p><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>n</mi><mo>=</mo><msub><mi>n</mi><mn>0</mn></msub><mo>+</mo><msub><mi>n</mi><mn>1</mn></msub><mo>+</mo><msub><mi>n</mi><mn>2</mn></msub><mspace linebreak="newline"></mspace><mi>b</mi><mo>=</mo><mi>n</mi><mo>âˆ’</mo><mn>1</mn><mo>=</mo><msub><mi>n</mi><mn>1</mn></msub><mo>+</mo><mn>2</mn><msub><mi>n</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">n = n_0 + n_1 + n_2 \\b = n - 1 = n_1 + 2n_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">n</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.73333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">n</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.73333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">n</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">n</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault">b</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.66666em;vertical-align:-0.08333em;"></span><span class="mord mathdefault">n</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.73333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">n</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.79444em;vertical-align:-0.15em;"></span><span class="mord">2</span><span class="mord"><span class="mord mathdefault">n</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span></p><p>ç­‰é‡ä»£æ¢å¾—åˆ°ï¼š<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>n</mi><mn>0</mn></msub><mo>=</mo><msub><mi>n</mi><mn>2</mn></msub><mo>+</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">n_0 = n_2 + 1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">n</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.73333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">n</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span></p></blockquote><p>å¯¹äºæ¯ä¸€ä¸ªå¶å­èŠ‚ç‚¹ï¼Œéƒ½å­˜åœ¨åˆ°è¾¾æ ¹èŠ‚ç‚¹çš„å”¯ä¸€ä¸€æ¡ï¼ˆä¸é‡å¤ï¼‰è·¯å¾„ï¼Œè¿™ä¸€æ¡è·¯å¾„å°±å°†ç”¨æ¥ä¼°è®¡å¶èŠ‚ç‚¹æ‰€ä»£è¡¨å•è¯è¡¨è¾¾çš„æ¦‚ç‡ã€‚å›¾ä¸­çš„ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>n</mi><mo stretchy="false">(</mo><msub><mi>w</mi><mn>2</mn></msub><mo separator="true">,</mo><mi>j</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">n(w_2, j)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault">n</span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.05724em;">j</span><span class="mclose">)</span></span></span></span> è¡¨ç¤ºåˆ°è¾¾ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>w</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">w_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> å¶èŠ‚ç‚¹é€”å¾„çš„ç¬¬ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>j</mi></mrow><annotation encoding="application/x-tex">j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.85396em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.05724em;">j</span></span></span></span> ä¸ªèŠ‚ç‚¹ã€‚æ¯ä¸€ä¸ªä¸­é—´èŠ‚ç‚¹éƒ½å­˜åœ¨ç€ä¸€ä¸ªè¾“å‡ºå˜é‡ï¼š<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><msup><mi mathvariant="bold">v</mi><mo mathvariant="bold">â€²</mo></msup><mrow><mi>n</mi><mo stretchy="false">(</mo><mi>w</mi><mo separator="true">,</mo><mi>j</mi><mo stretchy="false">)</mo></mrow></msub></mrow><annotation encoding="application/x-tex">\mathbf{v&#x27;}_{n(w, j)}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.107092em;vertical-align:-0.3551999999999999em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathbf" style="margin-right:0.01597em;">v</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathbf mtight">â€²</span></span></span></span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.34480000000000005em;"><span style="top:-2.5198em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">n</span><span class="mopen mtight">(</span><span class="mord mathdefault mtight" style="margin-right:0.02691em;">w</span><span class="mpunct mtight">,</span><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.3551999999999999em;"><span></span></span></span></span></span></span></span></span></span></p><p>è®¡ç®—å•è¯ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>w</mi></mrow><annotation encoding="application/x-tex">w</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span></span></span></span> ä¸ºæœ¬æ¨¡å‹è¾“å‡ºå•è¯ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>w</mi><mi>O</mi></msub></mrow><annotation encoding="application/x-tex">w_O</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.02778em;">O</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> çš„æ¦‚ç‡ä¸ºï¼š<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>L</mi><mo stretchy="false">(</mo><mi>w</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">L(w)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault">L</span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="mclose">)</span></span></span></span> è¡¨ç¤ºè·¯å¾„é•¿åº¦ï¼Œ<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>c</mi><mi>h</mi><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">ch(n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault">c</span><span class="mord mathdefault">h</span><span class="mopen">(</span><span class="mord mathdefault">n</span><span class="mclose">)</span></span></span></span> è¡¨ç¤ºèŠ‚ç‚¹çš„å·¦å­©å­ï¼Œ<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo stretchy="false">[</mo><mtext>â€‰â£</mtext><mo stretchy="false">[</mo><mi>x</mi><mo stretchy="false">]</mo><mtext>â€‰â£</mtext><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">[\![x]\!]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mspace" style="margin-right:-0.16666666666666666em;"></span><span class="mopen">[</span><span class="mord mathdefault">x</span><span class="mclose">]</span><span class="mspace" style="margin-right:-0.16666666666666666em;"></span><span class="mclose">]</span></span></span></span> è¡¨ç¤ºå¦‚æœ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">x</span></span></span></span> ä¸ºçœŸï¼Œå…¶å€¼ä¸º 1ï¼Œå¦åˆ™ä¸º -1</p><ol><li>ä»æ ¹èŠ‚ç‚¹ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">n</span></span></span></span> å‡ºå‘ï¼Œæˆ‘ä»¬è¦æ ¹æ®å•è¯çš„éšå±‚è¡¨è¾¾ï¼Œè®¡ç®—ä¸‹ä¸€æ­¥çš„æ–¹å‘ï¼ˆå·¦ OR å³ï¼‰ï¼š</li></ol><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>p</mi><mo stretchy="false">(</mo><mi>n</mi><mo separator="true">,</mo><mi>l</mi><mi>e</mi><mi>f</mi><mi>t</mi><mo stretchy="false">)</mo><mo>=</mo><mi>Ïƒ</mi><mo stretchy="false">(</mo><msubsup><msup><mi>v</mi><mo mathvariant="normal">â€²</mo></msup><mi>n</mi><mi>T</mi></msubsup><mo>â‹…</mo><mi mathvariant="bold">h</mi><mo stretchy="false">)</mo><mspace linebreak="newline"></mspace><mi>p</mi><mo stretchy="false">(</mo><mi>n</mi><mo separator="true">,</mo><mi>r</mi><mi>i</mi><mi>g</mi><mi>h</mi><mi>t</mi><mo stretchy="false">)</mo><mo>=</mo><mn>1</mn><mo>âˆ’</mo><mi>p</mi><mo stretchy="false">(</mo><mi>n</mi><mo separator="true">,</mo><mi>l</mi><mi>e</mi><mi>f</mi><mi>t</mi><mo stretchy="false">)</mo><mo>=</mo><mi>Ïƒ</mi><mo stretchy="false">(</mo><mo>âˆ’</mo><msubsup><msup><mi>v</mi><mo mathvariant="normal">â€²</mo></msup><mi>n</mi><mi>T</mi></msubsup><mo>â‹…</mo><mi mathvariant="bold">h</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">p(n, left) = \sigma({v&#x27;}_n^T \cdot \mathbf{h}) \\p(n, right) = 1 - p(n, left) = \sigma(-{v&#x27;}_n^T \cdot \mathbf{h})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault">p</span><span class="mopen">(</span><span class="mord mathdefault">n</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="mord mathdefault">t</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.283123em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">Ïƒ</span><span class="mopen">(</span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.801892em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.033123em;"><span style="top:-2.4530000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">n</span></span></span><span style="top:-3.254792em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.13889em;">T</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">â‹…</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathbf">h</span></span><span class="mclose">)</span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault">p</span><span class="mopen">(</span><span class="mord mathdefault">n</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault">i</span><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="mord mathdefault">h</span><span class="mord mathdefault">t</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault">p</span><span class="mopen">(</span><span class="mord mathdefault">n</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="mord mathdefault">t</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.283123em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">Ïƒ</span><span class="mopen">(</span><span class="mord">âˆ’</span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.801892em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.033123em;"><span style="top:-2.4530000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">n</span></span></span><span style="top:-3.254792em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.13889em;">T</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">â‹…</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathbf">h</span></span><span class="mclose">)</span></span></span></span></span></p><p>â€‹åœ¨è¿™é‡Œå¦‚æœæ˜¯ CBOW æ¨¡å‹ï¼Œ<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="bold">h</mi><mo>=</mo><mfrac><mn>1</mn><mi>C</mi></mfrac><msubsup><mo>âˆ‘</mo><mrow><mi>c</mi><mo>=</mo><mn>1</mn></mrow><mi>C</mi></msubsup><msub><mi>v</mi><msub><mi>w</mi><mi>c</mi></msub></msub></mrow><annotation encoding="application/x-tex">\mathbf{h} = \frac{1}{C} \sum_{c=1}^{C} v_{w_c}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord"><span class="mord mathbf">h</span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.326231em;vertical-align:-0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.845108em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.07153em;">C</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:-0.0000050000000000050004em;">âˆ‘</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.981231em;"><span style="top:-2.40029em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">c</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.2029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.07153em;">C</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.29971000000000003em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139199999999997em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.16454285714285719em;"><span style="top:-2.357em;margin-left:-0.02691em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathdefault mtight">c</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2501em;"><span></span></span></span></span></span></span></span></span></span> ; å¦‚æœæ˜¯ skip-gram æ¨¡å‹ï¼Œ<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="bold">h</mi><mo>=</mo><msub><mi mathvariant="bold">v</mi><msub><mi>w</mi><mi>I</mi></msub></msub></mrow><annotation encoding="application/x-tex">\mathbf{h} = \mathbf{v}_{w_I}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord"><span class="mord mathbf">h</span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.694745em;vertical-align:-0.250305em;"></span><span class="mord"><span class="mord"><span class="mord mathbf" style="margin-right:0.01597em;">v</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139199999999997em;"><span style="top:-2.5500000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3567071428571427em;margin-left:-0.02691em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathdefault mtight" style="margin-right:0.07847em;">I</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.14329285714285717em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.250305em;"><span></span></span></span></span></span></span></span></span></span>, <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>Ïƒ</mi></mrow><annotation encoding="application/x-tex">\sigma</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">Ïƒ</span></span></span></span> è¡¨ç¤º sigmoid æ¿€æ´»å‡½æ•°ï¼Œè¿›è¡ŒäºŒåˆ†ç±»é€‰æ‹©</p><ol start="2"><li>å› æ­¤æˆ‘ä»¬ç”¨ä¹˜æ³•è¿æ¥è·¯å¾„ï¼Œå®šä¹‰å…¬å¼å¤„ç†ä¸‹ç¬¦å·é—®é¢˜å³å¯å¾—åˆ°ï¼š</li></ol><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>p</mi><mo stretchy="false">(</mo><mi>w</mi><mo>=</mo><msub><mi>w</mi><mi>O</mi></msub><mo stretchy="false">)</mo><mo>=</mo><munderover><mo>âˆ</mo><mrow><mi>j</mi><mo>=</mo><mn>1</mn></mrow><mrow><mi>L</mi><mo stretchy="false">(</mo><mi>w</mi><mo stretchy="false">)</mo><mo>âˆ’</mo><mn>1</mn></mrow></munderover><mi>Ïƒ</mi><mo stretchy="false">(</mo><mo stretchy="false">[</mo><mtext>â€‰â£</mtext><mo stretchy="false">[</mo><mi>n</mi><mo stretchy="false">(</mo><mi>w</mi><mo separator="true">,</mo><mi>j</mi><mo>+</mo><mn>1</mn><mo stretchy="false">)</mo><mo>=</mo><mi>c</mi><mi>h</mi><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">(</mo><mi>w</mi><mo separator="true">,</mo><mi>j</mi><mo stretchy="false">)</mo><mo stretchy="false">)</mo><mo stretchy="false">]</mo><mtext>â€‰â£</mtext><mo stretchy="false">]</mo><mo>â‹…</mo><msubsup><msup><mi>v</mi><mo mathvariant="normal">â€²</mo></msup><mrow><mi>n</mi><mo stretchy="false">(</mo><mi>w</mi><mo separator="true">,</mo><mi>j</mi><mo stretchy="false">)</mo></mrow><mi>T</mi></msubsup><mo>â‹…</mo><mi mathvariant="bold">h</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">p(w=w_O) = \prod_{j=1}^{L(w)-1} \sigma([\![n(w,j+1) = ch(n(w,j))]\!] \cdot {v&#x27;}_{n(w,j)}^T\cdot\mathbf{h})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault">p</span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.02778em;">O</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:3.3747820000000006em;vertical-align:-1.4137769999999998em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.9610050000000006em;"><span style="top:-1.872331em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.050005em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">âˆ</span></span></span><span style="top:-4.386005em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">L</span><span class="mopen mtight">(</span><span class="mord mathdefault mtight" style="margin-right:0.02691em;">w</span><span class="mclose mtight">)</span><span class="mbin mtight">âˆ’</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.4137769999999998em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">Ïƒ</span><span class="mopen">(</span><span class="mopen">[</span><span class="mspace" style="margin-right:-0.16666666666666666em;"></span><span class="mopen">[</span><span class="mord mathdefault">n</span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.05724em;">j</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault">c</span><span class="mord mathdefault">h</span><span class="mopen">(</span><span class="mord mathdefault">n</span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.05724em;">j</span><span class="mclose">)</span><span class="mclose">)</span><span class="mclose">]</span><span class="mspace" style="margin-right:-0.16666666666666666em;"></span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">â‹…</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.4551230000000002em;vertical-align:-0.422em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.801892em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0331230000000002em;"><span style="top:-2.453em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">n</span><span class="mopen mtight">(</span><span class="mord mathdefault mtight" style="margin-right:0.02691em;">w</span><span class="mpunct mtight">,</span><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span><span class="mclose mtight">)</span></span></span></span><span style="top:-3.254792em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.13889em;">T</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.422em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">â‹…</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathbf">h</span></span><span class="mclose">)</span></span></span></span></span></p><p>æ¥ä¸‹æ¥æˆ‘ä»¬ä»¥ One-word Context ä¸ºä¾‹æ¼”ç®—ä¸‹åå‘ä¼ æ’­ï¼Œä¸ºäº†ç®€åŒ–è¡¨è¾¾å¹¶ä¸”å‘ One-word Context ä¸­å®šä¹‰çš„å˜é‡è€ƒè™‘ï¼Œé‡‡ç”¨äº†ä»¥ä¸‹ç¼©å†™ï¼š</p><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo stretchy="false">[</mo><mtext>â€‰â£</mtext><mo stretchy="false">[</mo><mo>â‹…</mo><mo stretchy="false">]</mo><mtext>â€‰â£</mtext><mo stretchy="false">]</mo><mo>=</mo><mo stretchy="false">[</mo><mtext>â€‰â£</mtext><mo stretchy="false">[</mo><mi>n</mi><mo stretchy="false">(</mo><mi>w</mi><mo separator="true">,</mo><mi>j</mi><mo>+</mo><mn>1</mn><mo stretchy="false">)</mo><mo>:</mo><mo>=</mo><mi>c</mi><mi>h</mi><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">(</mo><mi>w</mi><mo separator="true">,</mo><mi>j</mi><mo stretchy="false">)</mo><mo stretchy="false">)</mo><mo stretchy="false">]</mo><mtext>â€‰â£</mtext><mo stretchy="false">]</mo><mspace linebreak="newline"></mspace><msubsup><mi>v</mi><mi>j</mi><mo mathvariant="normal">â€²</mo></msubsup><mo>:</mo><mo>=</mo><msub><msup><mi>v</mi><mo mathvariant="normal">â€²</mo></msup><mrow><mi>n</mi><mo stretchy="false">(</mo><mi>w</mi><mo separator="true">,</mo><mi>j</mi><mo stretchy="false">)</mo></mrow></msub></mrow><annotation encoding="application/x-tex">[\![\cdot]\!] = [\![n(w,j+1) := ch(n(w,j))]\!] \\v_j&#x27; := {v&#x27;}_{n(w,j)}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mspace" style="margin-right:-0.16666666666666666em;"></span><span class="mopen">[</span><span class="mord">â‹…</span><span class="mclose">]</span><span class="mspace" style="margin-right:-0.16666666666666666em;"></span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mspace" style="margin-right:-0.16666666666666666em;"></span><span class="mopen">[</span><span class="mord mathdefault">n</span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.05724em;">j</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">:</span></span><span class="base"><span class="strut" style="height:0.36687em;vertical-align:0em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault">c</span><span class="mord mathdefault">h</span><span class="mopen">(</span><span class="mord mathdefault">n</span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.05724em;">j</span><span class="mclose">)</span><span class="mclose">)</span><span class="mclose">]</span><span class="mspace" style="margin-right:-0.16666666666666666em;"></span><span class="mclose">]</span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:1.185em;vertical-align:-0.383108em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.801892em;"><span style="top:-2.4530000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span><span style="top:-3.1130000000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.383108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">:</span></span><span class="base"><span class="strut" style="height:0.36687em;vertical-align:0em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.157092em;vertical-align:-0.3551999999999999em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.801892em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.34480000000000005em;"><span style="top:-2.5198em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">n</span><span class="mopen mtight">(</span><span class="mord mathdefault mtight" style="margin-right:0.02691em;">w</span><span class="mpunct mtight">,</span><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.3551999999999999em;"><span></span></span></span></span></span></span></span></span></span></span></p><p>2.1 å¾—åˆ°æˆ‘ä»¬çš„æŸå¤±å‡½æ•°ï¼š</p><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>E</mi><mo>=</mo><mo>âˆ’</mo><mo><mi>l</mi><mi>o</mi><mi>g</mi></mo><mi>p</mi><mo stretchy="false">(</mo><mi>w</mi><mo>=</mo><msub><mi>w</mi><mi>O</mi></msub><mi mathvariant="normal">âˆ£</mi><msub><mi>w</mi><mi>I</mi></msub><mo stretchy="false">)</mo><mo>=</mo><mo>âˆ’</mo><munderover><mo>âˆ‘</mo><mrow><mi>j</mi><mo>=</mo><mn>1</mn></mrow><mrow><mi>L</mi><mo stretchy="false">(</mo><mi>w</mi><mo stretchy="false">)</mo><mo>âˆ’</mo><mn>1</mn></mrow></munderover><mo><mi>l</mi><mi>o</mi><mi>g</mi></mo><mi>Ïƒ</mi><mo stretchy="false">(</mo><mo stretchy="false">[</mo><mtext>â€‰â£</mtext><mo stretchy="false">[</mo><mo>â‹…</mo><mo stretchy="false">]</mo><mtext>â€‰â£</mtext><mo stretchy="false">]</mo><mo>â‹…</mo><msubsup><msup><mi>v</mi><mo mathvariant="normal">â€²</mo></msup><mi>j</mi><mi>T</mi></msubsup><mo>â‹…</mo><mi mathvariant="bold">h</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">E = -\mathop{log} p(w=w_O | w_I) = -\sum_{j=1}^{L(w)-1} \mathop{log} \sigma ([\![\cdot]\!] \cdot {v&#x27;}_{j}^T\cdot\mathbf{h})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.05764em;">E</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">âˆ’</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop"><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault">o</span><span class="mord mathdefault" style="margin-right:0.03588em;">g</span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">p</span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.02778em;">O</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord">âˆ£</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.07847em;">I</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:3.3747820000000006em;vertical-align:-1.4137769999999998em;"></span><span class="mord">âˆ’</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.9610050000000006em;"><span style="top:-1.872331em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.050005em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">âˆ‘</span></span></span><span style="top:-4.386005em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">L</span><span class="mopen mtight">(</span><span class="mord mathdefault mtight" style="margin-right:0.02691em;">w</span><span class="mclose mtight">)</span><span class="mbin mtight">âˆ’</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.4137769999999998em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop"><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault">o</span><span class="mord mathdefault" style="margin-right:0.03588em;">g</span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">Ïƒ</span><span class="mopen">(</span><span class="mopen">[</span><span class="mspace" style="margin-right:-0.16666666666666666em;"></span><span class="mopen">[</span><span class="mord">â‹…</span><span class="mclose">]</span><span class="mspace" style="margin-right:-0.16666666666666666em;"></span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">â‹…</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.416231em;vertical-align:-0.383108em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.801892em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.033123em;"><span style="top:-2.4530000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span style="top:-3.254792em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.13889em;">T</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.383108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">â‹…</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathbf">h</span></span><span class="mclose">)</span></span></span></span></span></p><p>2.2 ç„¶åå¯¹éšå±‚ä¸è¾“å‡ºå±‚ä¹‹é—´çš„æƒå€¼çŸ©é˜µè¿›è¡Œæ›´æ–°ï¼š</p><p><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>E</mi></mrow><annotation encoding="application/x-tex">E</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.05764em;">E</span></span></span></span> ä¸­çš„æ±‚å’Œä¸å¯æ€•ï¼Œé <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>j</mi></mrow><annotation encoding="application/x-tex">j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.85396em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.05724em;">j</span></span></span></span> çš„éƒ½çœ‹ä½œå¸¸æ•°ï¼šå…ˆæ¥å¯¹ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msubsup><mi mathvariant="bold">v</mi><mi>j</mi><mo mathvariant="normal">â€²</mo></msubsup><mi mathvariant="bold">h</mi></mrow><annotation encoding="application/x-tex">\mathbf{v}&#x27;_j\mathbf{h}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.146664em;vertical-align:-0.394772em;"></span><span class="mord"><span class="mord"><span class="mord mathbf" style="margin-right:0.01597em;">v</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-2.441336em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.394772em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathbf">h</span></span></span></span></span> æ±‚åå¯¼ï¼Œç„¶åå†å¯¹ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msubsup><mi mathvariant="bold">v</mi><mi>j</mi><mo mathvariant="normal">â€²</mo></msubsup></mrow><annotation encoding="application/x-tex">\mathbf{v}&#x27;_j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.146664em;vertical-align:-0.394772em;"></span><span class="mord"><span class="mord"><span class="mord mathbf" style="margin-right:0.01597em;">v</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-2.441336em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.394772em;"><span></span></span></span></span></span></span></span></span></span> æ±‚åå¯¼</p><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mfrac><mrow><mi mathvariant="normal">âˆ‚</mi><mi>E</mi></mrow><mrow><mi mathvariant="normal">âˆ‚</mi><mrow><msubsup><mi mathvariant="bold">v</mi><mi>j</mi><mo mathvariant="normal">â€²</mo></msubsup><mi mathvariant="bold">h</mi></mrow></mrow></mfrac><mo>=</mo><mo>âˆ’</mo><mo stretchy="false">[</mo><mo><mi>l</mi><mi>o</mi><mi>g</mi></mo><mi>Ïƒ</mi><mo stretchy="false">(</mo><mo stretchy="false">[</mo><mtext>â€‰â£</mtext><mo stretchy="false">[</mo><mo separator="true">â‹…</mo><mo stretchy="false">]</mo><mtext>â€‰â£</mtext><mo stretchy="false">]</mo><msubsup><mi mathvariant="bold">v</mi><mi>j</mi><mo mathvariant="normal">â€²</mo></msubsup><mi mathvariant="bold">h</mi><mo stretchy="false">)</mo><msup><mo stretchy="false">]</mo><mo mathvariant="normal">â€²</mo></msup><mo>=</mo><mo>âˆ’</mo><mfrac><mn>1</mn><mi>A</mi></mfrac><mo>â‹…</mo><msup><mi>A</mi><mo mathvariant="normal">â€²</mo></msup><mo>=</mo><mo>âˆ’</mo><mfrac><mn>1</mn><mi>A</mi></mfrac><mo>â‹…</mo><mi>A</mi><mo stretchy="false">(</mo><mn>1</mn><mo>âˆ’</mo><mi>A</mi><mo stretchy="false">)</mo><mo>â‹…</mo><mo stretchy="false">(</mo><mo stretchy="false">[</mo><mtext>â€‰â£</mtext><mo stretchy="false">[</mo><mo separator="true">â‹…</mo><mo stretchy="false">]</mo><mtext>â€‰â£</mtext><mo stretchy="false">]</mo><msubsup><mi mathvariant="bold">v</mi><mi>j</mi><mo mathvariant="normal">â€²</mo></msubsup><mi mathvariant="bold">h</mi><msup><mo stretchy="false">)</mo><mo mathvariant="normal">â€²</mo></msup><mspace linebreak="newline"></mspace><mo>=</mo><mo stretchy="false">(</mo><mi>A</mi><mo>âˆ’</mo><mn>1</mn><mo stretchy="false">)</mo><mo>â‹…</mo><mo stretchy="false">[</mo><mtext>â€‰â£</mtext><mo stretchy="false">[</mo><mo separator="true">â‹…</mo><mo stretchy="false">]</mo><mtext>â€‰â£</mtext><mo stretchy="false">]</mo><mo>=</mo><mrow><mo fence="true">(</mo><mi>Ïƒ</mi><mo stretchy="false">(</mo><mo stretchy="false">[</mo><mtext>â€‰â£</mtext><mo stretchy="false">[</mo><mo separator="true">â‹…</mo><mo stretchy="false">]</mo><mtext>â€‰â£</mtext><mo stretchy="false">]</mo><msubsup><mi mathvariant="bold">v</mi><mi>j</mi><mo mathvariant="normal">â€²</mo></msubsup><mi mathvariant="bold">h</mi><mo stretchy="false">)</mo><mo>âˆ’</mo><mn>1</mn><mo fence="true">)</mo></mrow><mo stretchy="false">[</mo><mtext>â€‰â£</mtext><mo stretchy="false">[</mo><mo separator="true">â‹…</mo><mo stretchy="false">]</mo><mtext>â€‰â£</mtext><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">\dfrac{\partial{E} }{\partial{\mathbf{v}&#x27;_j\mathbf{h} } } = - [\mathop{log} \sigma([\![Â·]\!]\mathbf{v}&#x27;_j\mathbf{h})]&#x27; = - \frac{1}{A} \cdot A&#x27; = - \frac{1}{A} \cdot A(1-A) \cdot ([\![Â·]\!]\mathbf{v}&#x27;_j\mathbf{h})&#x27; \\= (A-1) \cdot [\![Â·]\!] = \left(\sigma([\![Â·]\!]\mathbf{v}&#x27;_j\mathbf{h}) - 1\right) [\![Â·]\!]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:2.4704119999999996em;vertical-align:-1.0989719999999998em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.37144em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">âˆ‚</span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathbf" style="margin-right:0.01597em;">v</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.733692em;"><span style="top:-2.4231360000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span><span style="top:-3.0448000000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.4129719999999999em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathbf">h</span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">âˆ‚</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.05764em;">E</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.0989719999999998em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.185em;vertical-align:-0.383108em;"></span><span class="mord">âˆ’</span><span class="mopen">[</span><span class="mop"><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault">o</span><span class="mord mathdefault" style="margin-right:0.03588em;">g</span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">Ïƒ</span><span class="mopen">(</span><span class="mopen">[</span><span class="mspace" style="margin-right:-0.16666666666666666em;"></span><span class="mopen">[</span><span class="mpunct">â‹…</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mclose">]</span><span class="mspace" style="margin-right:-0.16666666666666666em;"></span><span class="mclose">]</span><span class="mord"><span class="mord"><span class="mord mathbf" style="margin-right:0.01597em;">v</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.801892em;"><span style="top:-2.4530000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span><span style="top:-3.1130000000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.383108em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathbf">h</span></span><span class="mclose">)</span><span class="mclose"><span class="mclose">]</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.801892em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.00744em;vertical-align:-0.686em;"></span><span class="mord">âˆ’</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.32144em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault">A</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">â‹…</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.801892em;vertical-align:0em;"></span><span class="mord"><span class="mord mathdefault">A</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.801892em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.00744em;vertical-align:-0.686em;"></span><span class="mord">âˆ’</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.32144em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault">A</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">â‹…</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault">A</span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault">A</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">â‹…</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.185em;vertical-align:-0.383108em;"></span><span class="mopen">(</span><span class="mopen">[</span><span class="mspace" style="margin-right:-0.16666666666666666em;"></span><span class="mopen">[</span><span class="mpunct">â‹…</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mclose">]</span><span class="mspace" style="margin-right:-0.16666666666666666em;"></span><span class="mclose">]</span><span class="mord"><span class="mord"><span class="mord mathbf" style="margin-right:0.01597em;">v</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.801892em;"><span style="top:-2.4530000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span><span style="top:-3.1130000000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.383108em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathbf">h</span></span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.801892em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:0.36687em;vertical-align:0em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathdefault">A</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">â‹…</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mspace" style="margin-right:-0.16666666666666666em;"></span><span class="mopen">[</span><span class="mpunct">â‹…</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mclose">]</span><span class="mspace" style="margin-right:-0.16666666666666666em;"></span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.233108em;vertical-align:-0.383108em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size1">(</span></span><span class="mord mathdefault" style="margin-right:0.03588em;">Ïƒ</span><span class="mopen">(</span><span class="mopen">[</span><span class="mspace" style="margin-right:-0.16666666666666666em;"></span><span class="mopen">[</span><span class="mpunct">â‹…</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mclose">]</span><span class="mspace" style="margin-right:-0.16666666666666666em;"></span><span class="mclose">]</span><span class="mord"><span class="mord"><span class="mord mathbf" style="margin-right:0.01597em;">v</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.801892em;"><span style="top:-2.4530000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span><span style="top:-3.1130000000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.383108em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathbf">h</span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord">1</span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size1">)</span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mopen">[</span><span class="mspace" style="margin-right:-0.16666666666666666em;"></span><span class="mopen">[</span><span class="mpunct">â‹…</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mclose">]</span><span class="mspace" style="margin-right:-0.16666666666666666em;"></span><span class="mclose">]</span></span></span></span></span></p><p>åŒ–ç®€ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo stretchy="false">[</mo><mtext>â€‰â£</mtext><mo stretchy="false">[</mo><mo separator="true">â‹…</mo><mo stretchy="false">]</mo><mtext>â€‰â£</mtext><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">[\![Â·]\!]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mspace" style="margin-right:-0.16666666666666666em;"></span><span class="mopen">[</span><span class="mpunct">â‹…</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mclose">]</span><span class="mspace" style="margin-right:-0.16666666666666666em;"></span><span class="mclose">]</span></span></span></span></p><p>å½“ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo stretchy="false">[</mo><mtext>â€‰â£</mtext><mo stretchy="false">[</mo><mo separator="true">â‹…</mo><mo stretchy="false">]</mo><mtext>â€‰â£</mtext><mo stretchy="false">]</mo><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">[\![Â·]\!] = 1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mspace" style="margin-right:-0.16666666666666666em;"></span><span class="mopen">[</span><span class="mpunct">â‹…</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mclose">]</span><span class="mspace" style="margin-right:-0.16666666666666666em;"></span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span> æ—¶ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mstyle displaystyle="true" scriptlevel="0"><mfrac><mrow><mi mathvariant="normal">âˆ‚</mi><mi>E</mi></mrow><mrow><mi mathvariant="normal">âˆ‚</mi><mrow><msubsup><mi mathvariant="bold">v</mi><mi>j</mi><mo mathvariant="normal">â€²</mo></msubsup><mi mathvariant="bold">h</mi></mrow></mrow></mfrac></mstyle><mo>=</mo><mi>Ïƒ</mi><mo stretchy="false">(</mo><msubsup><mi mathvariant="bold">v</mi><mi>j</mi><mo mathvariant="normal">â€²</mo></msubsup><mi mathvariant="bold">h</mi><mo stretchy="false">)</mo><mo>âˆ’</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">\dfrac{\partial{E} }{\partial{\mathbf{v}&#x27;_j\mathbf{h} } } = \sigma(\mathbf{v}&#x27;_j\mathbf{h}) - 1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:2.4704119999999996em;vertical-align:-1.0989719999999998em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.37144em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">âˆ‚</span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathbf" style="margin-right:0.01597em;">v</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.733692em;"><span style="top:-2.4231360000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span><span style="top:-3.0448000000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.4129719999999999em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathbf">h</span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">âˆ‚</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.05764em;">E</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.0989719999999998em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.146664em;vertical-align:-0.394772em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">Ïƒ</span><span class="mopen">(</span><span class="mord"><span class="mord"><span class="mord mathbf" style="margin-right:0.01597em;">v</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-2.441336em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.394772em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathbf">h</span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span> ï¼›</p><p>å½“ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo stretchy="false">[</mo><mtext>â€‰â£</mtext><mo stretchy="false">[</mo><mo separator="true">â‹…</mo><mo stretchy="false">]</mo><mtext>â€‰â£</mtext><mo stretchy="false">]</mo><mo>=</mo><mo>âˆ’</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">[\![Â·]\!] = -1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mspace" style="margin-right:-0.16666666666666666em;"></span><span class="mopen">[</span><span class="mpunct">â‹…</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mclose">]</span><span class="mspace" style="margin-right:-0.16666666666666666em;"></span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">âˆ’</span><span class="mord">1</span></span></span></span> æ—¶ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mstyle displaystyle="true" scriptlevel="0"><mfrac><mrow><mi mathvariant="normal">âˆ‚</mi><mi>E</mi></mrow><mrow><mi mathvariant="normal">âˆ‚</mi><mrow><msubsup><mi mathvariant="bold">v</mi><mi>j</mi><mo mathvariant="normal">â€²</mo></msubsup><mi mathvariant="bold">h</mi></mrow></mrow></mfrac></mstyle><mo>=</mo><mn>1</mn><mo>âˆ’</mo><mi>Ïƒ</mi><mo stretchy="false">(</mo><mo>âˆ’</mo><msubsup><mi mathvariant="bold">v</mi><mi>j</mi><mo mathvariant="normal">â€²</mo></msubsup><mi mathvariant="bold">h</mi><mo stretchy="false">)</mo><mo>=</mo><mi>Ïƒ</mi><mo stretchy="false">(</mo><msubsup><mi mathvariant="bold">v</mi><mi>j</mi><mo mathvariant="normal">â€²</mo></msubsup><mi mathvariant="bold">h</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\dfrac{\partial{E} }{\partial{\mathbf{v}&#x27;_j\mathbf{h} } } = 1 - \sigma(-\mathbf{v}&#x27;_j\mathbf{h}) = \sigma(\mathbf{v}&#x27;_j\mathbf{h})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:2.4704119999999996em;vertical-align:-1.0989719999999998em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.37144em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">âˆ‚</span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathbf" style="margin-right:0.01597em;">v</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.733692em;"><span style="top:-2.4231360000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span><span style="top:-3.0448000000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.4129719999999999em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathbf">h</span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">âˆ‚</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.05764em;">E</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.0989719999999998em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.146664em;vertical-align:-0.394772em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">Ïƒ</span><span class="mopen">(</span><span class="mord">âˆ’</span><span class="mord"><span class="mord"><span class="mord mathbf" style="margin-right:0.01597em;">v</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-2.441336em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.394772em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathbf">h</span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.146664em;vertical-align:-0.394772em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">Ïƒ</span><span class="mopen">(</span><span class="mord"><span class="mord"><span class="mord mathbf" style="margin-right:0.01597em;">v</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-2.441336em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.394772em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathbf">h</span></span><span class="mclose">)</span></span></span></span>ï¼›</p><p>è¿™æ—¶å€™å°±å’Œ $ y_j - t_j$ ç¢°ä¸Šäº†ï¼Œæˆ‘ä»¬å®šä¹‰æ­¤æ—¶çš„ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>t</mi><mi>j</mi></msub><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">t_j = 1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9011879999999999em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span> å½“ä¸”ä»…å½“ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo stretchy="false">[</mo><mtext>â€‰â£</mtext><mo stretchy="false">[</mo><mo separator="true">â‹…</mo><mo stretchy="false">]</mo><mtext>â€‰â£</mtext><mo stretchy="false">]</mo><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">[\![Â·]\!] = 1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mspace" style="margin-right:-0.16666666666666666em;"></span><span class="mopen">[</span><span class="mpunct">â‹…</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mclose">]</span><span class="mspace" style="margin-right:-0.16666666666666666em;"></span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span> æ—¶ï¼Œå¦åˆ™<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>t</mi><mi>j</mi></msub><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">t_j = 0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9011879999999999em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span></span></span></span></p><p>å› æ­¤å¯¹ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msubsup><mi mathvariant="bold">v</mi><mi>j</mi><mo mathvariant="normal">â€²</mo></msubsup><mi mathvariant="bold">h</mi></mrow><annotation encoding="application/x-tex">\mathbf{v}&#x27;_j\mathbf{h}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.146664em;vertical-align:-0.394772em;"></span><span class="mord"><span class="mord"><span class="mord mathbf" style="margin-right:0.01597em;">v</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-2.441336em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.394772em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathbf">h</span></span></span></span></span> æ±‚åå¯¼çš„ç»“æœå¦‚ä¸‹ï¼š</p><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mfrac><mrow><mi mathvariant="normal">âˆ‚</mi><mi>E</mi></mrow><mrow><mi mathvariant="normal">âˆ‚</mi><mrow><msubsup><mi mathvariant="bold">v</mi><mi>j</mi><mo mathvariant="normal">â€²</mo></msubsup><mi mathvariant="bold">h</mi></mrow></mrow></mfrac><mo>=</mo><mi>Ïƒ</mi><mo stretchy="false">(</mo><msubsup><mi mathvariant="bold">v</mi><mi>j</mi><mo mathvariant="normal">â€²</mo></msubsup><mi mathvariant="bold">h</mi><mo stretchy="false">)</mo><mo>âˆ’</mo><msub><mi>t</mi><mi>j</mi></msub></mrow><annotation encoding="application/x-tex">\dfrac{\partial{E} }{\partial{\mathbf{v}&#x27;_j\mathbf{h} } } = \sigma(\mathbf{v}&#x27;_j\mathbf{h}) - t_j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:2.4704119999999996em;vertical-align:-1.0989719999999998em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.37144em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">âˆ‚</span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathbf" style="margin-right:0.01597em;">v</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.733692em;"><span style="top:-2.4231360000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span><span style="top:-3.0448000000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.4129719999999999em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathbf">h</span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">âˆ‚</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.05764em;">E</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.0989719999999998em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.185em;vertical-align:-0.383108em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">Ïƒ</span><span class="mopen">(</span><span class="mord"><span class="mord"><span class="mord mathbf" style="margin-right:0.01597em;">v</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.801892em;"><span style="top:-2.4530000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span><span style="top:-3.1130000000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.383108em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathbf">h</span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.9011879999999999em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span></span></p><p>ç„¶åå¯¹ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msubsup><mi mathvariant="bold">v</mi><mi>j</mi><mo mathvariant="normal">â€²</mo></msubsup></mrow><annotation encoding="application/x-tex">\mathbf{v}&#x27;_j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.146664em;vertical-align:-0.394772em;"></span><span class="mord"><span class="mord"><span class="mord mathbf" style="margin-right:0.01597em;">v</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-2.441336em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.394772em;"><span></span></span></span></span></span></span></span></span></span> æ±‚åå¯¼ï¼Œè¿™ä¸ªå°±æ¯”è¾ƒç®€å•å•¦ï¼š</p><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mfrac><mrow><mi mathvariant="normal">âˆ‚</mi><mi>E</mi></mrow><mrow><mi mathvariant="normal">âˆ‚</mi><msubsup><mi mathvariant="bold">v</mi><mi>j</mi><mo mathvariant="normal">â€²</mo></msubsup></mrow></mfrac><mo>=</mo><mfrac><mrow><mi mathvariant="normal">âˆ‚</mi><mi>E</mi></mrow><mrow><mi mathvariant="normal">âˆ‚</mi><mrow><msubsup><mi mathvariant="bold">v</mi><mi>j</mi><mo mathvariant="normal">â€²</mo></msubsup><mi mathvariant="bold">h</mi></mrow></mrow></mfrac><mo>â‹…</mo><mfrac><mrow><mi mathvariant="normal">âˆ‚</mi><mrow><msubsup><mi mathvariant="bold">v</mi><mi>j</mi><mo mathvariant="normal">â€²</mo></msubsup><mi mathvariant="bold">h</mi></mrow></mrow><mrow><mi mathvariant="normal">âˆ‚</mi><msubsup><mi mathvariant="bold">v</mi><mi>j</mi><mo mathvariant="normal">â€²</mo></msubsup></mrow></mfrac><mo>=</mo><mrow><mo fence="true">(</mo><mi>Ïƒ</mi><mo stretchy="false">(</mo><msubsup><mi mathvariant="bold">v</mi><mi>j</mi><mo mathvariant="normal">â€²</mo></msubsup><mi mathvariant="bold">h</mi><mo stretchy="false">)</mo><mo>âˆ’</mo><msub><mi>t</mi><mi>j</mi></msub><mo fence="true">)</mo></mrow><mo>â‹…</mo><mi mathvariant="bold">h</mi></mrow><annotation encoding="application/x-tex">\dfrac{\partial{E} }{\partial{\mathbf{v}&#x27;_j} } = \dfrac{\partial{E} }{\partial{\mathbf{v}&#x27;_j\mathbf{h} } } \cdot \dfrac{\partial{\mathbf{v}&#x27;_j\mathbf{h} } }{\partial{\mathbf{v}&#x27;_j} } = \left(\sigma(\mathbf{v}&#x27;_j\mathbf{h}) - t_j\right) \cdot \mathbf{h}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:2.4704119999999996em;vertical-align:-1.0989719999999998em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.37144em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">âˆ‚</span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathbf" style="margin-right:0.01597em;">v</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.733692em;"><span style="top:-2.4231360000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span><span style="top:-3.0448000000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.4129719999999999em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">âˆ‚</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.05764em;">E</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.0989719999999998em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.4704119999999996em;vertical-align:-1.0989719999999998em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.37144em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">âˆ‚</span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathbf" style="margin-right:0.01597em;">v</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.733692em;"><span style="top:-2.4231360000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span><span style="top:-3.0448000000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.4129719999999999em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathbf">h</span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">âˆ‚</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.05764em;">E</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.0989719999999998em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">â‹…</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:2.635636em;vertical-align:-1.0989719999999998em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.536664em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">âˆ‚</span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathbf" style="margin-right:0.01597em;">v</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.733692em;"><span style="top:-2.4231360000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span><span style="top:-3.0448000000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.4129719999999999em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.7847720000000002em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">âˆ‚</span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathbf" style="margin-right:0.01597em;">v</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-2.441336em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.394772em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathbf">h</span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.0989719999999998em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.233108em;vertical-align:-0.383108em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size1">(</span></span><span class="mord mathdefault" style="margin-right:0.03588em;">Ïƒ</span><span class="mopen">(</span><span class="mord"><span class="mord"><span class="mord mathbf" style="margin-right:0.01597em;">v</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.801892em;"><span style="top:-2.4530000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span><span style="top:-3.1130000000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.383108em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathbf">h</span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size1">)</span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">â‹…</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord"><span class="mord mathbf">h</span></span></span></span></span></span></p><ol start="3"><li>æ›´æ–°éšå±‚ä¸è¾“å‡ºå±‚ä¹‹é—´çš„æƒå€¼çŸ©é˜µï¼š</li></ol><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msubsup><msup><mi>v</mi><mo mathvariant="normal">â€²</mo></msup><mi>j</mi><mrow><mo stretchy="false">(</mo><mi>n</mi><mi>e</mi><mi>w</mi><mo stretchy="false">)</mo></mrow></msubsup><mo>=</mo><msubsup><msup><mi>v</mi><mo mathvariant="normal">â€²</mo></msup><mi>j</mi><mrow><mo stretchy="false">(</mo><mi>o</mi><mi>l</mi><mi>d</mi><mo stretchy="false">)</mo></mrow></msubsup><mo>âˆ’</mo><mi>Î·</mi><mo>â‹…</mo><mrow><mo fence="true">(</mo><mi>Ïƒ</mi><mo stretchy="false">(</mo><msubsup><mi mathvariant="bold">v</mi><mi>j</mi><mo mathvariant="normal">â€²</mo></msubsup><mi mathvariant="bold">h</mi><mo stretchy="false">)</mo><mo>âˆ’</mo><msub><mi>t</mi><mi>j</mi></msub><mo fence="true">)</mo></mrow><mo>â‹…</mo><mi mathvariant="bold">h</mi></mrow><annotation encoding="application/x-tex">{v&#x27;}_{j}^{(new)} = {v&#x27;}_{j}^{(old)} - \eta \cdot \left(\sigma(\mathbf{v}&#x27;_j\mathbf{h}) - t_j\right) \cdot \mathbf{h}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.4629em;vertical-align:-0.383108em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.801892em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.079792em;"><span style="top:-2.4530000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span style="top:-3.254792em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathdefault mtight">n</span><span class="mord mathdefault mtight">e</span><span class="mord mathdefault mtight" style="margin-right:0.02691em;">w</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.383108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.4629em;vertical-align:-0.383108em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.801892em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.079792em;"><span style="top:-2.4530000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span style="top:-3.254792em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathdefault mtight">o</span><span class="mord mathdefault mtight" style="margin-right:0.01968em;">l</span><span class="mord mathdefault mtight">d</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.383108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.63889em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">Î·</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">â‹…</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.233108em;vertical-align:-0.383108em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size1">(</span></span><span class="mord mathdefault" style="margin-right:0.03588em;">Ïƒ</span><span class="mopen">(</span><span class="mord"><span class="mord"><span class="mord mathbf" style="margin-right:0.01597em;">v</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.801892em;"><span style="top:-2.4530000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span><span style="top:-3.1130000000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.383108em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathbf">h</span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size1">)</span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">â‹…</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord"><span class="mord mathbf">h</span></span></span></span></span></span></p><p>å¯¹æ¯”ä¸€ä¸‹ä¼˜åŒ–å‰ï¼Œå¯ä»¥çœ‹å‡ºä¼˜åŒ–å‰æˆ‘ä»¬è¦è®¡ç®— <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>V</mi></mrow><annotation encoding="application/x-tex">V</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.22222em;">V</span></span></span></span> æ¬¡ï¼Œè€Œé‡‡ç”¨äº† Hierarchical softmax æˆ‘ä»¬åªéœ€è¦è®¡ç®— <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>l</mi><mi>o</mi><msub><mi>g</mi><mn>2</mn></msub><mo stretchy="false">(</mo><mi>V</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">log_2(V)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault">o</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.22222em;">V</span><span class="mclose">)</span></span></span></span> æ¬¡ï¼Œå®é™…ä¸Šæ˜¯ $1, 2, \dots, L(w) -1 $ æ¬¡ï¼ˆä¸‹æ–¹ä¸ºä¼˜åŒ–å‰æ›´æ–°å…¬å¼ï¼‰</p><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msubsup><msup><mi>v</mi><mo mathvariant="normal">â€²</mo></msup><msub><mi>w</mi><mi>j</mi></msub><mrow><mo stretchy="false">(</mo><mi>n</mi><mi>e</mi><mi>w</mi><mo stretchy="false">)</mo></mrow></msubsup><mo>=</mo><msubsup><msup><mi>v</mi><mo mathvariant="normal">â€²</mo></msup><msub><mi>w</mi><mi>j</mi></msub><mrow><mo stretchy="false">(</mo><mi>o</mi><mi>l</mi><mi>d</mi><mo stretchy="false">)</mo></mrow></msubsup><mo>âˆ’</mo><mi>Î·</mi><mo>â‹…</mo><msub><mi>e</mi><mi>j</mi></msub><mo>â‹…</mo><mi mathvariant="bold">h</mi><mtext>Â Â </mtext><mo stretchy="false">(</mo><mo><mi>f</mi><mi>o</mi><mi>r</mi></mo><mtext>Â </mtext><mi>j</mi><mtext>Â </mtext><mo><mi>i</mi><mi>n</mi></mo><mtext>Â </mtext><mo stretchy="false">{</mo><mn>1</mn><mo separator="true">,</mo><mn>2</mn><mo separator="true">,</mo><mo>â€¦</mo><mo separator="true">,</mo><mi>V</mi><mo stretchy="false">}</mo><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">{v&#x27;}_{w_j}^{(new)} = {v&#x27;}_{w_j}^{(old)} - \eta \cdot e_j \cdot \mathbf{h} \ \ (\mathop{for}\ j\ \mathop{in}\ \{1, 2, \dots, V\})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.524112em;vertical-align:-0.44432em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.801892em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0797919999999999em;"><span style="top:-2.4530000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3280857142857143em;"><span style="top:-2.357em;margin-left:-0.02691em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2818857142857143em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.254792em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathdefault mtight">n</span><span class="mord mathdefault mtight">e</span><span class="mord mathdefault mtight" style="margin-right:0.02691em;">w</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.44432em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.524112em;vertical-align:-0.44432em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.801892em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0797919999999999em;"><span style="top:-2.4530000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3280857142857143em;"><span style="top:-2.357em;margin-left:-0.02691em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2818857142857143em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.254792em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathdefault mtight">o</span><span class="mord mathdefault mtight" style="margin-right:0.01968em;">l</span><span class="mord mathdefault mtight">d</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.44432em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.63889em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">Î·</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">â‹…</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.730558em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">â‹…</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathbf">h</span></span><span class="mspace">Â </span><span class="mspace">Â </span><span class="mopen">(</span><span class="mop"><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="mord mathdefault" style="margin-right:0.02778em;">or</span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mspace">Â </span><span class="mord mathdefault" style="margin-right:0.05724em;">j</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mspace">Â </span><span class="mop"><span class="mord mathdefault">in</span></span><span class="mspace">Â </span><span class="mopen">{</span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">2</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner">â€¦</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.22222em;">V</span><span class="mclose">}</span><span class="mclose">)</span></span></span></span></span></p><blockquote><p>å½“ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo stretchy="false">[</mo><mtext>â€‰â£</mtext><mo stretchy="false">[</mo><mo separator="true">â‹…</mo><mo stretchy="false">]</mo><mtext>â€‰â£</mtext><mo stretchy="false">]</mo><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">[\![Â·]\!] = 1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mspace" style="margin-right:-0.16666666666666666em;"></span><span class="mopen">[</span><span class="mpunct">â‹…</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mclose">]</span><span class="mspace" style="margin-right:-0.16666666666666666em;"></span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span> æ—¶ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>t</mi><mi>j</mi></msub><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">t_j = 1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9011879999999999em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span> è¡¨ç¤ºåº”è¯¥å‘å·¦èµ°ï¼Œè€Œ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>Ïƒ</mi><mo stretchy="false">(</mo><msubsup><mi mathvariant="bold">v</mi><mi>j</mi><mo mathvariant="normal">â€²</mo></msubsup><mi mathvariant="bold">h</mi><mo stretchy="false">)</mo><mo>=</mo><mi>p</mi><mo stretchy="false">(</mo><mi>n</mi><mo separator="true">,</mo><mi>l</mi><mi>e</mi><mi>f</mi><mi>t</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\sigma(\mathbf{v}&#x27;_j\mathbf{h}) = p(n, left)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.146664em;vertical-align:-0.394772em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">Ïƒ</span><span class="mopen">(</span><span class="mord"><span class="mord"><span class="mord mathbf" style="margin-right:0.01597em;">v</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-2.441336em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.394772em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathbf">h</span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault">p</span><span class="mopen">(</span><span class="mord mathdefault">n</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="mord mathdefault">t</span><span class="mclose">)</span></span></span></span> è¡¨ç¤ºå‘å·¦èµ°çš„æ¦‚ç‡ï¼Œå¦‚æœ $ p \rightarrow 1$ é‚£ä¹ˆå¯¹æƒé‡æ²¡æœ‰å¤ªå¤§æ›´æ–°ï¼Œåä¹‹ï¼Œåˆ™åº”æ ¹æ® <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="bold">h</mi><mo separator="true">,</mo><mi>Î·</mi></mrow><annotation encoding="application/x-tex">\mathbf{h}, \eta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathbf">h</span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">Î·</span></span></span></span> å¢å¤§æƒé‡ï¼Œä»¥å¢åŠ  <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>Ïƒ</mi><mo stretchy="false">(</mo><msubsup><mi mathvariant="bold">v</mi><mi>j</mi><mo mathvariant="normal">â€²</mo></msubsup><mi mathvariant="bold">h</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\sigma(\mathbf{v}&#x27;_j\mathbf{h})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.146664em;vertical-align:-0.394772em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">Ïƒ</span><span class="mopen">(</span><span class="mord"><span class="mord"><span class="mord mathbf" style="margin-right:0.01597em;">v</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-2.441336em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.394772em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathbf">h</span></span><span class="mclose">)</span></span></span></span> çš„å€¼</p><p>å½“ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo stretchy="false">[</mo><mtext>â€‰â£</mtext><mo stretchy="false">[</mo><mo separator="true">â‹…</mo><mo stretchy="false">]</mo><mtext>â€‰â£</mtext><mo stretchy="false">]</mo><mo>=</mo><mo>âˆ’</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">[\![Â·]\!] = -1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mspace" style="margin-right:-0.16666666666666666em;"></span><span class="mopen">[</span><span class="mpunct">â‹…</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mclose">]</span><span class="mspace" style="margin-right:-0.16666666666666666em;"></span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">âˆ’</span><span class="mord">1</span></span></span></span> æ—¶ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>t</mi><mi>j</mi></msub><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">t_j = 0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9011879999999999em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span></span></span></span> è¡¨ç¤ºåº”è¯¥å‘å³èµ°ï¼Œè€Œ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>Ïƒ</mi><mo stretchy="false">(</mo><msubsup><mi mathvariant="bold">v</mi><mi>j</mi><mo mathvariant="normal">â€²</mo></msubsup><mi mathvariant="bold">h</mi><mo stretchy="false">)</mo><mo>=</mo><mi>p</mi><mo stretchy="false">(</mo><mi>n</mi><mo separator="true">,</mo><mi>l</mi><mi>e</mi><mi>f</mi><mi>t</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\sigma(\mathbf{v}&#x27;_j\mathbf{h}) = p(n, left)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.146664em;vertical-align:-0.394772em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">Ïƒ</span><span class="mopen">(</span><span class="mord"><span class="mord"><span class="mord mathbf" style="margin-right:0.01597em;">v</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-2.441336em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.394772em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathbf">h</span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault">p</span><span class="mopen">(</span><span class="mord mathdefault">n</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="mord mathdefault">t</span><span class="mclose">)</span></span></span></span> è¡¨ç¤ºå‘å·¦èµ°çš„æ¦‚ç‡ï¼Œå¦‚æœ $ p \rightarrow 0$ é‚£ä¹ˆç¬¦åˆæ­£ç¡®æƒ…å†µï¼Œå¯¹æƒé‡æ²¡æœ‰å¤ªå¤§æ›´æ–°ï¼Œåä¹‹ï¼Œåˆ™åº”æ ¹æ® <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="bold">h</mi><mo separator="true">,</mo><mi>Î·</mi></mrow><annotation encoding="application/x-tex">\mathbf{h}, \eta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathbf">h</span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">Î·</span></span></span></span> å‡å°æƒé‡ï¼Œä»¥å‡å° <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>Ïƒ</mi><mo stretchy="false">(</mo><msubsup><mi mathvariant="bold">v</mi><mi>j</mi><mo mathvariant="normal">â€²</mo></msubsup><mi mathvariant="bold">h</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\sigma(\mathbf{v}&#x27;_j\mathbf{h})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.146664em;vertical-align:-0.394772em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">Ïƒ</span><span class="mopen">(</span><span class="mord"><span class="mord"><span class="mord mathbf" style="margin-right:0.01597em;">v</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-2.441336em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.394772em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathbf">h</span></span><span class="mclose">)</span></span></span></span> çš„å€¼</p></blockquote><ol start="4"><li>ç»§ç»­å‘åä¼ é€’ï¼Œè®¡ç®—å¯¹ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="bold">h</mi></mrow><annotation encoding="application/x-tex">\mathbf{h}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord"><span class="mord mathbf">h</span></span></span></span></span> çš„åå¯¼æ•°ï¼š</li></ol><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mfrac><mrow><mi mathvariant="normal">âˆ‚</mi><mi>E</mi></mrow><mrow><mi mathvariant="normal">âˆ‚</mi><mi mathvariant="bold">h</mi></mrow></mfrac><mo>=</mo><munderover><mo>âˆ‘</mo><mrow><mi>j</mi><mo>âˆ’</mo><mn>1</mn></mrow><mrow><mi>L</mi><mo stretchy="false">(</mo><mi>w</mi><mo stretchy="false">)</mo><mo>âˆ’</mo><mn>1</mn></mrow></munderover><mfrac><mrow><mi mathvariant="normal">âˆ‚</mi><mi>E</mi></mrow><mrow><mi mathvariant="normal">âˆ‚</mi><mrow><msubsup><mi mathvariant="bold">v</mi><mi>j</mi><mo mathvariant="normal">â€²</mo></msubsup><mi mathvariant="bold">h</mi></mrow></mrow></mfrac><mo>â‹…</mo><mfrac><mrow><mi mathvariant="normal">âˆ‚</mi><mrow><msubsup><mi mathvariant="bold">v</mi><mi>j</mi><mo mathvariant="normal">â€²</mo></msubsup><mi mathvariant="bold">h</mi></mrow></mrow><mrow><mi mathvariant="normal">âˆ‚</mi><mi mathvariant="bold">h</mi></mrow></mfrac><mo>=</mo><munderover><mo>âˆ‘</mo><mrow><mi>j</mi><mo>âˆ’</mo><mn>1</mn></mrow><mrow><mi>L</mi><mo stretchy="false">(</mo><mi>w</mi><mo stretchy="false">)</mo><mo>âˆ’</mo><mn>1</mn></mrow></munderover><mrow><mo fence="true">(</mo><mi>Ïƒ</mi><mo stretchy="false">(</mo><msubsup><mi mathvariant="bold">v</mi><mi>j</mi><mo mathvariant="normal">â€²</mo></msubsup><mi mathvariant="bold">h</mi><mo stretchy="false">)</mo><mo>âˆ’</mo><msub><mi>t</mi><mi>j</mi></msub><mo fence="true">)</mo></mrow><mo>â‹…</mo><msubsup><mi mathvariant="bold">v</mi><mi>j</mi><mo mathvariant="normal">â€²</mo></msubsup><mo>:</mo><mo>=</mo><mi>E</mi><mi>H</mi></mrow><annotation encoding="application/x-tex">\dfrac{\partial{E} }{\partial{\mathbf{h} } } = \sum_{j-1}^{L(w)-1}\dfrac{\partial{E} }{\partial{\mathbf{v}&#x27;_j\mathbf{h} } } \cdot \dfrac{\partial{\mathbf{v}&#x27;_j\mathbf{h} } }{\partial{\mathbf{h} } } = \sum_{j-1}^{L(w)-1}\left(\sigma(\mathbf{v}&#x27;_j\mathbf{h}) - t_j\right) \cdot \mathbf{v}&#x27;_j := EH</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:2.05744em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.37144em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">âˆ‚</span><span class="mord"><span class="mord"><span class="mord mathbf">h</span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">âˆ‚</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.05764em;">E</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:3.3747820000000006em;vertical-align:-1.4137769999999998em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.9610050000000006em;"><span style="top:-1.872331em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span><span class="mbin mtight">âˆ’</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.050005em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">âˆ‘</span></span></span><span style="top:-4.386005em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">L</span><span class="mopen mtight">(</span><span class="mord mathdefault mtight" style="margin-right:0.02691em;">w</span><span class="mclose mtight">)</span><span class="mbin mtight">âˆ’</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.4137769999999998em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.37144em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">âˆ‚</span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathbf" style="margin-right:0.01597em;">v</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.733692em;"><span style="top:-2.4231360000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span><span style="top:-3.0448000000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.4129719999999999em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathbf">h</span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">âˆ‚</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.05764em;">E</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.0989719999999998em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">â‹…</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:2.222664em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.536664em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">âˆ‚</span><span class="mord"><span class="mord"><span class="mord mathbf">h</span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.7847720000000002em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">âˆ‚</span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathbf" style="margin-right:0.01597em;">v</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-2.441336em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.394772em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathbf">h</span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:3.3747820000000006em;vertical-align:-1.4137769999999998em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.9610050000000006em;"><span style="top:-1.872331em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span><span class="mbin mtight">âˆ’</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.050005em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">âˆ‘</span></span></span><span style="top:-4.386005em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">L</span><span class="mopen mtight">(</span><span class="mord mathdefault mtight" style="margin-right:0.02691em;">w</span><span class="mclose mtight">)</span><span class="mbin mtight">âˆ’</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.4137769999999998em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size1">(</span></span><span class="mord mathdefault" style="margin-right:0.03588em;">Ïƒ</span><span class="mopen">(</span><span class="mord"><span class="mord"><span class="mord mathbf" style="margin-right:0.01597em;">v</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.801892em;"><span style="top:-2.4530000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span><span style="top:-3.1130000000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.383108em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathbf">h</span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size1">)</span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">â‹…</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.185em;vertical-align:-0.383108em;"></span><span class="mord"><span class="mord"><span class="mord mathbf" style="margin-right:0.01597em;">v</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.801892em;"><span style="top:-2.4530000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span><span style="top:-3.1130000000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.383108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">:</span></span><span class="base"><span class="strut" style="height:0.36687em;vertical-align:0em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.05764em;">E</span><span class="mord mathdefault" style="margin-right:0.08125em;">H</span></span></span></span></span></p><p>å¯¹æ¯”ä¸€ä¸‹ä¼˜åŒ–å‰çš„ï¼Œå¯ä»¥çœ‹å‡ºæ¥å¤§ä½“çš„ä¸€è‡´æ€§ï¼š</p><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mfrac><mrow><mi mathvariant="normal">âˆ‚</mi><mi>E</mi></mrow><mrow><mi mathvariant="normal">âˆ‚</mi><mi mathvariant="bold">h</mi></mrow></mfrac><mo>=</mo><munderover><mo>âˆ‘</mo><mrow><mi>j</mi><mo>=</mo><mn>1</mn></mrow><mi>V</mi></munderover><mfrac><mrow><mi mathvariant="normal">âˆ‚</mi><mi>E</mi></mrow><mrow><mi mathvariant="normal">âˆ‚</mi><msub><mi>u</mi><mi>j</mi></msub></mrow></mfrac><mo>â‹…</mo><mfrac><mrow><mi mathvariant="normal">âˆ‚</mi><msub><mi>u</mi><mi>j</mi></msub></mrow><mrow><mi mathvariant="normal">âˆ‚</mi><mi mathvariant="bold">h</mi></mrow></mfrac><mo>=</mo><munderover><mo>âˆ‘</mo><mrow><mi>j</mi><mo>=</mo><mn>1</mn></mrow><mi>V</mi></munderover><msub><mi>e</mi><mi>j</mi></msub><mo>â‹…</mo><msub><msup><mi>v</mi><mo mathvariant="normal">â€²</mo></msup><msub><mi>w</mi><mi>j</mi></msub></msub><mo>:</mo><mo>=</mo><mi>E</mi><mi>H</mi></mrow><annotation encoding="application/x-tex">\dfrac{\partial{E} }{\partial{\mathbf{h} } } = \sum_{j=1}^{V}\dfrac{\partial{E} }{\partial{u_j} } \cdot \dfrac{\partial{u_j} }{\partial{\mathbf{h} } }= \sum_{j=1}^{V}e_j \cdot {v&#x27;}_{w_j} := EH</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:2.05744em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.37144em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">âˆ‚</span><span class="mord"><span class="mord"><span class="mord mathbf">h</span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">âˆ‚</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.05764em;">E</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:3.2421130000000007em;vertical-align:-1.4137769999999998em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.8283360000000006em;"><span style="top:-1.872331em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.050005em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">âˆ‘</span></span></span><span style="top:-4.3000050000000005em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.22222em;">V</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.4137769999999998em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.37144em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">âˆ‚</span><span class="mord"><span class="mord"><span class="mord mathdefault">u</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">âˆ‚</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.05764em;">E</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.972108em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">â‹…</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:2.05744em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.37144em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">âˆ‚</span><span class="mord"><span class="mord"><span class="mord mathbf">h</span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">âˆ‚</span><span class="mord"><span class="mord"><span class="mord mathdefault">u</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:3.2421130000000007em;vertical-align:-1.4137769999999998em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.8283360000000006em;"><span style="top:-1.872331em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.050005em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">âˆ‘</span></span></span><span style="top:-4.3000050000000005em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.22222em;">V</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.4137769999999998em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">â‹…</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.149212em;vertical-align:-0.34731999999999996em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.801892em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3280857142857143em;"><span style="top:-2.357em;margin-left:-0.02691em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2818857142857143em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.34731999999999996em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">:</span></span><span class="base"><span class="strut" style="height:0.36687em;vertical-align:0em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.05764em;">E</span><span class="mord mathdefault" style="margin-right:0.08125em;">H</span></span></span></span></span></p><ol start="5"><li>åç»­çš„åº”å½“ä¸€è‡´äº†ï¼Œæœ‰æ—¶é—´è¡¥å……å®Œæ•´ï¼ˆç­‰ä¸‹æ¬¡å›é¡¾çš„æ—¶å€™å§â€¦.)</li></ol><h2 id="negative-sampling"><a class="markdownIt-Anchor" href="#negative-sampling"></a> Negative Sampling</h2><p>ä¸ºäº†è§£å†³å› è¯å…¸æ•°ç›®å¯¼è‡´çš„ç®—åŠ›é—®é¢˜ï¼Œæˆ‘ä»¬åªéœ€è¦å°†ç›®æ ‡è¯å…¸åšä¸€ä¸ªé‡‡æ ·ï¼Œå½“æˆæœ¬æ¬¡æ›´æ–°çš„è¯å…¸å³å¯ï¼Œé‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œæˆ‘ä»¬å¦‚ä½•é‡‡æ ·å‘¢ï¼Ÿé™¤äº†æ­£æ ·æœ¬éœ€è¦æ›´æ–°è¢«é‡‡æ ·åˆ°ä¹‹å¤–ï¼Œå…¶ä½™çš„å°±èƒ½éšä¾¿é‡‡å—ï¼Ÿå¹¶ä¸æ˜¯ã€‚Word2vec ä½¿ç”¨äº† <code>unigram distribution raised to the 3/4 powre</code> çš„é‡‡æ ·æ¨¡å‹ï¼Œå…·ä½“åœ¨è¿™é‡Œä¹Ÿæ²¡ä»‹ç»ã€‚</p><p>æˆ‘è§‰å¾—è´Ÿé‡‡æ ·è¿™é‡Œéœ€è¦é’»ç ”çš„æ˜¯å¦‚ä½•é‡‡æ ·ï¼Œé‡‡æ ·å®Œæˆåï¼Œåç»­çš„æ›´æ–°å°±ä¸å‰é¢åŸºæœ¬ä¸€è‡´äº†~</p><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>E</mi><mo>=</mo><mo>âˆ’</mo><mo><mi>l</mi><mi>o</mi><mi>g</mi></mo><mi>Ïƒ</mi><mo stretchy="false">(</mo><msubsup><msup><mi mathvariant="bold">v</mi><mo mathvariant="bold">â€²</mo></msup><msub><mi>w</mi><mi>O</mi></msub><mi>T</mi></msubsup><mi mathvariant="bold">h</mi><mo stretchy="false">)</mo><mo>âˆ’</mo><munder><mo>âˆ‘</mo><mrow><msub><mi>w</mi><mi>j</mi></msub><mo>âˆˆ</mo><msub><mi>W</mi><mrow><mi>n</mi><mi>e</mi><mi>g</mi></mrow></msub></mrow></munder><mo><mi>l</mi><mi>o</mi><mi>g</mi></mo><mi>Ïƒ</mi><mo stretchy="false">(</mo><mo>âˆ’</mo><msubsup><msup><mi mathvariant="bold">v</mi><mo mathvariant="bold">â€²</mo></msup><msub><mi>w</mi><mi>j</mi></msub><mi>T</mi></msubsup><mi mathvariant="bold">h</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">E = - \mathop{log} \sigma(\mathbf{v&#x27;}_{w_O}^T \mathbf{h}) - \sum_{w_j\in W_{neg} } \mathop{log} \sigma(-\mathbf{v&#x27;}_{w_j}^T \mathbf{h})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.05764em;">E</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.380428em;vertical-align:-0.347305em;"></span><span class="mord">âˆ’</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop"><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault">o</span><span class="mord mathdefault" style="margin-right:0.03588em;">g</span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">Ïƒ</span><span class="mopen">(</span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathbf" style="margin-right:0.01597em;">v</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.801892em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathbf mtight">â€²</span></span></span></span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.033123em;"><span style="top:-2.4530000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3567071428571427em;margin-left:-0.02691em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathdefault mtight" style="margin-right:0.02778em;">O</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.14329285714285717em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.254792em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.13889em;">T</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.347305em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathbf">h</span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:2.5416610000000004em;vertical-align:-1.491656em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.050005em;"><span style="top:-1.8556639999999998em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3280857142857143em;"><span style="top:-2.357em;margin-left:-0.02691em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2818857142857143em;"><span></span></span></span></span></span></span><span class="mrel mtight">âˆˆ</span><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.16454285714285716em;"><span style="top:-2.357em;margin-left:-0.13889em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">n</span><span class="mord mathdefault mtight">e</span><span class="mord mathdefault mtight" style="margin-right:0.03588em;">g</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2818857142857143em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.0500049999999996em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">âˆ‘</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.491656em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop"><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault">o</span><span class="mord mathdefault" style="margin-right:0.03588em;">g</span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">Ïƒ</span><span class="mopen">(</span><span class="mord">âˆ’</span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathbf" style="margin-right:0.01597em;">v</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.801892em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathbf mtight">â€²</span></span></span></span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0331229999999998em;"><span style="top:-2.4530000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3280857142857143em;"><span style="top:-2.357em;margin-left:-0.02691em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2818857142857143em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.254792em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.13889em;">T</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.44432em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathbf">h</span></span><span class="mclose">)</span></span></span></span></span></p><p>å¯ä»¥çœ‹å‡ºåç»­æƒå€¼çŸ©é˜µçš„æ›´æ–°å°†åªä¼šæ¶‰åŠåˆ° <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>w</mi><mi>j</mi></msub></mrow><annotation encoding="application/x-tex">w_j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.716668em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span> å‰å‘ä¼ æ’­æ‰€ç»çš„æƒå€¼å‘é‡ã€‚</p><h1 id="å®éªŒ"><a class="markdownIt-Anchor" href="#å®éªŒ"></a> å®éªŒ</h1><p>æ— </p><h1 id="ä¸è¶³"><a class="markdownIt-Anchor" href="#ä¸è¶³"></a> ä¸è¶³</h1><p>æ— </p>]]></content>
      
      
      <categories>
          
          <category> NLP </category>
          
      </categories>
      
      
        <tags>
            
            <tag> python </tag>
            
            <tag> DL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ„ŸçŸ¥æœºæ¨¡å‹</title>
      <link href="/Coming-blog/2021/07/09/gan-zhi-ji-mo-xing/"/>
      <url>/Coming-blog/2021/07/09/gan-zhi-ji-mo-xing/</url>
      
        <content type="html"><![CDATA[<p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20210709204458015.png" alt="image-20210709204458015" /></p><p>æœ¬æ–‡æ¥è‡ªäºä¹¦ç±ä»¥åŠè‡ªå·±çš„ä¸€äº›æƒ³æ³•ï¼Œå†…å®¹ä¸ä¸€å®šæ­£ç¡®ï¼Œè¿˜è¯·å¤§å®¶æ‰¹è¯„æŒ‡æ­£ã€‚</p><h1 id="å®šä¹‰"><a class="markdownIt-Anchor" href="#å®šä¹‰"></a> å®šä¹‰</h1><ul><li><p>åˆè¯†ï¼šäºŒç±»åˆ†ç±»çš„ç®€å•çº¿æ€§åˆ†ç±»æ¨¡å‹ï¼Œå±äºåˆ¤åˆ«æ¨¡å‹</p></li><li><p>è¾“å…¥ï¼š<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="script">X</mi><mo>âŠ†</mo><msup><mi mathvariant="bold">R</mi><mi>n</mi></msup></mrow><annotation encoding="application/x-tex">\mathcal{X} \subseteq \mathbf{R}^n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8193em;vertical-align:-0.13597em;"></span><span class="mord"><span class="mord mathcal" style="margin-right:0.14643em;">X</span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">âŠ†</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.68611em;vertical-align:0em;"></span><span class="mord"><span class="mord"><span class="mord mathbf">R</span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.664392em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">n</span></span></span></span></span></span></span></span></span></span></span></p><blockquote><p><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="script">X</mi></mrow><annotation encoding="application/x-tex">\mathcal{X}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord"><span class="mord mathcal" style="margin-right:0.14643em;">X</span></span></span></span></span> ä¸ºæ ·æœ¬ç©ºé—´æˆ–çŠ¶æ€ç©ºé—´ï¼Œ<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mi mathvariant="bold">R</mi><mi>n</mi></msup></mrow><annotation encoding="application/x-tex">\mathbf{R}^n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68611em;vertical-align:0em;"></span><span class="mord"><span class="mord"><span class="mord mathbf">R</span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.664392em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">n</span></span></span></span></span></span></span></span></span></span></span> ä¸º <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">n</span></span></span></span> ç»´å‘é‡ç©ºé—´ï¼ˆå®æ•°ç©ºé—´ï¼‰</p><p><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="script">X</mi><mo>=</mo><mo stretchy="false">{</mo><msub><mi>x</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>x</mi><mn>2</mn></msub><mo separator="true">,</mo><mo>â€¦</mo><mo separator="true">,</mo><msub><mi>x</mi><mi>n</mi></msub><mo stretchy="false">}</mo></mrow><annotation encoding="application/x-tex">\mathcal{X} = \{x_1, x_2, \dots, x_n\}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord"><span class="mord mathcal" style="margin-right:0.14643em;">X</span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">{</span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner">â€¦</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">n</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">}</span></span></span></span></p></blockquote></li><li><p>è¾“å‡ºï¼š<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="script">Y</mi><mo>âˆˆ</mo><mrow><mo fence="true">{</mo><mo>+</mo><mn>1</mn><mo separator="true">,</mo><mo>âˆ’</mo><mn>1</mn><mo fence="true">}</mo></mrow></mrow><annotation encoding="application/x-tex">\mathcal{Y} \in \left\{ +1, -1 \right\}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.78055em;vertical-align:-0.09722em;"></span><span class="mord"><span class="mord mathcal" style="margin-right:0.08222em;">Y</span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">âˆˆ</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;">{</span><span class="mord">+</span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">âˆ’</span><span class="mord">1</span><span class="mclose delimcenter" style="top:0em;">}</span></span></span></span></span></p><blockquote><p>è¾“å‡ºä¸ºå®ä¾‹çš„ç±»åˆ«</p></blockquote></li><li><p>ç›®æ ‡ï¼š<strong>å‡è®¾æ•°æ®é›†æ˜¯çº¿æ€§å¯åˆ†çš„</strong>ï¼Œå¯»æ‰¾ä¸€ä¸ªè¶…å¹³é¢ï¼Œå°†è®­ç»ƒæ•°æ®å…¨éƒ¨åˆ†ç±»æ­£ç¡®</p><blockquote><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20210709210455875.png" alt="image-20210709210455875" /></p></blockquote></li><li><p>æ‰©å±•ï¼šæ„ŸçŸ¥æœºå¯ä»¥ç§°ä¸ºå•å±‚çš„ç¥ç»ç½‘ç»œï¼Œè€Œå¤šå±‚çš„æ„ŸçŸ¥æœºåˆ™ç§°ä¸ºç¥ç»ç½‘ç»œï¼›æ˜¯ç¥ç»ç½‘ç»œä¸æ”¯æŒå‘é‡æœºçš„åŸºç¡€ã€‚</p></li></ul><h1 id="æ¨¡å‹"><a class="markdownIt-Anchor" href="#æ¨¡å‹"></a> æ¨¡å‹</h1><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>f</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mo>=</mo><mi>s</mi><mi>i</mi><mi>g</mi><mi>n</mi><mo stretchy="false">(</mo><mi>w</mi><mo>â‹…</mo><mi>x</mi><mo>+</mo><mi>b</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">f(x) = sign(w \cdot x + b)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault">s</span><span class="mord mathdefault">i</span><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="mord mathdefault">n</span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">â‹…</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.66666em;vertical-align:-0.08333em;"></span><span class="mord mathdefault">x</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault">b</span><span class="mclose">)</span></span></span></span></span></p><p>æ¨¡å‹çš„äº§ç”Ÿæ¥æºäºç›®æ ‡ï¼šå¯»æ‰¾ä¸€ä¸ªè¶…å¹³é¢ï¼Œå°†è®­ç»ƒæ•°æ®å…¨éƒ¨åˆ†ç±»æ­£ç¡®ï¼Œé’ˆå¯¹äºŒç»´çº¿æ€§å¯åˆ†æ•°æ®ï¼Œæˆ‘ä»¬å¯ä»¥å¯»æ‰¾åˆ° <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>A</mi><mi>x</mi><mo>+</mo><mi>B</mi><mi>y</mi><mo>+</mo><mi>C</mi><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">Ax+By+C=0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.76666em;vertical-align:-0.08333em;"></span><span class="mord mathdefault">A</span><span class="mord mathdefault">x</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.8777699999999999em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.05017em;">B</span><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.07153em;">C</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span></span></span></span> è¿™æ ·ä¸€ä¸ªå¹³é¢ï¼Œå°†æ•°æ®é›†å®Œå…¨åˆ†å¼€ã€‚è€Œ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>A</mi><mi>x</mi><mo>+</mo><mi>B</mi><mi>y</mi><mo>+</mo><mi>C</mi><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">Ax+By+C=0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.76666em;vertical-align:-0.08333em;"></span><span class="mord mathdefault">A</span><span class="mord mathdefault">x</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.8777699999999999em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.05017em;">B</span><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.07153em;">C</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span></span></span></span>  ä¸å°±æ˜¯ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>w</mi><mn>1</mn></msub><msub><mi>x</mi><mn>1</mn></msub><mo>+</mo><msub><mi>w</mi><mn>2</mn></msub><msub><mi>x</mi><mn>2</mn></msub><mo>+</mo><mi>b</mi><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">w_1x_1+w_2x_2+b=0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.73333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.73333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault">b</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span></span></span></span> å³ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>w</mi><mi>x</mi><mo>+</mo><mi>b</mi></mrow><annotation encoding="application/x-tex">wx+b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.66666em;vertical-align:-0.08333em;"></span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="mord mathdefault">x</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault">b</span></span></span></span> å—ï¼Œå› æ­¤æˆ‘ä»¬æˆåŠŸå°†äºŒç»´é—®é¢˜æ‰©å±•å¼€æ¥ã€‚</p><ul><li><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>w</mi></mrow><annotation encoding="application/x-tex">w</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span></span></span></span> ä¸ºæƒå€¼å‘é‡ï¼Œä¸ºæ¯ä¸€ç»´åº¦ç‰¹å¾å‘é‡åˆ†é…æƒé‡ (weight)</li><li><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>b</mi></mrow><annotation encoding="application/x-tex">b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault">b</span></span></span></span> ä¸ºåç½®ï¼Œæä¾›ä¸€ä¸ªå¹³ç§»å˜æ¢</li></ul><p>ç°åœ¨æˆ‘ä»¬èƒ½å¤Ÿä¾é  <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>w</mi><mi>x</mi><mo>+</mo><mi>b</mi><mo>&gt;</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">wx+b &gt; 0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.66666em;vertical-align:-0.08333em;"></span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="mord mathdefault">x</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.73354em;vertical-align:-0.0391em;"></span><span class="mord mathdefault">b</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span></span></span></span> æˆ–  <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>w</mi><mi>x</mi><mo>+</mo><mi>b</mi><mo>&lt;</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">wx+b &lt; 0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.66666em;vertical-align:-0.08333em;"></span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="mord mathdefault">x</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.73354em;vertical-align:-0.0391em;"></span><span class="mord mathdefault">b</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span></span></span></span> å°†æ•°æ®é›†ç®€å•åˆ†å‰²å¼€æ¥ï¼Œä¸ºäº†å®ç°åˆ†ç±»æ•ˆæœï¼Œå¼•å…¥äº†ç¬¦å·å‡½æ•° <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo><mi>s</mi><mi>i</mi><mi>g</mi><mi>n</mi></mo></mrow><annotation encoding="application/x-tex">\mathop{sign}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.85396em;vertical-align:-0.19444em;"></span><span class="mop"><span class="mord mathdefault">s</span><span class="mord mathdefault">i</span><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="mord mathdefault">n</span></span></span></span></span></p><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>s</mi><mi>i</mi><mi>g</mi><mi>n</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mo>=</mo><mrow><mo fence="true">{</mo><mtable rowspacing="0.3599999999999999em" columnalign="left left" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mtext>x&gt;0</mtext></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mtext>x&lt;=0</mtext></mstyle></mtd></mtr></mtable></mrow></mrow><annotation encoding="application/x-tex">sign(x)=\begin{cases}1&amp; \text{x&gt;0}\\0&amp; \text{x&lt;=0}\end{cases}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault">s</span><span class="mord mathdefault">i</span><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="mord mathdefault">n</span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:3.0000299999999998em;vertical-align:-1.25003em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size4">{</span></span><span class="mord"><span class="mtable"><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.69em;"><span style="top:-3.69em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord">1</span></span></span><span style="top:-2.25em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.19em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:1em;"></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.69em;"><span style="top:-3.69em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord text"><span class="mord">x&gt;0</span></span></span></span><span style="top:-2.25em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord text"><span class="mord">x&lt;=0</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.19em;"><span></span></span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p><p>åˆ°æ­¤ï¼Œæˆ‘ä»¬ä¾¿æ„é€ å‡ºäº†ä»¥ â€œå‡è®¾æ•°æ®é›†æ˜¯çº¿æ€§å¯åˆ†çš„ï¼Œå¯»æ‰¾ä¸€ä¸ªè¶…å¹³é¢ï¼Œå°†è®­ç»ƒæ•°æ®å…¨éƒ¨åˆ†ç±»æ­£ç¡®â€ è¿™ä¸€ç›®çš„ä¸ºå¯¼å‘çš„å‡è®¾ç©ºé—´ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œé’ˆå¯¹è¿™æ ·ä¸€ç±»æˆ‘ä»¬ï¼Œæ„ŸçŸ¥æœºæ¨¡å‹è®¤ä¸ºï¼Œè§£å†³è¿™ç±»é—®é¢˜çš„æœ€ä¼˜å‡½æ•°ä¸€å®šå­˜åœ¨ä¸å‡è®¾ç©ºé—´ä¹‹ä¸­ï¼Œä¹Ÿå°±æ˜¯å‡½æ•°é›†åˆ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo stretchy="false">{</mo><mi>f</mi><mi mathvariant="normal">âˆ£</mi><mi>f</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mo>=</mo><mi>w</mi><mo>â‹…</mo><mi>x</mi><mo>+</mo><mi>b</mi><mo stretchy="false">}</mo></mrow><annotation encoding="application/x-tex">\{f | f(x) = w \cdot x + b\}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">{</span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="mord">âˆ£</span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.44445em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">â‹…</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.66666em;vertical-align:-0.08333em;"></span><span class="mord mathdefault">x</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault">b</span><span class="mclose">}</span></span></span></span></p><h1 id="ç­–ç•¥"><a class="markdownIt-Anchor" href="#ç­–ç•¥"></a> ç­–ç•¥</h1><p>å†æ¬¡å›é¡¾ å‰æ ä¸ ç›®æ ‡ã€‚</p><ul><li>å‰æï¼šæ•°æ®é›†å…·æœ‰çº¿æ€§å¯åˆ†æ€§</li><li>ç›®æ ‡ï¼šæ±‚å¾—ä¸€ä¸ªèƒ½å°†è®­ç»ƒé›†æ­£å®ä¾‹ç‚¹å’Œè´Ÿå®ä¾‹ç‚¹å®Œå…¨æ­£ç¡®åˆ†å¼€çš„è¶…å¹³é¢</li></ul><p>é‚£ä¹ˆåº”è¯¥æ€ä¹ˆè¯„åˆ¤æˆ‘ä»¬é€‰æ‹©çš„æ¨¡å‹çš„å¥½åå‘¢ï¼Ÿ</p><ul><li>åˆå§‹çš„æ„Ÿè§‰æ˜¯ï¼šæ¨¡å‹è¯¯åˆ†ç±»ç‚¹çš„ä¸ªæ•°ï¼Œä½†æ˜¯è¿™æ ·çš„å‡½æ•°ç¦»æ•£ï¼Œå¹¶éå‚æ•° <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>w</mi><mo separator="true">,</mo><mi>b</mi></mrow><annotation encoding="application/x-tex">w,b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">b</span></span></span></span> çš„è¿ç»­å¯åˆ°å‡½æ•°ï¼Œä¸æ˜“ç”¨äºé€‰æ‹©å‚æ•° <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>w</mi><mo separator="true">,</mo><mi>b</mi></mrow><annotation encoding="application/x-tex">w,b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">b</span></span></span></span> ï¼Œæˆ–è€…è¯´æˆ‘ä»¬å¦‚ä½•è¯„åˆ¤åˆ†ç±»é”™è¯¯çš„ç‚¹å¯¹å‚æ•° <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>w</mi><mo separator="true">,</mo><mi>b</mi></mrow><annotation encoding="application/x-tex">w, b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">b</span></span></span></span> æ›´æ–°çš„æŒ‡å¯¼ç¨‹åº¦ï¼Ÿå‡å®š <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>M</mi></mrow><annotation encoding="application/x-tex">M</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.10903em;">M</span></span></span></span> ä¸ºè¯¯åˆ†ç±»ç‚¹çš„é›†åˆï¼Œé‚£æˆ‘ä»¬çš„ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>l</mi><mi>o</mi><mi>s</mi><mi>s</mi><mo>=</mo><munder><mo>âˆ‘</mo><mrow><msub><mi>x</mi><mi>i</mi></msub><mo>âˆˆ</mo><mi>M</mi></mrow></munder><mn>1</mn></mrow><annotation encoding="application/x-tex">loss = \sum\limits_{x_i\in M} 1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault">o</span><span class="mord mathdefault">s</span><span class="mord mathdefault">s</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.844441em;vertical-align:-1.094436em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.750005em;"><span style="top:-2.105664em;margin-left:0em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3280857142857143em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span><span class="mrel mtight">âˆˆ</span><span class="mord mathdefault mtight" style="margin-right:0.10903em;">M</span></span></span></span><span style="top:-3.0000050000000003em;"><span class="pstrut" style="height:3em;"></span><span><span class="mop op-symbol small-op">âˆ‘</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.094436em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">1</span></span></span></span>ï¼Œå¾ˆæ˜¾ç„¶è¿™æ ·çš„ç­–ç•¥æˆ–è€…æŸå¤±å‡½æ•°ï¼Œå¯¹å‚æ•° <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>w</mi><mo separator="true">,</mo><mi>b</mi></mrow><annotation encoding="application/x-tex">w, b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">b</span></span></span></span> æ›´æ–°æ²¡æœ‰æŒ‡å¯¼æ„ä¹‰ï¼Ÿ</li><li>åç»­æ€è€ƒï¼Œé‚£æˆ‘åº”è¯¥å°†å‚æ•° <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>w</mi><mo separator="true">,</mo><mi>b</mi></mrow><annotation encoding="application/x-tex">w, b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">b</span></span></span></span> ç”¨äºè®¡ç®— <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>l</mi><mi>o</mi><mi>s</mi><mi>s</mi></mrow><annotation encoding="application/x-tex">loss</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault">o</span><span class="mord mathdefault">s</span><span class="mord mathdefault">s</span></span></span></span>ï¼Œæ‰€ä»¥å¯èƒ½ä¼šæƒ³åˆ°ä½¿ç”¨è¯¯åˆ†ç±»ç‚¹åˆ°å¹³é¢çš„è·ç¦»ä½œä¸º loss function = <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mstyle displaystyle="true" scriptlevel="0"><mfrac><mn>1</mn><mrow><mi mathvariant="normal">âˆ£</mi><mi mathvariant="normal">âˆ£</mi><mi>w</mi><mi mathvariant="normal">âˆ£</mi><mi mathvariant="normal">âˆ£</mi></mrow></mfrac></mstyle><mi mathvariant="normal">âˆ£</mi><mi>w</mi><mo>â‹…</mo><msub><mi>x</mi><mn>0</mn></msub><mo>+</mo><mi>b</mi><mi mathvariant="normal">âˆ£</mi></mrow><annotation encoding="application/x-tex">\dfrac{1}{||w||}|w \cdot x_0 + b|</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:2.25744em;vertical-align:-0.936em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.32144em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">âˆ£</span><span class="mord">âˆ£</span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="mord">âˆ£</span><span class="mord">âˆ£</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.936em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mord">âˆ£</span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">â‹…</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.73333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault">b</span><span class="mord">âˆ£</span></span></span></span> ï¼Œè¿›ä¸€æ­¥ä¼˜åŒ–ä¸€ä¸‹å»æ‰ç»å¯¹å€¼ = <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo>âˆ’</mo><mstyle displaystyle="true" scriptlevel="0"><mfrac><msub><mi>y</mi><mi>i</mi></msub><mrow><mi mathvariant="normal">âˆ£</mi><mi mathvariant="normal">âˆ£</mi><mi>w</mi><mi mathvariant="normal">âˆ£</mi><mi mathvariant="normal">âˆ£</mi></mrow></mfrac></mstyle><mi mathvariant="normal">âˆ£</mi><mi>w</mi><mo>â‹…</mo><msub><mi>x</mi><mn>0</mn></msub><mo>+</mo><mi>b</mi><mi mathvariant="normal">âˆ£</mi></mrow><annotation encoding="application/x-tex">-\dfrac{y_i}{||w||}|w \cdot x_0 + b|</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:2.04356em;vertical-align:-0.936em;"></span><span class="mord">âˆ’</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.1075599999999999em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">âˆ£</span><span class="mord">âˆ£</span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="mord">âˆ£</span><span class="mord">âˆ£</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.936em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mord">âˆ£</span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">â‹…</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.73333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault">b</span><span class="mord">âˆ£</span></span></span></span> (æ³¨æ„è¿™æ˜¯é’ˆå¯¹è¯¯åˆ†ç±»ç‚¹æ¥è¯´çš„å—·)</li><li>ç»§ç»­ä¼˜åŒ– <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mstyle displaystyle="true" scriptlevel="0"><mfrac><mn>1</mn><mrow><mi mathvariant="normal">âˆ£</mi><mi mathvariant="normal">âˆ£</mi><mi>w</mi><mi mathvariant="normal">âˆ£</mi><mi mathvariant="normal">âˆ£</mi></mrow></mfrac></mstyle></mrow><annotation encoding="application/x-tex">\dfrac{1}{||w||}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:2.25744em;vertical-align:-0.936em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.32144em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">âˆ£</span><span class="mord">âˆ£</span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="mord">âˆ£</span><span class="mord">âˆ£</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.936em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span> å¯¹äºåç»­çš„æ¢¯åº¦ä¸‹é™æ±‚å¯¼æ¥è¯´è¾ƒä¸ºå¤æ‚ï¼Œé’ˆå¯¹ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>x</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">x_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> çš„å‡½æ•°ï¼Œ<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>w</mi><mo separator="true">,</mo><mi>b</mi></mrow><annotation encoding="application/x-tex">w, b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">b</span></span></span></span> åœ¨è¿›è¡Œ loss è®¡ç®—æ—¶å……å½“å¸¸æ•°ï¼Œå› æ­¤å¯å¦å°† <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mstyle displaystyle="true" scriptlevel="0"><mfrac><mn>1</mn><mrow><mi mathvariant="normal">âˆ£</mi><mi mathvariant="normal">âˆ£</mi><mi>w</mi><mi mathvariant="normal">âˆ£</mi><mi mathvariant="normal">âˆ£</mi></mrow></mfrac></mstyle></mrow><annotation encoding="application/x-tex">\dfrac{1}{||w||}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:2.25744em;vertical-align:-0.936em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.32144em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">âˆ£</span><span class="mord">âˆ£</span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="mord">âˆ£</span><span class="mord">âˆ£</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.936em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span> èˆå»å‘¢ï¼Ÿç­”æ¡ˆæ˜¯è‚¯å®šçš„<ol><li><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mstyle displaystyle="true" scriptlevel="0"><mfrac><mn>1</mn><mrow><mi mathvariant="normal">âˆ£</mi><mi mathvariant="normal">âˆ£</mi><mi>w</mi><mi mathvariant="normal">âˆ£</mi><mi mathvariant="normal">âˆ£</mi></mrow></mfrac></mstyle></mrow><annotation encoding="application/x-tex">\dfrac{1}{||w||}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:2.25744em;vertical-align:-0.936em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.32144em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">âˆ£</span><span class="mord">âˆ£</span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="mord">âˆ£</span><span class="mord">âˆ£</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.936em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span> åœ¨ loss function ä¸­å……å½“ç³»æ•°ï¼Œæ¶ˆé™¤åä»…ä»…ç¼©æ”¾çš„ç»“æœåŸŸï¼Œå°†å½“äº <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>3</mn><mi>x</mi><mo>+</mo><mn>6</mn><mi>y</mi><mo>+</mo><mn>9</mn><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">3x+6y+9=0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">3</span><span class="mord mathdefault">x</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.8388800000000001em;vertical-align:-0.19444em;"></span><span class="mord">6</span><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">9</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span></span></span></span> å˜ä¸º <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>x</mi><mo>+</mo><mn>2</mn><mi>y</mi><mo>+</mo><mn>3</mn><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">x+2y+3=0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.66666em;vertical-align:-0.08333em;"></span><span class="mord mathdefault">x</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.8388800000000001em;vertical-align:-0.19444em;"></span><span class="mord">2</span><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">3</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span></span></span></span>ï¼Œä½†æ˜¯æ¯ä¸ªè¯¯åˆ†ç±»ç‚¹å¯¹å‚æ•° <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>w</mi><mo separator="true">,</mo><mi>b</mi></mrow><annotation encoding="application/x-tex">w, b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">b</span></span></span></span> æ›´æ–°çš„æŒ‡å¯¼ç¨‹åº¦ç¡®å®æ˜¯é™ä½äº†ã€‚</li><li>è€Œæ„ŸçŸ¥æœºå­¦ä¹ ç®—æ³•æ˜¯è¯¯åˆ†ç±»é©±åŠ¨çš„, ç›®æ ‡æ˜¯åˆ†ç±»æ˜¯å¦å®Œå…¨æ­£ç¡®ã€‚å› æ­¤ï¼Œå­˜åœ¨ä¸€ä¸ªåˆ†ç±»ä¸æ­£ç¡®çš„ç‚¹éƒ½æ˜¯ä¸å…è®¸çš„ï¼Œä¸ç”¨çœ‹é‚£ä¸ªç‚¹äº§ç”Ÿå¤šå°‘ Loss å€¼ã€‚</li></ol></li><li>æœ€ç»ˆç¡®å®šäº†æŸå¤±å‡½æ•°ï¼š<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>L</mi><mo stretchy="false">(</mo><mi>w</mi><mo separator="true">,</mo><mi>b</mi><mo stretchy="false">)</mo><mo>=</mo><mo>âˆ’</mo><munder><mo>âˆ‘</mo><mrow><msub><mi>x</mi><mi>i</mi></msub><mo>âˆˆ</mo><mi>M</mi></mrow></munder><msub><mi>y</mi><mi>i</mi></msub><mo stretchy="false">(</mo><mi>w</mi><mo>â‹…</mo><msub><mi>x</mi><mi>i</mi></msub><mo>+</mo><mi>b</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">L(w, b) = -\sum\limits_{x_i\in M}y_i(w \cdot x_i + b)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault">L</span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">b</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.844441em;vertical-align:-1.094436em;"></span><span class="mord">âˆ’</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.750005em;"><span style="top:-2.105664em;margin-left:0em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3280857142857143em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span><span class="mrel mtight">âˆˆ</span><span class="mord mathdefault mtight" style="margin-right:0.10903em;">M</span></span></span></span><span style="top:-3.0000050000000003em;"><span class="pstrut" style="height:3em;"></span><span><span class="mop op-symbol small-op">âˆ‘</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.094436em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">â‹…</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.73333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault">b</span><span class="mclose">)</span></span></span></span></li></ul><h1 id="ç®—æ³•"><a class="markdownIt-Anchor" href="#ç®—æ³•"></a> ç®—æ³•</h1><p>é‡‡ç”¨æˆ‘ä»¬ç†ŸçŸ¥çš„æ¢¯åº¦ä¸‹é™æ³•ï¼Œè®¡ç®—æ¢¯åº¦ï¼Œæ›´æ–°å‚æ•°ã€‚</p><p>ç›®æ ‡æœ€å°åŒ– loss ç›´è‡³ 0ï¼Œå› æ­¤éœ€è¦å‘æ¢¯åº¦çš„è´Ÿæ–¹å‘æ›´æ–°å‚æ•°</p><p><strong>æ¢¯åº¦</strong>ï¼š</p><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mo>â–½</mo><mi>w</mi></msub><mi>L</mi><mo stretchy="false">(</mo><mi>w</mi><mo separator="true">,</mo><mi>b</mi><mo stretchy="false">)</mo><mo>=</mo><mo>âˆ’</mo><munder><mo>âˆ‘</mo><mrow><msub><mi>x</mi><mi>i</mi></msub><mo>âˆˆ</mo><mi>M</mi></mrow></munder><msub><mi>y</mi><mi>i</mi></msub><msub><mi>x</mi><mi>i</mi></msub><mspace linebreak="newline"></mspace><msub><mo>â–½</mo><mi>b</mi></msub><mi>L</mi><mo stretchy="false">(</mo><mi>w</mi><mo separator="true">,</mo><mi>b</mi><mo stretchy="false">)</mo><mo>=</mo><mo>âˆ’</mo><munder><mo>âˆ‘</mo><mrow><msub><mi>x</mi><mi>i</mi></msub><mo>âˆˆ</mo><mi>M</mi></mrow></munder><msub><mi>y</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">\bigtriangledown_{w}L(w,b)=-\sum\limits_{x_i \in M} y_ix_i \\\bigtriangledown_{b}L(w,b)=-\sum\limits_{x_i \in M} y_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mbin">â–½</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02691em;">w</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord mathdefault">L</span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">b</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.4444410000000003em;vertical-align:-1.394436em;"></span><span class="mord">âˆ’</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.050005em;"><span style="top:-1.855664em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3280857142857143em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span><span class="mrel mtight">âˆˆ</span><span class="mord mathdefault mtight" style="margin-right:0.10903em;">M</span></span></span></span><span style="top:-3.0500049999999996em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">âˆ‘</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.394436em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mbin"><span class="mbin">â–½</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">b</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault">L</span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">b</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.4444410000000003em;vertical-align:-1.394436em;"></span><span class="mord">âˆ’</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.050005em;"><span style="top:-1.855664em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3280857142857143em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span><span class="mrel mtight">âˆˆ</span><span class="mord mathdefault mtight" style="margin-right:0.10903em;">M</span></span></span></span><span style="top:-3.0500049999999996em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">âˆ‘</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.394436em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span></p><p><strong>é’ˆå¯¹è¯¯åˆ†ç±»ç‚¹ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi mathvariant="bold">x</mi><mi mathvariant="bold">i</mi></msub></mrow><annotation encoding="application/x-tex">\mathbf{x_i}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.59444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord"><span class="mord mathbf">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathbf mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span> æ‰§è¡Œæ›´æ–°</strong></p><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>w</mi><mo>â†</mo><mi>w</mi><mo>+</mo><mi>Î·</mi><msub><mi>y</mi><mi>i</mi></msub><msub><mi>x</mi><mi>i</mi></msub><mspace linebreak="newline"></mspace><mi>b</mi><mo>â†</mo><mi>b</mi><mo>+</mo><mi>Î·</mi><msub><mi>y</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">w \leftarrow w + \eta y_i x_i \\b \leftarrow b + \eta y_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">â†</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.66666em;vertical-align:-0.08333em;"></span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">Î·</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault">b</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">â†</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.77777em;vertical-align:-0.08333em;"></span><span class="mord mathdefault">b</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">Î·</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span></p><h1 id="æ„ŸçŸ¥æœºåŸå§‹å½¢å¼"><a class="markdownIt-Anchor" href="#æ„ŸçŸ¥æœºåŸå§‹å½¢å¼"></a> æ„ŸçŸ¥æœºåŸå§‹å½¢å¼</h1><p>æˆ‘ä»¬çš„ç­–ç•¥æ˜¯ç»éªŒé£é™©æœ€å°åŒ–ï¼š</p><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><munder><mo><mi>m</mi><mi>i</mi><mi>n</mi></mo><mrow><mi>w</mi><mo separator="true">,</mo><mi>b</mi></mrow></munder><mi>L</mi><mo stretchy="false">(</mo><mi>w</mi><mo separator="true">,</mo><mi>b</mi><mo stretchy="false">)</mo><mo>=</mo><mo>âˆ’</mo><munder><mo>âˆ‘</mo><mrow><msub><mi>x</mi><mi>i</mi></msub><mo>âˆˆ</mo><mi>M</mi></mrow></munder><msub><mi>y</mi><mi>i</mi></msub><mo stretchy="false">(</mo><mi>w</mi><mo>â‹…</mo><msub><mi>x</mi><mi>i</mi></msub><mo>+</mo><mi>b</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\mathop{min}\limits_{w,b}L(w,b) = -\sum\limits_{x_i\in M}y_i(w \cdot x_i + b)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.638216em;vertical-align:-0.8882159999999999em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.65952em;"><span style="top:-2.3478920000000003em;margin-left:0em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02691em;">w</span><span class="mpunct mtight">,</span><span class="mord mathdefault mtight">b</span></span></span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span><span class="mop"><span class="mord mathdefault">min</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.8882159999999999em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">L</span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">b</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.4444410000000003em;vertical-align:-1.394436em;"></span><span class="mord">âˆ’</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.050005em;"><span style="top:-1.855664em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3280857142857143em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span><span class="mrel mtight">âˆˆ</span><span class="mord mathdefault mtight" style="margin-right:0.10903em;">M</span></span></span></span><span style="top:-3.0500049999999996em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">âˆ‘</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.394436em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">â‹…</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.73333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault">b</span><span class="mclose">)</span></span></span></span></span></p><p>ç®—æ³•çš„åŸºæœ¬æµç¨‹å›¾å¦‚ä¸‹æ‰€ç¤ºï¼š</p><ol><li><p>åˆå§‹åŒ– <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>w</mi></mrow><annotation encoding="application/x-tex">w</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span></span></span></span> å’Œ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>b</mi></mrow><annotation encoding="application/x-tex">b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault">b</span></span></span></span> çš„å€¼</p></li><li><p>åœ¨è®­ç»ƒæ•°æ®é›†ä¸­é€‰å–æ•°æ® <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo stretchy="false">(</mo><mi>x</mi><mi>i</mi><mo separator="true">,</mo><mi>y</mi><mi>i</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(xi, yi)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mord mathdefault">i</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="mord mathdefault">i</span><span class="mclose">)</span></span></span></span></p></li><li><p>å¦‚æœ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>y</mi><mi>i</mi></msub><mo stretchy="false">(</mo><mi>w</mi><mo>â‹…</mo><msub><mi>x</mi><mi>i</mi></msub><mo>+</mo><mi>b</mi><mo stretchy="false">)</mo><mo>â‰¤</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">y_i(w\cdot x_i + b) \le 0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">â‹…</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.73333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault">b</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">â‰¤</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span></span></span></span></p><p>Tï¼šè¡¨ç¤ºè¯¥æ•°æ®è¯¯åˆ†ç±»ï¼Œé‡‡ç”¨æ¢¯åº¦ä¸‹é™æ³•è¿›è¡Œæ›´æ–°Fï¼šè¿›è¡Œæ­¥éª¤ 4</p></li><li><p>è·³è½¬è‡³æ­¥éª¤2ï¼Œç›´è‡³è®­ç»ƒé›†ä¸­æ²¡æœ‰è¯¯åˆ†ç±»ç‚¹</p></li></ol><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20210709220511277.png" alt="image-20210709220511277" style="zoom:50%;" /><h2 id="å‡½æ•°å®ç°"><a class="markdownIt-Anchor" href="#å‡½æ•°å®ç°"></a> å‡½æ•°å®ç°</h2><h3 id="é¢„å‡†å¤‡"><a class="markdownIt-Anchor" href="#é¢„å‡†å¤‡"></a> é¢„å‡†å¤‡</h3><p>é¦–å…ˆå¯ä»¥å®šä¹‰ä¸€ä¸ªå‡½æ•°ï¼Œæ„ŸçŸ¥æœºæ¨¡å‹æœ€ç»ˆå°±è¦æ‰¾åˆ°è¿™ä¸ªå‡½æ•°çš„è¡¨ç¤ºå½¢å¼</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">Fun</span><span class="token punctuation">(</span>x_1<span class="token punctuation">,</span> x_2<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token comment"># w = (3, -4)  b = 5</span>    y <span class="token operator">=</span> <span class="token number">3</span> <span class="token operator">*</span> x_1 <span class="token operator">-</span> <span class="token number">4</span> <span class="token operator">*</span> x_2 <span class="token operator">+</span> <span class="token number">5</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>è¿½åŠ ç¬¦å·å‡½æ•°</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">sign</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token comment"># ä»£å…¥ç‚¹è¿›å…¥å¦‚æœå€¼ä¸º0è¡¨ç¤ºåœ¨çº¿ä¸Šï¼Œå¦‚æœå€¼ > 0è¡¨ç¤ºåœ¨çº¿çš„ä¸€ä¾§ï¼Œå°äº 0 åœ¨å¦ä¸€ä¾§</span>    <span class="token keyword">return</span> <span class="token number">1</span> <span class="token keyword">if</span> Fun<span class="token punctuation">(</span><span class="token operator">*</span>x<span class="token punctuation">)</span> <span class="token operator">>=</span> <span class="token number">0</span> <span class="token keyword">else</span> <span class="token operator">-</span><span class="token number">1</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>ç”Ÿæˆæ•°æ®</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">size <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token comment"># (, 2) # åæ ‡é¢ç”Ÿæˆéšæœºç‚¹</span>X <span class="token operator">=</span> np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span>low <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">11</span><span class="token punctuation">,</span> high <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">,</span> size <span class="token operator">=</span> size<span class="token punctuation">)</span> y <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span>sign<span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token keyword">for</span> x <span class="token keyword">in</span> X<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment"># æŒ‰ç…§é¢„è®¾çº¿æ¡åˆ†ç‚¹</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>å¯è§†åŒ–å±•ç¤ºæœŸæœ›çš„æœ€ç»ˆæ•ˆæœ</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">showPerceptron</span><span class="token punctuation">(</span>X<span class="token punctuation">,</span> y<span class="token punctuation">,</span> w<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'w = '</span><span class="token punctuation">,</span> w<span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'b = '</span><span class="token punctuation">,</span> b<span class="token punctuation">)</span>    plt<span class="token punctuation">.</span>scatter<span class="token punctuation">(</span>X<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span>y <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> X<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span>y <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> color <span class="token operator">=</span> <span class="token string">'r'</span><span class="token punctuation">,</span> s<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">.</span><span class="token punctuation">)</span>    plt<span class="token punctuation">.</span>scatter<span class="token punctuation">(</span>X<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span>y <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> X<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span>y <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> color <span class="token operator">=</span> <span class="token string">'b'</span><span class="token punctuation">,</span> s<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">.</span><span class="token punctuation">)</span>    x_axis <span class="token operator">=</span> np<span class="token punctuation">.</span>linspace<span class="token punctuation">(</span>np<span class="token punctuation">.</span><span class="token builtin">min</span><span class="token punctuation">(</span>X<span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> np<span class="token punctuation">.</span><span class="token builtin">max</span><span class="token punctuation">(</span>X<span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">300</span><span class="token punctuation">)</span>    <span class="token comment"># ä¸€èˆ¬å¼è½¬åŒ–ä¸ºæ–œæˆªå¼</span>    y_axis <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">-</span>w<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">/</span>w<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">*</span> x <span class="token operator">-</span> b <span class="token operator">/</span> w<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token keyword">for</span> x <span class="token keyword">in</span> x_axis<span class="token punctuation">]</span>    plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>x_axis<span class="token punctuation">,</span> y_axis<span class="token punctuation">)</span>    plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20210709221404570.png" alt="image-20210709221404570" /></p><h3 id="å®ç°"><a class="markdownIt-Anchor" href="#å®ç°"></a> å®ç°</h3><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">Perceptron_1</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> learning_rate <span class="token operator">=</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        self<span class="token punctuation">.</span>w <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">.</span>        self<span class="token punctuation">.</span>b <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">.</span>        self<span class="token punctuation">.</span>learning_rate <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">.</span>        <span class="token keyword">def</span> <span class="token function">fun</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token comment"># ä¸€ä¸ªæ ·æœ¬</span>        <span class="token keyword">return</span> np<span class="token punctuation">.</span>dot<span class="token punctuation">(</span>x<span class="token punctuation">,</span> self<span class="token punctuation">.</span>w<span class="token punctuation">)</span> <span class="token operator">+</span> self<span class="token punctuation">.</span>b        <span class="token keyword">def</span> <span class="token function">train</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> X<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">:</span>        self<span class="token punctuation">.</span>w <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>X<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># çœŸæ­£åˆå§‹åŒ–æƒé‡å€¼</span>        flag <span class="token operator">=</span> <span class="token boolean">True</span> <span class="token comment"># è¡¨ç¤ºç»§ç»­å­¦ä¹ </span>        <span class="token keyword">while</span> flag<span class="token punctuation">:</span>            flag <span class="token operator">=</span> <span class="token boolean">False</span> <span class="token comment"># çŒœæµ‹æœ¬æ¬¡èƒ½å¤Ÿå­¦ä¹ å®Œæ¯•</span>            <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>X<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                x_i <span class="token operator">=</span> X<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token comment"># (2, )</span>                y_i <span class="token operator">=</span> y<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token comment"># (1, )</span>                <span class="token keyword">if</span><span class="token punctuation">(</span>y_i <span class="token operator">*</span> self<span class="token punctuation">.</span>fun<span class="token punctuation">(</span>x_i<span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                    self<span class="token punctuation">.</span>w <span class="token operator">+=</span> self<span class="token punctuation">.</span>learning_rate <span class="token operator">*</span> y_i <span class="token operator">*</span> x_i                    self<span class="token punctuation">.</span>b <span class="token operator">+=</span> self<span class="token punctuation">.</span>learning_rate <span class="token operator">*</span> y_i                    flag <span class="token operator">=</span> <span class="token boolean">True</span> <span class="token comment"># çŒœæµ‹å¤±è¯¯</span>        <span class="token comment"># å±•ç¤ºç»“æœ</span>        showPerceptron<span class="token punctuation">(</span>X<span class="token punctuation">,</span> y<span class="token punctuation">,</span> self<span class="token punctuation">.</span>w<span class="token punctuation">,</span> self<span class="token punctuation">.</span>b<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>æ•ˆæœå±•ç¤ºå¦‚ä¸‹</strong></p><pre class="line-numbers language-python" data-language="python"><code class="language-python">my_perceptron <span class="token operator">=</span> Perceptron_1<span class="token punctuation">(</span><span class="token punctuation">)</span>my_perceptron<span class="token punctuation">.</span>train<span class="token punctuation">(</span>X<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20210709221558656.png" alt="image-20210709221558656" /></p><h1 id="æ„ŸçŸ¥æœºå¯¹å¶å½¢å¼"><a class="markdownIt-Anchor" href="#æ„ŸçŸ¥æœºå¯¹å¶å½¢å¼"></a> æ„ŸçŸ¥æœºå¯¹å¶å½¢å¼</h1><p>ï¼ˆç¡®å®è¿˜æœªèƒ½ç†è§£æ¢å½¢å¼è¡¨è¾¾çš„çœŸæ­£åŸå› ï¼Œä»…ä»…è®°å½•äº›ä¹¦é¢çœ‹åˆ°çš„ä¿¡æ¯å•¦~ï¼‰</p><ul><li>åˆ›æ–°ç‚¹ï¼šå°† <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>w</mi></mrow><annotation encoding="application/x-tex">w</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span></span></span></span> å’Œ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>b</mi></mrow><annotation encoding="application/x-tex">b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault">b</span></span></span></span> è¡¨ç¤ºä¸ºå®ä¾‹ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>x</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">x_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> å’Œ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>y</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">y_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> çš„çº¿æ€§ç»„åˆçš„å½¢å¼ï¼Œé€šè¿‡æ±‚è§£å…¶ç³»æ•°è€Œæ±‚å¾— <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>w</mi></mrow><annotation encoding="application/x-tex">w</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span></span></span></span> å’Œ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>b</mi></mrow><annotation encoding="application/x-tex">b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault">b</span></span></span></span></li></ul><p>ä¾‹å¦‚ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>w</mi></mrow><annotation encoding="application/x-tex">w</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span></span></span></span> å’Œ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>b</mi></mrow><annotation encoding="application/x-tex">b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault">b</span></span></span></span> åˆå§‹å€¼ä¸º 0ï¼Œåœ¨ç¬¬æœ¬æ¬¡æ›´æ–°æ—¶çš„å–å€¼å¦‚ä¸‹ï¼š</p><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mtable rowspacing="0.24999999999999992em" columnalign="right left" columnspacing="0em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mi>w</mi></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><munderover><mo>âˆ‘</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>N</mi></munderover><msub><mi>Î±</mi><mi>i</mi></msub><msub><mi>y</mi><mi>i</mi></msub><msub><mi>x</mi><mi>i</mi></msub></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mi>b</mi></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><munderover><mo>âˆ‘</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>N</mi></munderover><msub><mi>Î±</mi><mi>i</mi></msub><msub><mi>y</mi><mi>i</mi></msub></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><msub><mi>Î±</mi><mi>i</mi></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><msub><mi>n</mi><mi>i</mi></msub><msub><mi>Î·</mi><mi>i</mi></msub></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{aligned}w &amp;= \sum_{i=1}^{N} \alpha_i y_i x_i \\b &amp;= \sum_{i=1}^{N} \alpha_i y_i \\\alpha_i &amp;= n_i \eta_i\end{aligned}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:8.31201em;vertical-align:-3.9060050000000004em;"></span><span class="mord"><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:4.406005em;"><span style="top:-6.406005em;"><span class="pstrut" style="height:3.828336em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span></span></span><span style="top:-3em;"><span class="pstrut" style="height:3.828336em;"></span><span class="mord"><span class="mord mathdefault">b</span></span></span><span style="top:-0.5823309999999999em;"><span class="pstrut" style="height:3.828336em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.0037em;">Î±</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.0037em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:3.9060050000000004em;"><span></span></span></span></span></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:4.406005em;"><span style="top:-6.406005em;"><span class="pstrut" style="height:3.828336em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.8283360000000002em;"><span style="top:-1.872331em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.050005em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">âˆ‘</span></span></span><span style="top:-4.3000050000000005em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.10903em;">N</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.277669em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.0037em;">Î±</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.0037em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-3em;"><span class="pstrut" style="height:3.828336em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.8283360000000002em;"><span style="top:-1.872331em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.050005em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">âˆ‘</span></span></span><span style="top:-4.3000050000000005em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.10903em;">N</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.277669em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.0037em;">Î±</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.0037em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-0.5823309999999999em;"><span class="pstrut" style="height:3.828336em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord"><span class="mord mathdefault">n</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">Î·</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:3.9060050000000004em;"><span></span></span></span></span></span></span></span></span></span></span></span></p><p>åœ¨è¿™è¦æ³¨æ„ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>N</mi></mrow><annotation encoding="application/x-tex">N</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.10903em;">N</span></span></span></span> è¡¨ç¤ºå®ä¾‹æ€»æ•°ï¼Œæˆ‘ä»¬æ›´æ–°çš„æ€»æ¬¡æ•°æœªçŸ¥ï¼ŒåªçŸ¥é“æˆªæ­¢ç›®å‰å„ä¸ªæ ·æœ¬ç‚¹ç”¨äºæ›´æ–°çš„æ¬¡æ•°ï¼Œå› æ­¤éå†æ ·æœ¬ï¼Œé€šè¿‡å½“å‰æ ·æœ¬ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>x</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">x_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> å¯¹å‚æ•°çš„æ›´æ–°è´¡çŒ®æ¬¡æ•°ï¼Œè®¡ç®—å‚æ•°çš„å€¼</p><p>ç®—æ³•çš„åŸºæœ¬æµç¨‹å›¾å¦‚ä¸‹æ‰€ç¤ºï¼š</p><ol><li><p>åˆå§‹åŒ– alpha å’Œ b çš„å€¼</p></li><li><p>åœ¨è®­ç»ƒæ•°æ®é›†ä¸­é€‰å–æ•°æ® <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo stretchy="false">(</mo><msub><mi>x</mi><mi>i</mi></msub><mo separator="true">,</mo><msub><mi>y</mi><mi>i</mi></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(x_i, y_i)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></p></li><li><p>å¦‚æœ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>y</mi><mi>i</mi></msub><mo stretchy="false">(</mo><msubsup><mo>âˆ‘</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>N</mi></msubsup><msub><mi>Î±</mi><mi>i</mi></msub><msub><mi>y</mi><mi>i</mi></msub><msub><mi>x</mi><mi>i</mi></msub><mo>â‹…</mo><msub><mi>x</mi><mi>i</mi></msub><mo>+</mo><mi>b</mi><mo stretchy="false">)</mo><mo>â‰¤</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">y_i(\sum_{i=1}^{N} \alpha_i y_i x_i\cdot x_i + b) \le 0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.2809409999999999em;vertical-align:-0.29971000000000003em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:-0.0000050000000000050004em;">âˆ‘</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.981231em;"><span style="top:-2.40029em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.2029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.10903em;">N</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.29971000000000003em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.0037em;">Î±</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.0037em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">â‹…</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.73333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault">b</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">â‰¤</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span></span></span></span></p><p>Tï¼šè¡¨ç¤ºè¯¥æ•°æ®è¯¯åˆ†ç±»ï¼Œé‡‡ç”¨æ¢¯åº¦ä¸‹é™æ³•è¿›è¡Œæ›´æ–°Fï¼šè¿›è¡Œæ­¥éª¤ 4</p></li><li><p>è·³è½¬è‡³æ­¥éª¤2ï¼Œç›´è‡³è®­ç»ƒé›†ä¸­æ²¡æœ‰è¯¯åˆ†ç±»ç‚¹</p></li></ol><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20210709223032341.png" alt="image-20210709223032341" style="zoom:50%;" /><h3 id="å‡½æ•°å®ç°-2"><a class="markdownIt-Anchor" href="#å‡½æ•°å®ç°-2"></a> å‡½æ•°å®ç°</h3><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">Perceptron_2</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> learning_rate<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        self<span class="token punctuation">.</span>alpha <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">.</span>        self<span class="token punctuation">.</span>b <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">.</span>        self<span class="token punctuation">.</span>learning_rate <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">.</span>        self<span class="token punctuation">.</span>gram <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">.</span>    <span class="token keyword">def</span> <span class="token function">get_w_b</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> X<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token triple-quoted-string string">"""             é‡‡ç”¨çŸ©é˜µè®¡ç®—çš„å½¢å¼æé«˜é€Ÿåº¦ï¼Œå¹¶ä¸”ç®€åŒ–è¿ç®—ï¼Œä¸å¿…å°è£…            length = len(self.alpha)            w, b = 0, 0            for i in range(length):                w += self.alpha[i] * y[i] * X[i]                b += self.alpha[i] * y[i]        """</span>        w <span class="token operator">=</span> np<span class="token punctuation">.</span>dot<span class="token punctuation">(</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>alpha <span class="token operator">*</span> y<span class="token punctuation">)</span><span class="token punctuation">.</span>T<span class="token punctuation">,</span> X<span class="token punctuation">)</span>        b <span class="token operator">=</span> np<span class="token punctuation">.</span>dot<span class="token punctuation">(</span>self<span class="token punctuation">.</span>alpha<span class="token punctuation">,</span> y<span class="token punctuation">.</span>T<span class="token punctuation">)</span>        <span class="token keyword">return</span> <span class="token punctuation">(</span>w<span class="token punctuation">,</span> b<span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">fun</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> X<span class="token punctuation">,</span> y<span class="token punctuation">,</span> aim_index<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token comment"># return np.dot(w, X[aim_index]) + b</span>        <span class="token comment"># alpha, y, xè½¬ä¸ºçŸ©é˜µè¿ç®—çš„å½¢å¼ï¼šalphaä¸yç›´æ¥å†…ç§¯è¿ç®—ï¼Œç„¶åä¸gramçŸ©é˜µå¯¹åº”ç›¸ä¹˜å¹¶ç›¸åŠ ï¼ˆçŸ©é˜µä¹˜æ³•ï¼‰</span>        <span class="token keyword">return</span> np<span class="token punctuation">.</span>dot<span class="token punctuation">(</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>alpha <span class="token operator">*</span> y<span class="token punctuation">)</span><span class="token punctuation">.</span>T<span class="token punctuation">,</span> self<span class="token punctuation">.</span>gram<span class="token punctuation">[</span>aim_index<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">+</span> np<span class="token punctuation">.</span>dot<span class="token punctuation">(</span>self<span class="token punctuation">.</span>alpha<span class="token punctuation">,</span> y<span class="token punctuation">.</span>T<span class="token punctuation">)</span>        <span class="token keyword">def</span> <span class="token function">train</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> X<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">:</span>        self<span class="token punctuation">.</span>alpha <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>X<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># è¡¨æ˜æ¯ä¸ªèŠ‚ç‚¹è¢«è¯¯åˆ†ç±»çš„æ¬¡æ•° * learning-rate</span>        self<span class="token punctuation">.</span>b <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">.</span>        self<span class="token punctuation">.</span>gram <span class="token operator">=</span> np<span class="token punctuation">.</span>dot<span class="token punctuation">(</span>X<span class="token punctuation">,</span> X<span class="token punctuation">.</span>T<span class="token punctuation">)</span> <span class="token comment"># å¿«é€Ÿçš„è¿ç®—</span>        flag <span class="token operator">=</span> <span class="token boolean">True</span>        <span class="token keyword">while</span> flag<span class="token punctuation">:</span>            flag <span class="token operator">=</span> <span class="token boolean">False</span>            <span class="token keyword">for</span> i<span class="token punctuation">,</span> data <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>X<span class="token punctuation">)</span><span class="token punctuation">:</span>                <span class="token keyword">if</span><span class="token punctuation">(</span>y<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">*</span> self<span class="token punctuation">.</span>fun<span class="token punctuation">(</span>X<span class="token punctuation">,</span> y<span class="token punctuation">,</span> i<span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                    self<span class="token punctuation">.</span>alpha<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">+=</span> self<span class="token punctuation">.</span>learning_rate                    self<span class="token punctuation">.</span>b <span class="token operator">+=</span> self<span class="token punctuation">.</span>learning_rate <span class="token operator">*</span> y<span class="token punctuation">[</span>i<span class="token punctuation">]</span>                    flag <span class="token operator">=</span> <span class="token boolean">True</span>        w<span class="token punctuation">,</span> b <span class="token operator">=</span> self<span class="token punctuation">.</span>get_w_b<span class="token punctuation">(</span>X<span class="token punctuation">,</span> y<span class="token punctuation">)</span>        showPerceptron<span class="token punctuation">(</span>X<span class="token punctuation">,</span> y<span class="token punctuation">,</span> w<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>æ•ˆæœå±•ç¤º</strong></p><pre class="line-numbers language-python" data-language="python"><code class="language-python">my_perceptron <span class="token operator">=</span> Perceptron_2<span class="token punctuation">(</span><span class="token punctuation">)</span>my_perceptron<span class="token punctuation">.</span>train<span class="token punctuation">(</span>X<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20210709223249283.png" alt="image-20210709223249283" /></p><p>ä¹¦ä¸Š P45 é¡µä¾‹å­çš„å±•ç¤º</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">X_1 <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span>    <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>y_1 <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>my_perceptron <span class="token operator">=</span> Perceptron_2<span class="token punctuation">(</span><span class="token punctuation">)</span>my_perceptron<span class="token punctuation">.</span>train<span class="token punctuation">(</span>X_1<span class="token punctuation">,</span> y_1<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20210709223338511.png" alt="image-20210709223338511" /></p><h1 id="é™„å½•"><a class="markdownIt-Anchor" href="#é™„å½•"></a> é™„å½•</h1><h2 id="ç‚¹åˆ°è¶…å¹³é¢çš„è·ç¦»"><a class="markdownIt-Anchor" href="#ç‚¹åˆ°è¶…å¹³é¢çš„è·ç¦»"></a> ç‚¹åˆ°è¶…å¹³é¢çš„è·ç¦»</h2><p>æ±‚ç‚¹ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>x</mi><mn>0</mn></msub></mrow><annotation encoding="application/x-tex">x_0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> åˆ°è¶…å¹³é¢ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>S</mi></mrow><annotation encoding="application/x-tex">S</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.05764em;">S</span></span></span></span>ï¼š<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>w</mi><mo separator="true">â‹…</mo><mi mathvariant="bold">x</mi><mo>+</mo><mi>b</mi><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">wÂ·\mathbf{x}+b=0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.66666em;vertical-align:-0.08333em;"></span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="mpunct">â‹…</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathbf">x</span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault">b</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span></span></span></span> çš„è·ç¦»</p><ol><li><p>è®¾ç‚¹ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi mathvariant="bold">x</mi><mn>0</mn></msub></mrow><annotation encoding="application/x-tex">\mathbf{x}_0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.59444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord"><span class="mord mathbf">x</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> åœ¨å¹³é¢ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>S</mi></mrow><annotation encoding="application/x-tex">S</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.05764em;">S</span></span></span></span> ä¸Šçš„æŠ•å½±ä¸º <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi mathvariant="bold">x</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">\mathbf{x}_1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.59444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord"><span class="mord mathbf">x</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>ï¼Œåˆ™<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>w</mi><mo>â‹…</mo><msub><mi mathvariant="bold">x</mi><mn>1</mn></msub><mo>+</mo><mi>b</mi><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">w\cdot \mathbf{x}_1+b=0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.44445em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">â‹…</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.73333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord"><span class="mord mathbf">x</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault">b</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span></span></span></span></p></li><li><p>å‘é‡ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mover accent="true"><mrow><msub><mi mathvariant="bold">x</mi><mn>0</mn></msub><msub><mi mathvariant="bold">x</mi><mn>1</mn></msub></mrow><mo stretchy="true">â†’</mo></mover></mrow><annotation encoding="application/x-tex">\overrightarrow{\mathbf{x}_0\mathbf{x}_1}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.1164399999999999em;vertical-align:-0.15em;"></span><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.96644em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathbf">x</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord"><span class="mord mathbf">x</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span class="svg-align" style="top:-3.44444em;"><span class="pstrut" style="height:3em;"></span><span class="hide-tail" style="height:0.522em;min-width:0.888em;"><svg width='400em' height='0.522em' viewBox='0 0 400000 522' preserveAspectRatio='xMaxYMin slice'><path d='M0 241v40h399891c-47.3 35.3-84 78-110 128-16.7 32-27.7 63.7-33 95 0 1.3-.2 2.7-.5 4-.3 1.3-.5 2.3-.5 3 0 7.3 6.7 11 20 11 8 0 13.2-.8 15.5-2.5 2.3-1.7 4.2-5.5 5.5-11.5 2-13.3 5.7-27 11-41 14.7-44.7 39-84.5 73-119.5s73.7-60.2 119-75.5c6-2 9-5.7 9-11s-3-9-9-11c-45.3-15.3-85-40.5-119-75.5s-58.3-74.8-73-119.5c-4.7-14-8.3-27.3-11-40-1.3-6.7-3.2-10.8-5.5-12.5-2.3-1.7-7.5-2.5-15.5-2.5-14 0-21 3.7-21 11 0 2 2 10.3 6 25 20.7 83.3 67 151.7 139 205zm0 0v40h399900v-40z'/></svg></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span> ä¸ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>S</mi></mrow><annotation encoding="application/x-tex">S</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.05764em;">S</span></span></span></span> çš„æ³•å‘é‡å¹³è¡Œï¼Œå¤¹è§’ä¸º 0</p></li><li><p>é€šè¿‡ 1 2 æ„é€ ç­‰å¼</p></li></ol><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="normal">âˆ£</mi><mi>w</mi><mo>â‹…</mo><mover accent="true"><mrow><msub><mi mathvariant="bold">x</mi><mn>0</mn></msub><msub><mi mathvariant="bold">x</mi><mn>1</mn></msub></mrow><mo stretchy="true">â†’</mo></mover><mi mathvariant="normal">âˆ£</mi><mo>=</mo><mi mathvariant="normal">âˆ£</mi><mi>w</mi><mi mathvariant="normal">âˆ£</mi><mo>Ã—</mo><mi mathvariant="normal">âˆ£</mi><mover accent="true"><mrow><msub><mi mathvariant="bold">x</mi><mn>0</mn></msub><msub><mi mathvariant="bold">x</mi><mn>1</mn></msub></mrow><mo stretchy="true">â†’</mo></mover><mi mathvariant="normal">âˆ£</mi><mi>c</mi><mi>o</mi><mi>s</mi><mo stretchy="false">(</mo><mn>0</mn><mo stretchy="false">)</mo><mo>=</mo><mi mathvariant="normal">âˆ£</mi><mi mathvariant="normal">âˆ£</mi><mi>w</mi><mi mathvariant="normal">âˆ£</mi><mi mathvariant="normal">âˆ£</mi><mo>Ã—</mo><mi>d</mi></mrow><annotation encoding="application/x-tex">|w \cdot \overrightarrow{\mathbf{x}_0\mathbf{x}_1} | = |w|\times|\overrightarrow{\mathbf{x}_0\mathbf{x}_1}|cos(0) = ||w|| \times d</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">âˆ£</span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">â‹…</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.21644em;vertical-align:-0.25em;"></span><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.96644em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathbf">x</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord"><span class="mord mathbf">x</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span class="svg-align" style="top:-3.44444em;"><span class="pstrut" style="height:3em;"></span><span class="hide-tail" style="height:0.522em;min-width:0.888em;"><svg width='400em' height='0.522em' viewBox='0 0 400000 522' preserveAspectRatio='xMaxYMin slice'><path d='M0 241v40h399891c-47.3 35.3-84 78-110 128-16.7 32-27.7 63.7-33 95 0 1.3-.2 2.7-.5 4-.3 1.3-.5 2.3-.5 3 0 7.3 6.7 11 20 11 8 0 13.2-.8 15.5-2.5 2.3-1.7 4.2-5.5 5.5-11.5 2-13.3 5.7-27 11-41 14.7-44.7 39-84.5 73-119.5s73.7-60.2 119-75.5c6-2 9-5.7 9-11s-3-9-9-11c-45.3-15.3-85-40.5-119-75.5s-58.3-74.8-73-119.5c-4.7-14-8.3-27.3-11-40-1.3-6.7-3.2-10.8-5.5-12.5-2.3-1.7-7.5-2.5-15.5-2.5-14 0-21 3.7-21 11 0 2 2 10.3 6 25 20.7 83.3 67 151.7 139 205zm0 0v40h399900v-40z'/></svg></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span><span class="mord">âˆ£</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">âˆ£</span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="mord">âˆ£</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">Ã—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.21644em;vertical-align:-0.25em;"></span><span class="mord">âˆ£</span><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.96644em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathbf">x</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord"><span class="mord mathbf">x</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span class="svg-align" style="top:-3.44444em;"><span class="pstrut" style="height:3em;"></span><span class="hide-tail" style="height:0.522em;min-width:0.888em;"><svg width='400em' height='0.522em' viewBox='0 0 400000 522' preserveAspectRatio='xMaxYMin slice'><path d='M0 241v40h399891c-47.3 35.3-84 78-110 128-16.7 32-27.7 63.7-33 95 0 1.3-.2 2.7-.5 4-.3 1.3-.5 2.3-.5 3 0 7.3 6.7 11 20 11 8 0 13.2-.8 15.5-2.5 2.3-1.7 4.2-5.5 5.5-11.5 2-13.3 5.7-27 11-41 14.7-44.7 39-84.5 73-119.5s73.7-60.2 119-75.5c6-2 9-5.7 9-11s-3-9-9-11c-45.3-15.3-85-40.5-119-75.5s-58.3-74.8-73-119.5c-4.7-14-8.3-27.3-11-40-1.3-6.7-3.2-10.8-5.5-12.5-2.3-1.7-7.5-2.5-15.5-2.5-14 0-21 3.7-21 11 0 2 2 10.3 6 25 20.7 83.3 67 151.7 139 205zm0 0v40h399900v-40z'/></svg></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span><span class="mord">âˆ£</span><span class="mord mathdefault">c</span><span class="mord mathdefault">o</span><span class="mord mathdefault">s</span><span class="mopen">(</span><span class="mord">0</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">âˆ£</span><span class="mord">âˆ£</span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="mord">âˆ£</span><span class="mord">âˆ£</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">Ã—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault">d</span></span></span></span></span></p><ol start="4"><li>å¦ä¸€æ–¹é¢</li></ol><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>w</mi><mo>â‹…</mo><mover accent="true"><mrow><msub><mi mathvariant="bold">x</mi><mn>0</mn></msub><msub><mi mathvariant="bold">x</mi><mn>1</mn></msub></mrow><mo stretchy="true">â†’</mo></mover><mo>=</mo><msup><mi>w</mi><mn>1</mn></msup><mo stretchy="false">(</mo><msubsup><mi>x</mi><mn>0</mn><mn>1</mn></msubsup><mo>âˆ’</mo><msubsup><mi>x</mi><mn>1</mn><mn>1</mn></msubsup><mo stretchy="false">)</mo><mo>+</mo><mo>â‹¯</mo><mo>+</mo><msup><mi>w</mi><mi>n</mi></msup><mo stretchy="false">(</mo><msubsup><mi>x</mi><mn>0</mn><mi>n</mi></msubsup><mo>âˆ’</mo><msubsup><mi>x</mi><mn>1</mn><mi>n</mi></msubsup><mo stretchy="false">)</mo><mo>=</mo><mi>w</mi><mo>â‹…</mo><msub><mi mathvariant="bold">x</mi><mn>0</mn></msub><mo>âˆ’</mo><mi>w</mi><mo>â‹…</mo><msub><mi mathvariant="bold">x</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">w \cdot \overrightarrow{\mathbf{x}_0\mathbf{x}_1} = w^1(x_0^1-x_1^1)+\dots+w^n(x_0^n-x_1^n)= w \cdot \mathbf{x}_0 - w \cdot \mathbf{x}_1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.44445em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">â‹…</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.1164399999999999em;vertical-align:-0.15em;"></span><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.96644em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathbf">x</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord"><span class="mord mathbf">x</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span class="svg-align" style="top:-3.44444em;"><span class="pstrut" style="height:3em;"></span><span class="hide-tail" style="height:0.522em;min-width:0.888em;"><svg width='400em' height='0.522em' viewBox='0 0 400000 522' preserveAspectRatio='xMaxYMin slice'><path d='M0 241v40h399891c-47.3 35.3-84 78-110 128-16.7 32-27.7 63.7-33 95 0 1.3-.2 2.7-.5 4-.3 1.3-.5 2.3-.5 3 0 7.3 6.7 11 20 11 8 0 13.2-.8 15.5-2.5 2.3-1.7 4.2-5.5 5.5-11.5 2-13.3 5.7-27 11-41 14.7-44.7 39-84.5 73-119.5s73.7-60.2 119-75.5c6-2 9-5.7 9-11s-3-9-9-11c-45.3-15.3-85-40.5-119-75.5s-58.3-74.8-73-119.5c-4.7-14-8.3-27.3-11-40-1.3-6.7-3.2-10.8-5.5-12.5-2.3-1.7-7.5-2.5-15.5-2.5-14 0-21 3.7-21 11 0 2 2 10.3 6 25 20.7 83.3 67 151.7 139 205zm0 0v40h399900v-40z'/></svg></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.1141079999999999em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8641079999999999em;"><span style="top:-2.4530000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.1141079999999999em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8641079999999999em;"><span style="top:-2.4530000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.66666em;vertical-align:-0.08333em;"></span><span class="minner">â‹¯</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7143919999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">n</span></span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7143919999999999em;"><span style="top:-2.4530000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">n</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7143919999999999em;"><span style="top:-2.4530000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">n</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.44445em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">â‹…</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.73333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord"><span class="mord mathbf">x</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.44445em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">â‹…</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.59444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord"><span class="mord mathbf">x</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span></p><p>ç”±ç¬¬ 1 ç‚¹å¯å¾— <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>w</mi><mo>â‹…</mo><msub><mi mathvariant="bold">x</mi><mn>1</mn></msub><mo>=</mo><mo>âˆ’</mo><mi>b</mi></mrow><annotation encoding="application/x-tex">w \cdot \mathbf{x}_1 = -b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.44445em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">â‹…</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.59444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord"><span class="mord mathbf">x</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.77777em;vertical-align:-0.08333em;"></span><span class="mord">âˆ’</span><span class="mord mathdefault">b</span></span></span></span> , å› æ­¤ï¼š</p><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>w</mi><mo>â‹…</mo><mover accent="true"><mrow><msub><mi mathvariant="bold">x</mi><mn>0</mn></msub><msub><mi mathvariant="bold">x</mi><mn>1</mn></msub></mrow><mo stretchy="true">â†’</mo></mover><mo>=</mo><mi>w</mi><mo>â‹…</mo><msub><mi mathvariant="bold">x</mi><mn>0</mn></msub><mo>+</mo><mi>b</mi></mrow><annotation encoding="application/x-tex">w \cdot \overrightarrow{\mathbf{x}_0\mathbf{x}_1} = w \cdot \mathbf{x}_0 + b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.44445em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">â‹…</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.1164399999999999em;vertical-align:-0.15em;"></span><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.96644em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathbf">x</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord"><span class="mord mathbf">x</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span class="svg-align" style="top:-3.44444em;"><span class="pstrut" style="height:3em;"></span><span class="hide-tail" style="height:0.522em;min-width:0.888em;"><svg width='400em' height='0.522em' viewBox='0 0 400000 522' preserveAspectRatio='xMaxYMin slice'><path d='M0 241v40h399891c-47.3 35.3-84 78-110 128-16.7 32-27.7 63.7-33 95 0 1.3-.2 2.7-.5 4-.3 1.3-.5 2.3-.5 3 0 7.3 6.7 11 20 11 8 0 13.2-.8 15.5-2.5 2.3-1.7 4.2-5.5 5.5-11.5 2-13.3 5.7-27 11-41 14.7-44.7 39-84.5 73-119.5s73.7-60.2 119-75.5c6-2 9-5.7 9-11s-3-9-9-11c-45.3-15.3-85-40.5-119-75.5s-58.3-74.8-73-119.5c-4.7-14-8.3-27.3-11-40-1.3-6.7-3.2-10.8-5.5-12.5-2.3-1.7-7.5-2.5-15.5-2.5-14 0-21 3.7-21 11 0 2 2 10.3 6 25 20.7 83.3 67 151.7 139 205zm0 0v40h399900v-40z'/></svg></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.44445em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">â‹…</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.73333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord"><span class="mord mathbf">x</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault">b</span></span></span></span></span></p><ol start="5"><li>æ‰€ä»¥è·ç¦» <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>d</mi></mrow><annotation encoding="application/x-tex">d</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault">d</span></span></span></span> ä¹Ÿå°±å› æ­¤å¾—å‡º</li></ol><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>d</mi><mo>=</mo><mfrac><mn>1</mn><mrow><mi mathvariant="normal">âˆ£</mi><mi mathvariant="normal">âˆ£</mi><mi>w</mi><mi mathvariant="normal">âˆ£</mi><mi mathvariant="normal">âˆ£</mi></mrow></mfrac><mi mathvariant="normal">âˆ£</mi><mi>w</mi><mo>â‹…</mo><msub><mi mathvariant="bold">x</mi><mn>0</mn></msub><mo>+</mo><mi>b</mi><mi mathvariant="normal">âˆ£</mi></mrow><annotation encoding="application/x-tex">d = \dfrac{1}{||w||}|w \cdot \mathbf{x}_0 + b|</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault">d</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.25744em;vertical-align:-0.936em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.32144em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">âˆ£</span><span class="mord">âˆ£</span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="mord">âˆ£</span><span class="mord">âˆ£</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.936em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mord">âˆ£</span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">â‹…</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.73333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord"><span class="mord mathbf">x</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault">b</span><span class="mord">âˆ£</span></span></span></span></span></p><hr /><p>Thanks !</p>]]></content>
      
      
      <categories>
          
          <category> ç»Ÿè®¡å­¦ä¹ æ–¹æ³• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ML </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hexoåšå®¢ä¸­ä½¿ç”¨Latexé…ç½®æ–¹æ³•</title>
      <link href="/Coming-blog/2021/07/07/hexo-bo-ke-zhong-shi-yong-latex-pei-zhi-fang-fa/"/>
      <url>/Coming-blog/2021/07/07/hexo-bo-ke-zhong-shi-yong-latex-pei-zhi-fang-fa/</url>
      
        <content type="html"><![CDATA[<p>æœ¬æ•™ç¨‹ä½¿ç”¨æ’ä»¶ <code>hexo-renderer-markdown-it-plus</code> å®Œæˆ Latex å…¬å¼æ¸²æŸ“</p><p>GitHub: <a target="_blank" rel="noopener" href="https://github.com/CHENXCHEN/hexo-renderer-markdown-it-plus">https://github.com/CHENXCHEN/hexo-renderer-markdown-it-plus</a></p><h1 id="1-æ¸…é™¤åŸæœ‰æ¸²æŸ“æ’ä»¶"><a class="markdownIt-Anchor" href="#1-æ¸…é™¤åŸæœ‰æ¸²æŸ“æ’ä»¶"></a> 1 æ¸…é™¤åŸæœ‰æ¸²æŸ“æ’ä»¶</h1><p>åœ¨åšå®¢æ ¹ç›®å½•ä¸‹ï¼Œå³é”®å•å‡»ï¼Œé€‰æ‹© <code>Git Bash Here</code> åä¾æ¬¡è¾“å…¥å‘½ä»¤</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">npm uninstall hexo-renderer-markednpm install hexo-renderer-kramed --save<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h1 id="2-å®‰è£…æŒ‡å®šæ’ä»¶"><a class="markdownIt-Anchor" href="#2-å®‰è£…æŒ‡å®šæ’ä»¶"></a> 2 å®‰è£…æŒ‡å®šæ’ä»¶</h1><p>åœ¨åšå®¢æ ¹ç›®å½•ä¸‹ï¼Œå³é”®å•å‡»ï¼Œé€‰æ‹© <code>Git Bash Here</code> åè¾“å…¥å‘½ä»¤</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">npm i -S hexo-renderer-markdown-it-plus<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h1 id="3-ä¿®æ”¹é…ç½®æ–‡ä»¶"><a class="markdownIt-Anchor" href="#3-ä¿®æ”¹é…ç½®æ–‡ä»¶"></a> 3 ä¿®æ”¹é…ç½®æ–‡ä»¶</h1><ol><li>åœ¨åšå®¢æ ¹ç›®å½•ä¸‹ï¼Œç¼–è¾‘ <code>_config.yml</code> åœ¨åº•éƒ¨æ·»åŠ å¦‚ä¸‹é…ç½®ä¿¡æ¯</li></ol><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">markdown_it_plus</span><span class="token punctuation">:</span>  <span class="token key atrule">highlight</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>  <span class="token key atrule">html</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>  <span class="token key atrule">xhtmlOut</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>  <span class="token key atrule">breaks</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>  <span class="token key atrule">langPrefix</span><span class="token punctuation">:</span>  <span class="token key atrule">linkify</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>  <span class="token key atrule">typographer</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>  <span class="token key atrule">quotes</span><span class="token punctuation">:</span>  <span class="token key atrule">plugins</span><span class="token punctuation">:</span>    <span class="token punctuation">-</span> <span class="token key atrule">plugin</span><span class="token punctuation">:</span>        <span class="token key atrule">name</span><span class="token punctuation">:</span> markdown<span class="token punctuation">-</span>it<span class="token punctuation">-</span>mark        <span class="token key atrule">enable</span><span class="token punctuation">:</span> <span class="token boolean important">false</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="2"><li>åœ¨ä½¿ç”¨çš„ä¸»é¢˜æ–‡ä»¶æ ¹ç›®å½•ä¸‹ï¼Œç¼–è¾‘ <code>_config.yml</code> åœ¨ <code>&lt;head&gt;</code> æ ‡ç­¾åº•éƒ¨æ·»åŠ å¦‚ä¸‹å¼•å…¥ä¿¡æ¯</li></ol><pre class="line-numbers language-ejs" data-language="ejs"><code class="language-ejs"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>    ...    ...    <span class="token ejs language-ejs"><span class="token delimiter punctuation">&lt;%</span><span class="token language-javascript"> <span class="token keyword">if</span> <span class="token punctuation">(</span>page<span class="token punctuation">.</span>mathjax<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> </span><span class="token delimiter punctuation">%></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>stylesheet<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.css<span class="token punctuation">"</span></span> <span class="token attr-name">integrity</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>sha384-zB1R0rpPzHqg7Kpt0Aljp8JPLqbXI3bhnPWROx27a9N0Ll6ZP/+DiW/UqRcLbRjq<span class="token punctuation">"</span></span> <span class="token attr-name">crossorigin</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>anonymous<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">defer</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.js<span class="token punctuation">"</span></span> <span class="token attr-name">integrity</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>sha384-y23I5Q6l+B6vatafAwxRu/0oK/79VlbSz7Q9aiSZUvyWYIYsd+qj+o24G5ZU2zJz<span class="token punctuation">"</span></span> <span class="token attr-name">crossorigin</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>anonymous<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>    <span class="token ejs language-ejs"><span class="token delimiter punctuation">&lt;%</span><span class="token language-javascript"> <span class="token punctuation">&#125;</span> </span><span class="token delimiter punctuation">%></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="4-æŒ‡å®šæ¸²æŸ“åšæ–‡"><a class="markdownIt-Anchor" href="#4-æŒ‡å®šæ¸²æŸ“åšæ–‡"></a> 4 æŒ‡å®šæ¸²æŸ“åšæ–‡</h1><p>ä¸ºäº†é¿å…æ— å…¬å¼åšæ–‡å¼•å…¥æ¸²æŸ“æ–‡ä»¶çš„æ€§èƒ½æµªè´¹ï¼Œå› æ­¤æ‰§è¡Œäº†é€‰æ‹©æ€§å¼•å…¥</p><p>åœ¨åç»­ä¹¦å†™åšæ–‡æ—¶ï¼Œåœ¨å¼€å¤´åšæ–‡å±æ€§æ æ·»åŠ å¦‚ä¸‹å±æ€§ï¼Œå·²å†³å®šæœ¬æ–‡æ˜¯å¦åŠ è½½æ¸²æŸ“æ–‡ä»¶</p><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">mathjax</span><span class="token punctuation">:</span> <span class="token boolean important">false</span> <span class="token comment"># ä¸å¼•å…¥</span><span class="token key atrule">mathjax</span><span class="token punctuation">:</span> <span class="token boolean important">true</span> <span class="token comment"># å¼•å…¥</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> Blog </category>
          
      </categories>
      
      
        <tags>
            
            <tag> method </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ã€ç»Ÿè®¡å­¦ä¹ æ–¹æ³•ã€‘æ¦‚è®ºç¯‡</title>
      <link href="/Coming-blog/2021/07/07/91-tong-ji-xue-xi-fang-fa-93-gai-lun-pian/"/>
      <url>/Coming-blog/2021/07/07/91-tong-ji-xue-xi-fang-fa-93-gai-lun-pian/</url>
      
        <content type="html"><![CDATA[<h1 id="æ¦‚è®º-å­¦å‰é¡»çŸ¥"><a class="markdownIt-Anchor" href="#æ¦‚è®º-å­¦å‰é¡»çŸ¥"></a> æ¦‚è®º-å­¦å‰é¡»çŸ¥</h1><p>æœ¬æ–‡å¯ä»¥å……å½“ä¸€ä¸ªå¯¹è¾ƒå°çŸ¥è¯†ç‚¹çš„é€ŸæŸ¥é€Ÿå¿†ï¼Œå¤§éƒ¨åˆ†çŸ¥è¯†ç‚¹å¹¶ä¸ä¼šè®²è§£ç»†è‡´~</p><p>ç»Ÿè®¡å­¦ä¹ æ–¹æ³•å­¦ä¹ è¿‡ç¨‹ä¸­è®°å½•çš„åŸºç¡€çŸ¥è¯†ï¼Œä¿æŒæ›´æ–°~</p><h1 id="ç»¼è¿°"><a class="markdownIt-Anchor" href="#ç»¼è¿°"></a> ç»¼è¿°</h1><h2 id="å‡†å¤‡"><a class="markdownIt-Anchor" href="#å‡†å¤‡"></a> å‡†å¤‡</h2><ol><li>æ•°æ®ï¼šå¾—åˆ°ä¸€ä¸ªæœ‰é™çš„è®­ç»ƒæ•°æ®é›†åˆï¼›</li><li>æ¨¡å‹ï¼šåŒ…å«æ‰€æœ‰å¯èƒ½çš„æ¨¡å‹çš„å‡è®¾ç©ºé—´ï¼Œå³å­¦ä¹ æ¨¡å‹çš„é›†åˆï¼›</li><li>æŸå¤±å‡½æ•°ï¼šç¡®å®šæ¨¡å‹é€‰æ‹©çš„å‡†åˆ™ï¼Œå³å­¦ä¹ çš„ç­–ç•¥ï¼›</li><li>ä¼˜åŒ–ç®—æ³•ï¼šå®ç°æ±‚è§£æœ€ä¼˜æ¨¡å‹çš„ç®—æ³•ï¼Œå³å­¦ä¹ çš„ç®—æ³•ï¼š</li><li>æœ€ä¼˜æ¨¡å‹ï¼šé€šè¿‡å­¦ä¹ æ–¹æ³•é€‰æ‹©æœ€ä¼˜æ¨¡å‹ï¼š</li><li>é¢„æµ‹ï¼šåˆ©ç”¨å­¦ä¹ çš„æœ€ä¼˜æ¨¡å‹å¯¹æ–°æ•°æ®è¿›è¡Œé¢„æµ‹æˆ–åˆ†æã€‚</li></ol><h2 id="æè¿°"><a class="markdownIt-Anchor" href="#æè¿°"></a> æè¿°</h2><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20210709201408068.png" alt="image-20210709201408068" /></p><p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼š</p><ol><li>ä»ç»™å®šçš„ã€æœ‰é™çš„ã€ç”¨äºå­¦ä¹ çš„<strong>è®­ç»ƒæ•°æ®é›†</strong>ï¼ˆtraining dataï¼‰åˆå‡ºå‘</li><li>ä»<strong>å‡è®¾ç©ºé—´</strong>ï¼ˆhypothesis spaceï¼‰å–å‡ºä¸€ä¸ªæ¨¡å‹</li><li>å°†æ•°æ®è¾“å…¥æ¨¡å‹ï¼Œå¹¶åº”ç”¨åˆ°æŸä¸ªè¯„ä»·æ ‡å‡†ä¸Šï¼ˆ<strong>æŸå¤±å‡½æ•°</strong>ï¼‰</li><li>åˆ©ç”¨é€‰å®šçš„ä¼˜åŒ–ç®—æ³•ï¼Œä¸æ–­çš„ä¼˜åŒ–æ¨¡å‹</li><li>æœ€ç»ˆå¾—åˆ°æœ€ç»ˆï¼ˆæœ€ä¼˜ï¼‰æ¨¡å‹</li></ol><h1 id="ä¸‰è¦ç´ "><a class="markdownIt-Anchor" href="#ä¸‰è¦ç´ "></a> ä¸‰è¦ç´ </h1><h2 id="æ¨¡å‹"><a class="markdownIt-Anchor" href="#æ¨¡å‹"></a> æ¨¡å‹</h2><p>æ¨¡å‹å°±æ˜¯æ‰€è¦å­¦ä¹ çš„æ¡ä»¶æ¦‚ç‡åˆ†å¸ƒæˆ–å†³ç­–å‡½æ•°</p><p>é’ˆå¯¹æ¦‚ç‡æ¨¡å‹ï¼Œæ¨¡å‹ä¸ºæ¡ä»¶æ¦‚ç‡åˆ†å¸ƒ</p><p>é’ˆå¯¹éæ¦‚ç‡ æ¨¡å‹ï¼Œæ¨¡å‹ä¸ºå†³ç­–å‡½æ•°</p><h2 id="ç­–ç•¥"><a class="markdownIt-Anchor" href="#ç­–ç•¥"></a> ç­–ç•¥</h2><p>é€‰æ‹©æœ€ä¼˜æ¨¡å‹çš„æ–¹æ³•ï¼ˆç­–ç•¥ï¼‰</p><p><strong>æœŸæœ›é£é™©</strong>ï¼šåˆåé£é™©å‡½æ•°ï¼Œåº¦é‡å¹³å‡æ„ä¹‰ä¸‹æ¨¡å‹é¢„æµ‹çš„å¥½åï¼Œæ˜¯æ¨¡å‹å…³äºè”åˆåˆ†å¸ƒçš„æœŸæœ›æŸå¤±ã€‚</p><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>R</mi><mrow><mi>e</mi><mi>x</mi><mi>p</mi></mrow></msub><mo stretchy="false">(</mo><mi>f</mi><mo stretchy="false">)</mo><mo>=</mo><msub><mi>E</mi><mi>p</mi></msub><mo stretchy="false">[</mo><mi>L</mi><mo stretchy="false">(</mo><mi>Y</mi><mo separator="true">,</mo><mi>f</mi><mo stretchy="false">(</mo><mi>X</mi><mo stretchy="false">)</mo><mo stretchy="false">)</mo><mo stretchy="false">]</mo><mo>=</mo><msub><mo>âˆ«</mo><mrow><mi>x</mi><mo>Ã—</mo><mi>y</mi></mrow></msub><mi>L</mi><mo stretchy="false">(</mo><mi>y</mi><mo separator="true">,</mo><mi>f</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mo stretchy="false">)</mo><mi>P</mi><mo stretchy="false">(</mo><mi>x</mi><mo separator="true">,</mo><mi>y</mi><mo stretchy="false">)</mo><mi>d</mi><mi>x</mi><mi>d</mi><mi>y</mi></mrow><annotation encoding="application/x-tex">R_{exp}(f) = E_p[L(Y, f(X))] = \int_{x \times y} L(y, f(x)) P(x, y) dxdy</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.036108em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:-0.00773em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">e</span><span class="mord mathdefault mtight">x</span><span class="mord mathdefault mtight">p</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.036108em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.05764em;">E</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:-0.05764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">p</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mopen">[</span><span class="mord mathdefault">L</span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.22222em;">Y</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.07847em;">X</span><span class="mclose">)</span><span class="mclose">)</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.408058em;vertical-align:-1.048058em;"></span><span class="mop"><span class="mop op-symbol large-op" style="margin-right:0.44445em;position:relative;top:-0.0011249999999999316em;">âˆ«</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:-0.5036189999999999em;"><span style="top:-1.7880500000000001em;margin-left:-0.44445em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">x</span><span class="mbin mtight">Ã—</span><span class="mord mathdefault mtight" style="margin-right:0.03588em;">y</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.048058em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">L</span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mclose">)</span><span class="mclose">)</span><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="mclose">)</span><span class="mord mathdefault">d</span><span class="mord mathdefault">x</span><span class="mord mathdefault">d</span><span class="mord mathdefault" style="margin-right:0.03588em;">y</span></span></span></span></span></p><p>ä½†æ˜¯é—®é¢˜ä¸­å®é™…åˆ†å¸ƒ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>P</mi><mo stretchy="false">(</mo><mi>x</mi><mo separator="true">,</mo><mi>y</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">P(x,y)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="mclose">)</span></span></span></span> é€šå¸¸æ˜¯æœªçŸ¥çš„ï¼Œå®é™…ä¸­å¸¸ä½¿ç”¨ç»éªŒé£é™©æ¥ä»£æ›¿æœŸæœ›é£é™©</p><p><strong>ç»éªŒé£é™©</strong>ï¼šç»™å®šæ¨¡å‹å…³äºè®­ç»ƒæ•°æ®é›†çš„å¹³å‡æŸå¤±ï¼Œå½“æ ·æœ¬å®¹é‡Nè¶‹äºæ— ç©·æ—¶ï¼Œç»éªŒé£é™©è¶‹è¿‘äºæœŸæœ›é£é™©ï¼ˆå¤§æ•°å®šå¾‹ï¼‰</p><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>R</mi><mrow><mi>e</mi><mi>m</mi><mi>p</mi></mrow></msub><mo stretchy="false">(</mo><mi>f</mi><mo stretchy="false">)</mo><mo>=</mo><mfrac><mn>1</mn><mi>N</mi></mfrac><munderover><mo>âˆ‘</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>N</mi></munderover><mi>L</mi><mo stretchy="false">(</mo><msub><mi>y</mi><mi>i</mi></msub><mo separator="true">,</mo><mi>f</mi><mo stretchy="false">(</mo><msub><mi>x</mi><mi>i</mi></msub><mo stretchy="false">)</mo><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">R_{emp}(f) = \frac{1}{N} \sum_{i=1}^{N} L(y_i, f(x_i))</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.036108em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:-0.00773em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">e</span><span class="mord mathdefault mtight">m</span><span class="mord mathdefault mtight">p</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:3.106005em;vertical-align:-1.277669em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.32144em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10903em;">N</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.8283360000000002em;"><span style="top:-1.872331em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.050005em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">âˆ‘</span></span></span><span style="top:-4.3000050000000005em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.10903em;">N</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.277669em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">L</span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mclose">)</span></span></span></span></span></p><p>ç­–ç•¥ä¾¿å¯ä»¥æ¨å‡ºï¼šç»éªŒé£é™©æœ€å°åŒ– - <span class="katex"><span class="katex-mathml"><math><semantics><mrow><munder><mo><mi>m</mi><mi>i</mi><mi>n</mi></mo><mrow><mi>f</mi><mo>âˆˆ</mo><mi mathvariant="script">F</mi></mrow></munder><mfrac><mn>1</mn><mi>N</mi></mfrac><msubsup><mo>âˆ‘</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>N</mi></msubsup><mi>L</mi><mo stretchy="false">(</mo><msub><mi>y</mi><mi>i</mi></msub><mo separator="true">,</mo><mi>f</mi><mo stretchy="false">(</mo><msub><mi>x</mi><mi>i</mi></msub><mo stretchy="false">)</mo><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\mathop{min}\limits_{f \in \mathcal{F}} \frac{1}{N} \sum_{i=1}^{N} L(y_i, f(x_i))</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.8694469999999999em;vertical-align:-0.8882159999999999em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.65952em;"><span style="top:-2.3478920000000003em;margin-left:0em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.10764em;">f</span><span class="mrel mtight">âˆˆ</span><span class="mord mtight"><span class="mord mathcal mtight" style="margin-right:0.09931em;">F</span></span></span></span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span><span class="mop"><span class="mord mathdefault">min</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.8882159999999999em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.845108em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.10903em;">N</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:-0.0000050000000000050004em;">âˆ‘</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.981231em;"><span style="top:-2.40029em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.2029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.10903em;">N</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.29971000000000003em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">L</span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mclose">)</span></span></span></span></p><p>ä½†æ˜¯ä¼šå­˜åœ¨è¿‡æ‹Ÿåˆçš„ç°è±¡ï¼Œå› æ­¤åŠ å…¥å¯¹å†³ç­–å‡½æ•°çš„çº¦æŸï¼Œå¼•å…¥ç»“æ„é£é™©æœ€å°åŒ–ï¼š</p><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><munder><mo><mi>m</mi><mi>i</mi><mi>n</mi></mo><mrow><mi>f</mi><mo>âˆˆ</mo><mi mathvariant="script">F</mi></mrow></munder><mfrac><mn>1</mn><mi>N</mi></mfrac><munderover><mo>âˆ‘</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>N</mi></munderover><mi>L</mi><mo stretchy="false">(</mo><msub><mi>y</mi><mi>i</mi></msub><mo separator="true">,</mo><mi>f</mi><mo stretchy="false">(</mo><msub><mi>x</mi><mi>i</mi></msub><mo stretchy="false">)</mo><mo stretchy="false">)</mo><mo>+</mo><mi>Î»</mi><mi>J</mi><mo stretchy="false">(</mo><mi>f</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\mathop{min}\limits_{f \in \mathcal{F}} \frac{1}{N} \sum_{i=1}^{N} L(y_i, f(x_i)) + \lambda J(f)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:3.106005em;vertical-align:-1.277669em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.65952em;"><span style="top:-2.3478920000000003em;margin-left:0em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.10764em;">f</span><span class="mrel mtight">âˆˆ</span><span class="mord mtight"><span class="mord mathcal mtight" style="margin-right:0.09931em;">F</span></span></span></span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span><span class="mop"><span class="mord mathdefault">min</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.8882159999999999em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.32144em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10903em;">N</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.8283360000000002em;"><span style="top:-1.872331em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.050005em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">âˆ‘</span></span></span><span style="top:-4.3000050000000005em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.10903em;">N</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.277669em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">L</span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault">Î»</span><span class="mord mathdefault" style="margin-right:0.09618em;">J</span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="mclose">)</span></span></span></span></span></p><p>æœŸæœ›é£é™©ä¸ç»éªŒé£é™©çš„è”ç³»ï¼šç”±äºå®é™…åˆ†å¸ƒP(x,y)ä¸çŸ¥é“å®é™…ä¸­å¸¸ç”¨ç»éªŒé£é™©ä»£æ›¿æœŸæœ›é£é™©</p><p><img src="https://raw.githubusercontent.com/Coming98/pictures/main/image-20210707215504624.png" alt="image-20210707215504624" /></p><h2 id="ç®—æ³•"><a class="markdownIt-Anchor" href="#ç®—æ³•"></a> ç®—æ³•</h2><p>å­¦ä¹ æ¨¡å‹çš„å…·ä½“è®¡ç®—æ–¹æ³•ï¼šæ¢¯åº¦ä¸‹é™â€¦</p><h1 id="æ¦‚ç‡"><a class="markdownIt-Anchor" href="#æ¦‚ç‡"></a> æ¦‚ç‡</h1><h2 id="theory"><a class="markdownIt-Anchor" href="#theory"></a> Theory</h2><p><strong>ç‹¬ç«‹</strong>ï¼šä¸¤ä¸åŒéšæœºå˜é‡çš„å–å€¼äº’ä¸å½±å“ï¼šç¬¬ä¸€æ¬¡æŠ›ç¡¬å¸å’Œç¬¬äºŒæ¬¡æŠ›ç¡¬å¸å¾—åˆ°çš„ç»“æœæ˜¯ç›¸äº’ç‹¬ç«‹çš„ã€‚</p><p><strong>ç‹¬ç«‹åŒåˆ†å¸ƒ</strong>ï¼šæŒ‡ä¸€ç»„éšæœºå˜é‡ä¸­æ¯ä¸ªå˜é‡çš„æ¦‚ç‡åˆ†å¸ƒéƒ½ç›¸åŒï¼Œä¸”è¿™äº›éšæœºå˜é‡äº’ç›¸ç‹¬ç«‹</p><p><strong>è¿‡æ‹Ÿåˆç°è±¡</strong>ï¼šä¸€å‘³è¿½æ±‚æé«˜å¯¹è®­ç»ƒæ•°æ®çš„é¢„æµ‹èƒ½åŠ›ï¼Œæ‰€é€‰æ¨¡å‹çš„å¤æ‚åº¦åˆ™å¾€å¾€ä¼šæ¯”çœŸæ¨¡å‹æ›´é«˜ã€‚å¯¹å·²çŸ¥æ•°æ®é¢„æµ‹å¾ˆå¥½ï¼Œå¯¹æœªçŸ¥æ•°æ®é¢„æµ‹å¾ˆå·®</p><p><strong>æ­£åˆ™åŒ–é¡¹</strong>ï¼šé€‰æ‹©ç»éªŒé£é™©å’Œæ¨¡å‹å¤æ‚åº¦åŒæ—¶è¾ƒå°çš„æ¨¡å‹</p><p><strong>å…ˆéªŒæ¦‚ç‡</strong>ï¼šæŒ‡æ ¹æ®ä»¥å¾€ç»éªŒå’Œåˆ†æå¾—åˆ°çš„æ¦‚ç‡ï¼Œå¦‚å…¨æ¦‚ç‡å…¬å¼</p><p><strong>åéªŒæ¦‚ç‡</strong>ï¼šæŒ‡åœ¨å¾—åˆ°â€œç»“æœâ€çš„ä¿¡æ¯åé‡æ–°ä¿®æ­£çš„æ¦‚ç‡ï¼Œæ˜¯â€œæ‰§æœå¯»å› â€é—®é¢˜ä¸­çš„&quot;æœ&quot;</p><blockquote><p>ç›®æ ‡äº‹ä»¶è¿˜æ²¡æœ‰å‘ç”Ÿï¼Œæ±‚è¿™ä»¶äº‹æƒ…å‘ç”Ÿçš„å¯èƒ½æ€§çš„å¤§å°ï¼Œæ˜¯å…ˆéªŒæ¦‚ç‡ã€‚</p><p>ç›®æ ‡äº‹ä»¶å·²å‘ç”Ÿï¼Œæ±‚äº‹æƒ…å‘ç”Ÿçš„åŸå› æ˜¯ç”±æŸå› ç´ å¼•èµ·çš„å¯èƒ½æ€§å¤§å°ï¼Œæ˜¯åéªŒæ¦‚ç‡ã€‚</p><p>Exampleï¼šç›®æ ‡äº‹ä»¶æ˜¯ç”¨è‹¹æœç”µè„‘çš„äººæ˜¯ä¸æ˜¯ç¨‹åºå‘˜ - <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>P</mi><mo stretchy="false">(</mo><mi>d</mi><mi>e</mi><mi>v</mi><mi mathvariant="normal">âˆ£</mi><mi>a</mi><mi>p</mi><mi>p</mi><mi>l</mi><mi>e</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">P(dev|apple)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord mathdefault">d</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right:0.03588em;">v</span><span class="mord">âˆ£</span><span class="mord mathdefault">a</span><span class="mord mathdefault">p</span><span class="mord mathdefault">p</span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault">e</span><span class="mclose">)</span></span></span></span></p><p>ç°å®ä¸­æˆ‘ä»¬å¯ä»¥çŸ¥é“ä½¿ç”¨è‹¹æœçš„äººæ•°å æ¯”å³ï¼š<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>P</mi><mo stretchy="false">(</mo><mi>a</mi><mi>p</mi><mi>p</mi><mi>l</mi><mi>e</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">P(apple)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord mathdefault">a</span><span class="mord mathdefault">p</span><span class="mord mathdefault">p</span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault">e</span><span class="mclose">)</span></span></span></span>ï¼Œä»¥åŠä½¿ç”¨è‹¹æœç”µè„‘çš„äººæ˜¯ç¨‹åºå‘˜çš„æ¦‚ç‡ï¼š<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>P</mi><mo stretchy="false">(</mo><mi>d</mi><mi>e</mi><mi>v</mi><mi mathvariant="normal">âˆ£</mi><mi>a</mi><mi>p</mi><mi>p</mi><mi>l</mi><mi>e</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">P(dev|apple)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord mathdefault">d</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right:0.03588em;">v</span><span class="mord">âˆ£</span><span class="mord mathdefault">a</span><span class="mord mathdefault">p</span><span class="mord mathdefault">p</span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault">e</span><span class="mclose">)</span></span></span></span> - å…ˆéªŒ</p><p>è€Œéœ€æ±‚æ˜¯å·²çŸ¥ä¸€ä¸ªäººæ˜¯ç¨‹åºå‘˜ï¼Œé—®ä»–ä½¿ç”¨è‹¹æœç”µè„‘çš„æ¦‚ç‡ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>P</mi><mo stretchy="false">(</mo><mi>a</mi><mi>p</mi><mi>p</mi><mi>l</mi><mi>e</mi><mi mathvariant="normal">âˆ£</mi><mi>d</mi><mi>e</mi><mi>v</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">P(apple|dev)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord mathdefault">a</span><span class="mord mathdefault">p</span><span class="mord mathdefault">p</span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault">e</span><span class="mord">âˆ£</span><span class="mord mathdefault">d</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right:0.03588em;">v</span><span class="mclose">)</span></span></span></span> - åéªŒ</p><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>P</mi><mo stretchy="false">(</mo><mi>a</mi><mi>p</mi><mi>p</mi><mi>l</mi><mi>e</mi><mi mathvariant="normal">âˆ£</mi><mi>d</mi><mi>e</mi><mi>v</mi><mo stretchy="false">)</mo><mo>=</mo><mfrac><mrow><mi>P</mi><mo stretchy="false">(</mo><mi>d</mi><mi>e</mi><mi>v</mi><mi mathvariant="normal">âˆ£</mi><mi>a</mi><mi>p</mi><mi>p</mi><mi>l</mi><mi>e</mi><mo stretchy="false">)</mo><mi>P</mi><mo stretchy="false">(</mo><mi>a</mi><mi>p</mi><mi>p</mi><mi>l</mi><mi>e</mi><mo stretchy="false">)</mo></mrow><mrow><mi>P</mi><mo stretchy="false">(</mo><mi>d</mi><mi>e</mi><mi>v</mi><mi mathvariant="normal">âˆ£</mi><mi>a</mi><mi>p</mi><mi>p</mi><mi>l</mi><mi>e</mi><mo stretchy="false">)</mo><mi>P</mi><mo stretchy="false">(</mo><mi>a</mi><mi>p</mi><mi>p</mi><mi>l</mi><mi>e</mi><mo stretchy="false">)</mo><mo>+</mo><mi>P</mi><mo stretchy="false">(</mo><mi>d</mi><mi>e</mi><mi>v</mi><mi mathvariant="normal">âˆ£</mi><mo stretchy="false">!</mo><mi>a</mi><mi>p</mi><mi>p</mi><mi>l</mi><mi>e</mi><mo stretchy="false">)</mo><mi>P</mi><mo stretchy="false">(</mo><mo stretchy="false">!</mo><mi>a</mi><mi>p</mi><mi>p</mi><mi>l</mi><mi>e</mi><mo stretchy="false">)</mo></mrow></mfrac></mrow><annotation encoding="application/x-tex">P(apple|dev) = \frac{P(dev|apple)P(apple)}{P(dev|apple)P(apple)+P(dev|!apple)P(!apple)}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord mathdefault">a</span><span class="mord mathdefault">p</span><span class="mord mathdefault">p</span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault">e</span><span class="mord">âˆ£</span><span class="mord mathdefault">d</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right:0.03588em;">v</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.363em;vertical-align:-0.936em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.427em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord mathdefault">d</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right:0.03588em;">v</span><span class="mord">âˆ£</span><span class="mord mathdefault">a</span><span class="mord mathdefault">p</span><span class="mord mathdefault">p</span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault">e</span><span class="mclose">)</span><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord mathdefault">a</span><span class="mord mathdefault">p</span><span class="mord mathdefault">p</span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault">e</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord mathdefault">d</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right:0.03588em;">v</span><span class="mord">âˆ£</span><span class="mclose">!</span><span class="mord mathdefault">a</span><span class="mord mathdefault">p</span><span class="mord mathdefault">p</span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault">e</span><span class="mclose">)</span><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mclose">!</span><span class="mord mathdefault">a</span><span class="mord mathdefault">p</span><span class="mord mathdefault">p</span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault">e</span><span class="mclose">)</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord mathdefault">d</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right:0.03588em;">v</span><span class="mord">âˆ£</span><span class="mord mathdefault">a</span><span class="mord mathdefault">p</span><span class="mord mathdefault">p</span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault">e</span><span class="mclose">)</span><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord mathdefault">a</span><span class="mord mathdefault">p</span><span class="mord mathdefault">p</span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault">e</span><span class="mclose">)</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.936em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p></blockquote><h2 id="equation"><a class="markdownIt-Anchor" href="#equation"></a> Equation</h2><p><strong>è´å¶æ–¯å…¬å¼</strong>ï¼š<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>P</mi><mo stretchy="false">(</mo><mi>X</mi><mi mathvariant="normal">âˆ£</mi><mi>Y</mi><mo stretchy="false">)</mo><mo>=</mo><mfrac><mrow><mi>P</mi><mo stretchy="false">(</mo><mi>Y</mi><mi mathvariant="normal">âˆ£</mi><mi>X</mi><mo stretchy="false">)</mo><mo>Ã—</mo><mi>P</mi><mo stretchy="false">(</mo><mi>X</mi><mo stretchy="false">)</mo></mrow><mrow><mi>P</mi><mo stretchy="false">(</mo><mi>Y</mi><mo stretchy="false">)</mo></mrow></mfrac></mrow><annotation encoding="application/x-tex">P(X|Y) = \frac{P(Y|X) \times P(X) }{P(Y)}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.07847em;">X</span><span class="mord">âˆ£</span><span class="mord mathdefault" style="margin-right:0.22222em;">Y</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.53em;vertical-align:-0.52em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.01em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.13889em;">P</span><span class="mopen mtight">(</span><span class="mord mathdefault mtight" style="margin-right:0.22222em;">Y</span><span class="mclose mtight">)</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.485em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.13889em;">P</span><span class="mopen mtight">(</span><span class="mord mathdefault mtight" style="margin-right:0.22222em;">Y</span><span class="mord mtight">âˆ£</span><span class="mord mathdefault mtight" style="margin-right:0.07847em;">X</span><span class="mclose mtight">)</span><span class="mbin mtight">Ã—</span><span class="mord mathdefault mtight" style="margin-right:0.13889em;">P</span><span class="mopen mtight">(</span><span class="mord mathdefault mtight" style="margin-right:0.07847em;">X</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.52em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></p><p><strong>å…¨æ¦‚ç‡å…¬å¼</strong>ï¼š<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>P</mi><mo stretchy="false">(</mo><mi>Y</mi><mo stretchy="false">)</mo><mo>=</mo><mi>P</mi><mo stretchy="false">(</mo><mi>Y</mi><mi mathvariant="normal">âˆ£</mi><msub><mi>X</mi><mn>1</mn></msub><mo stretchy="false">)</mo><mi>P</mi><mo stretchy="false">(</mo><msub><mi>X</mi><mn>1</mn></msub><mo stretchy="false">)</mo><mo>+</mo><mi>P</mi><mo stretchy="false">(</mo><mi>Y</mi><mi mathvariant="normal">âˆ£</mi><msub><mi>X</mi><mn>2</mn></msub><mo stretchy="false">)</mo><mi>P</mi><mo stretchy="false">(</mo><msub><mi>X</mi><mn>2</mn></msub><mo stretchy="false">)</mo><mo>+</mo><mo>â‹¯</mo><mo>+</mo><mi>P</mi><mo stretchy="false">(</mo><mi>Y</mi><mi mathvariant="normal">âˆ£</mi><msub><mi>X</mi><mi>n</mi></msub><mo stretchy="false">)</mo><mi>P</mi><mo stretchy="false">(</mo><msub><mi>X</mi><mi>n</mi></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">P(Y) = P(Y|X_1)P(X_1) + P(Y|X_2)P(X_2) + \dots + P(Y |X_n)P(X_n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.22222em;">Y</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.22222em;">Y</span><span class="mord">âˆ£</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.07847em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.07847em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.22222em;">Y</span><span class="mord">âˆ£</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.07847em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.07847em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.66666em;vertical-align:-0.08333em;"></span><span class="minner">â‹¯</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.22222em;">Y</span><span class="mord">âˆ£</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.07847em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">n</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.07847em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">n</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></p><p><strong>ç»“åˆ</strong>ï¼š<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>P</mi><mo stretchy="false">(</mo><msub><mi>X</mi><mi>i</mi></msub><mi mathvariant="normal">âˆ£</mi><mi>Y</mi><mo stretchy="false">)</mo><mo>=</mo><mfrac><mrow><mi>P</mi><mo stretchy="false">(</mo><mi>Y</mi><mi mathvariant="normal">âˆ£</mi><msub><mi>X</mi><mi>i</mi></msub><mo stretchy="false">)</mo><mi>P</mi><mo stretchy="false">(</mo><msub><mi>X</mi><mi>i</mi></msub><mo stretchy="false">)</mo></mrow><mrow><mi>P</mi><mo stretchy="false">(</mo><mi>Y</mi><mi mathvariant="normal">âˆ£</mi><msub><mi>X</mi><mn>1</mn></msub><mo stretchy="false">)</mo><mi>P</mi><mo stretchy="false">(</mo><msub><mi>X</mi><mn>1</mn></msub><mo stretchy="false">)</mo><mo>+</mo><mi>P</mi><mo stretchy="false">(</mo><mi>Y</mi><mi mathvariant="normal">âˆ£</mi><msub><mi>X</mi><mn>2</mn></msub><mo stretchy="false">)</mo><mi>P</mi><mo stretchy="false">(</mo><msub><mi>X</mi><mn>2</mn></msub><mo stretchy="false">)</mo><mo>+</mo><mo>â‹¯</mo><mo>+</mo><mi>P</mi><mo stretchy="false">(</mo><mi>Y</mi><mi mathvariant="normal">âˆ£</mi><msub><mi>X</mi><mi>n</mi></msub><mo stretchy="false">)</mo><mi>P</mi><mo stretchy="false">(</mo><msub><mi>X</mi><mi>n</mi></msub><mo stretchy="false">)</mo></mrow></mfrac></mrow><annotation encoding="application/x-tex">P(X_i|Y) = \frac{P(Y|X_i)P(X_i) }{P(Y|X_1)P(X_1) + P(Y|X_2)P(X_2) + \dots + P(Y |X_n)P(X_n)}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.07847em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord">âˆ£</span><span class="mord mathdefault" style="margin-right:0.22222em;">Y</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.53em;vertical-align:-0.52em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.01em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.13889em;">P</span><span class="mopen mtight">(</span><span class="mord mathdefault mtight" style="margin-right:0.22222em;">Y</span><span class="mord mtight">âˆ£</span><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31731428571428577em;"><span style="top:-2.357em;margin-left:-0.07847em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span><span class="mclose mtight">)</span><span class="mord mathdefault mtight" style="margin-right:0.13889em;">P</span><span class="mopen mtight">(</span><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31731428571428577em;"><span style="top:-2.357em;margin-left:-0.07847em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span><span class="mclose mtight">)</span><span class="mbin mtight">+</span><span class="mord mathdefault mtight" style="margin-right:0.13889em;">P</span><span class="mopen mtight">(</span><span class="mord mathdefault mtight" style="margin-right:0.22222em;">Y</span><span class="mord mtight">âˆ£</span><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31731428571428577em;"><span style="top:-2.357em;margin-left:-0.07847em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span><span class="mclose mtight">)</span><span class="mord mathdefault mtight" style="margin-right:0.13889em;">P</span><span class="mopen mtight">(</span><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31731428571428577em;"><span style="top:-2.357em;margin-left:-0.07847em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span><span class="mclose mtight">)</span><span class="mbin mtight">+</span><span class="minner mtight">â‹¯</span><span class="mbin mtight">+</span><span class="mord mathdefault mtight" style="margin-right:0.13889em;">P</span><span class="mopen mtight">(</span><span class="mord mathdefault mtight" style="margin-right:0.22222em;">Y</span><span class="mord mtight">âˆ£</span><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.16454285714285719em;"><span style="top:-2.357em;margin-left:-0.07847em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathdefault mtight">n</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span><span class="mclose mtight">)</span><span class="mord mathdefault mtight" style="margin-right:0.13889em;">P</span><span class="mopen mtight">(</span><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.16454285714285719em;"><span style="top:-2.357em;margin-left:-0.07847em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathdefault mtight">n</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span><span class="mclose mtight">)</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.485em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.13889em;">P</span><span class="mopen mtight">(</span><span class="mord mathdefault mtight" style="margin-right:0.22222em;">Y</span><span class="mord mtight">âˆ£</span><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3280857142857143em;"><span style="top:-2.357em;margin-left:-0.07847em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span><span class="mclose mtight">)</span><span class="mord mathdefault mtight" style="margin-right:0.13889em;">P</span><span class="mopen mtight">(</span><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3280857142857143em;"><span style="top:-2.357em;margin-left:-0.07847em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.52em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></p><p><strong>åˆ‡æ¯”é›ªå¤«å¤§æ•°å®šç†</strong>ï¼šéšç€æ ·æœ¬å®¹é‡nçš„å¢åŠ ï¼Œæ ·æœ¬å¹³å‡æ•°æ¥è¿‘äºæ€»ä½“å¹³å‡æ•°ï¼Œä»è€Œæ ¹æ®æ ·æœ¬å¹³å‡æ•°ä¼°è®¡æ€»ä½“å¹³å‡æ•°ã€‚</p><h1 id="æ•°å­¦"><a class="markdownIt-Anchor" href="#æ•°å­¦"></a> æ•°å­¦</h1><h2 id="èŒƒæ•°"><a class="markdownIt-Anchor" href="#èŒƒæ•°"></a> èŒƒæ•°</h2><ul><li>L1 èŒƒæ•°ï¼šå‘é‡å…ƒç´ ç»å¯¹å€¼ä¹‹å’Œ</li></ul><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="normal">âˆ£</mi><mi mathvariant="normal">âˆ£</mi><mi>x</mi><mi mathvariant="normal">âˆ£</mi><msub><mi mathvariant="normal">âˆ£</mi><mn>1</mn></msub><mo>=</mo><munderover><mo>âˆ‘</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></munderover><mi mathvariant="normal">âˆ£</mi><msub><mi>x</mi><mi>i</mi></msub><mi mathvariant="normal">âˆ£</mi></mrow><annotation encoding="application/x-tex">||x||_1 = \sum_{i=1}^{n}|x_i|</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">âˆ£</span><span class="mord">âˆ£</span><span class="mord mathdefault">x</span><span class="mord">âˆ£</span><span class="mord"><span class="mord">âˆ£</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.929066em;vertical-align:-1.277669em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.6513970000000002em;"><span style="top:-1.872331em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.050005em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">âˆ‘</span></span></span><span style="top:-4.3000050000000005em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">n</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.277669em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">âˆ£</span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord">âˆ£</span></span></span></span></span></p><ul><li>L2 èŒƒæ•°ï¼šæ¬§å‡ é‡Œå¾—èŒƒæ•°ï¼Œå¸¸ç”¨äºè®¡ç®—å‘é‡é•¿åº¦ï¼Œå‘é‡å…ƒç´ ç»å¯¹å€¼çš„å¹³æ–¹å†å¼€æ–¹</li></ul><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="normal">âˆ£</mi><mi mathvariant="normal">âˆ£</mi><mi>x</mi><mi mathvariant="normal">âˆ£</mi><msub><mi mathvariant="normal">âˆ£</mi><mn>2</mn></msub><mo>=</mo><msup><mrow><mo fence="true">(</mo><munderover><mo>âˆ‘</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></munderover><mi mathvariant="normal">âˆ£</mi><msub><mi>x</mi><mi>i</mi></msub><msup><mi mathvariant="normal">âˆ£</mi><mn>2</mn></msup><mo fence="true">)</mo></mrow><mfrac><mn>1</mn><mn>2</mn></mfrac></msup></mrow><annotation encoding="application/x-tex">||x||_2 = \left(\sum_{i=1}^{n}|x_i|^2 \right)^{\frac{1}{2}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">âˆ£</span><span class="mord">âˆ£</span><span class="mord mathdefault">x</span><span class="mord">âˆ£</span><span class="mord"><span class="mord">âˆ£</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:3.371589em;vertical-align:-1.277669em;"></span><span class="minner"><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size4">(</span></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.6513970000000002em;"><span style="top:-1.872331em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.050005em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">âˆ‘</span></span></span><span style="top:-4.3000050000000005em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">n</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.277669em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">âˆ£</span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord">âˆ£</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size4">)</span></span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:2.0939200000000002em;"><span style="top:-4.5029em;margin-right:0.05em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mopen nulldelimiter sizing reset-size3 size6"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8443142857142858em;"><span style="top:-2.656em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span><span style="top:-3.2255000000000003em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line mtight" style="border-bottom-width:0.049em;"></span></span><span style="top:-3.384em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.344em;"><span></span></span></span></span></span><span class="mclose nulldelimiter sizing reset-size3 size6"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p><ul><li><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo>+</mo><mi mathvariant="normal">âˆ</mi></mrow><annotation encoding="application/x-tex">+\infty</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.66666em;vertical-align:-0.08333em;"></span><span class="mord">+</span><span class="mord">âˆ</span></span></span></span> èŒƒæ•°ï¼šæ‰€æœ‰å‘é‡å…ƒç´ ç»å¯¹å€¼ä¸­æœ€å¤§å€¼</li></ul><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="normal">âˆ£</mi><mi mathvariant="normal">âˆ£</mi><mi>x</mi><mi mathvariant="normal">âˆ£</mi><msub><mi mathvariant="normal">âˆ£</mi><mrow><mo>+</mo><mi mathvariant="normal">âˆ</mi></mrow></msub><mo>=</mo><munder><mo><mi>m</mi><mi>a</mi><mi>x</mi></mo><mi>i</mi></munder><mi mathvariant="normal">âˆ£</mi><msub><mi>x</mi><mi>i</mi></msub><mi mathvariant="normal">âˆ£</mi></mrow><annotation encoding="application/x-tex">||x||_{+\infin} = \mathop{max}\limits_{i}|x_i|</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">âˆ£</span><span class="mord">âˆ£</span><span class="mord mathdefault">x</span><span class="mord">âˆ£</span><span class="mord"><span class="mord">âˆ£</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.25833100000000003em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">+</span><span class="mord mtight">âˆ</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.477664em;vertical-align:-0.7276640000000001em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.43055999999999983em;"><span style="top:-2.372336em;margin-left:0em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span><span class="mop"><span class="mord mathdefault">ma</span><span class="mord mathdefault">x</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.7276640000000001em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">âˆ£</span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord">âˆ£</span></span></span></span></span></p><ul><li><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo>âˆ’</mo><mi mathvariant="normal">âˆ</mi></mrow><annotation encoding="application/x-tex">-\infty</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.66666em;vertical-align:-0.08333em;"></span><span class="mord">âˆ’</span><span class="mord">âˆ</span></span></span></span> èŒƒæ•°ï¼šæ‰€æœ‰å‘é‡å…ƒç´ ç»å¯¹å€¼ä¸­æœ€å°å€¼</li></ul><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="normal">âˆ£</mi><mi mathvariant="normal">âˆ£</mi><mi>x</mi><mi mathvariant="normal">âˆ£</mi><msub><mi mathvariant="normal">âˆ£</mi><mrow><mo>âˆ’</mo><mi mathvariant="normal">âˆ</mi></mrow></msub><mo>=</mo><munder><mo><mi>m</mi><mi>i</mi><mi>n</mi></mo><mi>i</mi></munder><mi mathvariant="normal">âˆ£</mi><msub><mi>x</mi><mi>i</mi></msub><mi mathvariant="normal">âˆ£</mi></mrow><annotation encoding="application/x-tex">||x||_{-\infin} = \mathop{min}\limits_{i}|x_i|</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">âˆ£</span><span class="mord">âˆ£</span><span class="mord mathdefault">x</span><span class="mord">âˆ£</span><span class="mord"><span class="mord">âˆ£</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.25833100000000003em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">âˆ’</span><span class="mord mtight">âˆ</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.4776639999999999em;vertical-align:-0.727664em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.65952em;"><span style="top:-2.372336em;margin-left:0em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span><span class="mop"><span class="mord mathdefault">min</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.727664em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">âˆ£</span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord">âˆ£</span></span></span></span></span></p><ul><li><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>L</mi><mi>p</mi></msub></mrow><annotation encoding="application/x-tex">L_p</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.969438em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault">L</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">p</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span> èŒƒæ•°ï¼šå³ç»Ÿä¸€å½¢å¼ï¼Œå‘é‡å…ƒç´ ç»å¯¹å€¼çš„pæ¬¡æ–¹å’Œçš„1/pæ¬¡å¹‚</li></ul><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="normal">âˆ£</mi><mi mathvariant="normal">âˆ£</mi><mi>x</mi><mi mathvariant="normal">âˆ£</mi><msub><mi mathvariant="normal">âˆ£</mi><mi>p</mi></msub><mo>=</mo><msup><mrow><mo fence="true">(</mo><munderover><mo>âˆ‘</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></munderover><mi mathvariant="normal">âˆ£</mi><msub><mi>x</mi><mi>i</mi></msub><msup><mi mathvariant="normal">âˆ£</mi><mi>p</mi></msup><mo fence="true">)</mo></mrow><mfrac><mn>1</mn><mi>p</mi></mfrac></msup></mrow><annotation encoding="application/x-tex">||x||_p = \left(\sum_{i=1}^{n}|x_i|^p \right)^{\frac{1}{p}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.036108em;vertical-align:-0.286108em;"></span><span class="mord">âˆ£</span><span class="mord">âˆ£</span><span class="mord mathdefault">x</span><span class="mord">âˆ£</span><span class="mord"><span class="mord">âˆ£</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">p</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:3.3715889999999997em;vertical-align:-1.277669em;"></span><span class="minner"><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size4">(</span></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.6513970000000002em;"><span style="top:-1.872331em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.050005em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">âˆ‘</span></span></span><span style="top:-4.3000050000000005em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">n</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.277669em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">âˆ£</span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord">âˆ£</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.714392em;"><span style="top:-3.1130000000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">p</span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size4">)</span></span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:2.09392em;"><span style="top:-4.5029em;margin-right:0.05em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mopen nulldelimiter sizing reset-size3 size6"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8443142857142858em;"><span style="top:-2.656em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">p</span></span></span></span><span style="top:-3.2255000000000003em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line mtight" style="border-bottom-width:0.049em;"></span></span><span style="top:-3.384em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.48288571428571425em;"><span></span></span></span></span></span><span class="mclose nulldelimiter sizing reset-size3 size6"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p>]]></content>
      
      
      <categories>
          
          <category> ç»Ÿè®¡å­¦ä¹ æ–¹æ³• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ML </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åˆ†è¯å™¨Tokenizerä½¿ç”¨æ–¹æ³•ä¸å®è·µ</title>
      <link href="/Coming-blog/2021/07/07/fen-ci-qi-tokenizer-shi-yong-fang-fa-yu-shi-jian/"/>
      <url>/Coming-blog/2021/07/07/fen-ci-qi-tokenizer-shi-yong-fang-fa-yu-shi-jian/</url>
      
        <content type="html"><![CDATA[<h1 id="quick-start"><a class="markdownIt-Anchor" href="#quick-start"></a> Quick Start</h1><p>è¯¥ç±»å…è®¸ä½¿ç”¨ä¸¤ç§æ–¹æ³•å‘é‡åŒ–ä¸€ä¸ªæ–‡æœ¬è¯­æ–™åº“ï¼š</p><ol><li>å°†æ¯ä¸ªæ–‡æœ¬è½¬åŒ–ä¸ºä¸€ä¸ªæ•´æ•°åºåˆ—ï¼ˆæ¯ä¸ªæ•´æ•°éƒ½æ˜¯è¯å…¸ä¸­æ ‡è®°çš„ç´¢å¼•ï¼‰</li><li>å°†æ¯ä¸ªæ–‡æœ¬è½¬åŒ–ä¸ºä¸€ä¸ªå‘é‡ï¼Œå…¶ä¸­æ¯ä¸ªæ ‡è®°çš„ç³»æ•°å¯ä»¥æ˜¯äºŒè¿›åˆ¶å€¼ã€è¯é¢‘ã€TF-IDFæƒé‡ç­‰ã€‚</li></ol><p>Tipsï¼šè¯ç´¢å¼•åˆ†é…ä» 1 å¼€å§‹</p><p>Tipsï¼šåŸºäºè¯é¢‘ä¿ç•™ <code>num_words - 1</code> ä¸ªè¯ï¼Œå…¶ä½™è¯å°†ä¼šåƒè¿‡æ»¤å­—ç¬¦è¿‡æ»¤æ‰</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">keras<span class="token punctuation">.</span>preprocessing<span class="token punctuation">.</span>text<span class="token punctuation">.</span>Tokenizer<span class="token punctuation">(</span>    num_words<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token comment"># å¤„ç†æœ€å¤§å•è¯æ•°ç›®(num_words-1)ï¼ŒåŸºäºè¯é¢‘ç­›é€‰</span>    filters<span class="token operator">=</span><span class="token string">"!"</span><span class="token comment">#$%&amp;()*+,-./:;&lt;=>?@[\]^_`&#123;|&#125;~ ", # è¿‡æ»¤çš„å…ƒç´ ï¼Œå­—ç¬¦çº§åŒ¹é…è¿‡æ»¤</span>    lower<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> <span class="token comment"># æ˜¯å¦å°†æ–‡æœ¬è½¬ä¸ºå°å†™</span>    split<span class="token operator">=</span><span class="token string">" "</span><span class="token punctuation">,</span> <span class="token comment"># è¯åˆ†éš”ç¬¦</span>    char_level<span class="token operator">=</span><span class="token boolean">False</span> <span class="token comment"># å¦‚æœä¸º Trueï¼Œåˆ™æ¯ä¸ªå­—ç¬¦éƒ½å°†è¢«è§†ä¸ºæ ‡è®°ã€‚</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="attributes"><a class="markdownIt-Anchor" href="#attributes"></a> Attributes</h1><p>æ•°æ®æ ¼å¼å¦‚ï¼šè¯­æ–™åº“ - <code>texts</code> = <code>[ document1:&quot;AAAA.BBBB.CCCC.&quot;, document2, ...]</code></p><pre class="line-numbers language-python" data-language="python"><code class="language-python">document_countword_counts <span class="token comment"># è¯åœ¨è¯­æ–™åº“ä¸­çš„é¢‘æ•°</span>word_docs <span class="token comment"># è¯åœ¨ documents ä¸­å‡ºç°çš„é¢‘æ•°ï¼Œç”¨äº TF-IDF ç®—æ³•</span><span class="token triple-quoted-string string">"""for w in seq:if w in self.word_counts:self.word_counts[w] += 1    else:self.word_counts[w] = 1for w in set(seq):# In how many documents each word occursself.word_docs[w] += 1"""</span>index_docs <span class="token comment"># åŒ word_docs åªä¸è¿‡å°†è¯æ˜ å°„ä¸ºäº†ç´¢å¼•å€¼</span>index_word <span class="token comment"># ç´¢å¼• To è¯çš„æ˜ å°„è¯å…¸</span>word_index <span class="token comment"># è¯ To ç´¢å¼•çš„æ˜ å°„è¯å…¸</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="methods"><a class="markdownIt-Anchor" href="#methods"></a> Methods</h1><p>æ€»ä½“æ¥è¯´å°±æ˜¯å®Œæˆäº†è¯­æ–™åº“ä¸­ Token ä¸ index çš„æ˜ å°„æ”¯æŒï¼Œæ˜ å°„ä»¥è¯é¢‘ä¸ºåŸºç¡€</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">fit_on_sequences<span class="token punctuation">(</span>sequences<span class="token punctuation">)</span> <span class="token comment"># åˆ—è¡¨ï¼Œå†…éƒ¨å…ƒç´ ä¸ºå•è¯ç´¢å¼•</span>fit_on_texts<span class="token punctuation">(</span>texts<span class="token punctuation">)</span> <span class="token comment"># åˆ—è¡¨ï¼Œå†…éƒ¨å…ƒç´ ä¸ºåˆ†è¯åçš„å•ä¸ª token</span>sequences_to_matrix<span class="token punctuation">(</span>sequences<span class="token punctuation">,</span> mode<span class="token operator">=</span><span class="token string">'binary'</span><span class="token punctuation">)</span> <span class="token comment"># å°†å„ä¸ªè¯­æ–™çš„å…ƒç´ ç´¢å¼•ä¿¡æ¯è½¬ä¸º numpy çŸ©é˜µ - é€šå¸¸ç”¨äºæ„å»ºæ•°æ®é›†</span>sequences_to_texts<span class="token punctuation">(</span>sequences<span class="token punctuation">)</span> <span class="token comment"># list of word indices(int) TO list of tokens(string)</span>texts_to_sequences<span class="token punctuation">(</span>texts<span class="token punctuation">)</span>get_config<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># å­—å…¸ï¼Œè¿”å› tokenizer å®ä¾‹çš„é…ç½®ä¿¡æ¯</span>to_json <span class="token comment"># jsonï¼Œè¿”å› tokenizer å®ä¾‹çš„é…ç½®ä¿¡æ¯</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol><li>é€šè¿‡ <code>fit_on_texts</code> å®Œæˆ Tokenizer çš„æ‹Ÿåˆï¼Œæ›´æ–° Attributes <code>document_count, word_counts, word_docs, index_docs, index_word, word_index</code></li><li>é€šè¿‡å†…ç½®æ–¹æ³•æˆ–å±æ€§åè·å–ç›¸å…³ä¿¡æ¯</li></ol><h1 id="demo"><a class="markdownIt-Anchor" href="#demo"></a> Demo</h1><p>è¯­æ–™åº“æ•°æ®å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">texts <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'United were league champions last season.'</span><span class="token punctuation">,</span>        <span class="token string">"They're in a different league from us."</span><span class="token punctuation">,</span>        <span class="token string">"the League of Nations"</span><span class="token punctuation">,</span>        <span class="token string">"a meeting of the Women's League for Peace"</span><span class="token punctuation">,</span>        <span class="token string">"Her success has taken her out of my league"</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æµ‹è¯•å¦‚ä¸‹</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">test_default</span><span class="token punctuation">(</span>title<span class="token punctuation">,</span> tokenizer<span class="token punctuation">)</span><span class="token punctuation">:</span>    fit_req <span class="token operator">=</span> tokenizer<span class="token punctuation">.</span>fit_on_texts<span class="token punctuation">(</span>texts<span class="token punctuation">)</span> <span class="token comment"># return None</span>    <span class="token comment"># æ–‡æœ¬æœªåˆ†è¯å…ˆè¿›è¡Œåˆ†è¯ï¼Œç„¶åå°†è¯è½¬ä¸ºç´¢å¼•å€¼</span>    seq <span class="token operator">=</span> tokenizer<span class="token punctuation">.</span>texts_to_sequences<span class="token punctuation">(</span>texts<span class="token punctuation">)</span>    seq_arr <span class="token operator">=</span> tokenizer<span class="token punctuation">.</span>sequences_to_matrix<span class="token punctuation">(</span>seq<span class="token punctuation">)</span>    <span class="token triple-quoted-string string">"""    seq : å¯ä»¥çœ‹å‡º 1 çš„ä½ç½®æ˜¯è¯é¢‘æœ€é«˜çš„ league    [[6, 7, 1, 8, 9, 10],    [11, 12, 3, 13, 1, 14, 15],    [4, 1, 2, 16],    [3, 17, 2, 4, 18, 1, 19, 20],    [5, 21, 22, 23, 5, 24, 2, 25, 1]]    seq_arr: è¿‡é•¿ï¼Œè¯·çœ‹ä¸‹æ–¹ç¤ºä¾‹"""</span><span class="token keyword">def</span> <span class="token function">test_limit_numWords</span><span class="token punctuation">(</span>title<span class="token punctuation">,</span> tokenizer<span class="token punctuation">)</span><span class="token punctuation">:</span>    tokenizer<span class="token punctuation">.</span>fit_on_texts<span class="token punctuation">(</span>texts<span class="token punctuation">)</span>    seq <span class="token operator">=</span> tokenizer<span class="token punctuation">.</span>texts_to_sequences<span class="token punctuation">(</span>texts<span class="token punctuation">)</span>seq_arr <span class="token operator">=</span> tokenizer<span class="token punctuation">.</span>sequences_to_matrix<span class="token punctuation">(</span>seq<span class="token punctuation">)</span>    texts_from_seq <span class="token operator">=</span> tokenizer<span class="token punctuation">.</span>sequences_to_texts<span class="token punctuation">(</span>seq<span class="token punctuation">)</span>    <span class="token triple-quoted-string string">"""    seq : è¯é¢‘ä½çš„è¯ç›´æ¥èˆå»ï¼ŒçŸ¥ä¿ç•™è¯é¢‘è¾ƒé«˜çš„å‰ num_words - 1 ä¸ªè¯[[6, 7, 1, 8, 9], [3, 1], [4, 1, 2], [3, 2, 4, 1], [5, 5, 2, 1]]    seq_arr : ç´¢å¼• 0 ä¿ç•™ï¼Œå› æ­¤è¯å…¸æ•°ç›®ä¸º seq_arr.shape[1]    [[0. 1. 0. 0. 0. 0. 1. 1. 1. 1.]     [0. 1. 0. 1. 0. 0. 0. 0. 0. 0.]     [0. 1. 1. 0. 1. 0. 0. 0. 0. 0.]     [0. 1. 1. 1. 1. 0. 0. 0. 0. 0.]     [0. 1. 1. 0. 0. 1. 0. 0. 0. 0.]]     texts_from_seq : ['united were league champions last', 'a league', 'the league of', 'a of the league', 'her her of league']    """</span><span class="token triple-quoted-string string">"""Attributes'document_count': 5'word_counts': '&#123;"united": 1, "were": 1, ... "her": 2, "my": 1&#125;''word_docs': '&#123;"united": 1, ... , "her": 1, "my": 1&#125;''index_docs': '&#123;"6": 1, "8": 1, ... "25": 1&#125;''index_word': '&#123;"1": "league", "2": "of", "3": "a", ... "24": "out", "25": "my"&#125;''word_index': '&#123;"league": 1, "of": 2, "a": 3, ... "out": 24, "my": 25&#125;'"""</span><span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    tokenizer_default <span class="token operator">=</span> Tokenizer<span class="token punctuation">(</span><span class="token punctuation">)</span>    tokenizer_limit_numWords <span class="token operator">=</span> Tokenizer<span class="token punctuation">(</span>num_words<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token comment"># åªè€ƒè™‘è¯é¢‘å‰9çš„è¯</span>    test_default<span class="token punctuation">(</span><span class="token string">"default test"</span><span class="token punctuation">,</span> tokenizer_default<span class="token punctuation">)</span>    test_limit_numWords<span class="token punctuation">(</span><span class="token string">"limit num_words test"</span><span class="token punctuation">,</span> tokenizer_limit_numWords<span class="token punctuation">)</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>    main<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr /><p>å¦‚æœå­˜åœ¨é”™è¯¯ï¼Œæ¬¢è¿ç•™è¨€æŒ‡å‡ºå“¦~</p>]]></content>
      
      
      <categories>
          
          <category> NLP </category>
          
      </categories>
      
      
        <tags>
            
            <tag> keras </tag>
            
            <tag> tensorflow </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>github pages ä¸ªäººåšå®¢æ­å»ºéƒ¨ç½²è®°å½•</title>
      <link href="/Coming-blog/2021/04/29/github-pages-ge-ren-bo-ke-da-jian-bu-shu-ji-lu/"/>
      <url>/Coming-blog/2021/04/29/github-pages-ge-ren-bo-ke-da-jian-bu-shu-ji-lu/</url>
      
        <content type="html"><![CDATA[<p>åŸºç¡€ç‰ˆçš„ Github Pages + Hexo + travis ci å®ç°ä¸ªäººåšå®¢é…ç½®</p><p>å³ä½¿æ˜¯åœ¨ä¼—å¤šå¤§ä½¬åšå®¢çš„å¸®åŠ©ä¸‹ï¼Œæ•´ä½“é…ç½®è¿‡ç¨‹ä¹Ÿæœ‰äº›è‰°è¾›ï¼Œè®©æˆ‘æœ€å¤´ç–¼çš„å°±æ˜¯ç½‘ç»œé—®é¢˜ï¼Œæ„Ÿè§‰ç»™ git é…äº†ä»£ç†ï¼Œæ”¹äº† hosts ä¹Ÿæ²¡æœ‰ä»€ä¹ˆç”¨</p><p>å›æ¥äº† - 2021å¹´7æœˆ5æ—¥23:53:13</p><h1 id="reference"><a class="markdownIt-Anchor" href="#reference"></a> Reference</h1><p><strong>Tips</strong>ï¼šæ³¨æ„ä¸»è·¯çº¿æ•™ç¨‹ä¸­ä½¿ç”¨çš„æ˜¯ <a target="_blank" rel="noopener" href="http://travis-ci.org">travis-ci.org</a>, è¿™ä¸ªç½‘ç«™é©¬ä¸Šå°±è¦å…³é—­äº†ï¼Œå…¶åŠŸèƒ½è¿ç§»åˆ°äº† <a target="_blank" rel="noopener" href="https://travis-ci.com/">travis-ci.com</a></p><h2 id="ä¸»è·¯çº¿"><a class="markdownIt-Anchor" href="#ä¸»è·¯çº¿"></a> ä¸»è·¯çº¿</h2><p>ã€Hexoã€‘ä½¿ç”¨Hexo+github pages+travis ci å®ç°è‡ªåŠ¨åŒ–éƒ¨ç½² - <a target="_blank" rel="noopener" href="https://www.cnblogs.com/mfrank/p/12829882.html">HERE</a></p><p>ã€Hexoã€‘è‡ªå®šä¹‰ Hexo é…ç½®æ–‡ä»¶ - <a target="_blank" rel="noopener" href="https://www.cnblogs.com/mfrank/p/12830094.html">HERE</a></p><p>ã€Hexoã€‘Hexo ä¸»é¢˜ Matery é…ç½® - <a target="_blank" rel="noopener" href="https://www.cnblogs.com/mfrank/p/12830097.html">HERE</a></p><h2 id="è¾…åŠ©è·¯çº¿"><a class="markdownIt-Anchor" href="#è¾…åŠ©è·¯çº¿"></a> è¾…åŠ©è·¯çº¿</h2><p>ä¸»è·¯çº¿ä½¿ç”¨çš„ä¸»é¢˜ä¸º <code>matery</code> å…¶ å®˜æ–¹é…ç½®åœ°å€ (Github Address) - <a target="_blank" rel="noopener" href="https://github.com/blinkfox/hexo-theme-matery/blob/develop/README_CN.md">HERE</a></p><p>æ¯”è¾ƒå¥½çœ‹çš„ä¸€ä¸ªæœ€ç»ˆè¯é£æ ¼ - <a target="_blank" rel="noopener" href="https://matjenin.gitee.io/index.html">HERE</a></p><p>åœ¨ä¸€äº›é…ç½®æ–‡ä»¶ç­‰é‡åˆ°çš„ç‰¹æ®Šå­—ç¬¦è½¬ä¹‰é—®é¢˜  - <a target="_blank" rel="noopener" href="https://wxnacy.com/2018/01/12/hexo-specific-symbol/">HERE</a></p><p>HEXO å®˜æ–¹ä¸»é¢˜åº“ - <a target="_blank" rel="noopener" href="https://hexo.io/themes/">HERE</a></p><p>HEXO å®˜æ–¹ICONåº“ - <a target="_blank" rel="noopener" href="https://fontawesome.com/icons?d=gallery&amp;p=2">HERE</a></p><p>YAMLè¯­è¨€ç®€ç‰ˆæ•™ç¨‹ï¼Œä¾¿äºç†è§£å’Œè‡ªå®šä¹‰ <code>*.yml</code> <a target="_blank" rel="noopener" href="http://www.ruanyifeng.com/blog/2016/07/yaml.html">HERE</a></p><p>LiveRe ç•™è¨€è¯„è®ºåŠŸèƒ½é…ç½® - <a target="_blank" rel="noopener" href="https://starslove.me/2020/07/08/Hexo-comment/">HERE</a></p><p>é«˜æ°´å¹³æ’ä»¶ - <a target="_blank" rel="noopener" href="https://blog.csdn.net/q2158798/article/details/82354154">HERE</a></p><h1 id="hexo-é¡¹ç›®ç›®å½•"><a class="markdownIt-Anchor" href="#hexo-é¡¹ç›®ç›®å½•"></a> Hexo é¡¹ç›®ç›®å½•</h1><h2 id="init"><a class="markdownIt-Anchor" href="#init"></a> Init</h2><p>å®ç°å¯¹ç›®æ ‡ç›®å½•çš„åˆå§‹åŒ–</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"># blogname - ä¸ºåšå®¢é¡¹ç›®å‡†å¤‡çš„ç›®å½•åhexo init blognamecd blognamenup install<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h2 id="catalog"><a class="markdownIt-Anchor" href="#catalog"></a> Catalog</h2><p><code>_config.yml</code> -</p><p><code>package.json</code> - æ˜¯åº”ç”¨ç¨‹åºä¿¡æ¯ï¼Œé€šå¸¸ä¸éœ€è¦å…³å¿ƒ</p><p><code>node_moudles</code> - ç”¨æ¥å­˜æ”¾ node ç›¸å…³çš„æ¨¡å—ï¼Œé€šå¸¸ä¸éœ€è¦å…³å¿ƒ</p><p><code>scaffolds/</code> - æ–°å»ºæ–‡ç« æ—¶çš„æ¨¡æ¿æ–‡ä»¶</p><p><code>source/</code> - èµ„æºæ–‡ä»¶å¤¹ï¼Œå­˜æ”¾ç”¨æˆ·èµ„æº</p><p><code>theme/</code> - ä¸»é¢˜æ–‡ä»¶å¤¹ï¼Œ<code>_config.yml</code> å°†ä¼šåœ¨æ­¤å®šä½ä½¿ç”¨çš„ä¸»é¢˜</p><h1 id="quick-start"><a class="markdownIt-Anchor" href="#quick-start"></a> Quick Start</h1><p>è®°å½•æ—¥å¸¸é…ç½®ä¸­å¸¸ç”¨çš„å‘½ä»¤ä¿¡æ¯</p><h2 id="é¦–æ¬¡åˆå§‹åŒ–"><a class="markdownIt-Anchor" href="#é¦–æ¬¡åˆå§‹åŒ–"></a> é¦–æ¬¡åˆå§‹åŒ–</h2><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">git init # åˆå§‹åŒ–æœ¬åœ°åº“git remote add origin githubä»“åº“åœ°å€ # åˆ›å»ºåˆ«ågit push -u origin master # åˆæ¬¡æäº¤åˆ°ç›®æ ‡åº“ - è®°å½•æœ¬åˆ†æ”¯æäº¤çš„é»˜è®¤å‚æ•°<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h2 id="ä¿®æ”¹æäº¤"><a class="markdownIt-Anchor" href="#ä¿®æ”¹æäº¤"></a> ä¿®æ”¹æäº¤</h2><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"># ä¿®æ”¹æäº¤åˆ° &#96;github&#96;cd blognamegit checkout master # ä½¿ç”¨masteråˆ†æ”¯hexo new &quot;new blogname&quot; # æ–°å»ºä¸€éåšæ–‡git add .git commit -am &quot;message&quot;git push origin master<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="æœ¬åœ°é¢„è§ˆ"><a class="markdownIt-Anchor" href="#æœ¬åœ°é¢„è§ˆ"></a> æœ¬åœ°é¢„è§ˆ</h2><p>æ³¨æ„ï¼šé…ç½®äº† <code>travis ci</code> ä¼šè‡ªåŠ¨æ£€æµ‹åˆ°åšå®¢é¡¹ç›®çš„å˜æ›´ï¼Œå¸®åŠ©æˆ‘ä»¬é‡æ–°éƒ¨ç½²ï¼Œå› æ­¤ <code>ä¿®æ”¹æäº¤</code> ä¸­ä¸éœ€è¦é‡æ–°ç”Ÿæˆé™æ€æ–‡ä»¶</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">hexo clean # æ¸…é™¤ç¼“å­˜å’Œå·²ç”Ÿæˆçš„é™æ€æ–‡ä»¶hexo generate # ç”Ÿæˆé™æ€æ–‡ä»¶hexo server # ä½¿ç”¨é™æ€æ–‡ä»¶ï¼Œåœ¨æœ¬åœ°4000ç«¯å£è¿›è¡Œé¢„è§ˆhexo c &amp; hexo g &amp; hexo s # Magic - è¾¾åˆ°ä¸Šè¿°ä¸‰æ¡å‘½ä»¤çš„æ•ˆæœ<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="åˆ é™¤åšæ–‡"><a class="markdownIt-Anchor" href="#åˆ é™¤åšæ–‡"></a> åˆ é™¤åšæ–‡</h2><p>ä¹Ÿæ²¡æœ‰æŸ¥é˜…åˆ°ç›¸å…³å‘½ä»¤ï¼Œç›´æ¥åœ¨æœ¬åœ°åˆ é™¤åå°±å¯è¡Œäº†</p><p>æœ€å¥½æ‰§è¡Œä¸€æ¬¡ <code>hexo c &amp; hexo g &amp; hexo s</code> æœ¬åœ°å…ˆçœ‹çœ‹ï¼Œç„¶ååœ¨æäº¤ä»“åº“ç¡®è®¤åˆ é™¤æ“ä½œ</p><h1 id="git-push-ç›¸å…³é—®é¢˜"><a class="markdownIt-Anchor" href="#git-push-ç›¸å…³é—®é¢˜"></a> git push ç›¸å…³é—®é¢˜</h1><p>OpenSSL SSL_read: Connection was reset, errno 10054</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">git config --global http.sslVerify &quot;false&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>Failed to connect to <a target="_blank" rel="noopener" href="http://github.com">github.com</a> port 443:connection timed out</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">git config --global http.proxy http:&#x2F;&#x2F;127.0.0.1:1080git config --global https.proxy http:&#x2F;&#x2F;127.0.0.1:1080<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>ä¸Šè¿°è®¾ç½®ååº”è¯¥å°±okäº†ï¼Œå¦‚æœå†æ¬¡å‡ºç°é—®é¢˜ï¼Œå–æ¶ˆä¸Šè¿°ä»£ç†è®¾ç½®åº”è¯¥å°± ok äº†</p><p>ä»€ä¹ˆåŸç†(âŠ™oâŠ™)â€¦</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">git config --global --unset http.proxygit config --global --unset https.proxy<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h1 id="å¾ˆå°çš„é—®é¢˜"><a class="markdownIt-Anchor" href="#å¾ˆå°çš„é—®é¢˜"></a> å¾ˆå°çš„é—®é¢˜</h1><ol><li>åœ¨ <code>_config.yml</code> ä¸­é…ç½®æ ‡é¢˜ï¼Œå¦‚æœæƒ³ä½¿ç”¨ <code>â€™</code> å¯ä»¥ä½¿ç”¨åŒå¼•å·æ‹¬èµ·æ¥ï¼Œåœ¨ <code>yaml</code> è¯­è¨€ä¸­ åŒå¼•å·ä¸ä¼šå¯¹ç‰¹æ®Šå­—ç¬¦è½¬ä¹‰ã€‚</li><li></li></ol>]]></content>
      
      
      <categories>
          
          <category> Blog </category>
          
      </categories>
      
      
        <tags>
            
            <tag> git </tag>
            
            <tag> github </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>my first blog</title>
      <link href="/Coming-blog/2021/04/29/my-first-blog/"/>
      <url>/Coming-blog/2021/04/29/my-first-blog/</url>
      
        <content type="html"><![CDATA[<p>Hello I'm Coming.</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> nparr <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">return</span> arr<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> Blog </category>
          
      </categories>
      
      
    </entry>
    
    
  
  
</search>
